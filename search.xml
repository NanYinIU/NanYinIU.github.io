<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Javaä¸­çš„ä½è¿ç®—</title>
      <link href="/2020/03/28/%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
      <url>/2020/03/28/%E4%BD%8D%E8%BF%90%E7%AE%97/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaä¸­çš„ä½è¿ç®—"><a href="#Javaä¸­çš„ä½è¿ç®—" class="headerlink" title="Javaä¸­çš„ä½è¿ç®—"></a>Javaä¸­çš„ä½è¿ç®—</h1><p>Javaæä¾›äº†å¤šç§ä½è¿ç®—ï¼ŒåŒ…æ‹¬ å·¦ç§»( &lt;&lt; )ã€å³ç§»( &gt;&gt; ) ã€æ— ç¬¦å·å³ç§»( &gt;&gt;&gt; ) ã€ä½ä¸( &amp; ) ã€ä½æˆ–( | )ã€ä½é( ~ )ã€ä½å¼‚æˆ–( ^ )ï¼Œé™¤äº† ~ ä¸ºä¸€å…ƒæ“ä½œç¬¦ï¼Œå…¶ä»–éƒ½ä¸ºäºŒå…ƒæ“ä½œç¬¦ã€‚</p><h2 id="å·¦ç§»å’Œå³ç§»"><a href="#å·¦ç§»å’Œå³ç§»" class="headerlink" title="å·¦ç§»å’Œå³ç§»"></a>å·¦ç§»å’Œå³ç§»</h2><h3 id="ä»€ä¹ˆæ˜¯å·¦å³ç§»æ“ä½œï¼Œäº§ç”Ÿçš„ç»“æœæ˜¯ä»€ä¹ˆ"><a href="#ä»€ä¹ˆæ˜¯å·¦å³ç§»æ“ä½œï¼Œäº§ç”Ÿçš„ç»“æœæ˜¯ä»€ä¹ˆ" class="headerlink" title="ä»€ä¹ˆæ˜¯å·¦å³ç§»æ“ä½œï¼Œäº§ç”Ÿçš„ç»“æœæ˜¯ä»€ä¹ˆ"></a>ä»€ä¹ˆæ˜¯å·¦å³ç§»æ“ä½œï¼Œäº§ç”Ÿçš„ç»“æœæ˜¯ä»€ä¹ˆ</h3><p>ä½¿ç”¨ ç¬¦å· <code>&lt;&lt;</code> å¯¹æ•°å­—äº§ç”Ÿçš„å½±å“å°±æ˜¯å·¦ç§»ï¼ŒåŒç†å³ç§»ã€‚ä¸‹é¢é€šè¿‡ä¾‹å­æ¥çœ‹å·¦ç§»ï¼ˆå³ç§»ï¼‰çš„ç»“æœï¼š</p><p>åœ¨ <code>ArrayList</code> ä¸­ï¼Œä½¿ç”¨äº†<code>grow()</code>æ–¹æ³•è¿›è¡ŒListçš„æ‰©å®¹æ“ä½œï¼Œå…¶å®ï¼Œåœ¨<code>grow()</code>æ–¹æ³•å†…éƒ¨å°±ä½¿ç”¨åˆ°äº†å³ç§»æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// overflow-conscious code</span></span><br><span class="line">        <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">        <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">        <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>grow() å‡½æ•°çš„ä½œç”¨å°±æ˜¯å¯¹ List è¿›è¡Œå€æ•°çš„æ‰©å®¹ï¼Œè¿™ä¸ªå€æ•°å°±æ˜¯ <code>x + x &gt;&gt; 1</code> ,å…·ä½“äº§ç”Ÿçš„ç»“æœç”¨ä¸»å‡½æ•°è¿›è¡Œæµ‹è¯•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="number">10</span>+(<span class="number">10</span>&gt;&gt;<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>äº§ç”Ÿçš„ç»“æœä¸º15.ä¹Ÿå°±æ˜¯è¯´ <code>10&gt;&gt;1</code>çš„ç»“æœä¸º5.é‚£ä¹ˆè®¡ç®—è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Œæ‰ä¼šäº§ç”Ÿè¿™æ ·çš„ç»“æœï¼Ÿ</p><h4 id="è½¬åŒ–ä¸ºäºŒè¿›åˆ¶"><a href="#è½¬åŒ–ä¸ºäºŒè¿›åˆ¶" class="headerlink" title="è½¬åŒ–ä¸ºäºŒè¿›åˆ¶"></a>è½¬åŒ–ä¸ºäºŒè¿›åˆ¶</h4><p>å¯¹ä½çš„è¿ç®—ï¼Œç¬¬ä¸€æ­¥ä¸€å®šæ˜¯å…ˆè½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼Œå†å¯¹äºŒè¿›åˆ¶è¿›è¡Œè®¡ç®—ã€‚</p><p>ä¾‹å­ä¸­çš„ 10 è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ä¸ºï¼š</p><p><code>0000 0000 0000 0000 0000 0000 0000 1010</code></p><h4 id="è¿›è¡Œä¸ºè¿ç®—"><a href="#è¿›è¡Œä¸ºè¿ç®—" class="headerlink" title="è¿›è¡Œä¸ºè¿ç®—"></a>è¿›è¡Œä¸ºè¿ç®—</h4><p>å¦‚æœæ˜¯å·¦ç§»ï¼Œåˆ™åœ¨å³ä¾§è¡¥0ï¼ŒåŒç†å¦‚æœæ˜¯å³ç§»ï¼Œåˆ™åœ¨å·¦ä¾§è¡¥0ã€‚</p><p>æ¯”å¦‚ä¸Šé¢çš„ 10&gt;&gt;1 , å³ç§»ä¸€ä½ï¼Œåˆ™åœ¨å·¦ä¾§è¡¥ä¸€ä¸ª0ã€‚</p><p>ç»“æœä¸º <code>...... 0101</code> ç»“æœä¸º 5</p><p>å¦‚æœ 10&lt;&lt;1 ,å·¦ç§»ä¸€ä½ï¼Œåˆ™åœ¨å³ä¾§è¡¥ä¸€ä¸ª0</p><p>ç»“æœä¸º <code>......1 0100</code> ç»“æœä¸º 20</p><h4 id="æ— ç¬¦å·å·¦ç§»å³ç§»"><a href="#æ— ç¬¦å·å·¦ç§»å³ç§»" class="headerlink" title="æ— ç¬¦å·å·¦ç§»å³ç§»"></a>æ— ç¬¦å·å·¦ç§»å³ç§»</h4><p>è´Ÿæ•°ä»¥åŸç çš„è¡¥ç å½¢å¼è¡¨è¾¾ï¼Œå¦‚æœæ˜¯è´Ÿæ•°æ—¶ï¼Œæ¯”å¦‚ -10 ï¼Œè½¬åŒ–ä¸ºäºŒè¿›åˆ¶å°±æ˜¯</p><p><code>1111 1111 1111 1111 1111 1111 1111 1011</code></p><p>ä¹Ÿå°±æ˜¯é«˜ä½ä¸º1ï¼Œä¸æ­£æ•°ç›¸åï¼ŒåŒç†ï¼Œåœ¨è¿›è¡Œç§»åŠ¨æ—¶ï¼Œä¹Ÿéœ€è¦å°†åŸæ¥çš„è¡¥0ï¼Œè°ƒæ•´ä¸ºè¡¥1ï¼›</p><p>å¦‚ -10&gt;&gt;1,å³ç§»ä¸€ä½ï¼Œå·¦ä¾§è¡¥1</p><p><code>1......1101</code> ,ç»“æœä¸º -5</p><p>æ— ç¬¦å·åˆ™å§‹ç»ˆè¡¥0ï¼›</p><p>ç»¼ä¸Šï¼š</p><ol><li>è½¬åŒ–ä¸ºäºŒè¿›åˆ¶</li><li>æ­£æ•°åå‘è¡¥0</li><li>è´Ÿæ•°åå‘è¡¥1</li><li>æ— ç¬¦å·åå‘è¡¥0</li></ol><h2 id="ä½ä¸ï¼ˆ-amp-ï¼‰"><a href="#ä½ä¸ï¼ˆ-amp-ï¼‰" class="headerlink" title="ä½ä¸ï¼ˆ&amp;ï¼‰"></a>ä½ä¸ï¼ˆ&amp;ï¼‰</h2><p>åœ¨HashMapä¸­è¿›è¡Œputå…ƒç´ çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ <code>putVal()</code> æ–¹æ³•è¿›è¡Œå®é™…çš„è®¡ç®—å’Œæ·»åŠ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ (n-1)&amp;hash æŸ¥æ‰¾ä½ç½®æ˜¯å¦å·²ç»è¢«å ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨ &amp; çš„ä½œç”¨å…¶å®æ˜¯ä¸ºäº†ä¿è¯ hash çš„å€¼ä¸è¶…è¿‡èŒƒå›´ã€‚æ•°ç»„å…·æœ‰2çš„å¹‚æ•°é•¿åº¦ï¼Œä»¥ç”¨&amp;æ›¿æ¢æ˜‚è´µçš„å–æ¨¡è¿ç®—ã€‚</p><p>è¿ç®—è§„åˆ™ï¼šç¬¬ä¸€ä¸ªæ•°çš„çš„ç¬¬nä½å’Œç¬¬äºŒä¸ªæ•°çš„ç¬¬nä½å¦‚æœéƒ½æ˜¯1ï¼Œé‚£ä¹ˆç»“æœçš„ç¬¬nä¸ºä¹Ÿä¸º1ï¼Œå¦åˆ™ä¸º0 ç®€åŒ–æè¿°è§„åˆ™:<strong>åŒä¸€ä¸ºä¸€,å¦åˆ™ä¸ºé›¶</strong></p><p>5è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼š<code>0000 0000 0000 0000 0000 0000 0000 0101</code></p><p>3è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼š<code>0000 0000 0000 0000 0000 0000 0000 0011</code></p><p>ç»“æœï¼š<code>0000 0000 0000 0000 0000 0000 0000 0001</code></p><p>è½¬åŒ–ä¸º10è¿›åˆ¶ä¸º 1</p><p>å¯ä»¥ä½œç”¨ä¸ºå…³é—­ï¼ˆå±è”½ï¼‰ç‰¹å®šä½çš„æ‰‹æ®µ</p><h2 id="ä½æˆ–ï¼ˆï½œï¼‰"><a href="#ä½æˆ–ï¼ˆï½œï¼‰" class="headerlink" title="ä½æˆ–ï¼ˆï½œï¼‰"></a>ä½æˆ–ï¼ˆï½œï¼‰</h2><p>è¿ç®—è§„åˆ™ï¼šç¬¬ä¸€ä¸ªæ•°çš„çš„ç¬¬nä½äºç¬¬äºŒä¸ªæ•°çš„ç¬¬nä½ åªè¦æœ‰ä¸€ä¸ªæ˜¯1ï¼Œé‚£ä¹ˆç»“æœçš„ç¬¬nä¸ºä¹Ÿä¸º1ï¼Œå¦åˆ™ä¸º0. ç®€åŒ–è§„åˆ™æè¿°: <strong>æœ‰ä¸€åˆ™ä¸€,å¦åˆ™ä¸ºé›¶</strong></p><p>5è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼š<code>0000 0000 0000 0000 0000 0000 0000 0101</code></p><p>3è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼š<code>0000 0000 0000 0000 0000 0000 0000 0011</code></p><p>ç»“æœï¼š<code>0000 0000 0000 0000 0000 0000 0000 0110</code></p><p>è½¬åŒ–ä¸º10è¿›åˆ¶ä¸º 7</p><p>å¯ä»¥ä½œä¸ºå°†ç‰¹å®šä½ç½®ä¸º1çš„æ‰‹æ®µ</p><h2 id="å¼‚æˆ–ï¼ˆ-ï¼‰"><a href="#å¼‚æˆ–ï¼ˆ-ï¼‰" class="headerlink" title="å¼‚æˆ–ï¼ˆ^ï¼‰"></a>å¼‚æˆ–ï¼ˆ^ï¼‰</h2><p>è¿ç®—è§„åˆ™ï¼šç¬¬ä¸€ä¸ªæ•°çš„çš„ç¬¬nä½äºç¬¬äºŒä¸ªæ•°çš„ç¬¬nä½ <strong>ç›¸å</strong>ï¼Œé‚£ä¹ˆç»“æœçš„ç¬¬nä¸ºä¹Ÿä¸º1ï¼Œå¦åˆ™ä¸º0,ç®€åŒ–è§„åˆ™æè¿°: <strong>ç›¸åä¸ºä¸€,å¦åˆ™ä¸ºé›¶</strong></p><p>5è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼š<code>0000 0000 0000 0000 0000 0000 0000 0101</code></p><p>3è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼š<code>0000 0000 0000 0000 0000 0000 0000 0011</code></p><p>ç»“æœï¼š<code>0000 0000 0000 0000 0000 0000 0000 0110</code></p><p>è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ä¸º 7</p><ol><li>æŒ‰ä½â€œå¼‚æˆ–â€è¿ç®—å¯ä»¥ä½¿ç‰¹å®šçš„ä½å–å</li><li>ç›´æ¥äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a^=b</span><br><span class="line">b^=a</span><br><span class="line">a^=b</span><br></pre></td></tr></table></figure><p>è¿™æ ·açš„å€¼ä¸bçš„å€¼å°±å½¢æˆäº†äº’æ¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lambdaè¡¨è¾¾å¼å­¦ä¹ å’Œåº”ç”¨</title>
      <link href="/2020/03/24/Lambda%20expression/"/>
      <url>/2020/03/24/Lambda%20expression/</url>
      
        <content type="html"><![CDATA[<h1 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h1><p>Lamdba è¡¨è¾¾å¼æ˜¯Java 8 çš„æ–°ç‰¹æ€§ï¼Œä¹Ÿæ˜¯Java 8 ä¸­æœ€é‡è¦çš„çš„æ–°åŠŸèƒ½ã€‚Lamdabaè¡¨è¾¾å¼ä¿ƒè¿›äº†Javaä½¿ç”¨å‡½æ•°æ–¹å¼è¿›è¡Œç¼–ç¨‹ã€‚</p><p>åœ¨è¿›è¡Œè¯­æ³•çš„è®²è§£ä¹‹å‰,éœ€è¦äº†è§£å’ŒLambdaæ¯æ¯ç›¸å…³çš„<code>Function Interface</code>,å¯ä»¥è¯´åªæœ‰å‡½æ•°å¼æ¥å£çš„å­˜åœ¨,æ‰æœ‰lambdaè¡¨è¾¾å¼çš„å­˜åœ¨,æ¢å¥è¯å¯ä»¥è¯´lambdaè¡¨è¾¾å¼æ˜¯å‡½æ•°å¼æ¥å£çš„å®ç°.</p><h2 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h2><p>Function æ¥å£å…·æœ‰å•ä¸ªåŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æœ‰å•ä¸ªæŠ½è±¡æ–¹æ³•.å¦‚ <code>Comparable</code> æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³• <code>compareTo</code> ç”¨æ¥è¿›è¡Œæ¯”è¾ƒã€‚</p><p>Java8å®šä¹‰äº†å‡½æ•°æ¥å£è¢«ç”¨æ¥æ‹“å±•Lamdbaè¡¨è¾¾å¼ã€‚åœ¨ <code>java.util.Function</code> åŒ…ä¸‹æœ‰éå¸¸å¤šçš„å‡½æ•°æ¥å£ã€‚</p><p>å¸¸ç”¨çš„æ¥å£åŒ…æ‹¬ï¼›</p><table><thead><tr><th>æ¥å£</th><th>æŠ½è±¡æ–¹æ³•</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>Function&lt;T,R&gt;</td><td>R apply(T t);</td><td>æ¥å—Tç±»å‹å‚æ•°,è¿”å›Rç±»å‹ç»“æœ</td></tr><tr><td>Consumer<t></t></td><td>void accept(T t);</td><td>æ¥å—Tç±»å‹å‚æ•°,ä¸è¿”å›ç»“æœ</td></tr><tr><td>Predicate<t></t></td><td>boolean test(T t);</td><td>æ¥å—Tç±»å‹å‚æ•°,è¿”å›Booleanç»“æœ</td></tr><tr><td>Suppler<t></t></td><td>T get();</td><td>æ— å‚æ•°,è¿”å›Tç±»å‹ç»“æœ</td></tr></tbody></table><h3 id="å®šä¹‰å‡½æ•°æ¥å£"><a href="#å®šä¹‰å‡½æ•°æ¥å£" class="headerlink" title="å®šä¹‰å‡½æ•°æ¥å£"></a>å®šä¹‰å‡½æ•°æ¥å£</h3><ol><li>ä½¿ç”¨ <code>@FunctionalInterface</code> æ³¨è§£,è¯¥æ³¨è§£ä¸æ˜¯å¿…é¡»çš„,ä½†æ˜¯å¦‚æœæ ‡æ³¨,åˆ™ç¼–è¯‘å™¨ä¼šæ£€æŸ¥è¿™ä¸ªæ¥å£ä¸‹æ˜¯å¦åªæœ‰å•ä¸ªæŠ½è±¡æ–¹æ³•,å¦‚æœä¸æ˜¯ä¼šæŠ¥é”™.</li><li>æ–°å¢defaultæ–¹æ³•,æ˜¯ä¸ºäº†åœ¨ç°æœ‰çš„ç±»åº“ä¸­ä¸­æ–°å¢åŠŸèƒ½è€Œä¸å½±å“ä»–ä»¬çš„å®ç°ç±»</li><li>æ–°å¢æ¥å£å†…staticæ–¹æ³•,å¯å®šä¹‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªé™æ€æ–¹æ³•,å’Œæ™®é€šçš„é™æ€æ–¹æ³•æ²¡æœ‰åŒºåˆ«,éƒ½æ˜¯<code>æ¥å£å.æ–¹æ³•å</code>è¿›è¡Œè°ƒç”¨</li><li>åœ¨å‡½æ•°å¼æ¥å£çš„å®šä¹‰ä¸­æ˜¯åªå…è®¸æœ‰ä¸”åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•(å¿…é¡»)ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªstaticæ–¹æ³•å’Œdefaultæ–¹æ³•ã€‚</li></ol><h2 id="Lambdaè¯­æ³•"><a href="#Lambdaè¯­æ³•" class="headerlink" title="Lambdaè¯­æ³•"></a>Lambdaè¯­æ³•</h2><p>ä¸€ä¸ªLambdaè¡¨è¾¾å¼æœ‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paramter -&gt; expression body</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯lambdaè¡¨è¾¾å¼çš„å‡ ä¸ªç‰¹æ€§</p><ul><li><strong>å¯é€‰çš„ç±»å‹æè¿°</strong> - ä¸éœ€è¦å£°æ˜å‚æ•°çš„ç±»å‹ï¼Œç¼–è¯‘å™¨å¯æ ¹æ®å‚æ•°çš„å€¼è¿›è¡Œæ¨æ–­</li><li><strong>å¯é€‰çš„å‚æ•°ä¸¤æ—çš„æ‹¬å·</strong> - å£°æ˜å•ä¸ªå‚æ•°çš„æ—¶å€™ä¸éœ€è¦ä½¿ç”¨æ‹¬å·ï¼Œä½†æ˜¯å¦‚ä½•å£°æ˜å¤šä¸ªå‚æ•°ï¼Œæ‹¬å·è¿˜æ˜¯å¿…é¡»çš„ã€‚</li><li><strong>å¯é€‰çš„å¤§æ‹¬å·</strong> - å¦‚æœå‡½æ•°ä½“ä¸­åªæœ‰å•è¡Œï¼Œåˆ™ä¸éœ€è¦åœ¨å‡½æ•°ä½“ä¸¤ä¾§æ·»åŠ å¤§æ‹¬å·</li><li><strong>å¯é€‰çš„è¿”å›å€¼</strong> - å¦‚æœå‡½æ•°ä¸­åªæœ‰å•è¡Œï¼Œç¼–è¯‘å™¨è‡ªåŠ¨è¿”å›è¿™ä¸ªå•è¡Œçš„è¿”å›å€¼</li></ul><p>ä¸‹é¢æ ¹æ®å®ä¾‹æ¥çœ‹ä¸Šé¢çš„å››ä¸ªç‰¹æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Java8Tester</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">      GreetingService greetService1 = message -&gt; System.out.println(<span class="string">"Say:"</span>+message);</span><br><span class="line">      greetService1.sayMessage(<span class="string">"Hello!!"</span>);</span><br><span class="line">      MathOperation add = (<span class="keyword">int</span> a,<span class="keyword">int</span> b) -&gt; a+b;</span><br><span class="line">      MathOperation sub= (a,b) -&gt; a-b;</span><br><span class="line">      MathOperation muti = (a,b) -&gt; &#123;<span class="keyword">return</span> a*b;&#125;;</span><br><span class="line">      System.out.println(<span class="string">"add å‡½æ•°ç»“æœï¼š"</span>+add.operation(<span class="number">2</span>,<span class="number">2</span>));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="class"><span class="keyword">interface</span> <span class="title">GreetingService</span> </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">sayMessage</span><span class="params">(String message)</span></span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="class"><span class="keyword">interface</span> <span class="title">MathOperation</span></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">int</span> <span class="title">operation</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line">Say:Hello!!</span><br><span class="line">add å‡½æ•°ç»“æœï¼š<span class="number">4</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹é‡è¦çš„ä¸¤ç‚¹ï¼š</p><ul><li>Lambda è¡¨è¾¾å¼ä¸»è¦ç”¨æ¥å®šä¹‰åŠŸèƒ½æ¥å£çš„å†…è”å®ç°ï¼Œå¦‚ï¼šä¸€ä¸ªæ¥å£é‡Œåªæœ‰ä¸€ä¸ªæ¥å£æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œé¢æˆ‘ä»¬ä½¿ç”¨äº†å¯¹MathOperationæ¥å£è¿›è¡Œäº†å¤šç§å®ç°ã€‚</li><li>Lambda è¡¨è¾¾å¼æ¶ˆé™¤äº†å¯¹åŒ¿åç±»çš„éœ€æ±‚ï¼Œå¦‚<code>new Thread(new Runnable{..})</code> ,ä¸ºJavaæä¾›äº†éå¸¸ç®€å•è€Œå¼ºå¤§çš„å‡½æ•°ç¼–ç¨‹èƒ½åŠ›ã€‚</li></ul><h2 id="ä½¿ç”¨æ–¹æ³•å¼•ç”¨"><a href="#ä½¿ç”¨æ–¹æ³•å¼•ç”¨" class="headerlink" title="ä½¿ç”¨æ–¹æ³•å¼•ç”¨"></a>ä½¿ç”¨æ–¹æ³•å¼•ç”¨</h2><p>æ–¹æ³•å¼•ç”¨ï¼ˆMethod Refrencesï¼‰å¸®åŠ©é€šè¿‡æ–¹æ³•åç§°æŒ‡å‘æ–¹æ³•ã€‚æ–¹æ³•å¼•ç”¨ä½¿ç”¨ç¬¦å·â€œ::â€è¡¨ç¤ºã€‚æ–¹æ³•å¼•ç”¨å¯ä»¥ç”¨çˆ±æŒ‡å‘å¦‚ä¸‹ç±»å‹çš„æ–¹æ³•ï¼š</p><ul><li>é™æ€æ–¹æ³•</li><li>å®ä¾‹æ–¹æ³•</li><li>æ„é€ æ–¹æ³•ä½¿ç”¨newå…³é”®å­—ï¼ˆTreeSet::newï¼‰</li></ul><p>[æ–¹æ³•å¼•ç”¨]çš„æ ¼å¼æ˜¯ ç±»å::æ–¹æ³•å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.stream(objectArray).forEach(System.out::println);</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨Lambda"><a href="#ä½¿ç”¨Lambda" class="headerlink" title="ä½¿ç”¨Lambda"></a>ä½¿ç”¨Lambda</h2><blockquote><p>ç†Ÿèƒ½ç”Ÿå·§,å¸¸å¸¸ç»ƒä¹ è‚¯å®šèƒ½è®°ä½</p></blockquote><h3 id="1-åˆ›å»ºThread"><a href="#1-åˆ›å»ºThread" class="headerlink" title="1. åˆ›å»ºThread"></a>1. åˆ›å»ºThread</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ä½¿ç”¨Lambdaåˆ›å»ºThread</span></span><br><span class="line"><span class="comment">// å¯ä»¥çœ‹å‡ºå†…éƒ¨ç›´æ¥åˆ›å»ºäº†Runnableçš„åŒ¿åç±»</span></span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ–°å»ºçº¿ç¨‹ã€‚ã€‚"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨lambdaåˆ›å»ºThread</span></span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; System.out.println(<span class="string">"ä½¿ç”¨Lambdaæ–°å»ºçº¿ç¨‹ã€‚ã€‚"</span>)).start();</span><br></pre></td></tr></table></figure><h3 id="2-åˆ—è¡¨è¿­ä»£"><a href="#2-åˆ—è¡¨è¿­ä»£" class="headerlink" title="2. åˆ—è¡¨è¿­ä»£"></a>2. åˆ—è¡¨è¿­ä»£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// ä¸ä½¿ç”¨Lambda</span></span><br><span class="line"><span class="keyword">for</span> (Integer integer : list) &#123;</span><br><span class="line">    System.out.println(integer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä½¿ç”¨Lambda</span></span><br><span class="line">list.forEach((s) -&gt; System.out.println(s));</span><br><span class="line"><span class="comment">//æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">list.forEach(System.out::println);</span><br></pre></td></tr></table></figure><h3 id="3-Map-amp-Reduce"><a href="#3-Map-amp-Reduce" class="headerlink" title="3. Map&amp;Reduce"></a>3. Map&amp;Reduce</h3><ul><li>ä½¿ç”¨Mapå¤„ç†åˆ—è¡¨å†…æ‰€æœ‰å…ƒç´ å…¨éƒ¨åŠ 2</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ä½¿ç”¨Lambda</span></span><br><span class="line"><span class="keyword">for</span> (Integer integer : list) &#123;</span><br><span class="line">    <span class="keyword">int</span> order = integer + <span class="number">2</span>;</span><br><span class="line">    System.out.println(order);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨Lambda</span></span><br><span class="line">list.stream().map((a) -&gt; a + <span class="number">2</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ Map + collect å®Œæˆå¯¹æ¯ä¸ªå…ƒç´ è®¡ç®—åè¿”å›æ–°çš„ç»“æœåˆ—è¡¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; newList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ä½¿ç”¨Lambda</span></span><br><span class="line"><span class="keyword">for</span> (Integer integer : list) &#123;</span><br><span class="line">    <span class="keyword">int</span> order = integer + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> result = order / integer;</span><br><span class="line">    newList.add(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (Integer integer : newList) &#123;</span><br><span class="line">    System.out.println(integer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨Lambda</span></span><br><span class="line">newList = list.stream().map((a) -&gt; (a + <span class="number">2</span>)/a).collect(Collectors.toList());</span><br><span class="line">newList.forEach(System.out::println);</span><br></pre></td></tr></table></figure><h3 id="4-ä½¿ç”¨filterå®ç°å…ƒç´ çš„è¿‡æ»¤"><a href="#4-ä½¿ç”¨filterå®ç°å…ƒç´ çš„è¿‡æ»¤" class="headerlink" title="4. ä½¿ç”¨filterå®ç°å…ƒç´ çš„è¿‡æ»¤"></a>4. ä½¿ç”¨filterå®ç°å…ƒç´ çš„è¿‡æ»¤</h3><p>ä½¿ç”¨lambda,å¯ç›´æ¥ä½¿ç”¨filterè¿›è¡Œå…ƒç´ çš„è¿‡æ»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ä½¿ç”¨lambdaæ—¶</span></span><br><span class="line">List&lt;Integer&gt; list_1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (Integer integer : list) &#123;</span><br><span class="line">    <span class="keyword">if</span>(integer != <span class="number">3</span>)&#123;</span><br><span class="line">        list_1.add(integer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ filter è¿›è¡Œè¿‡æ»¤</span></span><br><span class="line">List&lt;Integer&gt; list_2 = list.stream().filter((a) -&gt; a!=<span class="number">3</span>).collect(Collectors.toList());</span><br><span class="line">list_2.forEach(System.out::println);</span><br></pre></td></tr></table></figure><h3 id="5-æ‰§è¡Œå‡½æ•°"><a href="#5-æ‰§è¡Œå‡½æ•°" class="headerlink" title="5. æ‰§è¡Œå‡½æ•°"></a>5. æ‰§è¡Œå‡½æ•°</h3><p>ç¨å¤æ‚çš„å­—ç¬¦ä¸²å¤„ç†,ç”¨lambdaåˆé€‚ä¸è¿‡äº†,ä¸‹é¢çš„ä¾‹å­,åªå°†ç‰¹å®šå­—ç¬¦çš„å­—ç¬¦ä¸²è¿›è¡Œ toUpperCase</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; s = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">s.add(<span class="string">"hello "</span>);</span><br><span class="line">s.add(<span class="string">"world "</span>);</span><br><span class="line">s.add(<span class="string">"!! "</span>);</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; s_1 = s.stream()</span><br><span class="line">        .filter(a -&gt; a.startsWith(<span class="string">"h"</span>) || a.startsWith(<span class="string">"w"</span>))</span><br><span class="line">        .map(String::toUpperCase)</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">s_1.forEach(System.out::println);</span><br></pre></td></tr></table></figure><h3 id="6-ç®—æ•°è¿ç®—"><a href="#6-ç®—æ•°è¿ç®—" class="headerlink" title="6. ç®—æ•°è¿ç®—"></a>6. ç®—æ•°è¿ç®—</h3><p>æ”¯æŒä½¿ç”¨minã€maxç­‰ç›´æ¥å®ç°Comparatorè¿›è¡Œè¿ç®—,å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Integer&gt; min = list.stream().min(Integer::compareTo);</span><br></pre></td></tr></table></figure><p>ä¹Ÿæ”¯æŒä½¿ç”¨ IntSummaryStatistics çŠ¶æ€,å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IntSummaryStatistics intSummaryStatistics = list.stream().mapToInt(x -&gt; x).summaryStatistics();</span><br><span class="line">System.out.println(<span class="string">"æœ€å¤§å€¼ï¼š"</span>+intSummaryStatistics.getMax());</span><br><span class="line">System.out.println(<span class="string">"æœ€å°å€¼ï¼š"</span>+intSummaryStatistics.getMin());</span><br><span class="line">System.out.println(<span class="string">"å¹³å‡å€¼ï¼š"</span>+intSummaryStatistics.getAverage());</span><br><span class="line">System.out.println(<span class="string">"æ•°é‡ï¼š"</span>+intSummaryStatistics.getCount());</span><br></pre></td></tr></table></figure><h3 id="7-è‡ªå®šä¹‰æ–¹æ³•ä½¿ç”¨Function-Intefaceå®ç°å¤æ‚åŠŸèƒ½"><a href="#7-è‡ªå®šä¹‰æ–¹æ³•ä½¿ç”¨Function-Intefaceå®ç°å¤æ‚åŠŸèƒ½" class="headerlink" title="7. è‡ªå®šä¹‰æ–¹æ³•ä½¿ç”¨Function Intefaceå®ç°å¤æ‚åŠŸèƒ½"></a>7. è‡ªå®šä¹‰æ–¹æ³•ä½¿ç”¨Function Intefaceå®ç°å¤æ‚åŠŸèƒ½</h3><p>Java 8 æä¾›äº†ä¸‰ä¸ªå¸¸ç”¨çš„å‡½æ•°æ¥å£åŒ…æ‹¬ï¼›</p><ul><li>Function&lt;T,R&gt;</li><li>Predicate<t> åˆ¤æ–­</t></li><li>Consumer<t> æ¶ˆè´¹</t></li></ul><p>é€šè¿‡å®šä¹‰æ–¹æ³•ä½¿ç”¨è¿™ä¸‰ç±»æ¥å£,èƒ½å®Œæˆæ›´å¤æ‚çš„è°ƒç”¨é€»è¾‘,åœ¨è¿™é‡Œä»…ä»…ä¸¾ä¸€ä¸ªå°ä¾‹å­ğŸŒ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Integer&gt; <span class="title">functionMethods2</span><span class="params">(List&lt;Integer&gt; a, Function&lt;List&lt;Integer&gt;, List&lt;Integer&gt;&gt; function)</span> </span>&#123;</span><br><span class="line">    a = a.stream()</span><br><span class="line">            .filter(demoFilter(<span class="number">2</span>))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> function.apply(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Predicate&lt;Integer&gt; <span class="title">demoFilter</span><span class="params">(Integer number)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a) -&gt; !a.equals(number);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯è°ƒç”¨</span></span><br><span class="line">JavaTester javaTester = <span class="keyword">new</span> JavaTester();</span><br><span class="line">List&lt;Integer&gt; resList = javaTester.functionMethods2(list, a -&gt; &#123;</span><br><span class="line">        a.add(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysqlä¸­çš„INSTRå’ŒFIND_IN_SETå‡½æ•°åº”ç”¨</title>
      <link href="/2020/03/09/INSTR%E5%92%8CFIND_IN_SET%E5%87%BD%E6%95%B0/"/>
      <url>/2020/03/09/INSTR%E5%92%8CFIND_IN_SET%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="INSTRå‡½æ•°"><a href="#INSTRå‡½æ•°" class="headerlink" title="INSTRå‡½æ•°"></a>INSTRå‡½æ•°</h1><p>The INSTR() function returns the position of the first occurrence of a string in another string.</p><p>This function performs a case-insensitive search.</p><p>èƒ½å¤Ÿæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°ä½ç½®,ç±»ä¼¼javaä¸­çš„firstIndexOf,å¹¶ä¸”æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„æœç´¢</p><h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><p>é¦–å…ˆ:äº†è§£åˆ° INSTR å‡½æ•°çš„åŸºæœ¬åŠŸèƒ½æ—¶èƒ½å¤Ÿ <strong>è¿”å›å­—ç¬¦ä¸²åœ¨æŸä¸€ä¸ªå­—æ®µçš„å†…å®¹ä¸­çš„ä½ç½®, æ²¡æœ‰æ‰¾åˆ°å­—ç¬¦ä¸²è¿”å›0ï¼Œå¦åˆ™è¿”å›ä½ç½®ï¼ˆä»1å¼€å§‹ï¼‰</strong> .æ¯”å¦‚:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç»“æœä¸º10</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">INSTR</span>(<span class="string">"this is mysql"</span>,<span class="string">"y"</span>)  </span><br><span class="line"><span class="comment">-- ç»“æœä¸º0</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">INSTR</span>(<span class="string">"this is mysql"</span>,<span class="string">"a"</span>)</span><br></pre></td></tr></table></figure><p>2å¦‚æœinstrå½“ä½œæŸ¥è¯¢æ¡ä»¶,å°±èƒ½èµ·åˆ°<strong>ç±»ä¼¼inçš„ä½œç”¨</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¿”å›ç”¨æˆ·idä¸º12çš„æ•°æ®,åŒæ ·çš„,ä¹Ÿä¼šè¿”å›idä¸º 1,2çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> u <span class="keyword">where</span> <span class="keyword">INSTR</span>(<span class="string">'12'</span>,u.id);</span><br></pre></td></tr></table></figure><p>æ›´å¤æ‚çš„èƒ½å¤ŸæŸ¥è¯¢æ•°æ®ä¸ºå­—ç¬¦ä¸²,å¹¶ä¸”ç”¨ç‰¹å®šç¬¦å·åˆ†éš”çš„ç‰¹å®šçš„æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">GROUP_CONCAT</span>(u.username) <span class="keyword">as</span> <span class="keyword">name</span> </span><br><span class="line"><span class="keyword">from</span> <span class="string">`user`</span> u </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">INSTR</span>(<span class="keyword">concat</span>(<span class="string">','</span>,(p.leaderIds),<span class="string">','</span>),<span class="keyword">concat</span>(<span class="string">','</span>,(u.id),<span class="string">','</span>))</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> product p </span><br><span class="line"><span class="keyword">WHERE</span> p.product_uid =<span class="string">'02124ff31eac4c14934b045358b10cca'</span></span><br></pre></td></tr></table></figure><h1 id="FIND-IN-SET-å‡½æ•°"><a href="#FIND-IN-SET-å‡½æ•°" class="headerlink" title="FIND_IN_SET å‡½æ•°"></a>FIND_IN_SET å‡½æ•°</h1><p>The FIND_IN_SET() function returns the position of a string within a list of strings.</p><p>èƒ½å¤Ÿè¿”å›listä¸­çš„å­—ç¬¦ä¸²ä½ç½®(ä½¿ç”¨é€—å·åˆ†éš”)</p><p>åŸºç¡€çš„å°±ä¸å¤šè¯´,ç›´æ¥ä¸¾ä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼šåªè¿”å›idä¸º12,13çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> u <span class="keyword">where</span> FIND_IN_SET(u.id,<span class="string">'12,13'</span>)</span><br></pre></td></tr></table></figure><p>find_in_set å’Œ instr å‡½æ•°åšä¾‹å­ä¸Šçš„å¯¹æ¯”æ—¶,å‘ç°instræ˜¯æ¨¡ç³ŠåŒ¹é…,åªè¦ç¬¦åˆéƒ½ä¼šæŸ¥å‡ºæ¥,è€Œfind_in_setæ˜¯é’ˆå¯¹ä½¿ç”¨é€—å·åˆ†éš”çš„å¯¹instrçš„è¿›ä¸€æ­¥å¤„ç†,åªæœ‰å‡ºç°åœ¨é€—å·ä¹‹é—´çš„è¿›è¡Œç²¾ç¡®åŒ¹é….</p>]]></content>
      
      
      <categories>
          
          <category> MYSQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MYSQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootæ•´åˆJPAä½¿ç”¨</title>
      <link href="/2020/03/05/SpringBoot%E6%95%B4%E5%90%88JPA%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/03/05/SpringBoot%E6%95%B4%E5%90%88JPA%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootæ•´åˆJPAä½¿ç”¨"><a href="#SpringBootæ•´åˆJPAä½¿ç”¨" class="headerlink" title="SpringBootæ•´åˆJPAä½¿ç”¨"></a>SpringBootæ•´åˆJPAä½¿ç”¨</h1><h2 id="æ•´åˆJPA"><a href="#æ•´åˆJPA" class="headerlink" title="æ•´åˆJPA"></a>æ•´åˆJPA</h2><p>SpringBootæ•´åˆJPAååˆ†æ–¹ä¾¿,åœ¨Pomä¸­æ·»åŠ å¦‚ä¸‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æ•°æ®åº“é…ç½®,ä½¿ç”¨druid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="JPAåŸºæœ¬é…ç½®"><a href="#JPAåŸºæœ¬é…ç½®" class="headerlink" title="JPAåŸºæœ¬é…ç½®"></a>JPAåŸºæœ¬é…ç½®</h3><p>åœ¨application.properties æˆ–è€… application.yaml æ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“é“¾æ¥å’ŒJPAçš„åŸºæœ¬é…ç½®(æœ¬ä¾‹ä½¿ç”¨yamlæ–‡ä»¶):</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    datasource:</span></span><br><span class="line"><span class="attr">        driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">        druid:</span></span><br><span class="line"><span class="attr">            initial-size:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">            max-active:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">            max-wait:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">            stat-view-servlet:</span></span><br><span class="line"><span class="attr">                login-password:</span> <span class="string">admin</span></span><br><span class="line"><span class="attr">                login-username:</span> <span class="string">admin</span></span><br><span class="line"><span class="attr">        password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">        url:</span> <span class="attr">jdbc:mysql://127.0.0.1:3306/web?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line"><span class="attr">        username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    jpa:</span></span><br><span class="line">    <span class="comment">#   é…ç½®åˆ›å»ºè¡¨ä½¿ç”¨çš„SQLDialect</span></span><br><span class="line"><span class="attr">        database-platform:</span> <span class="string">org.hibernate.dialect.MySQL5InnoDBDialect</span></span><br><span class="line"><span class="attr">        show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#   è‡ªåŠ¨æ›´æ–°æ•°æ®åº“è¡¨</span></span><br><span class="line"><span class="attr">        hibernate:</span></span><br><span class="line"><span class="attr">            ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="attr">        properties:</span></span><br><span class="line"><span class="attr">            hibernate:</span></span><br><span class="line">            <span class="comment">#   ä½¿ç”¨@Queryæ—¶SQLçš„dialectæ–¹è¨€</span></span><br><span class="line"><span class="attr">                dialect:</span> <span class="string">org.hibernate.dialect.MySQL5InnoDBDialect</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨JPA"><a href="#ä½¿ç”¨JPA" class="headerlink" title="ä½¿ç”¨JPA"></a>ä½¿ç”¨JPA</h2><p>åœ¨SpringBootä¸­ä½¿ç”¨JPAååˆ†ç®€å•,åªè¦å¼•ç”¨JPAçš„starterå³å¯</p><h3 id="å®ä½“ç±»ä¸­å±æ€§"><a href="#å®ä½“ç±»ä¸­å±æ€§" class="headerlink" title="å®ä½“ç±»ä¸­å±æ€§"></a>å®ä½“ç±»ä¸­å±æ€§</h3><p>ä½¿ç”¨Spring Data JPA,ä¸Mybatisä¸åŒ,æ›´å¤šçš„æ˜¯é¢å‘å¯¹è±¡æŸ¥è¯¢.æ‰€ä»¥æ„é€ å¯¹è±¡å®ä½“ç±»å°±éå¸¸é‡è¦,å¦‚æœé…ç½®äº†è‡ªåŠ¨æ›´æ–°è¡¨ç»“æ„,å°±éœ€è¦æ³¨æ„å¦‚ä½•åœ¨å®ä½“ä¸­ä½¿ç”¨ç‰¹å®šçš„æ³¨è§£å®Œæˆå¯¹å®ä½“çš„é…ç½®.</p><h4 id="1-Entity"><a href="#1-Entity" class="headerlink" title="1. @Entity"></a>1. @Entity</h4><p>ä½¿ç”¨ <code>@Entity</code> æ³¨è§£åœ¨ç±»ä¸Š,ç”¨æ¥è¡¨ç¤ºè¯¥ç±»ä¸ºä¸€ä¸ªå®ä½“ç±»</p><h4 id="2-Table"><a href="#2-Table" class="headerlink" title="2. @Table"></a>2. @Table</h4><p>ä½¿ç”¨ @Table æ³¨è§£æ ‡æ³¨åœ¨ç±»ä¸Š, å¯ä»¥æŒ‡å®šä½¿ç”¨ @Entity æ³¨è§£æ ‡æ³¨çš„ç±»æ‰€ç”Ÿæˆçš„æ•°æ®åº“è¡¨ä¿¡æ¯,å¦‚è¡¨åç§°ç­‰.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span> <span class="comment">// æŒ‡å®šè¿™ä¸ªç±»ä¸ºå®ä½“ç±»</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"user"</span>) <span class="comment">// æŒ‡å®š@Entityæ ‡æ³¨çš„ä¸»è¡¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-Id-Column"><a href="#3-Id-Column" class="headerlink" title="3. @Id,@Column"></a>3. @Id,@Column</h4><p>ä½¿ç”¨ @Id æ³¨è§£æ ‡æ³¨åœ¨å˜é‡æˆ–è€…setæ–¹æ³•ä¸Š,ç”¨æ¥æ ‡æ³¨è¯¥å˜é‡ä¸ºä¸»é”®ID.</p><p>ä½¿ç”¨ @Column æ³¨è§£åŒæ ·æ ‡æ³¨åœ¨å˜é‡ä¸Š,èƒ½å¤Ÿè®¾ç½®ç”Ÿæˆè¡¨çš„å„ç§è¯¦ç»†ä¿¡æ¯,å¦‚å­—æ®µåç§°,å­—æ®µé•¿åº¦ç­‰ç­‰â€¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@Column</span>(columnDefinition = <span class="string">"INT(11)"</span>)</span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Column</span>(name = <span class="string">"is_deleted"</span>,columnDefinition = <span class="string">"TINYINT(1)"</span>,nullable =</span><br><span class="line"><span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">private</span> Short isDeleted=<span class="number">0</span>;</span><br></pre></td></tr></table></figure><h4 id="4-GeneratedValue"><a href="#4-GeneratedValue" class="headerlink" title="4. @GeneratedValue"></a>4. @GeneratedValue</h4><p>ä½¿ç”¨ @GeneratedValue æ³¨è§£æ ‡æ³¨åœ¨ å’Œ @Id ç›¸åŒçš„ä½ç½®,ç”¨æ¥è¡¨ç¤ºä¸»é”®IDçš„ç”Ÿæˆç­–ç•¥.è¯¥æ³¨è§£æœ‰ä¸¤ä¸ªå±æ€§,ç¬¬ä¸€ä¸ªæ˜¯å¸¸ç”¨åˆ°çš„ strategy å³ç”Ÿæˆç­–ç•¥,ç¬¬äºŒä¸ªæ˜¯ä¸å¸¸ç”¨åˆ°çš„generatoræŒ‡å®šç”Ÿæˆå™¨.</p><h5 id="strategy"><a href="#strategy" class="headerlink" title="strategy"></a>strategy</h5><p>GenerationType åŒ…å«å››ç§ç­–ç•¥:</p><ul><li>TABLE,ä½¿ç”¨ç‰¹å®šçš„è¡¨æ¥å­˜å‚¨ç”Ÿæˆçš„ä¸»é”®,ä¹Ÿå°±æ˜¯è¯´ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ç§è®°å½•ä¸»é”®çš„è¡¨,ä¸€èˆ¬ä¼šåŒ…å«ä¸¤ä¸ªå­—æ®µ,ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯å­—æ®µç”Ÿæˆç­–ç•¥çš„åç§°,ç¬¬äºŒä¸ªæ˜¯IDçš„æœ€å¤§åºåˆ—å€¼.é€šå¸¸ä¼šå’Œ @TableGenerator ä¸€èµ·æ¥ä½¿ç”¨,èƒ½å¤ŸæŒ‡å®šç‰¹å®šè¡¨æ¥ç”Ÿæˆä¸»é”®,å¦‚æœä¸æŒ‡å®š,ä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªåç§°ä¸º sequence çš„è¡¨æ¥è®°å½•.</li><li>SEQUENCE,åœ¨ç‰¹å®šçš„æ•°æ®åº“,å¦‚ORACLE,ä¸æ”¯æŒè‡ªå¢ä¸»é”®,ä½†æ˜¯ä¼šæä¾›ä¸€ç§å«åšåºåˆ—çš„æ–¹å¼ç”Ÿæˆä¸»é”®,æ­¤æ—¶å°±éœ€è¦æŒ‡å®š SEQUENCE ä¸ºç”Ÿæˆä¸»é”®çš„ç­–ç•¥,å’ŒTABLEç›¸ä¼¼,é€šå¸¸ä¼šä½¿ç”¨ @SequenceGenerator ä¸€èµ·ä½¿ç”¨</li><li>IDENTITY ,é‡åˆ°å‘MYSQLèƒ½å¤Ÿè®©ä¸»é”®è‡ªå¢çš„æ•°æ®åº“,å°±å¯ä»¥æŒ‡å®šç”Ÿæˆç­–ç•¥ä¸ºIDENTITY,ç”Ÿæˆè¡¨å, Mysqlä¼šé»˜è®¤å°†è¯¥å­—æ®µè®¾ç½®ä¸º â€˜auto_incrementâ€™,</li><li>AUTO ,ä½¿ç”¨ @GeneratedValue é»˜è®¤çš„ç”Ÿæˆç­–ç•¥,æŠŠå…·ä½“ç”Ÿæˆä¸»é”®çš„è§„åˆ™äº¤ç»™æŒä¹…åŒ–å¼•æ“æ¥å®ç°,ä¹Ÿæ˜¯æˆ‘ä½¿ç”¨æœ€å¤šçš„ä¸€ç§æ–¹å¼.</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ GenerationType.TABLE æŒ‡å®šç”Ÿæˆçš„è®°å½•è¡¨,å…¶ä¸­nameå¿…é¡»,å…¶ä»–å¯é€‰</span></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.TABLE, generator = <span class="string">"roleSeq"</span>)</span><br><span class="line"><span class="meta">@TableGenerator</span>(name = <span class="string">"roleSeq"</span>, allocationSize = <span class="number">1</span>, table = <span class="string">"seq_table"</span>, pkColumnName = <span class="string">"seq_id"</span>, valueColumnName = <span class="string">"seq_count"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ SEQUENCE </span></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.SEQUENCE, generator = <span class="string">"menuSeq"</span>)</span><br><span class="line"><span class="meta">@SequenceGenerator</span>(name = <span class="string">"menuSeq"</span>, initialValue = <span class="number">1</span>, allocationSize = <span class="number">1</span>, sequenceName = <span class="string">"MENU_SEQUENCE"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ IDENTITY è¿›è¡Œè‡ªå¢</span></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">// ä½¿ç”¨AUTO,æˆ–è€…ä¸æŒ‡å®šç­–ç•¥</span></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.AUTO)</span><br><span class="line"><span class="keyword">private</span> Integer id</span><br></pre></td></tr></table></figure><h5 id="generator"><a href="#generator" class="headerlink" title="generator"></a>generator</h5><p>é€šè¿‡ä¸Šé¢å¯¹ç­–ç•¥çš„æè¿°,ä¹Ÿå°±æ˜ç™½generatorçš„ä½œç”¨,å°±æ˜¯æŒ‡å®šç‰¹å®šnameçš„Generator</p><h4 id="5-Transient"><a href="#5-Transient" class="headerlink" title="5. @Transient"></a>5. @Transient</h4><p>ä½¿ç”¨ @Transient æ³¨è§£,æ ‡æ³¨åœ¨å­—æ®µä¸Š,åœ¨JPAç”Ÿæˆè¡¨å­—æ®µæ—¶èƒ½å¤Ÿå¿½ç•¥è¯¥å­—æ®µ,è®©å­—æ®µä¸å‡ºç°åœ¨æ•°æ®åº“ä¸­.</p><h4 id="6-Embeddedå’Œ-Embeddable"><a href="#6-Embeddedå’Œ-Embeddable" class="headerlink" title="6. @Embeddedå’Œ@Embeddable"></a>6. @Embeddedå’Œ@Embeddable</h4><p>å½“å®ä½“Aå‡ºç°åœ¨å®ä½“Bä¸­,ä½†å®ä½“Aä¸éœ€è¦å•ç‹¬ç”Ÿæˆä¸€å¼ è¡¨çš„ä½¿ç”¨,ä½¿ç”¨@@Embeddedå’Œ@Embeddableæ ‡æ³¨åœ¨ç±»ä¸Š,èƒ½å¤Ÿé˜²æ­¢å®ä½“Aç”Ÿæˆæ•°æ®åº“è¡¨.</p><h4 id="7-Temporal"><a href="#7-Temporal" class="headerlink" title="7. @Temporal"></a>7. @Temporal</h4><p>ä½¿ç”¨ @Temporal æ³¨è§£ç‰¹æ®Šæ ‡è®°åœ¨éœ€è¦æŒä¹…åŒ–çš„å­—æ®µä¸Š,å¹¶ä¸”å­—æ®µç±»å‹ä¸º <code>java.util.Date</code> æˆ– <code>java.util.Calendar</code>çš„æ—¶å€™,å¯æŒ‡å®š TemporalType æ¥ç”Ÿæˆå¯¹åº”æ•°æ®åº“ä¸­çš„æ—¶é—´æ ¼å¼(java.sql.xxxx). </p><h4 id="8-ä¸€å¯¹ä¸€-ä¸€å¯¹å¤š-å¤šå¯¹å¤šå…³ç³»"><a href="#8-ä¸€å¯¹ä¸€-ä¸€å¯¹å¤š-å¤šå¯¹å¤šå…³ç³»" class="headerlink" title="8. ä¸€å¯¹ä¸€,ä¸€å¯¹å¤š,å¤šå¯¹å¤šå…³ç³»"></a>8. ä¸€å¯¹ä¸€,ä¸€å¯¹å¤š,å¤šå¯¹å¤šå…³ç³»</h4><p>åœ¨ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ä¸­,å…ä¸äº†ä¸Šè¿°å…³ç³»çš„ç”Ÿæˆ,ä¸‹é¢å°±æ¥è¯´ä¸€ä¸‹,å¦‚ä½•é’ˆå¯¹ä¸€å¯¹ä¸€å…³ç³»ã€ä¸€å¯¹å¤šå…³ç³»ã€å¤šå¯¹å¤šå…³ç³»çš„é€šç”¨è®¾ç½®,åœ¨åˆ†åˆ«å®éªŒå‰,å…ˆäº†è§£ä¸€ä¸‹ @JoinColumn çš„ä½œç”¨</p><p>æˆ‘è®¤ä¸ºçš„JoinColumnæ˜¯ç‰¹æ®Šçš„@Column,å½“éœ€è¦ä½¿ç”¨åˆ°â€œå…³ç³»â€æ—¶,éœ€è¦ä½¿ç”¨åˆ°JoinColumnæ¥æ›¿ä»£æ™®é€šçš„Columnæ³¨è§£</p><h5 id="OneToOne"><a href="#OneToOne" class="headerlink" title="OneToOne"></a>OneToOne</h5><p>ä½¿ç”¨OneToOneæ³¨è§£,æŒ‡å®šä¸¤æ–¹å…³ç³»æ˜¯ä¸€å¯¹ä¸€çš„.æ¯”å¦‚Userå’ŒStatus,Statusæ˜¯Userçš„ä¸€ä¸ªå±æ€§,åœ¨Userè¡¨ä¸­åªéœ€è®°å½•Stautsè¡¨ä¸­çš„ä¸»é”®,æ‰€ä»¥éœ€è¦åœ¨Userè¡¨(ä¸»)ä¸­å£°æ˜ä¸€ä¸ªStatus(ä»)å³å¯:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OneToOne</span>()</span><br><span class="line"><span class="meta">@JoinColumn</span>(columnDefinition = <span class="string">"INT(11)"</span>,name = <span class="string">"status_id"</span>)</span><br><span class="line"><span class="keyword">private</span> Status status;</span><br></pre></td></tr></table></figure><h5 id="OneToManyã€ManyToOne"><a href="#OneToManyã€ManyToOne" class="headerlink" title="OneToManyã€ManyToOne"></a>OneToManyã€ManyToOne</h5><p>ä½¿ç”¨ @OneToMany æˆ– @ManyToOne æ³¨è§£æ¥è¡¨ç¤ºä¸€å¯¹å¤šã€å¤šå¯¹ä¸€çš„å…³ç³».å…¸å‹çš„å¦‚Projectä¹‹äºTask,ä¸€ä¸ªProjectåŒ…å«å¤šä¸ªTask,æ‰€ä»¥Projectä¸ºOne,Taskä¸ºMany.</p><p>å¦‚æœåœ¨Project(ä¸»)ä¸­å£°æ˜Task(ä»)æ—¶,å¯ä»¥ä½¿ç”¨ OneToMany è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OneToMany</span>(cascade = CascadeType.ALL)</span><br><span class="line"><span class="meta">@JoinColumn</span>(name=<span class="string">"project_id"</span>) <span class="comment">// taskè¡¨æŒ‡å‘projectè¡¨çš„å¤–é”®</span></span><br><span class="line">Set&lt;Task&gt; tasks;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨å¤šçš„ä¸€æ–¹ä½¿ç”¨ ManyToOne æ³¨è§£,è¡¨ç¤ºå¤šå¯¹ä¸€çš„å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ManyToOne</span></span><br><span class="line"><span class="comment">// åœ¨ one çš„ä¸€æ–¹ç”Ÿæˆ nameä¸º project_id çš„å­—æ®µ,æŒ‡å‘task</span></span><br><span class="line"><span class="meta">@JoinColumn</span>(name=<span class="string">"project_id"</span>) </span><br><span class="line">Project project;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯å•ç‹¬ä½¿ç”¨ @OneToMany æˆ– @ManyToOne æ„é€ å•å‘çš„å…³ç³»,ä½†æ˜¯è¿™æ ·æœ‰ç¼ºç‚¹,æ³¨å®šæœ‰ä¸€æ–¹æ‰¾ä¸åˆ°å¦å¤–ä¸€æ–¹(åªå»ºç«‹äº†å•å‘å…³ç³»).æ‰€ä»¥ç¨³å¦¥çš„æ–¹å¼æ˜¯æ„å»ºåŒå‘å…³ç³»,åœ¨Oneå’ŒManyåŒæ–¹,ä½¿ç”¨ä¸¤ä¸ªæ³¨è§£ç›¸äº’æŒ‡å®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Projectä¸­,å…¶ä¸­mappedByæ˜¯åŒå‘å…³ç³»ä¸­å¿…é¡»è¦ä½¿ç”¨çš„å±æ€§</span></span><br><span class="line"><span class="meta">@OneToMany</span>(cascade = CascadeType.ALL,mappedBy =<span class="string">"project_id"</span>)</span><br><span class="line">Set&lt;Task&gt; tasks;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Taskä¸­</span></span><br><span class="line"><span class="meta">@ManyToOne</span></span><br><span class="line"><span class="meta">@JoinColumn</span>(name=<span class="string">"project_id"</span>)</span><br><span class="line">Project project</span><br></pre></td></tr></table></figure><h5 id="ManyToMany"><a href="#ManyToMany" class="headerlink" title="ManyToMany"></a>ManyToMany</h5><p>ä½¿ç”¨ @ManyToMany æ³¨è§£æ¥æ ‡æ³¨å¤šå¯¹å¤šå…³ç³»,æ¯”å¦‚ç”¨æˆ·å’Œè§’è‰²ä¹‹é—´å°±å¯ä»¥ç†è§£ä¸ºå¤šå¯¹å¤šçš„å…³ç³»,åŒæ–¹éœ€è¦äº’ç›¸æ‹¥æœ‰å¤šä¸ª.å¤šåœ°å¤šå…³ç³»éœ€è¦ä½¿ç”¨ä¸­é—´è¡¨æ¥ç»´æŠ¤ä¸¤æ–¹å…³ç³».å»ºç«‹å…³ç³»è¡¨ä½¿ç”¨@JoinTableæ³¨è§£æ¥æŒ‡å®šå®ç°.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Userè¡¨ä¸­</span></span><br><span class="line"><span class="meta">@JSONField</span>(name = <span class="string">"roles"</span>)</span><br><span class="line"><span class="meta">@ManyToMany</span>(mappedBy = <span class="string">"users"</span>,fetch = FetchType.EAGER,cascade = CascadeType.ALL)</span><br><span class="line"><span class="keyword">private</span> Set&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Role è¡¨ä¸­</span></span><br><span class="line"><span class="meta">@JSONField</span>(serialize = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ManyToMany</span>(cascade = CascadeType.ALL,fetch = FetchType.EAGER)</span><br><span class="line"><span class="meta">@JoinTable</span>(name = <span class="string">"r_user_role"</span>,</span><br><span class="line">        joinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"role_id"</span>)&#125;,</span><br><span class="line">        inverseJoinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"user_id"</span>)&#125;)</span><br><span class="line"><span class="keyword">private</span> List&lt;User&gt; users;</span><br></pre></td></tr></table></figure><h5 id="å…³ç³»ä½¿ç”¨æ—¶çš„å‘"><a href="#å…³ç³»ä½¿ç”¨æ—¶çš„å‘" class="headerlink" title="å…³ç³»ä½¿ç”¨æ—¶çš„å‘"></a>å…³ç³»ä½¿ç”¨æ—¶çš„å‘</h5><ol><li>åŒå‘å…³ç³»éœ€è¦åŒæ–¹éƒ½è¿›è¡Œç»´æŠ¤,å¦åˆ™ä¿å­˜ä¸ä¸Š :)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User user = one.get();</span><br><span class="line"><span class="comment">// å¤šå¯¹å¤šå…³ç³»éœ€è¦åŒå‘å…³è”ä¿å­˜æ‰èµ·ä½œç”¨</span></span><br><span class="line">user.getRoles().add(role);</span><br><span class="line">role.getUsers().add(user);</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨JSONæ—¶,å¦‚æœå‡ºç°å¾ªç¯å¼•ç”¨å¯¼å‡ºæº¢å‡ºæ—¶,åœ¨ä¸€æ–¹åŠ å…¥è®¾ç½®é˜²æ­¢åºåˆ—åŒ–</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä½¿ç”¨çš„æ˜¯FastJosn,Jacksonæœ‰ä¸åŒçš„å®ç°æ–¹å¼</span></span><br><span class="line"><span class="meta">@JSONField</span>(serialize = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ManyToMany</span>(cascade = CascadeType.ALL,fetch = FetchType.EAGER)</span><br><span class="line"><span class="meta">@JoinTable</span>(name = <span class="string">"r_user_routemeta"</span>,</span><br><span class="line">        joinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"role_id"</span>)&#125;,</span><br><span class="line">        inverseJoinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"meta_id"</span>)&#125;)</span><br><span class="line"><span class="keyword">private</span> Set&lt;RouteMeta&gt; routeMeta;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-Repository-æŸ¥è¯¢"><a href="#ä½¿ç”¨-Repository-æŸ¥è¯¢" class="headerlink" title="ä½¿ç”¨ Repository æŸ¥è¯¢"></a>ä½¿ç”¨ Repository æŸ¥è¯¢</h3><p>Repository æ˜¯ Spring Data JPA ä¸­æœ€é‡è¦çš„æ¥å£,ä½¿ç”¨å®ä½“ç±»å’Œå®ä½“ç±»ä¸­çš„ä¸»é”®IDä½œä¸ºç±»å‹å‚æ•°.å…¶ä¸­CURDRepositoryä¸ºå®ä½“ç±»æä¾›äº†å¤æ‚å¢åˆ æ”¹æŸ¥çš„å‡½æ•°.</p><h4 id="1-CrudRepositoryæ¥å£"><a href="#1-CrudRepositoryæ¥å£" class="headerlink" title="1. CrudRepositoryæ¥å£"></a>1. CrudRepositoryæ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CrudRepository</span>&lt;<span class="title">T</span>, <span class="title">ID</span>&gt; <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">T</span>, <span class="title">ID</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·æä¾›äº†ç‰¹å®šçš„Repository,æ¯”å¦‚JPARepositoryã€MongoRepository,è¿™å‡ ä¸ªéƒ½æ˜¯ç»§æ‰¿çš„ CrudRepository æ¥å£,æ ¹æ®ä¸åŒçš„æŠ€æœ¯ç‰¹æ€§æš´éœ²ä¸åŒçš„æ¥å£æ–¹æ³•.ä¸€èˆ¬ä½¿ç”¨ä¸Šç›´æ¥ç»§æ‰¿CurdRepositoryå°±å¯ä»¥å®ŒæˆåŸºæœ¬çš„å·¥ä½œ.</p><h4 id="2-PagingAndSortingRepositoryæ¥å£"><a href="#2-PagingAndSortingRepositoryæ¥å£" class="headerlink" title="2. PagingAndSortingRepositoryæ¥å£"></a>2. PagingAndSortingRepositoryæ¥å£</h4><p>å¦‚æœä½¿ç”¨åˆ†é¡µæˆ–è€…æ’åºéœ€è¦ç»§æ‰¿ PagingAndSortingRepository æ¥å£,è¿™ä¸ªæ¥å£ä¸­åŒ…å« <code>Iterable&lt;T&gt; findAll(Sort sort);</code> å’Œ <code>Page&lt;T&gt; findAll(Pageable pageable);</code>,è¿™æ ·èƒ½å¤Ÿå…·æœ‰æŸ¥è¯¢æ—¶åˆ†é¡µçš„ç‰¹æ€§</p><h4 id="3-æ¥å£ä¸­çš„åç§°æ¨å¯¼æŸ¥è¯¢"><a href="#3-æ¥å£ä¸­çš„åç§°æ¨å¯¼æŸ¥è¯¢" class="headerlink" title="3. æ¥å£ä¸­çš„åç§°æ¨å¯¼æŸ¥è¯¢"></a>3. æ¥å£ä¸­çš„åç§°æ¨å¯¼æŸ¥è¯¢</h4><ul><li>é€šè¿‡å‘½åæŸ¥è¯¢,å…·ä½“å¯æŸ¥çœ‹ç›¸å…³æ–‡æ¡£,å†™çš„éå¸¸å…¨ <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-creation" target="_blank" rel="noopener">create-query</a></li></ul><table><thead><tr><th>å…³é”®å­—</th><th>æ–¹æ³•å‘½å</th><th>sql whereå­—å¥</th></tr></thead><tbody><tr><td>And</td><td>findByNameAndPwd</td><td>where name= ? and pwd =?</td></tr><tr><td>Or</td><td>findByNameOrSex</td><td>where name= ? or sex=?</td></tr><tr><td>Is,Equals</td><td>findById,findByIdEquals</td><td>where id= ?</td></tr><tr><td>Between</td><td>findByIdBetween</td><td>where id between ? and ?</td></tr><tr><td>LessThan</td><td>findByIdLessThan</td><td>where id &lt; ?</td></tr><tr><td>LessThanEquals</td><td>findByIdLessThanEquals</td><td>where id &lt;= ?</td></tr><tr><td>GreaterThan</td><td>findByIdGreaterThan</td><td>where id &gt; ?</td></tr><tr><td>GreaterThanEquals</td><td>findByIdGreaterThanEquals</td><td>where id &gt; = ?</td></tr><tr><td>After</td><td>findByIdAfter</td><td>where id &gt; ?</td></tr><tr><td>Before</td><td>findByIdBefore</td><td>where id &lt; ?</td></tr><tr><td>IsNull</td><td>findByNameIsNull</td><td>where name is null</td></tr><tr><td>isNotNull,NotNull</td><td>findByNameNotNull</td><td>where name is not null</td></tr><tr><td>Like</td><td>findByNameLike</td><td>where name like ?</td></tr><tr><td>NotLike</td><td>findByNameNotLike</td><td>where name not like ?</td></tr><tr><td>StartingWith</td><td>findByNameStartingWith</td><td>where name like â€˜?%â€™</td></tr><tr><td>EndingWith</td><td>findByNameEndingWith</td><td>where name like â€˜%?â€™</td></tr><tr><td>Containing</td><td>findByNameContaining</td><td>where name like â€˜%?%â€™</td></tr><tr><td>OrderBy</td><td>findByIdOrderByXDesc</td><td>where id=? order by x desc</td></tr><tr><td>Not</td><td>findByNameNot</td><td>where name &lt;&gt; ?</td></tr><tr><td>In</td><td>findByIdIn(Collection&lt;?&gt; c)</td><td>where id in (?)</td></tr><tr><td>NotIn</td><td>findByIdNotIn(Collection&lt;?&gt; c)</td><td>where id not in (?)</td></tr><tr><td>True</td><td>findByAaaTue</td><td>where aaa = true</td></tr><tr><td>False</td><td>findByAaaFalse</td><td>where aaa = false</td></tr><tr><td>IgnoreCase</td><td>findByNameIgnoreCase</td><td>where UPPER(name)=UPPER(?)</td></tr></tbody></table><h4 id="4-ä½¿ç”¨-Repository-æŸ¥è¯¢å®ä¾‹"><a href="#4-ä½¿ç”¨-Repository-æŸ¥è¯¢å®ä¾‹" class="headerlink" title="4. ä½¿ç”¨ Repository æŸ¥è¯¢å®ä¾‹"></a>4. ä½¿ç”¨ Repository æŸ¥è¯¢å®ä¾‹</h4><ol><li>å£°æ˜ä¸€ä¸ªæ¥å£ç»§æ‰¿ç‰¹å®šçš„Repository</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JpaRepository ç»§æ‰¿è‡ª PagingAndSortingRepository,å…¶ä¸­ç±»å‹å‚æ•°</span></span><br><span class="line"><span class="comment"> * ç¬¬ä¸€ä¸ªæ˜¯æ“ä½œå®ä½“ç±»çš„ç±»å‹</span></span><br><span class="line"><span class="comment"> * ç¬¬äºŒä¸ªæ˜¯æ“ä½œå®ä½“ç±»çš„æ ‡è¯†ID</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>,<span class="title">Integer</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>(å¯é€‰)åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…·ä½“åç§°æ¨å¯¼æŸ¥è¯¢å¯ä»¥æŸ¥çœ‹ä¸Šé¢çš„è¡¨æ ¼</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">findByLastname</span><span class="params">(String lastname)</span></span>;</span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨@AutoWireæ³¨è§£injectåˆ°ç‰¹å®šçš„serviceä¸­è°ƒç”¨</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">UserRepository userRepository;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUserFromUserName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userRepository.findUserByName(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œ,å¢åˆ æ”¹æŸ¥åŸºæœ¬éƒ½èƒ½å¤Ÿå®ç°,å¤æ‚çš„åœ¨äºåˆ†é¡µã€å¤šæ¡ä»¶å¤æ‚æŸ¥è¯¢.</p><h4 id="5-ä½¿ç”¨-PagingAndSortingRepository-è¿›è¡Œåˆ†é¡µæŸ¥è¯¢"><a href="#5-ä½¿ç”¨-PagingAndSortingRepository-è¿›è¡Œåˆ†é¡µæŸ¥è¯¢" class="headerlink" title="5. ä½¿ç”¨ PagingAndSortingRepository è¿›è¡Œåˆ†é¡µæŸ¥è¯¢"></a>5. ä½¿ç”¨ PagingAndSortingRepository è¿›è¡Œåˆ†é¡µæŸ¥è¯¢</h4><p>å‰é¢è¯´åˆ° PagingAndSortingRepository æä¾›äº†ä¸¤ä¸ªæ–¹æ³•,ä¸€ä¸ªæ˜¯è¿”å›Iterableçš„ findAll(Sort) æ–¹æ³•,å¦ä¸€ä¸ªæ˜¯è¿”å›Pageçš„findAllæ–¹æ³•</p><ol><li>åœ¨æ²¡æœ‰å…¶ä»–æŸ¥è¯¢æ¡ä»¶çš„æƒ…å†µä¸‹,ç›´æ¥å®šä¹‰ä¸€ä¸ªPageableå˜é‡,ç„¶åä½¿ç”¨ç‰¹å®šæ–¹æ³•å³å¯:</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;Book&gt; <span class="title">findBookNoCriteria</span><span class="params">(Integer page,Integer size)</span> </span>&#123;</span><br><span class="line">    Pageable pageable = <span class="keyword">new</span> PageRequest(page, size, Sort.Direction.ASC, <span class="string">"id"</span>);</span><br><span class="line">    <span class="keyword">return</span> bookRepository.findAll(pageable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨å­˜åœ¨å¤šæ ·çš„æŸ¥è¯¢æ¡ä»¶çš„æƒ…å†µä¸‹,è¿˜éœ€è¦æ¥å£ç»§æ‰¿ <code>JpaSpecificationExecutor</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;Book&gt; <span class="title">findBookCriteria</span><span class="params">(Integer page, Integer size, <span class="keyword">final</span> BookQuery bookQuery)</span> </span>&#123;</span><br><span class="line">    Pageable pageable = <span class="keyword">new</span> PageRequest(page, size, Sort.Direction.ASC, <span class="string">"id"</span>);</span><br><span class="line">    Page&lt;Book&gt; bookPage = bookRepository.findAll(<span class="keyword">new</span> Specification&lt;Book&gt;()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Book&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder criteriaBuilder)</span> </span>&#123;</span><br><span class="line">            Predicate p1 = criteriaBuilder.equal(root.get(<span class="string">"name"</span>).as(String.class), bookQuery.getName());</span><br><span class="line">            Predicate p2 = criteriaBuilder.equal(root.get(<span class="string">"isbn"</span>).as(String.class), bookQuery.getIsbn());</span><br><span class="line">            Predicate p3 = criteriaBuilder.equal(root.get(<span class="string">"author"</span>).as(String.class), bookQuery.getAuthor());</span><br><span class="line">            query.where(criteriaBuilder.and(p1,p2,p3));</span><br><span class="line">            <span class="keyword">return</span> query.getRestriction();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,pageable);</span><br><span class="line">    <span class="keyword">return</span> bookPage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-Queryè¯­å¥æŸ¥è¯¢"><a href="#ä½¿ç”¨-Queryè¯­å¥æŸ¥è¯¢" class="headerlink" title="ä½¿ç”¨@Queryè¯­å¥æŸ¥è¯¢"></a>ä½¿ç”¨@Queryè¯­å¥æŸ¥è¯¢</h3><p>å°½ç®¡é€šè¿‡ä¸Šé¢çš„æ–¹æ³•èƒ½å¤Ÿéå¸¸æ–¹ä¾¿å¿«æ·çš„ä½¿ç”¨æŸ¥è¯¢,ä½†æ˜¯æœ‰æ—¶å€™åŒ…å«ç‰¹æ®Šå­—æ®µçš„æŸ¥è¯¢æˆ–è€…ä½¿ç”¨åç§°ç»„åˆå‡ºæ¥çš„æ–¹æ³•ååˆé•¿æœ‰ä¸‘â€¦è€Œä¸”æ‹…å¿ƒæ•ˆç‡ä½,è¿™æ—¶å€™JPAæä¾›äº†ä¸€ç§ç±»ä¼¼Hibernateçš„æ–¹æ³•,å°±æ˜¯ä½¿ç”¨@Queryè¿›è¡ŒæŸ¥è¯¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query</span>(<span class="string">"select u from User u where u.emailAddress = ?1"</span>)</span><br><span class="line"><span class="function">User <span class="title">findByEmailAddress</span><span class="params">(String emailAddress)</span></span>;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨åŸç”ŸSQLæŸ¥è¯¢,å°†Queryçš„å‚æ•°nativeQueryè®¾ç½®ä¸ºtrue</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query</span>(nativeQuery = <span class="keyword">true</span>,value = <span class="string">"select u.name from user u where u.id:id limit 1"</span>)</span><br><span class="line"><span class="function">String <span class="title">getUserNameById</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨QueryDSLè¿›è¡Œå¤æ‚æŸ¥è¯¢"><a href="#ä½¿ç”¨QueryDSLè¿›è¡Œå¤æ‚æŸ¥è¯¢" class="headerlink" title="ä½¿ç”¨QueryDSLè¿›è¡Œå¤æ‚æŸ¥è¯¢"></a>ä½¿ç”¨QueryDSLè¿›è¡Œå¤æ‚æŸ¥è¯¢</h3><p>å¦‚æœä¸Šé¢çš„æŸ¥è¯¢æ–¹å¼ä»ç„¶æ»¡è¶³ä¸äº†éœ€æ±‚,é‚£ä¹ˆå¯ä»¥å°è¯•ä½¿ç”¨QueryDSLè¿›è¡ŒæŸ¥è¯¢ <a href="http://www.querydsl.com/static/querydsl/latest/reference/html/ch02.html#jpa_integration" target="_blank" rel="noopener">QueryDSL</a></p><h4 id="1-è¿‡ç¨‹"><a href="#1-è¿‡ç¨‹" class="headerlink" title="1. è¿‡ç¨‹"></a>1. è¿‡ç¨‹</h4><ol><li>æ·»åŠ MAVENä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.querydsl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>querydsl-apt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;querydsl.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.querydsl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>querydsl-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;querydsl.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ·»åŠ APT PLUGIN --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysema.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>apt-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>process<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>target/generated-sources/java<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">processor</span>&gt;</span>com.querydsl.apt.jpa.JPAAnnotationProcessor<span class="tag">&lt;/<span class="name">processor</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>JPAAnnotationProcessor ä¼šæŸ¥æ‰¾æ‰€æœ‰çš„ Entity æ³¨è§£æ ‡æ³¨çš„å®ä½“ç±»åœ¨ç›®æ ‡è·¯å¾„ä¸‹ç”Ÿæˆ Qxxx çš„ç±».ç¬¬ä¸€æ¬¡éœ€è¦ä½¿ç”¨ maven install ç”Ÿæˆä¸€ä¸‹.</p><ol start="2"><li>ä½¿ç”¨æŸ¥è¯¢</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨å…¥ jpaQueryFactory</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> entityManager</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JPAQueryFactory <span class="title">jpaQueryFactory</span><span class="params">(EntityManager entityManager)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> JPAQueryFactory(entityManager);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨@BeanæŠŠJPAQueryFactoryæ³¨å…¥åˆ°å®¹å™¨ä¸­,ç„¶åä½¿ç”¨JpaQueryFactoryæŸ¥è¯¢.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;User&gt; <span class="title">doGetrolePerson</span><span class="params">(Integer role,<span class="keyword">boolean</span> in,List&lt;User&gt; users)</span></span>&#123;</span><br><span class="line">    QUser user = QUser.user;</span><br><span class="line">    Predicate predicate = user.isNotNull().or(user.isNull());</span><br><span class="line">    <span class="keyword">if</span>(in)&#123;</span><br><span class="line">        predicate = role == <span class="keyword">null</span> ? predicate : ExpressionUtils.and(predicate, user.roles.any().id.in(role));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        predicate = role == <span class="keyword">null</span> ? predicate : ExpressionUtils.and(predicate, user.notIn(users));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jpaQueryFactory.selectFrom(user).where(predicate).fetch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯ä½¿ç”¨åŸºæœ¬çš„QueryDSLè¿›è¡ŒæŸ¥è¯¢çš„æ–¹å¼,æ›´å¤šçš„å¢åˆ æ”¹æŸ¥çš„æ–¹æ³•å¯ä»¥å‚è€ƒä¸Šé¢å¼•ç”¨çš„æ–‡æ¡£,è¿™é‡Œä¸åœ¨è¿‡å¤šæè¿°.</p><h4 id="2-ç»“åˆæŸ¥è¯¢"><a href="#2-ç»“åˆæŸ¥è¯¢" class="headerlink" title="2. ç»“åˆæŸ¥è¯¢"></a>2. ç»“åˆæŸ¥è¯¢</h4><p>SpringDataJPA å¯¹ QueryDSL æä¾›äº†ä¸€ä¸ªé€šç”¨çš„Repository â€“ QuerydslPredicateExecutor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">QuerydslPredicateExecutor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">Optional&lt;T&gt; <span class="title">findOne</span><span class="params">(Predicate var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Iterable&lt;T&gt; <span class="title">findAll</span><span class="params">(Predicate var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Iterable&lt;T&gt; <span class="title">findAll</span><span class="params">(Predicate var1, Sort var2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Iterable&lt;T&gt; <span class="title">findAll</span><span class="params">(Predicate var1, OrderSpecifier&lt;?&gt;... var2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Iterable&lt;T&gt; <span class="title">findAll</span><span class="params">(OrderSpecifier&lt;?&gt;... var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Page&lt;T&gt; <span class="title">findAll</span><span class="params">(Predicate var1, Pageable var2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">count</span><span class="params">(Predicate var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">exists</span><span class="params">(Predicate var1)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨éœ€è¦è®©å®šä¹‰çš„Repositoryç»§æ‰¿è¿™ä¸ªQuerydslPredicateExecutor,ç„¶åè°ƒç”¨æ–¹æ³•å³å¯:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;User&gt; <span class="title">findUsers</span><span class="params">(Integer offset, Integer limit, String order, String search, Integer status, Integer sex, Integer role)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Sort sort = <span class="keyword">null</span>;</span><br><span class="line">    String propertie = order.substring(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (order.startsWith(<span class="string">"-"</span>)) &#123;</span><br><span class="line">        sort = Sort.by(propertie).descending();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (order.startsWith(<span class="string">"+"</span>)) &#123;</span><br><span class="line">        sort = Sort.by(propertie).ascending();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(offset == <span class="keyword">null</span> || limit == <span class="keyword">null</span>)&#123;</span><br><span class="line">        offset = <span class="number">1</span>;</span><br><span class="line">        limit = Integer.MAX_VALUE;</span><br><span class="line">    &#125;</span><br><span class="line">    PageRequest pageRequest = <span class="keyword">new</span> PageRequest(offset - <span class="number">1</span>, limit, sort);</span><br><span class="line">    QUser user = QUser.user;</span><br><span class="line">    com.querydsl.core.types.Predicate predicate = user.isNotNull().or(user.isNull());</span><br><span class="line">    predicate = search == <span class="keyword">null</span> ? predicate : ExpressionUtils.and(predicate, user.name.like(<span class="string">"%"</span> + search + <span class="string">"%"</span>));</span><br><span class="line">    predicate = sex == <span class="keyword">null</span> ? predicate : ExpressionUtils.and(predicate, user.sex.id.eq(sex));</span><br><span class="line">    predicate = status == <span class="keyword">null</span> ? predicate : ExpressionUtils.and(predicate, user.status.id.eq(status));</span><br><span class="line">    predicate = role == <span class="keyword">null</span> ? predicate : ExpressionUtils.and(predicate, user.roles.any().id.eq(role));</span><br><span class="line">    <span class="keyword">return</span> userRepository.findAll(predicate, pageRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springçš„Beançš„å®ä¾‹åŒ–</title>
      <link href="/2020/01/17/Spring%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E5%9B%9B%EF%BC%89/"/>
      <url>/2020/01/17/Spring%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Beançš„å®ä¾‹åŒ–"><a href="#Beançš„å®ä¾‹åŒ–" class="headerlink" title="Beançš„å®ä¾‹åŒ–"></a>Beançš„å®ä¾‹åŒ–</h1><p>åœ¨refreshæ–¹æ³•æ‰§è¡Œåˆ° <code>finishBeanFacotyInitializawtion</code> æ—¶ï¼Œåœ¨æ–¹æ³•å†…éƒ¨ä¼šæ‰§è¡Œå¯¹Beançš„å®ä¾‹åŒ–æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finishBeanFactoryInitialization</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//  ä¸ºBeanFactoyæ·»åŠ conversionService</span></span><br><span class="line">    <span class="keyword">if</span> (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp; <span class="comment">// æ˜¯å¦åŒ…å« conversionService</span></span><br><span class="line">            beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123;</span><br><span class="line">        beanFactory.setConversionService(</span><br><span class="line">                beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register a default embedded value resolver if no bean post-processor</span></span><br><span class="line">    <span class="comment">// (such as a PropertyPlaceholderConfigurer bean) registered any before:</span></span><br><span class="line">    <span class="comment">// at this point, primarily for resolution in annotation attribute values.</span></span><br><span class="line">    <span class="keyword">if</span> (!beanFactory.hasEmbeddedValueResolver()) &#123;</span><br><span class="line">        beanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°½æ—©åˆå§‹åŒ–LoadTimeWeaverAware Beanï¼Œä»¥ä¾¿å°½æ—©æ³¨å†Œå…¶è½¬æ¢å™¨ã€‚</span></span><br><span class="line">    String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, <span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">for</span> (String weaverAwareName : weaverAwareNames) &#123;</span><br><span class="line">        getBean(weaverAwareName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–æ¶ˆä½¿ç”¨ä¸´æ—¶çš„classLoader</span></span><br><span class="line">    beanFactory.setTempClassLoader(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…è®¸ç¼“å­˜æ‰€æœ‰çš„Bean Definition å…ƒæ•°æ®ï¼Œ</span></span><br><span class="line">    beanFactory.freezeConfiguration();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ‰€æœ‰å‰©ä½™çš„ï¼ˆéæ‡’åŠ è½½çš„ï¼‰å•ä¾‹çš„Bean</span></span><br><span class="line">    beanFactory.preInstantiateSingletons();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨äº <code>preInstantiateSingletons</code> æ–¹æ³•ï¼Œç”¨æ¥åˆå§‹åŒ–æ‰€æœ‰çš„å•ä¾‹Beanã€‚å®é™…ä¸Šåœ¨å‰é¢çš„getBeanè·å–weaverAwareå°±èƒ½å¤Ÿçœ‹å‡ºçœŸæ­£è°ƒç”¨è·å–å•å®ä¾‹çš„Beançš„æ–¹æ³•å°±æ˜¯ <code>getBean</code> æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preInstantiateSingletons</span><span class="params">()</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    <span class="comment">// logging ....</span></span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; beanNames = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="keyword">this</span>.beanDefinitionNames);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§¦å‘æœ‰éæ‡’åŠ è½½çš„Beançš„åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">for</span> (String beanName : beanNames) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰çš„RootBeanDefinition,æ‰€è°“çš„Rootxxxï¼Œå…¶å®å°±æ˜¯ç»Ÿä¸€çš„BeanDefinitionè§†å›¾</span></span><br><span class="line">        RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName);</span><br><span class="line">        <span class="keyword">if</span> (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isFactoryBean(beanName)) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯FactoryBeanï¼Œåˆ™ä½¿ç”¨getBeanæ—¶éœ€è¦åŠ ä¸Šå‰ç¼€ &amp;</span></span><br><span class="line">                Object bean = getBean(FACTORY_BEAN_PREFIX + beanName);</span><br><span class="line">                <span class="keyword">if</span> (bean <span class="keyword">instanceof</span> FactoryBean) &#123;</span><br><span class="line">                    <span class="keyword">final</span> FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) bean;</span><br><span class="line">                    <span class="keyword">boolean</span> isEagerInit;</span><br><span class="line">                    <span class="keyword">if</span> (System.getSecurityManager() != <span class="keyword">null</span> &amp;&amp; factory <span class="keyword">instanceof</span> SmartFactoryBean) &#123;</span><br><span class="line">                        <span class="comment">// å¦‚æœç»§æ‰¿SmartFactoryBean</span></span><br><span class="line">                        isEagerInit = AccessController.doPrivileged((PrivilegedAction&lt;Boolean&gt;)</span><br><span class="line">                                        ((SmartFactoryBean&lt;?&gt;) factory)::isEagerInit,</span><br><span class="line">                                getAccessControlContext());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        isEagerInit = (factory <span class="keyword">instanceof</span> SmartFactoryBean &amp;&amp;</span><br><span class="line">                                ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (isEagerInit) &#123;</span><br><span class="line">                    <span class="comment">// æ‰§è¡ŒgetBeanè·å–Bean</span></span><br><span class="line">                        getBean(beanName);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// æ‰§è¡ŒgetBeanè·å–Bean</span></span><br><span class="line">                getBean(beanName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§¦å‘åˆå§‹åŒ–åçš„callback...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>preInstantiateSingletons</code> ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å®ƒä¼šéå†æ‰€æœ‰çš„å·²ç»æ³¨å†Œåˆ°å®¹å™¨ä¸­çš„Beanï¼Œæœ€åä¼šé€šè¿‡ <code>getBean()</code> è¿›è¡Œå¯¹Beançš„åˆå§‹åŒ–æ“ä½œã€‚</p><p>å…¶ä¸­åˆ¤æ–­äº†å¦‚æœæ˜¯ <code>Factorybean</code> çš„æƒ…å†µä¸‹åº”è¯¥å…ˆå»æ·»åŠ ä¸€ä¸ªå‰ç¼€ â€˜&amp;â€™ ï¼Œæ‰èƒ½è·å–çœŸæ­£çš„FactoryBeançš„å®ç°ç±»çš„å¯¹è±¡Beanã€‚å¦‚æœä¸æ·»åŠ å‰ç¼€ â€˜&amp;â€™ï¼Œåˆ™ä¼šè¿”å›å®ç°ç±»ä¸­çš„getObjectæ–¹æ³•è¿”å›çš„å¯¹è±¡ã€‚</p><p>å› ä¸ºç»è¿‡åˆ†æï¼Œæ˜¯ getBean æ–¹æ³•æ˜¯è¾¾åˆ°åˆå§‹åŒ–Beanå®ä¾‹çš„ç›®çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çœ‹ getBean ä¸­æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><h2 id="getBean"><a href="#getBean" class="headerlink" title="getBean"></a>getBean</h2><p>getBeanæ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä¾æ®è°ƒç”¨é¡ºåºæ‹†å‡ºæ¥å¤§è‡´5ä¸ªå°ç« èŠ‚æ¥å±•å¼€è®²ã€‚</p><h3 id="1-getBeané€šè¿‡è°ƒç”¨doGetBeanåˆ›å»ºå®ä¾‹"><a href="#1-getBeané€šè¿‡è°ƒç”¨doGetBeanåˆ›å»ºå®ä¾‹" class="headerlink" title="1.getBeané€šè¿‡è°ƒç”¨doGetBeanåˆ›å»ºå®ä¾‹"></a>1.getBeané€šè¿‡è°ƒç”¨doGetBeanåˆ›å»ºå®ä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getBean</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> doGetBean(name, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨"><a href="#2-æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨" class="headerlink" title="2. æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨"></a>2. æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨</h3><p>è°ƒç”¨doGetBeanæ–¹æ³•åï¼Œé¦–å…ˆä¼šå…ˆä½¿ç”¨getSingletonæ–¹æ³•åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨å®ä¾‹ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹é€»è¾‘ï¼š</p><ol><li>åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ï¼Ÿ</li><li>å¦‚æœå­˜åœ¨ï¼Œå¦‚æœå½“å‰å•ä¾‹æ­£åœ¨åˆ›å»ºä¸­ï¼Œåˆ™è¯´æ˜å‡ºç°äº†å¾ªç¯å¼•ç”¨ã€‚</li><li>å¦‚æœå­˜åœ¨ï¼Œå®ä¾‹æ²¡æœ‰æ­£åœ¨åˆ›å»ºï¼Œæ²¡æœ‰å¾ªç¯å¼•ç”¨ã€‚</li><li>åªè¦ç¼“å­˜ä¸­å­˜åœ¨ï¼Œéƒ½ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„BeanInstance</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;T&gt; <span class="function">T <span class="title">doGetBean</span><span class="params">(<span class="keyword">final</span> String name, @Nullable <span class="keyword">final</span> Class&lt;T&gt; requiredType,</span></span></span><br><span class="line"><span class="function"><span class="params">        @Nullable <span class="keyword">final</span> Object[] args, <span class="keyword">boolean</span> typeCheckOnly)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    <span class="comment">// è·å¾—Beannameå­—ç¬¦ä¸²ï¼Œå› ä¸ºæœ‰FactoryBeanéœ€è¦æ·»åŠ &amp;ç¬¦å·</span></span><br><span class="line">    <span class="keyword">final</span> String beanName = transformedBeanName(name);</span><br><span class="line">    Object bean;</span><br><span class="line"></span><br><span class="line">    Object sharedInstance = getSingleton(beanName);</span><br><span class="line">    <span class="keyword">if</span> (sharedInstance != <span class="keyword">null</span> &amp;&amp; args == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">                logger.trace(<span class="string">"Returning eagerly cached instance of singleton bean '"</span> + beanName +</span><br><span class="line">                        <span class="string">"' that is not fully initialized yet - a consequence of a circular reference"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                logger.trace(<span class="string">"Returning cached instance of singleton bean '"</span> + beanName + <span class="string">"'"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        bean = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br></pre></td></tr></table></figure><h3 id="3-å¦‚æœtypeCheckOnlyä¸ºfalseï¼Œåˆ™æ ‡è®°å·²åˆ›å»º"><a href="#3-å¦‚æœtypeCheckOnlyä¸ºfalseï¼Œåˆ™æ ‡è®°å·²åˆ›å»º" class="headerlink" title="3. å¦‚æœtypeCheckOnlyä¸ºfalseï¼Œåˆ™æ ‡è®°å·²åˆ›å»º"></a>3. å¦‚æœtypeCheckOnlyä¸ºfalseï¼Œåˆ™æ ‡è®°å·²åˆ›å»º</h3><p>ä½œç”¨æ˜¯ï¼šå°†æŒ‡å®šçš„beanæ ‡è®°ä¸ºå·²åˆ›å»ºï¼Œå…è®¸beanå·¥å‚ä¼˜åŒ–å…¶ç¼“å­˜ä»¥é‡å¤åˆ›å»ºæŒ‡å®šçš„beanã€‚</p><h3 id="4-è·å–depend-onçš„Beanï¼Œå…ˆå¯¹å…¶è¿›è¡Œregisterå’Œå®ä¾‹åŒ–"><a href="#4-è·å–depend-onçš„Beanï¼Œå…ˆå¯¹å…¶è¿›è¡Œregisterå’Œå®ä¾‹åŒ–" class="headerlink" title="4. è·å–depend-onçš„Beanï¼Œå…ˆå¯¹å…¶è¿›è¡Œregisterå’Œå®ä¾‹åŒ–"></a>4. è·å–depend-onçš„Beanï¼Œå…ˆå¯¹å…¶è¿›è¡Œregisterå’Œå®ä¾‹åŒ–</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ depend-on çš„å†…å®¹æ˜¯ä½¿ç”¨ <code>@DependsOn</code> æ³¨è§£æŒ‡å®šçš„BeanNameï¼ˆæ³¨è§£æ–¹å¼ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å¾—RootBeanDefinition</span></span><br><span class="line"><span class="keyword">final</span> RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);</span><br><span class="line"><span class="comment">// æ£€æŸ¥mergeåçš„beanDefinition</span></span><br><span class="line">checkMergedBeanDefinition(mbd, beanName, args);</span><br><span class="line"><span class="comment">// ç¡®ä¿å½“å‰beanä¾èµ–çš„beançš„åˆå§‹åŒ–ã€‚</span></span><br><span class="line">String[] dependsOn = mbd.getDependsOn();</span><br><span class="line"><span class="keyword">if</span> (dependsOn != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (String dep : dependsOn) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isDependent(beanName, dep)) &#123;</span><br><span class="line">            <span class="comment">// throw exception ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å…ˆregistr ä¾èµ–çš„Bean</span></span><br><span class="line">        registerDependentBean(dep, beanName);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å¯¹æ¯ä¸€ä¸ªdepè¿›è¡Œå…ˆè¡Œçš„å®ä¾‹åŒ–</span></span><br><span class="line">            getBean(dep);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">            <span class="comment">// throw exception ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-è°ƒç”¨createBeanåˆ›å»ºBeanå®ä¾‹"><a href="#5-è°ƒç”¨createBeanåˆ›å»ºBeanå®ä¾‹" class="headerlink" title="5.è°ƒç”¨createBeanåˆ›å»ºBeanå®ä¾‹"></a>5.è°ƒç”¨createBeanåˆ›å»ºBeanå®ä¾‹</h3><p>åœ¨ä½¿ç”¨createBeanåˆ›å»ºBeanæ—¶ï¼Œä¼šé€šè¿‡ <code>Object bean = resolveBeforeInstantiation(beanName, mbdToUse);</code>æ¥å¤„ç†åˆå§‹åŒ–Beanå‰ç½®æ–¹æ³•è§¦å‘AOPçš„åŠŸèƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">resolveBeforeInstantiation</span><span class="params">(String beanName, RootBeanDefinition mbd)</span> </span>&#123;</span><br><span class="line">    Object bean = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (!Boolean.FALSE.equals(mbd.beforeInstantiationResolved)) &#123;</span><br><span class="line">        <span class="comment">// Make sure bean class is actually resolved at this point.</span></span><br><span class="line">        <span class="keyword">if</span> (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) &#123;</span><br><span class="line">            Class&lt;?&gt; targetType = determineTargetType(beanName, mbd);</span><br><span class="line">            <span class="keyword">if</span> (targetType != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// æ‰§è¡Œå‰ç½®æ–¹æ³•ï¼Œè·å–ä»£ç†Bean</span></span><br><span class="line">                bean = applyBeanPostProcessorsBeforeInstantiation(targetType, beanName);</span><br><span class="line">                <span class="keyword">if</span> (bean != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    bean = applyBeanPostProcessorsAfterInitialization(bean, beanName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mbd.beforeInstantiationResolved = (bean != <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">applyBeanPostProcessorsBeforeInstantiation</span><span class="params">(Class&lt;?&gt; beanClass, String beanName)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (BeanPostProcessor bp : getBeanPostProcessors()) &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ EnableAspectJAutoProxy æ³¨è§£ï¼Œå°†AbstractAutoProxyCreator import è¿›æ¥ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥åœ¨è¿™é‡Œå¯ä»¥è°ƒç”¨ AbstractAutoProxyCreatoråç½®çš„å¤„ç†å™¨æ–¹æ³•ï¼Œæ¥å®ç°AOPåŠŸèƒ½</span></span><br><span class="line">        <span class="keyword">if</span> (bp <span class="keyword">instanceof</span> InstantiationAwareBeanPostProcessor) &#123;</span><br><span class="line">            InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp;</span><br><span class="line">            Object result = ibp.postProcessBeforeInstantiation(beanClass, beanName);</span><br><span class="line">            <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInstantiation</span><span class="params">(Class&lt;?&gt; beanClass, String beanName)</span> </span>&#123;</span><br><span class="line">    Object cacheKey = getCacheKey(beanClass, beanName); <span class="comment">//è·å¾—beanClass</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasLength(beanName) || !<span class="keyword">this</span>.targetSourcedBeans.contains(beanName)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.advisedBeans.containsKey(cacheKey)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isInfrastructureClass(beanClass) || shouldSkip(beanClass, beanName)) &#123;<span class="comment">// å¦‚æœæ˜¯ä¸€ä¸ªåŸºç¡€è®¾æ–½çš„ç±» æˆ–è€…æ˜¯ä¸€ä¸ªoriginal instance</span></span><br><span class="line">            <span class="keyword">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE); <span class="comment">//æ·»åŠ åˆ°advisedBeansé‡Œé¢</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰è‡ªå®šä¹‰çš„ TargetSource</span></span><br><span class="line">    <span class="comment">// æŠ‘åˆ¶ç›®æ ‡Beançš„ä¸å¿…è¦çš„é»˜è®¤å®ä¾‹åŒ–</span></span><br><span class="line">    <span class="comment">// TargetSourceå°†ä»¥è‡ªå®šä¹‰æ–¹å¼å¤„ç†ç›®æ ‡å®ä¾‹ã€‚</span></span><br><span class="line">    TargetSource targetSource = getCustomTargetSource(beanClass, beanName); <span class="comment">//è·å¾—targetSource</span></span><br><span class="line">    <span class="keyword">if</span> (targetSource != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasLength(beanName)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.targetSourcedBeans.add(beanName);</span><br><span class="line">        &#125;</span><br><span class="line">        Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(beanClass, beanName, targetSource);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆä»£ç†</span></span><br><span class="line">        Object proxy = createProxy(beanClass, beanName, specificInterceptors, targetSource); <span class="comment">//åˆ›å»ºä»£ç†ç±»</span></span><br><span class="line">        <span class="keyword">this</span>.proxyTypes.put(cacheKey, proxy.getClass());</span><br><span class="line">        <span class="comment">// è¿”å›ç”Ÿæˆçš„ä»£ç†Bean</span></span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå­˜åœ¨éœ€è¦åˆ›å»ºProxyä»£ç†Beanï¼Œåˆ™å…ˆå»åˆ›å»ºä»£ç†Beanï¼Œåœ¨åˆ›å»ºå®Œåï¼Œåˆ™ä¼šå¼€å§‹è°ƒç”¨ <code>doCreateBean</code> æ–¹æ³•åˆ›å»ºBeanå®ä¾‹ã€‚</p><p>æ¥ç€è°ƒç”¨ <code>Object beanInstance = doCreateBean(beanName, mbdToUse, args);</code> åˆ›å»ºå®ä¾‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªObjectçš„ç±»å‹çš„beanInstance</p><p>doCreateBeanè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒé•¿ï¼Œå¤§è‡´èƒ½é€šè¿‡è¿™å‡ æ­¥å®Œæˆè¿™ä¸ªæ–¹æ³•ï¼›</p><ol><li>ä½¿ç”¨ <code>createBeanInstance</code>  åˆ›å»ºä¸€ä¸ªåŒ…è£…Bean</li><li>å…è®¸<code>MergedBeanPostProcessor</code>ä½¿ç”¨åç½®æ–¹æ³•å¤„ç†åŒ…è£…åçš„Bean</li><li>å¦‚æœ <code>allowCircularReferences</code> å±æ€§ä¸ºtrueï¼Œåˆ™å…ˆè·å– è¾¾åˆ°è¿™ä¸ªBeançš„æ—©æœŸçš„ref ï¼Œç”¨æ¥ <strong>é˜²æ­¢Beanåœ¨ç”Ÿæˆæ—¶å¾ªç¯å¼•ç”¨</strong> çš„é—®é¢˜ï¼Œåé¢ä¼šè¯¦ç»†è®²è¿™é‡Œæ˜¯å¦‚æœè·å–æ—©æœŸçš„refåº”ç”¨ï¼Œå’Œåˆæ˜¯å¦‚ä½•é˜²æ­¢Beançš„å¾ªç¯åº”ç”¨çš„é—®é¢˜ã€‚</li><li>é€šè¿‡ <code>populateBean</code> æ–¹æ³•ä¸ºBeanè¿›è¡Œèµ‹å€¼ï¼ŒåŒ…æ‹¬ä¾èµ–ï¼ï¼</li><li>é€šè¿‡ <code>initializeBean</code> æ–¹æ³•ï¼Œæ‰§è¡Œå„ç§åˆå§‹åŒ–æ–¹æ³•å’Œå‰ã€åç½®æ–¹æ³•ã€‚</li><li>é€šè¿‡ä¸‰çº§ç¼“å­˜æœºåˆ¶ï¼Œç”¨æ¥é˜²æ­¢å‡ºç°å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</li><li>æ³¨å†ŒBeanä¸ºä¸€æ¬¡æ€§çš„</li></ol><h4 id="createBeanInstance-åˆ›å»ºä¸€ä¸ªåŒ…è£…Bean"><a href="#createBeanInstance-åˆ›å»ºä¸€ä¸ªåŒ…è£…Bean" class="headerlink" title="createBeanInstance åˆ›å»ºä¸€ä¸ªåŒ…è£…Bean"></a>createBeanInstance åˆ›å»ºä¸€ä¸ªåŒ…è£…Bean</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> BeanWrapper <span class="title">createBeanInstance</span><span class="params">(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//.....çœç•¥éƒ¨åˆ†</span></span><br><span class="line">    <span class="comment">// Shortcut when re-creating the same bean...</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™é‡ŒæŒ‡çš„ShortCutçš„å«ä¹‰æ˜¯å½“å¤šæ¬¡æ„å»ºåŒä¸€ä¸ª bean æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªShortcutï¼Œ</span></span><br><span class="line"><span class="comment">     * ä¹Ÿå°±æ˜¯è¯´ä¸åœ¨éœ€è¦æ¯æ¬¡æ¨æ–­åº”è¯¥ä½¿ç”¨å“ªç§æ–¹å¼æ„é€ bean</span></span><br><span class="line"><span class="comment">     * æ¯”å¦‚åœ¨å¤šæ¬¡æ„å»ºåŒä¸€ä¸ªprototypeç±»å‹çš„ bean æ—¶ï¼Œå°±å¯ä»¥èµ°æ­¤å¤„çš„Shortcut</span></span><br><span class="line"><span class="comment">     * è¿™é‡Œçš„ resolved å’Œ autowireNecessary å°†ä¼šåœ¨ bean ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­è¢«è®¾ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">boolean</span> resolved = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">boolean</span> autowireNecessary = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (args == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mbd.constructorArgumentLock) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mbd.resolvedConstructorOrFactoryMethod != <span class="keyword">null</span>) &#123;</span><br><span class="line">                resolved = <span class="keyword">true</span>;</span><br><span class="line">                autowireNecessary = mbd.constructorArgumentsResolved;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœå·²ç»åˆ›å»ºè¿‡äº†</span></span><br><span class="line">    <span class="keyword">if</span> (resolved) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä»¥è§£ææ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (autowireNecessary) &#123;</span><br><span class="line">            <span class="keyword">return</span> autowireConstructor(beanName, mbd, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> instantiateBean(beanName, mbd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Candidate constructors for autowiring?</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯é€šè¿‡æ„é€ å‡½æ•°æ¥è‡ªåŠ¨æ³¨å…¥çš„</span></span><br><span class="line">    Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName);</span><br><span class="line">    <span class="keyword">if</span> (ctors != <span class="keyword">null</span> || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR ||</span><br><span class="line">            mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) &#123;</span><br><span class="line">        <span class="keyword">return</span> autowireConstructor(beanName, mbd, ctors, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Preferred constructors for default construction?</span></span><br><span class="line">    ctors = mbd.getPreferredConstructors();</span><br><span class="line">    <span class="keyword">if</span> (ctors != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> autowireConstructor(beanName, mbd, ctors, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰ç‰¹æ®Šå¤„ç†ï¼Œä½¿ç”¨æ— å‚æ•°æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">return</span> instantiateBean(beanName, mbd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨é»˜è®¤çš„æ— å‚æ•°æ„é€ èµ·ï¼Œä¼šè°ƒç”¨<code>beanInstance = getInstantiationStrategy().instantiate(mbd, beanName, parent);</code> è·å–ä½¿ç”¨åå°„ç”Ÿæˆçš„å®ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æµ‹ bean é…ç½®ä¸­æ˜¯å¦é…ç½®äº† lookup-method æˆ– replace-method</span></span><br><span class="line"><span class="comment">// å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„JDKä»£ç†ç”Ÿæˆå¯¹è±¡ï¼Œå¦åˆ™ä½¿ç”¨CGlibä»£ç†</span></span><br><span class="line"><span class="keyword">if</span> (!bd.hasMethodOverrides()) &#123;</span><br><span class="line"><span class="comment">// çœç•¥ä»£ç ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–</span></span><br><span class="line">    <span class="keyword">return</span> BeanUtils.instantiateClass(constructorToUse);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¿…é¡»ç”ŸæˆCGLIBå­ç±»</span></span><br><span class="line">    <span class="keyword">return</span> instantiateWithMethodInjection(bd, beanName, owner);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çŸ¥é“æœ€åä½¿ç”¨Constructor.newInstanceåˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚</p><h4 id="å…ˆç¼“å­˜æ—©æœŸçš„å®ä¾‹"><a href="#å…ˆç¼“å­˜æ—©æœŸçš„å®ä¾‹" class="headerlink" title="å…ˆç¼“å­˜æ—©æœŸçš„å®ä¾‹"></a>å…ˆç¼“å­˜æ—©æœŸçš„å®ä¾‹</h4><p>Springä¸­å­˜åœ¨ä¸‰å±‚ç¼“å­˜ï¼Œåˆ†åˆ«ä¸ºç¬¬ä¸€çº§çš„ <code>singletonObjects</code> ã€ç¬¬äºŒçº§çš„ <code>earlySingletonObjects</code> ã€ç¬¬ä¸‰çº§çš„<code>singletonFactories</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache of singleton objects: bean name to bean instance. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">256</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Cache of singleton factories: bean name to ObjectFactory. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Cache of early singleton objects: bean name to bean instance. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼ŒSpringå¦‚ä½•ä¾é è¿™ä¸‰çº§ç¼“å­˜æ¥é˜²æ­¢å¾ªç¯å¼•ç”¨ï¼ˆcircular referencesï¼‰çš„ä½œç”¨çš„å‘¢ï¼Ÿå…ˆé€šè¿‡ä¸‹é¢çš„å›¾ç‰‡æ¥ç®€å•äº†è§£ä¸‹ï¼Œå½“å‘ç”Ÿå¾ªç¯å¼•ç”¨æ—¶ï¼ŒSpringå¦‚ä½•ä½¿ç”¨ä¸‰çº§ç¼“å­˜çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/Spring%E5%BE%AA%E7%8E%AF%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B2.png" alt="å›¾1"></p><p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå¯¹è±¡Aä¾èµ–äºå¯¹è±¡Bï¼Œè€Œå¯¹è±¡Bä¾èµ–å¯¹è±¡Açš„æƒ…å†µã€‚ä¸‹é¢æ ¹æ®å›¾ä¸­å„èŠ‚ç‚¹æƒ…å†µæ¥å…·ä½“åˆ†æä»£ç çš„å®ç°ï¼š</p><h5 id="1-å®ä¾‹åŒ–Aï¼Œå‘ç°ä¾èµ–B"><a href="#1-å®ä¾‹åŒ–Aï¼Œå‘ç°ä¾èµ–B" class="headerlink" title="1. å®ä¾‹åŒ–Aï¼Œå‘ç°ä¾èµ–B"></a>1. å®ä¾‹åŒ–Aï¼Œå‘ç°ä¾èµ–B</h5><p>åœ¨åˆå§‹åŒ–Açš„è¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨ populateBean æ–¹æ³•è¿›è¡Œå±æ€§çš„èµ‹å€¼ï¼Œå…¶ä¸­ AutoWired çš„ç±»å‹æ¥åˆ†åˆ«å¤„ç†ï¼ˆBy Name è¿˜æ˜¯ By Typeï¼‰,<br>ä½†ä¸ç®¡æ˜¯å“ªä¸ªç±»å‹ï¼Œæœ€åéƒ½ä¼šä½¿ç”¨ getBean æ¥å…ˆè·å–ä¾èµ–ã€‚</p><h5 id="2-è·å–Bï¼Œå°†Aæ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­"><a href="#2-è·å–Bï¼Œå°†Aæ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­" class="headerlink" title="2. è·å–Bï¼Œå°†Aæ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­"></a>2. è·å–Bï¼Œå°†Aæ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­</h5><p>å…¶å®åœ¨è¿›è¡ŒAçš„å±æ€§èµ‹å€¼å‰ï¼Œå°±å·²ç»é€šè¿‡ <code>doCreateBean</code> æ–¹æ³•ä¸­çš„ <code>addSingletonFactory</code> æ–¹æ³•å°†Aæ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> earlySingletonExposure = (mbd.isSingleton() &amp;&amp; <span class="keyword">this</span>.allowCircularReferences &amp;&amp;</span><br><span class="line">isSingletonCurrentlyInCreation(beanName));</span><br><span class="line">    <span class="comment">// å¦‚æœ allowCircularReferences ä¸ºtrue</span></span><br><span class="line"><span class="keyword">if</span> (earlySingletonExposure) &#123;</span><br><span class="line">    <span class="comment">// log.....</span></span><br><span class="line">    <span class="comment">// æ”¾åˆ°ç¬¬ä¸‰çº§çš„singletonFactoryé‡Œ</span></span><br><span class="line">    addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¬¬ä¸‰çº§ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯SingleFactory</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addSingletonFactory</span><span class="params">(String beanName, ObjectFactory&lt;?&gt; singletonFactory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>.singletonObjects) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå¯¹è±¡æ²¡æœ‰ç”Ÿæˆè¿‡</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.singletonObjects.containsKey(beanName)) &#123;</span><br><span class="line">        <span class="comment">// æ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­ï¼ŒåŒæ—¶å¦‚æœäºŒçº§ç¼“å­˜ä¸­å­˜åœ¨ï¼Œç§»é™¤æ‰</span></span><br><span class="line">            <span class="keyword">this</span>.singletonFactories.put(beanName, singletonFactory);</span><br><span class="line">            <span class="keyword">this</span>.earlySingletonObjects.remove(beanName);</span><br><span class="line">            <span class="keyword">this</span>.registeredSingletons.add(beanName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-å®ä¾‹åŒ–Bï¼Œå‘ç°ä¾èµ–A"><a href="#3-å®ä¾‹åŒ–Bï¼Œå‘ç°ä¾èµ–A" class="headerlink" title="3. å®ä¾‹åŒ–Bï¼Œå‘ç°ä¾èµ–A"></a>3. å®ä¾‹åŒ–Bï¼Œå‘ç°ä¾èµ–A</h5><p>åœ¨ä¸Šä¸€æ­¥ä¸­ï¼ŒAä¾èµ–Bï¼Œä¼šè°ƒç”¨<code>getBean</code>å…ˆå»è·å–Bï¼Œä½†åŒæ ·åœ¨<code>doCreateBean</code> æ–¹æ³•ä¸­çš„ <code>populateBean</code> æ–¹æ³•ä¸­åŒæ ·ä¼šè°ƒç”¨ <code>getBean</code> å…ˆå»è·å–ä¾èµ–Aã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Object sharedInstance = getSingleton(beanName);</span><br><span class="line"><span class="keyword">if</span> (sharedInstance != <span class="keyword">null</span> &amp;&amp; args == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">// log....</span></span><br><span class="line"><span class="comment">// é€šè¿‡getObjectForBeanInstanceè·å–Beanï¼Œå®Œæˆå®ä¾‹åŒ–</span></span><br><span class="line">    bean = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡getSingletonæ–¹æ³•ä»ä¸‰çº§ç¼“å­˜è·å–beanï¼Œå¦‚æœæˆåŠŸçš„åœ¨ç¬¬ä¸‰çº§ç¼“å­˜ä¸­æ‰¾åˆ°Beanï¼Œåˆ™ç§»é™¤ç¬¬ä¸‰çº§ç¼“å­˜ä¸­çš„Beanï¼Œå¹¶æ”¾åˆ°äºŒçº§ç¼“å­˜ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">getSingleton</span><span class="params">(String beanName, <span class="keyword">boolean</span> allowEarlyReference)</span> </span>&#123;</span><br><span class="line">    Object singletonObject = <span class="keyword">this</span>.singletonObjects.get(beanName);</span><br><span class="line">    <span class="keyword">if</span> (singletonObject == <span class="keyword">null</span> &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>.singletonObjects) &#123;</span><br><span class="line">            singletonObject = <span class="keyword">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">            <span class="keyword">if</span> (singletonObject == <span class="keyword">null</span> &amp;&amp; allowEarlyReference) &#123;</span><br><span class="line">                ObjectFactory&lt;?&gt; singletonFactory = <span class="keyword">this</span>.singletonFactories.get(beanName);</span><br><span class="line">                <span class="keyword">if</span> (singletonFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    singletonObject = singletonFactory.getObject();</span><br><span class="line">                    <span class="comment">// å¦‚æœä¸‰çº§ç¼“å­˜ä¸­æœ‰beanï¼Œåˆ™æ”¾åˆ°äºŒçº§ç¼“å­˜ä¸­</span></span><br><span class="line">                    <span class="keyword">this</span>.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line">                    <span class="keyword">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> singletonObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-å®ä¾‹åŒ–å®Œæˆï¼Œå°†Bæ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­"><a href="#4-å®ä¾‹åŒ–å®Œæˆï¼Œå°†Bæ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­" class="headerlink" title="4. å®ä¾‹åŒ–å®Œæˆï¼Œå°†Bæ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­"></a>4. å®ä¾‹åŒ–å®Œæˆï¼Œå°†Bæ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­</h5><p>åœ¨è°ƒç”¨<code>doGetBean</code>æ–¹æ³•æ—¶ï¼Œä¼šé€šè¿‡ <code>getSingleton</code>æ–¹æ³•ä¸­çš„<code>addSingleton</code>å°†å®ä¾‹æ·»åŠ åˆ°ä¸€çº§ç¼“å­˜ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sharedInstance = getSingleton(beanName, () -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å‡†å¤‡å¥½åï¼Œè¿›è¡Œåˆ›å»ºå½“å‰Beanå®ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åœ¨<code>getSingleton</code>ä¸­è°ƒç”¨äº†<code>addSingleton(beanName, singletonObject)</code>,å°†å®Œæˆçš„å®ä¾‹æ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addSingleton</span><span class="params">(String beanName, Object singletonObject)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>.singletonObjects) &#123;</span><br><span class="line">        <span class="keyword">this</span>.singletonObjects.put(beanName, singletonObject);</span><br><span class="line">        <span class="keyword">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">        <span class="keyword">this</span>.earlySingletonObjects.remove(beanName);</span><br><span class="line">        <span class="keyword">this</span>.registeredSingletons.add(beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="5-è¿”å›Açš„åˆ›å»ºè¿‡ç¨‹ï¼Œç»§ç»­åˆ›å»ºA"><a href="#5-è¿”å›Açš„åˆ›å»ºè¿‡ç¨‹ï¼Œç»§ç»­åˆ›å»ºA" class="headerlink" title="5. è¿”å›Açš„åˆ›å»ºè¿‡ç¨‹ï¼Œç»§ç»­åˆ›å»ºA"></a>5. è¿”å›Açš„åˆ›å»ºè¿‡ç¨‹ï¼Œç»§ç»­åˆ›å»ºA</h5><p>æœ€ååˆ›å»ºå®ŒæˆAåï¼ŒåŒæ ·ä¼šå°†Aæ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€‚è‡³æ­¤å¯¹è±¡Aï¼Œå¯¹è±¡Bå…¨éƒ¨åˆ›å»ºå®Œæˆã€‚åˆ©ç”¨äº†ä¸‰çº§ç¼“å­˜æœºåˆ¶é¿å…äº†å¾ªç¯å¼•ç”¨ã€‚</p><h4 id="populateBean-æ‰§è¡ŒBeançš„åˆå§‹åŒ–"><a href="#populateBean-æ‰§è¡ŒBeançš„åˆå§‹åŒ–" class="headerlink" title="populateBean æ‰§è¡ŒBeançš„åˆå§‹åŒ–"></a>populateBean æ‰§è¡ŒBeançš„åˆå§‹åŒ–</h4><p>åœ¨ä¸Šä¸€èŠ‚ä¸­æåˆ°äº†ï¼Œåˆå§‹åŒ–å¯¹è±¡æ—¶ï¼Œéœ€è¦è°ƒç”¨<code>populateBean(beanName, mbd, instanceWrapper)</code>è¯¥æ–¹æ³•æ¥è¾¾åˆ°å±æ€§å€¼çš„å¡«å……ã€‚</p><p>å¿½ç•¥ <code>BeanPostProcessor</code>åç½®å¤„ç†å™¨ï¼Œé‚£ä¹ˆå®é™…ä¸Šæ­¥éª¤æ¯”è¾ƒç®€å•æ˜äº†ï¼š</p><ol><li>å¦‚æœä¸å­˜åœ¨å±æ€§å€¼ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œè·³è¿‡è¿™ä¸ªæ–¹æ³•ã€‚</li><li>å¦‚æœå­˜åœ¨ï¼Œå…ˆè·å¾—æ‰€æœ‰çš„å±æ€§å€¼ï¼Œä¾æ®AutoWiredå±æ€§ï¼Œå°†ä¾èµ–é¡¹æ³¨å…¥åˆ°å®¹å™¨ä¸­</li><li>æœ€åè¿›è¡ŒçœŸæ­£çš„å±æ€§å¡«å……</li></ol><h5 id="1-æ£€æŸ¥æ˜¯å¦å­˜åœ¨å±æ€§"><a href="#1-æ£€æŸ¥æ˜¯å¦å­˜åœ¨å±æ€§" class="headerlink" title="1. æ£€æŸ¥æ˜¯å¦å­˜åœ¨å±æ€§"></a>1. æ£€æŸ¥æ˜¯å¦å­˜åœ¨å±æ€§</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (bw == <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (mbd.hasPropertyValues()) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(</span><br><span class="line">      mbd.getResourceDescription(), beanName, <span class="string">"Cannot apply property values to null instance"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰ç›´æ¥è·³è¿‡</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-ä¾æ®ByNameè¿˜æ˜¯ByTypeè¿›è¡Œå±æ€§çš„æ³¨å…¥"><a href="#2-ä¾æ®ByNameè¿˜æ˜¯ByTypeè¿›è¡Œå±æ€§çš„æ³¨å…¥" class="headerlink" title="2.ä¾æ®ByNameè¿˜æ˜¯ByTypeè¿›è¡Œå±æ€§çš„æ³¨å…¥"></a>2.ä¾æ®ByNameè¿˜æ˜¯ByTypeè¿›è¡Œå±æ€§çš„æ³¨å…¥</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å¾—å±æ€§</span></span><br><span class="line">PropertyValues pvs = (mbd.hasPropertyValues() ? mbd.getPropertyValues() : <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">// è·å¾—autowiredç±»å‹ï¼ˆby type è¿˜æ˜¯ by nameï¼‰æ ¸å¿ƒæ˜¯pvs.add(propertyName, bean); è·å¾—é€‚å½“çš„beanå½“é“pvsä¸­</span></span><br><span class="line"><span class="keyword">int</span> resolvedAutowireMode = mbd.getResolvedAutowireMode();</span><br><span class="line"><span class="keyword">if</span> (resolvedAutowireMode == AUTOWIRE_BY_NAME || resolvedAutowireMode == AUTOWIRE_BY_TYPE) &#123;</span><br><span class="line">  MutablePropertyValues newPvs = <span class="keyword">new</span> MutablePropertyValues(pvs);</span><br><span class="line">  <span class="comment">// å¦‚æœé€‚ç”¨ï¼ŒæŒ‰åç§°æ·»åŠ åŸºäºè‡ªåŠ¨è£…é…çš„å±æ€§å€¼ã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (resolvedAutowireMode == AUTOWIRE_BY_NAME) &#123;</span><br><span class="line">    autowireByName(beanName, mbd, bw, newPvs);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœé€‚ç”¨ï¼ŒæŒ‰ç±»å‹æ·»åŠ åŸºäºè‡ªåŠ¨è£…é…çš„å±æ€§å€¼ã€‚.</span></span><br><span class="line">  <span class="keyword">if</span> (resolvedAutowireMode == AUTOWIRE_BY_TYPE) &#123;</span><br><span class="line">    <span class="comment">// å…¶ä¸­resolveDependencyåŒ…å«JSR330ä¸­çš„Injectæ–¹æ³•</span></span><br><span class="line">    autowireByType(beanName, mbd, bw, newPvs);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä½†æ˜¯ä¸ç®¡æ˜¯ByTypeè¿˜æ˜¯ByNameæœ€åéƒ½æ˜¯è°ƒç”¨getBeanæ–¹æ³•å…ˆè·å–å±æ€§ä¾èµ–Bean</span></span><br><span class="line">  pvs = newPvs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ® <code>resolvedAutowireMode</code> çš„å€¼çš„ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„è£…é…æ–¹å¼</p><ul><li>æŒ‰åç§°æ³¨å…¥ï¼Œä½¿ç”¨@Autowiredé»˜è®¤çš„æ–¹å¼</li><li>æŒ‰ç±»å‹æ³¨å…¥ï¼Œä½¿ç”¨@Resourceæˆ–è€…ä½¿ç”¨JSR330æ ‡å‡†ä¸­çš„@Injectæ³¨è§£çš„é»˜è®¤æ–¹å¼</li></ul><p>ä½†æ˜¯ï¼Œä¸ç®¡ä¾èµ–å“ªç§æ–¹å¼è¿›è¡Œè£…é…ï¼Œæœ€åéƒ½ä¼šä½¿ç”¨getBeanæ¥è·å–å±æ€§ä¾èµ–ï¼Œè£…é…åˆ°å®¹å™¨ä¸­ï¼Œå¹¶å°†å€¼æ”¾åˆ° <code>newPvs</code> ç­‰å¾…å¡«å……ã€‚</p><h5 id="3-å±æ€§å¡«å……"><a href="#3-å±æ€§å¡«å……" class="headerlink" title="3.å±æ€§å¡«å……"></a>3.å±æ€§å¡«å……</h5><p>æœ€åé€šè¿‡ä½¿ç”¨ <code>applyPropertyValues</code> æ–¹æ³•å®ç°å±æ€§çš„å¡«å……ï¼š</p><p>ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœpvsæ˜¯ç©ºçš„ï¼Œåˆ™ç›´æ¥è¿”å›</li><li>å¦åˆ™åˆ›å»ºä¸€ä¸ª<code>deep copy</code>ï¼Œç”¨äºè§£å†³æ‰€æœ‰å¯¹å€¼çš„å¼•ç”¨ï¼Œå¯¹æœªè¢«è§£æçš„å…ˆè§£æ&amp;&amp;å·²è§£æçš„ç›´æ¥åŠ å…¥<code>deepCopy</code>ä¸­ã€‚</li><li>è·å–åˆ° <code>deepCopy</code> åï¼Œä½¿ç”¨ <code>setPropertyValues</code> æ·»åŠ åˆ°<code>BeanWrapper</code>ä¸­</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyPropertyValues</span><span class="params">(String beanName, BeanDefinition mbd, BeanWrapper bw, PropertyValues pvs)</span> </span>&#123;</span><br><span class="line"><span class="comment">// å¦‚æœpvså†…å®¹æ˜¯ç©ºçš„ï¼Œåˆ™ç›´æ¥return</span></span><br><span class="line"><span class="keyword">if</span> (pvs.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®¾ç½® SecurityContextProvider</span></span><br><span class="line"><span class="keyword">if</span> (System.getSecurityManager() != <span class="keyword">null</span> &amp;&amp; bw <span class="keyword">instanceof</span> BeanWrapperImpl) &#123;</span><br><span class="line">((BeanWrapperImpl) bw).setSecurityContext(getAccessControlContext());</span><br><span class="line">&#125;</span><br><span class="line">MutablePropertyValues mpvs = <span class="keyword">null</span>;</span><br><span class="line">List&lt;PropertyValue&gt; original;</span><br><span class="line"><span class="keyword">if</span> (pvs <span class="keyword">instanceof</span> MutablePropertyValues) &#123;</span><br><span class="line">mpvs = (MutablePropertyValues) pvs;</span><br><span class="line"><span class="comment">// å·²ç»æ˜¯è½¬åŒ–è¿‡çš„</span></span><br><span class="line"><span class="keyword">if</span> (mpvs.isConverted()) &#123;</span><br><span class="line"><span class="comment">// Shortcut: use the pre-converted values as-is.</span></span><br><span class="line"><span class="comment">// ç…§åŸæ ·ä½¿ç”¨é¢„å…ˆè½¬æ¢çš„å€¼</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">bw.setPropertyValues(mpvs);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">original = mpvs.getPropertyValueList(); <span class="comment">// è·å–ä¸€ä¸ªList&lt;PropertyValue&gt; å±æ€§ç»„</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">original = Arrays.asList(pvs.getPropertyValues());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è·å¾— BeanDefinitionValueResolver</span></span><br><span class="line">TypeConverter converter = getCustomTypeConverter();</span><br><span class="line"><span class="keyword">if</span> (converter == <span class="keyword">null</span>) &#123;</span><br><span class="line">converter = bw;</span><br><span class="line">&#125;</span><br><span class="line">BeanDefinitionValueResolver valueResolver = <span class="keyword">new</span> BeanDefinitionValueResolver(<span class="keyword">this</span>, beanName, mbd, converter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a deep copy, resolving any references for values. </span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ·±å±‚å‰¯æœ¬ï¼Œä»¥è§£å†³æ‰€æœ‰å¯¹å€¼çš„å¼•ç”¨ã€‚å¯¹æœªè¢«è§£æçš„å…ˆè§£æ/å·²è§£æçš„ç›´æ¥åŠ å…¥deepCopyä¸­</span></span><br><span class="line">List&lt;PropertyValue&gt; deepCopy = <span class="keyword">new</span> ArrayList&lt;&gt;(original.size());</span><br><span class="line"><span class="keyword">boolean</span> resolveNecessary = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">for</span> (PropertyValue pv : original) &#123;</span><br><span class="line"><span class="keyword">if</span> (pv.isConverted()) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœå·²è½¬åŒ–ï¼Œç›´æ¥æ·»åŠ åˆ°deepCopyä¸­</span></span><br><span class="line">deepCopy.add(pv);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// è·å¾—å±æ€§åå’Œå±æ€§å€¼</span></span><br><span class="line">String propertyName = pv.getName();</span><br><span class="line">Object originalValue = pv.getValue();</span><br><span class="line"><span class="comment">// æ˜¯å¦æ˜¯AutowiredPropertyMarker</span></span><br><span class="line"><span class="keyword">if</span> (originalValue == AutowiredPropertyMarker.INSTANCE) &#123;</span><br><span class="line"><span class="comment">//è·å–åº”ç”¨äºå†™å…¥å±æ€§å€¼çš„æ–¹æ³•</span></span><br><span class="line">Method writeMethod = bw.getPropertyDescriptor(propertyName).getWriteMethod();</span><br><span class="line"><span class="keyword">if</span> (writeMethod == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Autowire marker for property without write method: "</span> + pv);</span><br><span class="line">&#125;</span><br><span class="line">originalValue = <span class="keyword">new</span> DependencyDescriptor(<span class="keyword">new</span> MethodParameter(writeMethod, <span class="number">0</span>), <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨valueResolverè§£æå±æ€§å€¼,ç»™å®šä¸€ä¸ªPropertyValueï¼Œè¿”å›ä¸€ä¸ªå€¼ï¼Œå¦‚æœ‰å¿…è¦ï¼Œè§£æå·¥å‚ä¸­å¯¹å…¶ä»–beançš„ä»»ä½•å¼•ç”¨</span></span><br><span class="line">Object resolvedValue = valueResolver.resolveValueIfNecessary(pv, originalValue);</span><br><span class="line">Object convertedValue = resolvedValue;</span><br><span class="line"><span class="keyword">boolean</span> convertible = bw.isWritableProperty(propertyName) &amp;&amp;</span><br><span class="line">!PropertyAccessorUtils.isNestedOrIndexedProperty(propertyName);</span><br><span class="line"><span class="keyword">if</span> (convertible) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœå¯è½¬åŒ–ï¼Œè½¬åŒ–è¿™ä¸ªå±æ€§</span></span><br><span class="line">convertedValue = convertForProperty(resolvedValue, propertyName, bw, converter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯èƒ½å°†è½¬æ¢åçš„å€¼å­˜å‚¨åœ¨åˆå¹¶çš„beanå®šä¹‰ä¸­ï¼Œé¿å…å¯¹æ¯ä¸ªåˆ›å»ºçš„beanå®ä¾‹è¿›è¡Œé‡æ–°è½¬æ¢</span></span><br><span class="line"><span class="keyword">if</span> (resolvedValue == originalValue) &#123;</span><br><span class="line"><span class="keyword">if</span> (convertible) &#123;</span><br><span class="line">pv.setConvertedValue(convertedValue);</span><br><span class="line">&#125;</span><br><span class="line">deepCopy.add(pv);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (convertible &amp;&amp; originalValue <span class="keyword">instanceof</span> TypedStringValue &amp;&amp;</span><br><span class="line">!((TypedStringValue) originalValue).isDynamic() &amp;&amp;</span><br><span class="line">!(convertedValue <span class="keyword">instanceof</span> Collection || ObjectUtils.isArray(convertedValue))) &#123;</span><br><span class="line">pv.setConvertedValue(convertedValue);</span><br><span class="line">deepCopy.add(pv);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">resolveNecessary = <span class="keyword">true</span>;</span><br><span class="line">deepCopy.add(<span class="keyword">new</span> PropertyValue(pv, convertedValue));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (mpvs != <span class="keyword">null</span> &amp;&amp; !resolveNecessary) &#123;</span><br><span class="line"><span class="comment">// è®¾ç½®å·²è½¬åŒ–å±æ€§</span></span><br><span class="line">mpvs.setConverted();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// æ”¾åˆ°PropertyValuesé‡Œé¢</span></span><br><span class="line">bw.setPropertyValues(<span class="keyword">new</span> MutablePropertyValues(deepCopy));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="initializeBean-åˆå§‹åŒ–Bean"><a href="#initializeBean-åˆå§‹åŒ–Bean" class="headerlink" title="initializeBean åˆå§‹åŒ–Bean"></a>initializeBean åˆå§‹åŒ–Bean</h4><p>åœ¨ä½¿ç”¨populateBeanåï¼Œè°ƒç”¨initializeBeanæ–¹æ³•è¿›è¡Œbeançš„initï¼Œåœ¨initæ–¹æ³•å†…éƒ¨ï¼Œå¯åˆ†ä¸ºä¸€ä¸‹å‡ éƒ¨åˆ†è°ƒç”¨</p><ol><li>invokeAwareMethods æ–¹æ³•ï¼Œè®¾ç½®Awareå±æ€§</li><li>applyBeanPostProcessorsBeforeInitialization æ–¹æ³•ï¼Œè°ƒç”¨ BeanProcessorä¸­çš„Beanåˆå§‹åŒ–å‰çš„åç½®æ–¹æ³•</li><li>invokeInitMethods æ–¹æ³•ï¼Œæ¿€æ´»è‡ªå®šä¹‰çš„initæ–¹æ³•</li><li>æ‰§è¡ŒBeanProcessorä¸­çš„åˆå§‹åŒ–åçš„åç½®æ–¹æ³•</li></ol><h5 id="1-invokeAwareMethods"><a href="#1-invokeAwareMethods" class="headerlink" title="1. invokeAwareMethods"></a>1. invokeAwareMethods</h5><p>å¯»æ‰¾æ˜¯å¦æ»¡è¶³ç‰¹å®šçš„æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³åˆ™è¿›è¡Œç›¸å…³å±æ€§çš„å¡«å……</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeAwareMethods</span><span class="params">(<span class="keyword">final</span> String beanName, <span class="keyword">final</span> Object bean)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (bean <span class="keyword">instanceof</span> Aware) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ BeanNameAwareï¼Œè®¾ç½®BeanName</span></span><br><span class="line"><span class="keyword">if</span> (bean <span class="keyword">instanceof</span> BeanNameAware) &#123;</span><br><span class="line">((BeanNameAware) bean).setBeanName(beanName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯  BeanClassLoaderAwareï¼Œè®¾ç½®classloader</span></span><br><span class="line"><span class="keyword">if</span> (bean <span class="keyword">instanceof</span> BeanClassLoaderAware) &#123;</span><br><span class="line">ClassLoader bcl = getBeanClassLoader();</span><br><span class="line"><span class="keyword">if</span> (bcl != <span class="keyword">null</span>) &#123;</span><br><span class="line">((BeanClassLoaderAware) bean).setBeanClassLoader(bcl);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (bean <span class="keyword">instanceof</span> BeanFactoryAware) &#123;</span><br><span class="line">((BeanFactoryAware) bean).setBeanFactory(AbstractAutowireCapableBeanFactory.<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-applyBeanPostProcessorsBeforeInitialization"><a href="#2-applyBeanPostProcessorsBeforeInitialization" class="headerlink" title="2. applyBeanPostProcessorsBeforeInitialization"></a>2. applyBeanPostProcessorsBeforeInitialization</h5><p>å¾ªç¯å®¹å™¨ä¸­æ¯ä¸€ä¸ªBeanPostProcessorï¼Œæ‰§è¡ŒBeanPostProcessorçš„postProcessBeforeInitializationæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">applyBeanPostProcessorsBeforeInitialization</span><span class="params">(Object existingBean, String beanName)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">Object result = existingBean;</span><br><span class="line"><span class="keyword">for</span> (BeanPostProcessor processor : getBeanPostProcessors()) &#123;</span><br><span class="line">Object current = processor.postProcessBeforeInitialization(result, beanName);</span><br><span class="line"><span class="keyword">if</span> (current == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">result = current;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-invokeInitMethods-æ‰§è¡Œinitæ–¹æ³•"><a href="#3-invokeInitMethods-æ‰§è¡Œinitæ–¹æ³•" class="headerlink" title="3.invokeInitMethods æ‰§è¡Œinitæ–¹æ³•"></a>3.invokeInitMethods æ‰§è¡Œinitæ–¹æ³•</h5><p>å¦‚æœæ˜¯isInitializingBeanåˆ™å…ˆä¼šæ‰§è¡Œè‡ªå·±çš„å†…ç½®æ–¹æ³•afterPropertiesSetã€‚å¦‚æœåˆ¶å®šäº†initMethodï¼Œé‚£ä¹ˆåç»­ä¼šé€šè¿‡åå°„æ‰§è¡Œè¿™ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">invokeInitMethods</span><span class="params">(String beanName, <span class="keyword">final</span> Object bean, @Nullable RootBeanDefinition mbd)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> isInitializingBean = (bean <span class="keyword">instanceof</span> InitializingBean);</span><br><span class="line"><span class="keyword">if</span> (isInitializingBean &amp;&amp; (mbd == <span class="keyword">null</span> || !mbd.isExternallyManagedInitMethod(<span class="string">"afterPropertiesSet"</span>))) &#123;</span><br><span class="line"><span class="keyword">if</span> (System.getSecurityManager() != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">AccessController.doPrivileged((PrivilegedExceptionAction&lt;Object&gt;) () -&gt; &#123;</span><br><span class="line">((InitializingBean) bean).afterPropertiesSet();</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;, getAccessControlContext());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">((InitializingBean) bean).afterPropertiesSet();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mbd != <span class="keyword">null</span> &amp;&amp; bean.getClass() != NullBean.class) &#123;</span><br><span class="line">String initMethodName = mbd.getInitMethodName();</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasLength(initMethodName) &amp;&amp;</span><br><span class="line">!(isInitializingBean &amp;&amp; <span class="string">"afterPropertiesSet"</span>.equals(initMethodName)) &amp;&amp;</span><br><span class="line">!mbd.isExternallyManagedInitMethod(initMethodName)) &#123;</span><br><span class="line">invokeCustomInitMethod(beanName, bean, mbd);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-applyBeanPostProcessorsAfterInitialization"><a href="#4-applyBeanPostProcessorsAfterInitialization" class="headerlink" title="4.applyBeanPostProcessorsAfterInitialization"></a>4.applyBeanPostProcessorsAfterInitialization</h5><p>å¾ªç¯å®¹å™¨ä¸­æ¯ä¸€ä¸ªBeanPostProcessorï¼Œæ‰§è¡ŒBeanPostProcessorçš„ postProcessAfterInitialization æ–¹æ³•ã€‚</p><p>è‡³æ­¤Beançš„å®ä¾‹åŒ–è¿‡ç¨‹å°±å¤§è‡´å®Œæˆäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springçš„Beançš„æ³¨å†Œ</title>
      <link href="/2019/12/20/Spring%E4%BB%8E%E9%9B%B6%E5%AD%A6%E8%B5%B7%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89/"/>
      <url>/2019/12/20/Spring%E4%BB%8E%E9%9B%B6%E5%AD%A6%E8%B5%B7%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Beançš„æ³¨å†Œ"><a href="#Beançš„æ³¨å†Œ" class="headerlink" title="Beançš„æ³¨å†Œ"></a>Beançš„æ³¨å†Œ</h1><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°äº†åœ¨ä½¿ç”¨<code>invokeBeanFactoryPostProcessors(beanFactory)</code> æ–¹æ³•ä¸­ï¼Œ<br>è°ƒç”¨äº† <code>ConfigurationClassPostProcessor</code> ä¸­çš„ <code>postProcessBeanDefinitionRegistry</code> æ–¹æ³•ï¼Œ<br>å®ç°äº†å¯¹configurationé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å¾—åˆ°åŠ è½½å’Œè§£æã€‚å®Œæˆå¯¹æ ‡æ³¨ä¸ºBeançš„æ–¹æ³•æ³¨å†Œã€Œregistã€åˆ°å®¹å™¨ä¸­ã€‚</p><p>ä¸‹é¢å°±é’ˆå¯¹è¿™ä¸€æ³¨å†Œé…ç½®æ–‡ä»¶å†…çš„Beançš„è¿‡ç¨‹è¿›è¡Œæºç çš„åˆ†æï¼š</p><h2 id="ConfigurationClassPostProcessor"><a href="#ConfigurationClassPostProcessor" class="headerlink" title="ConfigurationClassPostProcessor"></a>ConfigurationClassPostProcessor</h2><p>åœ¨ <code>invokeBeanFactoryPostProcessor</code> æ–¹æ³•ä¸­ï¼Œ<br>å¾ªç¯è°ƒç”¨ç±»ä¸­çš„åç½®æ–¹æ³• <code>postProcessBeanDefinitionRegistry</code> ,<br>å…¶ä¸­åŒ…æ‹¬äº† <code>ConfigurationClassPostProcessor</code> ç±»ã€‚<br>æ ¹æ®åå­—ä¹Ÿèƒ½çœ‹å‡ºè¿™ä¸ªç±»æ˜¯é…ç½®æ–‡ä»¶ç±»çš„åç½®å¤„ç†ç±»ã€‚é‚£ä¹ˆå°±ä¹‹é—´çœ‹ä»£ç ï¼Œäº†è§£é…ç½®æ–‡ä»¶çš„åç½®å¤„ç†å™¨éƒ½åšäº†äº›ä»€ä¹ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> registryId = System.identityHashCode(registry);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.registriesPostProcessed.contains(registryId)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                <span class="string">"postProcessBeanDefinitionRegistry already called on this post-processor against "</span> + registry);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.factoriesPostProcessed.contains(registryId)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                <span class="string">"postProcessBeanFactory already called on this post-processor against "</span> + registry);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.registriesPostProcessed.add(registryId);</span><br><span class="line">    processConfigBeanDefinitions(registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¯¹ processConfigBeanDefinitions ä¸­çš„æ–¹æ³•ä¸€æ­¥ä¸€æ­¥çœ‹ï¼š</p><h3 id="ä½¿ç”¨processConfigBeanDefinitionsè§£ææ³¨å†ŒBean"><a href="#ä½¿ç”¨processConfigBeanDefinitionsè§£ææ³¨å†ŒBean" class="headerlink" title="ä½¿ç”¨processConfigBeanDefinitionsè§£ææ³¨å†ŒBean"></a>ä½¿ç”¨processConfigBeanDefinitionsè§£ææ³¨å†ŒBean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processConfigBeanDefinitions</span><span class="params">(BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">    List&lt;BeanDefinitionHolder&gt; configCandidates = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// è·å¾—æ‰€æœ‰çš„å·²ç»æ³¨å†Œçš„Beanï¼Œå…¶ä¸­åŒ…æ‹¬Springå†…ç½®çš„Processorï¼Œ</span></span><br><span class="line">    <span class="comment">// å½“ç„¶ä¹ŸåŒ…æ‹¬è‡ªå·±å†™çš„@Configurationç±»</span></span><br><span class="line">    String[] candidateNames = registry.getBeanDefinitionNames();</span><br><span class="line">    <span class="comment">// å¯¹æ¯ä¸ªå€™é€‰çš„Beanè¿›è¡Œç­›é€‰</span></span><br><span class="line">    <span class="keyword">for</span> (String beanName : candidateNames) &#123;</span><br><span class="line">        BeanDefinition beanDef = registry.getBeanDefinition(beanName);</span><br><span class="line">        <span class="keyword">if</span> (beanDef.getAttribute(ConfigurationClassUtils.CONFIGURATION_CLASS_ATTRIBUTE) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"Bean definition has already been processed as a configuration class: "</span> + beanDef);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(beanDef, <span class="keyword">this</span>.metadataReaderFactory)) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯ä½¿ç”¨AnnotatedBeanDefinitionå®šä¹‰ï¼ˆ@Configurationï¼‰,å¦‚æœæ˜¯</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸€äº›å±æ€§å¦‚æ ¹æ®proxyBeanMethodsæŒ‡å®šç”¨æ¥é¿å…è¿è¡Œæ—¶åˆ›å»ºCGLIBçš„å­ç±»ç­‰ç­‰ã€‚ã€‚</span></span><br><span class="line">            configCandidates.add(<span class="keyword">new</span> BeanDefinitionHolder(beanDef, beanName));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return immediately if no @Configuration classes were found</span></span><br><span class="line">    <span class="keyword">if</span> (configCandidates.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹ç»™å®šçš„Orderï¼ˆ@Orderï¼‰è¿›è¡Œæ’åº</span></span><br><span class="line">    configCandidates.sort((bd1, bd2) -&gt; &#123;</span><br><span class="line">        <span class="keyword">int</span> i1 = ConfigurationClassUtils.getOrder(bd1.getBeanDefinition());</span><br><span class="line">        <span class="keyword">int</span> i2 = ConfigurationClassUtils.getOrder(bd2.getBeanDefinition());</span><br><span class="line">        <span class="keyword">return</span> Integer.compare(i1, i2);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®Beançš„åç§°çš„ç”Ÿæˆç­–ç•¥</span></span><br><span class="line">    SingletonBeanRegistry sbr = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (registry <span class="keyword">instanceof</span> SingletonBeanRegistry) &#123;</span><br><span class="line">        sbr = (SingletonBeanRegistry) registry;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.localBeanNameGeneratorSet) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰è®¾ç½®é»˜è®¤çš„åç§°ç”Ÿæˆç­–ç•¥</span></span><br><span class="line">            BeanNameGenerator generator = (BeanNameGenerator) sbr.getSingleton(</span><br><span class="line">                    AnnotationConfigUtils.CONFIGURATION_BEAN_NAME_GENERATOR);</span><br><span class="line">            <span class="keyword">if</span> (generator != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.componentScanBeanNameGenerator = generator;</span><br><span class="line">                <span class="keyword">this</span>.importBeanNameGenerator = generator;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.environment == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.environment = <span class="keyword">new</span> StandardEnvironment();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£ææ‰€æœ‰çš„@Configurationç±»ï¼Œé¦–å…ˆå…ˆå£°æ˜å‡ºä¸€ä¸ªè§£æå™¨</span></span><br><span class="line">    ConfigurationClassParser parser = <span class="keyword">new</span> ConfigurationClassParser(</span><br><span class="line">            <span class="keyword">this</span>.metadataReaderFactory, <span class="keyword">this</span>.problemReporter, <span class="keyword">this</span>.environment,</span><br><span class="line">            <span class="keyword">this</span>.resourceLoader, <span class="keyword">this</span>.componentScanBeanNameGenerator, registry);</span><br><span class="line"></span><br><span class="line">    Set&lt;BeanDefinitionHolder&gt; candidates = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(configCandidates);</span><br><span class="line">    Set&lt;ConfigurationClass&gt; alreadyParsed = <span class="keyword">new</span> HashSet&lt;&gt;(configCandidates.size());</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨è§£æå™¨å¯¹æ‰€æœ‰çš„é…ç½®ç±»è¿›è¡Œè§£æï¼Œåœ¨è§£æçš„è¿‡ç¨‹ä¸­</span></span><br><span class="line">        <span class="comment">// å®Œæˆå¯¹Beançš„æ³¨å†Œ</span></span><br><span class="line">        parser.parse(candidates);</span><br><span class="line">        <span class="comment">// è¿›è¡ŒéªŒè¯</span></span><br><span class="line">        parser.validate();</span><br><span class="line">        <span class="comment">// é€šè¿‡parserå¤„ç†å¾—åˆ°äº†é…ç½®æ–‡ä»¶ä¸‹çš„Bean</span></span><br><span class="line">        Set&lt;ConfigurationClass&gt; configClasses = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(parser.getConfigurationClasses());</span><br><span class="line">        <span class="comment">// ç§»é™¤æ‰€æœ‰çš„å·²ç»è§£æè¿‡çš„Bean'</span></span><br><span class="line">        configClasses.removeAll(alreadyParsed);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Read the model and create bean definitions based on its content</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.reader == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.reader = <span class="keyword">new</span> ConfigurationClassBeanDefinitionReader(</span><br><span class="line">                    registry, <span class="keyword">this</span>.sourceExtractor, <span class="keyword">this</span>.resourceLoader, <span class="keyword">this</span>.environment,</span><br><span class="line">                    <span class="keyword">this</span>.importBeanNameGenerator, parser.getImportRegistry());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.reader.loadBeanDefinitions(configClasses);</span><br><span class="line">        <span class="comment">// å¯¹æ‰€æœ‰å·²ç»è§£æçš„Beanè¿›è¡Œæ ‡è®°</span></span><br><span class="line">        alreadyParsed.addAll(configClasses);</span><br><span class="line"></span><br><span class="line">        candidates.clear();</span><br><span class="line">        <span class="comment">// å¦‚æœregistryä¸­çš„Beanå®šä¹‰æ•°é‡ å¤§äº candidateNames çš„æ•°é‡ï¼Œè¯´æ˜åœ¨Beanæ³¨å†Œè¿‡ç¨‹ä¸­</span></span><br><span class="line">        <span class="comment">// äº§ç”Ÿäº†å…¶ä»–Beanï¼Œé‡å¤è¿‡ç¨‹æ³¨å†Œè¿™ä¸ªBean</span></span><br><span class="line">        <span class="keyword">if</span> (registry.getBeanDefinitionCount() &gt; candidateNames.length) &#123;</span><br><span class="line">            <span class="comment">// ã€‚ã€‚ã€‚ã€‚ã€‚çœç•¥</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (!candidates.isEmpty());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ImportRegistryæ³¨å†Œä¸ºBeanï¼Œä»¥æ”¯æŒImportAware @Configurationç±»</span></span><br><span class="line">    <span class="keyword">if</span> (sbr != <span class="keyword">null</span> &amp;&amp; !sbr.containsSingleton(IMPORT_REGISTRY_BEAN_NAME)) &#123;</span><br><span class="line">        sbr.registerSingleton(IMPORT_REGISTRY_BEAN_NAME, parser.getImportRegistry());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸Šè¿°ä»£ç å®Œæˆäº†çš„è¿‡ç¨‹å¤§è‡´åˆ†ä¸ºè¿™å‡ æ­¥</strong></p><ol><li>æ‰¾å‡ºConfigé…ç½®ç±»ï¼ŒåŒ…æ‹¬ä½¿ç”¨@Configurationæ³¨è§£æ ‡æ³¨çš„é…ç½®ç±»</li><li>æ ¹æ®@Orderè¿›è¡Œè¿›è¡Œé¡ºåºçš„è°ƒæ•´</li><li>è§£ææ‰€æœ‰çš„@Configurationå†…çš„Beanï¼Œå®Œæˆå¯¹é…ç½®ç±»ä¸­æ‰€æœ‰ <strong>Beançš„æ³¨å†Œ</strong>ã€‚</li><li>éªŒè¯å¹¶è¿›è¡Œæ ‡è®°Beanå·²ç»è¢«è§£ææ³¨å†Œ</li></ol><p>å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ç¬¬3æ­¥ï¼Œéœ€è¦æ‰¾å‡ºBeanï¼Œå¹¶è¿›è¡Œæ³¨å†Œ</p><h4 id="parseæ–¹æ³•è§£æå¹¶å®Œæˆæ³¨å†ŒBeançš„ã€‚"><a href="#parseæ–¹æ³•è§£æå¹¶å®Œæˆæ³¨å†ŒBeançš„ã€‚" class="headerlink" title="parseæ–¹æ³•è§£æå¹¶å®Œæˆæ³¨å†ŒBeançš„ã€‚"></a>parseæ–¹æ³•è§£æå¹¶å®Œæˆæ³¨å†ŒBeançš„ã€‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; configCandidates)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (BeanDefinitionHolder holder : configCandidates) &#123;</span><br><span class="line">    <span class="comment">// è·å¾—é…ç½®ç±»çš„å®šä¹‰ä¿¡æ¯</span></span><br><span class="line">        BeanDefinition bd = holder.getBeanDefinition();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// å¦‚æœæ˜¯ä½¿ç”¨æ³¨è§£æ–¹å¼é…ç½®ç±»</span></span><br><span class="line">            <span class="keyword">if</span> (bd <span class="keyword">instanceof</span> AnnotatedBeanDefinition) &#123;</span><br><span class="line">                parse(((AnnotatedBeanDefinition) bd).getMetadata(), holder.getBeanName());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// else if ...  if .... etc</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// etc ....</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.deferredImportSelectorHandler.process();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(AnnotationMetadata metadata, String beanName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    processConfigurationClass(<span class="keyword">new</span> ConfigurationClass(metadata, beanName));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡Œé…ç½®ç±»çš„é…ç½®çš„æƒ…å†µï¼Œæœ€åä¼šè°ƒç”¨ <code>processConfigurationClass</code> æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processConfigurationClass</span><span class="params">(ConfigurationClass configClass)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®Contionalæ³¨è§£æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è·³è¿‡é…ç½®ç±»çš„å¤„ç†</span></span><br><span class="line">    <span class="comment">// å¦‚æœéœ€è¦è·³è¿‡ï¼Œåˆ™ç›´æ¥è¿›è¡Œreturn</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.conditionEvaluator.shouldSkip(configClass.getMetadata(), ConfigurationPhase.PARSE_CONFIGURATION)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ConfigurationClass existingClass = <span class="keyword">this</span>.configurationClasses.get(configClass);</span><br><span class="line">    <span class="keyword">if</span> (existingClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœå·²ç»å­˜åœ¨çš„æƒ…å†µ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€’å½’å¤„ç†é…ç½®ç±»åŠå…¶è¶…ç±»å±‚æ¬¡ç»“æ„</span></span><br><span class="line">    SourceClass sourceClass = asSourceClass(configClass);</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        sourceClass = doProcessConfigurationClass(configClass, sourceClass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (sourceClass != <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">this</span>.configurationClasses.put(configClass, configClass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åä¼šé€’å½’ä½¿ç”¨ <code>doProcessConfigurationClass</code> è¿›è¡Œå¤„ç†é…ç½®ç±»å’Œå…¶è¶…ç±».</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> SourceClass <span class="title">doProcessConfigurationClass</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    ConfigurationClass configClass, SourceClass sourceClass)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸Šæœ‰æ ‡æ³¨Componentæ³¨è§£ï¼Œåˆ™ä¼šé€’å½’å¤„ç†ä»»ä½•æˆå‘˜ç±»</span></span><br><span class="line">    <span class="keyword">if</span> (configClass.getMetadata().isAnnotated(Component.class.getName())) &#123;</span><br><span class="line">        processMemberClasses(configClass, sourceClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç† @PropertySource æ³¨è§£,ç”¨äºåŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">for</span> (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(</span><br><span class="line">            sourceClass.getMetadata(), PropertySources.class,</span><br><span class="line">            org.springframework.context.annotation.PropertySource.class)) &#123;</span><br><span class="line">            <span class="comment">// ... etc ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤„ç†æ‰€æœ‰çš„ @ComponentScan æ³¨è§£</span></span><br><span class="line">    Set&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(</span><br><span class="line">sourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);</span><br><span class="line">    <span class="keyword">if</span> (!componentScans.isEmpty() &amp;&amp;</span><br><span class="line">            !<span class="keyword">this</span>.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) &#123;</span><br><span class="line">            <span class="comment">// è·å–æ¯ä¸€ä¸ª  componentScans çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">for</span> (AnnotationAttributes componentScan : componentScans) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰ scan ç±»ï¼Œåˆ™ç«‹å³æ‰§è¡Œè§£æã€æ‰«æ</span></span><br><span class="line">            Set&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions =</span><br><span class="line">                    <span class="keyword">this</span>.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());</span><br><span class="line">            <span class="comment">//æ£€æŸ¥æ‰«æçš„å®šä¹‰é›†æ˜¯å¦æœ‰å…¶ä»–é…ç½®ç±»ï¼Œå¹¶åœ¨éœ€è¦æ—¶é€’å½’è§£æ</span></span><br><span class="line">            <span class="keyword">for</span> (BeanDefinitionHolder holder : scannedBeanDefinitions) &#123;</span><br><span class="line">                BeanDefinition bdCand = holder.getBeanDefinition().getOriginatingBeanDefinition();</span><br><span class="line">                <span class="keyword">if</span> (bdCand == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    bdCand = holder.getBeanDefinition();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, <span class="keyword">this</span>.metadataReaderFactory)) &#123;</span><br><span class="line">                    parse(bdCand.getBeanClassName(), holder.getBeanName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†æ‰€æœ‰çš„ @Import æ³¨è§£</span></span><br><span class="line">    processImports(configClass, sourceClass, getImports(sourceClass), <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Process any @ImportResource annotations</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†@Beanæ–¹æ³•</span></span><br><span class="line">    Set&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);</span><br><span class="line">    <span class="keyword">for</span> (MethodMetadata methodMetadata : beanMethods) &#123;</span><br><span class="line">        configClass.addBeanMethod(<span class="keyword">new</span> BeanMethod(methodMetadata, configClass));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¤„ç†æ¥å£ä¸Šçš„é»˜è®¤æ–¹æ³•</span></span><br><span class="line">    processInterfaces(configClass, sourceClass);</span><br><span class="line">    <span class="comment">// å¤„ç†è¶…ç±»</span></span><br><span class="line">    <span class="keyword">if</span> (sourceClass.getMetadata().hasSuperClass()) &#123;</span><br><span class="line">        String superclass = sourceClass.getMetadata().getSuperClassName();</span><br><span class="line">        <span class="keyword">if</span> (superclass != <span class="keyword">null</span> &amp;&amp; !superclass.startsWith(<span class="string">"java"</span>) &amp;&amp;</span><br><span class="line">                !<span class="keyword">this</span>.knownSuperclasses.containsKey(superclass)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.knownSuperclasses.put(superclass, configClass);</span><br><span class="line">            <span class="comment">// Superclass found, return its annotation metadata and recurse</span></span><br><span class="line">            <span class="keyword">return</span> sourceClass.getSuperClass();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰è¶…ç±»ï¼Œå¤„ç†å®Œæˆã€‚</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p>æ€»ç»“åœ¨ä½¿ç”¨ doProcessConfigurationClass æ–¹æ³•æ—¶ï¼Œå¤§è‡´ä¼šæœ‰è¿™æ ·å‡ æ­¥ï¼š</p><ol><li>å¦‚æœæ ‡è®°æœ‰ <code>@Component</code> æ³¨è§£ï¼Œåˆ™ä¼šå…ˆå»é€’å½’å¤„ç†æˆå‘˜ç±»,é‚£ä¹ˆä»–æ˜¯å¦‚ä½•è¿›è¡Œé€’å½’å¤„ç†çš„å‘¢ï¼Œçœ‹ä¸»è¦æ–¹æ³•çš„è°ƒç”¨å°±èƒ½å¤Ÿç†è§£ï¼š<br>processMemberClasses -&gt; processConfigurationClass -&gt; doProcessConfigurationClass -&gt; processMemberClasses<br>æ¯æ¬¡éƒ½ä¼šé€’å½’çš„å…ˆå¤„ç†æˆå‘˜ç±»ã€‚</li><li>å¤„ç† <code>@PropertySource</code> æ³¨è§£,ä½œç”¨ä¸ºåŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶</li><li>å¤„ç†æ‰€æœ‰çš„ <code>@ComponentScan</code> æ³¨è§£ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸­æ ‡è®°æœ‰ <code>@ComponentSacn</code> æˆ–è€… <code>@ComponentScans</code> æ³¨è§£çš„è¯ï¼Œä¼šå…ˆå»è§£æå¯¹åº”è·¯å¾„ä¸‹çš„Beanï¼ŒåŒ…è£…æˆ <code>BeanDefinitionHolder</code> å†æ¬¡è¿›è¡Œparseã€‚</li><li>å¤„ç†æ‰€æœ‰çš„ <code>@Import</code> æ³¨è§£,å¤„ç†æ‰€æœ‰ä½¿ç”¨Importæ³¨è§£å¼•å…¥çš„é…ç½®æ–‡ä»¶</li><li>å¤„ç†æ‰€æœ‰çš„ <code>@ImportResource</code> æ³¨è§£</li><li>å¤„ç†æ‰€æœ‰ <code>@Bean</code> æ–¹æ³•,æ·»åŠ ä¸º BeanMethodï¼Œè§£æé…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸º@Beançš„æ–¹æ³•ï¼Œæ·»åŠ åˆ°configClassä¸­çš„BeanMethodä¸­</li><li>å¤„ç†æ¥å£çš„é»˜è®¤æ–¹æ³•</li><li>æŒ‰ç…§ä»¥ä¸Šé€»è¾‘è¿›è¡Œé€’å½’çš„å¤„ç†è¶…ç±»ã€‚</li></ol><p>åœ¨æ–¹æ³•ä¸­ï¼Œå¯ä»¥æ‰¾æ—¶é—´ç”»ä¸€å¼ å›¾æ¥è§£æè¿™ä¸ªæ–¹æ³•çœŸæ­£åšäº†å†™ä»€ä¹ˆã€‚[todo] ã€‚</p><h2 id="æ³¨å†Œçš„ç²¾ç®€è¿‡ç¨‹"><a href="#æ³¨å†Œçš„ç²¾ç®€è¿‡ç¨‹" class="headerlink" title="æ³¨å†Œçš„ç²¾ç®€è¿‡ç¨‹"></a>æ³¨å†Œçš„ç²¾ç®€è¿‡ç¨‹</h2><p>æœ€åçš„parseæ–¹æ³•æ˜¯å…³é”®ï¼Œç»è¿‡ä»¥ä¸Šæ­¥éª¤å¯ä»¥,åœ¨æœ¬ç« èŠ‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ @ComponentSacn  å’Œ å¤„ç†æ‰€æœ‰çš„ @Bean è¿™ä¸¤æ­¥ï¼š</p><p>åœ¨å¤„ç† @ComponentSacn ä¸­ï¼Œå°†ç›´æ¥å°†æ ¹æ®è·¯å¾„è§£æå‡ºæ¥çš„Beanä½¿ç”¨ <code>componentScanParser.parse</code> æ–¹æ³•ï¼Œæœ€ç»ˆåœ¨ <code>registerBeanDefinition</code>() æ–¹æ³•ä¸­æ³¨å†Œè¿›å»ã€‚</p><p>è€Œåœ¨å¤„ç†@Beanæ–¹æ³•çš„æ—¶å€™ï¼Œæ˜¯å°†Beanæ–¹æ³•åŒ…è£…æˆBeanMethod æ”¾åˆ° <code>this.beanMethods</code> ä¸­ï¼Œç­‰å¾…åœ¨ <code>parse()</code> å <code>this.reader.loadBeanDefinitions(configClasses);</code> ä¸­è¿›è¡Œæ“ä½œ.</p><p>è€Œåœ¨å‰é¢è¯´çš„loadBeanDefinitions ä¸­ä¼šå°†å‰é¢æåˆ°çš„ Importã€ImportReourceå’Œ BeanMethod ç»Ÿä¸€è¿›è¡Œæ³¨å†Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (configClass.isImported()) &#123;</span><br><span class="line">    registerBeanDefinitionForImportedConfigurationClass(configClass);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (BeanMethod beanMethod : configClass.getBeanMethods()) &#123;</span><br><span class="line">    loadBeanDefinitionsForBeanMethod(beanMethod);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">loadBeanDefinitionsFromImportedResources(configClass.getImportedResources());</span><br><span class="line">loadBeanDefinitionsFromRegistrars(configClass.getImportBeanDefinitionRegistrars())</span><br></pre></td></tr></table></figure><p>åœ¨loadBeanDefinitionsForBeanMethodä¸­ï¼Œè¿›è¡Œäº†å¯¹è§£æå‡ºæ¥çš„ä½¿ç”¨@Beanæ ‡æ³¨çš„æ–¹æ³•è¿›è¡Œæ³¨å†Œã€‚ä»è€Œå®Œæˆæ³¨å†ŒBeançš„ä¸»çº¿åŠŸèƒ½ã€‚ä¸å…·ä½“è¿›è¡Œæ¢³ç†è¿™ä¸ªæ–¹æ³•çš„è¿‡ç¨‹ï¼Œå¤§è‡´ä¸ºæ„å»ºä¸€ä¸ªBeanDefintionåï¼Œé€šè¿‡registerBeanDefinitionæ–¹æ³•è¿›è¡Œæ³¨å†Œ,æ”¾åˆ°beanDefinitionMapä¸­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springçš„æ ¸å¿ƒRefresh</title>
      <link href="/2019/12/15/Spring%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2019/12/15/Spring%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨æ³¨å†Œé…ç½®æ–‡ä»¶åçš„åˆ·æ–°ï¼ˆRefreshï¼‰"><a href="#åœ¨æ³¨å†Œé…ç½®æ–‡ä»¶åçš„åˆ·æ–°ï¼ˆRefreshï¼‰" class="headerlink" title="åœ¨æ³¨å†Œé…ç½®æ–‡ä»¶åçš„åˆ·æ–°ï¼ˆRefreshï¼‰"></a>åœ¨æ³¨å†Œé…ç½®æ–‡ä»¶åçš„åˆ·æ–°ï¼ˆRefreshï¼‰</h1><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦ç†æ¸…äº†Springæ˜¯å¦‚ä½•ï¼ˆé€šè¿‡ <code>register(Class&lt;?&gt;... componentClasses)</code> ï¼‰æ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªè¦å¤„ç†çš„ç»„ä»¶ç±»ï¼ˆé…ç½®ç±»ï¼‰ã€‚</p><p>ä½†æ˜¯å¦‚æœä¸è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯åˆ·æ–°ï¼ˆrefreshï¼‰å®¹å™¨ï¼Œæ•´ä¸ªç±»æ˜¯å¾—ä¸åˆ°å®Œå…¨çš„å¤„ç†çš„ã€‚ä¸‹å›¾æ˜¯å¯¹ refresh æ–¹æ³•è¿›è¡Œçš„ä¸»è¦è¿‡ç¨‹æ€»ç»“ã€‚ä¼šé€šè¿‡å¯¹æ¯ä¸€æ¡çº¿ä¸Šçš„æ–¹æ³•è¿›è¡Œåˆ†æå’Œæ€»ç»“æ–¹æ³•çš„ç”¨é€”ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20191123225557.png" alt="20191123225557.png"></p><h2 id="1-prepareRefresh-å‡†å¤‡åˆ·æ–°"><a href="#1-prepareRefresh-å‡†å¤‡åˆ·æ–°" class="headerlink" title="1. prepareRefresh å‡†å¤‡åˆ·æ–°"></a>1. prepareRefresh å‡†å¤‡åˆ·æ–°</h2><p>æ˜¯ <code>refresh</code> çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥å‡†å¤‡ä¸Šä¸‹æ–‡ç¯å¢ƒä»¥ç”¨æ¥åˆ·æ–°ï¼ˆrefreshï¼‰ã€‚</p><ol><li>è®¾ç½®startupDateå¯åŠ¨æ—¶é—´ã€è®¾ç½®closedä¸ºfalseï¼Œè®¾ç½®activeä¸ºtrue.</li><li>initPropertySources()æ–¹æ³•ï¼Œç•™ç»™å­ç±»è‡ªè¡Œå®ç°ï¼Œç”¨æ¥åœ¨ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­åˆå§‹åŒ–ä»»ä½•å ä½ç¬¦å±æ€§æº.</li><li>validateRequiredProperties() ç”¨æ¥éªŒè¯æ‰€æœ‰çš„Propritieséƒ½æ˜¯å¯è§£æçš„.</li><li>æœ€åå­˜å‚¨é¢„åˆ·æ–°çš„ApplicationListenersã€‚ä¹Ÿå°±æ˜¯åˆå§‹åŒ–earlyApplicationEventsï¼›</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">prepareRefresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.startupDate = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">this</span>.closed.set(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">this</span>.active.set(**<span class="keyword">true</span>**);</span><br><span class="line">    <span class="comment">// ...çœç•¥éƒ¨åˆ†ä»£ç .</span></span><br><span class="line">    <span class="comment">// åœ¨ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­åˆå§‹åŒ–ä»»ä½•å ä½ç¬¦å±æ€§æºï¼Œå­ç±»ç»§æ‰¿å®ç°</span></span><br><span class="line">    initPropertySources();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éªŒè¯æ‰€æœ‰å¿…é¡»çš„Propertyéƒ½æ˜¯å¯è§£æçš„</span></span><br><span class="line">    getEnvironment().validateRequiredProperties();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Store pre-refresh ApplicationListeners...</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.earlyApplicationListeners == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.earlyApplicationListeners = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(<span class="keyword">this</span>.applicationListeners);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Reset local application listeners to pre-refresh state.</span></span><br><span class="line">        <span class="keyword">this</span>.applicationListeners.clear();</span><br><span class="line">        <span class="keyword">this</span>.applicationListeners.addAll(<span class="keyword">this</span>.earlyApplicationListeners);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.earlyApplicationEvents = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-obtainFreshBeanFactory-è·å–BeanFactory"><a href="#2-obtainFreshBeanFactory-è·å–BeanFactory" class="headerlink" title="2. obtainFreshBeanFactory è·å–BeanFactory"></a>2. obtainFreshBeanFactory è·å–BeanFactory</h2><p>åœ¨ <code>obtainFreshBeanFactory</code> æ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªå­æ–¹æ³•ã€‚åˆ†åˆ«ç”¨æ¥è®¾ç½®SerializationIdå’Œè·å–åœ¨registerè¿‡ç¨‹ä¸­å·²ç»äº§ç”Ÿçš„beanFactoryã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">refreshBeanFactory</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException </span>&#123;</span><br><span class="line">    <span class="comment">// ...çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">    <span class="comment">// åœ¨registerçš„æ—¶å€™ï¼Œé€šè¿‡registerBeanDefinitionæ—¶ä¼šåˆ›å»ºä¸€ä¸ªbeanFactoryä¸ºDefaultListableBeanFactory</span></span><br><span class="line">    <span class="keyword">this</span>.beanFactory.setSerializationId(getId());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ConfigurableListableBeanFactory <span class="title">getBeanFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.beanFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-prepareBeanFactory-å‡†å¤‡BeanFactory"><a href="#3-prepareBeanFactory-å‡†å¤‡BeanFactory" class="headerlink" title="3.prepareBeanFactory å‡†å¤‡BeanFactory"></a>3.prepareBeanFactory å‡†å¤‡BeanFactory</h2><p>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å®ç°ç±»å¯¹BeanFactoryçš„åŸºæœ¬åˆå§‹åŒ–ã€‚è®¾ç½®äº† <code>classLoador</code>ã€<code>ExpressionResolver</code>ã€<code>BeanPostProcessor</code>ç­‰ç­‰å±æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">prepareBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">    beanFactory.setBeanClassLoader(getClassLoader());</span><br><span class="line">    beanFactory.setBeanExpressionResolver(<span class="keyword">new</span> StandardBeanExpressionResolver(beanFactory.getBeanClassLoader()));</span><br><span class="line">    beanFactory.addPropertyEditorRegistrar(<span class="keyword">new</span> ResourceEditorRegistrar(<span class="keyword">this</span>, getEnvironment()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®PostProcessor å›è°ƒæ–¹æ³•</span></span><br><span class="line">    beanFactory.addBeanPostProcessor(<span class="keyword">new</span> ApplicationContextAwareProcessor(<span class="keyword">this</span>));</span><br><span class="line">    <span class="comment">// å¿½ç•¥ç»™å®šçš„æ¥å£ç±»çš„è‡ªåŠ¨è£…é…ï¼ˆå°±æ˜¯ä¸è£…é…ç»™å®šçš„æ¥å£ç±»ï¼‰</span></span><br><span class="line">    beanFactory.ignoreDependencyInterface(EnvironmentAware.class);</span><br><span class="line">    beanFactory.ignoreDependencyInterface(EmbeddedValueResolverAware.class);</span><br><span class="line">    beanFactory.ignoreDependencyInterface(ResourceLoaderAware.class);</span><br><span class="line">    beanFactory.ignoreDependencyInterface(ApplicationEventPublisherAware.class);</span><br><span class="line">    beanFactory.ignoreDependencyInterface(MessageSourceAware.class);</span><br><span class="line">    beanFactory.ignoreDependencyInterface(ApplicationContextAware.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// registerResolvableDependencyçš„ä½œç”¨å°±æ˜¯å°† ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºä¾èµ–æ³¨å…¥åˆ°ç¬¬äºŒä¸ªå‚æ•°ä¸­</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„thisæŒ‡çš„å°±æ˜¯AbstractApplicationContext</span></span><br><span class="line">    beanFactory.registerResolvableDependency(BeanFactory.class, beanFactory);</span><br><span class="line">    beanFactory.registerResolvableDependency(ResourceLoader.class, <span class="keyword">this</span>);</span><br><span class="line">    beanFactory.registerResolvableDependency(ApplicationEventPublisher.class, <span class="keyword">this</span>);</span><br><span class="line">    beanFactory.registerResolvableDependency(ApplicationContext.class, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register early post-processor for detecting inner beans as ApplicationListeners. æ³¨å†Œä¸€ä¸ªapplicationListenersæ£€æµ‹å™¨</span></span><br><span class="line">    beanFactory.addBeanPostProcessor(<span class="keyword">new</span> ApplicationListenerDetector(<span class="keyword">this</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123;</span><br><span class="line">        beanFactory.addBeanPostProcessor(<span class="keyword">new</span> LoadTimeWeaverAwareProcessor(beanFactory));</span><br><span class="line">        beanFactory.setTempClassLoader(<span class="keyword">new</span> ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨å†Œç¯å¢ƒç›¸å…³Bean</span></span><br><span class="line">    <span class="keyword">if</span> (!beanFactory.containsLocalBean(ENVIRONMENT_BEAN_NAME)) &#123;</span><br><span class="line">        beanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!beanFactory.containsLocalBean(SYSTEM_PROPERTIES_BEAN_NAME)) &#123;</span><br><span class="line">        beanFactory.registerSingleton(SYSTEM_PROPERTIES_BEAN_NAME, getEnvironment().getSystemProperties());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!beanFactory.containsLocalBean(SYSTEM_ENVIRONMENT_BEAN_NAME)) &#123;</span><br><span class="line">        beanFactory.registerSingleton(SYSTEM_ENVIRONMENT_BEAN_NAME, getEnvironment().getSystemEnvironment());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-postProcessBeanFactory-å¯¹BeanFactoryçš„åç½®å¤„ç†"><a href="#3-postProcessBeanFactory-å¯¹BeanFactoryçš„åç½®å¤„ç†" class="headerlink" title="3.postProcessBeanFactory å¯¹BeanFactoryçš„åç½®å¤„ç†"></a>3.postProcessBeanFactory å¯¹BeanFactoryçš„åç½®å¤„ç†</h2><p>è¿™ä¸ªæ–¹æ³•çš„å®ç°æ˜¯ç©ºçš„ï¼Œå®é™…å«ä¹‰å°±æ˜¯è®©å­ç±»å»å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œç„¶åè°ƒç”¨çš„æ—¶å€™å¯ä»¥å¯¹BeanFactoryè¿›è¡Œè‡ªå®šä¹‰çš„åç½®å¤„ç†ã€‚</p><h2 id="4-invokeBeanFactoryPostProcessors-è°ƒç”¨å·²æ³¨å†Œä¸ºBeançš„å·¥å‚å¤„ç†å™¨"><a href="#4-invokeBeanFactoryPostProcessors-è°ƒç”¨å·²æ³¨å†Œä¸ºBeançš„å·¥å‚å¤„ç†å™¨" class="headerlink" title="4.invokeBeanFactoryPostProcessors è°ƒç”¨å·²æ³¨å†Œä¸ºBeançš„å·¥å‚å¤„ç†å™¨"></a>4.invokeBeanFactoryPostProcessors è°ƒç”¨å·²æ³¨å†Œä¸ºBeançš„å·¥å‚å¤„ç†å™¨</h2><p>æ–¹æ³•çš„ä½œç”¨å°±æ˜¯å®ä¾‹åŒ–å¹¶è°ƒç”¨æ‰€æœ‰å·²æ³¨å†Œçš„BeanFactoryPostProcessorï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™ä¸€æ­¥<strong>å®Œæˆå¯¹configurationé…ç½®ç±»ä¸­çš„Beançš„æ³¨å†Œè¿‡ç¨‹[todo]</strong>ã€‚ä¸»è¦çš„æ‰§è¡Œæ–¹æ³•æ˜¯ <code>PostProcessorRegistrationDelegate</code> ä¸­çš„ <code>invokeBeanFactoryPostProcessors</code> æ–¹æ³•ã€‚</p><blockquote><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°äº†åœ¨ register æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº† <code>this.reader = new AnnotatedBeanDefinitionReader(this)</code> åï¼Œä½¿ç”¨ <code>registerAnnotationConfigProcessors</code> æ³¨å†Œä¸€äº›æ³¨è§£ç›¸å…³beanï¼Œå¦‚<code>ConfigurationClassPostProcessor</code>ç­‰ç­‰ã€‚</p></blockquote><p>ä»£ç å¾ˆå¤šï¼Œæ²¡å¿…è¦éƒ½çœ‹ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œå…ˆæ€»ç»“ä¸‹è¿‡ç¨‹ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç¿»ç¿»æºç å†çœ‹çœ‹å…·ä½“å®ç°ï¼š</p><h3 id="å¦‚æœæœ‰BeanFactoryPostProcessor-åˆ™ä¼šå…ˆæ‰§è¡Œç±»ä¸­çš„-postProcessBeanDefinitionRegistry-æ–¹æ³•"><a href="#å¦‚æœæœ‰BeanFactoryPostProcessor-åˆ™ä¼šå…ˆæ‰§è¡Œç±»ä¸­çš„-postProcessBeanDefinitionRegistry-æ–¹æ³•" class="headerlink" title="å¦‚æœæœ‰BeanFactoryPostProcessor,åˆ™ä¼šå…ˆæ‰§è¡Œç±»ä¸­çš„ postProcessBeanDefinitionRegistry æ–¹æ³•"></a>å¦‚æœæœ‰BeanFactoryPostProcessor,åˆ™ä¼šå…ˆæ‰§è¡Œç±»ä¸­çš„ <code>postProcessBeanDefinitionRegistry</code> æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors) &#123;</span><br><span class="line">    <span class="keyword">if</span> (postProcessor <span class="keyword">instanceof</span> BeanDefinitionRegistryPostProcessor) &#123;</span><br><span class="line">        BeanDefinitionRegistryPostProcessor registryProcessor =</span><br><span class="line">                (BeanDefinitionRegistryPostProcessor) postProcessor;</span><br><span class="line">        registryProcessor.postProcessBeanDefinitionRegistry(registry);</span><br><span class="line">        registryProcessors.add(registryProcessor);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        regularPostProcessors.add(postProcessor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸€æ­¥ã€ä¼šå¤„ç†åœ¨beanFactoryä¸­å­˜åœ¨çš„-ç»§æ‰¿BeanDefinitionRegistryPostProcessor-å¹¶ä¸”å®ç°äº†PriorityOrdered-æ¥å£çš„ç±»"><a href="#ç¬¬ä¸€æ­¥ã€ä¼šå¤„ç†åœ¨beanFactoryä¸­å­˜åœ¨çš„-ç»§æ‰¿BeanDefinitionRegistryPostProcessor-å¹¶ä¸”å®ç°äº†PriorityOrdered-æ¥å£çš„ç±»" class="headerlink" title="ç¬¬ä¸€æ­¥ã€ä¼šå¤„ç†åœ¨beanFactoryä¸­å­˜åœ¨çš„ ç»§æ‰¿BeanDefinitionRegistryPostProcessor å¹¶ä¸”å®ç°äº†PriorityOrdered æ¥å£çš„ç±»"></a>ç¬¬ä¸€æ­¥ã€ä¼šå¤„ç†åœ¨beanFactoryä¸­å­˜åœ¨çš„ ç»§æ‰¿<code>BeanDefinitionRegistryPostProcessor</code> å¹¶ä¸”å®ç°äº†<code>PriorityOrdered</code> æ¥å£çš„ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">String[] postProcessorNames =</span><br><span class="line">        beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, <span class="keyword">true</span>, <span class="keyword">false</span>);</span><br><span class="line"><span class="keyword">for</span> (String ppName : postProcessorNames) &#123;</span><br><span class="line">    <span class="keyword">if</span> (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;</span><br><span class="line">        currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));</span><br><span class="line">        processedBeans.add(ppName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯¹ä¾èµ–æ’åº</span></span><br><span class="line">sortPostProcessors(currentRegistryProcessors, beanFactory);</span><br><span class="line"><span class="comment">// æ·»åŠ åˆ°registryProcessorsä¸­</span></span><br><span class="line">registryProcessors.addAll(currentRegistryProcessors);</span><br><span class="line"><span class="comment">// æ‰§è¡Œ&#123;ConfigurationClassPostProcessorçš„&#125;åç½®æ–¹æ³•</span></span><br><span class="line">invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);</span><br><span class="line"><span class="comment">// æ¸…ç©ºå½“å‰æ³¨å†Œå¤„ç†å™¨</span></span><br><span class="line">currentRegistryProcessors.clear();</span><br></pre></td></tr></table></figure><h3 id="ç¬¬äºŒæ­¥ã€ä¼šå¤„ç†åœ¨beanFactoryä¸­å­˜åœ¨çš„-ç»§æ‰¿-BeanDefinitionRegistryPostProcessor-å¹¶ä¸”å®ç°äº†Ordered-æ¥å£çš„ç±»ä¸­çš„"><a href="#ç¬¬äºŒæ­¥ã€ä¼šå¤„ç†åœ¨beanFactoryä¸­å­˜åœ¨çš„-ç»§æ‰¿-BeanDefinitionRegistryPostProcessor-å¹¶ä¸”å®ç°äº†Ordered-æ¥å£çš„ç±»ä¸­çš„" class="headerlink" title="ç¬¬äºŒæ­¥ã€ä¼šå¤„ç†åœ¨beanFactoryä¸­å­˜åœ¨çš„ ç»§æ‰¿ BeanDefinitionRegistryPostProcessor å¹¶ä¸”å®ç°äº†Ordered æ¥å£çš„ç±»ä¸­çš„"></a>ç¬¬äºŒæ­¥ã€ä¼šå¤„ç†åœ¨beanFactoryä¸­å­˜åœ¨çš„ ç»§æ‰¿ BeanDefinitionRegistryPostProcessor å¹¶ä¸”å®ç°äº†Ordered æ¥å£çš„ç±»ä¸­çš„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªåˆ—å‡ºå·®å¼‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span> (!processedBeans.contains(ppName) &amp;&amp; beanFactory.isTypeMatch(ppName, Ordered.class)) &#123;</span><br><span class="line">    currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));</span><br><span class="line">    processedBeans.add(ppName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œç¬¬ä¸€æ­¥å‡ ä¹ä¸€æ ·ï¼ŒåŒæ ·ä¼šå¯¹ä¾èµ–æ’åºã€æ·»åŠ åˆ°registryProcessorsä¸­åˆ°ã€å¤„ç†åç½®æ–¹æ³•ç­‰ã€‚</p><h3 id="æœ€åã€å¤„ç†å‰©ä¸‹çš„BeanDefinitionRegistryPostProcessorç±»"><a href="#æœ€åã€å¤„ç†å‰©ä¸‹çš„BeanDefinitionRegistryPostProcessorç±»" class="headerlink" title="æœ€åã€å¤„ç†å‰©ä¸‹çš„BeanDefinitionRegistryPostProcessorç±»"></a>æœ€åã€å¤„ç†å‰©ä¸‹çš„BeanDefinitionRegistryPostProcessorç±»</h3><p>å’Œå‰ä¸¤æ­¥ç›¸ä¼¼çš„é‡å¤çš„æ“ä½œã€‚å°±ä¸å±•ç¤ºä»£ç äº†ã€‚</p><h3 id="å¤„ç†å®Œæ‰€æœ‰çš„BeanFactoryPostProcessoråï¼Œå¤„ç†æ‰€æœ‰BeanPostProcessor"><a href="#å¤„ç†å®Œæ‰€æœ‰çš„BeanFactoryPostProcessoråï¼Œå¤„ç†æ‰€æœ‰BeanPostProcessor" class="headerlink" title="å¤„ç†å®Œæ‰€æœ‰çš„BeanFactoryPostProcessoråï¼Œå¤„ç†æ‰€æœ‰BeanPostProcessor"></a>å¤„ç†å®Œæ‰€æœ‰çš„BeanFactoryPostProcessoråï¼Œå¤„ç†æ‰€æœ‰BeanPostProcessor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨å‰é¢å¤„ç†è¿‡çš„ registryProcessors å¤„ç†å™¨</span></span><br><span class="line">invokeBeanFactoryPostProcessors(registryProcessors, beanFactory);</span><br><span class="line">invokeBeanFactoryPostProcessors(regularPostProcessors, beanFactory);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">invokeBeanFactoryPostProcessors</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        Collection&lt;? extends BeanFactoryPostProcessor&gt; postProcessors, ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line"> <span class="comment">// æ‰§è¡ŒpostProcessBeanFactoryå›è°ƒæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">for</span> (BeanFactoryPostProcessor postProcessor : postProcessors) &#123;</span><br><span class="line">        postProcessor.postProcessBeanFactory(beanFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯é’ˆå¯¹ <code>beanFactory instanceof BeanDefinitionRegistry</code> çš„æƒ…å†µï¼Œå¦‚æœè¿”å›falseï¼Œå…·ä½“å†…å®¹å¯èƒ½ç¨æœ‰ä¸å®¹ã€‚ä½†å¤§è‡´ä¸Šæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå°±ä¸å†åˆ†æä¸‹é¢çš„ä»£ç äº†ã€‚</p><h2 id="5-registerBeanPostProcessors-æ³¨å†ŒBeançš„åç½®å¤„ç†å™¨"><a href="#5-registerBeanPostProcessors-æ³¨å†ŒBeançš„åç½®å¤„ç†å™¨" class="headerlink" title="5.registerBeanPostProcessors æ³¨å†ŒBeançš„åç½®å¤„ç†å™¨"></a>5.registerBeanPostProcessors æ³¨å†ŒBeançš„åç½®å¤„ç†å™¨</h2><p>å°±åƒåå­—ä¸€æ ·ï¼Œ<code>registerBeanPostProcessors</code> çš„ä½œç”¨å°±æ˜¯æ³¨å†Œ <code>BeanPostProcessors</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">registerBeanPostProcessors</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">    PostProcessorRegistrationDelegate.registerBeanPostProcessors(beanFactory, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨PostProcessorRegistrationDelegateçš„é™æ€æ–¹æ³• <code>registerBeanPostProcessors</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerBeanPostProcessors</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        ConfigurableListableBeanFactory beanFactory, AbstractApplicationContext applicationContext)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å¾—æ‰€æœ‰çš„BeanPostProcessor</span></span><br><span class="line">    String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanPostProcessor.class, <span class="keyword">true</span>, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">int</span> beanProcessorTargetCount = beanFactory.getBeanPostProcessorCount() + <span class="number">1</span> + postProcessorNames.length;</span><br><span class="line">    <span class="comment">// æ³¨å†Œä¸€ä¸ªBeanPostProcessorCheckerç”¨æ¥åœ¨BeanPostProcessorå®ä¾‹åŒ–Beanæ—¶æ‰“å°ä¿¡æ¯</span></span><br><span class="line">    beanFactory.addBeanPostProcessor(<span class="keyword">new</span> BeanPostProcessorChecker(beanFactory, beanProcessorTargetCount));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Separate between BeanPostProcessors that implement PriorityOrdered,</span></span><br><span class="line">    <span class="comment">// Ordered, and the rest.</span></span><br><span class="line">    List&lt;BeanPostProcessor&gt; priorityOrderedPostProcessors = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    List&lt;BeanPostProcessor&gt; internalPostProcessors = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    List&lt;String&gt; orderedPostProcessorNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    List&lt;String&gt; nonOrderedPostProcessorNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String ppName : postProcessorNames) &#123;</span><br><span class="line">        <span class="keyword">if</span> (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;</span><br><span class="line">            BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);</span><br><span class="line">            priorityOrderedPostProcessors.add(pp);</span><br><span class="line">            <span class="keyword">if</span> (pp <span class="keyword">instanceof</span> MergedBeanDefinitionPostProcessor) &#123;</span><br><span class="line">                internalPostProcessors.add(pp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (beanFactory.isTypeMatch(ppName, Ordered.class)) &#123;</span><br><span class="line">            orderedPostProcessorNames.add(ppName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            nonOrderedPostProcessorNames.add(ppName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// First, register the BeanPostProcessors that implement PriorityOrdered.</span></span><br><span class="line">    sortPostProcessors(priorityOrderedPostProcessors, beanFactory);</span><br><span class="line">    registerBeanPostProcessors(beanFactory, priorityOrderedPostProcessors);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Next, register the BeanPostProcessors that implement Ordered.</span></span><br><span class="line">    List&lt;BeanPostProcessor&gt; orderedPostProcessors = <span class="keyword">new</span> ArrayList&lt;&gt;(orderedPostProcessorNames.size());</span><br><span class="line">    <span class="keyword">for</span> (String ppName : orderedPostProcessorNames) &#123;</span><br><span class="line">        BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);</span><br><span class="line">        orderedPostProcessors.add(pp);</span><br><span class="line">        <span class="keyword">if</span> (pp <span class="keyword">instanceof</span> MergedBeanDefinitionPostProcessor) &#123;</span><br><span class="line">            internalPostProcessors.add(pp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sortPostProcessors(orderedPostProcessors, beanFactory);</span><br><span class="line">    registerBeanPostProcessors(beanFactory, orderedPostProcessors);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now, register all regular BeanPostProcessors.</span></span><br><span class="line">    List&lt;BeanPostProcessor&gt; nonOrderedPostProcessors = <span class="keyword">new</span> ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size());</span><br><span class="line">    <span class="keyword">for</span> (String ppName : nonOrderedPostProcessorNames) &#123;</span><br><span class="line">        BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);</span><br><span class="line">        nonOrderedPostProcessors.add(pp);</span><br><span class="line">        <span class="keyword">if</span> (pp <span class="keyword">instanceof</span> MergedBeanDefinitionPostProcessor) &#123;</span><br><span class="line">            internalPostProcessors.add(pp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    registerBeanPostProcessors(beanFactory, nonOrderedPostProcessors);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Finally, re-register all internal BeanPostProcessors.</span></span><br><span class="line">    sortPostProcessors(internalPostProcessors, beanFactory);</span><br><span class="line">    registerBeanPostProcessors(beanFactory, internalPostProcessors);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Re-register post-processor for detecting inner beans as ApplicationListeners,</span></span><br><span class="line">    <span class="comment">// moving it to the end of the processor chain (for picking up proxies etc).</span></span><br><span class="line">    beanFactory.addBeanPostProcessor(<span class="keyword">new</span> ApplicationListenerDetector(applicationContext));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡ç¨‹ç±»ä¼¼ <code>invokeBeanFactoryPostProcessors</code> çš„è¿‡ç¨‹ï¼Œå®é™…è¿‡ç¨‹åˆ†æ­¥å¯ä»¥æ•´ç†å¦‚ä¸‹ï¼š</p><ol><li>è·å¾—æ‰€æœ‰çš„BeanPostProcessorï¼Œå¹¶æ³¨å†Œä¸€ä¸ª<code>BeanPostProcessorChecker</code>ï¼Œç”¨æ¥åœ¨BeanPostProcessorä¸­åˆ›å»ºBeanæ—¶æ‰“å°ä¿¡æ¯ã€‚</li><li>é¦–å…ˆæ³¨å†Œç»§æ‰¿äº†PriorityOrderedæ¥å£çš„BeanPostProcessor;</li><li>ç„¶åæ³¨å†Œç»§æ‰¿äº†Orderedæ¥å£çš„ BeanPostProcessor;ç„¶åæ³¨å†Œæ‰€æœ‰çš„æ™®é€šçš„ BeanPostProcessorï¼›</li><li>æœ€åæ³¨å†Œæ‰€æœ‰çš„å†…éƒ¨çš„BeanPostProcessor;</li></ol><h2 id="6-initMessageSource-å¤„ç†åˆå§‹åŒ–æ¶ˆæ¯æ¥æºMessageSource"><a href="#6-initMessageSource-å¤„ç†åˆå§‹åŒ–æ¶ˆæ¯æ¥æºMessageSource" class="headerlink" title="6.initMessageSource å¤„ç†åˆå§‹åŒ–æ¶ˆæ¯æ¥æºMessageSource"></a>6.initMessageSource å¤„ç†åˆå§‹åŒ–æ¶ˆæ¯æ¥æºMessageSource</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initMessageSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å¾—beanFactory</span></span><br><span class="line">    ConfigurableListableBeanFactory beanFactory = getBeanFactory();</span><br><span class="line">    <span class="comment">// å¦‚æœåŒ…å«nameä¸º messageSource çš„bean</span></span><br><span class="line">    <span class="keyword">if</span> (beanFactory.containsLocalBean(MESSAGE_SOURCE_BEAN_NAME)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.messageSource = beanFactory.getBean(MESSAGE_SOURCE_BEAN_NAME, MessageSource.class);</span><br><span class="line">        <span class="comment">// è®©å½“å‰ MessageSource çŸ¥é“çˆ¶MessageSource </span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.parent != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.messageSource <span class="keyword">instanceof</span> HierarchicalMessageSource) &#123;</span><br><span class="line">            HierarchicalMessageSource hms = (HierarchicalMessageSource) <span class="keyword">this</span>.messageSource;</span><br><span class="line">            <span class="keyword">if</span> (hms.getParentMessageSource() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Only set parent context as parent MessageSource if no parent MessageSource</span></span><br><span class="line">                <span class="comment">// registered already.</span></span><br><span class="line">                hms.setParentMessageSource(getInternalParentMessageSource());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">"Using MessageSource ["</span> + <span class="keyword">this</span>.messageSource + <span class="string">"]"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸å­˜åœ¨MSï¼Œåˆ™æ–°å»ºä¸€ä¸ªç©ºçš„ MessageSource</span></span><br><span class="line">        DelegatingMessageSource dms = <span class="keyword">new</span> DelegatingMessageSource();</span><br><span class="line">        dms.setParentMessageSource(getInternalParentMessageSource());</span><br><span class="line">        <span class="keyword">this</span>.messageSource = dms;</span><br><span class="line">        beanFactory.registerSingleton(MESSAGE_SOURCE_BEAN_NAME, <span class="keyword">this</span>.messageSource);</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">"No '"</span> + MESSAGE_SOURCE_BEAN_NAME + <span class="string">"' bean, using ["</span> + <span class="keyword">this</span>.messageSource + <span class="string">"]"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ initMessageSource è¿‡ç¨‹ä¸­ï¼Œåšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œä¸»è¦åˆ†ä¸¤æ­¥ï¼š</p><ol><li>å¦‚æœåŒ…å«messageSourceçš„Beanï¼Œåˆ™è®¾ç½®çˆ¶MessageSource</li><li>å¦‚æœä¸åŒ…å« messageSource çš„ Beanï¼Œåˆ™åˆ›å»ºä¸€ä¸ª DelegatingMessageSource å¹¶æ³¨å†Œåˆ° beanFactory ä¸­ã€‚</li></ol><h2 id="7-initApplicationEventMulticaster-åˆå§‹åŒ–åº”ç”¨äº‹ä»¶å¤šæ’­å™¨"><a href="#7-initApplicationEventMulticaster-åˆå§‹åŒ–åº”ç”¨äº‹ä»¶å¤šæ’­å™¨" class="headerlink" title="7. initApplicationEventMulticaster åˆå§‹åŒ–åº”ç”¨äº‹ä»¶å¤šæ’­å™¨"></a>7. initApplicationEventMulticaster åˆå§‹åŒ–åº”ç”¨äº‹ä»¶å¤šæ’­å™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initApplicationEventMulticaster</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ConfigurableListableBeanFactory beanFactory = getBeanFactory();</span><br><span class="line">    <span class="keyword">if</span> (beanFactory.containsLocalBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationEventMulticaster =</span><br><span class="line">                beanFactory.getBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, ApplicationEventMulticaster.class);</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">"Using ApplicationEventMulticaster ["</span> + <span class="keyword">this</span>.applicationEventMulticaster + <span class="string">"]"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationEventMulticaster = <span class="keyword">new</span> SimpleApplicationEventMulticaster(beanFactory);</span><br><span class="line">        beanFactory.registerSingleton(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, <span class="keyword">this</span>.applicationEventMulticaster);</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">"No '"</span> + APPLICATION_EVENT_MULTICASTER_BEAN_NAME + <span class="string">"' bean, using "</span> +</span><br><span class="line">                    <span class="string">"["</span> + <span class="keyword">this</span>.applicationEventMulticaster.getClass().getSimpleName() + <span class="string">"]"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œåˆå§‹åŒ–MessageSourceè¿‡ç¨‹ç›¸ä¼¼,å¦‚æœåŒ…å«applicationEventMulticasterï¼Œåˆ™è®¾ç½® <code>this.applicationEventMulticaster</code> ä¸ºå®¹å™¨ä¸­çš„å¤šæ’­å™¨ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºï¼Œå¹¶ä½¿ç”¨beanFactoryè¿›è¡Œæ³¨å†Œä¸ºå•ä¾‹çš„Beanã€‚</p><h2 id="8-onRefresh-åœ¨ç‰¹å®šä¸Šä¸‹æ–‡å­ç±»ä¸­åˆå§‹åŒ–å…¶ä»–ç‰¹æ®Šbean"><a href="#8-onRefresh-åœ¨ç‰¹å®šä¸Šä¸‹æ–‡å­ç±»ä¸­åˆå§‹åŒ–å…¶ä»–ç‰¹æ®Šbean" class="headerlink" title="8. onRefresh åœ¨ç‰¹å®šä¸Šä¸‹æ–‡å­ç±»ä¸­åˆå§‹åŒ–å…¶ä»–ç‰¹æ®Šbean"></a>8. onRefresh åœ¨ç‰¹å®šä¸Šä¸‹æ–‡å­ç±»ä¸­åˆå§‹åŒ–å…¶ä»–ç‰¹æ®Šbean</h2><p>ç‚¹è¿›æ–¹æ³•åæ˜¾ç¤ºæ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œæ˜¯ç•™ç»™å­ç±»è‡ªè¡Œå»å®ç°çš„ï¼Œå»å¤„ç†ç‰¹æ®Šçš„beanã€‚</p><h2 id="9-registerListeners-æ³¨å†ŒListeners"><a href="#9-registerListeners-æ³¨å†ŒListeners" class="headerlink" title="9. registerListeners æ³¨å†ŒListeners"></a>9. registerListeners æ³¨å†ŒListeners</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">registerListeners</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆæ³¨å†Œé™æ€çš„listener</span></span><br><span class="line">    <span class="keyword">for</span> (ApplicationListener&lt;?&gt; listener : getApplicationListeners()) &#123;</span><br><span class="line">        getApplicationEventMulticaster().addApplicationListener(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String[] listenerBeanNames = getBeanNamesForType(ApplicationListener.class, <span class="keyword">true</span>, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">for</span> (String listenerBeanName : listenerBeanNames) &#123;</span><br><span class="line">        getApplicationEventMulticaster().addApplicationListenerBean(listenerBeanName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‘å¸ƒæ—©èµ·çš„åº”ç”¨äº‹ä»¶</span></span><br><span class="line">    Set&lt;ApplicationEvent&gt; earlyEventsToProcess = <span class="keyword">this</span>.earlyApplicationEvents;</span><br><span class="line">    <span class="keyword">this</span>.earlyApplicationEvents = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (earlyEventsToProcess != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (ApplicationEvent earlyEvent : earlyEventsToProcess) &#123;</span><br><span class="line">            getApplicationEventMulticaster().multicastEvent(earlyEvent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-finishBeanFactoryInitialization-å®ŒæˆBeanFactoryçš„åˆå§‹åŒ–"><a href="#10-finishBeanFactoryInitialization-å®ŒæˆBeanFactoryçš„åˆå§‹åŒ–" class="headerlink" title="10.finishBeanFactoryInitialization å®ŒæˆBeanFactoryçš„åˆå§‹åŒ–"></a>10.finishBeanFactoryInitialization å®ŒæˆBeanFactoryçš„åˆå§‹åŒ–</h2><p>åœ¨è¿™ä¸€æ­¥å®Œæˆäº†æ‰€æœ‰çš„å‰©ä½™çš„å•å®ä¾‹Beançš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finishBeanFactoryInitialization</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ– conversionService Bean</span></span><br><span class="line">    <span class="keyword">if</span> (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp;</span><br><span class="line">            beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123;</span><br><span class="line">        beanFactory.setConversionService(</span><br><span class="line">                beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register a default embedded value resolver if no bean post-processor</span></span><br><span class="line">    <span class="comment">// (such as a PropertyPlaceholderConfigurer bean) registered any before:</span></span><br><span class="line">    <span class="comment">// at this point, primarily for resolution in annotation attribute values.</span></span><br><span class="line">    <span class="keyword">if</span> (!beanFactory.hasEmbeddedValueResolver()) &#123;</span><br><span class="line">        beanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early.</span></span><br><span class="line">    String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, <span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">for</span> (String weaverAwareName : weaverAwareNames) &#123;</span><br><span class="line">        getBean(weaverAwareName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Stop using the temporary ClassLoader for type matching.</span></span><br><span class="line">    beanFactory.setTempClassLoader(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allow for caching all bean definition metadata, not expecting further changes.</span></span><br><span class="line">    beanFactory.freezeConfiguration();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">    beanFactory.preInstantiateSingletons();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦è¿‡ç¨‹åŒ…æ‹¬ï¼š</p><ol><li>åˆå§‹åŒ– conversionService ;</li><li>å¦‚æœæ²¡æœ‰å†…ç½®çš„Valueè§£æå™¨ï¼Œåˆ™è®¾ç½®ä¸€ä¸ªStringValueResolverè§£æå™¨åˆ°beanFactoryä¸­ã€‚</li><li>åˆå§‹åŒ–LoadTimeWeaverAwareï¼›</li><li>åœæ­¢ä½¿ç”¨ä¸´æ—¶çš„ClassLoaderè¿›è¡Œç±»å‹åŒ¹é…ã€‚</li><li>å…è®¸ç¼“å­˜æ‰€æœ‰beanå®šä¹‰å…ƒæ•°æ®ï¼Œè€Œä¸æœŸæœ›è¿›ä¸€æ­¥çš„æ›´æ”¹ã€‚</li><li>å®ä¾‹åŒ–æ‰€æœ‰çš„å‰©ä½™çš„ã€éæ‡’åŠ è½½çš„å•å®ä¾‹Beanã€‚</li></ol><p>è¿™é‡Œåªé’ˆå¯¹ç¬¬6æ¡çš„å®ä¾‹åŒ–å‰©ä½™çš„å•å®ä¾‹Beanè¿›è¡Œæºç åˆ†æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">beanFactory.preInstantiateSingletons();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preInstantiateSingletons</span><span class="params">()</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    <span class="comment">// Iterate over a copy to allow for init methods which in turn register new bean definitions.</span></span><br><span class="line">    <span class="comment">// While this may not be part of the regular factory bootstrap, it does otherwise work fine.</span></span><br><span class="line">    List&lt;String&gt; beanNames = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="keyword">this</span>.beanDefinitionNames);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Trigger initialization of all non-lazy singleton beans...</span></span><br><span class="line">    <span class="keyword">for</span> (String beanName : beanNames) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå¯¹åº”å­Beançš„å®šä¹‰ï¼Œåˆ™éå†çˆ¶Beanå®šä¹‰å¾—åˆ°ä¸€ä¸ªåˆå¹¶çš„RootBeanDefinition</span></span><br><span class="line">        RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName);</span><br><span class="line">        <span class="comment">//å¦‚æœè¿™ä¸ªBeanä¸æ˜¯abstractã€æ˜¯å•ä¾‹çš„ã€éæ‡’åŠ è½½çš„</span></span><br><span class="line">        <span class="keyword">if</span> (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯FactoryBean</span></span><br><span class="line">            <span class="keyword">if</span> (isFactoryBean(beanName)) &#123;</span><br><span class="line">            <span class="comment">// æƒ³ä½¿ç”¨getBeanæ—¶éœ€è¦æ·»åŠ  &amp; å‰ç¼€</span></span><br><span class="line">                Object bean = getBean(FACTORY_BEAN_PREFIX + beanName);</span><br><span class="line">                <span class="keyword">if</span> (bean <span class="keyword">instanceof</span> FactoryBean) &#123;</span><br><span class="line">                    <span class="keyword">final</span> FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) bean;</span><br><span class="line">                    <span class="keyword">boolean</span> isEagerInit;</span><br><span class="line">                    <span class="keyword">if</span> (System.getSecurityManager() != <span class="keyword">null</span> &amp;&amp; factory <span class="keyword">instanceof</span> SmartFactoryBean) &#123;</span><br><span class="line">                        isEagerInit = AccessController.doPrivileged((PrivilegedAction&lt;Boolean&gt;)</span><br><span class="line">                                        ((SmartFactoryBean&lt;?&gt;) factory)::isEagerInit,</span><br><span class="line">                                getAccessControlContext());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        isEagerInit = (factory <span class="keyword">instanceof</span> SmartFactoryBean &amp;&amp;</span><br><span class="line">                                ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (isEagerInit) &#123;</span><br><span class="line">                    <span class="comment">// è°ƒç”¨getBeanè¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">                        getBean(beanName);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// è°ƒç”¨getBeanè¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">                getBean(beanName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Trigger post-initialization callback for all applicable beans...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼šåœ¨preInstantiateSingletonsæ–¹æ³•ä¸­ï¼ŒçœŸæ­£å»å®ä¾‹åŒ–çš„æ–¹å¼æ˜¯å»è°ƒç”¨ <code>getBean</code> [todo]æ–¹æ³•ã€‚</p><p>æ¥ä¸‹æ¥åˆ†æé…ç½®æ–‡ä»¶ä¸­çš„Beançš„æ³¨å†Œå’Œä½¿ç”¨ <code>getBean</code> è¿›è¡ŒçœŸæ­£çš„å®ä¾‹åŒ–è¿‡ç¨‹è¿›è¡Œåˆ†æã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringAOPçš„ä½¿ç”¨å’Œæºç åˆ†æ</title>
      <link href="/2019/12/11/%EF%BC%88%E5%9B%9B%EF%BC%89AOP%E5%88%87%E9%9D%A2%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%8E%9F%E7%90%86/"/>
      <url>/2019/12/11/%EF%BC%88%E5%9B%9B%EF%BC%89AOP%E5%88%87%E9%9D%A2%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringAOPçš„ä½¿ç”¨å’Œæºç åˆ†æ"><a href="#SpringAOPçš„ä½¿ç”¨å’Œæºç åˆ†æ" class="headerlink" title="SpringAOPçš„ä½¿ç”¨å’Œæºç åˆ†æ"></a>SpringAOPçš„ä½¿ç”¨å’Œæºç åˆ†æ</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç°åœ¨æ¥çœ‹ï¼ˆAspect-oriented Programmingï¼‰ é¢å‘åˆ‡é¢ç¼–ç¨‹aopï¼Œæ˜¯å’Œoopï¼ˆObject-oriented Programmingï¼‰æ˜¯å¯¹ç¼–ç¨‹ç»“æœçš„ä¸åŒçš„æ€è€ƒçš„æ–¹å‘ã€‚åœ¨é¢å‘å¯¹è±¡ä¸­ï¼Œå½¢æˆç»„åˆçš„ç»„ä»¶æ˜¯ç±»ï¼ˆclassï¼‰ã€‚è€Œåœ¨é¢å‘åˆ‡é¢ï¼Œå½¢æˆç»„åˆçš„ç»„ä»¶æ˜¯åˆ‡é¢ï¼ˆAspectï¼‰,åˆ‡é¢èƒ½å¤Ÿå¯¹å…³æ³¨çš„åœ°æ–¹æ¨¡å—åŒ–ï¼Œæ¨ªåˆ‡å¤šç§ä¸åŒçš„ç±»å‹å’Œå¯¹è±¡ï¼ˆæ¯”å¦‚äº‹åŠ¡ç®¡ç†ï¼‰ã€‚è€Œè¿™ä¸ªæ‰€è°“çš„â€œå…³æ³¨çš„åœ°æ–¹â€ï¼Œä¹Ÿå¯ä»¥åœ¨AOPä¸­ç§°ä¸º<strong>è·¨é¢†åŸŸå…³æ³¨ç‚¹</strong>ã€‚</p><p>Springæä¾› é…ç½®æ–‡ä»¶ å’Œ @AspectJæ³¨è§£ æ–¹å¼ç¼–å†™AOPï¼Œä¸¤ç§æ–¹å¼éƒ½æ”¯æŒå„ç§çš„ Adviceï¼ˆé€šçŸ¥ï¼‰ï¼Œå¦‚æœä½¿ç”¨@AspectJæ³¨è§£ï¼Œä»ç„¶ä¼šé€šè¿‡Springçš„è¿›è¡Œç»‡å…¥ã€‚</p><h2 id="AOPä¸­å…³é”®å­—çš„æ¦‚å¿µ"><a href="#AOPä¸­å…³é”®å­—çš„æ¦‚å¿µ" class="headerlink" title="AOPä¸­å…³é”®å­—çš„æ¦‚å¿µ"></a>AOPä¸­å…³é”®å­—çš„æ¦‚å¿µ</h2><h3 id="1-Aspect"><a href="#1-Aspect" class="headerlink" title="1.Aspect"></a>1.Aspect</h3><p>åˆ‡é¢ï¼š å¯¹å¤šç§ä¸åŒçš„ç±»çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¿™ä¸ªå…³æ³¨ç‚¹è¢«æ¨¡å—åŒ–ä¸ºä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»å°±å«åšåˆ‡é¢ï¼ˆåˆ‡é¢ç±»ï¼‰ï¼Œé€šè¿‡åœ¨æ™®é€šç±»ä¸Šæ ‡æ³¨ <code>@Aspect</code>æ³¨è§£æ¥å®ç°ã€‚</p><h3 id="2-Join-point"><a href="#2-Join-point" class="headerlink" title="2.Join point"></a>2.Join point</h3><p>è¿æ¥ç‚¹ï¼šç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ‰§è¡Œé€šçŸ¥ï¼ˆAdviceï¼‰çš„ç‚¹ã€‚</p><h3 id="3-Advice"><a href="#3-Advice" class="headerlink" title="3.Advice"></a>3.Advice</h3><p>é€šçŸ¥ï¼šé€šçŸ¥æŒ‡çš„æ˜¯åˆ‡é¢åœ¨æŒ‡å®šçš„è¿æ¥ç‚¹å¤„æ‰§è¡Œçš„æ“ä½œï¼Œä¸åŒçš„é€šçŸ¥ç±»å‹åŒ…æ‹¬ï¼šâ€œaroundâ€, â€œbeforeâ€ and â€œafterâ€</p><h3 id="4-Pointcut"><a href="#4-Pointcut" class="headerlink" title="4.Pointcut"></a>4.Pointcut</h3><p>åˆ‡ç‚¹ï¼šåˆ‡ç‚¹ä¼šåŒ¹é…é€šçŸ¥æ‰€è¦ç»‡å…¥çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿æ¥ç‚¹ï¼Œé€šçŸ¥æ˜¯ä¸åˆ‡ç‚¹å‘å…³è”çš„ï¼Œå¹¶ä¸”åœ¨ä»»ä½•åŒ¹é…åˆ°åˆ‡ç‚¹çš„åœ°æ–¹æ‰§è¡Œåœ¨è¿æ¥ç‚¹ä¸Šçš„æ“ä½œã€‚</p><h3 id="5-Target-object"><a href="#5-Target-object" class="headerlink" title="5.Target object"></a>5.Target object</h3><p>ç›®æ ‡å¯¹è±¡ï¼šä¸€ä¸ªã€è¢«ä¸€ä¸ªæˆ–å¤šä¸ªåˆ‡é¢è¿›è¡Œé€šçŸ¥ã€‘çš„å¯¹è±¡å«åšç›®æ ‡å¯¹è±¡ï¼Œä¹Ÿå«ä»£ç†å¯¹è±¡ã€‚</p><h3 id="6-AOP-proxy"><a href="#6-AOP-proxy" class="headerlink" title="6.AOP proxy"></a>6.AOP proxy</h3><p>AOPä»£ç†ï¼šåœ¨Springä¸­ï¼Œä¸€ä¸ªæ˜¯JDKåŠ¨æ€ä»£ç†ï¼Œä¸€ä¸ªæ˜¯ CGLIB ä»£ç†ã€‚</p><h3 id="7-Weaving"><a href="#7-Weaving" class="headerlink" title="7.Weaving"></a>7.Weaving</h3><p>ç»‡å…¥ï¼šç»‡å…¥æ˜¯å°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºçš„ä»£ç†å¯¹è±¡è¿‡ç¨‹</p><h2 id="ä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡ŒAOPçš„é…ç½®å’Œä½¿ç”¨"><a href="#ä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡ŒAOPçš„é…ç½®å’Œä½¿ç”¨" class="headerlink" title="ä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡ŒAOPçš„é…ç½®å’Œä½¿ç”¨"></a>ä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡ŒAOPçš„é…ç½®å’Œä½¿ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. ä½¿ç”¨ <span class="doctag">@Aspect</span> æ³¨è§£åˆ›å»ºåˆ‡é¢ç±»</span></span><br><span class="line"><span class="comment"> * 2. ä½¿ç”¨ <span class="doctag">@Pointcut</span> æ³¨è§£æ³¨æ˜åˆ‡ç‚¹ï¼ˆä½¿ç”¨Aspectè¡¨è¾¾å¼ï¼‰</span></span><br><span class="line"><span class="comment"> * 3. å£°æ˜é€šçŸ¥ï¼ˆBeforeï¼ŒAfterï¼ŒAroundï¼ŒAfterReturningï¼ŒAfterThrowingï¼‰å…·ä½“å«ä¹‰å¯ä»¥å‚è€ƒRefæ–‡æ¡£ 5.4.4. Declaring Advice</span></span><br><span class="line"><span class="comment"> * åªæ˜¯ä»¥ä¸Šä¸‰æ­¥æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæ²¡æœ‰å¼€å¯Springå¯¹æ³¨è§£ç‰ˆAOPçš„æ”¯æŒ</span></span><br><span class="line"><span class="comment"> * æ‰€ä»¥ï¼Œéœ€è¦ä½¿ç”¨ <span class="doctag">@EnableAspectJAutoProxy</span> å¼€å¯å¯¹<span class="doctag">@Aspect</span>æ³¨è§£çš„æ”¯æŒ</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspects</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut</span>(value=<span class="string">"within(com.nanyin.service.*)"</span>)</span><br><span class="line"><span class="comment">// @Pointcut("execution(public * (..))")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logBefore</span><span class="params">(JoinPoint jp)</span></span>&#123;</span><br><span class="line">System.out.println(jp.getSignature().getName());</span><br><span class="line">System.out.println(<span class="string">"before..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@After</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logAfter</span><span class="params">()</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"after..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterReturning</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logAfterReturn</span><span class="params">()</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"after return..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterThrowing</span>(value = <span class="string">"pointCut()"</span>,throwing = <span class="string">"ex"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logAfterThrowing</span><span class="params">(JoinPoint joinPoint,Exception ex)</span></span>&#123;</span><br><span class="line">joinPoint.getSignature().getName();</span><br><span class="line">System.out.println(<span class="string">"after throwing..."</span>);</span><br><span class="line">System.out.println(ex.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// aroundåœ¨proceed ä¹‹å‰æ˜¯åœ¨ beforeä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// aroundåœ¨proceed ä¹‹å‰æ˜¯åœ¨ afterä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// å¯å…¼å®¹beforeå’Œafter</span></span><br><span class="line"><span class="meta">@Around</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">logAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"><span class="comment">// æ–¹æ³•å¼€å§‹</span></span><br><span class="line">System.out.println(<span class="string">"around methods begin ..."</span>);</span><br><span class="line">Object object = joinPoint.proceed();</span><br><span class="line">System.out.println(<span class="string">"around methods end ..."</span>);</span><br><span class="line"><span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿›è¡Œæµ‹è¯•</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(BasicConfig.class);</span><br><span class="line">BasicService basicService = (BasicService) applicationContext.getBean(<span class="string">"basicService"</span>);</span><br><span class="line"><span class="comment">// å› ä¸ºåˆ‡ç‚¹åŒ…æ‹¬è¿™ä¸ªbasicServiceï¼Œæ‰€ä»¥æ‰§è¡Œhelloå°±ä¼šè§¦å‘AOP</span></span><br><span class="line">basicService.hello();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœ</span></span><br><span class="line">around methods begin ...</span><br><span class="line">hello</span><br><span class="line">before...</span><br><span class="line">hello world!!</span><br><span class="line">around methods end ...</span><br><span class="line">after...</span><br><span class="line">after <span class="keyword">return</span>...</span><br></pre></td></tr></table></figure><h2 id="AOPä»£ç åŸç†åˆ†æ"><a href="#AOPä»£ç åŸç†åˆ†æ" class="headerlink" title="AOPä»£ç åŸç†åˆ†æ"></a>AOPä»£ç åŸç†åˆ†æ</h2><p>é€šè¿‡ä»¥ä¸Šå®è·µï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœéœ€è¦ä½¿ç”¨Springçš„AOPåŠŸèƒ½ï¼Œéœ€è¦å…ˆä½¿ç”¨ <code>@EnableAspectJAutoProxy</code> æ³¨è§£æ ‡æ³¨åœ¨é…ç½®ç±»ä¸­ï¼Œä½¿ <code>@Aspect</code> ç”Ÿæ•ˆä¸ºä¸€ä¸ªåˆ‡é¢ç±»ã€‚</p><h3 id="1-EnableAspectJAutoProxy-å¼€å¯springAOPæ”¯æŒ"><a href="#1-EnableAspectJAutoProxy-å¼€å¯springAOPæ”¯æŒ" class="headerlink" title="1. @EnableAspectJAutoProxy å¼€å¯springAOPæ”¯æŒ"></a>1. @EnableAspectJAutoProxy å¼€å¯springAOPæ”¯æŒ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE) <span class="comment">//æ ‡æ³¨åœ¨ç±»ä¸Š</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import</span>(AspectJAutoProxyRegistrar.class) <span class="comment">//å¼•å…¥ AspectJAutoProxyRegistrar</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAspectJAutoProxy &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ˜¯å¦ä½¿ç”¨CGLIBè¿›è¡Œä»£ç†ï¼Œé»˜è®¤æ˜¯falseï¼Œå³é»˜è®¤ä½¿ç”¨JDKåŠ¨æ€ä»£ç†</span></span><br><span class="line"><span class="comment">   **/</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">proxyTargetClass</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ˜¯å¦éœ€è¦ ä»£ç†åº”ç”±AOPæ¡†æ¶å…¬å¼€ä¸º&#123;ThreadLocal&#125;ï¼Œä»¥ä¾¿é€šè¿‡&#123;AopContext&#125;ç±»è¿›è¡Œæ£€ç´¢ã€‚</span></span><br><span class="line"><span class="comment">   **/</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">exposeProxy</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡è¦çš„æ˜¯æ³¨è§£Importå†…å¼•ç”¨çš„<code>AspectJAutoProxyRegistrar</code>ç±»ã€‚è¿™ä¸ªç±»é€šè¿‡ä½¿ç”¨ <code>BeanDefinitionRegistry</code> æ³¨å†Œä¸€ä¸ª <code>AnnotationAwareAspectJAutoProxyCreator</code>.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line"><span class="comment">//å¦‚æœéœ€è¦ æ³¨å†ŒAspectJæ³¨è§£è‡ªåŠ¨ä»£ç†åˆ›å»ºç±» internalAutoProxyCreator</span></span><br><span class="line">AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary(registry);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BeanDefinition <span class="title">registerOrEscalateApcAsRequired</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">Class&lt;?&gt; cls, BeanDefinitionRegistry registry, @Nullable Object source)</span> </span>&#123;</span><br><span class="line"><span class="comment">//cls=AnnotationAwareAspectJAutoProxyCreator</span></span><br><span class="line">Assert.notNull(registry, <span class="string">"BeanDefinitionRegistry must not be null"</span>);</span><br><span class="line"><span class="comment">// æ˜¯å¦å­˜åœ¨internalAutoProxyCreator</span></span><br><span class="line"><span class="keyword">if</span> (registry.containsBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME)) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è·å¾—ä¸€ä¸ª AnnotationAwareAspectJAutoProxyCreator çš„ beanDefinition</span></span><br><span class="line">RootBeanDefinition beanDefinition = <span class="keyword">new</span> RootBeanDefinition(cls);</span><br><span class="line">beanDefinition.setSource(source);</span><br><span class="line">beanDefinition.getPropertyValues().add(<span class="string">"order"</span>, Ordered.HIGHEST_PRECEDENCE);</span><br><span class="line">beanDefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line"><span class="comment">// æ³¨å†Œåä¸º org.springframework.aop.config.internalAutoProxyCreator çš„ç±»</span></span><br><span class="line"><span class="comment">// å®é™…å¯¹åº”çš„æ˜¯ AnnotationAwareAspectJAutoProxyCreator ç±»ï¼Œè€Œè¿™ä¸ªç±»æ˜¯ç”¨æ¥ä½¿@Aspectèµ·ä½œç”¨çš„</span></span><br><span class="line">registry.registerBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME, beanDefinition);</span><br><span class="line"><span class="keyword">return</span> beanDefinition;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå¿…é¡»è¦ä½¿ç”¨ <code>@EnableAspectJAutoProxy</code> æ³¨è§£ æ‰èƒ½ä½¿ Spring AOP èµ·åˆ°ä½œç”¨ï¼Œç»è¿‡ä¸Šé¢çš„åˆ†æå°±èƒ½å¤Ÿç»™å‡ºç­”æ¡ˆäº†ï¼Œå› ä¸ºåªæœ‰æ·»åŠ äº† <code>@EnableAspectJAutoProxy</code> è¿™ä¸ªæ³¨è§£ï¼Œæ‰èƒ½ä½¿è§£æ <code>@Aspect</code> æ³¨è§£çš„ <strong>AnnotationAwareAspectJAutoProxyCreator</strong> æ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚</p><p>é‚£ä¹ˆ <strong>AnnotationAwareAspectJAutoProxyCreator</strong> æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ã€‚ã€‚</p><h3 id="2-AnnotationAwareAspectJAutoProxyCreator-å®ç°AOPåŠŸèƒ½"><a href="#2-AnnotationAwareAspectJAutoProxyCreator-å®ç°AOPåŠŸèƒ½" class="headerlink" title="2. AnnotationAwareAspectJAutoProxyCreator å®ç°AOPåŠŸèƒ½"></a>2. AnnotationAwareAspectJAutoProxyCreator å®ç°AOPåŠŸèƒ½</h3><h4 id="ç±»ç»“æ„åˆæ­¥åˆ†æ"><a href="#ç±»ç»“æ„åˆæ­¥åˆ†æ" class="headerlink" title="ç±»ç»“æ„åˆæ­¥åˆ†æ"></a>ç±»ç»“æ„åˆæ­¥åˆ†æ</h4><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20191117135450.jpg" alt="å›¾1"></p><p>æ ¹æ®ä¸Šé¢çš„å›¾ç‰‡å¯ä»¥çœ‹å‡º AnnotationAwareAspectJAutoProxyCreator æœ‰ä¸¤ä¸ªé¡¶çº§æ¥å£ï¼Œåˆ†åˆ«æ˜¯ BeanPostProcesser å’Œ Aware æ¥å£ã€‚</p><p>Aware æ¥å£ä¸»è¦ç”¨äºæ ‡è®°è¶…çº§æ¥å£ï¼Œç”¨äºæŒ‡ç¤ºbeanæœ‰èµ„æ ¼é€šè¿‡å›è°ƒæ ·å¼æ–¹æ³•ç”±Springå®¹å™¨é€šçŸ¥ç‰¹å®šæ¡†æ¶å¯¹è±¡ã€‚</p><p>BeanPostProcesser å¯ä»¥é€šè¿‡å®ç° BeanPostProcesser å…è®¸è‡ªå®šä¹‰ä¿®æ”¹æ–°çš„beanå®ä¾‹ã€‚ å…¶ä¸­åŒ…æ‹¬ä¸¤ä¸ªåç½®å¤„ç†å™¨ï¼š1.<code>postProcessBeforeInitialization(Object bean, String beanName)</code>  2.<code>postProcessAfterInitialization(Object bean, String beanName)</code> åˆ†åˆ«é’ˆå¯¹åˆå§‹åŒ–å‰åçš„æ‹¦æˆªå¤„ç†ã€‚</p><h5 id="a-AbstractAutoProxyCreator"><a href="#a-AbstractAutoProxyCreator" class="headerlink" title="a. AbstractAutoProxyCreator"></a>a. AbstractAutoProxyCreator</h5><p>åœ¨é€šè¿‡ä¸Šé¢å›¾ç‰‡ä¸­æ‰€çœ‹åˆ°çš„ AbstractAutoProxyCreator ç»§æ‰¿äº† ProxyProcessorSupport ç±»</p><table><thead><tr><th>ç»§æ‰¿ç±»/æ¥å£</th><th>ä½œç”¨</th><th>éœ€è¦å®ç°æ–¹æ³•</th></tr></thead><tbody><tr><td>ProxyConfigç±»</td><td>ç”¨äºåˆ›å»ºä»£ç†çš„é…ç½®çš„ä¾¿åˆ©è¶…ç±»ï¼Œä¿è¯æ‰€æœ‰çš„ä»£ç†åˆ›å»ºç±»æœ‰ä¸€è‡´çš„å±æ€§</td><td></td></tr><tr><td>Orderedæ¥å£</td><td>è¡¨ç¤ºç»§æ‰¿ç±»æ˜¯æœ‰åºçš„</td><td></td></tr><tr><td>BeanClassLoaderAwareæ¥å£</td><td>ä½¿ç”¨æŒ‡å®šçš„classLoaderæ¥åŠ è½½Bean</td><td>setBeanClassLoader(ClassLoader classLoader)</td></tr><tr><td>AopInfrastructureBeanæ¥å£</td><td>æ ‡ç¤ºè¯¥Beanæ˜¯ä½œä¸ºSpring AOPçš„åŸºç¡€ç»„ä»¶è¿›è¡Œä½¿ç”¨ï¼Œå› æ­¤ä¸ä¼šè¢«ä»£ç†ï¼Œå³ä½¿è¢«PointCutæŒ‡å®šåˆ°ä¹Ÿä¸ä¼šè¢«ä»£ç†åˆ°</td><td></td></tr><tr><td>BeanFactoryAware</td><td>ä½¿ç”¨æŒ‡å®šçš„ BeanFactory æ¥å®ä¾‹åŒ–Bean</td><td>void setBeanFactory(BeanFactory beanFactory)</td></tr></tbody></table><h5 id="b-SmartInstantiationAwareBeanPostProcessor"><a href="#b-SmartInstantiationAwareBeanPostProcessor" class="headerlink" title="b. SmartInstantiationAwareBeanPostProcessor"></a>b. SmartInstantiationAwareBeanPostProcessor</h5><p>AbstractAutoProxyCreator -&gt; å®ç°è‡ª <code>SmartInstantiationAwareBeanPostProcessor</code>  -&gt; ç»§æ‰¿è‡ª <code>InstantiationAwareBeanPostProcessor</code> -&gt; ç»§æ‰¿è‡ª <code>BeanPostProcessor</code>.</p><ul><li>InstantiationAwareBeanPostProcessor</li></ul><p>åœ¨è¿™ä¸ªæ¥å£ä¸­ï¼Œä¸ä»…ä»…æœ‰ç»§æ‰¿äº BeanPostProcessor çš„ <code>postProcessBeforeInitialization(Object bean, String beanName)</code>  å’Œ <code>postProcessAfterInitialization(Object bean, String beanName)</code> ä¸¤ä¸ªBeanåˆå§‹åŒ–å‰åçš„å¤„ç†æ–¹æ³•ï¼Œæœ¬èº«è¿˜å®šä¹‰äº† <code>postProcessProperties</code> å’Œ <code>postProcessPropertyValues</code>æ–¹æ³•ã€‚ä½œç”¨æ˜¯åœ¨é’ˆå¯¹Beançš„åˆå§‹åŒ–åå¯¹å±æ€§è¿›è¡Œåç½®å¤„ç†ã€‚</p><ul><li>SmartInstantiationAwareBeanPostProcessor</li></ul><p>åœ¨è¿™ä¸ªæ¥å£ä¸­å®šä¹‰ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ä¸º <code>default Class&lt;?&gt; predictBeanType(Class&lt;?&gt; beanClass, String beanName)</code> ç”¨æ¥é¢„æµ‹ä½¿ç”¨BeanPostProcessorçš„postProcessBeforeInstantiationæ–¹æ³•çš„è¿”å›ç±»å‹ï¼Œé»˜è®¤ä¸ºnullã€‚<code>default Constructor&lt;?&gt;[] determineCandidateConstructors(Class&lt;?&gt; beanClass, String beanName)</code> ç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå€™é€‰çš„æ„é€ å™¨ã€‚</p><h4 id="AbstractAutoProxyCreatorç±»æºç åˆ†æ"><a href="#AbstractAutoProxyCreatorç±»æºç åˆ†æ" class="headerlink" title="AbstractAutoProxyCreatorç±»æºç åˆ†æ"></a>AbstractAutoProxyCreatorç±»æºç åˆ†æ</h4><p>åœ¨ <code>AbstractAutoProxyCreator</code> ä½œä¸º <code>AnnotationAwareAspectJAutoProxyCreator</code> çš„çˆ¶ç±»ï¼Œèµ·åˆ°äº†éå¸¸é‡è¦çš„ä½œç”¨ã€‚</p><p>åœ¨ <code>AbstractAutoProxyCreator</code> ä¸­ï¼Œå®ç°äº† <code>BeanPostProcessor</code> çš„åˆå§‹åŒ–å‰åå¤„ç†æ–¹æ³•ï¼Œç”¨æ¥é’ˆå¯¹æ¯æ¬¡åˆå§‹åŒ–Beanå‰åå¯¹åˆ‡é¢çš„è¯†åˆ«åˆ¤æ–­å’Œå¯¹ç¬¦åˆæ¡ä»¶çš„Beanè¿›è¡Œé€šçŸ¥çš„ä»£ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// postProcessBeforeInitialization ,BeanPostProcessorçš„å®ç°æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInstantiation</span><span class="params">(Class&lt;?&gt; beanClass, String beanName)</span> </span>&#123;</span><br><span class="line">Object cacheKey = getCacheKey(beanClass, beanName); <span class="comment">//è·å¾—beanClass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!StringUtils.hasLength(beanName) || !<span class="keyword">this</span>.targetSourcedBeans.contains(beanName)) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.advisedBeans.containsKey(cacheKey)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (isInfrastructureClass(beanClass) || shouldSkip(beanClass, beanName)) &#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†@AspectJæ³¨è§£å®šä¹‰çš„åˆ‡é¢ç±»è¿˜æ˜¯ å®ç°Adviceã€Pointcutã€Advisorã€AopInfrastructureBean</span></span><br><span class="line"><span class="keyword">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE); <span class="comment">//æ·»åŠ åˆ°advisedBeansé‡Œé¢ï¼Œç­‰å¾…å¤„ç†</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœä¸æ˜¯åŸºç¡€è®¾æ–½çš„ç±»</span></span><br><span class="line">TargetSource targetSource = getCustomTargetSource(beanClass, beanName); <span class="comment">//è·å¾—targetSource</span></span><br><span class="line"><span class="keyword">if</span> (targetSource != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasLength(beanName)) &#123;</span><br><span class="line"><span class="keyword">this</span>.targetSourcedBeans.add(beanName);</span><br><span class="line">&#125;</span><br><span class="line">Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(beanClass, beanName, targetSource);</span><br><span class="line">Object proxy = createProxy(beanClass, beanName, specificInterceptors, targetSource); <span class="comment">//åˆ›å»ºä»£ç†ç±»</span></span><br><span class="line"><span class="keyword">this</span>.proxyTypes.put(cacheKey, proxy.getClass());</span><br><span class="line"><span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨postProcessBeforeInstantiationå®ç°ç±»ä¸­ï¼Œå…·ä½“æµç¨‹å¤§è‡´ä¸º å¦‚æœæ˜¯Aspectåˆ‡é¢ç±»ï¼Œåˆ™å°†ç±»æ·»åŠ åˆ°advisedBeansä¸­ç­‰å¾…è¿›è¡ŒAdviceçš„ç»„è£…ï¼Œå¦‚æœä¸æ˜¯åˆ‡é¢ç±»ï¼Œåˆ™ä¼šå…ˆå»åˆ¤æ–­æ˜¯å¦è‡ªå®šä¹‰ä¸€ä¸ª  customTargetSourceCreators æ•°ç»„ ï¼Œå¦‚æœå®šä¹‰äº†ã€‚åˆ™ç»„è£…æˆè‡ªå®šä¹‰çš„ä»£ç†ç±»è¿›è¡Œè¿”å›ã€‚</p><h5 id="1-åˆ¤æ–­æ˜¯å¦æ˜¯ä¸ªåˆ‡é¢"><a href="#1-åˆ¤æ–­æ˜¯å¦æ˜¯ä¸ªåˆ‡é¢" class="headerlink" title="1. åˆ¤æ–­æ˜¯å¦æ˜¯ä¸ªåˆ‡é¢"></a>1. åˆ¤æ–­æ˜¯å¦æ˜¯ä¸ªåˆ‡é¢</h5><p>é‚£ä¹ˆæœ€ä¸»è¦çš„é—®é¢˜æ˜¯å¦‚ä½•è¿›è¡Œåˆ¤æ–­æ˜¯å¦æ˜¯Aspectåˆ‡é¢ç±»å‘¢ã€‚åªæœ‰ç³»ç»Ÿè®¤ä¸ºæ˜¯åˆ‡é¢ç±»ï¼Œæ‰èƒ½è¿›è¡Œæ¥ä¸‹æ¥çš„ç»„è£…Adviceå‘é€šçŸ¥çš„åç»­æ“ä½œã€‚å¦åˆ™å°±ä¸èƒ½è¿›è¡Œé€šçŸ¥äº†ã€‚<br>æ‰€ä»¥å…³é”®ç‚¹åœ¨äº <code>isInfrastructureClass</code> æ–¹æ³•ã€‚</p><p>åœ¨ AnnotationAwareAspectJAutoProxyCreator ä¸­å­˜åœ¨ çš„isInfrastructureClass å®ç°æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isInfrastructureClass</span><span class="params">(Class&lt;?&gt; beanClass)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// åŠ ä¸Šçˆ¶ç±»ä¸­çš„isInfrastructureClassåˆ¤æ–­è§„åˆ™</span></span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">super</span>.isInfrastructureClass(beanClass) ||</span><br><span class="line">(<span class="keyword">this</span>.aspectJAdvisorFactory != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.aspectJAdvisorFactory.isAspect(beanClass)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAspect</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (hasAspectAnnotation(clazz) &amp;&amp; !compiledByAjc(clazz));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ¨è¿™é‡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ Aspect æ³¨è§£</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">hasAspectAnnotation</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (AnnotationUtils.findAnnotation(clazz, Aspect.class) != <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// AbstractAutoProxyCreator ä¸­çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isInfrastructureClass</span><span class="params">(Class&lt;?&gt; beanClass)</span> </span>&#123;</span><br><span class="line"><span class="keyword">boolean</span> retVal = Advice.class.isAssignableFrom(beanClass) || <span class="comment">//æ˜¯å¦å®ç° Advice</span></span><br><span class="line">Pointcut.class.isAssignableFrom(beanClass) || <span class="comment">//æ˜¯å¦å®ç° Pointcut</span></span><br><span class="line">Advisor.class.isAssignableFrom(beanClass) || <span class="comment">//æ˜¯å¦å®ç° Advisor</span></span><br><span class="line">AopInfrastructureBean.class.isAssignableFrom(beanClass); <span class="comment">//æ˜¯å¦å®ç° AopInfrastructureBean</span></span><br><span class="line"><span class="keyword">if</span> (retVal &amp;&amp; logger.isTraceEnabled()) &#123;</span><br><span class="line">logger.trace(<span class="string">"Did not attempt to auto-proxy infrastructure class ["</span> + beanClass.getName() + <span class="string">"]"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> retVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-è¿›è¡Œä»£ç†"><a href="#2-è¿›è¡Œä»£ç†" class="headerlink" title="2.è¿›è¡Œä»£ç†"></a>2.è¿›è¡Œä»£ç†</h5><p>çœŸæ­£çš„ä»£ç†æ˜¯å‘ç”Ÿåœ¨å®ç°çš„ <code>beanPostProcessor</code> çš„ <code>postProcessAfterInitialization</code></p><p>åœ¨ <code>AbstractAutoProxyCreator</code> ä¸­æä¾›ç±»ä¸€ä¸ªåˆå§‹åŒ–åç½®å¤„ç†å™¨ <code>postProcessAfterInitialization</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(@Nullable Object bean, String beanName)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (bean != <span class="keyword">null</span>) &#123;</span><br><span class="line">Object cacheKey = getCacheKey(bean.getClass(), beanName);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.earlyProxyReferences.remove(cacheKey) != bean) &#123; <span class="comment">// å¦‚æœä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">// å¦‚æœéœ€è¦è¿›è¡Œä»£ç†çš„åŒ…è£…</span></span><br><span class="line"><span class="keyword">return</span> wrapIfNecessary(bean, beanName, cacheKey);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœ‰å¿…è¦ï¼ŒåŒ…è£…ç»™å®šçš„beanï¼Œå³æ˜¯å¦æœ‰èµ„æ ¼è¢«ä»£ç†</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">wrapIfNecessary</span><span class="params">(Object bean, String beanName, Object cacheKey)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasLength(beanName) &amp;&amp; <span class="keyword">this</span>.targetSourcedBeans.contains(beanName)) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœåœ¨ postProcessBeforeInitialization ä¸­å®šä¹‰äº†targetSourcedBeans,åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (Boolean.FALSE.equals(<span class="keyword">this</span>.advisedBeans.get(cacheKey))) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœå·²ç»æ·»åŠ åˆ°advisedBeansä¸­ä¹Ÿç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯ä¸€ä¸ªåŸºæœ¬é…ç½®Aspectç±»ï¼Œåˆ™æ”¾åˆ°advisedBeansä¸­ã€‚</span></span><br><span class="line"><span class="keyword">if</span> (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) &#123;</span><br><span class="line"><span class="keyword">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE);</span><br><span class="line"><span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºAdviceï¼Œåˆ›å»ºadviceçš„è¿‡ç¨‹å…ˆçœç•¥</span></span><br><span class="line">Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">// Adviceå­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºéœ€è¦ä»£ç†</span></span><br><span class="line"><span class="keyword">if</span> (specificInterceptors != DO_NOT_PROXY) &#123;</span><br><span class="line"><span class="keyword">this</span>.advisedBeans.put(cacheKey, Boolean.TRUE);</span><br><span class="line"><span class="comment">// åˆ›å»ºä»£ç†</span></span><br><span class="line">Object proxy = createProxy(</span><br><span class="line">bean.getClass(), beanName, specificInterceptors, <span class="keyword">new</span> SingletonTargetSource(bean));</span><br><span class="line"><span class="keyword">this</span>.proxyTypes.put(cacheKey, proxy.getClass());</span><br><span class="line"><span class="comment">// è¿”å›ä»£ç†å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE);</span><br><span class="line"><span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AOPå¯¹ç±»çš„åŠ è½½åŒ…è£…è¿‡ç¨‹"><a href="#AOPå¯¹ç±»çš„åŠ è½½åŒ…è£…è¿‡ç¨‹" class="headerlink" title="AOPå¯¹ç±»çš„åŠ è½½åŒ…è£…è¿‡ç¨‹"></a>AOPå¯¹ç±»çš„åŠ è½½åŒ…è£…è¿‡ç¨‹</h3><p>æ¯æ¬¡åœ¨åˆ›å»ºBeanæ—¶ï¼Œä¼šé€šè¿‡createBean()æ–¹æ³•æ¥åˆ›å»ºBeanï¼Œå…¶ä¸­åœ¨çœŸæ­£çš„åˆ›å»ºBeanä¹‹å‰æ‰§è¡Œäº†resolveBeforeInstantiation å»ç”Ÿæˆä»£ç†Beanã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Object bean = resolveBeforeInstantiation(beanName, mbdToUse);</span><br><span class="line"><span class="keyword">if</span> (bean != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºBean</span></span><br><span class="line">Object beanInstance = doCreateBean(beanName, mbdToUse, args);</span><br><span class="line"><span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">logger.trace(<span class="string">"Finished creating instance of bean '"</span> + beanName + <span class="string">"'"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> beanInstance;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”Ÿæˆä»£ç†å¯¹è±¡æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">resolveBeforeInstantiation</span><span class="params">(String beanName, RootBeanDefinition mbd)</span> </span>&#123;</span><br><span class="line">Object bean = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (!Boolean.FALSE.equals(mbd.beforeInstantiationResolved)) &#123;</span><br><span class="line"><span class="comment">// Make sure bean class is actually resolved at this point.</span></span><br><span class="line"><span class="keyword">if</span> (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) &#123;</span><br><span class="line">Class&lt;?&gt; targetType = determineTargetType(beanName, mbd);</span><br><span class="line"><span class="keyword">if</span> (targetType != <span class="keyword">null</span>) &#123;</span><br><span class="line">bean = applyBeanPostProcessorsBeforeInstantiation(targetType, beanName);</span><br><span class="line"><span class="comment">// ã€‚ã€‚ã€‚</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">mbd.beforeInstantiationResolved = (bean != <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡ŒçœŸæ­£æ‰§è¡Œäº†åˆ›å»ºä»£ç†å¯¹è±¡ä¸­çš„beanåˆå§‹åŒ–å‰åæ–¹æ³•ã€‚å…ˆæ‰§è¡Œäº† <code>applyBeanPostProcessorsBeforeInstantiation</code> , è¿›è¡ŒAOPåˆ‡é¢ç±»çš„è¯†åˆ«ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">applyBeanPostProcessorsBeforeInstantiation</span><span class="params">(Class&lt;?&gt; beanClass, String beanName)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (BeanPostProcessor bp : getBeanPostProcessors()) &#123;</span><br><span class="line"><span class="keyword">if</span> (bp <span class="keyword">instanceof</span> InstantiationAwareBeanPostProcessor) &#123;</span><br><span class="line"><span class="comment">// å¯¹æ¯ä¸€ä¸ªBeanåˆ›å»ºå‰éƒ½è¿›è¡Œä¸€æ¬¡å¤„ç†ï¼Œå‰ææ˜¯ è¿™ä¸ªç±»å®ç°</span></span><br><span class="line"><span class="comment">// InstantiationAwareBeanPostProcessor æ¥å£ã€‚</span></span><br><span class="line">InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp;</span><br><span class="line"><span class="comment">// å¦‚æœå®ç°è¿™ä¸ªæ¥å£ï¼Œåˆ™è¿›è¡Œå®ä¾‹åŒ–å‰çš„åç½®å¤„ç†ã€‚</span></span><br><span class="line">Object result = ibp.postProcessBeforeInstantiation(beanClass, beanName);</span><br><span class="line"><span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨createBeanæ–¹æ³•æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Initialize the bean instance.</span></span><br><span class="line">Object exposedObject = bean;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// å¡«å……Bean</span></span><br><span class="line">populateBean(beanName, mbd, instanceWrapper);</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–Bean</span></span><br><span class="line">exposedObject = initializeBean(beanName, exposedObject, mbd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ initializeBean ä¸­æ‰çœŸæ­£çš„æ‰§è¡Œç»§æ‰¿ BeanPostProcessor ç±»çš„Beanåˆå§‹åŒ–å‰åçš„CallBackæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mbd == <span class="keyword">null</span> || !mbd.isSynthetic()) &#123;</span><br><span class="line">wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">invokeInitMethods(beanName, wrappedBean, mbd);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(</span><br><span class="line">(mbd != <span class="keyword">null</span> ? mbd.getResourceDescription() : <span class="keyword">null</span>),</span><br><span class="line">beanName, <span class="string">"Invocation of init method failed"</span>, ex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (mbd == <span class="keyword">null</span> || !mbd.isSynthetic()) &#123;</span><br><span class="line">wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œç»¼ä¸Šï¼Œåœ¨ createbean æ–¹æ³•ä¹‹å‰ä¼šæ‰§è¡Œå¯¹åˆ‡é¢ç±»çš„è¯†åˆ«ï¼Œä¹Ÿå°±æ˜¯åˆ‡é¢ç±»çš„å‰ç½®å¤„ç†ã€‚ä½†çœŸæ­£å»æ‰§è¡Œæ‰€æœ‰çš„Beançš„é€šçŸ¥ï¼Œéƒ½æ˜¯åœ¨ initializeBean ä¸­çš„  applyBeanPostProcessorsAfterInitialization æ–¹æ³•ä¸­æ‰§è¡Œçš„ã€‚</p><h3 id="Springåˆ›å»ºä»£ç†çš„æ–¹å¼"><a href="#Springåˆ›å»ºä»£ç†çš„æ–¹å¼" class="headerlink" title="Springåˆ›å»ºä»£ç†çš„æ–¹å¼"></a>Springåˆ›å»ºä»£ç†çš„æ–¹å¼</h3><p>SpringAOPåˆ›å»ºä»£ç†æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§ï¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†ã€‚ç¬¬äºŒç§ï¼šä½¿ç”¨CGLIBä»£ç†ã€‚ä¸‹é¢æ¥é’ˆå¯¹ä»£ç†æ–¹å¼çš„é€‰æ‹©æ–¹å¼ï¼ŒæŸ¥çœ‹æºç ä¸€æ¢ç©¶ç«Ÿã€‚</p><p>åœ¨ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„åœ¨ <code>AbstractAutoProxyCreator</code> ä¸­çš„åœ¨åç½®å¤„ç†å™¨ä¸­ <code>postProcessAfterInitialization</code> çš„ <code>wrapIfNecessary</code>ä¸­è¿›è¡Œäº†å¯¹Beançš„ä»£ç†åŒ…è£…å¤„ç†.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœå­˜åœ¨å¯ç”¨çš„é€šçŸ¥ï¼Œåˆ™å¯¹Beanè¿›è¡Œä»£ç†</span></span><br><span class="line">Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">if</span> (specificInterceptors != DO_NOT_PROXY) &#123;</span><br><span class="line"><span class="keyword">this</span>.advisedBeans.put(cacheKey, Boolean.TRUE);</span><br><span class="line"><span class="comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class="line">Object proxy = createProxy(</span><br><span class="line">bean.getClass(), beanName, specificInterceptors, <span class="keyword">new</span> SingletonTargetSource(bean));</span><br><span class="line"><span class="keyword">this</span>.proxyTypes.put(cacheKey, proxy.getClass());</span><br><span class="line"><span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>createProxy</code> ä¸­å†³å®šäº†ä½¿ç”¨å“ªç§æ–¹å¼ï¼ˆJDKåŠ¨æ€ä»£ç†ã€CGLIBä»£ç†ï¼‰è¿›è¡Œä»£ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">createProxy</span><span class="params">(Class&lt;?&gt; beanClass, @Nullable String beanName,</span></span></span><br><span class="line"><span class="function"><span class="params">@Nullable Object[] specificInterceptors, TargetSource targetSource)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.beanFactory <span class="keyword">instanceof</span> ConfigurableListableBeanFactory) &#123;</span><br><span class="line">AutoProxyUtils.exposeTargetClass((ConfigurableListableBeanFactory) <span class="keyword">this</span>.beanFactory, beanName, beanClass);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ProxyFactory proxyFactory = <span class="keyword">new</span> ProxyFactory();</span><br><span class="line">proxyFactory.copyFrom(<span class="keyword">this</span>);<span class="comment">// å¤åˆ¶é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!proxyFactory.isProxyTargetClass()) &#123;<span class="comment">//è¿”å›æ˜¯å¦ç›´æ¥ä»£ç†ç›®æ ‡ç±»ä»¥åŠä»»ä½•æ¥å£ã€‚</span></span><br><span class="line"><span class="keyword">if</span> (shouldProxyTargetClass(beanClass, beanName)) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ proxy-target-class æ ‡ç­¾å±æ€§è¿”å›trueï¼Œåˆ™è¡¨æ˜éœ€è¦åŸºäºç±»çš„ä»£ç†ï¼Œ</span></span><br><span class="line"><span class="comment">// åä¹‹åˆ™éœ€è¦åŸºäºæ¥å£çš„ä»£ç†</span></span><br><span class="line">proxyFactory.setProxyTargetClass(<span class="keyword">true</span>); <span class="comment">//ä½¿ç”¨CGLIBä»£ç†ï¼ˆtrueï¼‰</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">evaluateProxyInterfaces(beanClass, proxyFactory); <span class="comment">//æ£€æŸ¥æ˜¯å¦å®ç°äº†æ¥å£</span></span><br><span class="line"><span class="comment">// å¦‚æœå®ç°äº†æ¥å£ï¼Œåˆ™è®¾ç½®interfaceï¼Œå¦åˆ™è®¾ç½®proxyTargetClassä¸ºtrueï¼Œä½†å‰ææ˜¯</span></span><br><span class="line"><span class="comment">// ç”¨æˆ·æ²¡æœ‰è‡ªå·±è®¾ç½®proxyTargetClasså±æ€§</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * if (hasReasonableProxyInterface) &#123;</span></span><br><span class="line"><span class="comment"> * Must allow for introductions; can't just set interfaces to the target's interfaces only.</span></span><br><span class="line"><span class="comment"> *for (Class&lt;?&gt; ifc : targetInterfaces) &#123;</span></span><br><span class="line"><span class="comment"> *proxyFactory.addInterface(ifc);</span></span><br><span class="line"><span class="comment"> *&#125;</span></span><br><span class="line"><span class="comment">     *&#125;else &#123;</span></span><br><span class="line"><span class="comment"> *proxyFactory.setProxyTargetClass(true);</span></span><br><span class="line"><span class="comment"> *&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">Advisor[] advisors = buildAdvisors(beanName, specificInterceptors);</span><br><span class="line">proxyFactory.addAdvisors(advisors);</span><br><span class="line">proxyFactory.setTargetSource(targetSource);</span><br><span class="line">customizeProxyFactory(proxyFactory);</span><br><span class="line"></span><br><span class="line">proxyFactory.setFrozen(<span class="keyword">this</span>.freezeProxy);</span><br><span class="line"><span class="keyword">if</span> (advisorsPreFiltered()) &#123;</span><br><span class="line">proxyFactory.setPreFiltered(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> proxyFactory.getProxy(getProxyClassLoader());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œè®¾ç½®äº†æœ‰å…³äºproxyFactoryçš„ç›¸å…³å±æ€§ï¼Œ å¦‚æ˜¯å¦ç»§æ‰¿æ¥å£çš„interfaceï¼Œå’Œ ProxyTargetClass ã€‚å¦‚æœæ²¡æœ‰å®ç°interfaceï¼Œåˆ™ä¼šè‡ªåŠ¨å°†ProxyTargeClassä¸ºtrueï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸¤ä¸ªå±æ€§æ˜¯ç›¸å¯¹çš„ã€‚</p><p>åœ¨æœ€åçš„retrunçš„ <code>getProxy()</code> æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨ <code>DefaultAopProxyFactory</code> ç±»ä¸­çš„ <code>createAopProxy</code> æ–¹æ³•å†³å®šä½¿ç”¨å“ªä¸­ä»£ç†æ–¹å¼è¿›è¡Œä»£ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AopProxy <span class="title">createAopProxy</span><span class="params">(AdvisedSupport config)</span> <span class="keyword">throws</span> AopConfigException </span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ä¸‹é¢çš„ä¸‰ä¸ªæ¡ä»¶ç®€å•åˆ†æä¸€ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*   æ¡ä»¶1ï¼šconfig.isOptimize() - æ˜¯å¦éœ€è¦ä¼˜åŒ–</span></span><br><span class="line"><span class="comment">*   æ¡ä»¶2ï¼šconfig.isProxyTargetClass() - æ£€æµ‹ proxyTargetClass çš„å€¼ï¼Œ</span></span><br><span class="line"><span class="comment">*   æ¡ä»¶3ï¼šhasNoUserSuppliedProxyInterfaces(config) - ç›®æ ‡ bean æ˜¯å¦å®ç°äº†æ¥å£</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span> (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœè®¾ç½®äº†optimize æˆ–è€… proxyTargetClass æˆ–è€…è®¾ç½®äº†è¿›è¡Œä»£ç†çš„æ¥å£</span></span><br><span class="line">Class&lt;?&gt; targetClass = config.getTargetClass();</span><br><span class="line"><span class="keyword">if</span> (targetClass == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> AopConfigException(<span class="string">"TargetSource cannot determine target class: "</span> +</span><br><span class="line"><span class="string">"Either an interface or a target is required for proxy creation."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> JdkDynamicAopProxy(config); <span class="comment">//å¦‚æœä»£ç†çš„æ˜¯æ¥å£ï¼Œä½¿ç”¨JDKåŠ¨æ€ä»£ç†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ObjenesisCglibAopProxy(config);<span class="comment">//å¦åˆ™ä½¿ç”¨CGlibä»£ç†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="comment">//å¦åˆ™éƒ½ä½¿ç”¨JDKè¿›è¡Œä»£ç†</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> JdkDynamicAopProxy(config);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰é¢è¯´çš„å¦‚æœè‡ªå·±è®¾ç½®ç±»proxyTargetClasså±æ€§ä¸ºtrueï¼Œå°±ä¸ä¼šåˆ¤æ–­æ˜¯ç»§æ‰¿äº†interfaceã€‚å¦‚æœæ²¡æœ‰å•ç‹¬è®¾ç½®ï¼Œåˆ™ä¼šå…ˆåˆ¤æ–­æ˜¯å¦ç»§æ‰¿äº†æ¥å£ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šè‡ªåŠ¨è®¾ç½®proxyTargetClasså±æ€§ä¸ºtrueã€‚</p><p><em>æ‰€ä»¥å¾—å‡ºç»“è®ºï¼š</em></p><ol><li><strong>å¦‚æœè®¾ç½®äº†proxyTargetClassä¸ºtrueï¼Œåˆ™ä½¿ç”¨CGLIBä»£ç†ã€‚</strong></li><li><strong>å¦‚æœæ²¡æœ‰è®¾ç½®proxyTargetClassï¼Œå¦‚æœæ˜¯æ¥å£ï¼Œåˆ™ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ã€‚å¦‚æœæ²¡æœ‰å®ç°æ¥å£ï¼Œåˆ™è¿˜æ˜¯ä¼šä½¿ç”¨CGLIBè¿›è¡Œä»£ç†ã€‚</strong> </li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springä¸­çš„è‡ªåŠ¨è£…é…</title>
      <link href="/2019/12/07/%EF%BC%88%E4%B8%89%EF%BC%89%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/"/>
      <url>/2019/12/07/%EF%BC%88%E4%B8%89%EF%BC%89%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="Springä¸­çš„è‡ªåŠ¨è£…é…"><a href="#Springä¸­çš„è‡ªåŠ¨è£…é…" class="headerlink" title="Springä¸­çš„è‡ªåŠ¨è£…é…"></a>Springä¸­çš„è‡ªåŠ¨è£…é…</h1><h2 id="Autowireã€-Qualifierã€-Primary"><a href="#Autowireã€-Qualifierã€-Primary" class="headerlink" title="@Autowireã€ @Qualifierã€@Primary"></a>@Autowireã€ @Qualifierã€@Primary</h2><p><code>@Autowire</code> æ³¨è§£æ ‡æ³¨åœ¨constructor, field, setter method ä¸Šï¼Œæ–¹ä¾¿åœ¨Springä¸­è¿›è¡Œä¾èµ–çš„æ³¨å…¥ï¼ˆ<code>dependency injection</code>ï¼‰ã€‚å’ŒJSR-330æ ‡å‡†javax.inject.Injectè¾¾åˆ°ä¸€æ ·çš„æ•ˆæœï¼Œä¸è¿‡autowiredæ—¶SpringæŒæœ‰çš„ã€‚</p><ul><li>é»˜è®¤ä½¿ç”¨Autowireæ˜¯æŒ‰ç…§ç±»å‹è¿›è¡Œæ³¨å…¥çš„ï¼Œä½†æ˜¯å¦‚æœåœ¨å®¹å™¨ä¸­å­˜åœ¨å¤šä¸ªç±»å‹ç›¸åŒçš„beanæ—¶ï¼Œ@Autowiredä¹Ÿä¼šæŒ‰ç…§åç§°è¿›è¡ŒåŒ¹é…ã€‚</li><li>ä½¿ç”¨<code>@Qualifier</code>æ³¨è§£ï¼Œåœ¨è·å–Beanæ—¶ï¼ŒæŒ‡å®šè¦è·å–çš„beançš„åç§°ã€‚</li><li>ä½¿ç”¨<code>@Primary</code>æ³¨è§£ï¼Œåœ¨å£°æ˜Beanæ—¶ï¼ŒæŒ‡å®šå¦‚æœæ³¨å…¥ï¼Œåˆ™é¦–é€‰çš„beanã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String firstName;</span><br><span class="line"><span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String firstName, String lastName)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.firstName = <span class="string">"w"</span>;</span><br><span class="line"><span class="keyword">this</span>.lastName = <span class="string">"y"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier</span>(<span class="string">"abc"</span>)</span><br><span class="line"><span class="keyword">private</span> Pet pet;</span><br><span class="line"><span class="comment">// çœç•¥getter setter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…åœ¨å£°æ˜Beanæ—¶ï¼Œä½¿ç”¨Primaryè¿›è¡ŒæŒ‡å®šã€‚</span></span><br><span class="line"><span class="meta">@Bean</span>(<span class="string">"dotdot"</span>)</span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Pet <span class="title">pet2</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Pet(<span class="string">"dotdot"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨åŒæ—¶æŒ‡å®šQualifierå’ŒPrimaryæ—¶ï¼Œä¼šä»¥<strong>Qualifier</strong>ä¸ºä¸»ã€‚</p></blockquote><h2 id="Injectã€-Named"><a href="#Injectã€-Named" class="headerlink" title="@Injectã€@Named"></a>@Injectã€@Named</h2><p>@Injectã€@Named éƒ½æ˜¯Javaxè§„èŒƒçš„æ³¨è§£ï¼Œå¹¶ä¸æ˜¯Springçš„æ³¨è§£ã€‚</p><p>ä½¿ç”¨ Inject æ³¨è§£åŒæ ·èƒ½å¤Ÿæ ‡æ³¨åœ¨constructor, field, setter method ä¸Šã€‚åŸºæœ¬èƒ½å¤Ÿä»£æ›¿ Autowired æ³¨è§£ï¼Œå¹¶ä¸”èƒ½å¤Ÿä½¿ç”¨ Named æ³¨è§£ï¼ŒæŒ‡å®šåç§°è¿›è¡Œå®ä¾‹çš„æ³¨å…¥ï¼Œå¯ä»¥ä»£æ›¿ Qualifier æ³¨è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String firstName;</span><br><span class="line"><span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String firstName, String lastName)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.firstName = <span class="string">"w"</span>;</span><br><span class="line"><span class="keyword">this</span>.lastName = <span class="string">"y"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="meta">@Named</span>(<span class="string">"abc"</span>)</span><br><span class="line"><span class="keyword">private</span> Pet pet;</span><br><span class="line"><span class="comment">// çœç•¥getter setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åŒºåˆ«ç‚¹åœ¨äº Autowired æ³¨è§£æ”¯æŒ required() å±æ€§ã€‚è€Œ Inject æ³¨è§£å¹¶ä¸æ”¯æŒã€‚å¯ä»¥ä½¿ç”¨java.util.Optionalæˆ–è€…Spring Framework 5.0 åæä¾›çš„ @Nullable æ³¨è§£ï¼Œæ ‡å¿—åœ¨æ„é€ æ–¹æ³•ä¸Šã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleMovieLister</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMovieFinder</span><span class="params">(@Nullable MovieFinder movieFinder)</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springçš„å¯åŠ¨å’Œæ³¨å†Œ</title>
      <link href="/2019/12/05/Spring%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2019/12/05/Spring%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯åŠ¨Springåº”ç”¨"><a href="#å¯åŠ¨Springåº”ç”¨" class="headerlink" title="å¯åŠ¨Springåº”ç”¨"></a>å¯åŠ¨Springåº”ç”¨</h1><p>åªéœ€ç®€å•çš„å‡ è¡Œä»£ç ä¾¿å¯å£°æ˜ã€åˆ›å»ºä¸€ä¸ªSpringåº”ç”¨å®¹å™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(BasicConfig.class);</span><br><span class="line"><span class="comment">// å‰ææ˜¯éœ€è¦ä¼ å…¥ç»™å®šçš„classé…ç½®ç±»</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// ä½¿ç”¨Configuration è¡¨æ˜æ˜¯ä¸ªé…ç½®ç±»</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span><span class="comment">// å¼€å§‹AOPæ”¯æŒ</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.nanyin"</span>)<span class="comment">//æ‰«æåŒ…</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicConfig</span> </span>&#123;</span><br><span class="line"><span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"1"</span>,<span class="string">"2"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ›å»ºå®¹å™¨"><a href="#åˆ›å»ºå®¹å™¨" class="headerlink" title="åˆ›å»ºå®¹å™¨"></a>åˆ›å»ºå®¹å™¨</h1><p>åœ¨è¿›å…¥åˆ° <code>new AnnotationConfigApplicationContext()</code> æ–¹æ³•åï¼Œè¿›è¡Œå¯¹å®¹å™¨çš„å£°æ˜å’Œåˆ›å»ºã€‚å…¶ä¸­ä¼šå…ˆå¯¹ç»™å®šçš„é…ç½®æ–‡ä»¶ç±»è¿›è¡Œæ ¡éªŒå’Œæ³¨å†Œã€‚è°ƒç”¨è¿‡ç¨‹è‰å›¾å¦‚ä¸‹æ‰€ç¤ºï¼ˆä»…å‚è€ƒï¼‰ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8.png" alt="åˆ›å»ºå®¹å™¨.png"></p><p>å¯ä»¥çœ‹åˆ°åŸºæœ¬çš„è°ƒç”¨é¡ºåºï¼Œä¸‹é¢æ ¹æ®å›¾ä¸­æ‰€ç¤ºï¼Œé’ˆå¯¹è°ƒç”¨çš„æ–¹æ³•è¿›è¡Œæºç çš„åˆ†æã€‚</p><h2 id="åˆ›å»º-AnnotationConfigApplicationContext"><a href="#åˆ›å»º-AnnotationConfigApplicationContext" class="headerlink" title="åˆ›å»º AnnotationConfigApplicationContext"></a>åˆ›å»º AnnotationConfigApplicationContext</h2><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20191123153835.png" alt="20191123153835.png"></p><p>å› ä¸ºåœ¨ä½¿ç”¨ new AnnotationConfigApplicationContext() æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„åŒæ—¶ä¼šå…ˆå»è°ƒç”¨çˆ¶ç±»çš„ç©ºå‚æ•°çš„æ„é€ æ–¹æ³•ã€‚æ‰€ä»¥æ ¹æ®å›¾ä¸­çš„å…³ç³»ï¼Œéœ€è¦å…ˆçœ‹çˆ¶ç±»ä¸­é€šè¿‡è¿™äº›æ„é€ æ–¹æ³•åšäº†ä»€ä¹ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">GenericApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.beanFactory = <span class="keyword">new</span> DefaultListableBeanFactory();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AbstractApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.resourcePatternResolver = getResourcePatternResolver();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> ResourcePatternResolver <span class="title">getResourcePatternResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> PathMatchingResourcePatternResolver(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DefaultResourceLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.classLoader = ClassUtils.getDefaultClassLoader();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥å‘ç°è°ƒç”¨ <code>new AnnotationConfigApplicationContext()</code> æ—¶ä¼šå‘ç”Ÿï¼š</p><ol><li>è®¾ç½® <code>beanFactory</code> ä¸º <code>DefaultListableBeanFactory</code> ç±»å‹</li><li>è®¾ç½® <code>resourcePatternResolver</code> ä¸º <code>PathMatchingResourcePatternResolver</code> ç±»å‹</li><li>è®¾ç½® <code>classLoader</code> ä¸ºé»˜è®¤çš„çº¿ç¨‹ç¯å¢ƒçš„ <code>classLoader</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AnnotationConfigApplicationContext</span><span class="params">(Class&lt;?&gt;... componentClasses)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>();</span><br><span class="line">    register(componentClasses); <span class="comment">//æ³¨å†Œç»™å®šçš„é…ç½®ç±»Bean</span></span><br><span class="line">    refresh(); <span class="comment">//åˆ·æ–°æ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// thisè°ƒç”¨ç©ºçš„æ„é€ å‡½æ•°ï¼Œå…¶ä¸­åˆ¶å®šäº† AnnotatedBeanDefinitionReader å’Œ ClassPathBeanDefinitionScanner</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AnnotationConfigApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.reader = <span class="keyword">new</span> AnnotatedBeanDefinitionReader(<span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">this</span>.scanner = <span class="keyword">new</span> ClassPathBeanDefinitionScanner(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å‰ä¸€èŠ‚ä¸­ä½¿ç”¨äº† <code>new AnnotationConfigApplicationContext(BasicConfig.class)</code> æ¥åˆ›å»ºäº†ä¸€ä¸ª <code>AnnotationConfigApplicationContext</code> ã€‚è¿›å…¥åˆ°æºç ä¸­å¯ä»¥å‘ç°ä»–ä¼šå…ˆåˆå§‹åŒ–ä¸€ä¸ª <code>reader</code> å’Œä¸€ä¸ª <code>sacnner</code>ã€‚ åˆ†åˆ«çš„ä½œç”¨ä¸º ï¼š</p><ol><li>AnnotatedBeanDefinitionReader ç”¨äºä»¥ç¼–ç¨‹æ–¹å¼æ³¨å†ŒBeanç±»,è¿™äº›Beanä¸»è¦æŒ‡çš„æ—¶ä¸€äº›PostProcessor</li><li>ClassPathBeanDefinitionScanner ä¸€ä¸ªå¯åœ¨ç±»è·¯å¾„ä¸Šæœç´¢å€™é€‰beançš„beanå®šä¹‰æ‰«æå™¨ã€‚</li></ol><h3 id="AnnotatedBeanDefinitionReader"><a href="#AnnotatedBeanDefinitionReader" class="headerlink" title="AnnotatedBeanDefinitionReader"></a>AnnotatedBeanDefinitionReader</h3><p>ç”¨äºä»¥ç¼–ç¨‹æ–¹å¼æ³¨å†ŒBeanç±»,è¿™äº›Beanä¸»è¦æŒ‡çš„æ—¶ä¸€äº›PostProcessor.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AnnotatedBeanDefinitionReader</span><span class="params">(BeanDefinitionRegistry registry, Environment environment)</span> </span>&#123;</span><br><span class="line">Assert.notNull(registry, <span class="string">"BeanDefinitionRegistry must not be null"</span>);</span><br><span class="line">Assert.notNull(environment, <span class="string">"Environment must not be null"</span>);</span><br><span class="line"><span class="keyword">this</span>.registry = registry;</span><br><span class="line"><span class="comment">//ConditionEvaluator  ç”¨äºå¯¹ @Condition æ³¨è§£çš„è¯„ä¼°</span></span><br><span class="line"><span class="keyword">this</span>.conditionEvaluator = <span class="keyword">new</span> ConditionEvaluator(registry, environment, <span class="keyword">null</span>);</span><br><span class="line">AnnotationConfigUtils.registerAnnotationConfigProcessors(<span class="keyword">this</span>.registry);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†ç›¸å…³æ³¨è§£çš„åç½®å¤„ç†å™¨å¦‚ ConfigurationClassPostProcessor ç­‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Set&lt;BeanDefinitionHolder&gt; <span class="title">registerAnnotationConfigProcessors</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">BeanDefinitionRegistry registry, @Nullable Object source)</span> </span>&#123;</span><br><span class="line"><span class="comment">// è·å– BeanFactory,å…¶å®è¿™é‡Œè¿”å›äº†ä¸€ä¸ªthis.beanFactory,ä¹Ÿå°±æ˜¯ DefaultListableBeanFactory</span></span><br><span class="line">DefaultListableBeanFactory beanFactory = unwrapDefaultListableBeanFactory(registry);</span><br><span class="line"><span class="keyword">if</span> (beanFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!(beanFactory.getDependencyComparator() <span class="keyword">instanceof</span> AnnotationAwareOrderComparator)) &#123;</span><br><span class="line">beanFactory.setDependencyComparator(AnnotationAwareOrderComparator.INSTANCE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!(beanFactory.getAutowireCandidateResolver() <span class="keyword">instanceof</span> ContextAnnotationAutowireCandidateResolver)) &#123;</span><br><span class="line">beanFactory.setAutowireCandidateResolver(<span class="keyword">new</span> ContextAnnotationAutowireCandidateResolver());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Set&lt;BeanDefinitionHolder&gt; beanDefs = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(<span class="number">8</span>);</span><br><span class="line"><span class="comment">// æ³¨å†ŒConfigurationClassPostProcessor ä¹Ÿå°±æ˜¯å¯¹åº”çš„@Configurationæ³¨è§£postprocessor</span></span><br><span class="line"><span class="keyword">if</span> (!registry.containsBeanDefinition(CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;</span><br><span class="line">RootBeanDefinition def = <span class="keyword">new</span> RootBeanDefinition(ConfigurationClassPostProcessor.class);</span><br><span class="line">def.setSource(source);</span><br><span class="line">beanDefs.add(registerPostProcessor(registry, def, CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ³¨å†ŒAutowiredAnnotationBeanPostProcessor,å¯¹åº”çš„æ—¶@Autowiredå¯¹åº”çš„postProcessor</span></span><br><span class="line"><span class="keyword">if</span> (!registry.containsBeanDefinition(AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;</span><br><span class="line">RootBeanDefinition def = <span class="keyword">new</span> RootBeanDefinition(AutowiredAnnotationBeanPostProcessor.class);</span><br><span class="line">def.setSource(source);</span><br><span class="line">beanDefs.add(registerPostProcessor(registry, def, AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  ........</span></span><br><span class="line"><span class="keyword">return</span> beanDefs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ClassPathBeanDefinitionScanner"><a href="#ClassPathBeanDefinitionScanner" class="headerlink" title="ClassPathBeanDefinitionScanner"></a>ClassPathBeanDefinitionScanner</h3><p>ä¸€ä¸ªå¯åœ¨ç±»è·¯å¾„ä¸Šæœç´¢å€™é€‰beançš„beanå®šä¹‰æ‰«æå™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ClassPathBeanDefinitionScanner</span><span class="params">(BeanDefinitionRegistry registry, <span class="keyword">boolean</span> useDefaultFilters,</span></span></span><br><span class="line"><span class="function"><span class="params">Environment environment, @Nullable ResourceLoader resourceLoader)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">Assert.notNull(registry, <span class="string">"BeanDefinitionRegistry must not be null"</span>);</span><br><span class="line"><span class="keyword">this</span>.registry = registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (useDefaultFilters) &#123;</span><br><span class="line">registerDefaultFilters();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™é‡Œçš„environmentæ—¶åœ¨çˆ¶ç±»ä¸­çš„æ„é€ å‡½æ•°ä¸­ç»™å‡ºçš„ new StandardEnvironment()</span></span><br><span class="line">setEnvironment(environment);</span><br><span class="line">setResourceLoader(resourceLoader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„é€»è¾‘å¾ˆæ¸…æ™°ï¼š</p><ol><li>éœ€è¦æ³¨å†Œä¸€äº›é»˜è®¤çš„è¿‡æ»¤å™¨ï¼ˆFiltersï¼‰</li><li>è®¾ç½®ç¯å¢ƒå˜é‡environment</li><li>è®¾ç½®resourceLoader</li></ol><p>åœ¨å®šä¹‰å®Œæˆåè°ƒç”¨registeræ–¹æ³•è¿›è¡Œå¯¹æŒ‡å®šçš„é…ç½®æ–‡ä»¶è¿›è¡Œæ³¨å†Œã€‚</p><h2 id="register-æ³¨å†Œç»™å®šé…ç½®ç±»"><a href="#register-æ³¨å†Œç»™å®šé…ç½®ç±»" class="headerlink" title="register æ³¨å†Œç»™å®šé…ç½®ç±»"></a>register æ³¨å†Œç»™å®šé…ç½®ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Class&lt;?&gt;... componentClasses)</span> </span>&#123;</span><br><span class="line">Assert.notEmpty(componentClasses, <span class="string">"At least one component class must be specified"</span>);</span><br><span class="line"><span class="keyword">this</span>.reader.register(componentClasses); <span class="comment">//è°ƒç”¨ AnnotatedBeanDefinitionReader çš„register æ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Class&lt;?&gt;... componentClasses)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (Class&lt;?&gt; componentClass : componentClasses) &#123; </span><br><span class="line"><span class="comment">// å¯¹æ¯ä¸ªç»™å®šçš„classè¿›è¡Œ registerBean</span></span><br><span class="line">registerBean(componentClass);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="registerBean-Class-lt-gt-beanClass"><a href="#registerBean-Class-lt-gt-beanClass" class="headerlink" title="registerBean(Class&lt;?&gt; beanClass)"></a>registerBean(Class&lt;?&gt; beanClass)</h2><p>åœ¨ä¸Šä¸€æ­¥çš„ registerBean ä¸­è°ƒç”¨äº†å·²ç»åˆ›å»ºå¥½çš„ <code>AnnotatedBeanDefinitionReader</code> çš„ <code>registerBean</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Class&lt;?&gt;... componentClasses)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (Class&lt;?&gt; componentClass : componentClasses) &#123; </span><br><span class="line"><span class="comment">// å¯¹æ¯ä¸ªç»™å®šçš„classè¿›è¡Œ registerBean</span></span><br><span class="line">registerBean(componentClass);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBean</span><span class="params">(Class&lt;?&gt; beanClass)</span> </span>&#123;</span><br><span class="line">doRegisterBean(beanClass, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œå¯¹æ¯ä¸€ä¸ª class å¾ªç¯è°ƒç”¨ <code>doRegisterBean</code> æ–¹æ³•è¿›è¡Œ å¯¹ <code>BeanClass</code> çš„æ³¨å†Œæ“ä½œã€‚</p><h2 id="doRegisterBean"><a href="#doRegisterBean" class="headerlink" title="doRegisterBean"></a>doRegisterBean</h2><p>è¿™ä¸€æ­¥æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€æ­¥ï¼š</p><ol><li>å£°æ˜ <code>BeanDefinition</code> ä¸º <code>AnnotatedGenericBeanDefinition</code> ã€‚</li><li>é€šè¿‡ <code>conditionEvaluator.shouldSkip()</code> æ–¹æ³•é€šè¿‡å¯¹ @Conditional æ³¨è§£æ¥åˆ¤æ–­æ˜¯å¦è·³è¿‡æ³¨å†Œ</li><li>é€šè¿‡ <code>scopeMetadataResolver.resolveScopeMetadata</code> æ¥è·å–ä½œç”¨åŸŸï¼Œç„¶åå†æ”¾åˆ° BeanDefinition ä¸­ã€‚</li><li>é€šè¿‡ <code>beanNameGenerator.generateBeanName</code> æ¥è®¾ç½®Beanåœ¨å®¹å™¨ä¸­çš„åç§°ã€‚</li><li>é€šè¿‡ <code>processCommonDefinitionAnnotations</code> è®¾ç½®Beançš„åŸºæœ¬å±æ€§</li><li>æœ€åé€šè¿‡ è°ƒç”¨<code>registerBeanDefinition</code> å¯¹åŒ…è£…å¥½çš„ BeanDefinitionHolder è¿›è¡Œæœ€åçš„æ³¨å†Œæ“ä½œã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">doRegisterBean</span><span class="params">(Class&lt;T&gt; beanClass, @Nullable String name,</span></span></span><br><span class="line"><span class="function"><span class="params">@Nullable Class&lt;? extends Annotation&gt;[] qualifiers, @Nullable Supplier&lt;T&gt; supplier,</span></span></span><br><span class="line"><span class="function"><span class="params">@Nullable BeanDefinitionCustomizer[] customizers)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">AnnotatedGenericBeanDefinition abd = <span class="keyword">new</span> AnnotatedGenericBeanDefinition(beanClass); </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.conditionEvaluator.shouldSkip(abd.getMetadata())) &#123;</span><br><span class="line"><span class="comment">// é€šè¿‡åˆ¤æ–­Conditionalæ³¨è§£ï¼Œæ¥åˆ¤æ–­æ˜¯å¦è·³è¿‡</span></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¤„ç†åˆ›å»ºçš„å›è°ƒ</span></span><br><span class="line">abd.setInstanceSupplier(supplier);</span><br><span class="line">ScopeMetadata scopeMetadata = <span class="keyword">this</span>.scopeMetadataResolver.resolveScopeMetadata(abd);</span><br><span class="line"><span class="comment">// å¤„ç†ä½œç”¨åŸŸ æ”¾åˆ°scopeMetadataé‡Œé¢</span></span><br><span class="line">abd.setScope(scopeMetadata.getScopeName());<span class="comment">//å†æ”¾åˆ° BeanDefinition é‡Œ</span></span><br><span class="line">String beanName = (name != <span class="keyword">null</span> ? name : <span class="keyword">this</span>.beanNameGenerator.generateBeanName(abd, <span class="keyword">this</span>.registry)); <span class="comment">//è®¾ç½®BeanName</span></span><br><span class="line"></span><br><span class="line">AnnotationConfigUtils.processCommonDefinitionAnnotations(abd); </span><br><span class="line"><span class="comment">// è®¾ç½®ä¸€äº›åŸºæœ¬å±æ€§ å¦‚ Lazyï¼ŒPrimary ã€‚ã€‚ã€‚</span></span><br><span class="line"><span class="keyword">if</span> (qualifiers != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (Class&lt;? extends Annotation&gt; qualifier : qualifiers) &#123;</span><br><span class="line"><span class="keyword">if</span> (Primary.class == qualifier) &#123;</span><br><span class="line">abd.setPrimary(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (Lazy.class == qualifier) &#123;</span><br><span class="line">abd.setLazyInit(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">abd.addQualifier(<span class="keyword">new</span> AutowireCandidateQualifier(qualifier));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (customizers != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (BeanDefinitionCustomizer customizer : customizers) &#123;</span><br><span class="line">customizer.customize(abd);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BeanDefinitionHolder definitionHolder = <span class="keyword">new</span> BeanDefinitionHolder(abd, beanName); <span class="comment">// åˆ›å»ºä¸€ä¸ªdefinitionHolderï¼Œä½œç”¨æ˜¯ å…·æœ‰åç§°å’Œåˆ«åçš„BeanDefinitionçš„æŒæœ‰äºº</span></span><br><span class="line">definitionHolder = AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, <span class="keyword">this</span>.registry); <span class="comment">//è®¾ç½®ä½œç”¨åŸŸ</span></span><br><span class="line">BeanDefinitionReaderUtils.registerBeanDefinition(definitionHolder, <span class="keyword">this</span>.registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="registerBeanDefinition"><a href="#registerBeanDefinition" class="headerlink" title="registerBeanDefinition"></a>registerBeanDefinition</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerBeanDefinition</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> BeanDefinitionStoreException </span>&#123;</span><br><span class="line"></span><br><span class="line">String beanName = definitionHolder.getBeanName();</span><br><span class="line">registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());</span><br><span class="line"></span><br><span class="line">   <span class="comment">//  æ³¨å†Œåˆ«å</span></span><br><span class="line">String[] aliases = definitionHolder.getAliases();</span><br><span class="line"><span class="keyword">if</span> (aliases != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (String alias : aliases) &#123;</span><br><span class="line">registry.registerAlias(beanName, alias);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åä¼šè°ƒç”¨ <code>DefaultListableBeanFactory</code> ä¸­çš„ <code>registBeanDefinition</code> æ–¹æ³•å¯¹Beanè¿›è¡Œæ³¨å†Œã€‚å®é™…çš„æ³¨å†Œè¿‡ç¨‹å°±æ˜¯å°†Beançš„åç§°ä½œä¸ºkeyï¼ŒBeançš„BeanDefinitionä½œä¸ºvalueå­˜å‚¨åœ¨ä¸€ä¸ªå…¨å±€çš„beanDefinitionMapä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (<span class="keyword">this</span>.beanDefinitionMap) &#123;</span><br><span class="line"><span class="keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition); <span class="comment">//å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªConcurrentHashMap å­˜å‚¨ beanDefinition ä½¿ç”¨BeanNameä½œä¸ºKey</span></span><br><span class="line">List&lt;String&gt; updatedDefinitions = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="keyword">this</span>.beanDefinitionNames.size() + <span class="number">1</span>); <span class="comment">// æ·»åŠ åˆ°updatedDefinitionsé‡Œé¢</span></span><br><span class="line">updatedDefinitions.addAll(<span class="keyword">this</span>.beanDefinitionNames);</span><br><span class="line">updatedDefinitions.add(beanName);</span><br><span class="line"><span class="keyword">this</span>.beanDefinitionNames = updatedDefinitions;</span><br><span class="line">removeManualSingletonName(beanName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒSpringå®¹å™¨çš„åˆ›å»ºï¼Œå’Œå¯¹é…ç½®æ–‡ä»¶çš„æ³¨å†Œå°±å®Œæˆäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Beançš„ç”Ÿå‘½å‘¨æœŸ</title>
      <link href="/2019/12/05/%EF%BC%88%E4%BA%8C%EF%BC%89Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
      <url>/2019/12/05/%EF%BC%88%E4%BA%8C%EF%BC%89Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="Beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Beançš„ç”Ÿå‘½å‘¨æœŸ"></a>Beançš„ç”Ÿå‘½å‘¨æœŸ</h1><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20191020160536.png" alt></p><h2 id="Beançš„åˆå§‹åŒ–å’Œé”€æ¯"><a href="#Beançš„åˆå§‹åŒ–å’Œé”€æ¯" class="headerlink" title="Beançš„åˆå§‹åŒ–å’Œé”€æ¯"></a>Beançš„åˆå§‹åŒ–å’Œé”€æ¯</h2><h3 id="ä¸€ã€ä½¿ç”¨-Beançš„åˆå§‹åŒ–å’Œé”€æ¯å±æ€§"><a href="#ä¸€ã€ä½¿ç”¨-Beançš„åˆå§‹åŒ–å’Œé”€æ¯å±æ€§" class="headerlink" title="ä¸€ã€ä½¿ç”¨@Beançš„åˆå§‹åŒ–å’Œé”€æ¯å±æ€§"></a>ä¸€ã€ä½¿ç”¨@Beançš„åˆå§‹åŒ–å’Œé”€æ¯å±æ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨dogå®ä¾‹ä¸­æŒ‡å®šinitå’Œdestroyæ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"instance dog execute init method....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"instance dog execute destroy method....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜beançš„æ—¶å€™æŒ‡å®š initMethod = "init",destroyMethod = "destroy"</span></span><br><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LifeCycleConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span>(initMethod = <span class="string">"init"</span>,destroyMethod = <span class="string">"destroy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">dog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"begin create dog"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LifeCycleTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(LifeCycleConfig.class);</span><br><span class="line">    System.out.println(<span class="string">"instance has created !!!"</span>);</span><br><span class="line"><span class="comment">//        Dog dog = (Dog) applicationContext.getBean("dog");</span></span><br><span class="line">    ((AnnotationConfigApplicationContext) applicationContext).close();</span><br><span class="line">    System.out.println(<span class="string">"context has closed !!!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ç»“æœ:</span></span><br><span class="line"><span class="comment">// begin create dog</span></span><br><span class="line"><span class="comment">// instance dog execute init method.....</span></span><br><span class="line"><span class="comment">// instance has created !!!</span></span><br><span class="line"><span class="comment">// instance dog execute destroy method.....</span></span><br><span class="line"><span class="comment">// context has closed !!!</span></span><br></pre></td></tr></table></figure><p>ä»æµ‹è¯•ç»“æœæ¥çœ‹å½“åˆ›å»ºå¯¹è±¡æ—¶,é€šè¿‡ <code>initMethod</code>,<code>destroyMethod</code>æŒ‡å®šåˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•æ—¶å¯è¡Œçš„.initæ–¹æ³•åœ¨å¯¹è±¡åˆ›å»ºåæ‰§è¡Œ.destroyåœ¨å®¹å™¨é”€æ¯å‰æ‰§è¡Œ.</p><h3 id="äºŒã€ä½¿ç”¨-InitializingBean-å’Œ-DisposableBean-æ¥å£æŒ‡å®š"><a href="#äºŒã€ä½¿ç”¨-InitializingBean-å’Œ-DisposableBean-æ¥å£æŒ‡å®š" class="headerlink" title="äºŒã€ä½¿ç”¨ InitializingBean å’Œ DisposableBean æ¥å£æŒ‡å®š"></a>äºŒã€ä½¿ç”¨ InitializingBean å’Œ DisposableBean æ¥å£æŒ‡å®š</h3><p>æ–¹æ³•åŒä¸Š,ä¸è¿‡éœ€è¦å¯¹è±¡ç±»å®ç°è¿™ä¸¤ä¸ªæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span>, <span class="title">DisposableBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  æ¥å£ä¸­çš„destroy æ–¹æ³•,æ‰§è¡Œé”€æ¯bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"instance cat execute destroy method....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ¥å£ä¸­çš„afterPropertiesSetæ–¹æ³•,ç”¨æ¥åˆ›å»ºbeanåçš„åˆå§‹åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"instance cat execute init method....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸éœ€è¦åœ¨beanæ³¨è§£ä¸­æŒ‡å®šç›¸å…³æ–¹æ³•</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Cat <span class="title">cat</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"begin create cat"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Cat();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”¨åŒæ ·çš„æµ‹è¯•ç¨‹åºæµ‹è¯•å¾—åˆ°çš„ç»“æœå¦‚ä¸‹:</span></span><br><span class="line"><span class="comment">// begin create cat</span></span><br><span class="line"><span class="comment">// instance dog execute init method.....</span></span><br><span class="line"><span class="comment">// instance has created !!!</span></span><br><span class="line"><span class="comment">// instance dog execute destroy method.....</span></span><br><span class="line"><span class="comment">// context has closed !!!</span></span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€ä½¿ç”¨JSRæ ‡å‡†çš„æ³¨è§£-PostConstruce-å’Œ-PreDestroy"><a href="#ä¸‰ã€ä½¿ç”¨JSRæ ‡å‡†çš„æ³¨è§£-PostConstruce-å’Œ-PreDestroy" class="headerlink" title="ä¸‰ã€ä½¿ç”¨JSRæ ‡å‡†çš„æ³¨è§£ @PostConstruce å’Œ @PreDestroy"></a>ä¸‰ã€ä½¿ç”¨JSRæ ‡å‡†çš„æ³¨è§£ @PostConstruce å’Œ @PreDestroy</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bug</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"instance Bug execute init method....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"instance Bug execute destroy method....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å››ã€BeanPostProcessorè‡ªå®šä¹‰åˆå§‹åŒ–å‰åæ–¹æ³•"><a href="#å››ã€BeanPostProcessorè‡ªå®šä¹‰åˆå§‹åŒ–å‰åæ–¹æ³•" class="headerlink" title="å››ã€BeanPostProcessorè‡ªå®šä¹‰åˆå§‹åŒ–å‰åæ–¹æ³•"></a>å››ã€BeanPostProcessorè‡ªå®šä¹‰åˆå§‹åŒ–å‰åæ–¹æ³•</h3><p>å…ˆè‡ªå®šä¹‰ä¸€ä¸ª MyBeanPostProcessor ï¼Œå¹¶å°†å®ƒæ”¾åˆ°å®¹å™¨ä¸­ï¼Œåœ¨å¯åŠ¨åï¼Œæ¯æ¬¡ç”Ÿæˆbeanæ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œä¸‹é¢çš„ postProcessBeforeInitialization å’Œ postProcessAfterInitializationã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line"><span class="comment">// æ ¹æ®BeanNameå’Œbeanå¯ä»¥è·å–beançš„ç±»ä¿¡æ¯æ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œç­›é€‰ï¼Œåœ¨åˆå§‹åŒ–å‰è¿›è¡Œç›¸å…³æ“ä½œ</span></span><br><span class="line">System.out.println(beanName);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">System.out.println(beanName);</span><br><span class="line"><span class="comment">// åŒç†åˆå§‹åŒ–å</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°†ç±»æ·»åŠ è‡³å®¹å™¨ä¸­çš„å››ç§æ–¹æ³•</title>
      <link href="/2019/12/01/%EF%BC%88%E4%B8%80%EF%BC%89%20%E5%B0%86%E7%B1%BB%E5%8A%A0%E5%85%A5%E5%88%B0%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84%E6%96%B9%E5%BC%8F/"/>
      <url>/2019/12/01/%EF%BC%88%E4%B8%80%EF%BC%89%20%E5%B0%86%E7%B1%BB%E5%8A%A0%E5%85%A5%E5%88%B0%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="å°†ç±»æ·»åŠ è‡³å®¹å™¨ä¸­çš„å››ç§æ–¹æ³•"><a href="#å°†ç±»æ·»åŠ è‡³å®¹å™¨ä¸­çš„å››ç§æ–¹æ³•" class="headerlink" title="å°†ç±»æ·»åŠ è‡³å®¹å™¨ä¸­çš„å››ç§æ–¹æ³•"></a>å°†ç±»æ·»åŠ è‡³å®¹å™¨ä¸­çš„å››ç§æ–¹æ³•</h1><p>åœ¨Springä¸­,æœ‰å››ç§æ–¹æ³•å¯ä»¥å°†ç°æœ‰çš„ç±»çš„å®ä¾‹æ·»åŠ åˆ°å®¹å™¨ä¸­.åœ¨äº†è§£ä¹‹å‰éœ€è¦äº†è§£ä»¥ä¸‹ä¸¤ç§ä½œç”¨åŸŸ.</p><p>Springåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å…±æœ‰å››ç§ä½œç”¨åŸŸå¯é€‰.åˆ†åˆ«ä¸ºå¸¸ç”¨çš„<code>singleton</code>ã€<code>prototype</code>.å’Œåœ¨webåº”ç”¨å¼€å‘ä¸­çš„<code>request</code>å’Œ<code>session</code>.</p><p>ä¸‹é¢é’ˆå¯¹å¸¸ç”¨çš„<code>singleton</code>ã€<code>prototype</code>æ¥äº†è§£beançš„ä½œç”¨åŸŸ(SCOPE)</p><h2 id="Springçš„ä½œç”¨åŸŸ"><a href="#Springçš„ä½œç”¨åŸŸ" class="headerlink" title="Springçš„ä½œç”¨åŸŸ"></a>Springçš„ä½œç”¨åŸŸ</h2><h3 id="1-Singleton-å•ä¾‹"><a href="#1-Singleton-å•ä¾‹" class="headerlink" title="1. Singleton å•ä¾‹"></a>1. Singleton å•ä¾‹</h3><p>Singletonä¸ºSpringå¯¹è±¡çš„é»˜è®¤çš„åˆ›å»ºæ–¹å¼,ä¹Ÿå°±æ˜¯è¯´Springåœ¨åˆ›å»ºBeançš„æ—¶å€™é»˜è®¤æ˜¯å•ä¾‹çš„.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/å‡†å¤‡å¯¹è±¡Person</span><br><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ›å»ºBeanå®ä¾‹ï¼"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"li"</span>, <span class="string">"lei"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æµ‹è¯•</span></span><br><span class="line">ApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(TestConfig.class);</span><br><span class="line"><span class="comment">// è·å–ä¸¤æ¬¡å¯¹è±¡,å¹¶ä¸”åœ¨è¿™æ˜¯å°±ä¼šæ‰“å° ã€Œåˆ›å»ºBeanå®ä¾‹ã€</span></span><br><span class="line">Person person = (Person) applicationContext.getBean(<span class="string">"person"</span>);</span><br><span class="line">Person person_copy = (Person) applicationContext.getBean(<span class="string">"person"</span>);</span><br><span class="line"><span class="comment">// è¿™é‡Œè¿”å›true,è¯´æ˜ä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸åŒçš„å¯¹è±¡</span></span><br><span class="line">System.out.println(person == person_copy);</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºBeanå®ä¾‹ï¼</span><br><span class="line">å®¹å™¨åˆ›å»ºæˆåŠŸã€‚ã€‚æ¥ä¸‹æ¥åˆ›å»ºå¯¹è±¡ï¼</span><br><span class="line"><span class="keyword">true</span></span><br></pre></td></tr></table></figure><blockquote><p>å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ—¶,åœ¨Springåˆ›å»ºSingletonå¯¹è±¡çš„æ—¶å€™,æ˜¯åœ¨å®¹å™¨åˆ›å»ºåç«‹å³åˆ›å»ºçš„.</p></blockquote><h3 id="2-prototype-åŸå‹"><a href="#2-prototype-åŸå‹" class="headerlink" title="2. prototype åŸå‹"></a>2. prototype åŸå‹</h3><p>åŒæ ·ä¸Šè¿°çš„ä»£ç ,åœ¨@Beanä¸‹é¢å¢åŠ <code>@Scope(&quot;prototype&quot;)</code>å,ä¼šæ³¨æ„åˆ°ç»“æœçš„ä¸åŒ.è¿è¡Œæ—¶åœ¨è¿›è¡Œç»“æœçš„è§‚å¯Ÿ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å®¹å™¨åˆ›å»ºæˆåŠŸã€‚ã€‚æ¥ä¸‹æ¥åˆ›å»ºå¯¹è±¡ï¼</span><br><span class="line">åˆ›å»ºBeanå®ä¾‹ï¼</span><br><span class="line">åˆ›å»ºBeanå®ä¾‹ï¼</span><br><span class="line"><span class="keyword">false</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>ç±»å‹</th><th>æ˜¯å¦å•ä¾‹</th><th>åˆ›å»ºæ—¶é—´</th><th>æ˜¯å¦é”€æ¯</th></tr></thead><tbody><tr><td>Singleton</td><td>å•ä¾‹</td><td>é»˜è®¤åœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ›å»º</td><td>å®¹å™¨å…³é—­åé”€æ¯</td></tr><tr><td>prototype</td><td>å¤šå®ä¾‹</td><td>åœ¨è·å–å¯¹è±¡æ—¶åˆ›å»º</td><td>ä¸ä¼šè°ƒç”¨é”€æ¯æ–¹æ³•</td></tr></tbody></table><h2 id="ä¸€ã€Configurationæ³¨è§£å’ŒBeanæ³¨è§£"><a href="#ä¸€ã€Configurationæ³¨è§£å’ŒBeanæ³¨è§£" class="headerlink" title="ä¸€ã€Configurationæ³¨è§£å’ŒBeanæ³¨è§£"></a>ä¸€ã€Configurationæ³¨è§£å’ŒBeanæ³¨è§£</h2><p>ä»£æ›¿äº†åŸæ¥çš„Springé…ç½®æ–‡ä»¶,åœ¨ç±»ä¸Šæ ‡æ³¨<code>Configuration</code>æ³¨è§£è¯´æ˜è¿™ä¸ªç±»æ˜¯Springçš„é…ç½®ç±».</p><p>åœ¨æ–¹æ³•ä¸Šä½¿ç”¨<code>Bean</code>æ³¨è§£,åˆ™ä¼šå°†è¿”å›å€¼ä½œä¸ºå®ä¾‹æ·»åŠ åˆ°å®¹å™¨ä¸­,æ–¹æ³•åç§°ä½œä¸ºBeançš„ID.</p><p>ä¸€èˆ¬ä½¿ç”¨è¿™ç§æ–¹æ³•å°†ç¬¬ä¸‰æ–¹çš„åŒ…ä¸­çš„ç±»åŠ å…¥åˆ°å®¹å™¨ä¸­,å¦‚Shiroçš„é…ç½®ç±».</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ä½¿ç”¨@Confiurationæ³¨è§£å£°æ˜é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.nanyin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Scope</span>(<span class="string">"prototype"</span>) <span class="comment">//å£°æ˜å¤šå®ä¾‹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ›å»ºBeanå®ä¾‹ï¼"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"li"</span>, <span class="string">"lei"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒã€componentScanåŒ…æ‰«ææ³¨è§£"><a href="#äºŒã€componentScanåŒ…æ‰«ææ³¨è§£" class="headerlink" title="äºŒã€componentScanåŒ…æ‰«ææ³¨è§£"></a>äºŒã€componentScanåŒ…æ‰«ææ³¨è§£</h2><p>åœ¨é¢å¯¹è‡ªå·±å†™çš„<code>@Component</code>,<code>@Service</code>,<code>@Controller</code>,<code>@Repository</code>åˆ™ä¸éœ€è¦ä½¿ç”¨ç¬¬ä¸€ä¸ªä¸­çš„ä½¿ç”¨@Beanæ³¨è§£ä¸€ä¸ªä¸€ä¸ªçš„æ·»åŠ åˆ°é…ç½®ç±»ä¸­,åªéœ€è¦é…ç½®<code>@ComponentSacn</code>å°±è¡Œäº†.å®ƒä¼šè‡ªåŠ¨æ‰«æè·¯å¾„ä¸‹çš„æ‰€æœ‰è¿™äº›æ³¨è§£çš„ç±»åŠ å…¥åˆ°å®¹å™¨ä¸­.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.nanyin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConfig</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€importæ³¨è§£"><a href="#ä¸‰ã€importæ³¨è§£" class="headerlink" title="ä¸‰ã€importæ³¨è§£"></a>ä¸‰ã€importæ³¨è§£</h2><h3 id="1-ç›´æ¥å¯¼å…¥-Configurationé…ç½®ç±»"><a href="#1-ç›´æ¥å¯¼å…¥-Configurationé…ç½®ç±»" class="headerlink" title="1. ç›´æ¥å¯¼å…¥@Configurationé…ç½®ç±»"></a>1. ç›´æ¥å¯¼å…¥@Configurationé…ç½®ç±»</h3><p>èƒ½å¤Ÿä½¿ç”¨<code>@Import(value=xxx.class)</code> å…¶ä¸­valueæ˜¯æ•°ç»„,å¯ä»¥ä¸€æ¬¡æ€§å¯¼å…¥å¤šä¸ªé…ç½®ç±».æ‰¹é‡çš„å¯¼å…¥é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰å£°æ˜çš„bean.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–°çš„å®ä½“</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="comment">// éœ€è¦å¯¼å…¥TestConfigä¸­é…ç½®çš„æ‰€æœ‰bean</span></span><br><span class="line"><span class="meta">@Import</span>(value=TestConfig.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImportConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">dog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ›å»ºBeanå®ä¾‹ï¼"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConfig</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œé…ç½®äº†ä¸€ä¸ªperson</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ›å»ºBeanå®ä¾‹ï¼"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"li"</span>, <span class="string">"lei"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">importTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(ImportConfig.class);</span><br><span class="line">    String[] names = applicationContext.getBeanDefinitionNames();</span><br><span class="line">    <span class="comment">// æ‰“å°å‡ºæ‰€æœ‰æ·»åŠ åˆ°å®¹å™¨ä¸­çš„åç§°</span></span><br><span class="line">    <span class="keyword">for</span> (String temp :</span><br><span class="line">            names) &#123;</span><br><span class="line">        System.out.println(temp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ç»“æœ:</span><br><span class="line">importConfig</span><br><span class="line">person</span><br><span class="line">com.nanyin.config.TestConfig</span><br><span class="line">dog</span><br></pre></td></tr></table></figure><p>å¯¼å…¥äº†<code>TestConfig</code>é…ç½®ç±»å’Œå…¶ä¸­çš„personå®ä¾‹</p><h3 id="2-ä½¿ç”¨importSelectorè‡ªå®šä¹‰å¯¼å…¥"><a href="#2-ä½¿ç”¨importSelectorè‡ªå®šä¹‰å¯¼å…¥" class="headerlink" title="2. ä½¿ç”¨importSelectorè‡ªå®šä¹‰å¯¼å…¥"></a>2. ä½¿ç”¨importSelectorè‡ªå®šä¹‰å¯¼å…¥</h3><p>é™¤äº†ä½¿ç”¨ <code>@import</code> ç›´æ¥å¯¼å…¥æŒ‡å®šçš„ç±»å¤–,è¿˜å¯ä»¥å¯¼å…¥ ç»§æ‰¿<code>importSelector</code>æ¥å£çš„ç±»,å¹¶ä¸”åœ¨å®ç°ç±»ä¸­è¿›è¡Œè‡ªå®šä¹‰æ“ä½œ.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImportSelector</span> <span class="keyword">implements</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">      <span class="comment">// å¯ä»¥é€šè¿‡importingClassMetadataè·å–ç±»æ³¨è§£ä¸Šçš„æ‰€æœ‰ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;Dog.class.getName()&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="comment">// @Import å¯ä»¥å¯¼å…¥æ•°ç»„(å¤šä¸ª) class,å¦‚ä¸Šé¢æåˆ°çš„ TestConfigé…ç½®ç±»,è¿™é‡ŒæŠŠMyImportSelectorä¹Ÿæ·»åŠ è¿›å»</span></span><br><span class="line"><span class="meta">@Import</span>(value=&#123;TestConfig.class,MyImportSelector.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImportConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">importTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(ImportConfig.class);</span><br><span class="line">    String[] names = applicationContext.getBeanDefinitionNames();</span><br><span class="line">    <span class="keyword">for</span> (String temp :</span><br><span class="line">            names) &#123;</span><br><span class="line">        System.out.println(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    ((AnnotationConfigApplicationContext) applicationContext).close();;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œæµ‹è¯•å</span></span><br><span class="line"><span class="comment">// importConfig</span></span><br><span class="line"><span class="comment">// person</span></span><br><span class="line"><span class="comment">// com.nanyin.config.TestConfig</span></span><br><span class="line"><span class="comment">// com.nanyin.entity.Dog</span></span><br></pre></td></tr></table></figure><h3 id="3-ä½¿ç”¨-importBeanDefinitionRegister"><a href="#3-ä½¿ç”¨-importBeanDefinitionRegister" class="headerlink" title="3. ä½¿ç”¨ importBeanDefinitionRegister"></a>3. ä½¿ç”¨ importBeanDefinitionRegister</h3><p>å¯ä»¥ä½¿ç”¨ <code>importBeanDefinitionRegister</code> è‡ªå®šä¹‰æ³¨å†Œbean,å› ä¸ºåœ¨æ¥å£ä¸­æœ‰BeanRegiestä½œä¸ºå‚æ•°,é€šè¿‡å‚æ•°è°ƒç”¨Registeç›¸å…³æ–¹æ³•.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyimportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">        AnnotatedGenericBeanDefinition beanDefinition = <span class="keyword">new</span> AnnotatedGenericBeanDefinition(Dog.class);</span><br><span class="line">        <span class="comment">// å‰é¢å­—ç¬¦ä¸²æ˜¯ID,åé¢æ˜¯BeanDefinition</span></span><br><span class="line">        registry.registerBeanDefinition(<span class="string">"dogx"</span>,beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Import</span>(MyimportBeanDefinitionRegistrar.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImportConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">dog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ›å»ºBeanå®ä¾‹ï¼"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç»“æœé€šè¿‡ registry æ³¨å†Œäº† dogx</span></span><br><span class="line"><span class="comment">// importConfig</span></span><br><span class="line"><span class="comment">// dog</span></span><br><span class="line"><span class="comment">// dogx</span></span><br></pre></td></tr></table></figure><blockquote><p>åé¢çš„ä¸¤ç§æ–¹æ³•åœ¨SpringBootæºç ä¸­ä¼šç»å¸¸çœ‹åˆ°,æ‰€ä»¥è¿˜æ˜¯æŒºé‡è¦çš„.</p></blockquote><hr><h2 id="å››ã€ä½¿ç”¨FactoryBeanæ³¨å†Œbean"><a href="#å››ã€ä½¿ç”¨FactoryBeanæ³¨å†Œbean" class="headerlink" title="å››ã€ä½¿ç”¨FactoryBeanæ³¨å†Œbean"></a>å››ã€ä½¿ç”¨FactoryBeanæ³¨å†Œbean</h2><p>ç”¨äºåˆ›å»ºå¤æ‚çš„beanæ—¶,ä¼šç”¨åˆ°FactoryBean.</p><p>å¦‚æœç»§æ‰¿ <code>FactoryBean</code> æ¥å£å®ç°,åˆ™è¿™ä¸ªå°±ä¸èƒ½å½“ä½œä¸€ä¸ªæ™®é€šçš„beanä½¿ç”¨äº†,ä»–æš´éœ²å‡ºæ¥çš„è·å–çš„å¯¹è±¡æ˜¯ <code>getObject()</code>æ–¹æ³•è·å–çš„å·¥å‚ä¸­çš„å¯¹è±¡,è€Œä¸æ˜¯ä»–è‡ªèº«.é»˜è®¤åˆ›å»ºçš„æ—¶FactoryBeançš„å¯¹è±¡å®ä¾‹ï¼Œè€Œä¸æ˜¯å·¥å‚å®ä¾‹ï¼Œå¦‚æœæƒ³è·å–å·¥å‚çš„å®ä¾‹ï¼Œåœ¨getBeançš„æ—¶å€™åœ¨å¯¹è±¡IDå‰åŠ ä¸Š<code>&amp;</code>ç¬¦å·ã€‚</p><p>å…·ä½“å®ä¾‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Dog</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›çš„å®ä¾‹å¯¹è±¡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿”å›çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Dog.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é»˜è®¤ä¸ºtrue,å¦‚æœæ—¶falseåˆ™ä¸ºå¤šå®ä¾‹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springçš„ç¼“å­˜</title>
      <link href="/2019/08/15/2019-08-15-Spring%E7%9A%84%E7%BC%93%E5%AD%98/"/>
      <url>/2019/08/15/2019-08-15-Spring%E7%9A%84%E7%BC%93%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<h1 id="Springçš„ç¼“å­˜"><a href="#Springçš„ç¼“å­˜" class="headerlink" title="Springçš„ç¼“å­˜"></a>Springçš„ç¼“å­˜</h1><p>Javaåœ¨ä½¿ç”¨<code>Cache</code>çš„æ—¶å€™ï¼Œä¸ºäº†ç»Ÿä¸€ç¼“å­˜çš„ä½¿ç”¨ï¼Œ<code>J2EE</code>å‘å¸ƒäº†<code>JSR107</code>ç¼“å­˜è§„èŒƒã€‚åŒ…æ‹¬äº†ä¸»è¦çš„5ä¸ªæ ¸å¿ƒæ¥å£ï¼ŒåŒ…æ‹¬<code>cachingProvider</code>ã€<code>cacheManager</code>ç­‰ã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹<code>JSR107</code>ç¼“å­˜è§„ã€‚</p><h2 id="Springçš„ç¼“å­˜æŠ½è±¡"><a href="#Springçš„ç¼“å­˜æŠ½è±¡" class="headerlink" title="Springçš„ç¼“å­˜æŠ½è±¡"></a>Springçš„ç¼“å­˜æŠ½è±¡</h2><p>Springä¸ºäº†ç»Ÿä¸€ç¼“å­˜çš„æ“ä½œï¼Œä½¿ç”¨<code>org.springframework.cache</code>åŒ…ä¸‹çš„çš„<code>cacheManager</code>æ¥å£è¿›è¡Œå¼€å‘ã€‚å¹¶æ”¯æŒä¸Šé¢æ‰€è¯´çš„<code>JSR107</code>ç¼“å­˜è§„èŒƒï¼Œç”¨æ¥ç®€åŒ–å¼€å‘ã€‚</p><p>Springæ”¯æŒé€æ˜çš„å‘åº”ç”¨ä¸­çš„æ–¹æ³•æ·»åŠ ç¼“å­˜ã€‚å°†æŸ¥è¯¢å‡ºçš„ä¿¡æ¯æ”¾åˆ°ç¼“å­˜é‡Œï¼Œå‡å°‘åº”ç”¨ä¸å®é™…æ•°æ®åº“çš„æŸ¥è¯¢æ¬¡æ•°ã€‚æé«˜ç³»ç»Ÿç›¸åº”é€Ÿåº¦ã€‚</p><h2 id="SpringBootå¼€å¯ç¼“å­˜æ³¨è§£"><a href="#SpringBootå¼€å¯ç¼“å­˜æ³¨è§£" class="headerlink" title="SpringBootå¼€å¯ç¼“å­˜æ³¨è§£"></a>SpringBootå¼€å¯ç¼“å­˜æ³¨è§£</h2><p>SpringBootæ˜¯é»˜è®¤æ”¯æŒCacheç›¸å…³åŸºç¡€ç»„ä»¶çš„ã€‚éœ€è¦åœ¨å¯åŠ¨å™¨ç±»ä¸Šæ ‡æ³¨<code>@EnableCaching</code>æ³¨è§£ã€‚å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span> <span class="comment">//å¼€å¯SpringBootçš„cacheæ”¯æŒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebProjectApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(WebProjectApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ ç¼“å­˜ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ï¼Œ<code>Spring cache</code> å°±èƒ½å¤Ÿå¸®åŠ©åˆ›å»ºç¼“å­˜ã€‚å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable</span>(value=<span class="string">"user-status"</span>) <span class="comment">//ä½¿ç”¨Cacheableæ³¨è§£æ ‡å¿—è¿™éœ€è¦å¯¹æ–¹æ³•è¿›è¡Œç¼“å­˜</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Status&gt; <span class="title">findNotDeletedUserStatus</span><span class="params">()</span>  <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> statusRepository.findAllByIsDeletedOrderByOrd(DeletedStatusEnum.IS_NOT_DELETED.isJudge());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SpringBootæ”¯æŒäº†å¤šç§çš„ç¼“å­˜å®ç°ï¼Œå¦‚<code>EhCache 2.x</code>ã€<code>Redis</code>ã€<code>Caffeine</code>ç­‰ç­‰ã€‚ä½†æ˜¯æ¥å£æ–¹æ³•æ˜¯ç›¸åŒçš„ï¼Œå°±å¦‚åŒä½¿ç”¨jdbcä¸€æ ·ã€‚è™½ç„¶å®ç°ä¸åŒï¼Œä½†æ˜¯ä½¿ç”¨ä¸Šå¹¶æ— å·®å¼‚ã€‚</p><h2 id="SpringBoot-ä½¿ç”¨ç¼“å­˜æ³¨è§£"><a href="#SpringBoot-ä½¿ç”¨ç¼“å­˜æ³¨è§£" class="headerlink" title="SpringBoot ä½¿ç”¨ç¼“å­˜æ³¨è§£"></a>SpringBoot ä½¿ç”¨ç¼“å­˜æ³¨è§£</h2><p>ç¼“å­˜æŠ½è±¡çš„æ ¸å¿ƒæ˜¯å°†ç¼“å­˜åº”ç”¨äºJavaæ–¹æ³•ä¸Šã€‚è¿™æ ·ï¼Œå¦‚æœæ–¹æ³•è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆåº”ç”¨äºæ–¹æ³•ä¸Šçš„ç¼“å­˜å°±å¼€å§‹æ£€æŸ¥æ˜¯å¦æŒ‰ç…§ç»™å®šè§„åˆ™è¿›è¡Œç¼“å­˜ã€‚</p><h3 id="åŸºäºæ³¨è§£çš„ç¼“å­˜"><a href="#åŸºäºæ³¨è§£çš„ç¼“å­˜" class="headerlink" title="åŸºäºæ³¨è§£çš„ç¼“å­˜"></a>åŸºäºæ³¨è§£çš„ç¼“å­˜</h3><p>å¯¹äºç¼“å­˜å£°æ˜ï¼ŒSpringçš„ç¼“å­˜æŠ½è±¡æä¾›äº†ä¸€ç»„Javaæ³¨è§£</p><h4 id="ä¸€ã€-Cacheable-è§¦å‘è¿›è¡Œç¼“å­˜"><a href="#ä¸€ã€-Cacheable-è§¦å‘è¿›è¡Œç¼“å­˜" class="headerlink" title="ä¸€ã€@Cacheable è§¦å‘è¿›è¡Œç¼“å­˜"></a>ä¸€ã€@Cacheable è§¦å‘è¿›è¡Œç¼“å­˜</h4><p>ä½¿ç”¨<code>@Cacheable</code>æ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œæ ‡å¿—ç€è¿™ä¸ªæ–¹æ³•æ˜¯å¯ç¼“å­˜çš„ã€‚ä½¿ç”¨è¿™ä¸ªæ³¨è§£ï¼Œå¯å°†æ–¹æ³•çš„è¿”å›ç»“æ„å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå†æ¬¡æŸ¥è¯¢æ˜¯ï¼Œå°±å¯ä»¥ä»ç¼“å­˜ä¸­å–ç»“æœè€Œä¸æ˜¯å†æ¬¡æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable</span>(<span class="string">"books"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">findBook</span><span class="params">(ISBN isbn)</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºç¼“å­˜æ˜¯key-valueå½¢å¼çš„ï¼Œæ¯æ¬¡è°ƒç”¨ç¼“å­˜æ—¶ï¼Œéƒ½éœ€è¦å…ˆæ‰¾åˆ°æ­£ç¡®çš„keyã€‚ç¼“å­˜æŠ½è±¡æ”¯æŒç®€å•çš„<code>KeyGenerator</code>å‡ ç§ç”Ÿæˆçš„ç­–ç•¥ï¼šä½œä¸ºå‚è€ƒä¸Šé¢çš„æ–¹æ³•<code>findBook</code>çš„<code>Cacheable</code>çš„å‚æ•°æ˜¯<code>books</code>ã€‚</p><ul><li>å¦‚æœæ²¡æœ‰å‚æ•° ï¼Œåˆ™ä½¿ç”¨<code>SimpleKey.EMPTY</code>.</li><li>å¦‚æœæœ‰ä¸€ä¸ªå‚æ•°ï¼Œåˆ™ä½¿ç”¨è¿™ä¸ªå‚æ•°ä½œä¸ºkeyã€‚</li><li>å¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œåˆ™è¿”å› <code>SimpleKey</code> ä¸­åŒ…å«è¿™å¤šä¸ªå‚æ•°ã€‚</li></ul><p>è¿™ä¸‰ç§æ–¹å¼åŒ…å«äº†å¤§å¤šæ•°çš„ä½¿ç”¨åœºæ™¯ã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰key ï¼Œ<code>@Cacheable</code> å…è®¸ä½¿ç”¨<code>key</code>å…³é”®å­—è¿›è¡Œkeyçš„ç”Ÿæˆï¼Œkeyå…³é”®å­—çš„å€¼å¯ä»¥ä½¿ç”¨<code>SPEL</code>è¡¨è¾¾å¼è¿›è¡Œè¡¨ç¤ºã€‚å¦‚<a href="https://docs.spring.io/spring/docs/5.1.9.RELEASE/spring-framework-reference/integration.html#cache-strategies" target="_blank" rel="noopener">Spring Docä¸­</a>æ‰€ä¸¾å‡ºçš„ä¾‹å­ä¸€æ ·ã€‚æ ¹æ®å®é™…çš„æƒ…å†µè¿›è¡Œæ–Ÿé…Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable</span>(cacheNames=<span class="string">"books"</span>, key=<span class="string">"#isbn"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">findBook</span><span class="params">(ISBN isbn, <span class="keyword">boolean</span> checkWarehouse, <span class="keyword">boolean</span> includeUsed)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">@<span class="title">Cacheable</span><span class="params">(cacheNames=<span class="string">"books"</span>, key=<span class="string">"#isbn.rawNumber"</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">findBook</span><span class="params">(ISBN isbn, <span class="keyword">boolean</span> checkWarehouse, <span class="keyword">boolean</span> includeUsed)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">@<span class="title">Cacheable</span><span class="params">(cacheNames=<span class="string">"books"</span>, key=<span class="string">"T(someType).hash(#isbn)"</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">findBook</span><span class="params">(ISBN isbn, <span class="keyword">boolean</span> checkWarehouse, <span class="keyword">boolean</span> includeUsed)</span></span></span><br></pre></td></tr></table></figure><p><strong>è‡ªå®šä¹‰çš„ç¼“å­˜æ¡ä»¶</strong> ï¼š å¯ä»¥é€šè¿‡<code>condition</code>å…³é”®å­—åœ¨<code>@Cacheable</code>æ³¨è§£ä¸­è¿›è¡Œæ¡ä»¶çš„å®šåˆ¶ã€‚å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable</span>(cacheNames=<span class="string">"book"</span>, condition=<span class="string">"#name.length() &lt; 32"</span>) </span><br><span class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">findBook</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function"><span class="comment">//å¦‚æœæƒ³æ’é™¤æŸäº›æ¡ä»¶ ä½¿ç”¨unless</span></span></span><br><span class="line"><span class="function">@<span class="title">Cacheable</span><span class="params">(cacheNames=<span class="string">"book"</span>, condition=<span class="string">"#name.length() &lt; 32"</span>, unless=<span class="string">"#result.hardback"</span>)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">findBook</span><span class="params">(String name)</span></span></span><br></pre></td></tr></table></figure><p>å…·ä½“çš„æ›´å¤šçš„<code>spel</code>æ³¨è§£å±æ€§å¯ä»¥æŸ¥çœ‹Springæ–‡æ¡£ä¸­çš„å†…å®¹ <a href="https://docs.spring.io/spring/docs/5.1.9.RELEASE/spring-framework-reference/integration.html#cache-spel-context" target="_blank" rel="noopener">åœ°å€</a></p><h4 id="äºŒã€-CacheEvict-è§¦å‘æ¸…ç©ºç¼“å­˜"><a href="#äºŒã€-CacheEvict-è§¦å‘æ¸…ç©ºç¼“å­˜" class="headerlink" title="äºŒã€@CacheEvict è§¦å‘æ¸…ç©ºç¼“å­˜"></a>äºŒã€@CacheEvict è§¦å‘æ¸…ç©ºç¼“å­˜</h4><p>åœ¨<code>Spring cache</code>ä¸­ä¸ä»…å…è®¸æ”¾ç½®ç¼“å­˜ï¼Œè€Œä¸”å…è®¸ç§»é™¤ç¼“å­˜ã€‚ä½¿ç”¨ä¸<code>Cacheable</code>ç›¸å¯¹çš„<code>CacheEvict</code>æ³¨è§£æ¥æ¸…ç©ºå¯¹åº” keyçš„ç¼“å­˜æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨allEntriesç”¨æ¥è¡¨ç¤ºåˆ é™¤æ‰€æœ‰è¿™ä¸ªcacheä¸­çš„ç¼“å­˜</span></span><br><span class="line"><span class="meta">@CacheEvict</span>(cacheNames=<span class="string">"books"</span>, allEntries=<span class="keyword">true</span>) </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadBooks</span><span class="params">(InputStream batch)</span></span></span><br></pre></td></tr></table></figure><h4 id="ä¸‰ã€-CachePut-è§¦å‘æ›´æ–°ç¼“å­˜"><a href="#ä¸‰ã€-CachePut-è§¦å‘æ›´æ–°ç¼“å­˜" class="headerlink" title="ä¸‰ã€@CachePut è§¦å‘æ›´æ–°ç¼“å­˜"></a>ä¸‰ã€@CachePut è§¦å‘æ›´æ–°ç¼“å­˜</h4><p>å½“éœ€è¦æ›´æ–°ç¼“å­˜è€Œä¸å¹²æ‰°æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œå°±æ˜¯è¯´æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šæ›´æ–°ç¼“å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CachePut</span>(cacheNames=<span class="string">"book"</span>, key=<span class="string">"#isbn"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">updateBook</span><span class="params">(ISBN isbn, BookDescriptor descriptor)</span></span></span><br></pre></td></tr></table></figure><h4 id="å››ã€-Caching-ç»„åˆä½¿ç”¨å¤šä¸ªcacheæ³¨è§£æ–¹æ³•"><a href="#å››ã€-Caching-ç»„åˆä½¿ç”¨å¤šä¸ªcacheæ³¨è§£æ–¹æ³•" class="headerlink" title="å››ã€@Caching ç»„åˆä½¿ç”¨å¤šä¸ªcacheæ³¨è§£æ–¹æ³•"></a>å››ã€@Caching ç»„åˆä½¿ç”¨å¤šä¸ªcacheæ³¨è§£æ–¹æ³•</h4><p>å¦‚æœæƒ³ä½¿ç”¨å¤šä¸ªcacheåŠ¨ä½œæ¥æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼Œå°±éœ€è¦ä½¿ç”¨<code>Caching</code>æ³¨è§£å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­æ‰€è¡¨ç¤ºçš„ä¸€æ ·ï¼Œæƒ³è¦æ¸…ç©ºå¤šä¸ªkeyçš„ç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Caching</span>(evict = &#123; <span class="meta">@CacheEvict</span>(<span class="string">"primary"</span>), <span class="meta">@CacheEvict</span>(cacheNames=<span class="string">"secondary"</span>, key=<span class="string">"#p0"</span>) &#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">importBooks</span><span class="params">(String deposit, Date date)</span></span></span><br></pre></td></tr></table></figure><h4 id="äº”ã€-CacheConfig-ç±»ä¸Šæ³¨è§£ç”¨æ¥æ³¨è§£å…¬å…±é…ç½®"><a href="#äº”ã€-CacheConfig-ç±»ä¸Šæ³¨è§£ç”¨æ¥æ³¨è§£å…¬å…±é…ç½®" class="headerlink" title="äº”ã€@CacheConfig ç±»ä¸Šæ³¨è§£ç”¨æ¥æ³¨è§£å…¬å…±é…ç½®"></a>äº”ã€@CacheConfig ç±»ä¸Šæ³¨è§£ç”¨æ¥æ³¨è§£å…¬å…±é…ç½®</h4><p>ä¸Šé¢çš„æ³¨è§£éƒ½æ˜¯åœ¨æ–¹æ³•çº§åˆ«ä¸Šçš„å¯¹æ–¹æ³•çš„è¿”å›å€¼è¿›è¡Œè®¾ç½®ï¼Œè€Œ<code>CacheConfig</code>æ˜¯å¯¹ç±»çº§åˆ«ä¸Šçš„å…¬å…±è®¾ç½®ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ä¸­æ‰€å±•ç¤ºçš„ä¸€æ ·ï¼Œè®¾ç½®å…¬å…±çš„<code>cache name</code>.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheConfig</span>(<span class="string">"books"</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookRepositoryImpl</span> <span class="keyword">implements</span> <span class="title">BookRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">findBook</span><span class="params">(ISBN isbn)</span> </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SpringBootä½¿ç”¨redisè¿›è¡Œç¼“å­˜"><a href="#SpringBootä½¿ç”¨redisè¿›è¡Œç¼“å­˜" class="headerlink" title="SpringBootä½¿ç”¨redisè¿›è¡Œç¼“å­˜"></a>SpringBootä½¿ç”¨redisè¿›è¡Œç¼“å­˜</h3><h4 id="ä¸€ã€æ·»åŠ Pomä¾èµ–"><a href="#ä¸€ã€æ·»åŠ Pomä¾èµ–" class="headerlink" title="ä¸€ã€æ·»åŠ Pomä¾èµ–"></a>ä¸€ã€æ·»åŠ Pomä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="äºŒã€é…ç½®redisç›¸å…³å±æ€§"><a href="#äºŒã€é…ç½®redisç›¸å…³å±æ€§" class="headerlink" title="äºŒã€é…ç½®redisç›¸å…³å±æ€§"></a>äºŒã€é…ç½®redisç›¸å…³å±æ€§</h4><p>åœ¨å¼•å…¥<code>spring-boot-starter-data-redis</code>åï¼Œå¯åŠ¨ä¸»ç¨‹åºåä¼šè‡ªåŠ¨çš„å¼€å¯<code>redis</code>ç¼“å­˜ã€‚å¦‚æœæƒ³é…ç½®<code>redis</code>ï¼Œåˆ™å¯ä»¥åœ¨<code>org.springframework.boot.autoconfigure.data.redis.RedisProperties</code>è¿™ä¸ªå±æ€§ç±»ä¸­æŸ¥æ‰¾,ç„¶åæ·»åŠ åˆ°application.ymlä¸­ã€‚å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> database = <span class="number">0</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Connection URL. Overrides host, port, and password. User is ignored. Example:</span></span><br><span class="line"><span class="comment"> * redis://user:password@example.com:6379</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String host = <span class="string">"localhost"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> port = <span class="number">6379</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> ssl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Duration timeout;</span><br></pre></td></tr></table></figure><h4 id="ä¸‰ã€è‡ªå®šä¹‰redisTemplateå’ŒTtlCacheManager"><a href="#ä¸‰ã€è‡ªå®šä¹‰redisTemplateå’ŒTtlCacheManager" class="headerlink" title="ä¸‰ã€è‡ªå®šä¹‰redisTemplateå’ŒTtlCacheManager"></a>ä¸‰ã€è‡ªå®šä¹‰redisTemplateå’ŒTtlCacheManager</h4><p>æ ¹æ®SpringBootè‡ªåŠ¨é…ç½®æºç ï¼ŒredisTemplateåªæœ‰åœ¨ç¯å¢ƒä¸­æ²¡æœ‰ä»¥<code>redisTemplate</code>åç§°å‘½åçš„beanæ—¶å€™ï¼Œæ‰è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(name = <span class="string">"redisTemplate"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line"><span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œå¦‚æœæƒ³è‡ªè¡Œé…ç½®redisTemplateåˆ™å¯ç›´æ¥è£…è½½beanï¼Œå‘½åä¸º<code>redisTemplate</code>ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RedisTemplate <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">    RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">    template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">    <span class="comment">//Jackson2JsonRedisSerializer serializer = new Jackson2JsonRedisSerializer(Object.class);</span></span><br><span class="line">    <span class="comment">//ä½¿ç”¨Fastjson2JsonRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„valueå€¼ </span></span><br><span class="line">    FastJson2JsonRedisSerializer serializer = <span class="keyword">new</span> FastJson2JsonRedisSerializer(Object.class);</span><br><span class="line"></span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">    mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">    serializer.setObjectMapper(mapper);</span><br><span class="line"></span><br><span class="line">    template.setHashKeySerializer(serializer);</span><br><span class="line">    template.setHashValueSerializer(serializer);</span><br><span class="line">    template.setDefaultSerializer(serializer);</span><br><span class="line">    <span class="comment">//ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼,é˜²æ­¢ä¹±ç </span></span><br><span class="line">    template.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">    template.setValueSerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">    template.afterPropertiesSet();</span><br><span class="line">    <span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ @Cacheable(cacheManager="TtlCacheManager") æ¿€æ´»cacheManager</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"TtlCacheManager"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(RedisConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªRedisCacheWriter</span></span><br><span class="line">    RedisCacheWriter redisCacheWriter = RedisCacheWriter.nonLockingRedisCacheWriter(connectionFactory);</span><br><span class="line"></span><br><span class="line">    RedisCacheConfiguration defaultCacheConfig = RedisCacheConfiguration.defaultCacheConfig();</span><br><span class="line">    <span class="comment">//è®¾ç½®é»˜è®¤è¶…è¿‡æœŸæ—¶é—´æ˜¯30ç§’</span></span><br><span class="line">    defaultCacheConfig.entryTtl(Duration.ofSeconds(<span class="number">30</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–RedisCacheManager</span></span><br><span class="line">    RedisCacheManager cacheManager = <span class="keyword">new</span> RedisCacheManager(redisCacheWriter, defaultCacheConfig);</span><br><span class="line">    <span class="keyword">return</span> cacheManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ç”¨æ¥<code>FastJson2JsonRedisSerializer</code>æ¥ä»£æ›¿é»˜è®¤çš„<code>Jackson2JsonRedisSerializer</code>åºåˆ—åŒ–ç­–ç•¥ã€‚æ˜¯åœ¨ç½‘ä¸ŠæŸ¥æ‰¾åˆ°çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastJson2JsonRedisSerializer</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">RedisSerializer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_CHARSET = Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; clazz;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//å¦‚æœé‡åˆ°ååºåˆ—åŒ–autoType is not supporté”™è¯¯ï¼Œè¯·æ·»åŠ å¹¶ä¿®æ”¹ä¸€ä¸‹åŒ…ååˆ°beanæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">        <span class="comment">// ParserConfig.getGlobalInstance().addAccept("com.xxxxx.xxx");</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FastJson2JsonRedisSerializer</span><span class="params">(Class&lt;T&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.clazz = clazz;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] serialize(T t) <span class="keyword">throws</span> SerializationException &#123;</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(t, SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">deserialize</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> <span class="keyword">throws</span> SerializationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (bytes == <span class="keyword">null</span> || bytes.length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String str = <span class="keyword">new</span> String(bytes, DEFAULT_CHARSET);</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(str, clazz);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setObjectMapper</span><span class="params">(ObjectMapper objectMapper)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(objectMapper, <span class="string">"'objectMapper' must not be null"</span>);</span><br><span class="line">        <span class="keyword">this</span>.objectMapper = objectMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> JavaType <span class="title">getJavaType</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> TypeFactory.defaultInstance().constructType(clazz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootçš„è‡ªå®šä¹‰starterå¼€å‘</title>
      <link href="/2019/08/13/2019-08-13-SpringBoot%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89starter%E5%BC%80%E5%8F%91/"/>
      <url>/2019/08/13/2019-08-13-SpringBoot%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89starter%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootçš„è‡ªå®šä¹‰starterå¼€å‘"><a href="#SpringBootçš„è‡ªå®šä¹‰starterå¼€å‘" class="headerlink" title="SpringBootçš„è‡ªå®šä¹‰starterå¼€å‘"></a>SpringBootçš„è‡ªå®šä¹‰starterå¼€å‘</h1><p>SpringBootå®˜æ–¹é»˜è®¤æä¾›äº†å¾ˆå¤šçš„starterã€‚å‚è€ƒ<a href="https://docs.spring.io/spring-boot/docs/2.1.7.RELEASE/reference/html/using-boot-build-systems.html#using-boot-starter" target="_blank" rel="noopener">å®˜æ–¹çš„reference</a>ã€‚starterä½œä¸ºåœ¨SpringBootä¸­é‡è¦çš„ç‰¹æ€§ï¼Œä½¿ç”¨æ—¶èƒ½å¤Ÿåœ¨POMæ–‡ä»¶ä¸­ç›´æ¥å¼•ç”¨è¿™äº›starterï¼Œå¯ä»¥ä¸€ç«™å¼çš„è·å–ä¸Springç»“åˆçš„ç›¸å…³æœåŠ¡å’ŒåŠŸèƒ½ã€‚å¦‚æœæƒ³å¼•å…¥<code>redis</code>ç­‰åŠŸèƒ½ã€‚åˆ™ç›´æ¥æ·»åŠ ä½¿ç”¨<code>spring-boot-starter-data-redis</code>ã€‚åªéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å°‘é‡å±æ€§ï¼Œå°±å¯ä»¥åœ¨åº”ç”¨ä¸­ä½¿ç”¨ã€‚</p><h2 id="SpringBootçš„è‡ªåŠ¨é…ç½®åŸç†"><a href="#SpringBootçš„è‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="SpringBootçš„è‡ªåŠ¨é…ç½®åŸç†"></a>SpringBootçš„è‡ªåŠ¨é…ç½®åŸç†</h2><p>SpringBooté€šè¿‡starterï¼Œå¼•ç”¨ç›¸å…³æœåŠ¡ï¼Œç„¶åé€šè¿‡autoConfigureæ¥è‡ªåŠ¨é…ç½®ç›¸å…³æœåŠ¡ã€‚æ›´å¤šå…·ä½“çš„å®ç°å¯ä»¥å‚è€ƒ<a href="https://nanyiniu.github.io/2019/07/08/2019-07-08-SpringBootçš„é…ç½®æ–‡ä»¶ï¼ˆæ‹“å±•ï¼‰/">è¿™ç¯‡æ–‡ç« </a>ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œç®€è¦çš„åˆ†ææ¥å¦‚ä½•å®ç°è‡ªå®šä¹‰starterå’ŒåŸºæœ¬çš„è‡ªåŠ¨é…ç½®å®ç°ã€‚</p><h2 id="starterçš„åŸºæœ¬ç»“æ„"><a href="#starterçš„åŸºæœ¬ç»“æ„" class="headerlink" title="starterçš„åŸºæœ¬ç»“æ„"></a>starterçš„åŸºæœ¬ç»“æ„</h2><ul><li>åŒ…åç§°ä»¥ <code>spring-boot-starter-xxx</code> å‘½åï¼Œå¦‚å¼•ç”¨<code>spring-boot-starter-data-jpa</code>.å…¶ä¸­çš„å†…å®¹åªåŒ…æ‹¬pomæ–‡ä»¶ï¼Œç”¨æ¥å¼•ç”¨ç›¸å…³æœåŠ¡çš„jaråŒ…ã€‚</li><li>åŒ…åç§°ä»¥<code>xxx-spring-boot-autoconfigure</code>å‘½åã€‚åŒ…å«ï¼š<ul><li>xxxAutoConfiguration è‡ªåŠ¨é…ç½®ç±»ï¼Œä½¿ç”¨<code>Configuration</code>æ³¨è§£æ ‡å¿—ä¸ºé…ç½®ç±»ã€‚ä½¿ç”¨<code>Conditionalxxxx</code>ç›¸å…³æ³¨è§£è¡¨ç¤ºæ¡ä»¶ï¼Œä½¿ç”¨<code>EnableConfigurationProperties</code>æ³¨è§£ï¼Œæ¥æŒ‡å®šé…ç½®å±æ€§ç±»ã€‚</li><li>xxxProperties é…ç½®å±æ€§ç±»ã€‚ä½¿ç”¨<code>ConfigurationProperties</code>æ³¨è§£æ¥æ ‡å¿—ä¸ºé…ç½®å±æ€§ç±»ï¼Œå¹¶ä¸”éœ€è¦æŒ‡å®š<code>prefix</code>ï¼Œä»¥ä¾¿åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨prefix+å±æ€§åæ¥è®¾ç½®ç›¸å…³å±æ€§ã€‚</li><li>spring.factories æ–‡ä»¶ä¸­æ·»åŠ ç›¸å…³ä¿¡æ¯ï¼Œç”¨æ¥æŒ‡å®šéœ€è¦è¿›è¡Œè‡ªåŠ¨é…ç½®çš„ç±»çš„å…¨é™å®šåç§°ã€‚å¦‚ï¼š</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,</span><br></pre></td></tr></table></figure><h2 id="å¼€å§‹è‡ªå®šä¹‰starter"><a href="#å¼€å§‹è‡ªå®šä¹‰starter" class="headerlink" title="å¼€å§‹è‡ªå®šä¹‰starter"></a>å¼€å§‹è‡ªå®šä¹‰starter</h2><p>åœ¨æ­£å¼è¿›è¡Œä¹‹å‰ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„Projectï¼Œç”¨æ¥æ”¾<code>spring-boot-starter-xxx</code>å’Œ<code>xxx-spring-boot-autoconfigure</code>ã€‚</p><p><img src="resources/D4E8FA6034BD91653B267CA966CAE105.jpg" alt="IMAGE"></p><h3 id="åˆ›å»ºspring-boot-starter-xxxå’Œxxx-spring-boot-autoconfigure"><a href="#åˆ›å»ºspring-boot-starter-xxxå’Œxxx-spring-boot-autoconfigure" class="headerlink" title="åˆ›å»ºspring-boot-starter-xxxå’Œxxx-spring-boot-autoconfigure"></a>åˆ›å»ºspring-boot-starter-xxxå’Œxxx-spring-boot-autoconfigure</h3><p>åœ¨åˆ›å»ºå®Œç©ºé¡¹ç›®åï¼Œä¼šè¦æ±‚åˆ›å»º<code>module</code>ã€‚é€‰æ‹©<code>maven</code>æˆ–è€…<code>Spring Initializer</code>è¿›è¡Œ<code>spring-boot-starter-xxx</code>çš„åˆ›å»ºã€‚</p><p><img src="resources/81E6646F4498A3F1D325E12360F902AA.jpg" alt="IMAGE"></p><h3 id="é…ç½®starter"><a href="#é…ç½®starter" class="headerlink" title="é…ç½®starter"></a>é…ç½®starter</h3><p>åœ¨å®é™…æ“ä½œé…ç½®starterä¹‹å‰ï¼Œå…ˆæ¥åˆ†æSpringBootå®˜æ–¹æä¾›çš„starterçš„åŸºæœ¬çš„ä¾èµ–ç»“æ„ï¼Œä¸ºæ¥ä¸‹æ¥çš„æ„å»ºèµ·åˆ°æ¨¡ç‰ˆçš„ä½œç”¨ã€‚</p><p>åœ¨å·¦è¾¹çš„ä¸º<code>spring-boot-starter-web</code>çš„çš„ç®€å•çš„ä¾èµ–å…³ç³»ï¼Œå®ƒä¾èµ–<code>spring-boot-starter</code>ã€‚è€Œ<code>spring-boot-starter</code>è¿›ä¸€æ­¥ä¾èµ–äº<code>spring-boot-autoconfigure</code>ç”¨æ¥è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚</p><p>å¦‚æœè‡ªå·±è¿›è¡Œstarterçš„é…ç½®çš„è¯ï¼Œéœ€è¦å‚è€ƒå·¦è¾¹çš„ä¾èµ–ç»“æ„ï¼Œå®Œæˆåï¼Œå‚è€ƒå³è¾¹çš„ä¾èµ–å…³ç³»ã€‚</p><p><img src="resources/E55C2E6426E1702D43CD92FE54055F02.jpg" alt="IMAGE"></p><p>æ³¨ï¼šå¹¶ééœ€è¦å®Œå…¨æŒ‰ç…§è¿™æ ·çš„ä¾èµ–è¿›è¡Œç¨‹åºçš„æ„å»ºã€‚ä¸Šå›¾åªæ˜¯å‚è€ƒã€‚</p><h3 id="é…ç½®autoconfigurationåŒ…"><a href="#é…ç½®autoconfigurationåŒ…" class="headerlink" title="é…ç½®autoconfigurationåŒ…"></a>é…ç½®autoconfigurationåŒ…</h3><h4 id="pomé…ç½®"><a href="#pomé…ç½®" class="headerlink" title="pomé…ç½®"></a>pomé…ç½®</h4><p>åœ¨pom.xmlä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸»è¦éœ€è¦ä¾èµ–<code>spring-boot</code>ã€‚å¦‚æœåœ¨è‡ªåŠ¨é…ç½®ç±»éœ€è¦è¿›è¡Œå…¶ä»–ç‰¹æ®Šçš„<code>Conditional</code>è®¾ç½®æ—¶ï¼Œè¿˜éœ€è¦å¼•å…¥<code>spring-boot-autoconfigure</code>ã€‚</p><h4 id="æ·»åŠ xxxAutoConfiurationå’ŒxxxPropertiesç±»"><a href="#æ·»åŠ xxxAutoConfiurationå’ŒxxxPropertiesç±»" class="headerlink" title="æ·»åŠ xxxAutoConfiurationå’ŒxxxPropertiesç±»"></a>æ·»åŠ xxxAutoConfiurationå’ŒxxxPropertiesç±»</h4><p>è¿™ä¸¤ä¸ªç±»æ˜¯è‡ªåŠ¨é…ç½®ä¸­å¿…é¡»çš„ç±»ã€‚å†…å®¹å¯ä»¥å‚è€ƒ<code>WebMvcAutoConfiguration</code>å’Œ<code>WebMvcProperties</code>è¿™ä¸¤ä¸ªç±»ã€‚ä¸‹é¢æ˜¯æˆ‘çš„å…·ä½“å®ç°ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloAutoConfiguration è‡ªå®šä¹‰çš„AutoConfigurationç±»</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(&#123;HelloProperties.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloAutoConfiguration</span><span class="params">(HelloProperties helloProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.helloProperties = helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HelloService helloService = <span class="keyword">new</span> HelloService();</span><br><span class="line">        <span class="comment">// è®¾ç½®é…ç½®å±æ€§</span></span><br><span class="line">        helloService.setHelloProperties(helloProperties);</span><br><span class="line">        <span class="keyword">return</span> helloService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨serviceç±»æ¥æµ‹è¯•æ˜¯å¦é…ç½®æˆåŠŸï¼Œæ–¹æ³•è°ƒç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloProperties <span class="title">getHelloProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHelloProperties</span><span class="params">(HelloProperties helloProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.helloProperties = helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–¹æ³•è°ƒç”¨éªŒè¯å±æ€§æ˜¯å¦å…¶ä½œç”¨ã€‚ä¹Ÿå°±æ˜¯è‡ªåŠ¨é…ç½®æ˜¯å¦ç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix() + <span class="string">" hello world !"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰çš„Propertiesç±»</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String prefix ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPrefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrefix</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="spring-factories"><a href="#spring-factories" class="headerlink" title="spring.factories"></a>spring.factories</h4><p>å¦‚æœæƒ³è¦ä½¿ç”¨è‡ªåŠ¨é…ç½®ï¼Œå¿…é¡»æ·»åŠ <code>spring.factories</code>è¿™ä¸ªæ–‡ä»¶ã€‚æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">com.nanyin.hello.HelloAutoConfiguration</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-starter-xxx-åŒ…"><a href="#é…ç½®-starter-xxx-åŒ…" class="headerlink" title="é…ç½® starter-xxx åŒ…"></a>é…ç½® starter-xxx åŒ…</h3><h4 id="pomé…ç½®-1"><a href="#pomé…ç½®-1" class="headerlink" title="pomé…ç½®"></a>pomé…ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ„å»ºçš„starterä¾èµ–&gt;spring-boot-starter å’Œå…¶ä»–éœ€è¦çš„starter--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ä¾èµ–è‡ªåŠ¨é…ç½®åŒ…--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.nanyin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hello-spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><p>éœ€è¦åˆ é™¤ä¸éœ€è¦çš„ç±»æˆ–ç›®å½•ï¼Œå¦‚SpringBootå¯åŠ¨ç±»ç­‰ã€‚å‚è€ƒç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="resources/13707A6CCACD3FB3FF966B246EE0C736.jpg" alt="IMAGE"></p><h3 id="æ‰“æˆjaråŒ…"><a href="#æ‰“æˆjaråŒ…" class="headerlink" title="æ‰“æˆjaråŒ…"></a>æ‰“æˆjaråŒ…</h3><p>ä½¿ç”¨ideaä¸­çš„mavenå·¥å…·ï¼Œå¯¹ä¸Šä¸ªmoduleè¿›è¡Œåˆ†åˆ«æ‰“åŒ…ï¼Œå®‰è£…åˆ°æœ¬åœ°ã€‚æ‰“åŒ…çš„é¡ºåºæ˜¯å…ˆå®‰è£… <code>autoconfiuration</code> ï¼Œç„¶åå†å®‰è£… <code>starter-xxx</code>ã€‚</p><p><img src="resources/208EB8FC97CEA66C3BA8CA8BEC84535E.jpg" alt="IMAGE"></p><h2 id="ä½¿ç”¨starter"><a href="#ä½¿ç”¨starter" class="headerlink" title="ä½¿ç”¨starter"></a>ä½¿ç”¨starter</h2><p>æ–°å»ºä¸€ä¸ªwebçš„SpringBooté¡¹ç›®ï¼Œæ–°å»ºä¸€ä¸ªControllerï¼Œé‡Œé¢æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/sayHello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">String <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> helloService.sayHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  hello:</span></span><br><span class="line"><span class="attr">    prefix:</span> <span class="string">PREFIX</span></span><br></pre></td></tr></table></figure><p>åœ¨pom.xmlä¸­æ·»åŠ è‡ªå®šä¹‰çš„starterï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ·»åŠ è‡ªå®šä¹‰starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.nanyin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-hello<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºï¼Œåœ¨åœ°å€æ ä¸Šè¾“å…¥<code>http://localhost:8081/sayHello</code>,å‡ºç°ä¸‹å›¾æ•ˆæœï¼š</p><p><img src="resources/4F00E62D2255F0CB15BC5E5DF2871A6F.jpg" alt="IMAGE"></p><p>è¯´æ˜è‡ªåŠ¨é…ç½®æˆåŠŸã€‚</p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå¯åŠ¨ä¹‹refreshContext</title>
      <link href="/2019/08/05/SpringBoot%E5%90%AF%E5%8A%A8%E4%B9%8BrefreshContext/"/>
      <url>/2019/08/05/SpringBoot%E5%90%AF%E5%8A%A8%E4%B9%8BrefreshContext/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootå¯åŠ¨ä¹‹refreshContext"><a href="#SpringBootå¯åŠ¨ä¹‹refreshContext" class="headerlink" title="SpringBootå¯åŠ¨ä¹‹refreshContext"></a>SpringBootå¯åŠ¨ä¹‹refreshContext</h1><p>è¿™ç¯‡ä¸»è¦è¦é€šè¿‡<code>refreshContext</code>æ–¹æ³•æ¥å°†<code>SpringBoot</code>æ˜¯å¦‚ä½•åˆå§‹åŒ–<code>ioc</code>å®¹å™¨çš„ã€‚</p><h2 id="refreshContext"><a href="#refreshContext" class="headerlink" title="refreshContext"></a>refreshContext</h2><p>åœ¨<code>SpringBoot</code>ä¸­çš„runæ–¹æ³•ä¸­ï¼Œè°ƒç”¨<code>refreshContext()</code>æ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨ <code>AbstractApplicationContext</code>ç±»ä¸­çš„<code>refresh()</code>æ–¹æ³•ã€‚ç„¶ååˆ†ææ¯ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œæ¥çœ‹è¿™äº›æ–¹æ³•çš„ä½œç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">        <span class="comment">// å‡†å¤‡æ­¤ä¸Šä¸‹æ–‡ä»¥è¿›è¡Œåˆ·æ–°ï¼Œè®¾ç½®å…¶å¯åŠ¨æ—¥æœŸ</span></span><br><span class="line">        <span class="comment">// å¹¶ä¸”è®¾ç½® active æ ‡å¿—ä»¥åŠæ‰§è¡Œå±æ€§æºï¼ˆç³»ç»Ÿå±æ€§ã€ç¯å¢ƒå˜é‡ï¼‰çš„ä»»ä½•åˆå§‹åŒ–ã€‚</span></span><br><span class="line">        prepareRefresh();</span><br><span class="line">        <span class="comment">// å‘Šè¯‰å­ç±»åˆ·æ–° bean factory.</span></span><br><span class="line">        ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</span><br><span class="line">        <span class="comment">// ä¸ºä¸Šä¸‹æ–‡å‡†å¤‡ bean factory.</span></span><br><span class="line">        prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¥ä¸‹æ¥çš„æ–¹æ³•å°±æ˜¯è£…è½½ç»„ä»¶çš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">            postProcessBeanFactory(beanFactory);</span><br><span class="line">            <span class="comment">// ä½¿ç”¨beanFactoryåœ¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œbean</span></span><br><span class="line">            invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">            <span class="comment">// æ³¨å†Œbeançš„æ‹¦æˆªå™¨</span></span><br><span class="line">            registerBeanPostProcessors(beanFactory);</span><br><span class="line">            <span class="comment">// åŠ è½½å›½é™…åŒ–</span></span><br><span class="line">            initMessageSource();</span><br><span class="line">            <span class="comment">// åˆå§‹åŒ–ä¸Šä¸‹æ–‡çš„äº‹ä»¶å¹¿æ’­</span></span><br><span class="line">            initApplicationEventMulticaster();</span><br><span class="line">            <span class="comment">// åŠ è½½ç‰¹æ®Šçš„bean</span></span><br><span class="line">            onRefresh();</span><br><span class="line">            <span class="comment">// åŠ è½½æ‰€æœ‰çš„listenerså¹¶å¯åŠ¨</span></span><br><span class="line">            registerListeners();</span><br><span class="line">            <span class="comment">// å®Œæˆå¯¹æ‰€æœ‰çš„å‰©ä¸‹çš„éæ‡’åŠ è½½çš„å•ä¾‹çš„åˆ›å»º</span></span><br><span class="line">            finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">            <span class="comment">// æœ€åå‘å¸ƒå¯¹åº”çš„äº‹ä»¶ã€‚</span></span><br><span class="line">            finishRefresh();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="prepareRefresh-å‡†å¤‡åˆ·æ–°æ–¹æ³•"><a href="#prepareRefresh-å‡†å¤‡åˆ·æ–°æ–¹æ³•" class="headerlink" title="prepareRefresh å‡†å¤‡åˆ·æ–°æ–¹æ³•"></a>prepareRefresh å‡†å¤‡åˆ·æ–°æ–¹æ³•</h3><p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯ä¸ºäº†æ¥ä¸‹æ¥çš„refreshè¿›è¡Œçš„å‡†å¤‡ã€‚ä¸»è¦çš„æœ‰ä¸¤ä¸ªè¿‡ç¨‹</p><ol><li>è°ƒç”¨<code>initPropertySources()</code>æ–¹æ³•è¿›è¡Œ<code>propertySource</code>çš„åˆå§‹åŒ–ã€‚</li><li>éªŒè¯æœ‰æ²¡æœ‰ç¼ºå¤±çš„å¿…è¦çš„Propertyå±æ€§ã€‚</li></ol><h4 id="initPropertySources-åˆå§‹åŒ–propertySource"><a href="#initPropertySources-åˆå§‹åŒ–propertySource" class="headerlink" title="initPropertySources åˆå§‹åŒ–propertySource"></a>initPropertySources åˆå§‹åŒ–propertySource</h4><p>è°ƒç”¨å®ç°ç±»çš„<code>initPropertySources</code>ï¼Œæ ¹æ®debugçš„ç»“æœï¼Œè¿›å…¥åˆ°äº†å­ç±»<code>GenericWebApplication</code>ç±»ä¸­ï¼Œå¯¹<code>servletContex</code>è¿›è¡Œå±æ€§è®¾ç½®ã€‚å¦‚ä¸‹å›¾ä¸­æ‰€å±•ç¤ºçš„ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190812233656.jpg" alt="å›¾1"></p><h3 id="obtainFreshBeanFactory-è·å¾—beanFactory"><a href="#obtainFreshBeanFactory-è·å¾—beanFactory" class="headerlink" title="obtainFreshBeanFactory è·å¾—beanFactory"></a>obtainFreshBeanFactory è·å¾—beanFactory</h3><p>è¯¥æ–¹æ³•ä¾é refreshBeanFactory()æ¥åªæ˜¯beanå·¥å‚çš„å®é™…åˆ·æ–°ã€‚å› ä¸ºSpringBootåœ¨<code>ApplicationContext</code>å·²ç»æŒæœ‰ä¸€ä¸ªç±»å‹ä¸ºDefaultListableBeanFactoryç±»å‹çš„<code>beanFactory</code>ã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥è¿”å›ã€‚</p><h3 id="prepareBeanFactoryå‡†å¤‡BeanFactory"><a href="#prepareBeanFactoryå‡†å¤‡BeanFactory" class="headerlink" title="prepareBeanFactoryå‡†å¤‡BeanFactory"></a>prepareBeanFactoryå‡†å¤‡BeanFactory</h3><p>é…ç½®BeanFactoryçš„æ ‡å‡†ä¸Šä¸‹æ–‡ç‰¹å¾ã€‚ä¸»è¦ä½“ç°åœ¨ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li>è®¾ç½®classLoaderå’Œbeanåç§°çš„è§£æç­–ç•¥ç­‰ã€‚</li><li>è®¾ç½®ä»¥<code>Aware</code>ç»“å°¾çš„callbackæ¥å£å‡½æ•°ã€‚é€šè¿‡å¯¹è¿™äº›æ¥å£çš„å®ç°ã€‚æ¥è¾¾åˆ°å¯¹ç¯å¢ƒè®¾ç½®çš„ç›®çš„ã€‚å¦‚å¯ç»§æ‰¿<code>ResourceLoaderAware</code>æ¥å£ï¼Œæ¥è®¾ç½®èµ„æºåŠ è½½å™¨ï¼Œæ¥å®ç°è‡ªå®šä¹‰çš„èµ„æºåŠ è½½ã€‚</li><li>ä½¿ç”¨ç‰¹å®šçš„è‡ªåŠ¨è£…é…å€¼æ³¨å†Œç‰¹æ®Šä¾èµ–å…³ç³»ç±»å‹ã€‚å¦‚<code>beanFactory.registerResolvableDependency(ApplicationContext.class, this);</code></li><li>è®¾ç½®ç¯å¢ƒç›¸å…³çš„bean.å¦‚<code>beanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment());</code></li></ol><h3 id="postProcessBeanFactory"><a href="#postProcessBeanFactory" class="headerlink" title="postProcessBeanFactory"></a>postProcessBeanFactory</h3><p>å…è®¸åœ¨ä¸Šä¸‹æ–‡å­ç±»ä¸­å¯¹beanè¿›è¡Œåå¤„ç†ã€‚è°ƒç”¨ç›¸å…³æ–¹æ³•å®Œæˆå¯¹beanFactoryçš„åç½®å¤„ç†å…¶çš„åŠ è½½ã€‚<br>åœ¨ä¹‹åçš„<code>invokeBeanFactoryPostProcessors</code>å®ä¾‹åŒ–å¹¶è°ƒç”¨æ‰€æœ‰å·²æ³¨å†Œçš„BeanFactoryPostProcessor beanã€‚åœ¨æ–¹æ³•<code>registerBeanPostProcessors</code>ä¸­å®ä¾‹åŒ–å¹¶æ³¨å†Œæ‰€æœ‰BeanPostProcessor beanã€‚</p><h3 id="initMessageSource-åˆå§‹åŒ–MessageSource"><a href="#initMessageSource-åˆå§‹åŒ–MessageSource" class="headerlink" title="initMessageSource åˆå§‹åŒ–MessageSource"></a>initMessageSource åˆå§‹åŒ–MessageSource</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initMessageSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å…ˆè·å¾—beanå·¥å‚</span></span><br><span class="line">  ConfigurableListableBeanFactory beanFactory = getBeanFactory();</span><br><span class="line">  <span class="comment">// å¦‚æœå­˜åœ¨beanåç§°ä¸ºmessageSourceçš„bean </span></span><br><span class="line">  <span class="comment">// ä¹Ÿå°±æ˜¯å›½é™…åŒ–çš„Message</span></span><br><span class="line">  <span class="keyword">if</span> (beanFactory.containsLocalBean(MESSAGE_SOURCE_BEAN_NAME)) &#123;</span><br><span class="line">    <span class="comment">// è·å¾—messageSource</span></span><br><span class="line">    <span class="keyword">this</span>.messageSource = beanFactory.getBean(MESSAGE_SOURCE_BEAN_NAME, MessageSource.class);</span><br><span class="line">    <span class="comment">// Make MessageSource aware of parent MessageSource.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.parent != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.messageSource <span class="keyword">instanceof</span> HierarchicalMessageSource) &#123;</span><br><span class="line">      HierarchicalMessageSource hms = (HierarchicalMessageSource) <span class="keyword">this</span>.messageSource;</span><br><span class="line">      <span class="keyword">if</span> (hms.getParentMessageSource() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Only set parent context as parent MessageSource if no parent MessageSource</span></span><br><span class="line">        <span class="comment">// registered already.</span></span><br><span class="line">        hms.setParentMessageSource(getInternalParentMessageSource());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ã€‚ã€‚ã€‚è¿™é‡Œçœç•¥</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨debugæ—¶çš„ç»“æœï¼Œå› ä¸ºSpringBooté»˜è®¤å®ç°ç±»Messageï¼Œæ‰€ä»¥å®¹å™¨ä¼šåŠ è½½SpringBooté…ç½®å¥½çš„å›½é™…åŒ–é…ç½®æ–‡ä»¶ã€‚å¦‚å›¾ä¸­çš„basenameSet;<br><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190812233841.jpg" alt="å›¾2"></p><h3 id="onRefresh"><a href="#onRefresh" class="headerlink" title="onRefresh"></a>onRefresh</h3><p>åœ¨è¿™ä¸€æ­¥ï¼ŒSpringBootä¼šæ ¹æ®åº”ç”¨ç±»å‹æ¥åˆ¤æ–­ï¼Œå¦‚æœæ˜¯webåº”ç”¨ï¼Œåˆ™ä¼šå¯åŠ¨é»˜è®¤çš„webå®¹å™¨ï¼Œå¦‚tomcatã€‚<br>å®ƒå›å»æ‰¾æ‰€æœ‰çš„ç±»å‹ä¸º<code>ServletWebServerFactory</code>çš„ç±»ã€‚ç„¶åè·å–ç¬¬ä¸€ä¸ª<code>getBeanFactory().getBean(beanNames[0], ServletWebServerFactory.class);</code>è¿›è¡Œbeanæ³¨å…¥ã€‚è¿™æ ·é€šè¿‡æ³¨å…¥çš„beanå°±èƒ½å¤Ÿå¯åŠ¨webå®¹å™¨äº†ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190812233755.jpg" alt="å›¾3"></p><p>SpringBootä¸­é»˜è®¤å®ç°æœ‰ä»¥ä¸Šå‡ ç§ã€‚</p><h3 id="registerListeners-æ³¨å†Œlisteners"><a href="#registerListeners-æ³¨å†Œlisteners" class="headerlink" title="registerListeners æ³¨å†Œlisteners"></a>registerListeners æ³¨å†Œlisteners</h3><p>åœ¨è¿™ä¸€æ­¥ï¼Œæ³¨å†Œç±»å‹ä¸º<code>ApplicationListener</code>çš„æ‰€æœ‰listeners;</p><h3 id="finishBeanFactoryInitialization-å®Œæˆæ‰€æœ‰éæ‡’åŠ è½½çš„beançš„åˆå§‹åŒ–"><a href="#finishBeanFactoryInitialization-å®Œæˆæ‰€æœ‰éæ‡’åŠ è½½çš„beançš„åˆå§‹åŒ–" class="headerlink" title="finishBeanFactoryInitialization å®Œæˆæ‰€æœ‰éæ‡’åŠ è½½çš„beançš„åˆå§‹åŒ–"></a>finishBeanFactoryInitialization å®Œæˆæ‰€æœ‰éæ‡’åŠ è½½çš„beançš„åˆå§‹åŒ–</h3><h3 id="finishRefresh-å®Œæˆåˆ·æ–°"><a href="#finishRefresh-å®Œæˆåˆ·æ–°" class="headerlink" title="finishRefresh å®Œæˆåˆ·æ–°"></a>finishRefresh å®Œæˆåˆ·æ–°</h3><p>è¿™æ­¥æœ‰ä»¥ä¸‹å‡ ä¸ªæ“ä½œã€‚</p><ol><li><code>clearResourceCaches</code>æ–¹æ³•ã€‚ æ¸…ç©º<code>context-level</code>çš„ç¼“å­˜ã€‚</li><li><code>initLifecycleProcessor</code>æ–¹æ³•ï¼Œç”¨æ¥è®¾ç½®ç”Ÿå‘½å‘¨æœŸprocesser</li><li>å‘å¸ƒæœ€åçš„äº‹ä»¶ï¼ˆ<code>ContextRefreshedEvent</code>ï¼‰</li></ol><p>ä»¥ä¸Šå°±å®Œæˆäº†refreshæ–¹æ³•ä¸­çš„æ‰€æœ‰æ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå¯åŠ¨åŸç†</title>
      <link href="/2019/08/05/SpringBoot%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86/"/>
      <url>/2019/08/05/SpringBoot%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootçš„å¯åŠ¨åŸç†"><a href="#SpringBootçš„å¯åŠ¨åŸç†" class="headerlink" title="SpringBootçš„å¯åŠ¨åŸç†"></a>SpringBootçš„å¯åŠ¨åŸç†</h1><h2 id="åˆ›å»ºå¯åŠ¨å™¨"><a href="#åˆ›å»ºå¯åŠ¨å™¨" class="headerlink" title="åˆ›å»ºå¯åŠ¨å™¨"></a>åˆ›å»ºå¯åŠ¨å™¨</h2><p>SpringBooté€šè¿‡è°ƒç”¨ä¸»ç¨‹åºå¯åŠ¨åº”ç”¨ç¯å¢ƒã€‚ä¸‹é¢ä»£ç ä¸ºåº”ç”¨å¯åŠ¨å™¨çš„åŸºæœ¬ä»£ç ã€‚</p><h3 id="å¯åŠ¨å™¨"><a href="#å¯åŠ¨å™¨" class="headerlink" title="å¯åŠ¨å™¨"></a>å¯åŠ¨å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ‡æ³¨è¿™æ˜¯SpringBootåº”ç”¨</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// å¼€å¯cache</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebProjectApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// fastJsonä¸ä½¿ç”¨å¾ªç¯å¼•ç”¨ ï¼ˆ$refï¼‰</span></span><br><span class="line">        JSON.DEFAULT_GENERATE_FEATURE |= SerializerFeature.DisableCircularReferenceDetect.getMask();</span><br><span class="line">        <span class="comment">// ä½¿ç”¨SpringApplicationå¯åŠ¨åº”ç”¨</span></span><br><span class="line">        SpringApplication.run(WebProjectApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥<code>SpringApplication.run</code>æ–¹æ³•ä¹‹åï¼Œå‘ç°ç¨‹åºä¼šè°ƒç”¨<code>new SpringApplication</code> æ¥åˆ›å»ºåº”ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Class&lt;?&gt;[] primarySources, String[] args)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SpringApplication(primarySources).run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>new SpringApplication</code>åˆ›å»ºå®ä¾‹çš„è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨å®¹å™¨ä¼šä»åŠ è½½ä¸€äº›ä¸»ç±»ã€‚æ¯”å¦‚ä»£ç ä¸­æ‰€å†™çš„ï¼š</p><h3 id="åˆå§‹åŒ–SpringApplication"><a href="#åˆå§‹åŒ–SpringApplication" class="headerlink" title="åˆå§‹åŒ–SpringApplication"></a>åˆå§‹åŒ–SpringApplication</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„ primarySources å°±æ˜¯ ä¸Šé¢çš„ WebProjectApplication</span></span><br><span class="line">    <span class="keyword">this</span>.resourceLoader = resourceLoader;</span><br><span class="line">    Assert.notNull(primarySources, <span class="string">"PrimarySources must not be null"</span>);</span><br><span class="line">    <span class="keyword">this</span>.primarySources = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.asList(primarySources));</span><br><span class="line">    <span class="comment">// æ ¹æ®classpath æ¥åˆ¤æ–­åº”å½“å¯åŠ¨ä»€ä¹ˆæ ·çš„åº”ç”¨ç¨‹åºï¼Ÿ 1. éweb 2.webå¹¶ä½¿ç”¨å†…å®¹selvletå®¹å™¨</span></span><br><span class="line">    <span class="comment">// 3. web ä½†ä¸å®ç”¨å†…ç½®webå®¹å™¨</span></span><br><span class="line">    <span class="keyword">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();</span><br><span class="line">    <span class="comment">// è®¾ç½® Initializer</span></span><br><span class="line">    setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));</span><br><span class="line">    <span class="comment">// è®¾ç½® Listener</span></span><br><span class="line">    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</span><br><span class="line">    <span class="comment">//åˆ¤æ–­ä¸»è¿è¡Œç¨‹åºæ˜¯å“ªä¸ªï¼Œæ¯”å¦‚æœ‰å¤šä¸ªä¸»ç¨‹åºï¼Œåˆ°åº•ä½¿ç”¨å“ªä¸ªã€‚</span></span><br><span class="line">    <span class="keyword">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œåœ¨<code>setInitializers</code>å’Œ<code>setListeners</code>çš„è¿‡ç¨‹æ˜¯ç±»ä¼¼çš„ã€‚ä¸»è¦æ–¹æ³•å°±æ˜¯ä»<code>META-INF/spring.factories</code>ä¸­åŠ è½½ç‰¹å®šçš„keyå€¼ä¸‹çš„valueã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, Object... args)</span> </span>&#123;</span><br><span class="line">    ClassLoader classLoader = getClassLoader();</span><br><span class="line">    <span class="comment">// ä½¿ç”¨setåŠ è½½æ‰€æœ‰çš„å…¨ç±»å</span></span><br><span class="line">    Set&lt;String&gt; names = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(SpringFactoriesLoader.loadFactoryNames(type, classLoader));</span><br><span class="line">    <span class="comment">// æ ¹æ®ç±»åé€šè¿‡åå°„åˆ›å»ºå®ä¾‹</span></span><br><span class="line">    List&lt;T&gt; instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);</span><br><span class="line">    AnnotationAwareOrderComparator.sort(instances);</span><br><span class="line">    <span class="comment">// è¿”å›å®ä¾‹</span></span><br><span class="line">    <span class="keyword">return</span> instances;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢åˆ†æäº†<code>getSpringFactoriesInstances</code>è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•è·å–å®ä¾‹çš„ï¼Œå…¶ä¸­è·å–çš„é€”å¾„å°±æ˜¯ä½¿ç”¨<code>SpringFactoriesLoader.loadFactoryNames</code>è·å–å…¨ç±»åï¼Œç„¶åé€šè¿‡åå°„è¿›è¡Œåˆ›å»ºå®ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, @Nullable ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–ä¼ é€’è¿›æ¥çš„ ç±»å</span></span><br><span class="line">    String factoryClassName = factoryClass.getName();</span><br><span class="line">    <span class="comment">// å¦‚æœä¸å­˜åœ¨å°±è¿”å›ä¸€ä¸ªç©ºçš„listï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™è¿”å›ä¸€ä¸ªå…¨ç±»åçš„ä¸€ä¸ªlist</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªlistæ˜¯ä»ä¸‹é¢æ˜¯æ–¹æ³•ä¸­çš„resultä¸­ç›´æ¥è·å–value</span></span><br><span class="line">    <span class="keyword">return</span> loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// èŠ‚é€‰ä¸€æ®µä»£ç æ¥çœ‹loadSpringFactories æ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(<span class="meta">@Nullable</span> ClassLoader classLoader) &#123;</span><br><span class="line">    <span class="comment">// ä»è·¯å¾„ä¸Šè·å–resource è¿™ä¸ªè·¯å¾„æ­£æ˜¯ META-INF/spring.factories åŠ è½½æ‰€æœ‰çš„</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªè·¯å¾„ä¸‹çš„url ç»„æˆä¸€ä¸ªresult</span></span><br><span class="line">    Enumeration&lt;URL&gt; urls = (classLoader != <span class="keyword">null</span> ?</span><br><span class="line">            classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :</span><br><span class="line">            ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));</span><br><span class="line">    result = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (urls.hasMoreElements()) &#123; <span class="comment">// å¾ªç¯</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¸€ç³»åˆ—æ–¹æ³•åªæ˜¯ä¸ºç»™<code>SpringApplication</code>è¿›è¡Œåˆå§‹åŒ–çš„ç›¸å…³æ“ä½œï¼Œä¸‹ä¸€æ­¥ï¼Œè°ƒç”¨<code>SpringApplication.run</code>æ­£å¼è¿è¡Œå®¹å™¨.</p><h2 id="å¯åŠ¨å™¨å¯åŠ¨"><a href="#å¯åŠ¨å™¨å¯åŠ¨" class="headerlink" title="å¯åŠ¨å™¨å¯åŠ¨"></a>å¯åŠ¨å™¨å¯åŠ¨</h2><p>åœ¨æ–°å»ºå®ŒSpringApplicationåï¼Œä½¿ç”¨runæ–¹æ³•æ­£å¼å¯åŠ¨å®¹å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> SpringApplication(primarySources).run(args);</span><br><span class="line"> <span class="comment">// è¿™ä¸ªrunæ–¹æ³•ç›´æ¥è°ƒç”¨çš„æ˜¯ä»¥ä¸‹ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªè·‘è¡¨</span></span><br><span class="line">    StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">    stopWatch.start();</span><br><span class="line">    ConfigurableApplicationContext context = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// arrayListç±»å‹çš„Exception Reporters</span></span><br><span class="line">    Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// é…ç½®headless</span></span><br><span class="line">    configureHeadlessProperty();</span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰çš„listeners</span></span><br><span class="line">    SpringApplicationRunListeners listeners = getRunListeners(args);</span><br><span class="line">    <span class="comment">// å¯åŠ¨listeners</span></span><br><span class="line">    listeners.starting();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å°è£…å‘½ä»¤è¡Œargs</span></span><br><span class="line">        ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(args);</span><br><span class="line">        <span class="comment">//å‡†å¤‡ç¯å¢ƒ</span></span><br><span class="line">        ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments);</span><br><span class="line">        <span class="comment">//é€šè¿‡è®¾ç½®spring.beaninfo.ignoreæ¥å¿½ç•¥beanè®¾ç½®</span></span><br><span class="line">        configureIgnoreBeanInfo(environment);</span><br><span class="line">        <span class="comment">// æ‰“å°Springæ ‡è®°</span></span><br><span class="line">        Banner printedBanner = printBanner(environment);</span><br><span class="line">        <span class="comment">// ç­–ç•¥åˆ›å»ºæŒ‡å®šçš„applicationContext</span></span><br><span class="line">        context = createApplicationContext();</span><br><span class="line">        exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class,</span><br><span class="line">                <span class="keyword">new</span> Class[] &#123; ConfigurableApplicationContext.class &#125;, context);</span><br><span class="line">        prepareContext(context, environment, listeners, applicationArguments, printedBanner);</span><br><span class="line">        <span class="comment">// åˆ·æ–°ä¸Šä¸‹æ–‡ï¼Œåˆ›å»ºioc</span></span><br><span class="line">        refreshContext(context);</span><br><span class="line">        <span class="comment">// åœ¨ä¸Šä¸‹æ–‡åˆ·æ–°ä¹‹åè°ƒç”¨</span></span><br><span class="line">        afterRefresh(context, applicationArguments);</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">            <span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å®Œæˆç›‘å¬å™¨çš„å¯åŠ¨</span></span><br><span class="line">        listeners.started(context);</span><br><span class="line">        <span class="comment">// è°ƒç”¨callRunners</span></span><br><span class="line">        callRunners(context, applicationArguments);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        handleRunFailure(context, ex, exceptionReporters, listeners);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        listeners.running(context);</span><br></pre></td></tr></table></figure><h3 id="getRunListenersæ–¹æ³•ä¸å¯åŠ¨Listeners"><a href="#getRunListenersæ–¹æ³•ä¸å¯åŠ¨Listeners" class="headerlink" title="getRunListenersæ–¹æ³•ä¸å¯åŠ¨Listeners"></a>getRunListenersæ–¹æ³•ä¸å¯åŠ¨Listeners</h3><p>è·å¾—æ‰€æœ‰çš„listenersï¼Œç„¶åè°ƒç”¨ <code>listeners.starting();</code>è¿è¡Œç›‘å¬å™¨ã€‚</p><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­,ä½¿ç”¨åˆ°äº†<code>getSpringFactoriesInstances</code>æ–¹æ³•ï¼Œä¸Šé¢è¯´åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•å®é™…ä¸Šå°±æ˜¯ä»<code>spring.factory</code>ä¸­è·å–æ‰€æœ‰çš„keyä¸ºç‰¹å®šå€¼çš„ç±»ã€‚åœ¨getRunListenersæ–¹æ³•é‡Œå°±æ˜¯è·å–æ‰€æœ‰çš„keyä¸º<code>SpringApplicationRunListener</code>çš„æ‰€æœ‰valueã€‚å‚è€ƒä¸‹å›¾ä¸­å†…å®¹ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190805222228.png" alt="å›¾1"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> SpringApplicationRunListeners <span class="title">getRunListeners</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Class&lt;?&gt;[] types = <span class="keyword">new</span> Class&lt;?&gt;[] &#123; SpringApplication.class, String[].class &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SpringApplicationRunListeners(logger,</span><br><span class="line">            getSpringFactoriesInstances(SpringApplicationRunListener.class, types, <span class="keyword">this</span>, args));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå°±å¯ä»¥è·å–åˆ°æ‰€æœ‰çš„RunListenersã€‚ä½¿ç”¨startingæ–¹æ³•æ¥æ‰¹é‡çš„å¼€å¯listenerã€‚å…¶å†…éƒ¨å®ç°å¦‚ä¸‹é¢çš„ä»£ç ã€‚æ˜¯ä½¿ç”¨forå¾ªç¯å°†æ‰€æœ‰åŠ è½½åˆ°çš„listenerså¯åŠ¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">starting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (SpringApplicationRunListener listener : <span class="keyword">this</span>.listeners) &#123;</span><br><span class="line">        listener.starting();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="prepareEnvironment-å‡†å¤‡ç¯å¢ƒ"><a href="#prepareEnvironment-å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="prepareEnvironment å‡†å¤‡ç¯å¢ƒ"></a>prepareEnvironment å‡†å¤‡ç¯å¢ƒ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ConfigurableEnvironment <span class="title">prepareEnvironment</span><span class="params">(SpringApplicationRunListeners listeners,</span></span></span><br><span class="line"><span class="function"><span class="params">        ApplicationArguments applicationArguments)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å¾—é…ç½®ç¯å¢ƒ</span></span><br><span class="line">    ConfigurableEnvironment environment = getOrCreateEnvironment();</span><br><span class="line">    <span class="comment">// é…ç½®ç¯å¢ƒ</span></span><br><span class="line">    configureEnvironment(environment, applicationArguments.getSourceArgs());</span><br><span class="line">    <span class="comment">// åœ¨ç¯å¢ƒå‡†å¤‡å¥½åç«‹å³è°ƒç”¨ç›‘å¬å™¨çš„environmentPreparedæ–¹æ³•</span></span><br><span class="line">    <span class="comment">// éœ€è¦åœ¨SpringApplicationåˆ›å»ºä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line">    listeners.environmentPrepared(environment);</span><br><span class="line">    <span class="comment">// ç»‘å®šåˆ°SpringApplication</span></span><br><span class="line">    bindToSpringApplication(environment);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isCustomEnvironment) &#123;</span><br><span class="line">        environment = <span class="keyword">new</span> EnvironmentConverter(getClassLoader()).convertEnvironmentIfNecessary(environment,</span><br><span class="line">                deduceEnvironmentClass());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†ConfigurationPropertySourcesæ”¯æŒæŒ‡å®šçš„ç¯å¢ƒã€‚</span></span><br><span class="line">    ConfigurationPropertySources.attach(environment);</span><br><span class="line">    <span class="keyword">return</span> environment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®ç¯å¢ƒçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦é…ç½®<code>properties</code>å±æ€§å’Œ<code>profile</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureEnvironment</span><span class="params">(ConfigurableEnvironment environment, String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœéœ€è¦è¿›è¡Œåœ¨propertieså±æ€§ä¸Šçš„ç±»å‹è½¬æ¢</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.addConversionService) &#123;</span><br><span class="line">        ConversionService conversionService = ApplicationConversionService.getSharedInstance();</span><br><span class="line">        environment.setConversionService((ConfigurableConversionService) conversionService);</span><br><span class="line">    &#125;</span><br><span class="line">    configurePropertySources(environment, args);</span><br><span class="line">    <span class="comment">// é…ç½®profileï¼ŒåŒ…æ‹¬æ¿€æ´»çš„é…ç½®æ–‡ä»¶ç­‰ã€‚</span></span><br><span class="line">    configureProfiles(environment, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="configureProfiles-é…ç½®profile"><a href="#configureProfiles-é…ç½®profile" class="headerlink" title="configureProfiles é…ç½®profile"></a>configureProfiles é…ç½®profile</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureProfiles</span><span class="params">(ConfigurableEnvironment environment, String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è®¾ç½®æ¿€æ´»çš„profileï¼Œå¯ä»¥é€šè¿‡å±æ€§ spring.profiles.activeæ¥è®¾ç½®</span></span><br><span class="line">    environment.getActiveProfiles();</span><br><span class="line">    Set&lt;String&gt; profiles = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(<span class="keyword">this</span>.additionalProfiles);</span><br><span class="line">    profiles.addAll(Arrays.asList(environment.getActiveProfiles()));</span><br><span class="line">    <span class="comment">// åœ¨ç¯å¢ƒä¸­è®¾ç½®æ¿€æ´»çš„profiles</span></span><br><span class="line">    environment.setActiveProfiles(StringUtils.toStringArray(profiles));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="printBanner-æ‰“å°æ ‡å¿—"><a href="#printBanner-æ‰“å°æ ‡å¿—" class="headerlink" title="printBanner æ‰“å°æ ‡å¿—"></a>printBanner æ‰“å°æ ‡å¿—</h3><p>printBanneræ–¹æ³•ç”¨æ¥æ‰“å°è¿è¡Œç¨‹åºæ—¶çš„æ ‡å¿—ï¼Œè§ä¸‹å›¾</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190807214428.png" alt="å›¾2"></p><p>è¿™ä¸ªæ–¹æ³•æœ€åé€šè¿‡<code>print</code>æ–¹æ³•æ¥è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Banner <span class="title">print</span><span class="params">(Environment environment, Class&lt;?&gt; sourceClass, PrintStream out)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–banner</span></span><br><span class="line">    Banner banner = getBanner(environment);</span><br><span class="line">    banner.printBanner(environment, sourceClass, out);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PrintedBanner(banner, sourceClass);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤æ˜¯ DEFAULT_BANNER</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] BANNER = &#123; <span class="string">""</span>, <span class="string">"  .   ____          _            __ _ _"</span>,</span><br><span class="line">        <span class="string">" /\\\\ / ___'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\"</span>, <span class="string">"( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\"</span>,</span><br><span class="line">        <span class="string">" \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )"</span>, <span class="string">"  '  |____| .__|_| |_|_| |_\\__, | / / / /"</span>,</span><br><span class="line">        <span class="string">" =========|_|==============|___/=/_/_/_/"</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SPRING_BOOT = <span class="string">" :: Spring Boot :: "</span>;</span><br></pre></td></tr></table></figure><h3 id="createApplicationContext-åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ç¯å¢ƒ"><a href="#createApplicationContext-åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ç¯å¢ƒ" class="headerlink" title="createApplicationContext åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ç¯å¢ƒ"></a>createApplicationContext åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ç¯å¢ƒ</h3><p><code>createApplicationContext</code>æ–¹æ³•ç”¨æ¥ç­–ç•¥åˆ›å»ºæŒ‡å®šçš„applicationContext;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ConfigurableApplicationContext <span class="title">createApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Class&lt;?&gt; contextClass = <span class="keyword">this</span>.applicationContextClass;</span><br><span class="line">    <span class="keyword">if</span> (contextClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> (<span class="keyword">this</span>.webApplicationType) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯servletç¯å¢ƒ</span></span><br><span class="line">            <span class="keyword">case</span> SERVLET:</span><br><span class="line">            <span class="comment">// åˆ›å»ºAnnotationConfigServletWebServerApplicationContext</span></span><br><span class="line">            <span class="comment">// é€‚ç”¨äºé»˜è®¤çš„webç¯å¢ƒ</span></span><br><span class="line">                contextClass = Class.forName(DEFAULT_SERVLET_WEB_CONTEXT_CLASS);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> REACTIVE:</span><br><span class="line">            <span class="comment">// åˆ›å»ºAnnotationConfigReactiveWebServerApplicationContext </span></span><br><span class="line">            <span class="comment">// é€‚ç”¨äºreactive webç¯å¢ƒ</span></span><br><span class="line">                contextClass = Class.forName(DEFAULT_REACTIVE_WEB_CONTEXT_CLASS);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">            <span class="comment">// åˆ›å»ºAnnotationConfigApplicationContextï¼Œéwebç¯å¢ƒ</span></span><br><span class="line">                contextClass = Class.forName(DEFAULT_CONTEXT_CLASS);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                    <span class="string">"Unable create a default ApplicationContext, "</span> + <span class="string">"please specify an ApplicationContextClass"</span>,</span><br><span class="line">                    ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (ConfigurableApplicationContext) BeanUtils.instantiateClass(contextClass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="prepareContext-å‡†å¤‡ä¸Šä¸‹æ–‡"><a href="#prepareContext-å‡†å¤‡ä¸Šä¸‹æ–‡" class="headerlink" title="prepareContext å‡†å¤‡ä¸Šä¸‹æ–‡"></a>prepareContext å‡†å¤‡ä¸Šä¸‹æ–‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">prepareContext</span><span class="params">(ConfigurableApplicationContext context, ConfigurableEnvironment environment,</span></span></span><br><span class="line"><span class="function"><span class="params">        SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner)</span> </span>&#123;</span><br><span class="line">    context.setEnvironment(environment);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * åç½®å¤„ç†context</span></span><br><span class="line"><span class="comment">    * 1. åˆ›å»ºä¸€ä¸ªå•ä¾‹çš„beanNameGenerator</span></span><br><span class="line"><span class="comment">    * 2. å¦‚æœresourceLoaderä¸ä¸ºç©ºï¼Œåˆ™è®¾ç½®resourceLoaderå’ŒclassLoader\</span></span><br><span class="line"><span class="comment">    * 3. è®¾ç½®ç”¨äºå±æ€§å€¼è½¬æ¢çš„ConversionService</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    postProcessApplicationContext(context);</span><br><span class="line">    <span class="comment">// é€šè¿‡åœ¨ åˆå§‹åŒ–SpringApplication è¿™é‡Œè®¾ç½®çš„Initializersæ¥å¯¹ç¯å¢ƒè¿›è¡Œè®¾ç½®</span></span><br><span class="line">    applyInitializers(context);</span><br><span class="line">    <span class="comment">// å‘Šè¯‰ç›‘å¬å™¨ä¸Šä¸‹æ–‡å‡†å¤‡å¥½äº†</span></span><br><span class="line">    listeners.contextPrepared(context);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">        logStartupInfo(context.getParent() == <span class="keyword">null</span>);</span><br><span class="line">        logStartupProfileInfo(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ... ä¸­é—´çœç•¥</span></span><br><span class="line">    <span class="comment">// å†æ¬¡è°ƒç”¨ç›‘å¬å™¨çš„äº‹ä»¶ï¼Œé€šçŸ¥ç›‘å¬å™¨ä¸Šä¸‹æ–‡å·²ç»åŠ è½½å®Œæˆ</span></span><br><span class="line">    listeners.contextLoaded(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="refreshContext-åˆ·æ–°ä¸Šä¸‹æ–‡"><a href="#refreshContext-åˆ·æ–°ä¸Šä¸‹æ–‡" class="headerlink" title="refreshContext åˆ·æ–°ä¸Šä¸‹æ–‡"></a>refreshContext åˆ·æ–°ä¸Šä¸‹æ–‡</h3><p>ç”¨äºåˆ·æ–°ä¸Šä¸‹æ–‡ï¼Œåˆ·æ–°ä¸Šä¸‹æ–‡çš„è¿‡ç¨‹å…¶å®å°±æ˜¯IOCå®¹å™¨åˆå§‹åŒ–çš„è¿‡ç¨‹(æ‰«æã€åŠ è½½ã€åˆ›å»ºæ‰€æœ‰çš„ç»„ä»¶)ã€‚å¦‚æœæ˜¯webåº”ç”¨ï¼Œè¿˜ä¼šè‡ªåŠ¨å¯åŠ¨åµŒå…¥å¼çš„tomcat.å…·ä½“æ–¹æ³•ä¼šå•æ‹¿å‡ºæ¥ä¸€ç¯‡æ¥åˆ†ærefreshçš„è¿‡ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">        <span class="comment">// å‡†å¤‡æ­¤ä¸Šä¸‹æ–‡ä»¥è¿›è¡Œåˆ·æ–°ï¼Œè®¾ç½®å…¶å¯åŠ¨æ—¥æœŸ</span></span><br><span class="line">        <span class="comment">// å¹¶ä¸”è®¾ç½® active æ ‡å¿—ä»¥åŠæ‰§è¡Œå±æ€§æºï¼ˆç³»ç»Ÿå±æ€§ã€ç¯å¢ƒå˜é‡ï¼‰çš„ä»»ä½•åˆå§‹åŒ–ã€‚</span></span><br><span class="line">        prepareRefresh();</span><br><span class="line">        <span class="comment">// å‘Šè¯‰å­ç±»åˆ·æ–° bean factory.</span></span><br><span class="line">        ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</span><br><span class="line">        <span class="comment">// ä¸ºä¸Šä¸‹æ–‡å‡†å¤‡ bean factory.</span></span><br><span class="line">        prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¥ä¸‹æ¥çš„æ–¹æ³•å°±æ˜¯è£…è½½ç»„ä»¶çš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">            postProcessBeanFactory(beanFactory);</span><br><span class="line">            <span class="comment">// ä½¿ç”¨beanFactoryåœ¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œbean</span></span><br><span class="line">            invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">            <span class="comment">// æ³¨å†Œbeançš„æ‹¦æˆªå™¨</span></span><br><span class="line">            registerBeanPostProcessors(beanFactory);</span><br><span class="line">            <span class="comment">// åŠ è½½å›½é™…åŒ–</span></span><br><span class="line">            initMessageSource();</span><br><span class="line">            <span class="comment">// åˆå§‹åŒ–ä¸Šä¸‹æ–‡çš„äº‹ä»¶å¹¿æ’­</span></span><br><span class="line">            initApplicationEventMulticaster();</span><br><span class="line">            <span class="comment">// åŠ è½½ç‰¹æ®Šçš„bean</span></span><br><span class="line">            onRefresh();</span><br><span class="line">            <span class="comment">// åŠ è½½æ‰€æœ‰çš„listenerså¹¶å¯åŠ¨</span></span><br><span class="line">            registerListeners();</span><br><span class="line">            <span class="comment">// å®Œæˆå¯¹æ‰€æœ‰çš„å‰©ä¸‹çš„éæ‡’åŠ è½½çš„å•ä¾‹çš„åˆ›å»º</span></span><br><span class="line">            finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">            <span class="comment">// æœ€åå‘å¸ƒå¯¹åº”çš„äº‹ä»¶ã€‚</span></span><br><span class="line">            finishRefresh();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨callRunners"><a href="#è°ƒç”¨callRunners" class="headerlink" title="è°ƒç”¨callRunners"></a>è°ƒç”¨callRunners</h3><h2 id="å¯åŠ¨è¿‡ç¨‹å›¾è§£"><a href="#å¯åŠ¨è¿‡ç¨‹å›¾è§£" class="headerlink" title="å¯åŠ¨è¿‡ç¨‹å›¾è§£"></a>å¯åŠ¨è¿‡ç¨‹å›¾è§£</h2><p>ä½¿ç”¨ä¸€å¼ ç®€å•çš„æµç¨‹å›¾å°†ä¸Šé¢æ‰€æœ‰çš„ä¸»è¦æ–¹æ³•ä¸²è”èµ·æ¥ï¼Œæ¥æŸ¥çœ‹SpringBootçš„å¯åŠ¨æµç¨‹ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190811124925.png" alt="å›¾3"></p><p>åœ¨æ•´ä¸ªå¯åŠ¨æµç¨‹çš„è¿‡ç¨‹ä¸­åˆä¸€ä¸ªé‡è¦çš„ç»„ä»¶å°±æ˜¯listeners.å®ƒæ¥ç›‘å¬åº”ç”¨è¿è¡Œçš„è¿‡ç¨‹ã€‚åœ¨ç¨‹åºä¸­çš„ä½“ç°å°±æ˜¯ç‰¹å®šçš„èŠ‚ç‚¹è°ƒç”¨listenersçš„å›è°ƒæ–¹æ³•ã€‚å…·ä½“çš„è°ƒç”¨listenersè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€å±•ç¤ºçš„ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190811125247.png" alt="å›¾4"></p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>è¿™ç¯‡æ–‡ç« æ ¹æ®ä»£ç æ¥åˆ†æSpringBootçš„å¯åŠ¨è¿‡ç¨‹ã€‚åˆ†æçš„æ¯”è¾ƒæ½¦è‰ï¼Œæœ‰äº›åœ°æ–¹åˆ†æçš„ä¸æ¸…æ™°æˆ–è€…åˆ†æå‡ºé”™çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå…±åŒè¿›æ­¥ï¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootçš„é”™è¯¯å¤„ç†æœºåˆ¶</title>
      <link href="/2019/07/17/2019-07-17-SpringBoot%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6/"/>
      <url>/2019/07/17/2019-07-17-SpringBoot%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨webå¼€å‘ä¸­çš„å¼‚å¸¸é”™è¯¯å¤„ç†"><a href="#åœ¨webå¼€å‘ä¸­çš„å¼‚å¸¸é”™è¯¯å¤„ç†" class="headerlink" title="åœ¨webå¼€å‘ä¸­çš„å¼‚å¸¸é”™è¯¯å¤„ç†"></a>åœ¨webå¼€å‘ä¸­çš„å¼‚å¸¸é”™è¯¯å¤„ç†</h1><p>SpringBooté»˜è®¤æœ‰ä¸€å¥—å¯¹webå¼€å‘é”™è¯¯å¤„ç†çš„æœºåˆ¶ï¼Œåœ¨<code>autoConfiguration</code>åŒ…ä¸‹é¢æ‰¾åˆ°äº†<code>ErrorMvcAutoConfiguration</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// åªæœ‰åŸºäºservletçš„webç¨‹åº</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span>(type = Type.SERVLET)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123; Servlet.class, DispatcherServlet.class &#125;)</span><br><span class="line"><span class="comment">// éœ€è¦å…ˆåŠ è½½WebMvcAutoConfiguration</span></span><br><span class="line"><span class="meta">@AutoConfigureBefore</span>(WebMvcAutoConfiguration.class)</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(&#123; ServerProperties.class, ResourceProperties.class, WebMvcProperties.class &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorMvcAutoConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure><h2 id="å¤„ç†æœºåˆ¶"><a href="#å¤„ç†æœºåˆ¶" class="headerlink" title="å¤„ç†æœºåˆ¶"></a>å¤„ç†æœºåˆ¶</h2><p>åœ¨è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­ï¼Œç”±ä¸‰ä¸ªæœ€åŸºæœ¬çš„<code>bean</code>ç»„ä»¶ç»„æˆï¼Œä¸‹é¢æŒ¨ä¸ªçœ‹è¿™äº›æ³¨å…¥åˆ°å®¹å™¨ä¸­çš„<code>bean</code>çš„å«ä¹‰</p><h3 id="errorPageCustomizer-å®šä¹‰é”™è¯¯é¡µé¢"><a href="#errorPageCustomizer-å®šä¹‰é”™è¯¯é¡µé¢" class="headerlink" title="errorPageCustomizer å®šä¹‰é”™è¯¯é¡µé¢"></a><code>errorPageCustomizer</code> å®šä¹‰é”™è¯¯é¡µé¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ErrorPageCustomizer <span class="title">errorPageCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> ErrorPageCustomizer(<span class="keyword">this</span>.serverProperties, <span class="keyword">this</span>.dispatcherServletPath);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ErrorPageCustomizeræœ‰ä¸€ä¸ªregisterErrorPages æ³¨å†Œé¡µé¢çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerErrorPages</span><span class="params">(ErrorPageRegistry errorPageRegistry)</span> </span>&#123;</span><br><span class="line">ErrorPage errorPage = <span class="keyword">new</span> ErrorPage(</span><br><span class="line">        <span class="comment">// ç”¨äºè·å–erroré¡µé¢çš„åœ°å€</span></span><br><span class="line"><span class="keyword">this</span>.dispatcherServletPath.getRelativePath(<span class="keyword">this</span>.properties.getError().getPath()));</span><br><span class="line">errorPageRegistry.addErrorPages(errorPage);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ°å€åœ¨ this.properties.getError().getPath()å˜é‡ä¸­å…·ä½“çš„å€¼ï¼š</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;error.path:/error&#125;"</span>)</span><br><span class="line"><span class="comment">// é…ç½®æ–‡ä»¶ä¸­error.pathä¸‹çš„/erroræˆ–è€…æ ¹ç›®å½•ä¸‹çš„/erroræ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="keyword">private</span> String path = <span class="string">"/error"</span>;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥<code>errorPageCustomizer</code>çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯æ‰¾åˆ°åœ°å€ï¼Œæ‹¼è£…æˆ<code>ErrorPage</code>;</p><h3 id="WhitelabelErrorViewConfiguration-ç©ºç™½é¡µçš„é…ç½®"><a href="#WhitelabelErrorViewConfiguration-ç©ºç™½é¡µçš„é…ç½®" class="headerlink" title="WhitelabelErrorViewConfiguration ç©ºç™½é¡µçš„é…ç½®"></a><code>WhitelabelErrorViewConfiguration</code> ç©ºç™½é¡µçš„é…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WhitelabelErrorViewConfiguration</span> </span>&#123;</span><br><span class="line">   <span class="comment">// åœ¨StaticViewä¸­å®šä¹‰äº†é»˜è®¤çš„Whitelabelé¡µé¢æ ¼å¼ï¼Œ</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> StaticView defaultErrorView = <span class="keyword">new</span> StaticView();</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"error"</span>)</span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(name = <span class="string">"error"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">defaultErrorView</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.defaultErrorView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="basicErrorController-æ§åˆ¶å™¨"><a href="#basicErrorController-æ§åˆ¶å™¨" class="headerlink" title="basicErrorController æ§åˆ¶å™¨"></a><code>basicErrorController</code> æ§åˆ¶å™¨</h3><p>basicErrorControllerå°±æ˜¯ç®€å•çš„æ§åˆ¶å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span> <span class="comment">//controllerå®ç° æ³¨å†Œåˆ°å®¹å™¨ä¸­</span></span><br><span class="line"><span class="comment">// é”™è¯¯æ˜ å°„åœ°å€ error.path æˆ–</span></span><br><span class="line"><span class="comment">// server.error.path ä¸‹ /error</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicErrorController</span> <span class="keyword">extends</span> <span class="title">AbstractErrorController</span></span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ª<code>Controller</code>ä¸­æ˜ å°„åˆ°äº†<code>/error</code>åœ°å€ä¸Šï¼Œæœ‰å…·æœ‰ä¸¤ä¸ª<code>RequestMapping</code>è¿›è¡Œæ˜ å°„ã€‚</p><h4 id="è¯·æ±‚çš„åª’ä½“ç±»å‹ä¸ºtext-htmlæ—¶"><a href="#è¯·æ±‚çš„åª’ä½“ç±»å‹ä¸ºtext-htmlæ—¶" class="headerlink" title="è¯·æ±‚çš„åª’ä½“ç±»å‹ä¸ºtext/htmlæ—¶"></a>è¯·æ±‚çš„åª’ä½“ç±»å‹ä¸º<code>text/html</code>æ—¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(produces = MediaType.TEXT_HTML_VALUE)</span><br><span class="line"><span class="comment">// åª’ä½“ç±»å‹ä¸º text/html æ—¶å€™ä½¿ç”¨è¿™ä¸ªå¯¹/errorçš„æ¥æ”¶</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è·å¾—requestä¸­çš„çŠ¶æ€ç </span></span><br><span class="line">  <span class="comment">// Integer statusCode = </span></span><br><span class="line">  <span class="comment">// (Integer) request.getAttribute("javax.servlet.error.status_code");</span></span><br><span class="line">  HttpStatus status = getStatus(request);</span><br><span class="line">  Map&lt;String, Object&gt; model = Collections</span><br><span class="line">    .unmodifiableMap(getErrorAttributes(request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">  response.setStatus(status.value());</span><br><span class="line">  ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">  <span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>, model);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä½¿ç”¨å¤«ç±»ä¸­çš„<code>getErrorAttributes</code>æ–¹æ³•æ¥è·å–åŸºæœ¬å±æ€§æ•°æ®ï¼Œé€šè¿‡<code>return this.errorAttributes.getErrorAttributes(webRequest, includeStackTrace)</code>ç›´æ¥è°ƒç”¨å·²ç»æ³¨å…¥åˆ°å®¹å™¨ä¸­çš„<code>ErrorAttributes</code>ç±»åŠå…¶å­ç±»ã€‚å¦‚é»˜è®¤çš„<code>DefaultErrorAttributes</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">  Map&lt;String, Object&gt; errorAttributes = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">  <span class="comment">// è¿”å›åˆ°é¡µé¢çš„å½“å‰ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">  errorAttributes.put(<span class="string">"timestamp"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">  <span class="comment">// ä¸‹é¢çš„ javax.xxxx éƒ½æ˜¯ä»requesetä¸­å¾—åˆ°çš„</span></span><br><span class="line">  <span class="comment">// è¿”å›çŠ¶æ€ç  javax.servlet.error.status_code</span></span><br><span class="line">  addStatus(errorAttributes, webRequest);</span><br><span class="line">  <span class="comment">//é”™è¯¯ä¿¡æ¯ avax.servlet.error.message</span></span><br><span class="line">  addErrorDetails(errorAttributes, webRequest, includeStackTrace);</span><br><span class="line">  <span class="comment">// è¯·æ±‚è·¯å¾„ javax.servlet.error.request_uri</span></span><br><span class="line">  addPath(errorAttributes, webRequest);</span><br><span class="line">  <span class="keyword">return</span> errorAttributes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è·å–å®Œéœ€è¦è¿”å›çš„æ•°æ®ä¹‹åï¼Œè¿”å›ä¸€ä¸ª<code>modelAndView</code>å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¸¦æœ‰æ˜¾ç¤ºçš„ç•Œé¢ã€‚</p><p>é»˜è®¤ä½¿ç”¨<code>DefaultErrorViewResolver</code>æ¥è¿›è¡Œå¯¹<code>ErrorView</code>çš„è§£æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–modelandviewå¯¹è±¡</span></span><br><span class="line">  ModelAndView modelAndView = resolve(String.valueOf(status.value()), model);</span><br><span class="line">  <span class="keyword">if</span> (modelAndView == <span class="keyword">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰modelandview</span></span><br><span class="line">    modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰é€šè¿‡resolveæ–¹æ³•æ‰¾åˆ°ä¸€ä¸ªmodelAndViewã€‚åˆ™ä¼šæœ‰ç±»ä¼¼é€šè¿‡ <code>5xx.html</code> é¡µé¢æ¥å±•ç¤º5å¼€å¤´çš„é‚£äº›é”™è¯¯çš„é¡µé¢ã€‚å¯é€‰å€¼æœ‰ä¸‹é¢ä¸¤ç§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">views.put(Series.CLIENT_ERROR, <span class="string">"4xx"</span>);</span><br><span class="line">views.put(Series.SERVER_ERROR, <span class="string">"5xx"</span>);</span><br><span class="line">SERIES_VIEWS = Collections.unmodifiableMap(views);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨resolveæ–¹æ³•æ¥è·å–ModelAndView</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//è¿™é‡Œçš„viewNameä¸ºçŠ¶æ€ç¼–ç ï¼Œè§†å›¾ä¸º error/ã€ŒçŠ¶æ€ç å€¼ã€</span></span><br><span class="line">  </span><br><span class="line">  String errorViewName = <span class="string">"error/"</span> + viewName;</span><br><span class="line">  TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders.getProvider(errorViewName,</span><br><span class="line">                                                                                         <span class="keyword">this</span>.applicationContext);</span><br><span class="line">  <span class="keyword">if</span> (provider != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚403é”™è¯¯ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å› error/403.html  å‰ææ˜¯æœ‰æ¨¡ç‰ˆå¼•æ“</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(errorViewName, model);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ²¡æœ‰å°±å»  &#123; "classpath:/META-INF/resources/",</span></span><br><span class="line"><span class="comment">//"classpath:/resources/", "classpath:/static/", "classpath:/public/" &#125;;</span></span><br><span class="line">  <span class="comment">// è¿™å‡ ä¸ªè·¯å¾„ä¸Šæ‰¾ è·¯å¾„ä¸‹çš„error/xxx.htmlï¼Œè¿™äº›è·¯å¾„å°±æ˜¯é»˜è®¤çš„èµ„æºæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  <span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåˆ°ä¸Šä¸€æ­¥ä»ä¸å­˜åœ¨viewåˆ™è¯´æ˜ï¼Œæ¨¡ç‰ˆå¼•æ“/åŸºæœ¬èµ„æºæ–‡ä»¶å¤¹ä¸‹å‡ä¸å­˜åœ¨erroræ–‡ä»¶å¤¹ä¸‹çš„xxx.htmlæ–‡ä»¶ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªé»˜è®¤çš„view ã€‚<code>(modelAndView != null) ? modelAndView : new ModelAndView(&quot;error&quot;, model);</code>ï¼Œ<strong>å°±æ˜¯åœ¨æ ‡é¢˜ã€WhitelabelErrorViewConfigurationã€‘ä¸­æåŠåˆ°çš„StaticView</strong>ã€‚</p><h4 id="è¯·æ±‚ä¸ºå…¶ä»–åª’ä½“ç±»å‹"><a href="#è¯·æ±‚ä¸ºå…¶ä»–åª’ä½“ç±»å‹" class="headerlink" title="è¯·æ±‚ä¸ºå…¶ä»–åª’ä½“ç±»å‹"></a>è¯·æ±‚ä¸ºå…¶ä»–åª’ä½“ç±»å‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">  Map&lt;String, Object&gt; body = getErrorAttributes(request, isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line">  HttpStatus status = getStatus(request);</span><br><span class="line">  <span class="comment">// ç›´æ¥è¿”å›map</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body, status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="errorAttributes-é”™è¯¯é¡µé¢å±æ€§ä¿¡æ¯"><a href="#errorAttributes-é”™è¯¯é¡µé¢å±æ€§ä¿¡æ¯" class="headerlink" title="errorAttributes é”™è¯¯é¡µé¢å±æ€§ä¿¡æ¯"></a><code>errorAttributes</code> é”™è¯¯é¡µé¢å±æ€§ä¿¡æ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(value = ErrorAttributes.class, search = SearchStrategy.CURRENT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultErrorAttributes <span class="title">errorAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorAttributes(<span class="keyword">this</span>.serverProperties.getError().isIncludeException());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªbeanä¸»è¦æ˜¯ä½¿ç”¨<code>getErrorAttributes</code>æä¾›<code>ErrorController</code>è¿”å›å€¼çš„ä¿¡æ¯ï¼Œå¦‚æœçŠ¶æ€ç ç­‰ã€‚ã€‚å¦‚æœæƒ³æ›´æ”¹é”™è¯¯ä¿¡æ¯çš„è¿”å›å€¼å†…å®¹ï¼Œå¯ä»¥ç»§æ‰¿<code>DefaultErrorAttributes</code>,ç„¶ååœ¨<code>getErrorAttributes</code>æ–¹æ³•é‡Œæ·»åŠ æƒ³è¦æ·»åŠ çš„å†…å®¹å³å¯ã€‚</p><h2 id="æ·»åŠ é”™è¯¯é¡µé¢å’Œä¿®æ”¹è¿”å›ä¿¡æ¯"><a href="#æ·»åŠ é”™è¯¯é¡µé¢å’Œä¿®æ”¹è¿”å›ä¿¡æ¯" class="headerlink" title="æ·»åŠ é”™è¯¯é¡µé¢å’Œä¿®æ”¹è¿”å›ä¿¡æ¯"></a>æ·»åŠ é”™è¯¯é¡µé¢å’Œä¿®æ”¹è¿”å›ä¿¡æ¯</h2><p>ä¸‹é¢å…·ä½“æ¥æ ¹æ®SpringBootç‰¹æ€§æ¥æ·»åŠ é”™è¯¯é¡µé¢ï¼Œå¦‚404ï¼Œ500ç­‰ã€‚</p><p>â€‹    å› ä¸ºåœ¨å¤„ç†æœºåˆ¶è¿™ç« é‡Œè¯´æ˜äº†SpringBootå¦‚ä½•å¤„ç†é”™è¯¯ï¼Œä»–ä¼šé»˜è®¤çš„è®¿é—®/error/åœ°å€ï¼Œå¹¶ä¸”å¦‚æœæ˜¯text/htmlçš„åª’ä½“ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ç½‘é¡µè®¿é—®çš„è¯ï¼Œå¦‚æœæœ‰æ¨¡ç‰ˆå¼•æ“ï¼Œä»–ä¼šå»æ‰¾åœ¨<code>/error</code>æ–‡ä»¶ä¸­å¯¹åº”ç¼–ç çš„<code>xxx.html</code>é¡µé¢è¿›è€Œå»æ¸²æŸ“è¿™ä¸ªé¡µé¢ã€‚</p><p>â€‹    æ¯”å¦‚è®¿é—®404ï¼Œä»–ä¼šå»æ‰¾<code>classpath:/error/404.html</code>é¡µé¢å»æ¸²æŸ“ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä»–ä¼šå»æ‰¾<code>classpath:/error/4xx.html</code>ï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼Œä»–ä¼šè¿”å›ä¸€ä¸ªé¡µé¢ã€‚</p><h3 id="æ·»åŠ erroré¡µé¢"><a href="#æ·»åŠ erroré¡µé¢" class="headerlink" title="æ·»åŠ erroré¡µé¢"></a>æ·»åŠ erroré¡µé¢</h3><p>â€‹    ä¸ºäº†æ¼”ç¤ºï¼Œåˆ›å»º<code>404.html</code>å’Œ<code>4xx.html</code>ï¼Œ<strong>æ¥è¾¾åˆ°è¿™æ ·çš„ç›®çš„:å¦‚æœå‘ç”Ÿ404é”™è¯¯ï¼Œåˆ™è®¿é—®404.htmlé¡µé¢ï¼Œå¦‚æœå‘ç”Ÿ402æˆ–è€…ä»¥4å¼€å¤´çš„é”™è¯¯ï¼Œåˆ™è®¿é—®4xx.htmlé¡µé¢</strong>ã€‚</p><p>ç›®å½•ç»“æ„å’Œç¤ºä¾‹å†…å®¹å‚è€ƒå¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190718192323.png" alt></p><h3 id="å®šä¹‰å¼‚å¸¸å’Œå¯¹åº”çš„å¼‚å¸¸å¤„ç†"><a href="#å®šä¹‰å¼‚å¸¸å’Œå¯¹åº”çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="å®šä¹‰å¼‚å¸¸å’Œå¯¹åº”çš„å¼‚å¸¸å¤„ç†"></a>å®šä¹‰å¼‚å¸¸å’Œå¯¹åº”çš„å¼‚å¸¸å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoAuthException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NoAuthException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"æ— æƒé™å¼‚å¸¸"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoUserExcetion</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NoUserExcetion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"æ— ç”¨æˆ·å¼‚å¸¸"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚å¸¸å¤„ç†ç±»</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExecptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†NoAuthException å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = NoAuthException.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handlerNoAuthException</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">      <span class="comment">// è¿™æ˜¯å¿…é¡»çš„ï¼›å®šä¹‰è¿”å›çš„codeå€¼ï¼Œè¿”å›æŒ‡å®šçš„é”™è¯¯é¡µé¢</span></span><br><span class="line">        request.setAttribute(<span class="string">"javax.servlet.error.status_code"</span>,<span class="number">402</span>);</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"code"</span>,<span class="number">402</span>);</span><br><span class="line">        map.put(<span class="string">"message"</span>,<span class="string">"this is my no auth message"</span>);</span><br><span class="line">      <span class="comment">// å°†è‡ªå®šä¹‰ä¿¡æ¯æ”¾å…¥ requestä¸­</span></span><br><span class="line">        request.setAttribute(<span class="string">"errData"</span>,map);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"forward:/error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//å¤„ç†NoUserExcetion å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = NoUserExcetion.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handlerNoUserException</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">        request.setAttribute(<span class="string">"javax.servlet.error.status_code"</span>,<span class="number">400</span>);</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"code"</span>,<span class="number">404</span>);</span><br><span class="line">        map.put(<span class="string">"message"</span>,<span class="string">"this is my no auth message"</span>);</span><br><span class="line">        request.setAttribute(<span class="string">"errData"</span>,map);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"forward:/error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// controllerç±»</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="string">"abc"</span>.equals(name))&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ /hello?name=abcçš„æ—¶å€™æŠ›å‡ºNoAuthExceptionå¼‚å¸¸ è·³è½¬åˆ°4xxé¡µé¢</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NoAuthException();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="string">"123"</span>.equals(name))&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ /hello?name=123çš„æ—¶å€™æŠ›å‡ºNoUserExcetionçš„å¼‚å¸¸ è·³è½¬åˆ°404é¡µé¢</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NoUserExcetion();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"hello world"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰è‡ªå®šä¹‰å±æ€§ç±»"><a href="#å®šä¹‰è‡ªå®šä¹‰å±æ€§ç±»" class="headerlink" title="å®šä¹‰è‡ªå®šä¹‰å±æ€§ç±»"></a>å®šä¹‰è‡ªå®šä¹‰å±æ€§ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// æ”¾åˆ°å®¹å™¨ä¸­ï¼Œé»˜è®¤ä¼šæ›¿æ¢åˆ°springbootçš„é»˜è®¤çš„DefaultErrorAttributes</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title">DefaultErrorAttributes</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// è·å–DefaultErrorAttributesçš„åŸºæœ¬å±æ€§</span></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">super</span>.getErrorAttributes(webRequest,includeStackTrace);</span><br><span class="line">        Map&lt;String,Object&gt; errData = (Map&lt;String, Object&gt;) webRequest.getAttribute(<span class="string">"errData"</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="comment">// ä»requestä¸­è·å–è‡ªå®šä¹‰çš„dataï¼Œæ·»åŠ åˆ°è¿”å›çš„ä¿¡æ¯ä¸­ã€‚</span></span><br><span class="line"> map.put(<span class="string">"errData"</span>,errData);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šçš„è®¾ç½®ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><ul><li>å¦‚æœæ˜¯ /hello?name=abcçš„æ—¶å€™æŠ›å‡ºNoAuthExceptionå¼‚å¸¸ è·³è½¬åˆ°4xxé¡µé¢</li><li>å¦‚æœæ˜¯ /hello?name=123çš„æ—¶å€™æŠ›å‡ºNoUserExcetionçš„å¼‚å¸¸ è·³è½¬åˆ°404é¡µé¢</li><li>å¦‚æœæ²¡æœ‰è®¿é—®åœ°å€ä¹Ÿä¼šåˆ°404é¡µé¢</li></ul><h3 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h3><ul><li>è®¿é—®/hello?name=abc è·³è½¬åˆ°4xxé¡µé¢</li></ul><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190718194227.png" alt="4xx"></p><ul><li>è®¿é—®/hello?name=123 è·³è½¬åˆ°404é¡µé¢</li></ul><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190718194426.png" alt="400"></p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>åœ¨è€ƒè™‘å¯¹webé”™è¯¯é¡µé¢å¤„ç†çš„è§’åº¦ï¼Œæ— éå°±æ˜¯ä¸¤ä¸ªæ–¹é¢ï¼š</p><h3 id="ä¸€ã€-é¡µé¢æ ·å¼"><a href="#ä¸€ã€-é¡µé¢æ ·å¼" class="headerlink" title="ä¸€ã€ é¡µé¢æ ·å¼"></a>ä¸€ã€ é¡µé¢æ ·å¼</h3><p>â€‹    åœ¨æœ‰æ¨¡ç‰ˆå¼•æ“çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡<code>DefaultErrorController</code>åœ¨<code>/error</code>ä¸Šçš„è®¿é—®å¤„ç†ï¼Œæ¥è‡ªåŠ¨æ¸²æŸ“åœ¨<code>template/error/</code>ç›®å½•ä¸‹çš„å¯¹åº”çš„<code>é”™è¯¯code.html</code>çš„çš„å±•ç¤º,å¦‚404.htmlã€‚å¹¶ä¸”æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œå¦‚åˆ›å»º4xx.htmlé¡µé¢ï¼Œé‚£ä¹ˆå¦‚æœæ²¡æœ‰å‘ç°ç‰¹å®šçš„é”™è¯¯ä»£ç é¡µé¢ï¼Œåˆ™è‡ªåŠ¨çš„ä½¿ç”¨4xxé¡µé¢ã€‚</p><h3 id="äºŒã€-é¡µé¢å†…å®¹"><a href="#äºŒã€-é¡µé¢å†…å®¹" class="headerlink" title="äºŒã€ é¡µé¢å†…å®¹"></a>äºŒã€ é¡µé¢å†…å®¹</h3><p>é¡µé¢å†…å®¹å¯ä»¥é€šè¿‡ç»§æ‰¿<code>DefaultErrorAttributes</code>ç±»æ¥è¿›è¡Œç®€å•çš„å®ç°ï¼Œå¦‚æœæƒ³å…¨éƒ¨æ›¿æ¢æ‰SpringBootçš„é»˜è®¤å…¨éƒ¨çš„è¿”å›å†…å®¹ï¼Œåˆ™éœ€è¦å®ç°<code>ErrorAttributes</code>è¿›è¡Œå®ç°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»æ”¾åˆ°å®¹å™¨ä¸­æ‰èƒ½ç”Ÿæ•ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootçš„WEBå¼€å‘ä¹‹å›½é™…åŒ–</title>
      <link href="/2019/07/15/SpringBoot%E7%9A%84WEB%E5%BC%80%E5%8F%91%E4%B9%8B%E5%9B%BD%E9%99%85%E5%8C%96/"/>
      <url>/2019/07/15/SpringBoot%E7%9A%84WEB%E5%BC%80%E5%8F%91%E4%B9%8B%E5%9B%BD%E9%99%85%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><p>SpringBooté»˜è®¤æ˜¯æ”¯æŒ<code>Thymeleaf</code>æ¨¡ç‰ˆå¼•æ“çš„ã€‚ç›¸åº”çš„å¦‚æœä½¿ç”¨<code>Thymeleaf</code>å°±å¯ä»¥ä½¿ç”¨thymeleafçš„è¯­æ³•åœ¨é¡µé¢æ˜¾ç¤ºè¿”å›ç»™é¡µé¢çš„æ•°æ®ã€‚</p><h2 id="ä½¿ç”¨thymeleaf"><a href="#ä½¿ç”¨thymeleaf" class="headerlink" title="ä½¿ç”¨thymeleaf"></a>ä½¿ç”¨thymeleaf</h2><h3 id="å¯¼å…¥starter"><a href="#å¯¼å…¥starter" class="headerlink" title="å¯¼å…¥starter"></a>å¯¼å…¥starter</h3><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190715214204.png" alt="autoConfig"></p><p>å¦‚å›¾ï¼ŒSpringBootè‡ªåŠ¨é…ç½®æ˜¯å¯¼å…¥æœ‰Thymeleafç›¸å…³è‡ªåŠ¨é…ç½®æ–‡ä»¶çš„ï¼Œä½†æ˜¯ï¼Œçº¢è‰²éƒ¨åˆ†æ˜¯ç¼ºå°‘çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´å°‘åŒ…ã€‚è‡ªç„¶SpringBootä¼šæä¾›è¿™äº›ç›¸å…³çš„åŒ…çš„starters.</p><p>é‚£ä¹ˆåœ¨å®˜ç½‘ä¸Šçš„startersä¸­å¯ä»¥æ‰¾åˆ°<code>spring-boot-starter-thymeleaf</code>ï¼Œè¯´æ˜SpringBootæä¾›Thymeleafçš„starteréœ€è¦å¯¼å…¥ï¼Œæ‰èƒ½ä½¿ç”¨<code>Thymeleaf</code>ã€‚</p><h3 id="åœ¨SpringBootä¸­Thymeleafçš„è‡ªåŠ¨é…ç½®"><a href="#åœ¨SpringBootä¸­Thymeleafçš„è‡ªåŠ¨é…ç½®" class="headerlink" title="åœ¨SpringBootä¸­Thymeleafçš„è‡ªåŠ¨é…ç½®"></a>åœ¨SpringBootä¸­Thymeleafçš„è‡ªåŠ¨é…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.thymeleaf"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  charset</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING = StandardCharsets.UTF_8;</span><br><span class="line"><span class="comment">// é»˜è®¤åŠ è½½æ¨¡ç‰ˆçš„è·¯å¾„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line"><span class="comment">// é»˜è®¤åŠ è½½çš„æ–‡ä»¶ç±»å‹ æ˜¯html</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">".html"</span>;</span><br><span class="line"><span class="comment">// å¯è‡ªå·±ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ å‰ç¼€å’Œåç¼€ï¼Œå¦‚æœ spring.thymeleaf.suffix=.htmlx</span></span><br><span class="line"><span class="keyword">private</span> String prefix = DEFAULT_PREFIX;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String suffix = DEFAULT_SUFFIX;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨Thymeleafè¿›è¡Œé¡µé¢æ¸²æŸ“"><a href="#ä½¿ç”¨Thymeleafè¿›è¡Œé¡µé¢æ¸²æŸ“" class="headerlink" title="ä½¿ç”¨Thymeleafè¿›è¡Œé¡µé¢æ¸²æŸ“"></a>ä½¿ç”¨Thymeleafè¿›è¡Œé¡µé¢æ¸²æŸ“</h3><p>æ‰€ä»¥åœ¨SpringBootä¸­åœ¨Controllerä¸­ä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/home"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">(Map&lt;String,String&gt; map)</span></span>&#123;</span><br><span class="line">        map.put(<span class="string">"hello"</span>,<span class="string">"Hello World~~~"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ˜ å°„å™¨å°±ä¼šè‡ªåŠ¨æ˜ å°„åˆ°<code>classpath:/templates/home.html</code>æ–‡ä»¶ä¸Šã€‚</p><p>åœ¨templatesä¸‹å»ºç«‹home.htmlæ–‡ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--å¼•å…¥ xmlns:th ç”¨äºthymeleafè¯­æ³•æç¤º--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">"$&#123;hello&#125;"</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é‡å¯åæŸ¥çœ‹<code>http://localhost:8080/home</code>å‘ç°å·²ç»å¯ä»¥è®© <code>/home</code> æ˜ å°„åˆ° <code>home.html</code> æ–‡ä»¶ä¸Šäº†ã€‚å¹¶ä¸”æ ¹æ®æˆ‘ä»¬ä¼ è¿‡æ¥çš„å€¼ <code>Hello World~~~</code> æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šäº†ã€‚</p><p>Thymeleafè¯­æ³•å¯ç›´æ¥å‚è€ƒå®˜æ–¹çš„<a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html" target="_blank" rel="noopener">æ–‡æ¡£</a>;</p><h2 id="ä½¿ç”¨SpringMVC"><a href="#ä½¿ç”¨SpringMVC" class="headerlink" title="ä½¿ç”¨SpringMVC"></a>ä½¿ç”¨SpringMVC</h2><p> SpringMvcæ¡†æ¶æ˜¯ä¸€ç§ä¸°å¯Œ<code>model view controller</code> çš„webæ¡†æ¶ã€‚SpringMVCé€šè¿‡ä½¿ç”¨ <code>@Controller</code> å’Œ <code>@RestController</code> å®Œæˆå¯¹ <code>HTTP</code> è¯·æ±‚çš„å¤„ç†ã€‚é€šè¿‡ä½¿ç”¨ <code>@RequestMapping</code> å®Œæˆå¯¹è¯·æ±‚å¯¹controllerçš„æ˜ å°„ã€‚</p><h3 id="è‡ªåŠ¨é…ç½®"><a href="#è‡ªåŠ¨é…ç½®" class="headerlink" title="è‡ªåŠ¨é…ç½®"></a>è‡ªåŠ¨é…ç½®</h3><p> <code>SpringBoot</code> å¯¹ <code>SpringMVC</code> åœ¨è‡ªåŠ¨é…ç½®çš„æ—¶å€™ï¼Œè¿›è¡Œäº†å¾ˆå¤šé»˜è®¤çš„è®¾ç½®ã€‚åŒ…æ‹¬å‰ä¸€ç¯‡æ–‡ç« ä¸­çš„å…³äºé™æ€èµ„æºåŠ è½½çš„ä¸¤ç§æ–¹å¼ï¼ˆ <code>Webjars</code> å’Œæœ¬åœ°åŠ è½½ä½ç½®ï¼‰ï¼Œä¹Ÿæ˜¯é€šè¿‡ <code>SpringBoot</code> è¿›è¡Œè‡ªåŠ¨é…ç½®çš„ã€‚æ›´å¤šçš„ <code>SpringBoot</code> å¯¹ <code>SpringMVC</code> åœ¨å“ªäº›åœ°æ–¹è¿›è¡Œäº†è‡ªåŠ¨é…ç½®ï¼Œå¯ä»¥å‚è€ƒæ–‡æ¡£ä¸­çš„<a href="RELEASE/reference/html/boot-features-developing-web-applications.html#boot-features-spring-mvc">SpringMVC ç‰¹æ€§</a>ã€‚</p><h3 id="è‡ªåŠ¨é…ç½®ä»£ç å‚è€ƒ"><a href="#è‡ªåŠ¨é…ç½®ä»£ç å‚è€ƒ" class="headerlink" title="è‡ªåŠ¨é…ç½®ä»£ç å‚è€ƒ"></a>è‡ªåŠ¨é…ç½®ä»£ç å‚è€ƒ</h3><p>æ‹¿ <code>ContentNegotiatingViewResolver</code>è¿™ä¸ªbeanæ¥è¯´ï¼ŒSpringMVCçš„è‡ªåŠ¨é…ç½®ç±»æ˜¯å¦‚ä½•å¯¹æ‹“å±•çš„æ”¯æŒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean</span>(ViewResolver.class)</span><br><span class="line"><span class="comment">// å¦‚æœç±»è·¯å¾„ä¸­ä¸å­˜åœ¨ContentNegotiatingViewResolverè¿™ä¸ªç±»çš„æ—¶å€™</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(name = <span class="string">"viewResolver"</span>, value = ContentNegotiatingViewResolver.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ContentNegotiatingViewResolver <span class="title">viewResolver</span><span class="params">(BeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line"><span class="comment">//  è¿”å›è¿™ä¸ªResolver</span></span><br><span class="line">    ContentNegotiatingViewResolver resolver = <span class="keyword">new</span> ContentNegotiatingViewResolver();</span><br><span class="line">    resolver.setContentNegotiationManager(beanFactory.getBean(ContentNegotiationManager.class));</span><br><span class="line">    <span class="comment">// ContentNegotiatingViewResolver uses all the other view resolvers to locate</span></span><br><span class="line">    <span class="comment">// a view so it should have a high precedence</span></span><br><span class="line">    resolver.setOrder(Ordered.HIGHEST_PRECEDENCE);</span><br><span class="line">    <span class="keyword">return</span> resolver;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ContentNegotiatingViewResolver ç±»ä¸­çš„åˆå§‹åŒ–servletå®¹å™¨æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initServletContext</span><span class="params">(ServletContext servletContext)</span> </span>&#123;</span><br><span class="line"><span class="comment">// æ‰¾å‡ºæ‰€æœ‰çš„å®¹å™¨ä¸­çš„ViewResolver</span></span><br><span class="line">    Collection&lt;ViewResolver&gt; matchingBeans =</span><br><span class="line">            BeanFactoryUtils.beansOfTypeIncludingAncestors(obtainApplicationContext(), ViewResolver.class).values();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.viewResolvers == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.viewResolvers = <span class="keyword">new</span> ArrayList&lt;&gt;(matchingBeans.size());</span><br><span class="line">        <span class="comment">// å¾ªç¯æ·»åŠ åˆ°viewResolverä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (ViewResolver viewResolver : matchingBeans) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span> != viewResolver) &#123;</span><br><span class="line">                <span class="keyword">this</span>.viewResolvers.add(viewResolver);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="comment">//å®ç°ViewResolverçš„å®ç°æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">resolveViewName</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    RequestAttributes attrs = RequestContextHolder.getRequestAttributes();</span><br><span class="line">    Assert.state(attrs <span class="keyword">instanceof</span> ServletRequestAttributes, <span class="string">"No current ServletRequestAttributes"</span>);</span><br><span class="line">    List&lt;MediaType&gt; requestedMediaTypes = getMediaTypes(((ServletRequestAttributes) attrs).getRequest());</span><br><span class="line">    <span class="keyword">if</span> (requestedMediaTypes != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//  è·å–å€™é€‰çš„view</span></span><br><span class="line">        <span class="comment">// åœ¨getCandidateViewsè¿™ä¸ªæ–¹æ³•é‡Œå°±æ˜¯æŠŠå…¨å±€çš„viewResolverå¾ªç¯ä¸€é</span></span><br><span class="line">        List&lt;View&gt; candidateViews = getCandidateViews(viewName, locale, requestedMediaTypes);</span><br><span class="line">        <span class="comment">// å¯»æ‰¾æœ€å¥½çš„/æœ€åˆé€‚çš„view</span></span><br><span class="line">        View bestView = getBestView(candidateViews, requestedMediaTypes, attrs);</span><br><span class="line">        <span class="keyword">if</span> (bestView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> bestView;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°ä»£ç çš„æè¿°ï¼Œå¯ä»¥å‘ç°å¦‚æœè‡ªå·±å®ç°ViewResolverï¼Œåªéœ€è¦å®ç°ViewResolverååŠ å…¥åˆ°å®¹å™¨ä¸­å³å¯ã€‚SpringBootä¼šè‡ªåŠ¨è·å–å®¹å™¨ä¸­çš„ViewResoverã€‚</p><h3 id="å®šåˆ¶å¼€å‘"><a href="#å®šåˆ¶å¼€å‘" class="headerlink" title="å®šåˆ¶å¼€å‘"></a>å®šåˆ¶å¼€å‘</h3><p>å¦‚æœæƒ³ä¿ç•™ <code>SpringBoot</code> çš„MVCç‰¹æ€§ï¼Œå¹¶ä¸”æƒ³å»æ·»åŠ MVCé…ç½®å¦‚æ‹¦æˆªå™¨ï¼Œè§†å›¾æ§åˆ¶å™¨ç­‰ï¼Œä½ å¯ä»¥æ·»åŠ è‡ªå·±çš„é…ç½®ç±»ï¼Œå¹¶ä¸”ç»§æ‰¿<code>WebMvcConfigurer</code>,ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½ä½¿ç”¨ <code>@EnableWebMvc</code> æ³¨è§£ã€‚å¦‚æœä½¿ç”¨ <code>@EnableWebMvc</code> æ³¨è§£ï¼Œåˆ™è¡¨ç¤ºè¦ä½ å…¨é¢æ¥ç®¡SpringMvcé…ç½®åŠŸèƒ½ï¼Œä¸ä½¿ç”¨SpringBootè‡ªåŠ¨é…ç½®çš„åŠŸèƒ½ã€‚</p><ol><li>ä½¿ç”¨beançš„æ–¹å¼ï¼Œè®© <code>InnerViewResolver</code> è‡ªåŠ¨å‘ç°å®¹å™¨ä¸­çš„ViewResolver</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//@EnableWebMvc // ä½¿ç”¨è¿™ä¸ªæ³¨è§£è¡¨ç¤ºå®Œå…¨ä¸å®ç”¨SpringBootå¯¹SpringMVCçš„è‡ªåŠ¨é…ç½®åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyViewResolver <span class="title">myViewResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyViewResolver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">InnerViewResolver</span> <span class="keyword">implements</span> <span class="title">ViewResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">resolveViewName</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°†ä¸€ä¸ªViewResolveræ”¾åˆ°å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆå‰é¢è¯´åˆ°çš„ <code>InnerViewResolver</code> ä¼šè‡ªåŠ¨çš„å‘ç°è¿™ä¸ªbeanæ¥ä½¿ç”¨ã€‚</p><ol start="2"><li>ä½¿ç”¨ <code>WebMvcConfigurer</code> å®ç°</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        registry.viewResolver(<span class="keyword">new</span> InnerViewResolver());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addRedirectViewController(<span class="string">"/index"</span>,<span class="string">"/home"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ViewResolverRegistry ç±»ä¸­çš„viewResolveræ–¹æ³•ï¼Œç›´æ¥æ·»åŠ åˆ°å…¨å±€å˜é‡ viewResolversä¸­ï¼Œä»£æ›¿å‰é¢çš„éå†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">viewResolver</span><span class="params">(ViewResolver viewResolver)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (viewResolver <span class="keyword">instanceof</span> ContentNegotiatingViewResolver) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BeanInitializationException(</span><br><span class="line">                <span class="string">"addViewResolver cannot be used to configure a ContentNegotiatingViewResolver. "</span> +</span><br><span class="line">                <span class="string">"Please use the method enableContentNegotiation instead."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.viewResolvers.add(viewResolver);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§æ‰¿WebMvcConfigurerä½¿ç”¨ç»§æ‰¿æ–¹æ³•ï¼Œå°†ç±»æ”¾åˆ°å®¹å™¨ä¸­ã€‚</p><h1 id="å›½é™…åŒ–å¼€å‘"><a href="#å›½é™…åŒ–å¼€å‘" class="headerlink" title="å›½é™…åŒ–å¼€å‘"></a>å›½é™…åŒ–å¼€å‘</h1><p>ä¸‹é¢ä»è‡ªåŠ¨é…ç½®å…¥æ‰‹ï¼Œæ¥çœ‹SpringBootæ˜¯æ€ä¹ˆé…ç½®å›½é™…åŒ–çš„ã€‚</p><h2 id="è®©SpringBooté…ç½®æŒ‡å®šå›½é™…åŒ–æ–‡ä»¶"><a href="#è®©SpringBooté…ç½®æŒ‡å®šå›½é™…åŒ–æ–‡ä»¶" class="headerlink" title="è®©SpringBooté…ç½®æŒ‡å®šå›½é™…åŒ–æ–‡ä»¶"></a>è®©SpringBooté…ç½®æŒ‡å®šå›½é™…åŒ–æ–‡ä»¶</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageSourceAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Resource[] NO_RESOURCES = &#123;&#125;;</span><br><span class="line"><span class="comment">// åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è¿›è¡Œé…ç½®çš„å†…å®¹ ä»¥spring.messageå¼€å¤´</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.messages"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageSourceProperties <span class="title">messageSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> MessageSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/***********************MessageSourceProperties**********************/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageSourceProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»¥é€—å·åˆ†éš”çš„åŸºæœ¬åç§°åˆ—è¡¨ æ¯ä¸€ä¸ªéƒ½æ˜¯åœ¨å®Œæ•´çš„è·¯å¾„ä¸‹åŠ è½½ï¼Œæ¯”å¦‚ i18n.home,i18n.helloè¿™æ ·</span></span><br><span class="line"><span class="comment">   * å¦‚æœåœ¨ç±»è·¯å¾„ä¸Šï¼Œå°±å»æ‰i18n.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String basename = <span class="string">"messages"</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœå¯¹<code>basename</code>çš„å€¼çš„è®¾ç½®ä»æœ‰ç–‘æƒ‘ï¼Œé‚£æ¥ç›´æ¥çœ‹è§£æ<code>basename</code>çš„ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ConditionOutcome <span class="title">getMatchOutcome</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å¾—propertiesfä¸­çš„spring.messages.basenameå±æ€§ï¼Œå¦‚æœæ²¡æœ‰é»˜è®¤æ˜¯messages</span></span><br><span class="line">String basename = context.getEnvironment().getProperty(<span class="string">"spring.messages.basename"</span>, <span class="string">"messages"</span>);</span><br><span class="line">ConditionOutcome outcome = cache.get(basename);</span><br><span class="line"><span class="keyword">if</span> (outcome == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">// è°ƒç”¨æ–¹æ³•è§£æbasename</span></span><br><span class="line">outcome = getMatchOutcomeForBasename(context, basename);</span><br><span class="line">cache.put(basename, outcome);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> outcome;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ConditionOutcome <span class="title">getMatchOutcomeForBasename</span><span class="params">(ConditionContext context, String basename)</span> </span>&#123;</span><br><span class="line">ConditionMessage.Builder message = ConditionMessage.forCondition(<span class="string">"ResourceBundle"</span>);</span><br><span class="line"><span class="keyword">for</span> (String name : StringUtils.commaDelimitedListToStringArray(StringUtils.trimAllWhitespace(basename))) &#123;</span><br><span class="line">      <span class="comment">// å°†basenameä»¥é€—å·åˆ†éš”ï¼Œå¾ªç¯è¿™ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="keyword">for</span> (Resource resource : getResources(context.getClassLoader(), name)) &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œçš„getResourceæ–¹æ³• æ˜¯åŠ è½½classpath + name + .propertiesä¸­çš„å†…å®¹</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥å›½é™…åŒ–æ–‡ä»¶åªæ”¯æŒ propertiesæ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶ä¸æ”¯æŒ</span></span><br><span class="line">        <span class="comment">// return new PathMatchingResourcePatternResolver(classLoader)</span></span><br><span class="line"><span class="comment">// .getResources("classpath*:" + target + ".properties");</span></span><br><span class="line"><span class="keyword">if</span> (resource.exists()) &#123;</span><br><span class="line">          <span class="comment">// å¯¹æ¯ä¸€ä¸ªè·å–Resource æ–°å»ºä¸€ä¸ªmatchå®ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> ConditionOutcome.match(message.found(<span class="string">"bundle"</span>).items(resource));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ConditionOutcome.noMatch(message.didNotFind(<span class="string">"bundle with basename "</span> + basename).atAll());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å›½é™…åŒ–æ­¥éª¤"><a href="#å›½é™…åŒ–æ­¥éª¤" class="headerlink" title="å›½é™…åŒ–æ­¥éª¤"></a>å›½é™…åŒ–æ­¥éª¤</h2><p>ä¸Šé¢é€šè¿‡å¯¹SpringBootå¯¹å›½é™…åŒ–çš„é…ç½®çš„åˆ†æï¼ŒçŸ¥é“äº†åœ¨propertiesæ–‡ä»¶ä¸­æ€ä¹ˆæ›´æ”¹å›½é™…åŒ–æ–‡ä»¶çš„é…ç½®ä¿¡æ¯ã€‚ä¸‹é¢æ¥å…·ä½“æ“ä½œï¼Œè¿›è¡Œå›½é™…åŒ–ã€‚</p><h3 id="é»˜è®¤çš„å›½é™…åŒ–"><a href="#é»˜è®¤çš„å›½é™…åŒ–" class="headerlink" title="é»˜è®¤çš„å›½é™…åŒ–"></a>é»˜è®¤çš„å›½é™…åŒ–</h3><h4 id="åˆ›å»ºå›½é™…åŒ–çš„properties"><a href="#åˆ›å»ºå›½é™…åŒ–çš„properties" class="headerlink" title="åˆ›å»ºå›½é™…åŒ–çš„properties"></a>åˆ›å»ºå›½é™…åŒ–çš„properties</h4><p>åœ¨resourcesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹<code>i18n</code> ,åœ¨æ–‡ä»¶å¤¹ä¸‹å³é”®åˆ›å»º<code>Resource Bundle</code> æ–‡ä»¶ã€‚</p><p><img src="https://i.loli.net/2019/07/16/5d2dc701793f461130.png" alt="resource"></p><p>å·¦è¾¹<code>project locale</code>ä¸­æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼Œdefaultå’Œè‡ªå·±æ·»åŠ çš„<code>zh_CN</code>å’Œ<code>en_US</code>åˆ†åˆ«è¡¨ç¤ºä¸­æ–‡å’Œè‹±æ–‡ã€‚ç‚¹å‡»<code>add All</code>åç¡®è®¤ï¼Œåˆ›å»ºæ–‡ä»¶ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://i.loli.net/2019/07/16/5d2dc7ca2479570179.png" alt></p><p>åŒå‡»å…¶ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¯”å¦‚<code>index.properties</code>ï¼Œä½¿ç”¨ideaå¯ä»¥å‘ç°ç¼–è¾‘åŒºçš„å·¦ä¸‹è§’æœ‰ä¸€ä¸ª<code>Resource Bundle</code> tabé¡µï¼Œç‚¹å‡»ä¹‹åï¼Œæ¥åˆ°å¦‚ä¸‹å›¾çš„ç•Œé¢ï¼Œæ–°å»ºä¸€ä¸ªé€‰é¡¹ï¼Œè¾“å…¥å„é…ç½®æ–‡ä»¶ä¸­çš„å€¼ã€‚</p><p><img src="https://i.loli.net/2019/07/16/5d2dc82af114521374.png" alt></p><h4 id="åˆ›å»ºcontrollerå’Œhtmlé¡µé¢"><a href="#åˆ›å»ºcontrollerå’Œhtmlé¡µé¢" class="headerlink" title="åˆ›å»ºcontrollerå’Œhtmlé¡µé¢"></a>åˆ›å»ºcontrollerå’Œhtmlé¡µé¢</h4><ol><li><p>åˆ›å»º<code>controller</code></p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»º<code>html</code>é¡µé¢</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">--</span> ä½¿ç”¨<span class="attr">th:text</span>ä¼šæ›¿æ¢æ ‡ç­¾å†…çš„æ–‡æœ¬å†…å®¹ ä½¿ç”¨#&#123;&#125;æ¥è¡¨ç¤ºå›½é™…åŒ–å†…å®¹<span class="attr">--</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">"#&#123;index&#125;"</span>&gt;</span>è¿™é‡Œæ˜¯ä¸»é¡µ<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p>é‡å¯ç¨‹åºï¼Œå‘ç°indexé¡µé¢ä¸Šæ˜¾ç¤ºçš„æ˜¯<code>ä¸»é¡µ</code>ï¼Œè¿™ä¸ªå†…å®¹ï¼Œæ­£å¥½æ˜¯åœ¨index_zh_CN.propertiesä¸­å®šä¹‰çš„<code>index</code>çš„å€¼ã€‚SpringBootä¼šæ ¹æ®è¯·æ±‚å¤´ä¸­çš„è¯­è¨€æ¥åˆ¤æ–­ä½¿ç”¨å“ªä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</p><h4 id="å¦‚ä½•åˆ‡æ¢é¡µé¢çš„ä¸­è‹±æ–‡ï¼Ÿ"><a href="#å¦‚ä½•åˆ‡æ¢é¡µé¢çš„ä¸­è‹±æ–‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ‡æ¢é¡µé¢çš„ä¸­è‹±æ–‡ï¼Ÿ"></a>å¦‚ä½•åˆ‡æ¢é¡µé¢çš„ä¸­è‹±æ–‡ï¼Ÿ</h4><p>åœ¨<code>dispatcherServlet</code>ä¸­åœ¨æ¸²æŸ“è§†å›¾çš„æ—¶å€™ï¼Œä¼šé€šè¿‡<code>locale</code>çš„å±æ€§æ¥æ”¹å˜æ¸²æŸ“åçš„è¯­è¨€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">(ModelAndView mv, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// å¯ä»¥é€šè¿‡è¯·æ±‚çš„localeæ¥å®šä¹‰è¿”å›çš„locale</span></span><br><span class="line">Locale locale =</span><br><span class="line">(<span class="keyword">this</span>.localeResolver != <span class="keyword">null</span> ? <span class="keyword">this</span>.localeResolver.resolveLocale(request) : request.getLocale());</span><br><span class="line">response.setLocale(locale);</span><br></pre></td></tr></table></figure><p>é€šè¿‡debugå‘ç°<code>this.localeResolver</code>ä¸­æ˜¯æœ‰å€¼çš„ï¼Œè¯´æ˜<code>Spring</code>å®¹å™¨ä¸­æœ‰localeResolver,è¿›è€Œå¯ä»¥å¾—å‡ºç»“è®ºï¼š<strong><code>SpringBoot</code>ä¸­è‡ªåŠ¨é…ç½®æ¥é»˜è®¤çš„<code>localeResover</code>ã€‚</strong></p><p><img src="https://i.loli.net/2019/07/16/5d2dd26ac0a7a43943.png" alt="è®¡ç®—"></p><p>åœ¨<code>WebMvcAutoConfiguration</code>ä¸­çš„ç¡®é…ç½®äº†å…³äºlocaleçš„ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.mvc"</span>, name = <span class="string">"locale"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è®¾ç½®äº† å®¹å™¨ä¸­çš„localeResolver ä¸º AcceptHeaderLocaleResolver</span></span><br><span class="line">  AcceptHeaderLocaleResolver localeResolver = <span class="keyword">new</span> AcceptHeaderLocaleResolver();</span><br><span class="line">  localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">  <span class="keyword">return</span> localeResolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºé…ç½®äº†é»˜è®¤çš„<code>localeResolver</code> ,æ‰€ä»¥åœ¨ä½¿ç”¨<code>this.localeResolver.resolveLocale(request)</code>å¤„ç†è¿™ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œå°±ä¼šä½¿ç”¨<code>AcceptHeaderLocaleResolver</code>ç±»ä¸­çš„æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ­£æ˜¯æ‹¿çš„<code>request</code>ä¸­çš„<code>Accept-Language</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">Locale defaultLocale = getDefaultLocale();</span><br><span class="line"><span class="keyword">if</span> (defaultLocale != <span class="keyword">null</span> &amp;&amp; request.getHeader(<span class="string">"Accept-Language"</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> defaultLocale;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// ä»requestä¸­æ‹¿Accept-Languageè¿™ä¸ªå€¼ã€‚</span></span><br><span class="line">Locale requestLocale = request.getLocale();</span><br><span class="line">List&lt;Locale&gt; supportedLocales = getSupportedLocales();</span><br><span class="line"><span class="keyword">if</span> (supportedLocales.isEmpty() || supportedLocales.contains(requestLocale)) &#123;</span><br><span class="line"><span class="keyword">return</span> requestLocale;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ç–‘æƒ‘å°±è§£å¼€äº†ï¼Œ<strong>é»˜è®¤çš„SpringBootæ„ä»¶webåº”ç”¨ä¼šä½¿ç”¨å½“å‰æµè§ˆå™¨çš„åœ°åŒºè¯­è¨€æ¥è¿›è¡Œå›½é™…åŒ–ã€‚</strong></p><h3 id="æ”¹å˜å›½é™…åŒ–è¯­è¨€æ ‡å‡†çš„åˆ¤æ–­æ–¹å¼"><a href="#æ”¹å˜å›½é™…åŒ–è¯­è¨€æ ‡å‡†çš„åˆ¤æ–­æ–¹å¼" class="headerlink" title="æ”¹å˜å›½é™…åŒ–è¯­è¨€æ ‡å‡†çš„åˆ¤æ–­æ–¹å¼"></a>æ”¹å˜å›½é™…åŒ–è¯­è¨€æ ‡å‡†çš„åˆ¤æ–­æ–¹å¼</h3><p>ä¸Šé¢è¯´äº†é»˜è®¤çš„<code>SpringBoot</code>ä¼šä»<code>request</code>ä¸­è·å–åœ°åŒºè¯­è¨€ä¿¡æ¯ï¼Œæ¥åˆ¤æ–­åŠ è½½å“ªä¸ªé…ç½®ã€‚</p><p>åœ¨è‡ªåŠ¨é…ç½®çš„æ–¹æ³•ä¸Šæ ‡æ³¨ç€è¿™æ ·ä¸€æ®µ<code>@ConditionalOnMissingBean</code>,è¯´æ˜å¦‚æœæœ‰<code>localeResolver</code>è¿™ä¸ªç±»é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚æ‰€ä»¥æ”¹å˜çš„æ–¹æ³•å°±æ˜¯è‡ªå·±å®ç°<code>localeResolver</code>.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocalResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Locale defaultLocale;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        Locale defaultLocale = getDefaultLocale();</span><br><span class="line">        String language = request.getParameter(<span class="string">"language"</span>);</span><br><span class="line">      <span class="comment">// è·å–è¯·æ±‚ä¸­çš„ ?language=ã€Œxxxã€ </span></span><br><span class="line">        String[] s = <span class="keyword">new</span> String[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">if</span>(language != <span class="keyword">null</span> &amp;&amp; !<span class="string">""</span>.equals(language))&#123;</span><br><span class="line">            s = getS(language);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//å¦‚æœæ˜¯ç©ºåˆ™æ‰¾æµè§ˆå™¨ä¸­çš„å±æ€§</span></span><br><span class="line">            String header = getFirstLangInRequest(request);</span><br><span class="line">            <span class="keyword">if</span>(header!=<span class="keyword">null</span> &amp;&amp; !<span class="string">""</span>.equals(header))&#123;</span><br><span class="line">                s = getS(header);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//å¦åˆ™ç»™ä¸ªé»˜è®¤çš„local</span></span><br><span class="line">                s = getS(<span class="string">"zh-CN"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        defaultLocale = <span class="keyword">new</span> Locale(s[<span class="number">0</span>],s[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span> defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getFirstLangInRequest</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request.getHeader(<span class="string">"Accept-Language"</span>).split(<span class="string">","</span>)[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String[] getS(String language) &#123;</span><br><span class="line">        <span class="keyword">return</span> language.split(<span class="string">"-"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">getDefaultLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ·»åŠ åˆ°beanä¸­ æ–¹æ³•åç§°å¿…é¡»æ˜¯localeResolver æˆ–è€…æŒ‡å®šbeançš„åç§°ä¸ºlocaleResolver</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> MyLocalResolver();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨å¾®ä¿®æ”¹ä¸€ä¸‹<code>index.html</code>ä¸­çš„å†…å®¹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">"#&#123;index&#125;"</span>&gt;</span>è¿™é‡Œæ˜¯ä¸»é¡µ<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">--</span> ç‚¹å‡»æŒ‰é’®æ—¶å˜æ¢ä¸­è‹±æ–‡ <span class="attr">--</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/index(language='zh-CN')&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">th:text</span>=<span class="string">"#&#123;but1&#125;"</span> &gt;</span>è¿™æ˜¯åˆ‡æ¢ä¸­æ–‡çš„æŒ‰é’®<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/index(language='en-US')&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">th:text</span>=<span class="string">"#&#123;but2&#125;"</span> &gt;</span>è¿™æ˜¯åˆ‡æ¢è‹±æ–‡çš„æŒ‰é’®<span class="tag">&lt;/<span class="name">button</span>&gt;</span> <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é‡å¯ç¨‹åºï¼Œè¿›è¡Œæµ‹è¯•ï¼š</p><p><img src="https://i.loli.net/2019/07/16/5d2ded6219ee739593.gif" alt="æµ‹è¯•æˆæœ"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><h4 id="å¦‚ä½•åœ¨SpringBootä¸­ä½¿ç”¨å›½é™…åŒ–"><a href="#å¦‚ä½•åœ¨SpringBootä¸­ä½¿ç”¨å›½é™…åŒ–" class="headerlink" title="å¦‚ä½•åœ¨SpringBootä¸­ä½¿ç”¨å›½é™…åŒ–"></a>å¦‚ä½•åœ¨SpringBootä¸­ä½¿ç”¨å›½é™…åŒ–</h4><ol><li>ç¼–å†™å›½é™…åŒ–ç›¸å…³çš„ <code>ResourceBundle</code>æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”çš„è¯­è¨€é…ç½®æ–‡ä»¶å¦‚ï¼š<code>index_en_US.properties</code>,<code>index_zh_CN.properties</code>ï¼Œæ³¨æ„è¿™ä¸ª<strong>æ–‡ä»¶æ ¼å¼æ˜¯å›ºå®šçš„<code>xxx_è¯­è¨€ä»£ç _å¤§å†™çš„å›½å®¶ä»£ç </code>ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯propertiesæ–‡ä»¶</strong>ã€‚</li><li>ç¼–å†™<code>html</code>æ¥æ”¶å›½é™…åŒ–å˜é‡ï¼Œä½¿ç”¨<code>Thymeleaf</code>å¼•æ“å¯ä»¥ä½¿ç”¨è¯­æ³•<code>#{}</code>æ¥ä½¿ç”¨å›½é™…åŒ–å˜é‡ã€‚</li></ol><h4 id="å¦‚ä½•æ”¹é€ "><a href="#å¦‚ä½•æ”¹é€ " class="headerlink" title="å¦‚ä½•æ”¹é€ "></a>å¦‚ä½•æ”¹é€ </h4><p>å› ä¸ºSpringBooté»˜è®¤å®ç°äº†<code>LocaleResolver</code>,å¹¶ä¸”æ ‡æ³¨äº†<code>ConditionalOnMissingBean</code>æ³¨è§£ï¼Œæ‰€ä»¥ï¼Œåªéœ€è¦è‡ªå·±å®ç°<code>LocaleResolver</code>ç±»ï¼Œé‡å†™ç›¸å…³æ–¹æ³•ï¼Œå°±å¯ä»¥è¾¾åˆ°æ”¹é€ çš„ç›®çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>åœ¨æ³¨å†Œ<code>bean</code>çš„æ—¶å€™ï¼Œæ–¹æ³•åå¿…é¡»<code>localeResolver</code>,æˆ–è€…æŒ‡å®š<code>bean</code>çš„åç§°ä¸º<code>localeResolver</code>ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootçš„WEBå¼€å‘ä¹‹Hello-World</title>
      <link href="/2019/07/13/2019-07-13-SpringBoot%E7%9A%84WEB%E5%BC%80%E5%8F%91/"/>
      <url>/2019/07/13/2019-07-13-SpringBoot%E7%9A%84WEB%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ›å»ºåŸºæœ¬çš„webåº”ç”¨"><a href="#åˆ›å»ºåŸºæœ¬çš„webåº”ç”¨" class="headerlink" title="åˆ›å»ºåŸºæœ¬çš„webåº”ç”¨"></a>åˆ›å»ºåŸºæœ¬çš„webåº”ç”¨</h1><p>SpringBootå¯ä»¥å¿«é€Ÿçš„åˆ›å»ºä¸€ä¸ªrestfulçš„webåº”ç”¨ã€‚ä¸‹é¢å¼€å§‹ä»é›¶å¼€å§‹åˆ›å»ºä¸€å¥—åŸºæœ¬çš„webåº”ç”¨ã€‚</p><h2 id="ä½¿ç”¨ideaåˆ›å»ºSpring-initializr"><a href="#ä½¿ç”¨ideaåˆ›å»ºSpring-initializr" class="headerlink" title="ä½¿ç”¨ideaåˆ›å»ºSpring initializr"></a>ä½¿ç”¨ideaåˆ›å»º<code>Spring initializr</code></h2><p>æˆ‘è¿™é‡Œç›´æ¥ä½¿ç”¨ideaä¸­çš„<code>Spring initializr</code> æ¥åˆ›å»ºSpringBootåº”ç”¨ã€‚åŒç†å¯ä»¥ä½¿ç”¨<a href="https://start.spring.io" target="_blank" rel="noopener">start.spring.io</a>ä¸­ã€‚åˆ›å»ºå®Œæˆåç›´æ¥åœ¨IDEä¸­å¯¼å…¥å³å¯ã€‚</p><ol><li>éœ€è¦åœ¨ideaä¸­æ–°å»ºé¡¹ç›®</li></ol><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190713104139.png" alt="æ–°å»ºé¡¹ç›®"></p><ol start="2"><li>å¡«å†™é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ </li></ol><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190713104731.png" alt="åŸºæœ¬ä¿¡æ¯"></p><ol start="3"><li>å‹¾é€‰éœ€è¦çš„ä¾èµ–</li></ol><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190713104941.png" alt="å‹¾é€‰ä¾èµ–"></p><ol start="4"><li>æœ€åç‚¹å‡»finishå®Œæˆåˆ›å»ºã€‚</li></ol><h2 id="æ–‡æ¡£ç»“æ„è¯´æ˜"><a href="#æ–‡æ¡£ç»“æ„è¯´æ˜" class="headerlink" title="æ–‡æ¡£ç»“æ„è¯´æ˜"></a>æ–‡æ¡£ç»“æ„è¯´æ˜</h2><div><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190713105737.png" style="zoom:50%"></div><p>æ–°å»ºSpringBootåº”ç”¨åè‡ªåŠ¨åˆ›å»ºçš„ç›®å½•ç»“æ„å¦‚å¦‚ä¸Šå›¾ï¼Œå…¶ä¸­SpringBootå¯åŠ¨ç±»<code>StartSpringBootApplication</code>æ”¾åœ¨<code>java/com/example/start</code>æ–‡ä»¶å¤¹ä¸­ï¼Œç”¨äºå¯åŠ¨æ•´ä¸ªé¡¹ç›®ã€‚</p><p>å¯¹äºèµ„æºæ–‡ä»¶ï¼ŒSpringBootç»™å‡ºæ¥ä¸€å¥—ç›®å½•æ ‡å‡†ã€‚</p><p>resourceæ–‡ä»¶å¤¹ä¸­çš„application.properteisä¸ºæ•´ä½“çš„SpringBooté…ç½®æ–‡ä»¶ã€‚å…¶ä¸­æœ‰staticå’Œtemplatesç›®å½•ã€‚</p><ul><li>static æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾é™æ€èµ„æºï¼Œå¦‚jsï¼Œcss</li><li>templates æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ¨¡ç‰ˆæ–‡ä»¶ï¼Œå¦‚jsp,html</li></ul><p>é‚£ä¹ˆSpringBootæ˜¯å¦‚ä½•å»ºç«‹è¿™äº›ç›®å½•æ–‡ä»¶æ ‡å‡†çš„å‘¢ï¼Ÿ</p><h3 id="webç›®å½•ç›¸å…³çš„è‡ªåŠ¨é…ç½®"><a href="#webç›®å½•ç›¸å…³çš„è‡ªåŠ¨é…ç½®" class="headerlink" title="webç›®å½•ç›¸å…³çš„è‡ªåŠ¨é…ç½®"></a>webç›®å½•ç›¸å…³çš„è‡ªåŠ¨é…ç½®</h3><p>webç›®å½•ç›¸å…³çš„è‡ªåŠ¨é…ç½®æ˜¯åœ¨<code>WebMvcAutoConfiguration</code>è‡ªåŠ¨é…ç½®ç±»ä¸­è¿›è¡Œé…ç½®ã€‚è€Œå¯¹èµ„æºçš„åŠ è½½ä½¿ç”¨çš„æ˜¯<code>addResourceHandler</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ˜¯å¦å¯ç”¨é»˜è®¤èµ„æºå¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–èµ„æºå¤„ç†ç¨‹åºæ‰€æœåŠ¡èµ„æºçš„ç¼“å­˜å‘¨æœŸ</span></span><br><span class="line">    Duration cachePeriod = <span class="keyword">this</span>.resourceProperties.getCache().getPeriod();</span><br><span class="line">    CacheControl cacheControl = <span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜ å°„å™¨è¿˜æœªæ˜ å°„åˆ°/webjars/** åˆ™è¿›è¡Œå¦‚ä¸‹æ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">"/webjars/**"</span>)) &#123;</span><br><span class="line">    <span class="comment">//  æ·»åŠ å¯¹/webjars/** çš„èµ„æºæ˜ å°„</span></span><br><span class="line">        customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="string">"/webjars/**"</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">"classpath:/META-INF/resources/webjars/"</span>)</span><br><span class="line">                <span class="comment">// åŠ è½½åŒ…ä¸‹çš„ /META-INF/resources/webjars/ ä¸‹çš„å†…å®¹</span></span><br><span class="line">                .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é™æ€è·¯å¾„pattern ä¸º "/**"</span></span><br><span class="line">    String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ˜ å°„å™¨è¿˜æ²¡æœ‰æ˜ å°„ /** è·¯å¾„çš„èµ„æºæ—¶</span></span><br><span class="line">        customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)</span><br><span class="line">        <span class="comment">// åŠ è½½æ‰€æœ‰çš„é»˜è®¤å®šä¹‰çš„ä½ç½®é‡Œçš„èµ„æºã€‚</span></span><br><span class="line">                .addResourceLocations(getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations()))</span><br><span class="line">                .setCachePeriod(getSeconds(cache</span><br><span class="line">                Period)).setCacheControl(cacheControl));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="webjars"><a href="#webjars" class="headerlink" title="webjars"></a>webjars</h4><p>WebJarsæ˜¯æ‰“åŒ…åˆ°JARï¼ˆJava Archiveï¼‰æ–‡ä»¶ä¸­çš„å®¢æˆ·ç«¯Webåº“ï¼ˆä¾‹å¦‚jQueryå’ŒBootstrapï¼‰ã€‚</p><p>from <a href="https://www.webjars.org" target="_blank" rel="noopener">webjarså®˜ç½‘</a></p><p>æ ¹æ®ä»¥ä¸Šå†…å®¹ä¸¾ä¸ªä¾‹å­æ¥è®²è§£å¦‚ä½•ä½¿ç”¨webjarsè¿›è¡Œé™æ€èµ„æºçš„åŠ è½½ï¼š</p><ol><li>å»å®˜ç½‘æ‰¾ç›¸å…³èµ„æºçš„ä¾èµ–</li></ol><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190713113630.png" alt="ä¾èµ–"></p><ol start="2"><li>æ·»åŠ åˆ°pom.xmlæ–‡ä»¶ä¸­</li></ol><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190713114028.png" alt="webjar"></p><p>ä»¥ç²‰è‰²çš„ç«–çº¿ä¸ºåˆ†å‰²çº¿ï¼Œå·¦ä¾§ä¸ºä¸‹è½½å®Œçš„webjarsçš„jaråŒ…ï¼Œå³ä¾§ä¸ºåœ¨pom.xmlæ–‡ä»¶ä¸­çš„ä¾èµ–ä¿¡æ¯ã€‚</p><h5 id="åŠ è½½webjars"><a href="#åŠ è½½webjars" class="headerlink" title="åŠ è½½webjars"></a>åŠ è½½webjars</h5><p>å¦‚æœSpringBootå‘ç°æœ‰webjarçš„åº”ç”¨jaråŒ…ï¼Œåˆ™<strong>åŠ è½½è·¯å¾„<code>classpath:/META-INF/resources/webjars/</code>ä¸‹çš„æ–‡ä»¶</strong>ã€‚åœ¨å›¾ä¸­ä¾‹å­ä¸­å°±æ˜¯<code>jquery</code>æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å†…å®¹ã€‚è¿™æ ·SpringBootå°±èƒ½å¤Ÿè¯†åˆ«jqueryåŒ…ä¸‹çš„æ‰€æœ‰é™æ€æ–‡ä»¶äº†ã€‚</p><h5 id="æ˜ å°„webjars"><a href="#æ˜ å°„webjars" class="headerlink" title="æ˜ å°„webjars"></a>æ˜ å°„webjars</h5><p>SpringBootä¼šå°†æ‰€æœ‰å·²å°†åŠ è½½jarsæ˜ å°„åˆ° <code>/webjars/**</code> è¿™ä¸ªè·¯å¾„ä¸Šã€‚</p><p>æ¯”å¦‚ä¸Šé¢æˆ‘ä»¬æ·»åŠ äº†jquery.min.jsã€‚æˆ‘ä»¬å¯åŠ¨ç¨‹åºï¼Œå¯ä»¥åœ¨<code>http://localhost:8080/webjars/jquery/3.4.1/jquery.min.js</code>è¿™ä¸ªåœ°å€ä¸Šè®¿é—®ï¼Œå‘ç°ç³»ç»Ÿå·²ç»é€šè¿‡webjarså°†èµ„æºåŠ è½½åˆ°äº†ã€‚åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œä½¿ç”¨scriptæ ‡ç­¾å¼•ç”¨webjarsä¹Ÿæ˜¯å¼•ç”¨è¿™ä¸ªåœ°å€çš„é™æ€æ–‡ä»¶ã€‚</p><h4 id="é¡¹ç›®å†…é™æ€èµ„æº"><a href="#é¡¹ç›®å†…é™æ€èµ„æº" class="headerlink" title="é¡¹ç›®å†…é™æ€èµ„æº"></a>é¡¹ç›®å†…é™æ€èµ„æº</h4><p>ä½¿ç”¨webjarsç”¨æ¥åŠ è½½é™æ€èµ„æºéå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯å¦‚æœè‡ªå·±å†™çš„jså’Œcssç­‰é™æ€èµ„æºä¹Ÿéœ€è¦åŠ è½½æ—¶ï¼Œå°±éœ€è¦æ”¾åˆ°SpringBooté»˜è®¤åŠ è½½çš„ç›®å½•ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.resources"</span>, ignoreUnknownFields = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceProperties</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; <span class="string">"classpath:/META-INF/resources/"</span>,</span><br><span class="line">    <span class="string">"classpath:/resources/"</span>, <span class="string">"classpath:/static/"</span>, <span class="string">"classpath:/public/"</span> &#125;;</span><br><span class="line"><span class="keyword">private</span> String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> addMappings = <span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Chain chain = <span class="keyword">new</span> Chain();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Cache cache = <span class="keyword">new</span> Cache();</span><br><span class="line">    <span class="comment">// è·å–é™æ€èµ„æºç›®å½•</span></span><br><span class="line"><span class="keyword">public</span> String[] getStaticLocations() &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.staticLocations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡getStaticLocationsè·å–é™æ€èµ„æºçš„ç›®å½•ï¼Œé»˜è®¤çš„SpringBootå®šä¹‰äº†classpathä¸‹çš„ä»¥ä¸‹çš„æ–‡ä»¶ï¼Œéƒ½å¯ä»¥æ”¾ç½®é™æ€æ–‡ä»¶ï¼Œéƒ½å¯ä»¥é€šè¿‡urlçš„æ–¹å¼è®¿é—®åˆ°è¿™ä¸ªé™æ€æ–‡ä»¶ã€‚</p><ul><li><code>classpath:/META-INF/resources</code></li><li><code>classpath:/resources/</code></li><li><code>classpath:/static/</code></li><li><code>classpath:/public/</code></li></ul><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªclasspathå°±æ˜¯ä¸€å¼€å§‹åˆ›å»ºSpringBootåº”ç”¨å¸®æˆ‘ä»¬åˆ›å»ºå¥½çš„resourceè·¯å¾„</p></blockquote><p>è¿™ä¸ªç±»ä¹Ÿæ˜¯ä¸€ä¸ª<code>xxxxProperties</code>ç±»ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ”¹å˜ç›¸åº”çš„é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§æ¥æ”¹å˜è¿™ä¸ªè·¯å¾„ã€‚è¿™é‡Œçš„è·¯å¾„ä½¿ç”¨çš„å˜é‡æ˜¯<code>staticLocations</code>,æ‰€ä»¥ç›¸åº”çš„åœ¨application.propertiesæ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨<code>spring.resources.staticLocations=è·¯å¾„åç§°</code>å°±è¡Œäº†ã€‚</p><h5 id="ä¸»é¡µçš„è®¾ç½®"><a href="#ä¸»é¡µçš„è®¾ç½®" class="headerlink" title="ä¸»é¡µçš„è®¾ç½®"></a>ä¸»é¡µçš„è®¾ç½®</h5><p>SpringBooté»˜è®¤çš„ä½¿ç”¨é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹çš„<code>index.html</code>ä½œä¸ºé¦–é¡µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Optional&lt;Resource&gt; <span class="title">getWelcomePage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String[] locations = getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">    <span class="comment">//éå†æ¯ä¸ªlocationså¯»æ‰¾index.htmlé¡µé¢ä½œä¸ºé¦–é¡µ</span></span><br><span class="line">    <span class="keyword">return</span> Arrays.stream(locations).map(<span class="keyword">this</span>::getIndexHtml).filter(<span class="keyword">this</span>::isReadable).findFirst();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Resource <span class="title">getIndexHtml</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.resourceLoader.getResource(location + <span class="string">"index.html"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰¾åˆ°ä¸»é¡µçš„index.htmlåï¼Œå°±å¼€å§‹åšä¸»é¡µçš„æ˜ å°„æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WelcomePageHandlerMapping(<span class="keyword">new</span> TemplateAvailabilityProviders(applicationContext),</span><br><span class="line">            applicationContext, getWelcomePage(), <span class="keyword">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,</span><br><span class="line">ApplicationContext applicationContext, Optional&lt;Resource&gt; welcomePage, String staticPathPattern) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå­˜åœ¨ï¼Œè®¾ç½®é¦–é¡µä¸ºindex.html æ˜ å°„è·¯å¾„ä¸ºï¼š /**</span></span><br><span class="line">    <span class="keyword">if</span> (welcomePage.isPresent() &amp;&amp; <span class="string">"/**"</span>.equals(staticPathPattern)) &#123;</span><br><span class="line">        logger.info(<span class="string">"Adding welcome page: "</span> + welcomePage.get());</span><br><span class="line">        setRootViewName(<span class="string">"forward:index.html"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯ä¾æ®SpringBootåŠ è½½é™æ€èµ„æºçš„æ–¹å¼åšçš„ç®€å•æ€»ç»“ã€‚</p><h2 id="æ·»åŠ controller"><a href="#æ·»åŠ controller" class="headerlink" title="æ·»åŠ controller"></a>æ·»åŠ controller</h2><p>åœ¨ä¸Šä¸€æ­¥åˆ›å»ºå®Œé¡¹ç›®åï¼Œå¯ä»¥ç´§è·Ÿç€å†™ä¸€ä¸ªSpringMVCæµ‹è¯•çš„controllerï¼Œçœ‹çœ‹èƒ½å¦å¯åŠ¨é¡¹ç›®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èµ·åˆ°äº†@Controllerå’Œ@Responsebodyä¸¤ç§ä½œç”¨ï¼Œå®é™…ä¸Šå°±æ˜¯</span></span><br><span class="line"><span class="comment">// ä¸¤ç§æ³¨è§£çš„æ•´åˆ</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello world"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä¹Ÿåƒæˆ‘å‹¾é€‰æ¥æ•°æ®åº“ç›¸å…³çš„starters,åœ¨å¯åŠ¨æ—¶ï¼Œæ§åˆ¶å°ä¼šæç¤ºéœ€è¦é…ç½®æ•°æ®åº“çš„åŸºæœ¬é…ç½®ã€‚</p><blockquote><p>é‚£ä¹ˆæ€ä¹ˆæ‰¾è¿™äº›é…ç½®å‘¢ï¼Ÿ</p><ol><li>å»å®˜ç½‘æ‰¾é…ç½®</li><li>ç›´æ¥çœ‹ä»£ç </li></ol></blockquote><p><strong>å¦‚æœä½ æ²¡æœ‰ç¢°åˆ°ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆè¯·å¿½ç•¥ä»¥ä¸‹éƒ¨åˆ†ã€‚</strong></p><p>å› ä¸ºå‰å‡ ç¯‡æ–‡ç« ä¸­å·²ç»åˆ†ææ¥SpringBootæ˜¯å¦‚ä½•å®Œæˆè‡ªåŠ¨é…ç½®çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘æƒ³é€šè¿‡æ‰¾ä»£ç çš„æ–¹å¼ç›´æ¥çœ‹å®ƒèƒ½å¤Ÿé…ç½®å“ªäº›å±æ€§ã€‚</p><ol><li>é¦–å…ˆåœ¨<code>autoconfiguration</code>åŒ…ä¸‹é¢çš„spring.factoryä¸­æœç´¢jdbc</li></ol><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190713174948.png" alt="jdbc"></p><ol start="2"><li>ç‚¹å‡»å…³äºDataSourceçš„è‡ªåŠ¨é…ç½®ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties</span>(DataSourceProperties.class)</span><br><span class="line"><span class="meta">@Import</span>(&#123; DataSourcePoolMetadataProvidersConfiguration.class, DataSourceInitializationConfiguration.class &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨DataSourcePropertiesç±»ä½œä¸ºå±æ€§ç±»,ä»¥ä¸‹ä¸ºåŸºæœ¬å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceProperties</span> <span class="keyword">implements</span> <span class="title">BeanClassLoaderAware</span>, <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ClassLoader classLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> generateUniqueName;</span><br><span class="line"><span class="keyword">private</span> Class&lt;? extends DataSource&gt; type;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String driverClassName;</span><br><span class="line"><span class="keyword">private</span> String url;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br></pre></td></tr></table></figure><p>æ ¹æ®DataSourcePropertiesç±»ï¼Œå¯ä»¥çŸ¥é“å¦‚æœæˆ‘ä»¬åƒé…ç½®DataSourceï¼Œé‚£ä¹ˆæœ‰è¿™å‡ ä¸ªå±æ€§å¯ä»¥è¿›è¡Œé…ç½®ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># spring.datasource ä¸ºå‰ç¼€ï¼Œåé¢ä¸ºå±æ€§åï¼Œå’ŒPropertiesç±»ä¸­çš„å±æ€§ç›¸å¯¹åº”ã€‚</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost:3306/springboot</span><br><span class="line">spring.datasource.driverClassName=com.mysql.jdbc.Driver</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h2><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190713180029.png" alt="ç»“æœ"></p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySqlä½¿ç”¨å¤–é”®ï¼ˆ8.0ï¼‰</title>
      <link href="/2019/07/11/2019-07-11-%E4%BD%BF%E7%94%A8Mysql%E7%9A%84%E5%A4%96%E9%94%AE/"/>
      <url>/2019/07/11/2019-07-11-%E4%BD%BF%E7%94%A8Mysql%E7%9A%84%E5%A4%96%E9%94%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨å¤–é”®çº¦æŸ"><a href="#ä½¿ç”¨å¤–é”®çº¦æŸ" class="headerlink" title="ä½¿ç”¨å¤–é”®çº¦æŸ"></a>ä½¿ç”¨å¤–é”®çº¦æŸ</h1><p>Mysqlé»˜è®¤ä½¿ç”¨çš„æ˜¯innoDBå¼•æ“ï¼Œè¯¥å¼•æ“æ˜¯æ”¯æŒå¤–é”®çš„ï¼Œä¸‹é¢æ¥è¯´è¯´å¦‚ä½•åˆ›å»ºå¤–é”®åŠå„ç§å¤–é”®ä½¿ç”¨çš„æ•ˆæœã€‚</p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>éœ€è¦æ³¨æ„çš„æ˜¯å¤–é”®ä¸æ”¯æŒè™šæ‹Ÿæ„é€ å‡ºçš„åˆ—ä¸Šã€‚</p><p>MySqlæ”¯æŒå¤–é”®ï¼Œå…è®¸è·¨è¡¨äº¤å‰å¼•ç”¨ç›¸å…³æ•°æ®ï¼Œæœ‰åŠ©äºå¸®åŠ©ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚åœ¨createå’Œalterè¡¨ä¸­çš„è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-- ä¸­æ‹¬å·å†…æ˜¯éå¿…å†™çš„</span><br><span class="line">[CONSTRAINT [symbol]] FOREIGN KEY</span><br><span class="line">    [index_name] (col_name, ...)</span><br><span class="line">    REFERENCES tbl_name (col_name,...)</span><br><span class="line">    [ON DELETE reference_option]</span><br><span class="line">    [ON UPDATE reference_option]</span><br><span class="line"></span><br><span class="line">reference_option:</span><br><span class="line">    RESTRICT | CASCADE | SET NULL | NO ACTION | SET DEFAULT</span><br><span class="line"></span><br><span class="line">CREATE TABLE child (</span><br><span class="line">    id INT,</span><br><span class="line">    parent_id INT,</span><br><span class="line">    -- å®šä¹‰ç´¢å¼•</span><br><span class="line">    INDEX par_ind (parent_id),</span><br><span class="line">    -- parent_idå…³è”parentè¡¨ä¸­çš„idå­—æ®µ</span><br><span class="line">    -- å¦‚æœçˆ¶è¡¨åˆ é™¤äº†ï¼Œåˆ™å­è¡¨ä¹Ÿéœ€è¦åˆ é™¤å­—æ®µå†…å®¹</span><br><span class="line">    FOREIGN KEY (parent_id)</span><br><span class="line">        REFERENCES parent(id)</span><br><span class="line">        ON DELETE CASCADE</span><br><span class="line">) ENGINE=INNODB;</span><br><span class="line"></span><br><span class="line">-- æ·»åŠ å¤–é”®</span><br><span class="line">ALTER TABLE tb1 ADD FOREIGN KEY  (parent_id)</span><br><span class="line">        REFERENCES parent(id)</span><br><span class="line">        ON DELETE CASCADE</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤å¤–é”®</span><br><span class="line">ALTER TABLE tbl_name DROP FOREIGN KEY fk_symbol;</span><br></pre></td></tr></table></figure><p><code>index_name</code> æŒ‡çš„æ˜¯å¤–é”®çš„æ ‡è¯†ï¼Œå¦‚æœå­è¡¨å·²ç»æ˜¾å¼çš„å®šä¹‰äº†å¯ä»¥æ”¯æŒå¤–é”®çš„ç´¢å¼•ï¼ˆä¸Šé¢ä¾‹å­ä¸­çš„<code>par_ind</code>ï¼‰ï¼Œåˆ™å¿½ç•¥ã€‚å¦åˆ™ï¼Œmysqlä¼šä¾ç…§ä»¥ä¸‹è§„åˆ™éšå¼çš„åˆ›å»ºä¸€ä¸ªå¤–é”®ç´¢å¼•ã€‚</p><ul><li>å¦‚æœå®šä¹‰<code>CONSTRAINT symbol</code> å€¼ï¼Œåˆ™ä½¿ç”¨è¿™ä¸ªå€¼ï¼Œå¦åˆ™ä½¿ç”¨å¤–é”®å <code>index_name</code>.</li><li>å¦‚æœä¸Šé¢ä¸¤ä¸ªéƒ½æ²¡æœ‰å®šä¹‰ï¼Œå¤–é”®åä½¿ç”¨å¼•ç”¨å¤–é”®åˆ—çš„åç§°ã€‚</li></ul><h2 id="æ›´æ–°-åˆ é™¤è¡Œä¸º"><a href="#æ›´æ–°-åˆ é™¤è¡Œä¸º" class="headerlink" title="æ›´æ–°/åˆ é™¤è¡Œä¸º"></a>æ›´æ–°/åˆ é™¤è¡Œä¸º</h2><p>Mysqlå¦‚ä½•ä½¿ç”¨å¤–é”®æ¥ä¿è¯å‚ç…§çš„å®Œæ•´æ€§ã€‚</p><p>å¯¹äºæ”¯æŒå¤–é”®çš„innoDBå­˜å‚¨å¼•æ“æ¥è¯´ï¼ŒMYSQLæ‹’ç»åœ¨å­è¡¨ä¸­æ’å…¥æˆ–åˆ é™¤åœ¨çˆ¶è¡¨ä¸­æ²¡æœ‰åŒ¹é…åˆ°çš„å¤–é”®å€™é€‰å€¼ã€‚</p><p>å½“çˆ¶è¡¨ä¸­çš„å¤–é”®å€™é€‰å€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ ¹æ®ä¸åŒçš„è¡Œä¸ºç­–ç•¥ï¼Œæ¥å½±å“å­è¡¨ä¸­å¯¹åº”çš„å¤–é”®çš„é”®å€¼ã€‚å…·ä½“çš„ç­–ç•¥å¦‚ä¸‹ï¼š</p><h3 id="CASCADE-ã€çº§è”ã€‘"><a href="#CASCADE-ã€çº§è”ã€‘" class="headerlink" title="CASCADE ã€çº§è”ã€‘"></a><code>CASCADE</code> ã€çº§è”ã€‘</h3><p>å¦‚æœåœ¨çˆ¶è¡¨ä¸­åˆ é™¤å’Œæ›´æ–°æ•°æ®ï¼Œä¼šè‡ªåŠ¨çš„åˆ é™¤å’Œæ›´æ–°å­è¡¨ä¸­çš„åŒ¹é…åˆ°çš„æ‰€æœ‰æ•°æ®ã€‚æ”¯æŒåˆ é™¤çº§è”<code>ON DELETE CASCADE</code>å’Œæ›´æ–°çº§è”<code>ON UPDATE CASCADE</code>,ä¸¤ä¸ªè¡¨ä¹‹é—´ï¼Œä¸è¦å®šä¹‰å‡ ä¸ªè¿™æ ·çš„å­å¥ï¼Œè¿™äº›å­å¥ä½œç”¨åŸŸçˆ¶è¡¨æˆ–å­è¡¨ä¸­çš„åŒä¸€åˆ—ã€‚</p><h3 id="SET-NULL-ã€ç½®ç©ºã€‘"><a href="#SET-NULL-ã€ç½®ç©ºã€‘" class="headerlink" title="SET NULL ã€ç½®ç©ºã€‘"></a><code>SET NULL</code> ã€ç½®ç©ºã€‘</h3><p>å¦‚æœåœ¨çˆ¶è¡¨ä¸­åˆ é™¤å’Œæ›´æ–°æ•°æ®ï¼Œåˆ™è‡ªåŠ¨çš„ç½®ç©º<code>NULL</code>å­è¡¨ä¸­çš„å¤–é”®å¯¹åº”çš„å­—æ®µã€‚å¦‚æœåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œä¸­æŒ‡å®šäº†<code>ON DELETE SET NULL</code>æˆ–è€…<code>ON UPDATE SET NULL</code> æ—¶ï¼Œå¿…é¡»ä¿éšœ*<em>å­è¡¨å¤–é”®çš„é‚£ä¸ªå­—æ®µæ²¡æœ‰è®¾ç½®ä¸º <code>NOT NULL</code> *</em></p><h3 id="RESTRICT-ã€é™åˆ¶ã€‘"><a href="#RESTRICT-ã€é™åˆ¶ã€‘" class="headerlink" title="RESTRICT ã€é™åˆ¶ã€‘"></a><code>RESTRICT</code> ã€é™åˆ¶ã€‘</h3><p>å¦‚æœåœ¨ä¼ç¬”å•Šå“¦ä¸­åˆ é™¤å’Œæ›´æ–°æ•°æ®ï¼Œå­è¡¨æ‹’ç»åˆ é™¤æˆ–æ›´æ–°å¯¹åº”å­—æ®µå†…å®¹ã€‚</p><h3 id="NO-ACTIONã€æ— åŠ¨ä½œã€‘"><a href="#NO-ACTIONã€æ— åŠ¨ä½œã€‘" class="headerlink" title="NO ACTIONã€æ— åŠ¨ä½œã€‘"></a><code>NO ACTION</code>ã€æ— åŠ¨ä½œã€‘</h3><p><code>NO ACTION</code> æ˜¯æ ‡å‡†SQLä¸­çš„å…³é”®å­—ï¼Œåœ¨mysqlä¸­<code>NO ACTION</code>å’Œ<code>RESTRICT</code>çš„ä½œç”¨ç›¸åŒï¼Œéƒ½æ˜¯åœ¨åœ¨ä¿®æ”¹æˆ–è€…åˆ é™¤ä¹‹å‰å»æ£€æŸ¥ä»è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æ•°æ®ï¼Œå¦‚æœæœ‰ï¼Œæ‹’ç»æ“ä½œã€‚</p><p>ä½†æ˜¯æœ‰äº›æ•°æ®åº“ç³»ç»Ÿä¼šæœ‰å»¶è¿Ÿæ£€æŸ¥åŠŸèƒ½ï¼Œä¼šå¯¼è‡´NO Action ä¼šå»¶è¿Ÿæ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”æ•°æ®ï¼Œä½†æ˜¯<strong>MYSQLå¤–é”®çš„æ£€æŸ¥æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œæ‰€ä»¥RESTRICTå’ŒNO ACTIONæ˜¯å®Œå…¨ç›¸åŒçš„</strong></p><h3 id="SET-DEFAULT"><a href="#SET-DEFAULT" class="headerlink" title="SET DEFAULT"></a><code>SET DEFAULT</code></h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œset defaultåªæ˜¯MySQL è§£æå™¨è®¤å¯ï¼Œä½†æ˜¯InnoDBå’ŒNDB æ‹’ç»åœ¨å®šä¹‰è¡¨æ—¶ï¼Œå‡ºç°ON DELETE SET DEFAULT or ON UPDATE SET DEFAULT è¯­å¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MYSQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MYSQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootçš„æ—¥å¿—ä½¿ç”¨</title>
      <link href="/2019/07/10/2019-07-10-SpringBoot%E7%9A%84%E6%97%A5%E5%BF%97/"/>
      <url>/2019/07/10/2019-07-10-SpringBoot%E7%9A%84%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootçš„æ—¥å¿—ä½¿ç”¨"><a href="#SpringBootçš„æ—¥å¿—ä½¿ç”¨" class="headerlink" title="SpringBootçš„æ—¥å¿—ä½¿ç”¨"></a>SpringBootçš„æ—¥å¿—ä½¿ç”¨</h1><h2 id="SpringBootçš„æ—¥å¿—é€‰æ‹©"><a href="#SpringBootçš„æ—¥å¿—é€‰æ‹©" class="headerlink" title="SpringBootçš„æ—¥å¿—é€‰æ‹©"></a>SpringBootçš„æ—¥å¿—é€‰æ‹©</h2><p>SpringBooté»˜è®¤ä½¿ç”¨SLF4jå’Œlogbackç”¨ä½œæ—¥å¿—ã€‚ä¸ºä»€ä¹ˆæ˜¯ä¸¤ä¸ªï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™ä¸¤ä¸ªï¼Ÿ</p><h3 id="æ—¥å¿—æ¡†æ¶çš„å¤§è‡´åˆ†ç±»"><a href="#æ—¥å¿—æ¡†æ¶çš„å¤§è‡´åˆ†ç±»" class="headerlink" title="æ—¥å¿—æ¡†æ¶çš„å¤§è‡´åˆ†ç±»"></a>æ—¥å¿—æ¡†æ¶çš„å¤§è‡´åˆ†ç±»</h3><p>æ—¥å¿—æ¡†æ¶åˆ†ä¸ºæ—¥å¿—çš„é—¨é¢æ¡†æ¶å’Œå…·ä½“çš„å®ç°æ¡†æ¶ï¼Œä¸ºä»€ä¹ˆéœ€è¦é—¨é¢æ¡†æ¶ï¼Œæ˜¯å› ä¸ºä¸åŒçš„ç³»ç»Ÿå¯¹æ—¥å¿—çš„éœ€æ±‚å¯èƒ½ä¸åŒï¼Œç³»ç»Ÿä¸€å¯èƒ½ä½¿ç”¨æ—¥å¿—æ¡†æ¶ä¸€ï¼Œç³»ç»ŸäºŒè¿˜éœ€è¦å®ç°æ—¥å¿—åŠŸèƒ½ï¼Œå¦‚æœè¿˜ç”¨æ—¥å¿—æ¡†æ¶ä¸€ï¼Œåˆ™éœ€è¦é€‚é…ç³»ç»ŸäºŒè¿›è¡Œapiçš„è°ƒæ•´ã€‚</p><p>é—¨é¢æ—¥å¿—æ¡†æ¶å°±ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ã€‚è®©è°ƒç”¨æ¡†æ¶çš„apiç»Ÿä¸€ï¼Œå…·ä½“çš„å®ç°å¯ä»¥éšä¸åŒçš„ç³»ç»Ÿè¿›è¡Œè°ƒæ•´ã€‚ç±»ä¼¼jdbcï¼Œæ“ä½œæ¥å£éœ€è¦è¿›è¡Œç»Ÿä¸€ã€‚</p><p>æ‰€ä»¥SpringBootçš„æ—¥å¿—ä½¿ç”¨åˆ†åˆ«æ˜¯ç”¨æ¥æ—¥å¿—é—¨é¢æ¡†æ¶<code>SLF4j</code>å’Œæ—¥å¿—å…·ä½“å®ç°æ¡†æ¶<code>logback</code>ä½œä¸ºæ—¥å¿—æœåŠ¡ã€‚</p><h2 id="ä½¿ç”¨æ—¥å¿—"><a href="#ä½¿ç”¨æ—¥å¿—" class="headerlink" title="ä½¿ç”¨æ—¥å¿—"></a>ä½¿ç”¨æ—¥å¿—</h2><h3 id="ç®€æ˜“ä½¿ç”¨SLF4j"><a href="#ç®€æ˜“ä½¿ç”¨SLF4j" class="headerlink" title="ç®€æ˜“ä½¿ç”¨SLF4j"></a>ç®€æ˜“ä½¿ç”¨SLF4j</h3><p>å‚è€ƒ<a href="https://www.slf4j.org/manual.html" target="_blank" rel="noopener">SLF4jå®˜ç½‘</a>ä¸­çš„hello worldç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥slf4jçš„jaråŒ…</span></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(HelloWorld.class);</span><br><span class="line">    logger.info(<span class="string">"Hello World"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾è¡¨ç¤ºäº†ä½¿ç”¨slf4jå’Œå„ä¸ªæ—¥å¿—å®ç°æ¡†æ¶çš„åŒ¹é…ã€‚ç»¿è‰²çš„æ˜¯é€‚é…å±‚ï¼Œæ·±è“è‰²çš„æ˜¯å®ç°æ¡†æ¶ã€‚æ¯”å¦‚ä½¿ç”¨logbackä½œä¸ºå®ç°æ¡†æ¶ï¼Œåˆ™éœ€è¦å¯¼å…¥slf4jçš„jaråŒ…å’Œlogbackçš„ç›¸å…³jaråŒ…ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨log4jä½œä¸ºå®ç°æ¡†æ¶ï¼Œè¿˜éœ€å¯¼å…¥ä¸­é—´çš„é€‚é…å±‚jaråŒ…ï¼ˆä¸­é—´ç»¿è‰²çš„ï¼‰ã€‚</p><p><img src="https://www.slf4j.org/images/concrete-bindings.png" alt="ä½¿ç”¨slf4j"></p><p>åœ¨Springboot-logging-startä¸­ä½¿ç”¨å¦‚ä¸‹çš„jaråŒ…ä¾èµ–ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190712095039.png" alt="jaråŒ…ä¾èµ–"></p><p>æ¯ä¸€ä¸ªå®ç°æ¡†æ¶éƒ½æœ‰å„è‡ªçš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨slf4jåï¼Œé…ç½®æ–‡ä»¶è¿˜æ˜¯ä½¿ç”¨å…·ä½“å®ç°çš„é…ç½®æ–‡ä»¶ã€‚</p><h4 id="SpringBootä¸­çš„SLF4j"><a href="#SpringBootä¸­çš„SLF4j" class="headerlink" title="SpringBootä¸­çš„SLF4j"></a>SpringBootä¸­çš„SLF4j</h4><ol><li>SpringBootåº•å±‚è‡ªåŠ¨é…ç½®ä½¿ç”¨çš„æ˜¯SLF4jå’Œlogbackã€‚</li><li>SprintBootä½¿ç”¨ä¸­é—´åŒ…å°†å…¶ä»–æ—¥å¿—æ¡†æ¶è½¬åŒ–ä¸ºslf4jæ¡†æ¶ã€‚</li><li>å¼•å…¥å…¶ä»–æ—¥å¿—æ¡†æ¶æ—¶ï¼Œéœ€è¦æŠŠè¿™ä¸ªæ—¥å¿—çš„jaråŒ…æ’é™¤æ‰ã€‚å¦åˆ™ä¸slf4jçš„jaråŒ…ç›¸å†²çªï¼Œä¸Šä¸€æ¡å°±æ˜¯åŸå› ã€‚</li></ol><p>åœ¨æµ‹è¯•æ–‡ä»¶ä¸­æµ‹è¯•SpringBootçš„æ—¥å¿—ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLogger</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="comment">// ç”±ä½åˆ°é«˜ æ—¥å¿—çš„çº§åˆ«ï¼Œæ—¥å¿—æ¡†æ¶å¯ä»¥æ ¹æ®é…ç½®æ–‡ä»¶è°ƒæ•´è¾“å‡ºçš„æ—¥å¿—çº§åˆ«ï¼Œ</span></span><br><span class="line">       <span class="comment">// åªä¼šè¾“å‡ºç›¸åº”æ—¥å¿—çº§åˆ«åŠåé¢çš„é«˜çº§åˆ«æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line">       logger.trace(<span class="string">"è¿™æ˜¯traceæ—¥å¿—"</span>);</span><br><span class="line">       logger.debug(<span class="string">"è¿™æ˜¯debugæ—¥å¿—"</span>);</span><br><span class="line">       <span class="comment">// SpringBooté»˜è®¤ä½¿ç”¨çš„æ˜¯infoçº§åˆ«ï¼Œ</span></span><br><span class="line">       <span class="comment">// å¯ä»¥ä½¿ç”¨æ—¥å¿—çš„é…ç½®æ–‡ä»¶è°ƒæ•´çº§åˆ«</span></span><br><span class="line">       logger.info(<span class="string">"è¿™æ˜¯infoæ—¥å¿—"</span>);</span><br><span class="line">       logger.warn(<span class="string">"è¿™æ˜¯warnæ—¥å¿—"</span>);</span><br><span class="line">       logger.error(<span class="string">"è¿™æ˜¯erroræ—¥å¿—"</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>æ—¥å¿—çº§åˆ«æœ‰<code>trace</code>, <code>debug</code>,<code>info</code>,<code>warn</code>,<code>error</code>äº”ç§æ—¥å¿—çº§åˆ«ã€‚å¹¶ä¸”ç”±ä½åˆ°é«˜æ’åºã€‚æŒ‡å®šæ—¥å¿—çº§åˆ«ï¼Œåˆ™ç³»ç»Ÿä¼šè¾“å‡ºå½“å‰æ—¥å¿—çº§åˆ«å’Œæ›´é«˜çš„æ—¥å¿—çº§åˆ«çš„æ—¥å¿—ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¨å±€çš„æ—¥å¿—è®°å½•çº§åˆ«</span></span><br><span class="line"><span class="comment">#logging:</span></span><br><span class="line"><span class="comment">#  level: trace</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šçš„åŒ…ä¸‹çš„æ—¥å¿—è®°å½•çº§åˆ«</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line"><span class="attr">  level:</span></span><br><span class="line">    <span class="string">com</span> <span class="string">:</span></span><br><span class="line">      <span class="string">nanyin</span> <span class="string">:</span> <span class="string">debug</span></span><br><span class="line"><span class="comment">#  pattern: è¾“å‡ºæ ¼å¼</span></span><br><span class="line"><span class="comment">#    file:</span></span><br><span class="line"><span class="comment">#    console:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  file: -- è¿™é‡Œç”¨äºæŒ‡å®šæ—¥å¿—è®°å½•çš„æ–‡ä»¶åï¼Œå¯ä»¥æŒ‡å®šå…·ä½“çš„è·¯å¾„ï¼ŒæœªæŒ‡å®šåˆ™ç”Ÿæˆåœ¨å½“å‰é¡¹ç›®ä¸‹</span></span><br><span class="line"><span class="comment">#  path: -- è¿™é‡Œç”¨äºæŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ï¼Œspringbootä¼šé»˜è®¤ç”Ÿæˆè·¯å¾„ï¼Œé»˜è®¤æ–‡ä»¶å</span></span><br><span class="line"><span class="comment"># è¿™ä¸¤ä¸ªæŒ‡å®šä¸€ä¸ªå°±å¥½äº†ï¼Œéƒ½æŒ‡å®šåˆ™ä¼šé»˜è®¤ä½¿ç”¨file</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶"><a href="#ä½¿ç”¨è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶"></a>ä½¿ç”¨è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶</h4><h4 id="æ›´æ¢log4j2ä½œä¸ºæ—¥å¿—æ¡†æ¶"><a href="#æ›´æ¢log4j2ä½œä¸ºæ—¥å¿—æ¡†æ¶" class="headerlink" title="æ›´æ¢log4j2ä½œä¸ºæ—¥å¿—æ¡†æ¶"></a>æ›´æ¢log4j2ä½œä¸ºæ—¥å¿—æ¡†æ¶</h4>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootä¸­çš„é…ç½®æ–‡ä»¶ï¼ˆæ‹“å±•ï¼‰</title>
      <link href="/2019/07/08/2019-07-08-SpringBoot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%88%E6%8B%93%E5%B1%95%EF%BC%89/"/>
      <url>/2019/07/08/2019-07-08-SpringBoot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%88%E6%8B%93%E5%B1%95%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootä¸­çš„é…ç½®æ–‡ä»¶-æ‹“å±•"><a href="#SpringBootä¸­çš„é…ç½®æ–‡ä»¶-æ‹“å±•" class="headerlink" title="SpringBootä¸­çš„é…ç½®æ–‡ä»¶(æ‹“å±•)"></a>SpringBootä¸­çš„é…ç½®æ–‡ä»¶(æ‹“å±•)</h1><p>å¦‚æœæœ‰å¤šä¸ªç¯å¢ƒï¼Œé…ç½®æ–‡ä»¶éœ€è¦æ ¹æ®ç¯å¢ƒæ¥å˜åŒ–ï¼Œåªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶å°±æ˜¾çš„é¸¡è‚‹äº†ï¼Œæ¯æ¬¡å˜æ›´ç¯å¢ƒçš„æ—¶å€™éƒ½éœ€è¦ä¿®æ”¹ä¸€éé…ç½®æ–‡ä»¶ï¼Œä¸¤ä¸ªè¿˜å¥½ï¼Œå¤šäº†å°±ç›¸å½“éº»çƒ¦äº†ã€‚</p><p>SpringBootæä¾›äº†å¤šé…ç½®æ–‡ä»¶çš„ç”¨æ³•ï¼Œè®©ç¯å¢ƒçš„å˜åŒ–å°½å¯èƒ½å°‘çš„å½±å“åˆ°é…ç½®æ–‡ä»¶çš„æ›´æ”¹ã€‚</p><h2 id="å¤šé…ç½®æ–‡ä»¶"><a href="#å¤šé…ç½®æ–‡ä»¶" class="headerlink" title="å¤šé…ç½®æ–‡ä»¶"></a>å¤šé…ç½®æ–‡ä»¶</h2><h3 id="åŠ è½½é¡ºåº"><a href="#åŠ è½½é¡ºåº" class="headerlink" title="åŠ è½½é¡ºåº"></a>åŠ è½½é¡ºåº</h3><p>Springä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾åœ°å€ï¼Œå¦‚æœæœ‰åˆ™ä¼˜å…ˆä½¿ç”¨å‰é¢çš„é…ç½®æ–‡ä»¶çš„å±æ€§ï¼Œå¦‚æœåé¢çš„æ–‡ä»¶æœ‰å‰é¢æ–‡ä»¶æ²¡æœ‰çš„å±æ€§ï¼Œåˆ™ä¼šæ·»åŠ ï¼Œå¦åˆ™å¿½ç•¥ã€‚</p><ol><li>file:./config/</li><li>file:./</li><li>classpath:/config/</li><li>classpath:/</li></ol><h4 id="æŒ‡å®š-æ·»åŠ é»˜è®¤åŠ è½½åœ°å€"><a href="#æŒ‡å®š-æ·»åŠ é»˜è®¤åŠ è½½åœ°å€" class="headerlink" title="æŒ‡å®š/æ·»åŠ é»˜è®¤åŠ è½½åœ°å€"></a>æŒ‡å®š/æ·»åŠ é»˜è®¤åŠ è½½åœ°å€</h4><p>ä½¿ç”¨<code>spring.config.location</code>æ¥æŒ‡å®šé»˜è®¤çš„åŠ è½½åœ°å€ã€‚</p><p>å¦‚æœspring.config.location æŒ‡å®šçš„å€¼ä¸ºï¼š classpath:/custom-config/,file:./custom-config/ï¼Œåˆ™ç³»ç»Ÿä¼šä¼˜å…ˆæ‰¾è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>å¦‚æœä½¿ç”¨<code>spring.config.additional-location</code>æ¥æ·»åŠ é…ç½®æ–‡ä»¶çš„åŠ è½½åœ°å€ã€‚</p><h3 id="å‘½åæ ¼å¼"><a href="#å‘½åæ ¼å¼" class="headerlink" title="å‘½åæ ¼å¼"></a>å‘½åæ ¼å¼</h3><p>å¯ä»¥ä½¿ç”¨ <code>application-{profile}.properties</code>æ¥å®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„é…ç½®æ–‡ä»¶ã€‚ç‰¹æ®Šçš„è¿™ä¸ªé…ç½®æ–‡ä»¶å¦‚æœè°ƒç”¨ï¼Œé‚£ä¹ˆä»–æ€»ä¼šè¦†ç›–æ‰é»˜è®¤çš„<code>application.properties</code>æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</p><p>æ¯”å¦‚ä½¿ç”¨<code>application-dev.properties</code>ä½œä¸ºå¼€å‘ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æŒ‡å®šäº†æœåŠ¡ç«¯å£8081.è€Œåœ¨é»˜è®¤çš„<code>application.properties</code>ä¸­æŒ‡å®šçš„ç«¯å£å·ä¸º8080.é‚£ä¹ˆï¼Œç³»ç»Ÿä¼šä½¿ç”¨å“ªä¸ªç«¯å£å‘¢ï¼Ÿ</p><p>ä¸‹é¢æˆ‘ä½¿ç”¨ymlæ–‡ä»¶ä½œä¸ºä¾‹å­ï¼ˆåŒpropertiesæ–‡ä»¶ï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.ymlæ–‡ä»¶ä¸­çš„å†…å®¹</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># yamlæ–‡ä»¶æ ¼å¼æŒ‡å®šä½¿ç”¨å“ªä¸ªé…ç½®</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># application-dev.propertiesæ–‡ä»¶ä¸­çš„å†…å®¹</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡spring.profiles.active=dev(è¿™æ—¶propertiesæ ¼å¼)ã€‚æ¥ç‰¹æ®ŠæŒ‡å®šå¯ç”¨å“ªäº›é…ç½®æ–‡ä»¶ã€‚è¿™é‡Œå¯ç”¨çš„æ˜¯<code>application-dev.properties</code>æ–‡ä»¶ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190708221852.png" alt="è¿è¡Œç»“æœ"></p><p>ç”±æ§åˆ¶å°çš„è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼ŒspringBootæ¿€æ´»äº†åä¸º<code>dev</code>çš„é…ç½®æ–‡ä»¶åŠ<code>application-dev.properties</code>æ–‡ä»¶ï¼Œå¹¶ä¸”æ›´æ”¹ç«¯å£ä¸ºdevä¸­æŒ‡å®šçš„8081ç«¯å£ã€‚</p><h3 id="ä½¿ç”¨yamlæ–‡æ¡£å—"><a href="#ä½¿ç”¨yamlæ–‡æ¡£å—" class="headerlink" title="ä½¿ç”¨yamlæ–‡æ¡£å—"></a>ä½¿ç”¨yamlæ–‡æ¡£å—</h3><p>yamlæ–‡ä»¶æä¾›ä¸€ç§ç‰¹æ€§å«åšæ–‡æ¡£å—ã€‚ä½¿ç”¨ä¸‰ä¸ª<code>-</code>æ¥éš”ç¦»é…ç½®ä¿¡æ¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤çš„</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡æ¡£å—1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡æ¡£å—2</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">     profiles:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8082</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–‡æ¡£å—èƒ½å¤Ÿå‡å°‘å¤šä¸ªé…ç½®æ–‡ä»¶ã€‚ä¸å¤šä¸ªé…ç½®æ–‡ä»¶æ•ˆæœæ˜¯ç­‰åŒçš„ã€‚</p><h2 id="è‡ªåŠ¨é…ç½®"><a href="#è‡ªåŠ¨é…ç½®" class="headerlink" title="è‡ªåŠ¨é…ç½®"></a>è‡ªåŠ¨é…ç½®</h2><p>å…¶å®åœ¨å‰é¢çš„æ–‡ç« ä¸­å·²ç»å¤§æ¦‚äº†è§£äº†<code>SpringBoot</code>å¦‚ä½•è¿›è¡Œè‡ªåŠ¨é…ç½®ï¼Œä½†æ˜¯ä»…ä»…åœç•™åœ¨äº†<code>EnableAutoConfiguration</code>æ³¨è§£çš„ä½¿ç”¨å’Œæµ…å±‚çš„è§£æä¸Šï¼Œè¿™æ¬¡éœ€è¦æ›´åŠ æ·±å…¥çš„äº†è§£å¦‚ä½•è°ƒç”¨åˆ°è‡ªåŠ¨é…ç½®ç±»ã€æˆ‘ä»¬å¦‚æœæƒ³è‡ªå·±åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å±æ€§ï¼Œè¯¥æ€ä¹ˆå»é…ç½®ã€‚</p><h3 id="å¦‚ä½•è¿›è¡Œçš„è‡ªåŠ¨é…ç½®"><a href="#å¦‚ä½•è¿›è¡Œçš„è‡ªåŠ¨é…ç½®" class="headerlink" title="å¦‚ä½•è¿›è¡Œçš„è‡ªåŠ¨é…ç½®"></a>å¦‚ä½•è¿›è¡Œçš„è‡ªåŠ¨é…ç½®</h3><p>é¦–å…ˆè¿˜æ˜¯è¿›å…¥åˆ°<code>SpringBootApplication</code>æ³¨è§£ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(excludeFilters = &#123; <span class="meta">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="line"><span class="meta">@Filter</span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span><br><span class="line">        <span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br></pre></td></tr></table></figure><p>å‘ç°è¿™é‡Œè°ƒç”¨äº†<code>EnableAutoConfiguration</code>æ³¨è§£ã€‚å†ç‚¹è¿›è¿™ä¸ªæ³¨è§£ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="comment">// å¼•ç”¨äº†AutoConfigurationImportSelectorè¿™ä¸ªç±»</span></span><br><span class="line"><span class="meta">@Import</span>(AutoConfigurationImportSelector.class)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé€šè¿‡importæ³¨è§£ä½¿ç”¨äº†AutoConfigurationImportSelectorç±»ï¼Œè¿™ä¸ªç±»ç›´æ¥ç¿»è¯‘è¿‡æ¥å«åšè‡ªåŠ¨é…ç½®å¯¼å…¥é€‰æ‹©å™¨ã€‚è¿›å…¥è¿™ä¸ªç±»ä¸­çœ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title">DeferredImportSelector</span>, <span class="title">BeanClassLoaderAware</span>,</span></span><br><span class="line"><span class="class"><span class="title">ResourceLoaderAware</span>, <span class="title">BeanFactoryAware</span>, <span class="title">EnvironmentAware</span>, <span class="title">Ordered</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°AutoConfigurationImportSelectorç»§æ‰¿äº†<code>DeferredImportSelector</code>è¿™ä¸ªç±»ã€‚è¿™ä¸ªç±»ä¸­éœ€è¦å®ç°çš„æ–¹æ³•æ˜¯<code>void process(AnnotationMetadata metadata, DeferredImportSelector selector);</code>æ–¹æ³•ã€‚</p><p>æ‰€ä»¥éœ€è¦çœ‹AutoConfigurationImportSelectorä¸­æ˜¯å¦‚ä½•å®ç°çˆ¶ç±»ä¸­å®šä¹‰çš„<code>process</code>æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(AnnotationMetadata annotationMetadata, DeferredImportSelector deferredImportSelector)</span> </span>&#123;</span><br><span class="line">    Assert.state(deferredImportSelector <span class="keyword">instanceof</span> AutoConfigurationImportSelector,</span><br><span class="line">            () -&gt; String.format(<span class="string">"Only %s implementations are supported, got %s"</span>,</span><br><span class="line">                    AutoConfigurationImportSelector.class.getSimpleName(),</span><br><span class="line">                    deferredImportSelector.getClass().getName()));</span><br><span class="line">                    <span class="comment">// è·å¾—è‡ªåŠ¨é…ç½®çš„entryï¼Œç‚¹è¿›è¿™ä¸ªæ–¹æ³•çœ‹å¦‚ä½•è·å–è‡ªåŠ¨é…ç½®çš„é…ç½®ä¿¡æ¯çš„</span></span><br><span class="line">    AutoConfigurationEntry autoConfigurationEntry = ((AutoConfigurationImportSelector) deferredImportSelector)</span><br><span class="line">            .getAutoConfigurationEntry(getAutoConfigurationMetadata(), annotationMetadata);</span><br><span class="line">    <span class="keyword">this</span>.autoConfigurationEntries.add(autoConfigurationEntry);</span><br><span class="line"><span class="comment">// å¾ªç¯æ‰€æœ‰configurationç„¶åæ”¾åˆ°entriesä¸­æ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚</span></span><br><span class="line">    <span class="keyword">for</span> (String importClassName : autoConfigurationEntry.getConfigurations()) &#123;</span><br><span class="line">        <span class="keyword">this</span>.entries.putIfAbsent(importClassName, annotationMetadata);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>getAutoConfigurationEntry</code>è¿™ä¸ªæ–¹æ³•è·å–åˆ°æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®çš„ä¿¡æ¯ã€‚ç‚¹è¿›è¿™ä¸ªæ–¹æ³•çœ‹æ˜¯å¦‚ä½•è·å–åˆ°çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> AutoConfigurationEntry <span class="title">getAutoConfigurationEntry</span><span class="params">(AutoConfigurationMetadata autoConfigurationMetadata,</span></span></span><br><span class="line"><span class="function"><span class="params">        AnnotationMetadata annotationMetadata)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">    &#125;</span><br><span class="line">    AnnotationAttributes attributes = getAttributes(annotationMetadata);</span><br><span class="line">    <span class="comment">// è¿”å›è‡ªåŠ¨é…ç½®ç±»çš„å…¨ç±»å</span></span><br><span class="line">    List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">    <span class="comment">// å»æ‰é‡å¤çš„</span></span><br><span class="line">    configurations = removeDuplicates(configurations);</span><br></pre></td></tr></table></figure><p>é€šè¿‡getCandidateConfigurationsæ¥è·å–è‡ªåŠ¨é…ç½®çš„å…¨ç±»åã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> List&lt;String&gt; <span class="title">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°è¿”å›çš„æ˜¯ EnableAutoConfiguration.class</span></span><br><span class="line">    List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(),</span><br><span class="line">            getBeanClassLoader());</span><br></pre></td></tr></table></figure><p>æ¥ç€è°ƒç”¨<code>loadFactoryNames</code>è·å–è‡ªåŠ¨é…ç½®ç±»çš„List </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, @Nullable ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„factoryClassNameæ˜¯EnableAutoConfiguration</span></span><br><span class="line">    String factoryClassName = factoryClass.getName();</span><br><span class="line">    <span class="comment">// ä¸‹é¢è¿™å¥è¯çš„æ„æ€æ˜¯éœ€è¦åœ¨loadSpringFactoriesè¿™ä¸ªmapä¸­è·å–keyä¸ºEnableAutoConfigurationçš„value</span></span><br><span class="line">    <span class="keyword">return</span> loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™ä¸ªmapçš„å€¼æ˜¯æ€ä¹ˆå½¢æˆçš„å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨FACTORIES_RESOURCE_LOCATIONä¸­è·å–èµ„æº</span></span><br><span class="line">Enumeration&lt;URL&gt; urls = (classLoader != <span class="keyword">null</span> ?</span><br><span class="line">classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :</span><br><span class="line">ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªMAPï¼Œå°†ç»“æœéƒ½å­˜åˆ°è¿™ä¸ªmapä¸­</span></span><br><span class="line">result = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</span><br><span class="line"><span class="comment">//å¯¹æ¯ä¸ªèµ„æºå¾ªç¯</span></span><br><span class="line"><span class="keyword">while</span> (urls.hasMoreElements()) &#123;</span><br><span class="line">URL url = urls.nextElement();</span><br><span class="line">UrlResource resource = <span class="keyword">new</span> UrlResource(url);</span><br><span class="line"><span class="comment">//  è½¬åŒ–ä¸ºproperties</span></span><br><span class="line">Properties properties = PropertiesLoaderUtils.loadProperties(resource);</span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) &#123;</span><br><span class="line">String factoryClassName = ((String) entry.getKey()).trim();</span><br><span class="line"><span class="keyword">for</span> (String factoryName : StringUtils.commaDelimitedListToStringArray((String) entry.getValue())) &#123;</span><br><span class="line"><span class="comment">// æœ€åæ·»åŠ åˆ°resultä¸­</span></span><br><span class="line">result.add(factoryClassName, factoryName.trim());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">cache.put(classLoader, result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾æ˜¯å¯¹resultçš„debugç»“æœï¼Œæ¡†ä¸­æ˜¯æ‰€æœ‰çš„ç»“æœï¼Œä½†æ¨ªçº¿å¤„æ˜¯æˆ‘ä»¬è‡ªåŠ¨é…ç½®éœ€è¦çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190709224422.png" alt="Debugx"></p><p>ç»“æœåœ¨<strong>FACTORIES_RESOURCE_LOCATION</strong>ï¼ˆ<code>META-INF/spring.factories</code>ï¼‰ä¸­å¯ä»¥æ‰¾åˆ°.</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190709225333.png" alt="factory"></p><p>è¿™é‡Œçš„æ‰€æœ‰ç±»éƒ½æ˜¯å¯ä»¥è‡ªåŠ¨é…ç½®åˆ°Springçš„å®¹å™¨ä¸­ã€‚</p><h3 id="å¦‚ä½•æ ¹æ®è‡ªåŠ¨é…ç½®ç±»é…ç½®å±æ€§"><a href="#å¦‚ä½•æ ¹æ®è‡ªåŠ¨é…ç½®ç±»é…ç½®å±æ€§" class="headerlink" title="å¦‚ä½•æ ¹æ®è‡ªåŠ¨é…ç½®ç±»é…ç½®å±æ€§"></a>å¦‚ä½•æ ¹æ®è‡ªåŠ¨é…ç½®ç±»é…ç½®å±æ€§</h3><p>è¿›å…¥åˆ°<code>spring.factories</code>ä¸­è¿›è¡ŒæŸ¥çœ‹æ‰€æœ‰autoConfigureç±»ï¼Œç”¨CacheAutoConfigurationä¸¾ä¾‹ï¼Œæ¥åˆ†æä»¥åæƒ³è¦é…ç½®å…³äºcacheçš„å±æ€§ï¼Œæ€ä¹ˆæŸ¥æ‰¾åˆ°è¿™ä¸ªé…ç½®å±æ€§ï¼Œæ€ä¹ˆé…ç½®åˆ°propertiesæ–‡ä»¶ä¸­ã€‚</p><p>ç›´æ¥ç‚¹è¿›ç±»ä¸­å‘ç°æœ‰å¾ˆå¤šæ³¨è§£ï¼Œä¸€ä¸ªä¸ªçœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¡¨ç¤ºä¸€ä¸ªé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// ä»…å½“classpathä¸­å­˜åœ¨ç‰¹å®šçš„CacheManagerç±»æ—¶åŒ¹é…</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(CacheManager.class)</span><br><span class="line"><span class="comment">// å¦‚æœSpring å®¹å™¨ä¸­å­˜åœ¨CacheAspectSupport</span></span><br><span class="line"><span class="meta">@ConditionalOnBean</span>(CacheAspectSupport.class)</span><br><span class="line"><span class="comment">//å¦‚æœSpringå®¹å™¨ä¸æ»¡è¶³beançš„nameä¸ºcacheResolverï¼Œvalueä¸ºCacheMaager</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(value = CacheManager.class, name = <span class="string">"cacheResolver"</span>)</span><br><span class="line"><span class="comment">// å¼€å¯è‡ªåŠ¨é…ç½®å±æ€§ï¼ŒæŒ‡å‘ CachePropertiesç±»</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(CacheProperties.class)</span><br><span class="line"><span class="meta">@AutoConfigureAfter</span>(&#123; CouchbaseAutoConfiguration.class, HazelcastAutoConfiguration.class,</span><br><span class="line">HibernateJpaAutoConfiguration.class, RedisAutoConfiguration.class &#125;)</span><br><span class="line"><span class="comment">// ç¼“å­˜é…ç½®çš„é€‰æ‹©å™¨</span></span><br><span class="line"><span class="meta">@Import</span>(CacheConfigurationImportSelector.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheAutoConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­EnableConfigtionPropertiesæ³¨è§£ç”¨æ¥å¼€å¯é…ç½®å±æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// spring.cacheå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨çš„å‰ç¼€</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.cache"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheProperties</span> </span>&#123;</span><br><span class="line"><span class="comment">// ä»¥ä¸‹å°±æ˜¯å„å±æ€§å€¼ </span></span><br><span class="line"><span class="keyword">private</span> CacheType type;</span><br><span class="line"><span class="keyword">private</span> List&lt;String&gt; cacheNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Caffeine caffeine = <span class="keyword">new</span> Caffeine();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Couchbase couchbase = <span class="keyword">new</span> Couchbase();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> EhCache ehcache = <span class="keyword">new</span> EhCache();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Redis redis = <span class="keyword">new</span> Redis();</span><br></pre></td></tr></table></figure><p>ç”¨cacheä¸­çš„rediså¯¹è±¡ä¸ºä¾‹å­ï¼Œå¦‚ä½•å»é…ç½®redisç¼“å­˜ã€‚</p><p>å…¶ä¸­æŒ‡å®šäº†å‰ç¼€ï¼Œå’Œä¸­é—´çš„rediså¯¹è±¡ï¼Œæ‰€ä»¥redisçš„é…ç½®ä¸­çš„å±æ€§å°±åº”è¯¥æ˜¯<code>spring.cache.redis.xxx</code>.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Redis</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Duration timeToLive;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> cacheNullValues = <span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">private</span> String keyPrefix;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> useKeyPrefix = <span class="keyword">true</span>;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚éœ€è¦é…ç½®ä¸å…è®¸redisç¼“å­˜ç©ºå€¼ï¼Œå°±éœ€è¦é…ç½®cacheNullValueså±æ€§ï¼Œæ‰€ä»¥å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å†™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.redis.chcheNullValues=false</span><br></pre></td></tr></table></figure><p>å…¶ä»–ç±»å‹çš„è‡ªåŠ¨é…ç½®ç±»åŒç†ï¼Œæ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»éƒ½é…å¤‡ä¸€ä¸ª<code>xxxProperties.class</code>ç±»è¿›è¡Œå±æ€§çš„åŒ¹é…,æ‰€ä»¥å¦‚æœéœ€è¦æŸä¸ªå±æ€§ï¼Œåˆ™ç›´æ¥å‘å¯¹åº”çš„ç±»ä¸­æŸ¥æ‰¾ï¼Œæ‰¾å‡ºå‰ç¼€å’Œå±æ€§åï¼Œåˆ™å¯ç›´æ¥æ‰¾å‡ºå®Œæˆçš„é…ç½®åç§°ã€‚</p><p>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œåœ¨ä¹Ÿä¸ç”¨æ‹…å¿ƒè¯¥å¦‚ä½•é…ç½®é…ç½®æ–‡ä»¶äº†ã€‚</p><h4 id="è‡ªå®šä¹‰SpringBoot-Starterå®ç°è‡ªåŠ¨é…ç½®"><a href="#è‡ªå®šä¹‰SpringBoot-Starterå®ç°è‡ªåŠ¨é…ç½®" class="headerlink" title="è‡ªå®šä¹‰SpringBoot Starterå®ç°è‡ªåŠ¨é…ç½®"></a>è‡ªå®šä¹‰<code>SpringBoot Starter</code>å®ç°è‡ªåŠ¨é…ç½®</h4><p>å¦‚æœè‡ªè¡Œè¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚ä¸»è¦å®ç°çš„æ–‡ä»¶æ˜¯ï¼š</p><ul><li><code>xxxxAutoConfiguration</code>ç±»</li><li><code>xxxxProperties</code>ç±»</li><li><code>resources/META-INF/</code> ä¸‹çš„ <code>spring.factories</code> æ–‡ä»¶ä¸­æ·»åŠ ï¼š<code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.example.autocinfigure.xxxxAutoConfigure</code></li></ul><p>åœ¨åˆ›å»ºè‡ªåŠ¨é…ç½®åŒ…å‰éœ€è¦åœ¨pomæ–‡ä»¶ä¸­æ·»åŠ è‡ªåŠ¨é…ç½®çš„åŒ…ä¾èµ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŠ è½½çš„åŸºæœ¬è¿‡ç¨‹ï¼š</p><ol><li>Spring Bootåœ¨å¯åŠ¨æ—¶æ‰«æé¡¹ç›®æ‰€ä¾èµ–çš„JARåŒ…ï¼Œå¯»æ‰¾åŒ…å«spring.factoriesæ–‡ä»¶çš„JARåŒ…</li><li>æ ¹æ®spring.factoriesé…ç½®åŠ è½½AutoConfigureç±»</li><li>æ ¹æ® @Conditionalæ³¨è§£çš„æ¡ä»¶ï¼Œè¿›è¡Œè‡ªåŠ¨é…ç½®å¹¶å°†Beanæ³¨å…¥Spring Context</li></ol>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootæ·±å…¥è‡ªåŠ¨é…ç½®</title>
      <link href="/2019/07/07/2019-07-04-SpringBoot%E6%B7%B1%E5%85%A5%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE/"/>
      <url>/2019/07/07/2019-07-04-SpringBoot%E6%B7%B1%E5%85%A5%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootæ·±å…¥è‡ªåŠ¨é…ç½®"><a href="#SpringBootæ·±å…¥è‡ªåŠ¨é…ç½®" class="headerlink" title="SpringBootæ·±å…¥è‡ªåŠ¨é…ç½®"></a>SpringBootæ·±å…¥è‡ªåŠ¨é…ç½®</h1><h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h2><p>åœ¨ä¸Šä¸€ç¯‡<a href="https://nanyiniu.github.io/2019/07/06/2019-07-03-SpringBootä¸å¾®æœåŠ¡ç®€ä»‹/">Spring Bootä¸å¾®æœåŠ¡åŸºæœ¬ä»‹ç»</a>ä¸­ï¼Œä»‹ç»äº†åˆ›å»ºmavené¡¹ç›®åˆ°è¿è¡Œspringbootçš„åŸºæœ¬è¿‡ç¨‹ã€‚ </p><p>å…¶ä¸­ä½¿ç”¨ä¸»ç¨‹åºæ¥å¯åŠ¨<code>SpringBoot</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeepSpringBootApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨SpringApplication.runæ–¹æ³•æ¥å¯åŠ¨spring bootåº”ç”¨ å…¶ä¸­å‚æ•°æœ‰ç±»å’Œargs</span></span><br><span class="line">        SpringApplication.run(DeepSpringBootApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»…ä»…æ˜¯æ·»åŠ äº†ä¸€ä¸ª<code>@SpringBootApplication</code>æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼ŒåŸç†æ˜¯ä»€ä¹ˆï¼Œæ¥ä¸‹æ¥å°±é€šè¿‡æºç ç®€å•çœ‹ä¸€ä¸‹ã€‚</p><h2 id="SpringBootApplicationå¯åŠ¨æ³¨è§£"><a href="#SpringBootApplicationå¯åŠ¨æ³¨è§£" class="headerlink" title="SpringBootApplicationå¯åŠ¨æ³¨è§£"></a>SpringBootApplicationå¯åŠ¨æ³¨è§£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç‚¹å¼€@SpringBootApplicationæºç </span></span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(excludeFilters = &#123; <span class="meta">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="line"><span class="meta">@Filter</span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br><span class="line">    <span class="comment">/** AliasForæ³¨è§£çš„ä½œç”¨æ˜¯ä¸ºäº†å£°æ˜åˆ«å</span></span><br><span class="line"><span class="comment">      * AliasForåœ¨ä¸‹é¢ä»£ç ä¸­çš„ä½œç”¨å°±æ˜¯é€šè¿‡åˆ«åå¼•ç”¨åœ¨annotatinæŒ‡å®šçš„ç±»çš„ç‰¹å®šæ–¹æ³•</span></span><br><span class="line"><span class="comment">      * å¦‚æœæœ‰å…´è¶£å¯ä»¥å‚è€ƒAliasForçš„å®˜æ–¹æ–‡æ¡£ </span></span><br><span class="line"><span class="comment">      * https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/annotation/AliasFor.html</span></span><br><span class="line"><span class="comment">      * æ¯”å¦‚è¿™é‡Œå°±ä¼šæŒ‡å®š EnableAutoConfigurationçš„excludeæ–¹æ³•</span></span><br><span class="line"><span class="comment">      **/</span></span><br><span class="line"><span class="meta">@AliasFor</span>(annotation = EnableAutoConfiguration.class)</span><br><span class="line">Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// ã€‚ã€‚ã€‚å…¶ä»–çš„çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„<code>@SpringBootApplication</code>æºç ä¸­ï¼Œå…¶ä¸­ä½¿ç”¨åˆ°äº†ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„åŸºæœ¬æ³¨è§£<code>@SpringBootConfiguration</code>ã€<code>@EnableAutoConfiguration</code>å’Œ<code>@ComponentScan</code>ã€‚ä¸‹é¢åˆ†åˆ«æ¥å¯¹è¿™ä¸‰ä¸ªæ³¨è§£è¿›è¡Œç®€å•åˆ†æã€‚</p><h3 id="SpringBootConfiguration"><a href="#SpringBootConfiguration" class="headerlink" title="SpringBootConfiguration"></a>SpringBootConfiguration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æ ‡ç¤ºæ˜¯ä¸€ä¸ªspring bootåº”ç”¨çš„é…ç½®ç±»ï¼Œç”¨ä½œ <span class="doctag">@Configuratio</span>çš„æ›¿ä»£å“</span></span><br><span class="line"><span class="comment">  * ä»¥ä¾¿è‡ªåŠ¨æ‰¾åˆ°é…ç½®</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootConfiguration &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…¶å®è¿™æ—¶<code>SpringBoot</code>å¯¹<code>Spring</code>çš„<code>@Configuration</code>çš„æ³¨è§£çš„åŒ…è£…</strong></p><h4 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Configuration &#123;</span><br><span class="line"><span class="meta">@AliasFor</span>(annotation = Component.class)</span><br><span class="line"><span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•ç†è§£ä¸ºï¼ŒConfiguration æ³¨è§£ä¸Šæ ‡æ³¨äº†@ComponentåŸæ³¨è§£ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯ä¸€ä¸ªspringç»„ä»¶ï¼Œä¼šé€šè¿‡æ‰«ææŠŠæ ‡å¿—è¿™ä¸ªæ³¨è§£çš„ç±»ä½œä¸ºspringçš„é…ç½®ç±»åŠ è½½åˆ°å®¹å™¨ä¸­ã€‚</p><p>å®é™…ä¸ŠåŠ è½½Configurationçš„æ–¹æ³•æœ‰ä¸‰ç§ï¼Œè‡ªåŠ¨æ‰«æé…ç½®ç±»åªæ˜¯å…¶ä¸­çš„ä¸€ç§ï¼Œå…¶ä»–ä¸¤ç§æ˜¯</p><ol><li>é€šè¿‡AnnotationConfigApplicationContextç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> MyBean <span class="title">myBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// instantiate, configure and return bean ...</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line"><span class="comment">// æ³¨å†ŒBean</span></span><br><span class="line">ctx.register(AppConfig.class);</span><br><span class="line">ctx.refresh();</span><br><span class="line">MyBean myBean = ctx.getBean(MyBean.class);</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨xmlé…ç½®æ–‡ä»¶,å°†æ ‡æ³¨ä¸º@Configurationçš„ç±»ä½œä¸ºä¸€ä¸ªbeanæ¥å£°æ˜åœ¨xmlæ–‡ä»¶ä¸­ã€‚</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.acme.AppConfig"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ ‡è®°@Configurationæ³¨è§£çš„ç±»è¡¨ç¤ºè¿™ä¸ªç±»ä¸­å£°æ˜äº†ä¸€ä¸ªæˆ–å¤šä¸ª@Beanæ–¹æ³•ï¼Œå¯ä»¥äº¤ç”±springå®¹å™¨å¤„ç†ã€‚å¯ä»¥åœ¨è¿è¡Œæ—¶ç”Ÿæˆbeanå®šä¹‰å’Œbeanä¹‹é—´çš„æœåŠ¡è¯·æ±‚ã€‚</p><p>æ›´åŠ è¯¦ç»†çš„å‚è€ƒ<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html" target="_blank" rel="noopener">Springå®˜ç½‘Configurationæ³¨è§£</a></p><h3 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="EnableAutoConfiguration"></a>EnableAutoConfiguration</h3><p>EnableAutoConfigurationæ˜¯spring bootä¸­çš„æ³¨è§£ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯çŒœæµ‹å¹¶è‡ªåŠ¨é…ç½®å¯èƒ½éœ€è¦çš„bean,ä¹Ÿå°±æ˜¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import</span>(AutoConfigurationImportSelector.class)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">String ENABLED_OVERRIDE_PROPERTY = <span class="string">"spring.boot.enableautoconfiguration"</span>;</span><br><span class="line">Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­é‡è¦çš„ä¸¤ä¸ªæ³¨è§£<code>@AutoConfigurationPackage</code>å’Œ<code>@Import</code>ä¸­çš„å†…å®¹</p><h4 id="AutoConfigurationPackage"><a href="#AutoConfigurationPackage" class="headerlink" title="AutoConfigurationPackage"></a>AutoConfigurationPackage</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ‡æ³¨@AutoConfigurationPackageçš„æ³¨è§£å¯ä»¥ä½¿ç”¨Registrarè¿›è¡Œæ³¨å†Œ</span></span><br><span class="line"><span class="comment">// @Importçš„ä½œç”¨å°±æ˜¯å¼•ç”¨é…ç½®ç±»ï¼Œå°†å¤šä¸ªé…ç½®ç±»æ”¾åˆ°ä¸€ä¸ªä¸»é…ç½®ä¸­</span></span><br><span class="line"><span class="meta">@Import</span>(AutoConfigurationPackages.Registrar.class)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œæ–¹æ³•</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Registrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span>, <span class="title">DeterminableImports</span> </span>&#123;</span><br><span class="line"><span class="comment">// æ³¨å†Œbeanå®šä¹‰ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„packageNameæ˜¯æ ‡æ³¨è¿™ä¸ªæ³¨è§£çš„ç±»çš„åŒ…çš„è·¯å¾„åç§°ï¼Œå¦‚ä¸‹å›¾</span></span><br><span class="line">        register(registry, <span class="keyword">new</span> PackageImport(metadata).getPackageName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">determineImports</span><span class="params">(AnnotationMetadata metadata)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singleton(<span class="keyword">new</span> PackageImport(metadata));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190705181000.png" alt="debug1"></p><p>å°†ä¸»é…ç½®ç±»çš„æ‰€åœ¨çš„åŒ…åŠä¸‹é¢çš„æ‰€æœ‰å­åŒ…æ‰«æåˆ°Springå®¹å™¨ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥ç¼–ç¨‹æ–¹å¼æ³¨å†Œè‡ªåŠ¨é…ç½®åŒ…åç§°.å°†ç»™å®šçš„åŒ…ã€è¿™é‡Œçš„æ˜¯com.nanyin ã€‘æ³¨å†Œæ·»åŠ åˆ°å·²ç»æ³¨å†Œçš„åŒ…åç§°ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(BeanDefinitionRegistry registry, String... packageNames)</span> </span>&#123;</span><br><span class="line"><span class="comment">// private static final String BEAN = AutoConfigurationPackages.class.getName();</span></span><br><span class="line">    <span class="keyword">if</span> (registry.containsBeanDefinition(BEAN)) &#123;</span><br><span class="line">        BeanDefinition beanDefinition = registry.getBeanDefinition(BEAN);</span><br><span class="line">        ConstructorArgumentValues constructorArguments = beanDefinition.getConstructorArgumentValues();</span><br><span class="line">        constructorArguments.addIndexedArgumentValue(<span class="number">0</span>, addBasePackages(constructorArguments, packageNames));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="comment">//  ä½¿ç”¨æ ‡å‡†çš„ç±»å®šä¹‰ GenericBeanDefinition æ³¨å†Œbean</span></span><br><span class="line">        GenericBeanDefinition beanDefinition = <span class="keyword">new</span> GenericBeanDefinition();</span><br><span class="line">        beanDefinition.setBeanClass(BasePackages.class);</span><br><span class="line">        beanDefinition.getConstructorArgumentValues().addIndexedArgumentValue(<span class="number">0</span>, packageNames);</span><br><span class="line">        beanDefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line">        <span class="comment">// æ³¨å†Œbean</span></span><br><span class="line">        registry.registerBeanDefinition(BEAN, beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Import-AutoConfigurationImportSelector-class"><a href="#Import-AutoConfigurationImportSelector-class" class="headerlink" title="@Import(AutoConfigurationImportSelector.class)"></a>@Import(AutoConfigurationImportSelector.class)</h4><p>è‡ªåŠ¨å¯¼å…¥ç»„ä»¶çš„é€‰æ‹©å™¨ã€‚å°†éœ€è¦å¯¼å…¥çš„ç»„ä»¶ä»¥å…¨ç±»åçš„æ–¹å¼è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(AnnotationMetadata annotationMetadata, DeferredImportSelector deferredImportSelector)</span> </span>&#123; Assert.state(deferredImportSelector <span class="keyword">instanceof</span> AutoConfigurationImportSelector,</span><br><span class="line">            () -&gt; String.format(<span class="string">"Only %s implementations are supported, got %s"</span>,</span><br><span class="line">                    AutoConfigurationImportSelector.class.getSimpleName(),</span><br><span class="line">                    deferredImportSelector.getClass().getName()));</span><br><span class="line">                    <span class="comment">//è·å–è‡ªåŠ¨å¯¼å…¥çš„å†…å®¹çš„å…¨ç±»åï¼Œåœ¨è¿™ä¸€æ­¥è¿›è¡Œdebugè§ä¸‹å›¾</span></span><br><span class="line">    AutoConfigurationEntry autoConfigurationEntry = ((AutoConfigurationImportSelector) deferredImportSelector)</span><br><span class="line">            .getAutoConfigurationEntry(getAutoConfigurationMetadata(), annotationMetadata);</span><br><span class="line">    <span class="keyword">this</span>.autoConfigurationEntries.add(autoConfigurationEntry);</span><br><span class="line">    <span class="keyword">for</span> (String importClassName : autoConfigurationEntry.getConfigurations()) &#123;</span><br><span class="line">        <span class="keyword">this</span>.entries.putIfAbsent(importClassName, annotationMetadata);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç ä¸­æ–­ç‚¹å¾—å‡ºçš„è‡ªåŠ¨å¯¼å…¥çš„åŒ…åç§°ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190706220846.png" alt="ä»£ç å¯¼å…¥1"></p><p>é€šè¿‡æ–¹æ³•getConstructorArgumentValueså¾—åˆ°è‡ªåŠ¨é…ç½®çš„åŒ…çš„åç§°ï¼Œè°ƒç”¨äº†SpringFactoriesLoaderçš„æ–¹æ³•ï¼Œå…¶ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> List&lt;String&gt; <span class="title">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;</span><br><span class="line">List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(),</span><br><span class="line">getBeanClassLoader());</span><br><span class="line">Assert.notEmpty(configurations, <span class="string">"No auto configuration classes found in META-INF/spring.factories. If you "</span></span><br><span class="line">+ <span class="string">"are using a custom packaging, make sure that file is correct."</span>);</span><br><span class="line"><span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨loadFactoryNamesè·å¾—ä¸€ç»„åŒ…åç§°</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, @Nullable ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">String factoryClassName = factoryClass.getName();</span><br><span class="line"><span class="keyword">return</span> loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åé€šè¿‡æ–‡ä»¶ä¸­spring.factorysæ–‡ä»¶ä¸­çš„å†…å®¹æ¥è·å–æœ€ç»ˆçš„è‡ªåŠ¨å¯¼å…¥è‡ªåŠ¨é…ç½®ç±»åŒ…èŒƒå›´ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190706221723.png" alt="å¯¼å…¥"></p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190706222017.png" alt="å¯¼å…¥åŒ…å†…å®¹"></p><h2 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="ComponentScan"></a>ComponentScan</h2><p>ç»„ä»¶æ‰«ææŒ‡ä»¤ï¼Œéœ€è¦ä¸@Configurationä¸€èµ·ä½¿ç”¨ã€‚ä¸Springæä¾›çš„xmlé…ç½®<code>&lt;context:component-scan&gt;</code>ä½œç”¨ç›¸åŒã€‚</p><p>åœ¨SpringBootApplicationæ³¨è§£ä¸­æ˜¯è¿™æ ·å®šä¹‰ComponentScançš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(excludeFilters = &#123; </span><br><span class="line"><span class="meta">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="line"><span class="meta">@Filter</span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>excludeFiltersçš„ä½œç”¨æ˜¯æŒ‡å®šå“ªäº›ç±»å‹ä¸ç¬¦åˆç»„ä»¶æ‰«æçš„æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ’é™¤æ‰æŒ‡å®šçš„ç±»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootä¸­ä½¿ç”¨é…ç½®</title>
      <link href="/2019/07/07/2019-07-06-SpringBoot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"/>
      <url>/2019/07/07/2019-07-06-SpringBoot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootä¸­ä½¿ç”¨é…ç½®"><a href="#SpringBootä¸­ä½¿ç”¨é…ç½®" class="headerlink" title="SpringBootä¸­ä½¿ç”¨é…ç½®"></a>SpringBootä¸­ä½¿ç”¨é…ç½®</h1><h2 id="ä¸€ã€é…ç½®æ–‡ä»¶"><a href="#ä¸€ã€é…ç½®æ–‡ä»¶" class="headerlink" title="ä¸€ã€é…ç½®æ–‡ä»¶"></a>ä¸€ã€é…ç½®æ–‡ä»¶</h2><p>SpringBootä½¿ç”¨å…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„</p><ul><li>application.properties</li><li>application.yml</li></ul><p>ä½¿ç”¨é…ç½®æ–‡ä»¶å¯ä»¥æ›´æ”¹ç³»ç»Ÿè‡ªåŠ¨é…ç½®çš„é»˜è®¤å€¼ï¼Œæ¯”å¦‚ç«¯å£å·ç­‰ä¿¡æ¯ã€‚</p><h3 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h3><p>yamlä»¥æ•°æ®ä¸ºä¸­å¿ƒï¼Œæ¯”xmlï¼Œjsonæ›´é€‚åˆåšé…ç½®æ–‡ä»¶ã€‚</p><h4 id="YAMLä¸propertieså¯¹æ¯”"><a href="#YAMLä¸propertieså¯¹æ¯”" class="headerlink" title="YAMLä¸propertieså¯¹æ¯”"></a>YAMLä¸propertieså¯¹æ¯”</h4><p>YAML:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><p>properties:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.port: 8080</span><br></pre></td></tr></table></figure><h4 id="YAMLè¯­æ³•"><a href="#YAMLè¯­æ³•" class="headerlink" title="YAMLè¯­æ³•"></a>YAMLè¯­æ³•</h4><ol><li>åŸºæœ¬è¯­æ³•</li></ol><p>k : v è¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹ ã€Œä¸­é—´éœ€è¦æœ‰ç©ºæ ¼ã€ï¼Œä»¥ç©ºæ ¼çš„ç¼©ç´§æ¥è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œä½¿ç”¨å·¦å¯¹å…¶çš„æ•°æ®éƒ½æ˜¯ä¸€ä¸ªå±‚çº§çš„ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢ä»£ç ä¸­çš„portå’Œpathæ˜¯ä¸€ä¸ªå±‚çº§çš„ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/hello</span></span><br></pre></td></tr></table></figure><ol start="2"><li>å€¼çš„å†™æ³•</li></ol><ul><li>å­—é¢é‡</li></ul><p>key : value å­—é¢é‡ç›´æ¥å†™ï¼Œå¹¶ä¸”å­—ç¬¦ä¸²ä¸éœ€è¦æ·»åŠ å¼•å·ï¼Œç±»ä¼¼propertiesã€‚å¦‚æœæ·»åŠ å¼•å·ä¼šæœ‰ç‰¹æ®Šçš„æ„ä¹‰ã€‚</p><p>åŒå¼•å·ï¼š ä¸ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦<br>å•å¼•å·ï¼š ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œæœ€ç»ˆä¼šè½¬ä¹‰æˆæ™®é€šçš„å­—ç¬¦ä¸²è¾“å‡º</p><ul><li><p>å¯¹è±¡</p><ol><li><p>éè¡Œå†…å†™æ³• -&gt;  key : value å¯¹è±¡ä¸€æ ·æŒ‰ç…§keyï¼Œvalueæ¥å†™</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line"><span class="attr">       firstName:</span> <span class="string">zhang</span></span><br><span class="line"><span class="attr">       lastName:</span> <span class="string">san</span></span><br></pre></td></tr></table></figure></li><li><p>è¡Œå†…å†™æ³•</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span><span class="string">&#123;firstName:</span> <span class="string">zhang,lastName:</span> <span class="string">san&#125;</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p>æ•°ç»„ï¼ˆlistï¼Œsetï¼‰</p></li></ul><p>ä½¿ç”¨ - æ¥è¡¨ç¤ºæ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">person</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">zhangsan</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">lisi</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">wangwu</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨ymlé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®"><a href="#ä½¿ç”¨ymlé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®" class="headerlink" title="ä½¿ç”¨ymlé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®"></a>ä½¿ç”¨ymlé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®</h4><h5 id="ç¼–å†™beanå¯¹è±¡"><a href="#ç¼–å†™beanå¯¹è±¡" class="headerlink" title="ç¼–å†™beanå¯¹è±¡"></a>ç¼–å†™beanå¯¹è±¡</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * å¦‚æœéœ€è¦ä½¿ç”¨ConfigurationProperties è¿™ä¸ªæ³¨è§£éœ€è¦æ·»åŠ </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dependency&gt;</span></span><br><span class="line"><span class="comment"> * &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment"> * &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment"> * &lt;optional&gt;true&lt;/optional&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> nanyin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 16:29 2019-07-07</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨Lombokçš„dataæ³¨è§£å¯ä»¥è‡ªåŠ¨çš„é…ç½® setterï¼Œgetterï¼ŒtoStringå±æ€§ï¼Œ</span></span><br><span class="line"><span class="comment"> * ä½†æ˜¯éœ€è¦IDEçš„Lombokæ’ä»¶</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(value = <span class="string">"person"</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨configurationPropertisé…ç½®ç±»"><a href="#ä½¿ç”¨configurationPropertisé…ç½®ç±»" class="headerlink" title="ä½¿ç”¨configurationPropertisé…ç½®ç±»"></a>ä½¿ç”¨configurationPropertisé…ç½®ç±»</h5><p>æ ¹æ®beanå¯¹è±¡åœ¨application.ymlæ–‡ä»¶ä¸­ç¼–å†™å¦‚ä¸‹ymlå†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">zhangsan</span></span><br><span class="line"><span class="attr">    age:</span> <span class="number">12</span></span><br><span class="line"><span class="attr">    user:</span></span><br><span class="line"><span class="attr">        id:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨SpringBootçš„å•å…ƒæµ‹è¯•"><a href="#ä½¿ç”¨SpringBootçš„å•å…ƒæµ‹è¯•" class="headerlink" title="ä½¿ç”¨SpringBootçš„å•å…ƒæµ‹è¯•"></a>ä½¿ç”¨SpringBootçš„å•å…ƒæµ‹è¯•</h5><p>åœ¨æµ‹è¯•æ–‡ä»¶å¤¹ä¸‹å»ºç«‹<code>DeepSpringBootApplicationTest</code>æµ‹è¯•ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨springçš„æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨springçš„æ³¨å…¥åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œçš„runWithæ³¨è§£è¯´æ˜çš„æ˜¯è®©junitä½¿ç”¨Springçš„è¿è¡Œæµ‹è¯•æ–¹å¼</span></span><br><span class="line"><span class="comment"> * ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä½¿ç”¨springçš„æ³¨å…¥ç­‰ç‰¹æ€§</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> nanyin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 16:27 2019-07-07</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeepSpringBootApplicationTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Person person;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPerson</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(person.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦ä½¿ç”¨ä¸Šé¢çš„ä»£ç è¿›è¡ŒSpringBootçš„å•å…ƒæµ‹è¯•ï¼Œéœ€è¦åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åè¿è¡Œåˆšæ‰çš„æµ‹è¯•ç±»ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190707164406.png" alt="è¿è¡Œç»“æœ"></p><p>é€šè¿‡è¿è¡Œç»“æœå¯çŸ¥é“ï¼Œä½¿ç”¨application.ymlæ–‡ä»¶ç¼–å†™é…ç½®ä¿¡æ¯æˆåŠŸçš„æ”¾åˆ°Personè¿™ä¸ªç±»ä¸­ã€‚</p><h4 id="PropertySource"><a href="#PropertySource" class="headerlink" title="PropertySource"></a>PropertySource</h4><p>ä¸Šé¢ä½¿ç”¨ymlæ–‡ä»¶ï¼Œé€šè¿‡configurationPropertiså¯¹Personè¿›è¡Œäº†é…ç½®ã€‚</p><p>configurationPropertiså®ƒä¼šä»å…¨å±€é…ç½®æ–‡ä»¶application.ymlé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ã€‚ä½†å¦‚æœæŒ‡å®šæŸä¸ªå…·ä½“é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®å‘¢ï¼Ÿ</p><p><strong>ç­”æ¡ˆæ˜¯PropertySourceæ³¨è§£</strong></p><ol><li><p>ä½¿ç”¨propertiesæ–‡ä»¶</p><p> åœ¨classpathè·¯å¾„ä¸‹æ–°å»ºè¦ä¸ª<code>person.properties</code>æ–‡ä»¶,æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼›</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">person.age= 12</span><br><span class="line">person.id= 2</span><br><span class="line">person.name=zhangsan</span><br></pre></td></tr></table></figure><p> åœ¨åŸæ¥çš„åŸºç¡€ä¸Šæ·»åŠ PropertySourceæ³¨è§£</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">// æŒ‡å®šä½¿ç”¨åˆ°çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œçš„valueå¯ä»¥æ˜¯æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">@PropertySource</span>(value=<span class="string">"classpath:person.properties"</span>)</span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(value = <span class="string">"person"</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> è¿è¡Œç»“æœå’Œä¸Šé¢æµ‹è¯•ç»“æœçš„ç›¸åŒã€‚</p></li><li><p>ä½¿ç”¨ymlæ–‡ä»¶</p><p> ä½¿ç”¨ymlæ–‡ä»¶ä½œä¸ºé…ç½®æ–‡ä»¶æ—¶ï¼Œä¸propertiesæ–‡ä»¶ç•¥æœ‰ä¸åŒï¼Œæ˜¯å› ä¸º<strong>PropertySourceå®é™…ä¸Šä¸Šé»˜è®¤æ˜¯ä¸æ”¯æŒyamlæ–‡ä»¶çš„</strong>ã€‚æ‰€ä»¥å¦‚æœä½¿ç”¨ymlæ–‡ä»¶å°±éœ€è¦ç•¥åŠ æ”¹é€ ã€‚ç»è¿‡ä¸€ç•ª<a href="https://mdeinum.github.io/2018-07-04-PropertySource-with-yaml-files/" target="_blank" rel="noopener">è°·æ­Œ</a>åã€‚</p><p> <code>PropertySourceFactory</code>æ˜¯spring 4.3ä¹‹åå‡ºç°çš„ä¸ºPropertySourceçš„å·¥å‚æ¥å£ï¼Œæ³¨è§£é»˜è®¤ä½¿ç”¨çš„æ˜¯<code>DefaultPropertySourceFactory</code>æ¥åˆ›å»º<code>ResourcePropertySource</code>å¯¹è±¡ã€‚</p><p> springé€šè¿‡<code>YamlPropertiesFactoryBean</code>æ¥åŠ è½½yamlæ–‡ä»¶ã€‚è¿™ä¸ªç±»å¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åŠ è½½ä¸º<code>java.util.Properties</code>å¯¹è±¡ã€‚</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.nanyin.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.YamlPropertiesFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.PropertiesPropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.EncodedResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PropertySourceFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YamlPropertiesFactory</span> <span class="keyword">implements</span> <span class="title">PropertySourceFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PropertySource&lt;?&gt; createPropertySource(<span class="meta">@Nullable</span> String name, EncodedResource resource) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Properties propertiesFromYaml = loadYamlIntoProperties(resource);</span><br><span class="line">        String sourceName = name != <span class="keyword">null</span> ? name : resource.getResource().getFilename();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PropertiesPropertySource(sourceName, propertiesFromYaml);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Properties <span class="title">loadYamlIntoProperties</span><span class="params">(EncodedResource resource)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            YamlPropertiesFactoryBean factory = <span class="keyword">new</span> YamlPropertiesFactoryBean();</span><br><span class="line">            factory.setResources(resource.getResource());</span><br><span class="line">            factory.afterPropertiesSet();</span><br><span class="line">            <span class="keyword">return</span> factory.getObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">            <span class="comment">// for ignoreResourceNotFound</span></span><br><span class="line">            Throwable cause = e.getCause();</span><br><span class="line">            <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> FileNotFoundException)</span><br><span class="line">                <span class="keyword">throw</span> (FileNotFoundException) e.getCause();</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> å®ç°ä¸Šè¿°ä»£ç åï¼Œåœ¨é…ç½®ç±»ä¸­çš„PropertySourceä¸­æ·»åŠ <code>factory</code></p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource</span>(value=&#123;<span class="string">"classpath:person.yml"</span>&#125;,</span><br><span class="line">                factory = YamlPropertiesFactory.class)</span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"person"</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> yamlæ–‡ä»¶æ–‡ä»¶ä¸­çš„å†…å®¹.å…¶ä¸­<strong>ä½¿ç”¨<code>${xxx}</code>çš„ç»“æ„å¯ä»¥è°ƒç”¨å…¶ä»–å±æ€§çš„å€¼</strong>ï¼Œè¿™é‡Œuserçš„idå€¼å°±æ˜¯ç›´æ¥ä½¿ç”¨personçš„idå€¼ã€‚</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line"><span class="attr">    age:</span> <span class="number">12</span></span><br><span class="line"><span class="attr">    id:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">zhangsan</span></span><br><span class="line"><span class="attr">    user:</span></span><br><span class="line"><span class="attr">        id:</span> <span class="string">$&#123;person.id&#125;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="äºŒã€é…ç½®ç±»"><a href="#äºŒã€é…ç½®ç±»" class="headerlink" title="äºŒã€é…ç½®ç±»"></a>äºŒã€é…ç½®ç±»</h2><p>åœ¨åŸæ¥ä½¿ç”¨Springæ—¶ï¼Œç¹å¤šçš„xmlè®©äººå¤´ç–¼ã€‚è€Œåœ¨SpringBootä¸­ï¼Œæ¨èä½¿ç”¨ç±»çš„æ–¹å¼ä»£æ›¿xmlç­‰é…ç½®æ–‡ä»¶ï¼Œæ”¹ç”¨æ³¨è§£çš„æ–¹å¼ã€‚</p><ol><li><p>åˆ›å»ºä¸€ä¸ªç±»ï¼Œç±»åä¸º<code>MyConfig</code></p></li><li><p>ä¸ºç±»æ ‡æ³¨ä¸º<code>@Configuration</code></p></li><li><p>å°†éœ€è¦å¼•å…¥åˆ°å®¹å™¨ä¸­çš„beanä½œä¸ºè¿”å›å€¼å†™åˆ°æ–¹æ³•ä¸­ï¼Œå…¶ä¸­æ–¹æ³•çš„åç§°å°±æ˜¯å®¹å™¨ä¸­beançš„åç§°ã€‚</p></li><li><p>è¿›è¡Œæµ‹è¯•ï¼Œå®¹å™¨ä¸­åŠ è½½åˆ°äº†è¿™ä¸ªé…ç½®ç±»ä¸­é…ç½®çš„bean</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ‡æ³¨@Configurationæ³¨è§£ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯Springçš„é…ç½®ç±»ï¼Œç”¨æ¥ä»£æ›¿é…ç½®æ–‡ä»¶å¦‚ xxx.xml</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Person person;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * ä½¿ç”¨<span class="doctag">@bean</span>æ³¨è§£å‘å®¹å™¨ä¸­æ·»åŠ beanï¼Œç”¨æ¥æ›¿ä»£åŸæ¥xmlé…ç½®æ–‡ä»¶ä¸­çš„</span></span><br><span class="line"><span class="comment">      *&lt;beans&gt;</span></span><br><span class="line"><span class="comment">      * &lt;context:annotation-config/&gt;</span></span><br><span class="line"><span class="comment">      * &lt;bean class="com.acme.AppConfig"/&gt;</span></span><br><span class="line"><span class="comment">      *&lt;/beans&gt;</span></span><br><span class="line"><span class="comment">      * å…¶ä¸­æ–¹æ³•çš„è¿”å›å€¼æ˜¯æ·»åŠ åˆ°å®¹å™¨ä¸­çš„å†…å®¹</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">helloService</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// å¯ä»¥ä½¿ç”¨personçš„é…ç½®å€¼</span></span><br><span class="line">        System.out.println(<span class="string">"åŠ è½½MyConfigé…ç½®æ–‡ä»¶ï¼ï¼ï¼ å…¶ä¸­é…ç½®æ–‡ä»¶ä¸­çš„ name å±æ€§ï¼š"</span> + person.getName());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HelloService() ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SpringBootæµ‹è¯•</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeepSpringBootApplicationTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ApplicationContext ctx;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testContainsBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(ctx.containsBean(<span class="string">"helloService"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†<code>HelloService</code>æ‰‹åŠ¨é€šè¿‡é…ç½®ç±»çš„æ–¹å¼æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Œä½œç”¨å’Œä½¿ç”¨xmlçš„æ–¹å¼ä¸€æ ·ï¼Œä½†æ˜¯æ›´ç®€å•ï¼Œæ›´å®¹æ˜“çœ‹æ‡‚ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190707181447.png" alt="ç»“æœ"></p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootä¸å¾®æœåŠ¡ç®€ä»‹</title>
      <link href="/2019/07/06/2019-07-03-SpringBoot%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AE%80%E4%BB%8B/"/>
      <url>/2019/07/06/2019-07-03-SpringBoot%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootä¸å¾®æœåŠ¡ç®€ä»‹"><a href="#SpringBootä¸å¾®æœåŠ¡ç®€ä»‹" class="headerlink" title="SpringBootä¸å¾®æœåŠ¡ç®€ä»‹"></a>SpringBootä¸å¾®æœåŠ¡ç®€ä»‹</h1><p>SpringBooté€šè¿‡æ•´åˆSpringçš„å„ä¸ªæŠ€æœ¯æ ˆç”¨æ¥ç®€åŒ–Springåº”ç”¨å¼€å‘ï¼Œä½¿ç”¨çº¦å®šå¤§äºé…ç½®çš„æ€æƒ³ã€‚ç®€å•å¿«é€Ÿçš„åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ï¼Œäº§å“çº§çš„åº”ç”¨ã€‚</p><h2 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol><li><p>å¿«é€Ÿåˆ›å»ºç‹¬ç«‹è¿è¡Œçš„Springé¡¹ç›®ä¸å„å¤§ä¸»æµæ¡†æ¶çš„é›†æˆã€‚</p></li><li><p>è‡ªå¸¦åµŒå…¥å¼çš„servletå®¹å™¨ã€‚</p></li><li><p>springbootå¸¦æœ‰startersè‡ªåŠ¨ä¾èµ–ä¸ç‰ˆæœ¬æ§åˆ¶ã€‚</p></li><li><p>å¤§é‡çš„è‡ªåŠ¨é…ç½®ï¼Œçº¦å®šå¤§äºé…ç½®ã€‚</p></li><li><p>æ— éœ€é…ç½®xmlï¼Œå‘Šåˆ«å¤§é‡çš„xmlæ–‡ä»¶ã€‚</p></li></ol><h3 id="springbootçš„hello-world"><a href="#springbootçš„hello-world" class="headerlink" title="springbootçš„hello world"></a>springbootçš„hello world</h3><h4 id="åˆ›å»ºä¸€ä¸ªmavenåº”ç”¨"><a href="#åˆ›å»ºä¸€ä¸ªmavenåº”ç”¨" class="headerlink" title="åˆ›å»ºä¸€ä¸ªmavenåº”ç”¨"></a>åˆ›å»ºä¸€ä¸ªmavenåº”ç”¨</h4><ol><li>åˆ›å»ºä¸€ä¸ªæ™®é€šçš„mavené¡¹ç›®</li></ol><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190704174954.png"><ol start="2"><li>åˆ›å»ºåçš„mavenç»“æ„ï¼ŒåŒ…å«pom.xmlæ–‡ä»¶å†…å®¹</li></ol><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190704175208.png"><ol start="3"><li>å¼€å¯ideaä¸­å¯¹mavençš„è‡ªåŠ¨å¯¼å…¥åŠŸèƒ½</li></ol><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190704175420.png"><h4 id="åœ¨POMæ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–"><a href="#åœ¨POMæ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–" class="headerlink" title="åœ¨POMæ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–"></a>åœ¨POMæ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- org.springframework.boot ä½œç”¨ï¼š</span></span><br><span class="line"><span class="comment">            1. é»˜è®¤ä½¿ç”¨javaç‰ˆæœ¬,é»˜è®¤ç¼–ç </span></span><br><span class="line"><span class="comment">            2. å¼•ç”¨ç®¡ç†çš„åŠŸèƒ½ï¼Œæ¯”å¦‚versionä¼šä»è¿™é‡Œç»§æ‰¿å‡ºå»</span></span><br><span class="line"><span class="comment">            3. è¯†åˆ«æ’ä»¶é…ç½®</span></span><br><span class="line"><span class="comment">            4. è¯†åˆ«.properties å’Œ.ymlé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">            5. æ•´ä½“çš„ç‰ˆæœ¬ä¾èµ–</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºåº”ç”¨ä¸»ç¨‹åº"><a href="#åˆ›å»ºåº”ç”¨ä¸»ç¨‹åº" class="headerlink" title="åˆ›å»ºåº”ç”¨ä¸»ç¨‹åº"></a>åˆ›å»ºåº”ç”¨ä¸»ç¨‹åº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * EnableAutoConfiguration è¡¨ç¤ºå‘Šè¯‰spring bootå¦‚ä½•å»é…ç½®springï¼Œ</span></span><br><span class="line"><span class="comment"> * å…¶å¯ä»¥å¸®åŠ© SpringBoot åº”ç”¨å°†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ <span class="doctag">@Configuration</span> é…ç½®éƒ½åŠ è½½åˆ°å½“å‰ IoC å®¹å™¨ä¹‹ä¸­</span></span><br><span class="line"><span class="comment"> * è‡ªä»æ·»åŠ spring-boot-starter-webè¿™ä¸ªstarteræ·»åŠ äº†tomcatå’Œspring MVCåï¼Œä½¿ç”¨è¯¥æ³¨è§£ï¼Œå°±è¯´æ˜ä½¿ç”¨springå¯åŠ¨ä¸€ä¸ªwebé¡¹ç›®</span></span><br><span class="line"><span class="comment"> * SpringBootApplication ç­‰åŒäºä½¿ç”¨<span class="doctag">@Configuration</span> <span class="doctag">@EnableAutoConfiguration</span> <span class="doctag">@ComponentScan</span>è¿™ä¸‰ä¸ªæ³¨è§£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> nanyin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 21:46 2019-07-04</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeepSpringBootApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨SpringApplication.runæ–¹æ³•æ¥å¯åŠ¨spring bootåº”ç”¨ å…¶ä¸­å‚æ•°æœ‰ç±»å’Œargs</span></span><br><span class="line">        SpringApplication.run(DeepSpringBootApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨SPringMvcç¼–å†™controllerå±‚"><a href="#ä½¿ç”¨SPringMvcç¼–å†™controllerå±‚" class="headerlink" title="ä½¿ç”¨SPringMvcç¼–å†™controllerå±‚"></a>ä½¿ç”¨SPringMvcç¼–å†™controllerå±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function">String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œä¸»ç¨‹åºè¿›è¡Œæµ‹è¯•"><a href="#è¿è¡Œä¸»ç¨‹åºè¿›è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œä¸»ç¨‹åºè¿›è¡Œæµ‹è¯•"></a>è¿è¡Œä¸»ç¨‹åºè¿›è¡Œæµ‹è¯•</h4><p>æ‰“å¼€<code>http://localhost:8080/hello</code> æŸ¥çœ‹ç½‘é¡µä¸Šçš„å†…å®¹æ˜¾ç¤ºå‡ºhello worldå­—ç¬¦ã€‚æµ‹è¯•æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190704223338.png" alt="æµ‹è¯•"></p><h4 id="å¯¼å…¥mavenæ’ä»¶æ‰“jaråŒ…"><a href="#å¯¼å…¥mavenæ’ä»¶æ‰“jaråŒ…" class="headerlink" title="å¯¼å…¥mavenæ’ä»¶æ‰“jaråŒ…"></a>å¯¼å…¥mavenæ’ä»¶æ‰“jaråŒ…</h4><p>åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¿å­˜ä¹‹åä½¿ç”¨<code>mvn package</code>å‘½ä»¤æ‰“æˆjaråŒ…ï¼Œå¯ä»¥åœ¨è¾“å‡ºä¿¡æ¯ä¸­æ‰¾å‡ºæ‰“å®Œçš„jaråŒ…çš„ä½ç½®ã€‚<br>ä½¿ç”¨<code>java -jar xxxxxx.jar</code>å‘½ä»¤è¿è¡Œç¨‹åºã€‚</p><h2 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h2><p>å¾®æœåŠ¡å…¶å®æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œä¸€ä¸ªåº”ç”¨åº”è¯¥æ˜¯ä¸€ç»„å°å‹æœåŠ¡ç»„æˆï¼Œå°å‹æœåŠ¡é€šè¿‡http apiçš„æ–¹å¼è¿›è¡Œæ²Ÿé€šã€‚æ¯ä¸€ä¸ªå°å‹æœåŠ¡éƒ½æ˜¯ä¸€ä¸ªåŠŸèƒ½å…ƒç´ ï¼Œèƒ½å¤Ÿç‹¬ç«‹æ›¿æ¢å’Œç‹¬ç«‹å‡çº§çš„åº”ç”¨å•å…ƒã€‚</p><p>è¯¦ç»†è¯·å‚è€ƒ<code>martinfowler.com</code> ä¸­çš„è¿™ç¯‡å¾®æœåŠ¡æ–‡ç« ï¼š<a href="https://martinfowler.com/microservices" target="_blank" rel="noopener">å¾®æœåŠ¡</a></p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹å‘½ä»¤æ¨¡å¼</title>
      <link href="/2019/06/28/2019-06-28-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/28/2019-06-28-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹å‘½ä»¤æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹å‘½ä»¤æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹å‘½ä»¤æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹å‘½ä»¤æ¨¡å¼</h1><p>å‘½ä»¤æ¨¡å¼æ˜¯å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ï¼Œå‘½ä»¤æ¨¡å¼å°†ä¸€ä¸ªè¯·æ±‚å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œè®©ä½ ä½¿ç”¨ä¸åŒçš„è¯·æ±‚æŠŠå®¢æˆ·ç«¯å‚æ•°åŒ–ï¼Œå¯¹è¯·æ±‚æ’é˜Ÿæˆ–è€…è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œå¯ä»¥æä¾›å‘½ä»¤çš„æ’¤é”€å’Œæ¢å¤åŠŸèƒ½ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ol><li><p>é€šè¿‡è¦æ‰§è¡Œçš„æ“ä½œæ¥å‚æ•°åŒ–å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨å›è°ƒå‡½æ•°åœ¨è¿‡ç¨‹è¯­è¨€ä¸­è¡¨è¾¾æ­¤ç±»å‚æ•°åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸ªå‡½æ•°å·²æ³¨å†Œåˆ°ç¨åè¦è°ƒç”¨çš„æŸä¸ªä½ç½®ã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥è¯´æ˜¯é¢å‘å¯¹è±¡çš„å›è°ƒå‡½æ•°ã€‚èµ·åˆ°åœ¨ç‰¹å®šä½ç½®è¢«è°ƒç”¨çš„ç›®çš„ã€‚</p></li><li><p>åœ¨ä¸åŒçš„æ—¶é—´ä¸‹è¿›è¡Œå‘å‡ºè¯·æ±‚å’Œæ‰§è¡Œè¯·æ±‚ï¼Œå‘½ä»¤å¯¹è±¡å¯ä»¥ç‹¬ç«‹äºè¯·æ±‚ï¼Œæ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸã€‚å‘½ä»¤å…è®¸è¯·æ±‚çš„ä¸€æ–¹å’Œæ¥æ”¶è¯·æ±‚çš„ä¸€æ–¹èƒ½å¤Ÿç‹¬ç«‹æ¼”åŒ–ã€‚</p></li><li><p>æ’¤é”€æ“ä½œï¼Œå‘½ä»¤æ¨¡å¼å¯ä»¥åœ¨å‘½ä»¤æ‰§è¡Œçš„æ—¶å€™å¯ä»¥åœ¨å‘½ä»¤ç±»ä¸­å­˜è´®å½“å‰çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡éå†æ­¤åˆ—è¡¨å¹¶åˆ†åˆ«è½¬å‘è°ƒç”¨unexecuteå’Œexecuteæ¥å®ç°æ— é™çº§åˆ«çš„æ’¤é”€å’Œé‡åšã€‚</p></li><li><p>å¯ä»¥æ›´å®¹æ˜“çš„å°†å‘½ä»¤è®°å½•åˆ°æ—¥å¿—ä¸­ã€‚</p></li><li><p>å‘½ä»¤æ¨¡å¼ä½¿æ–°çš„å‘½ä»¤å¾ˆå®¹æ˜“åœ°è¢«åŠ å…¥åˆ°ç³»ç»Ÿé‡Œã€‚å…·æœ‰å¾ˆå¥½çš„æ‹“å±•æ€§ã€‚</p></li></ol><h2 id="æ¨¡å¼ç»“æ„"><a href="#æ¨¡å¼ç»“æ„" class="headerlink" title="æ¨¡å¼ç»“æ„"></a>æ¨¡å¼ç»“æ„</h2><div align="center"><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190702190857.png" style="zoom:50%"></div><p>å‘½ä»¤æ¨¡å¼æ¶‰åŠåˆ°äº”ä¸ªè§’è‰²ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ol><li><p><code>å®¢æˆ·ç«¯(Client)</code>è§’è‰²ï¼šåˆ›å»ºä¸€ä¸ªå…·ä½“å‘½ä»¤(ConcreteCommand)å¯¹è±¡å¹¶ç¡®å®šå…¶æ¥æ”¶è€…ã€‚</p></li><li><p><code>å‘½ä»¤(Command)</code>è§’è‰²ï¼šå£°æ˜äº†ä¸€ä¸ªç»™æ‰€æœ‰å…·ä½“å‘½ä»¤ç±»çš„æŠ½è±¡æ¥å£ã€‚</p></li><li><p><code>å…·ä½“å‘½ä»¤(ConcreteCommand)</code>è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæ¥æ”¶è€…å’Œè¡Œä¸ºä¹‹é—´çš„å¼±è€¦åˆï¼›å®ç°execute()æ–¹æ³•ï¼Œè´Ÿè´£è°ƒç”¨æ¥æ”¶è€…çš„ç›¸åº”æ“ä½œã€‚execute()æ–¹æ³•é€šå¸¸å«åšæ‰§è¡Œæ–¹æ³•ã€‚</p></li><li><p><code>è¯·æ±‚è€…(Invoker)</code>è§’è‰²ï¼šè´Ÿè´£è°ƒç”¨å‘½ä»¤å¯¹è±¡æ‰§è¡Œè¯·æ±‚ï¼Œç›¸å…³çš„æ–¹æ³•å«åšè¡ŒåŠ¨æ–¹æ³•ã€‚</p></li><li><p><code>æ¥æ”¶è€…(Receiver)</code>è§’è‰²ï¼šè´Ÿè´£å…·ä½“å®æ–½å’Œæ‰§è¡Œä¸€ä¸ªè¯·æ±‚ã€‚ä»»ä½•ä¸€ä¸ªç±»éƒ½å¯ä»¥æˆä¸ºæ¥æ”¶è€…ï¼Œå®æ–½å’Œæ‰§è¡Œè¯·æ±‚çš„æ–¹æ³•å«åšè¡ŒåŠ¨æ–¹æ³•</p></li></ol><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><h3 id="æŠ½è±¡å‘½ä»¤è§’è‰²"><a href="#æŠ½è±¡å‘½ä»¤è§’è‰²" class="headerlink" title="æŠ½è±¡å‘½ä»¤è§’è‰²"></a>æŠ½è±¡å‘½ä»¤è§’è‰²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">excute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚è€…è§’è‰²"><a href="#è¯·æ±‚è€…è§’è‰²" class="headerlink" title="è¯·æ±‚è€…è§’è‰²"></a>è¯·æ±‚è€…è§’è‰²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚è€…ç”¨æ¥è¯·æ±‚å‘½ä»¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">King</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Command command;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Command <span class="title">invoke</span><span class="params">(Command command)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.command = command;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>&#123;</span><br><span class="line">        command.excute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¥æ”¶è€…è§’è‰²"><a href="#æ¥æ”¶è€…è§’è‰²" class="headerlink" title="æ¥æ”¶è€…è§’è‰²"></a>æ¥æ”¶è€…è§’è‰²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Soldier</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¡ŒåŠ¨æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepareWeapon</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Soldier prepare Weapon !!!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attack</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Soldier Attack!!!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">retreat</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Soldier Retreat!!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…·ä½“å‘½ä»¤è€…è§’è‰²"><a href="#å…·ä½“å‘½ä»¤è€…è§’è‰²" class="headerlink" title="å…·ä½“å‘½ä»¤è€…è§’è‰²"></a>å…·ä½“å‘½ä»¤è€…è§’è‰²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttackCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Soldier soldier ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AttackCommand</span><span class="params">(Soldier soldier)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.soldier = soldier;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">excute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ”¶åˆ°è¯·æ±‚ï¼Œæ‰§è¡Œæ“ä½œ</span></span><br><span class="line">        soldier.prepareWeapon();</span><br><span class="line">        soldier.attack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯ä»£ç "><a href="#å®¢æˆ·ç«¯ä»£ç " class="headerlink" title="å®¢æˆ·ç«¯ä»£ç "></a>å®¢æˆ·ç«¯ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//  æ¥å—è€…å’Œè¯·æ±‚è€…</span></span><br><span class="line">        King king = <span class="keyword">new</span> King();</span><br><span class="line">        Soldier soldier = <span class="keyword">new</span> Soldier();</span><br><span class="line">        <span class="comment">// è¯·æ±‚è€…è¯·æ±‚å‘½ä»¤</span></span><br><span class="line">        king.invoke(<span class="keyword">new</span> AttackCommand(soldier));</span><br><span class="line">        <span class="comment">// è¯·æ±‚è€…å‘èµ·å‘½ä»¤</span></span><br><span class="line">        king.action();</span><br><span class="line">        king.invoke(<span class="keyword">new</span> RetreatCommand(soldier));</span><br><span class="line">        king.action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹è¿­ä»£å™¨æ¨¡å¼</title>
      <link href="/2019/06/27/2019-06-27-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/27/2019-06-27-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹è¿­ä»£å™¨æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹è¿­ä»£å™¨æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹è¿­ä»£å™¨æ¨¡å¼</h1><p>è¿­ä»£å™¨æ˜¯ä¸€ç§è¡Œä¸ºæ¨¡å¼ï¼Œå®ƒæä¾›ä¸€ç§é¡ºåºè®¿é—®èšåˆå¯¹è±¡å…ƒç´ çš„æ–¹æ³•ï¼Œè€Œä¸ä¼šæš´éœ²å…¶åŸºç¡€è¡¨ç¤ºã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li>æŒ‡å‘è®¿é—®é›†åˆå¯¹è±¡å†…å®¹ï¼Œè€Œä¸æš´éœ²å…¶å†…éƒ¨å®ç°ã€‚</li><li>å¯ä»¥å¯¹é›†åˆå¯¹è±¡å¤šæ¬¡éå†</li><li>ä¸ºä¸åŒé›†åˆå¯¹è±¡æä¾›ç»Ÿä¸€çš„éå†æ¥å£</li></ul><h2 id="æ¨¡å¼ç»“æ„"><a href="#æ¨¡å¼ç»“æ„" class="headerlink" title="æ¨¡å¼ç»“æ„"></a>æ¨¡å¼ç»“æ„</h2><p>è¿­ä»£å™¨æ¨¡å¼å¤§è‡´åˆ†ä¸ºå››ä¸ªè§’è‰²ï¼šæŠ½è±¡å®¹å™¨ï¼Œå…·ä½“å®¹å™¨ï¼ŒæŠ½è±¡è¿­ä»£å™¨ï¼Œå…·ä½“è¿­ä»£å™¨ã€‚ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190627224735.png" alt="ç»“æ„å›¾"></p><p>å®¹å™¨ä¸€èˆ¬ä¸ºä¸€ç§æ•°æ®ç»“æ„çš„ç±»ï¼Œä¾‹å¦‚listã€mapã€‚ è¿­ä»£å™¨æ˜¯æä¾›éå†è¿™ä¸ªæ•°æ®ç»“æ„çš„æ–¹æ³•çš„ç±»ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>åœ¨javaä¸­æä¾›å¾ˆå¤šIteratorçš„æ¨¡å¼ã€‚ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line">        Iterator iterator = (Iterator) list.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>ArrayList</code>ç±»ä¸­å®ç°ç±»<code>Iterator</code>æ¥å£çš„å†…éƒ¨ç±»ï¼Œå¹¶ä¸”ä½¿ç”¨<code>iterator()</code>æ–¹æ³•è°ƒç”¨<code>new Itr();</code>ï¼Œå…·ä½“å†…å®¹å¯ä»¥æŸ¥çœ‹ArrayListæºç ã€‚</p><p>ä¸‹é¢è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„<code>Iterator</code>.</p><h3 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡è¿­ä»£å™¨"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡è¿­ä»£å™¨" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡è¿­ä»£å™¨"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡è¿­ä»£å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">E <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬äºŒéƒ¨åˆ†ï¼šæŠ½è±¡å®¹å™¨ç±»"><a href="#ç¬¬äºŒéƒ¨åˆ†ï¼šæŠ½è±¡å®¹å™¨ç±»" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†ï¼šæŠ½è±¡å®¹å™¨ç±»"></a>ç¬¬äºŒéƒ¨åˆ†ï¼šæŠ½è±¡å®¹å™¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> mark)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeLast</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Iterator&lt;Object&gt; <span class="title">iterator</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®ç°ç±»"><a href="#ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®ç°ç±»" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®ç°ç±»"></a>ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®ç°ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> <span class="keyword">implements</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object[] taskTag = <span class="keyword">new</span> Object[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> mark)</span> </span>&#123;</span><br><span class="line">        taskTag[size] = mark;</span><br><span class="line">        size ++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        taskTag[--size] = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;Object&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨å†…éƒ¨ç±»å®ç°è¿­ä»£å™¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyTaskItr();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨å†…éƒ¨ç±»å®ç°è¿­ä»£å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTaskItr</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Object</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> curr;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> size != curr;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> i = curr;</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= size)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException(<span class="string">"no element"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> taskTag[curr++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯è°ƒç”¨"><a href="#å®¢æˆ·ç«¯è°ƒç”¨" class="headerlink" title="å®¢æˆ·ç«¯è°ƒç”¨"></a>å®¢æˆ·ç«¯è°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Task task = <span class="keyword">new</span> MyTask();</span><br><span class="line">        task.add(<span class="number">1</span>);</span><br><span class="line">        task.add(<span class="number">3</span>);</span><br><span class="line">        task.add(<span class="number">4</span>);</span><br><span class="line">        task.add(<span class="number">2</span>);</span><br><span class="line">        task.removeLast();</span><br><span class="line">        task.removeLast();</span><br><span class="line">        task.add(<span class="number">5</span>);</span><br><span class="line">        Iterator taskIterator = task.iterator();</span><br><span class="line">        <span class="keyword">while</span>(taskIterator.hasNext())&#123;</span><br><span class="line">            System.out.println(taskIterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»“æœä¾æ¬¡æ‰“å°å‡º 1ï¼Œ3ï¼Œ5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•è€Œå¼ºå¤§çš„è¿­ä»£å™¨æ¨¡å¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PlantUMLç±»å›¾ä½¿ç”¨æ€»ç»“</title>
      <link href="/2019/06/26/2019-06-26-PlantUML%E7%B1%BB%E5%9B%BE%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/"/>
      <url>/2019/06/26/2019-06-26-PlantUML%E7%B1%BB%E5%9B%BE%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨PlantUMLç»˜åˆ¶ç±»å›¾"><a href="#ä½¿ç”¨PlantUMLç»˜åˆ¶ç±»å›¾" class="headerlink" title="ä½¿ç”¨PlantUMLç»˜åˆ¶ç±»å›¾"></a>ä½¿ç”¨PlantUMLç»˜åˆ¶ç±»å›¾</h1><p>æœ¬æ–‡åŸºäºPlantUMLå®˜ç½‘<a href="http://plantuml.com/zh/class-diagram" target="_blank" rel="noopener">ç»˜åˆ¶ç±»å›¾</a>å’Œç›¸å…³å¦‚ä½•æ­£ç¡®umlç±»å›¾ç›¸å…³æ–‡ç« ã€‚</p><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨plantUml"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨plantUml" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨plantUml"></a>ä¸ºä»€ä¹ˆä½¿ç”¨plantUml</h2><p>åŸå› å¾ˆç®€å•ï¼Œä¸ç”¨è‡ªå·±è€ƒè™‘æ„å›¾ï¼Œåƒå†™ä»£ç ä¸€æ ·å†™å‡ºæ¥ï¼Œå›¾å‡ºæ¥æ—¢ç¾è§‚åˆèƒ½å¤Ÿç¬¦åˆé€»è¾‘ã€‚</p><h2 id="åŸºæœ¬ç±»æ„æˆ"><a href="#åŸºæœ¬ç±»æ„æˆ" class="headerlink" title="åŸºæœ¬ç±»æ„æˆ"></a>åŸºæœ¬ç±»æ„æˆ</h2><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190626150930.png" alt="åŸºæœ¬ç±»æ„æˆ"></p><p>ä½¿ç”¨<code>class</code>å…³é”®å­—æ„ä»¶ç±»ï¼ŒåŒç†å…¶ä»–å…³é”®å­—ã€‚å¦‚<code>interface</code>,<code>enum</code>ã€‚</p><p>åœ¨ç±»ä¸­ä½¿ç”¨ <code>- # +</code> åˆ†åˆ«å¯¹åº”è¡¨ç¤ºç±»ä¸­çš„<code>private</code>,<code>protected</code>,<code>public</code>ã€‚å¦‚æœåœ¨ç±»ä¸­ä½¿ç”¨ <code>static</code>ã€<code>abstract</code>å…³é”®å­—ï¼Œéœ€è¦ä½¿ç”¨å¤§æ‹¬å·åŒ…è£¹èµ·æ¥ã€‚</p><p><strong>å¤‡æ³¨</strong>ä½¿ç”¨<code>note</code>æ¥å®ç°ï¼Œå¯ä»¥ä½¿ç”¨jsä¼˜åŒ–å¤‡æ³¨çš„æ ·å¼,å…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">&apos; ç®€å•å®šä¹‰ç±»A</span><br><span class="line">class classA</span><br><span class="line">&apos;å®šä¹‰ç±»B</span><br><span class="line">class classB&#123;</span><br><span class="line">    -&#123;static&#125; STATIC:Type</span><br><span class="line">    -a:A</span><br><span class="line">    #b:B</span><br><span class="line">    +c:C</span><br><span class="line">    +hello():void</span><br><span class="line">    -word():void</span><br><span class="line">&#125;</span><br><span class="line">&apos;æŠ½è±¡ç±»C</span><br><span class="line">abstract class classC &#123;</span><br><span class="line">    + &#123;abstract&#125; method1:void</span><br><span class="line">&#125;</span><br><span class="line">&apos;å¤‡æ³¨</span><br><span class="line">note right: note on right</span><br><span class="line">note top of classA : note on top</span><br><span class="line">&apos; å¤æ‚å¤‡æ³¨</span><br><span class="line">note top of object</span><br><span class="line">In java, &lt;size:18&gt;every&lt;/size&gt; &lt;u&gt;class&lt;/u&gt;&lt;b&gt;extends&lt;/b&gt;&lt;i&gt;this&lt;/i&gt; one.</span><br><span class="line">end note</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h3 id="ç±»æ›´å¤šä½¿ç”¨"><a href="#ç±»æ›´å¤šä½¿ç”¨" class="headerlink" title="ç±»æ›´å¤šä½¿ç”¨"></a>ç±»æ›´å¤šä½¿ç”¨</h3><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190626144335.png" alt="å¤æ‚"></p><p>æ›´å¤æ‚ä¸€äº›çš„ç±»çš„æ„ä»¶å‚è€ƒä¸Šå›¾ã€‚</p><p>ä½¿ç”¨<code>__å†…å®¹__</code>æ¥è¡¨ç¤ºåˆ†å‰²çº¿ï¼Œå¯¹ä¸åŒç±»å‹çš„è¿›è¡Œåˆ†å‰²ã€‚åœ¨ç±»åååŠ <code>&lt;? extends xxx&gt;</code> è¡¨ç¤ºèŒƒå‹,å‚è€ƒä¸‹é¢ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">class classC &lt;&lt;Serializable&gt;&gt; &#123;</span><br><span class="line">__variable__</span><br><span class="line">    -a:A</span><br><span class="line">    #b:B</span><br><span class="line">    +c:C</span><br><span class="line">__methods__</span><br><span class="line">    +hello():void</span><br><span class="line">    -word():void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class classD &lt;? extends List&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h3 id="å…³ç³»è¡¨ç¤º"><a href="#å…³ç³»è¡¨ç¤º" class="headerlink" title="å…³ç³»è¡¨ç¤º"></a>å…³ç³»è¡¨ç¤º</h3><h4 id="ç»§æ‰¿ä¸å®ç°"><a href="#ç»§æ‰¿ä¸å®ç°" class="headerlink" title="ç»§æ‰¿ä¸å®ç°"></a>ç»§æ‰¿ä¸å®ç°</h4><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190626144700.png" alt="ç»§æ‰¿ä¸å®ç°"></p><p>ç»§æ‰¿æŒ‡çš„å°±æ˜¯<strong>æ³›åŒ–</strong>ï¼Œå¦‚å›¾ä¸­å·¦è¡¨ç¤ºä¸€æ ·ï¼Œç±»Aç»§æ‰¿äºBï¼Œç”±å­ç±»å®ç°çˆ¶ç±»çš„è¡Œä¸ºã€‚æ³›åŒ–ä½¿ç”¨å¸¦<strong>å¤§ä¸‰è§’ç®­å¤´å’Œå®çº¿</strong>æ¥è¡¨ç¤ºï¼Œè¡¨ç¤ºä¸€ç§ç»§æ‰¿å…³ç³»ã€‚</p><p><strong>å®ç°</strong>æŒ‡çš„æ˜¯ç‰¹å®šç±»å®ç°æ¥å£ï¼Œå¦‚å›¾ä¸­å³è¡¨ç¤ºä¸€æ ·ï¼Œç±»<code>implement</code>å®ç°<code>interface</code>,è¡¨ç¤ºå®ç°ç±»å®ç°æ¥å£ç±»çš„å…³ç³»ã€‚åŒæ ·ä¼šç”±å­ç±»å®ç°æ¥å£ç±»ä¸­çš„è¡Œä¸ºã€‚å®ç°ä½¿ç”¨å¸¦<strong>å¤§ä¸‰è§’çš„ç®­å¤´å’Œè™šçº¿</strong>æ¥å®ç°ã€‚</p><p>æ— è®ºæ˜¯ç»§æ‰¿è¿˜æ˜¯å®ç°ï¼Œç®­å¤´éƒ½æ‰§è¡Œå¤«ç±»ï¼Œä¹Ÿå°±æ˜¯è¢«å®ç°ç±»ã€‚</p><h4 id="ä¾èµ–ä¸å…³è”"><a href="#ä¾èµ–ä¸å…³è”" class="headerlink" title="ä¾èµ–ä¸å…³è”"></a>ä¾èµ–ä¸å…³è”</h4><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190626160514.png" alt="ä¾èµ–ä¸å…³è”"></p><p>ä½¿ç”¨plantUMLä»£ç å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">&apos;ä¾èµ–ä¸å…³è”</span><br><span class="line">Class X</span><br><span class="line">&apos; ä¾èµ–å…³ç³»</span><br><span class="line">X ..&gt; Y :&quot;ä¾èµ–å…³ç³»&quot;</span><br><span class="line"></span><br><span class="line">class A</span><br><span class="line">&apos; å•å‘å…³è” Aå…³è”B</span><br><span class="line">A--&gt; B :&quot;å•å‘å…³è”&quot;</span><br><span class="line">&apos; åŒå‘å…³è”</span><br><span class="line">class C</span><br><span class="line">C --  D : &quot;åŒå‘å…³è”&quot;</span><br><span class="line">&apos; è‡ªå…³è”</span><br><span class="line">class F</span><br><span class="line">F --&gt; F:&quot;è‡ªå…³è”&quot;</span><br><span class="line">&apos; èšåˆå…³ç³»</span><br><span class="line">class G &#123;</span><br><span class="line">List&lt;H&gt; h</span><br><span class="line">&#125;</span><br><span class="line">G &quot;n&quot; o-- &quot;1&quot; H : &quot;ç»„åˆå…³ç³»&quot;</span><br><span class="line">&apos; ç»„åˆå…³ç³»</span><br><span class="line">class K &#123;</span><br><span class="line">List&lt;L&gt; l</span><br><span class="line">&#125;</span><br><span class="line">K &quot;n&quot;*--&quot;1&quot; L :&quot;èšåˆå…³ç³»&quot;</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h5 id="ä¸€ã€ä¾èµ–å…³ç³»"><a href="#ä¸€ã€ä¾èµ–å…³ç³»" class="headerlink" title="ä¸€ã€ä¾èµ–å…³ç³»"></a>ä¸€ã€ä¾èµ–å…³ç³»</h5><p>ä¾èµ–æ˜¯ä¸€ç§ä½¿ç”¨çš„å…³ç³»ï¼Œä»£ç ä¸­ä½“ç°åˆ°ä¾èµ–çš„å…³ç³»çš„æƒ…å†µ:<code>å±€éƒ¨å˜é‡</code>ã€<code>æ–¹æ³•çš„å‚æ•°æˆ–è€…å¯¹é™æ€æ–¹æ³•çš„è°ƒç”¨</code>,ä¾èµ–æ˜¯æœ€å¼±çš„ä¸€ç§å…³è”ã€‚ä¾èµ–å…³ç³»ä½¿ç”¨è™šçº¿å’Œæ™®é€šçš„å°ç®­å¤´æ¥å®ç°ï¼Œç®­å¤´æŒ‡å‘è¢«ä¾èµ–çš„å¯¹è±¡ã€‚å¦‚å›¾ä¸­çš„xä¾èµ–yä¸€æ ·ï¼Œæ‰€ä»¥æŒ‡å‘y,è¿™ä¸ªè¢«xä¾èµ–çš„å¯¹è±¡ã€‚</p><h5 id="äºŒã€å…³è”å…³ç³»"><a href="#äºŒã€å…³è”å…³ç³»" class="headerlink" title="äºŒã€å…³è”å…³ç³»"></a>äºŒã€å…³è”å…³ç³»</h5><p>å…³è”æ˜¯æ‹¥æœ‰çš„å…³ç³»ï¼Œå¦‚ç©å®¶ä¸æ¸¸æˆä¸­çš„è§’è‰²ä¸€æ ·ã€‚å…³è”å¯èƒ½æ˜¯å•å‘çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯åŒå‘çš„ï¼Œä¹ŸåŒæ ·èƒ½å¤Ÿè‡ªå·±å…³è”è‡ªå·±ã€‚ä»£ç ä¸­ä½“ç°åˆ°å…³è”çš„å…³ç³»çš„æƒ…å†µï¼š<code>æˆå‘˜å˜é‡</code>ã€‚å…³è”å…³ç³»ä½¿ç”¨å®çº¿å’Œå°å°–å¤´æ¥å®ç°ï¼Œç®­å¤´æŒ‡å‘è¢«å…³è”çš„å¯¹è±¡ã€‚</p><h5 id="ä¸‰ã€ç»„åˆå…³ç³»"><a href="#ä¸‰ã€ç»„åˆå…³ç³»" class="headerlink" title="ä¸‰ã€ç»„åˆå…³ç³»"></a>ä¸‰ã€ç»„åˆå…³ç³»</h5><p>ç»„åˆå…³ç³»æ˜¯<code>æ•´ä½“ä¸éƒ¨åˆ†</code>çš„å…³ç³»ï¼Œä½†æ˜¯å¦‚æœæ•´ä½“ä¸å­˜åœ¨ï¼Œé‚£éƒ¨åˆ†ä¹Ÿä¸èƒ½å­˜åœ¨ã€‚å°±å¦‚åŒå…¬å¸ä¸éƒ¨é—¨ä¸€æ ·ï¼Œå…¬å¸è§£æ•£äº†ï¼Œéƒ¨é—¨ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚å’Œå…³è”å…³ç³»ç›¸åŒï¼Œåœ¨ä»£ç ä¸­çš„ä½“ç°ä¹Ÿæ˜¯<code>æˆå‘˜å˜é‡</code>ã€‚ç»„åˆå…³ç³»ä½¿ç”¨ç©ºå¿ƒçš„è±å½¢å’Œå®çº¿æ¥è¡¨ç¤ºã€‚</p><h5 id="å››ã€èšåˆå…³ç³»"><a href="#å››ã€èšåˆå…³ç³»" class="headerlink" title="å››ã€èšåˆå…³ç³»"></a>å››ã€èšåˆå…³ç³»</h5><p>èšåˆå…³ç³»æ˜¯<code>æ•´ä½“ä¸éƒ¨åˆ†</code>çš„å…³ç³»ï¼Œä½†æ˜¯å’Œç»„åˆå…³ç³»ä¸åŒçš„æ˜¯ï¼Œèšåˆå…³ç³»ä¸­çš„<code>éƒ¨åˆ†</code>å¯ä»¥è„±ç¦»æ•´ä½“è€Œå­˜åœ¨ï¼Œå°±å¦‚åŒéº¦å½“åŠ³ä¸­çš„å¥—é¤ä¸æ±‰å ¡ä¸€æ ·ã€‚åœ¨ä»£ç ä¸­çš„ä½“ç°åŒæ ·æ˜¯<code>æˆå‘˜å˜é‡</code>ã€‚èšåˆå…³ç³»ä½¿ç”¨å®å¿ƒçš„è±å½¢å’Œå®çº¿æ¥è¡¨ç¤ºã€‚</p><p>æ‰€ä»¥å¯ä»¥è¯´èšåˆå…³ç³»å’Œç»„åˆå…³ç³»æ˜¯å…³ç³»æ›´åŠ ç¡®å®šï¼Œæ›´åŠ ç´§å¯†çš„å…³è”å…³ç³»ã€‚</p><h5 id="å„å…³ç³»çš„å¼ºå¼±é¡ºåº"><a href="#å„å…³ç³»çš„å¼ºå¼±é¡ºåº" class="headerlink" title="å„å…³ç³»çš„å¼ºå¼±é¡ºåº"></a>å„å…³ç³»çš„å¼ºå¼±é¡ºåº</h5><blockquote><p>æ³›åŒ–= å®ç°&gt; ç»„åˆ&gt; èšåˆ&gt; å…³è”&gt; ä¾èµ–</p></blockquote><p>PlantUMLæ”¯æŒæ›´å¤šçš„æ›´å¤æ‚çš„æƒ…æ™¯ä¸‹çš„å›¾å½¢ç»˜åˆ¶ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹<a href="http://plantuml.com/zh/index" target="_blank" rel="noopener">PlantUMLçš„ä¸­æ–‡ç½‘ç«™</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
            <tag> UML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹å¤‡å¿˜å½•æ¨¡å¼</title>
      <link href="/2019/06/25/2019-06-25-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/25/2019-06-25-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹å¤‡å¿˜å½•æ¨¡å¼ğŸ“•"><a href="#è®¾è®¡æ¨¡å¼ä¹‹å¤‡å¿˜å½•æ¨¡å¼ğŸ“•" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹å¤‡å¿˜å½•æ¨¡å¼ğŸ“•"></a>è®¾è®¡æ¨¡å¼ä¹‹å¤‡å¿˜å½•æ¨¡å¼ğŸ“•</h1><p>ä¸è¿åå°è£…çš„æƒ…å†µä¸‹ï¼Œæ•è·å¹¶å¤–åŒ–å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»¥ä¾¿ç¨åå¯ä»¥å°†å¯¹è±¡æ¢å¤åˆ°æ­¤çŠ¶æ€ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p>å¿…é¡»ä¿å­˜å¯¹è±¡çŠ¶æ€çš„å¿«ç…§ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥å°†å…¶æ¢å¤åˆ°è¯¥çŠ¶æ€</p><h2 id="æ¨¡å¼ç»“æ„"><a href="#æ¨¡å¼ç»“æ„" class="headerlink" title="æ¨¡å¼ç»“æ„"></a>æ¨¡å¼ç»“æ„</h2><p>æ¨¡å¼ç»“æ„åˆ†ä¸ºä¸‰ç§ç»“æ„ï¼š</p><ol><li><strong>å‘èµ·äºº (Originator)</strong><br>è´Ÿè´£åˆ›å»ºä¸€ä¸ªæœ‰å†…éƒ¨çŠ¶æ€çš„å¤‡å¿˜å½•å¯¹è±¡ã€‚</li><li><strong>è´Ÿè´£äºº (Caretaker)</strong><br>è´Ÿè´£ä¿å­˜å¤‡å¿˜å½•å†…å®¹ï¼Œä½†æ˜¯ä¸æ£€æŸ¥å¤‡å¿˜å½•çš„å†…å®¹ã€‚</li><li><strong>å¤‡å¿˜å½• (Memento)</strong><br>ä¿å­˜å‘èµ·äººçš„å†…éƒ¨çš„çŠ¶æ€ã€‚</li></ol><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190625232202.png" alt="æ¨¡å¼ç»“æ„"></p><p>ä¸Šå›¾ä¸­çš„ActionGameä¸ºè´Ÿè´£äººï¼Œè´Ÿè´£ä¿å­˜çŠ¶æ€ï¼ŒPlayerä¸ºå‘èµ·äººè´Ÿè´£ä¸»åŠ¨è®°å½•å¤‡å¿˜å½•ã€‚</p><h3 id="å®é™…åœºæ™¯"><a href="#å®é™…åœºæ™¯" class="headerlink" title="å®é™…åœºæ™¯"></a>å®é™…åœºæ™¯</h3><p>åœ¨ç©å•æœºæ¸¸æˆçš„æ—¶å€™ï¼Œåœ¨é€šè¿‡ä¸€ä¸ªå…³å¡çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè®°å½•ä½ å½“æ—¶çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚æœä¸‹ä¸€å…³æ²¡é€šè¿‡ï¼Œä¼šè‡ªåŠ¨è¿˜åŸåˆ°ä¸Šä¸€ä¸ªè®°å½•ç‚¹ä»æ–°å¼€å§‹ã€‚è¿™ç§æƒ…å†µä¸‹å°±å¯ä»¥ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼è®°å½•å­˜æ¡£çŠ¶æ€ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™è¿˜åŸçŠ¶æ€ã€‚é’ˆå¯¹æ­¤å¤„åœºæ™¯ï¼Œä½¿ç”¨ä¸‹é¢ä»£ç è¿˜åŸã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><h3 id="ä½œä¸ºå‘èµ·è€…çš„Player"><a href="#ä½œä¸ºå‘èµ·è€…çš„Player" class="headerlink" title="ä½œä¸ºå‘èµ·è€…çš„Player"></a>ä½œä¸ºå‘èµ·è€…çš„Player</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ¸¸æˆçŠ¶æ€</span></span><br><span class="line">    <span class="keyword">private</span> GameState gameState;</span><br><span class="line"></span><br><span class="line">    Player(GameState gameState) &#123;</span><br><span class="line">        <span class="keyword">this</span>.gameState = gameState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®çŠ¶æ€</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setGameState</span><span class="params">(GameState gameState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gameState = gameState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–çŠ¶æ€</span></span><br><span class="line">    <span class="function">GameState <span class="title">getGameState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gameState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå­˜æ¡£è®°å½•</span></span><br><span class="line">    <span class="function">Memento <span class="title">createMemento</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Memento(gameState);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å›é€€å­˜æ¡£è®°å½•</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">retrieveMemento</span><span class="params">(Memento memento)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gameState = memento.getGameState();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½œä¸ºè´Ÿè´£äººçš„ActionGame"><a href="#ä½œä¸ºè´Ÿè´£äººçš„ActionGame" class="headerlink" title="ä½œä¸ºè´Ÿè´£äººçš„ActionGame"></a>ä½œä¸ºè´Ÿè´£äººçš„ActionGame</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Game</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">storeGamePoint</span><span class="params">(Memento memento)</span></span>;</span><br><span class="line">    <span class="function">Memento <span class="title">retrieveGamePoint</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionGame</span> <span class="keyword">implements</span> <span class="title">Game</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Memento memento;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­˜æ¡£è®°å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> nanyin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 17:31 2019-06-26</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> memento 1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeGamePoint</span><span class="params">(Memento memento)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.memento = memento;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿˜åŸè®°å½•ç‚¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> nanyin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 17:32 2019-06-26</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Memento</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Memento <span class="title">retrieveGamePoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.memento;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½œä¸ºå¤‡å¿˜å½•çš„Memento"><a href="#ä½œä¸ºå¤‡å¿˜å½•çš„Memento" class="headerlink" title="ä½œä¸ºå¤‡å¿˜å½•çš„Memento"></a>ä½œä¸ºå¤‡å¿˜å½•çš„Memento</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Memento</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> GameState gameState;</span><br><span class="line">    Memento(GameState gameState) &#123;</span><br><span class="line">        <span class="keyword">this</span>.gameState = gameState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">GameState <span class="title">getGameState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gameState;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> GameState &#123;</span><br><span class="line">    DIE,SUCCESS</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯ç¨‹åº"><a href="#å®¢æˆ·ç«¯ç¨‹åº" class="headerlink" title="å®¢æˆ·ç«¯ç¨‹åº"></a>å®¢æˆ·ç«¯ç¨‹åº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªåŠ¨ä½œç±»å‹çš„æ¸¸æˆ</span></span><br><span class="line">        Game actionGame = <span class="keyword">new</span> ActionGame();</span><br><span class="line">        <span class="comment">//ç©å®¶é€šå…³</span></span><br><span class="line">        Player player = <span class="keyword">new</span> Player(GameState.SUCCESS);</span><br><span class="line">        <span class="comment">//å­˜æ¡£</span></span><br><span class="line">        Memento memento = player.createMemento();</span><br><span class="line">        actionGame.storeGamePoint(memento);</span><br><span class="line">        <span class="comment">//æ­¤æ—¶ç©å®¶é˜µäº¡</span></span><br><span class="line">        player.setGameState(GameState.DIE);</span><br><span class="line">        System.out.println(player.getGameState());</span><br><span class="line">        <span class="comment">//éœ€è¦ä»ä¸Šä¸€æ¬¡æ¸¸æˆå­˜æ¡£ä¸­åŠ è½½åŸæ¥çš„ç©å®¶çŠ¶æ€</span></span><br><span class="line">        player.retrieveMemento(actionGame.retrieveGamePoint());</span><br><span class="line">        System.out.println(player.getGameState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ¸¸æˆå­˜æ¡£åæ­»äº¡ï¼Œå†é‡å¤è¯»å­˜æ¡£ï¼Œå¾—åˆ°ä¹‹å‰å­˜æ¡£ä¹‹å‰çš„çŠ¶æ€ã€‚æ¸¸æˆä¸ä¼šä¸»åŠ¨å­˜æ¡£å’Œè¯»å–å­˜æ¡£ï¼Œåªä¼šè®°å½•å­˜æ¡£ä¸­çš„å†…å®¹ï¼Œè€Œç©å®¶ä¼šä¸»åŠ¨ä»æ¸¸æˆä¸­è¯»å–å­˜æ¡£ï¼Œç„¶åæ¢å¤åˆ°å­˜æ¡£çš„çŠ¶æ€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹çŠ¶æ€æ¨¡å¼</title>
      <link href="/2019/06/19/2019-06-19-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/19/2019-06-19-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹çŠ¶æ€æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹çŠ¶æ€æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹çŠ¶æ€æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹çŠ¶æ€æ¨¡å¼</h1><p>çŠ¶æ€æ¨¡å¼æ˜¯å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚çŠ¶æ€æ¨¡å¼å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜çš„æ—¶å€™æ”¹å˜å…¶è¡Œä¸ºã€‚è¿™ä¸ªå¯¹è±¡çœ‹ä¸Šå»å°±åƒæ˜¯æ”¹å˜äº†å®ƒçš„ç±»ä¸€æ ·ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li>å¯¹è±¡çš„è¡Œä¸ºå–å†³äºå…¶çŠ¶æ€ï¼Œå¹¶ä¸”å¿…é¡»æ ¹æ®è¯¥çŠ¶æ€åœ¨è¿è¡Œæ—¶æ›´æ”¹å…¶è¡Œä¸ºã€‚</li><li>é€šå¸¸ï¼Œå‡ ä¸ªæ“ä½œå°†åŒ…å«ç›¸åŒçš„æ¡ä»¶ç»“æ„ã€‚Stateæ¨¡å¼å°†æ¡ä»¶çš„æ¯ä¸ªåˆ†æ”¯æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­ã€‚å¯ä»¥å°†å¯¹è±¡çš„çŠ¶æ€è§†ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥ç‹¬ç«‹äºå…¶ä»–å¯¹è±¡è€Œå˜åŒ–</li></ul><p>æ¦‚æ‹¬æ¥è¯´ï¼ŒçŠ¶æ€æ¨¡å¼å°†è¡Œä¸ºåŒ…è£…åˆ°å…·ä½“çš„çŠ¶æ€å¯¹è±¡ä¸­ã€‚æ¯ä¸ªçŠ¶æ€å¯¹è±¡æ˜¯æŠ½è±¡çŠ¶æ€çš„å­ç±»ã€‚çŠ¶æ€æ¨¡å¼æ„å›¾æ˜¯åœ¨æ”¹å˜å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€çš„æ—¶å€™ï¼Œè¡Œä¸ºéšä¹‹æ”¹å˜ã€‚</p><h2 id="æ¨¡å¼ç»“æ„"><a href="#æ¨¡å¼ç»“æ„" class="headerlink" title="æ¨¡å¼ç»“æ„"></a>æ¨¡å¼ç»“æ„</h2><p>çŠ¶æ€æ¨¡å¼åˆ†ä¸ºä¸‰ç§ç»“æ„ï¼šç¯å¢ƒè§’è‰²ã€æŠ½è±¡çŠ¶æ€è§’è‰²ã€å…·ä½“çŠ¶æ€è§’è‰²</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190618203143.png" alt="çŠ¶æ€æ¨¡å¼ç»“æ„å›¾"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ç”µç¯æœ‰ä¸¤ç§åŸºæœ¬è¡Œä¸º å¼€å¯ã€å…³é—­ã€‚ä½†æ˜¯æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œæ­£å¸¸å’Œåæ‰çš„çŠ¶æ€ã€‚å°†å…±åŒçš„è¡Œä¸ºå°è£…åˆ°ç»Ÿä¸€çš„çŠ¶æ€æ¥å£ä¸­ï¼Œå†æ ¹æ®ä¸åŒçš„çŠ¶æ€ï¼Œåˆ›å»ºå­ç±»å®Œæˆä¸åŒçŠ¶æ€å½¢æˆä¸åŒçš„è¡Œä¸ºã€‚</p><p>ç¯å†æ­£å¸¸çŠ¶æ€ä¸‹èƒ½å¤Ÿæ­£å¸¸å¼€å¯ï¼Œæ­£å¸¸å…³é—­ã€‚ç­‰åœ¨åæ‰çš„çŠ¶æ€ä¸‹ï¼Œä¸èƒ½å¼€å¯å’Œå…³é—­ã€‚çŠ¶æ€æ¨¡å¼å°±æ˜¯æ ¹æ®è¿™ä¸ªé€»è¾‘æŠ½ç¦»è¡Œä¸ºï¼Œå°†å…·ä½“è¡Œä¸ºåŒ…è£…åˆ°å…·ä½“çŠ¶æ€å¯¹è±¡ä¸­ã€‚</p><h3 id="æŠ½è±¡çŠ¶æ€è§’è‰²"><a href="#æŠ½è±¡çŠ¶æ€è§’è‰²" class="headerlink" title="æŠ½è±¡çŠ¶æ€è§’è‰²"></a>æŠ½è±¡çŠ¶æ€è§’è‰²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…·ä½“çŠ¶æ€è§’è‰²"><a href="#å…·ä½“çŠ¶æ€è§’è‰²" class="headerlink" title="å…·ä½“çŠ¶æ€è§’è‰²"></a>å…·ä½“çŠ¶æ€è§’è‰²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalState</span> <span class="keyword">implements</span> <span class="title">State</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç”µç¯å¼€äº†ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç”µç¯å…³äº†ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç”µç¯å¼€ä¸äº†ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç”µç¯å…³ä¸äº†ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¯å¢ƒè§’è‰²"><a href="#ç¯å¢ƒè§’è‰²" class="headerlink" title="ç¯å¢ƒè§’è‰²"></a>ç¯å¢ƒè§’è‰²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="comment">//çŠ¶æ€å‚æ•°</span></span><br><span class="line">    State state;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestToOpen</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        state.open();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestToClose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        state.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//çŠ¶æ€å˜åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeStageTo</span><span class="params">(State state)</span></span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯æµ‹è¯•"><a href="#å®¢æˆ·ç«¯æµ‹è¯•" class="headerlink" title="å®¢æˆ·ç«¯æµ‹è¯•"></a>å®¢æˆ·ç«¯æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Context context = <span class="keyword">new</span> Context(<span class="keyword">new</span> NormalState());</span><br><span class="line">        context.requestToOpen();</span><br><span class="line">        context.requestToClose();</span><br><span class="line">        <span class="comment">//å°†çŠ¶æ€å˜æ›´ä¸ºåçš„çŠ¶æ€</span></span><br><span class="line">        context.changeStageTo(<span class="keyword">new</span> ErrorState());</span><br><span class="line">        context.requestToOpen();</span><br><span class="line">        context.requestToClose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼</title>
      <link href="/2019/06/19/2019-06-24-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/19/2019-06-24-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼</h1><p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ï¼Œåˆå«â€œå‘å¸ƒ-è®¢é˜…æ¨¡å¼â€ã€‚ç”±åå­—å°±èƒ½å¤Ÿå¾—çŸ¥ï¼Œè§‚å¯Ÿè¿™æ¨¡å¼æ„é€ äº†ä¸€ä¸ªå‘å¸ƒè€…å’Œè®¢é˜…è€…ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œä»¥ä¾¿å½“ä¸€ä¸ªå¯¹è±¡æ›´æ”¹çŠ¶æ€æ—¶ï¼Œå°†è‡ªåŠ¨é€šçŸ¥å’Œæ›´æ–°å…¶æ‰€æœ‰ä¾èµ–é¡¹ã€‚åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œä¸»åŠ¨å‘ç”Ÿæ”¹å˜çš„æ˜¯å‘å¸ƒè€…ç§°ä¸ºä¸»é¢˜ï¼Œè€Œè¢«åŠ¨æ”¶åˆ°å‘å¸ƒè€…ä¿¡æ¯çš„è®¢é˜…è€…ç§°ä¸ºè§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ /å‡å°‘å…·ä½“ä¸»é¢˜çš„è§‚å¯Ÿè€…ï¼Œå®ç°ä¸»é¢˜å’Œè§‚å¯Ÿè€…ä¹‹é—´çš„æ¾è€¦åˆã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li><p>å½“è®¾è®¡ä¸­æœ‰ä¸¤ç§ä¸åŒæ–¹é¢çš„æŠ½è±¡ï¼Œå¹¶ä¸”æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ï¼Œè¿™æ—¶å°†ä¸¤ä¸ªæŠ½è±¡åˆ†åˆ«å°è£…åˆ°å…·ä½“çš„ç±»ä¸­ï¼Œè¿™æ ·å°±èƒ½å¤Ÿç‹¬ç«‹çš„æ”¹å˜å’Œé‡ç”¨è¿™äº›å¯¹è±¡ã€‚åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ä¸¤ç§æŠ½è±¡æŒ‡çš„å°±æ˜¯æŠ½è±¡ä¸»é¢˜å’ŒæŠ½è±¡è§‚å¯Ÿè€…ã€‚</p></li><li><p>å½“ä¸€ä¸ªå¯¹è±¡éœ€è¦æ›´æ”¹æ—¶ï¼Œæ¶‰åŠåˆ°æ›´æ”¹å…¶ä»–ç±»å‹çš„å…¶ä»–å¯¹è±¡ï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡çš„æ•°é‡å¤šä¸”ä¸ç¡®å®šçš„æ—¶å€™ã€‚</p></li><li><p>å½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜æ—¶ï¼Œå…¶ä»–å¯¹è±¡èƒ½å¤Ÿå¾—åˆ°è¿™ä¸ªå¯¹è±¡å·²ç»æ”¹å˜çš„é€šçŸ¥ï¼Œè€Œä¸å¿…çŸ¥é“è¿™äº›å¯¹è±¡å…·ä½“æ˜¯ä»€ä¹ˆã€‚ä¹Ÿå°±æ˜¯è¯´è¦è¾¾åˆ°è¿™ä¸ªæ”¹å˜çš„å¯¹è±¡å’Œé€šçŸ¥çš„å¯¹è±¡çš„æ¾è€¦åˆã€‚</p><p>  <strong>æ‰€ä»¥ç»¼ä¸Š:</strong><br>  å½“å¸Œæœ›ä¸€ä¸ªå¯¹è±¡æ”¹å˜çš„åŒæ—¶ï¼Œå¤šä¸ªå¯¹è±¡èƒ½å¤Ÿå¾—åˆ°é€šçŸ¥ï¼Œä¸€å—è¿›è¡Œå˜æ›´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼å¯¹ç³»ç»Ÿè®¾è®¡</p></li></ul><h2 id="æ¨¡å¼ç»“æ„"><a href="#æ¨¡å¼ç»“æ„" class="headerlink" title="æ¨¡å¼ç»“æ„"></a>æ¨¡å¼ç»“æ„</h2><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190624203405.png" alt="è§‚å¯Ÿè€…æ¨¡å¼ç»“æ„å›¾"></p><p>ä¸Šå›¾ä¸­ï¼š</p><ol><li><code>Weather</code>ä¸º<strong>æŠ½è±¡ä¸»é¢˜ç±»</strong>ï¼Œèƒ½å¤Ÿå°†è§‚å¯Ÿè€…<code>Observer</code>æ„æˆä¸€ä¸ª<code>list</code>ç»“æ„,ä»è€Œèƒ½å¤Ÿè¾¾åˆ°<code>Weather</code>æ”¹å˜çš„æ—¶å€™å¯ä»¥å¾ªç¯è¡¨ä¸­çš„è§‚å¯Ÿè€…ï¼Œå‘é€é€šçŸ¥ã€‚å¹¶ä¸”ä½œä¸ºæŠ½è±¡ç±»å®ç°äº†æ·»åŠ ï¼Œç§»é™¤è§‚å¯Ÿè€…æ–¹æ³•ã€‚</li><li><code>BeijingWeather</code>ä¸º<strong>å…·ä½“ä¸»é¢˜ç±»</strong>ï¼Œå®ç°äº†<code>Weather</code>ç±»ã€‚</li><li><code>Observer</code>ä½œä¸º<strong>æŠ½è±¡è§‚å¯Ÿè€…ç±»</strong>ï¼Œä½œä¸ºæ‰€æœ‰è§‚å¯Ÿè€…çš„é€šç”¨æ¥å£ï¼Œå…¶ä¸­å®šä¹‰<code>update</code>æ–¹æ³•ä½œä¸ºæ›´æ–°çŠ¶æ€çš„æ¥å£ã€‚é€šè¿‡è¿™ä¸ªæ¥å£å’Œ<code>Weather</code>ç±»äº¤äº’æ¥è·å–çŠ¶æ€é€šçŸ¥ã€‚</li><li><code>WeatherObserverA</code>ä¸<code>WeatherObserverB</code>ä½œä¸º<strong>å…·ä½“è§‚å¯Ÿè€…ç±»</strong>ï¼Œå®ç°ç±»è§‚å¯Ÿè€…æ¥å£ã€‚ç»Ÿä¸€æ¥å—é€šçŸ¥å¹¶æ›´æ–°è‡ªèº«çŠ¶æ€ã€‚</li></ol><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><h4 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡ä¸»é¢˜ç±»"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡ä¸»é¢˜ç±»" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡ä¸»é¢˜ç±»"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡ä¸»é¢˜ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çŠ¶æ€æšä¸¾ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> WeatherState &#123;</span><br><span class="line">    SUNNY_DAY,</span><br><span class="line">    CLOUDY_DAY,</span><br><span class="line">    RAINY_DAY,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŠ½è±¡ä¸»é¢˜ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Weather</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> WeatherState weatherState;</span><br><span class="line">    <span class="comment">// è§‚å¯Ÿè€…é›†åˆ</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observerList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Weather <span class="title">addObserver</span><span class="params">(Observer observer)</span></span>&#123;</span><br><span class="line">        observerList.add(observer);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer observer)</span></span>&#123;</span><br><span class="line">        observerList.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡ä¸»é¢˜æ›´æ”¹ä»è€Œåœ¨è¯¥ä¸»é¢˜ä¸Šæ³¨å†Œçš„è§‚å¯Ÿè€…èƒ½å¤ŸåŒæ—¶èƒ½åˆ°é€šçŸ¥</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObserver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Observer o:observerList</span><br><span class="line">             ) &#123;</span><br><span class="line">            o.update(<span class="keyword">this</span>.weatherState);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¬¬äºŒéƒ¨åˆ†ï¼šå…·ä½“ä¸»é¢˜ç±»"><a href="#ç¬¬äºŒéƒ¨åˆ†ï¼šå…·ä½“ä¸»é¢˜ç±»" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†ï¼šå…·ä½“ä¸»é¢˜ç±»"></a>ç¬¬äºŒéƒ¨åˆ†ï¼šå…·ä½“ä¸»é¢˜ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeijingWeather</span> <span class="keyword">extends</span> <span class="title">Weather</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    BeijingWeather(WeatherState weatherState) &#123;</span><br><span class="line">        <span class="keyword">this</span>.weatherState = weatherState;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä½œä¸ºæ›´æ–°ä¸»é¢˜çš„æ¥å£</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeState</span><span class="params">(WeatherState we)</span></span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.weatherState = we;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ½è±¡è§‚å¯Ÿè€…"><a href="#ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ½è±¡è§‚å¯Ÿè€…" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ½è±¡è§‚å¯Ÿè€…"></a>ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ½è±¡è§‚å¯Ÿè€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ›´æ–°æ¥å£</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(WeatherState weatherState)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¬¬å››éƒ¨åˆ†ï¼š-å…·ä½“è§‚å¯Ÿè€…"><a href="#ç¬¬å››éƒ¨åˆ†ï¼š-å…·ä½“è§‚å¯Ÿè€…" class="headerlink" title="ç¬¬å››éƒ¨åˆ†ï¼š å…·ä½“è§‚å¯Ÿè€…"></a>ç¬¬å››éƒ¨åˆ†ï¼š å…·ä½“è§‚å¯Ÿè€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherObserverA</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(WeatherState weatherState)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"observer A get new weather message is "</span> + weatherState.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æœ€åè°ƒç”¨"><a href="#æœ€åè°ƒç”¨" class="headerlink" title="æœ€åè°ƒç”¨"></a>æœ€åè°ƒç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰ä¸»é¢˜</span></span><br><span class="line">        Weather weather = <span class="keyword">new</span> BeijingWeather(WeatherState.SUNNY_DAY);</span><br><span class="line">        <span class="comment">//æ·»åŠ è§‚å¯Ÿè€…</span></span><br><span class="line">        weather.addObserver(<span class="keyword">new</span> WeatherObserverA()).addObserver(<span class="keyword">new</span> WeatherObserverB());</span><br><span class="line">        <span class="comment">//é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…</span></span><br><span class="line">        weather.notifyObserver();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼šæœ€åæ³¨å†Œåœ¨ä¸»é¢˜ä¸Šçš„æ‰€æœ‰è§‚å¯Ÿè€…éƒ½æ”¶åˆ°äº†é€šçŸ¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">observer A get new weather message is SUNNY_DAY</span><br><span class="line">observer B get new weather message is SUNNY_DAY</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Macä¸‹ä½¿ç”¨ideaæ—¶åœ¨dockæ ä¸€ç›´å­˜åœ¨javaå›¾æ ‡å’Œæ§åˆ¶å°ä¹±ç é—®é¢˜</title>
      <link href="/2019/06/18/2019-06-18-Mac%E4%B8%8Bidea%E5%9C%A8Dock%E6%A0%8F%E4%B8%80%E7%9B%B4%E5%AD%98%E5%9C%A8%E5%9B%BE%E6%A0%87%E5%92%8C%E6%8E%A7%E5%88%B6%E5%8F%B0%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/"/>
      <url>/2019/06/18/2019-06-18-Mac%E4%B8%8Bidea%E5%9C%A8Dock%E6%A0%8F%E4%B8%80%E7%9B%B4%E5%AD%98%E5%9C%A8%E5%9B%BE%E6%A0%87%E5%92%8C%E6%8E%A7%E5%88%B6%E5%8F%B0%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="Macä¸‹ä½¿ç”¨Ideaç›¸å…³é—®é¢˜"><a href="#Macä¸‹ä½¿ç”¨Ideaç›¸å…³é—®é¢˜" class="headerlink" title="Macä¸‹ä½¿ç”¨Ideaç›¸å…³é—®é¢˜"></a>Macä¸‹ä½¿ç”¨Ideaç›¸å…³é—®é¢˜</h1><h2 id="ä½¿ç”¨tomcatå¯åŠ¨IDEAé¡¹ç›®åï¼Œdockæ ä¸€ç›´å­˜åœ¨JAVAå›¾æ ‡é—®é¢˜"><a href="#ä½¿ç”¨tomcatå¯åŠ¨IDEAé¡¹ç›®åï¼Œdockæ ä¸€ç›´å­˜åœ¨JAVAå›¾æ ‡é—®é¢˜" class="headerlink" title="ä½¿ç”¨tomcatå¯åŠ¨IDEAé¡¹ç›®åï¼Œdockæ ä¸€ç›´å­˜åœ¨JAVAå›¾æ ‡é—®é¢˜"></a>ä½¿ç”¨tomcatå¯åŠ¨IDEAé¡¹ç›®åï¼Œdockæ ä¸€ç›´å­˜åœ¨JAVAå›¾æ ‡é—®é¢˜</h2><p>åœ¨macä¸Šå¯åŠ¨ideaåï¼Œå­˜åœ¨dockæ ä¸€ç›´å­˜åœ¨JAVAå›¾æ ‡çš„é—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190618081946.png" alt="Dockæ å­˜åœ¨javaå›¾æ ‡é—®é¢˜"></p><p>è§£å†³æ–¹å¼ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190618082435.png" alt="å­˜åœ¨å›¾æ ‡è§£å†³æ–¹å¼"></p><p>æ‰“å¼€<code>Run/Debug configurations</code>,åœ¨<code>vm options</code>ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dapple.awt.UIElement=<span class="keyword">true</span></span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨IDEAåï¼Œæ§åˆ¶å°ä¹±ç "><a href="#å¯åŠ¨IDEAåï¼Œæ§åˆ¶å°ä¹±ç " class="headerlink" title="å¯åŠ¨IDEAåï¼Œæ§åˆ¶å°ä¹±ç "></a>å¯åŠ¨IDEAåï¼Œæ§åˆ¶å°ä¹±ç </h2><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190618082124.png" alt="æ§åˆ¶å°ä¹±ç "></p><p>è§£å†³æ–¹å¼å’Œä¸Šä¸€ä¸ªé—®é¢˜ç›¸åŒï¼ŒåŒæ ·åœ¨vm optionsä¸­å¢åŠ å‚æ•°ï¼Œå…·ä½“å‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dfile.encoding=UTF-<span class="number">8</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> idea </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹æ¨¡ç‰ˆæ¨¡å¼</title>
      <link href="/2019/06/17/2019-06-17-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/17/2019-06-17-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼</h1><p>æ¨¡ç‰ˆæ¨¡å¼æ˜¯ç±»çš„è¡Œä¸ºæ¨¡å¼ï¼Œå°†éƒ¨åˆ†é€»è¾‘ä»¥å…·ä½“æ–¹æ³•æ¥å®ç°ï¼Œå°†å…¶ä»–æ–¹æ³•å£°æ˜ä¸ºæŠ½è±¡æ–¹æ³•æ¥è®©å­ç±»æ¥å®ç°ã€‚ä¸åŒçš„å­ç±»å®ç°çš„æ–¹æ³•é€»è¾‘ä¸åŒï¼Œä»è€Œæ•´ä½“çš„é€»è¾‘æœ‰æ‰€å·®å¼‚ã€‚</p><p>è¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªè§’è‰²ï¼š</p><p>ä¸€ã€æŠ½è±¡æ¨¡æ¿(Abstract Template)è§’è‰²æœ‰å¦‚ä¸‹è´£ä»»ï¼š</p><pre><code>- å®šä¹‰äº†ä¸€ä¸ªæˆ–å¤šä¸ªæŠ½è±¡æ“ä½œï¼Œä»¥ä¾¿è®©å­ç±»å®ç°ã€‚è¿™äº›æŠ½è±¡æ“ä½œå«åšåŸºæœ¬æ“ä½œï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ç»„æˆæ­¥éª¤ã€‚- å®šä¹‰å¹¶å®ç°äº†ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚è¿™ä¸ªæ¨¡æ¿æ–¹æ³•ä¸€èˆ¬æ˜¯ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œå®ƒç»™å‡ºäº†ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„éª¨æ¶ï¼Œè€Œé€»è¾‘çš„ç»„æˆæ­¥éª¤åœ¨ç›¸åº”çš„æŠ½è±¡æ“ä½œä¸­ï¼Œæ¨è¿Ÿåˆ°å­ç±»å®ç°ã€‚é¡¶çº§é€»è¾‘ä¹Ÿæœ‰å¯èƒ½è°ƒç”¨ä¸€äº›å…·ä½“æ–¹æ³•ã€‚</code></pre><p>äºŒã€å…·ä½“æ¨¡æ¿(Concrete Template)è§’è‰²åˆå¦‚ä¸‹è´£ä»»ï¼š</p><pre><code>- å®ç°çˆ¶ç±»æ‰€å®šä¹‰çš„ä¸€ä¸ªæˆ–å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ç»„æˆæ­¥éª¤ã€‚- æ¯ä¸€ä¸ªæŠ½è±¡æ¨¡æ¿è§’è‰²éƒ½å¯ä»¥æœ‰ä»»æ„å¤šä¸ªå…·ä½“æ¨¡æ¿è§’è‰²ä¸ä¹‹å¯¹åº”ï¼Œè€Œæ¯ä¸€ä¸ªå…·ä½“æ¨¡æ¿è§’è‰²éƒ½å¯ä»¥ç»™å‡ºè¿™äº›æŠ½è±¡æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯é¡¶çº§é€»è¾‘çš„ç»„æˆæ­¥éª¤ï¼‰çš„ä¸åŒå®ç°ï¼Œä»è€Œä½¿å¾—é¡¶çº§é€»è¾‘çš„å®ç°å„ä¸ç›¸åŒã€‚</code></pre><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p> å®ç°ä¸å˜çš„éƒ¨åˆ†ä¸€æ¬¡ï¼Œå¹¶å°†å…¶ä»–ç•™ç»™å­ç±»æ¥å®ç°å¯èƒ½éœ€è¦å˜åŒ–çš„è¡Œä¸ºã€‚</p><ul><li>éœ€è¦ç®€åŒ–ä»£ç ï¼Œåˆ†ç¦»å‡ºå…¬å…±çš„éƒ¨åˆ†ï¼ŒæŠ½ç¦»å‡ºä¸€ä¸ªå…¬å…±çš„æ¨¡æ¿æ–¹æ³•æ¥æ›¿æ¢æ‰€æœ‰çš„ä»£ç ã€‚</li><li>æ§åˆ¶å­ç±»æ‰©å±•ã€‚å®šä¹‰åœ¨ç‰¹å®šç‚¹è°ƒç”¨â€œé’©å­â€æ“ä½œçš„æ¨¡æ¿æ–¹æ³•ï¼Œä»è€Œä»…å…è®¸åœ¨é‚£äº›ç‚¹è¿›è¡Œæ‰©å±•ã€‚</li></ul><h2 id="æ¨¡å¼ç»“æ„"><a href="#æ¨¡å¼ç»“æ„" class="headerlink" title="æ¨¡å¼ç»“æ„"></a>æ¨¡å¼ç»“æ„</h2><p>è¿™é‡Œä½¿ç”¨åˆ°æ¨¡æ‹Ÿservletä¸­çš„httpServletæ–¹æ³•ï¼ˆç®€å•çš„æ¨¡æ‹Ÿæ–¹æ³•ä¸­ç”¨åˆ°çš„æ¨¡ç‰ˆæ–¹æ³•ï¼‰ã€‚å®šä¹‰ä¸€ä¸ªå…¬å…±çš„æ¨¡ç‰ˆæ–¹æ³•æŠ½è±¡ç±»<code>HttpServletTemplate</code>ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªé’©å­æ–¹æ³•<code>doGet</code>å’Œ<code>doPost</code>ï¼Œæ‰€è°“çš„é’©å­æ–¹æ³•å°±æ˜¯éœ€è¦ç”±å­ç±»å®ç°çš„æ–¹æ³•ã€‚è¿˜æœ‰ä¸€ä¸ªå…·ä½“æ–¹æ³•<code>service</code>æ¥å®ç°æ¨¡ç‰ˆè°ƒç”¨çš„ä½œç”¨ã€‚</p><p>æ¨¡æ‹Ÿä¸¤ä¸ªå­ç±»å®ç°<code>HttpServletTemplate</code>å®ç°ä¸¤ä¸ªé’©å­æ–¹æ³•ã€‚</p><p>å®¢æˆ·ç«¯<code>App</code>åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œç›´æ¥è°ƒç”¨ä¸¤ä¸ªå­ç±»çš„çˆ¶ç±»ä¸­çš„å®ç°æ–¹æ³•<code>service</code>å®ç°è°ƒç”¨æ¨¡ç‰ˆã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190617221808.png" alt="æ¨¡ç‰ˆæ¨¡å¼ç»“æ„"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><h3 id="æŠ½è±¡æ¨¡ç‰ˆç±»"><a href="#æŠ½è±¡æ¨¡ç‰ˆç±»" class="headerlink" title="æŠ½è±¡æ¨¡ç‰ˆç±»"></a>æŠ½è±¡æ¨¡ç‰ˆç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServletTemplate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpRequestMethod method)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(method.equals(HttpRequestMethod.METHOD_GET))&#123;</span><br><span class="line">            System.out.println(<span class="string">"so something 1"</span>);</span><br><span class="line">            doGet();</span><br><span class="line">            System.out.println(<span class="string">"so something 2"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(method.equals(HttpRequestMethod.METHOD_POST))&#123;</span><br><span class="line">            doPost();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"do nothing!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…·ä½“æ¨¡ç‰ˆç±»"><a href="#å…·ä½“æ¨¡ç‰ˆç±»" class="headerlink" title="å…·ä½“æ¨¡ç‰ˆç±»"></a>å…·ä½“æ¨¡ç‰ˆç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetClient</span> <span class="keyword">extends</span> <span class="title">HttpServletTemplate</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"this is my get methods!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PostClient</span> <span class="keyword">extends</span> <span class="title">HttpServletTemplate</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"this is my post methods!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¯·æ±‚ç±»å‹æšä¸¾ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> HttpRequestMethod &#123;</span><br><span class="line">    METHOD_GET,METHOD_POST,METHOD_DELETE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯è°ƒç”¨"><a href="#å®¢æˆ·ç«¯è°ƒç”¨" class="headerlink" title="å®¢æˆ·ç«¯è°ƒç”¨"></a>å®¢æˆ·ç«¯è°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å£°æ˜postå®¢æˆ·ç«¯</span></span><br><span class="line">        PostClient post = <span class="keyword">new</span> PostClient();</span><br><span class="line">        <span class="comment">//è°ƒç”¨æ¨¡ç‰ˆ</span></span><br><span class="line">        post.service(HttpRequestMethod.METHOD_POST);</span><br><span class="line">        GetClient get = <span class="keyword">new</span> GetClient();</span><br><span class="line">        get.service(HttpRequestMethod.METHOD_GET);</span><br><span class="line">        get.service(HttpRequestMethod.METHOD_POST);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼æ˜¯åˆ›å»ºä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œå…·ä½“çš„å†…å®¹ç”±å­ç±»å»å¡«å……çš„è¿™ä¸ªè¿‡ç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹è®¿é—®è€…æ¨¡å¼</title>
      <link href="/2019/06/15/2019-06-15-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/15/2019-06-15-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹è®¿é—®è€…æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹è®¿é—®è€…æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹è®¿é—®è€…æ¨¡å¼</h1><p>è®¿é—®è€…æ¨¡å¼æ˜¯ä¸€ç§å¤æ‚çš„è¡Œä¸ºæ¨¡å¼ã€‚è¡¨ç¤ºè¦å¯¹å¯¹è±¡ç»“æ„çš„å…ƒç´ æ‰§è¡Œçš„æ“ä½œã€‚è®¿é—®è€…å…è®¸å¯¹å¯¹è±¡ç»“æ„ä¸­çš„èŠ‚ç‚¹å®šä¹‰æ–°æ“ä½œï¼Œè€Œæ— éœ€æ›´æ”¹å…¶æ“ä½œçš„å…ƒç´ çš„ç±»ã€‚</p><p>é€‚ç”¨äºæ•°æ®ç»“æ„ç›¸å¯¹æœªå®šçš„ç³»ç»Ÿï¼Œå®ƒæŠŠæ•°æ®ç»“æ„å’Œä½œç”¨äºç»“æ„ä¸Šçš„æ“ä½œä¹‹é—´çš„è€¦åˆè§£è„±å¼€ï¼Œä½¿å¾—æ“ä½œé›†åˆå¯ä»¥ç›¸å¯¹è‡ªç”±åœ°æ¼”åŒ–ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p>å½“é‡åˆ°å¦‚ä¸‹æƒ…å†µæ—¶ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è®¿é—®è€…æ¨¡å¼ï¼š</p><ol><li>å¯¹è±¡ç»“æ„ä¸­åŒ…å«è®¸å¤šå…·æœ‰ä¸åŒæ¥å£çš„å¯¹è±¡ç±»ï¼Œå¹¶ä¸”å¸Œæœ›å¯¹ä¾èµ–äºå…¶å…·ä½“ç±»çš„è¿™äº›å¯¹è±¡æ‰§è¡Œæ“ä½œã€‚</li><li>éœ€è¦å¯¹å¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡æ‰§è¡Œè®¸å¤šä¸åŒä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œå¹¶ä¸”å¸Œæœ›é¿å…ä½¿ç”¨è¿™äº›æ“ä½œâ€œæ±¡æŸ“â€å®ƒä»¬çš„ç±»ã€‚è¿™æ—¶å°±å¯ä»¥å®šä¹‰å¤šä¸ªvisitorç±»æ¥å®Œæˆå¯¹å¤šä¸ªå¯¹è±¡èŠ‚ç‚¹çš„å¤„ç†ã€‚</li><li>å®šä¹‰å¯¹è±¡ç»“æ„çš„ç±»å¾ˆå°‘æ”¹å˜ï¼Œä½†æ˜¯ä½ ç»å¸¸æƒ³è¦åœ¨ç»“æ„ä¸Šå®šä¹‰æ–°çš„æ“ä½œã€‚</li></ol><h2 id="æ¨¡å¼ç»“æ„"><a href="#æ¨¡å¼ç»“æ„" class="headerlink" title="æ¨¡å¼ç»“æ„"></a>æ¨¡å¼ç»“æ„</h2><p><strong>ä¸¾ä¸ªä¾‹å­</strong>ï¼šåœ¨å…¬å¸ä¸­ï¼Œéœ€è¦ç»Ÿè®¡æ‰“å¡è®°å½•å’Œç»©æ•ˆï¼Œåˆ†åˆ«æœ‰è¡Œæ”¿éƒ¨é—¨å’Œè´¢åŠ¡éƒ¨é—¨æ¥å®ç°ã€‚å¹¶ä¸”å°†æ¥å¯èƒ½æœ‰è´¨é‡éƒ¨é—¨ç›‘æµ‹ç ”å‘å’Œå®æ–½äººå‘˜çš„å·¥ä½œè´¨é‡ã€‚ä½†æ˜¯å¯¹ç ”å‘å’Œå®æ–½äººå‘˜çš„è€ƒæ ¸æ ‡å‡†æœ‰æ‰€ä¸åŒã€‚</p><h3 id="ä¸€ã€ç±»å›¾"><a href="#ä¸€ã€ç±»å›¾" class="headerlink" title="ä¸€ã€ç±»å›¾"></a>ä¸€ã€ç±»å›¾</h3><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190616105829.png" alt="ç±»å›¾"></p><p><code>OperateStructure</code>ä½œä¸ºå¯¹è±¡<code>OperateNode</code>çš„æ•°æ®ç»“æ„,å¹¶ä¸”å®ç°ç±»<code>OperateNodeA</code>å’Œ<code>OperateNodeB</code>è¡Œä¸ºæ–¹æ³•æœ‰å„è‡ªçš„å®ç°ã€‚å¹¶ä¸”æƒ³åŸºäºè¿™ä¸ªç›¸å¯¹å›ºå®šçš„æ•°æ®ç»“æ„å®ç°å¤šç§ä¸åŒçš„æ“ä½œ<code>ï¼ˆvisitorï¼‰</code>ã€‚è¿™æ ·åœ¨å¢åŠ <code>visitor</code>çš„æ—¶å€™ä¸å¿…è€ƒè™‘æ•°æ®ç»“æ„ä¼šå‘ç”Ÿå˜æ›´ã€‚</p><h3 id="äºŒã€æ—¶åº"><a href="#äºŒã€æ—¶åº" class="headerlink" title="äºŒã€æ—¶åº"></a>äºŒã€æ—¶åº</h3><p>ç”±äºè°ƒç”¨è¿‡ç¨‹æ¯”è¾ƒä¸å®¹æ˜“çœ‹é€ï¼Œè¿™é‡Œæˆ‘å…ˆä½¿ç”¨æ—¶åºå›¾æ¥è¯´æ˜è°ƒç”¨é¡ºåº</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190616112121.png" alt="è°ƒç”¨è¿‡ç¨‹æ—¶åº"></p><h2 id="ä»£ç å®ä¾‹"><a href="#ä»£ç å®ä¾‹" class="headerlink" title="ä»£ç å®ä¾‹"></a>ä»£ç å®ä¾‹</h2><p>æ ¹æ®ç±»å›¾å¯ä»¥çœ‹å‡ºï¼Œè®¿é—®è€…æ¨¡å¼åˆ†ä¸ºäº”éƒ¨åˆ†ï¼šæŠ½è±¡èŠ‚ç‚¹è§’è‰² ã€å…·ä½“èŠ‚ç‚¹è§’è‰² ã€æŠ½è±¡è®¿é—®è€…è§’è‰² ã€å…·ä½“è®¿é—®è€…è§’è‰² ã€ç»“æ„å¯¹è±¡è§’è‰²</p><ul><li>æŠ½è±¡èŠ‚ç‚¹è§’è‰²ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">OperateNode</span> </span>&#123;</span><br><span class="line"><span class="comment">//  å®šä¹‰èŠ‚ç‚¹å†…éƒ½éœ€è¦å®ç°çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…·ä½“èŠ‚ç‚¹è§’è‰²ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…·ä½“èŠ‚ç‚¹A åœ¨å®ä¾‹ä¸­å¯¹åº”ç ”å‘äººå‘˜</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OperateNodeA</span> <span class="keyword">extends</span> <span class="title">OperateNode</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ç»©æ•ˆç³»æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> COEFFICIENT = <span class="number">1.2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> workDate;</span><br><span class="line"></span><br><span class="line">    OperateNodeA(<span class="keyword">int</span> workDate) &#123;</span><br><span class="line">        <span class="keyword">this</span>.workDate = workDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">attendance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> workDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">performance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> workDate * COEFFICIENT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å…·ä½“èŠ‚ç‚¹Bï¼Œåœ¨å®ä¾‹ä¸­å¯¹åº”è¿ç»´äººå‘˜</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OperateNodeB</span> <span class="keyword">extends</span> <span class="title">OperateNode</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COEFFICIENT = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> workDate;</span><br><span class="line"></span><br><span class="line">    OperateNodeB(<span class="keyword">int</span> workDate) &#123;</span><br><span class="line">        <span class="keyword">this</span>.workDate = workDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">attendance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> workDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">performance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> workDate * COEFFICIENT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŠ½è±¡è®¿é—®è€…è§’è‰²</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é’ˆå¯¹ç»“æ„ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹åˆ†åˆ«è¿›è¡Œå„è‡ªçš„æ“ä½œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(OperateNodeA operateNodeA)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(OperateNodeB operateNodeB)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…·ä½“è®¿é—®è€…è§’è‰²</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¡Œæ”¿äººå‘˜ç»“ç®—è€ƒå‹¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisitorA</span> <span class="keyword">implements</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">    <span class="comment">// éœ€è¦å¯¹å®æ–½äººå‘˜å¢åŠ è·¯ä¸Šçš„è€ƒå‹¤æ—¶é—´ æ¨¡å¼ä¸º2</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BASIC = <span class="number">2</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(OperateNodeA operateNodeA)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> att = operateNodeA.attendance();</span><br><span class="line">        System.out.println(<span class="string">"æœ¬æœˆè¯¥ç ”å‘äººå‘˜è€ƒå‹¤ä¸º"</span>+att + <span class="string">"å¤©"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(OperateNodeB operateNodeB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> att =operateNodeB.attendance() + BASIC;</span><br><span class="line">        System.out.println(<span class="string">"æœ¬æœˆè¯¥å®æ–½äººå‘˜è€ƒå‹¤ä¸º"</span>+att + <span class="string">"å¤©"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è´¢åŠ¡äººå‘˜ç»“ç®—ç»©æ•ˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisitorB</span> <span class="keyword">implements</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç ”å‘éœ€è¦æ·»åŠ é¢å¤–ç»©æ•ˆ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXTRA = <span class="number">2</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(OperateNodeA operateNodeA)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> att = operateNodeA.performance() + EXTRA;</span><br><span class="line">        System.out.println(<span class="string">"æœ¬æœˆè¯¥ç ”å‘äººå‘˜ç»©æ•ˆä¸º :"</span>+att );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(OperateNodeB operateNodeB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> att =operateNodeB.performance() ;</span><br><span class="line">        System.out.println(<span class="string">"æœ¬æœˆè¯¥ç ”å‘äººå‘˜ç»©æ•ˆä¸º :"</span>+att );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æ„å¯¹è±¡ç»“æ„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperateStructure</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ç»“æ„ä½“</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;OperateNode&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(OperateNode operateNode)</span></span>&#123;</span><br><span class="line">        list.add(operateNode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¯¹ç»“æ„ä½“ä¸­çš„å¯¹è±¡å®ç°æ¥æ”¶è®¿é—®æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">(Visitor visitor)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (OperateNode operateNode : list)&#123;</span><br><span class="line">        <span class="comment">// ç›®çš„å°±æ˜¯ä½¿ç”¨åŒé‡åˆ†æ´¾è°ƒç”¨æ¥å®ç°</span></span><br><span class="line">        <span class="comment">// èŠ‚ç‚¹æ¥å—è®¿é—®è€…ä¸è®¿é—®è€…è®¿é—®èŠ‚ç‚¹çš„æ“ä½œ</span></span><br><span class="line">            operateNode.accept(visitor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®¢æˆ·ç«¯è°ƒç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Visitor visitorA = <span class="keyword">new</span> VisitorA();</span><br><span class="line">        Visitor visitorB = <span class="keyword">new</span> VisitorB();</span><br><span class="line">        OperateStructure structure = <span class="keyword">new</span> OperateStructure();</span><br><span class="line">        structure.add(<span class="keyword">new</span> OperateNodeA(<span class="number">22</span>));</span><br><span class="line">        structure.add(<span class="keyword">new</span> OperateNodeB(<span class="number">22</span>));</span><br><span class="line">        structure.action(visitorA);</span><br><span class="line">        structure.action(visitorB);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æœ¬æœˆè¯¥ç ”å‘äººå‘˜è€ƒå‹¤ä¸º22å¤©</span><br><span class="line">æœ¬æœˆè¯¥å®æ–½äººå‘˜è€ƒå‹¤ä¸º24å¤©</span><br><span class="line">æœ¬æœˆè¯¥ç ”å‘äººå‘˜ç»©æ•ˆä¸º :28.4</span><br><span class="line">æœ¬æœˆè¯¥ç ”å‘äººå‘˜ç»©æ•ˆä¸º :22.0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹ä»£ç†æ¨¡å¼</title>
      <link href="/2019/06/14/2019-06-14-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/14/2019-06-14-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹ä»£ç†æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹ä»£ç†æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹ä»£ç†æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹ä»£ç†æ¨¡å¼</h1><p>ä»£ç†æ¨¡å¼æ˜¯å¯¹è±¡çš„ç»“æ„æ¨¡å¼ã€‚ä»£ç†æ¨¡å¼ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ol><li>è¿œç¨‹ä»£ç†ä¸åŒåœ°å€ç©ºé—´çš„å¯¹è±¡ï¼Œéƒ½å½“ä½œæœ¬åœ°åŒ–å¯¹è±¡æ¥å¤„ç†</li><li>æ§åˆ¶å¯¹è±¡çš„è®¿é—®æƒé™ã€‚</li></ol><p>å½“é‡åˆ°ä¸€ä¸‹æƒ…å†µæ˜¯å¯ä»¥ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼š</p><ul><li>æƒ³æ§åˆ¶å¯¹å¦ä¸€ä¸ªå¯¹è±¡çš„è®¿é—®</li><li>æ‡’åŠ è½½</li><li>æ§åˆ¶æ—¥å¿—è¾“å‡º</li><li>è®¡ç®—å¯¹è±¡å¼•ç”¨</li><li>æ§åˆ¶ç½‘ç»œé“¾æ¥é—®é¢˜</li></ul><h2 id="ä»£ç†æ¨¡å¼æ¨¡å¼ç»“æ„"><a href="#ä»£ç†æ¨¡å¼æ¨¡å¼ç»“æ„" class="headerlink" title="ä»£ç†æ¨¡å¼æ¨¡å¼ç»“æ„"></a>ä»£ç†æ¨¡å¼æ¨¡å¼ç»“æ„</h2><p>æµ´å®¤åˆ†ä¸ºç”·æµ´å®¤å’Œå¥³æµ´å®¤ï¼Œå…¶ä¸­å‰å°åˆ¤æ–­èƒ½å¤Ÿè¿›å…¥æµ´å®¤çš„å‰ææ˜¯æ²¡æœ‰çš®è‚¤ç—…ï¼Œå¦‚æœ‰æ²¡æœ‰ï¼Œæ‰è®©è¿›å…¥æµ´å®¤ã€‚è¿™é‡Œçš„å‰å°å°±æ˜¯ä¸€ä¸ªä»£ç†ï¼Œå®ƒä»£ç†æ¥æµ´å®¤ï¼Œç”¨æ¥åˆ¤æ–­èƒ½å¦è¿›å…¥æµ´å®¤çš„æƒé™ã€‚è¿™å°±æ˜¯ä»£ç†çš„ä½œç”¨ã€‚</p><p>ä»£ç†æ¨¡å¼å’Œè£…é¥°è€…æ¨¡å¼æ¯”è¾ƒå®¹æ˜“æ··æ·†ã€‚éœ€è¦è®°ä½çš„æ˜¯ï¼Œä¸¤è€…çš„åŠŸèƒ½åŒºåˆ«åœ¨äºï¼Œä»£ç†æ¨¡å¼æ”¹å˜çš„æ˜¯å¯¹è±¡çš„èŒèƒ½ï¼Œæ§åˆ¶å¯¹è±¡çš„è¡Œä¸ºã€‚è€Œè£…é¥°è€…æ¨¡å¼æ˜¯å¯¹èŒèƒ½çš„å¢åŠ å’Œå‡å°‘ã€‚ä½¿ç”¨åœºæ™¯ä¸Šæœ‰æ‰€ä¸åŒã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190614132147.png" alt="ä»£ç†æ¨¡å¼ç»“æ„å›¾"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ä»£ç†æ¨¡å¼å¤§è‡´èƒ½å¤Ÿåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæŠ½è±¡èŒèƒ½ç±»ï¼Œä»£ç†ç±»ï¼Œè¢«ä»£ç†ç±»</p><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡èŒèƒ½ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person åŸºæœ¬ä¿¡æ¯ç±» å’Œæ€§åˆ«æšä¸¾ </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SexEnum sex;</span><br><span class="line">    <span class="comment">//æ˜¯å¦æœ‰çš®è‚¤ç—…</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> hasSkinDisease;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, SexEnum sex, <span class="keyword">int</span> hasSkinDisease)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">        <span class="keyword">this</span>.hasSkinDisease = hasSkinDisease;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SexEnum <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHasSkinDisease</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hasSkinDisease;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SexEnum &#123;</span><br><span class="line">    MALE,FEMALE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŠ½è±¡èŒèƒ½</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BathRoom</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å»æ¾¡å ‚æ³¡æ¾¡</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> BathRoom <span class="title">enterBathroom</span><span class="params">(Person person)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒéƒ¨åˆ†ï¼šè¢«ä»£ç†ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MaleBathRoom</span> <span class="keyword">extends</span> <span class="title">BathRoom</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BathRoom <span class="title">enterBathroom</span><span class="params">(Person p)</span> </span>&#123;</span><br><span class="line">        String sexName = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span>(SexEnum.MALE.equals(p.getSex()))&#123;</span><br><span class="line">            sexName = SexEnum.MALE.toString();</span><br><span class="line">            System.out.println(<span class="string">"name : "</span>+ p.getName() +<span class="string">" sex: "</span>+ sexName +<span class="string">" go bath for male !"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼šä»£ç†ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BathRoomProxy</span> <span class="keyword">extends</span> <span class="title">BathRoom</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    BathRoom bathRoom;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BathRoomProxy</span><span class="params">(BathRoom bathRoom)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bathRoom = bathRoom;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BathRoom <span class="title">enterBathroom</span><span class="params">(Person person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (person.getHasSkinDisease() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.bathRoom.enterBathroom(person);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(person.getName() + <span class="string">" has disease."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Person p1 = <span class="keyword">new</span> Person(<span class="string">"1"</span>,SexEnum.MALE,<span class="number">0</span>);</span><br><span class="line">        Person p2 = <span class="keyword">new</span> Person(<span class="string">"2"</span>,SexEnum.MALE,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        BathRoomProxy bathRoomProxy = <span class="keyword">new</span> BathRoomProxy(<span class="keyword">new</span> MaleBathRoom());</span><br><span class="line">        bathRoomProxy.enterBathroom(p1).enterBathroom(p2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name : 1 sex: MALE go bath for male !</span><br><span class="line">2 has disease.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹äº«å…ƒæ¨¡å¼</title>
      <link href="/2019/06/13/2019-06-13-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/13/2019-06-13-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹äº«å…ƒæ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹äº«å…ƒæ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹äº«å…ƒæ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹äº«å…ƒæ¨¡å¼</h1><p>äº«å…ƒæ¨¡å¼æ˜¯å¯¹è±¡çš„ç»“æ„æ¨¡å¼ã€‚äº«å…ƒæ¨¡å¼ä»¥å…±äº«çš„æ–¹å¼é«˜æ•ˆåœ°æ”¯æŒå¤§é‡çš„ç»†ç²’åº¦å¯¹è±¡ã€‚å®ƒç”¨äºé€šè¿‡å°½å¯èƒ½å¤šåœ°ä¸ç±»ä¼¼å¯¹è±¡å…±äº«æ¥æœ€å°åŒ–å†…å­˜ä½¿ç”¨æˆ–è®¡ç®—å¼€é”€ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ol><li>åº”ç”¨ä¸­éœ€è¦å¤§é‡çš„å¯¹è±¡ï¼Œå¤§é‡çš„å¯¹è±¡å¯èƒ½é€ æˆå­˜å‚¨å¯¹è±¡çš„å¼€é”€ã€‚</li><li>å¯¹è±¡å˜åŒ–çš„çŠ¶æ€å¤§å¤šæ˜¯å¤–éƒ¨çŠ¶æ€ã€‚ä¸€æ—¦å¤–éƒ¨çŠ¶æ€è¢«ç§»é™¤ï¼Œè®¸å¤šå¯¹è±¡ç»„å¯è¢«ç›¸å¯¹è¾ƒå°‘çš„å…±äº«å¯¹è±¡æ›¿æ¢ã€‚è¿™ä¹Ÿå°±æ˜¯äº«å…ƒæ¨¡å¼åˆ©ç”¨çš„ç‚¹ã€‚</li><li>å› ä¸ºåœ¨äº«å…ƒæ¨¡å¼ä¸­å¯¹è±¡æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥åœ¨å«ä¹‰ä¸Šçš„ä¸åŒå¯¹è±¡ä½¿ç”¨equelså®é™…è¿”å›çš„æ˜¯trueã€‚</li></ol><h2 id="äº«å…ƒæ¨¡å¼ç»“æ„"><a href="#äº«å…ƒæ¨¡å¼ç»“æ„" class="headerlink" title="äº«å…ƒæ¨¡å¼ç»“æ„"></a>äº«å…ƒæ¨¡å¼ç»“æ„</h2><p>äº«å…ƒæ¨¡å¼é‡‡ç”¨ä¸€ä¸ªå…±äº«æ¥é¿å…å¤§é‡æ‹¥æœ‰ç›¸åŒå†…å®¹å¯¹è±¡çš„å¼€é”€ã€‚è¿™ç§å¼€é”€æœ€å¸¸è§ã€æœ€ç›´è§‚çš„å°±æ˜¯å†…å­˜çš„æŸè€—ã€‚äº«å…ƒå¯¹è±¡èƒ½åšåˆ°å…±äº«çš„å…³é”®æ˜¯åŒºåˆ†å†…è•´çŠ¶æ€(Internal State)å’Œå¤–è•´çŠ¶æ€(External State)ã€‚</p><p>å†…è•´çŠ¶æ€å†³å®šå¯¹è±¡æœ¬èº«çš„çŠ¶æ€ï¼Œä¸ä¼šéšç€ç¯å¢ƒçš„å˜åŒ–è€Œå˜åŒ–ï¼Œè€Œå¤–è•°çŠ¶æ€æ˜¯ç”±å®¢æˆ·ç«¯å°†çŠ¶æ€ä¼ é€’ç»™äº«å…ƒå¯¹è±¡çš„ï¼Œå¤–è•´çŠ¶æ€ç±»ä¼¼åŒä¸€ä¸ªå¯¹è±¡çš„ä¸åŒçš„è¡Œä¸ºï¼Œå†…è•´çŠ¶æ€å’Œå¤–è•°çŠ¶æ€æ˜¯ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å½±å“çš„ã€‚</p><p>äº«å…ƒæ¨¡å¼ä¸»è¦è¿™å‡ ä¸‰ä¸ªéƒ¨åˆ†ï¼šæŠ½è±¡äº«å…ƒç±»ï¼Œå…·ä½“äº«å…ƒç±»å’Œäº«å…ƒå·¥å‚ç±»ã€‚å…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢ä»£ç ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190613005252.png" alt="äº«å…ƒæ¨¡å¼"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>åœ¨Javaä¸­ï¼ŒStringç±»å°±ç¬¦åˆäº«å…ƒæ¨¡å¼ï¼Œ<code>string a = &quot;aa&quot;</code> å’Œ <code>string b =&quot;aa&quot;</code> æ˜¯ç›¸ç­‰çš„ã€‚</p><p>åœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼Œæ„é€ æŠ½è±¡äº«å…ƒç±»â€œMyStringâ€ å’Œå®ƒçš„å…·ä½“å®ç°ç±»ï¼Œä½¿ç”¨åˆ°ç›¸åŒçš„å¯¹è±¡ï¼Œå› ä¸ºäº«å…ƒæ¨¡å¼ï¼Œå¯ä»¥å¯¹è¿™äº›å¯¹è±¡è¿›è¡Œå…±äº«ä½¿ç”¨ã€‚</p><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡äº«å…ƒç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyString</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">create</span><span class="params">(String outerState)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æšä¸¾ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> InstanceType &#123;</span><br><span class="line">    INSTANCE1,INSTANCE2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒéƒ¨åˆ†ï¼šå…·ä½“äº«å…ƒç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringIns1</span> <span class="keyword">implements</span> <span class="title">MyString</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†…éƒ¨çŠ¶æ€ï¼Œä¸å¯éšæ—¶å˜åŒ–çš„</span></span><br><span class="line">    String innerState;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringIns1</span><span class="params">(String innerState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.innerState = innerState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">(String outerState)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"create instance 1 -&gt; innerState:"</span>+<span class="keyword">this</span>.innerState);</span><br><span class="line">        <span class="comment">//å¤–éƒ¨çŠ¶æ€ï¼Œéœ€è¦å®¢æˆ·ç«¯ä¼ è¿›æ¥ï¼Œè¿™ä¸ªå€¼æ˜¯å¯å˜åŒ–çš„</span></span><br><span class="line">        System.out.println(<span class="string">"create instance 1 -&gt; outerState:"</span>+outerState);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringIns2</span> <span class="keyword">implements</span> <span class="title">MyString</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String innerState;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringIns2</span><span class="params">(String innerState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.innerState = innerState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">(String outerState)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"create instance 2 -&gt; innerState:"</span>+<span class="keyword">this</span>.innerState);</span><br><span class="line">        System.out.println(<span class="string">"create instance 2 -&gt; outerState:"</span>+outerState);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼šäº«å…ƒå·¥å‚ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyWeight</span> </span>&#123;</span><br><span class="line">    Map&lt;InstanceType,MyString&gt; store;</span><br><span class="line"></span><br><span class="line">    FlyWeight() &#123;</span><br><span class="line">        store = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyString <span class="title">factory</span><span class="params">(InstanceType instanceType)</span></span>&#123;</span><br><span class="line">        MyString curr = store.get(instanceType);</span><br><span class="line">        <span class="keyword">if</span>(curr == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå¯¹è±¡ä¸å­˜åœ¨ï¼Œæ–°å»ºå¯¹åº”çš„å¯¹è±¡</span></span><br><span class="line">            <span class="keyword">if</span>(instanceType.equals(InstanceType.INSTANCE1))&#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®å†…éƒ¨çŠ¶æ€å†³å®šç”Ÿæˆå“ªä¸ªç±»å‹çš„å­ç±»</span></span><br><span class="line">                curr= <span class="keyword">new</span> StringIns1(instanceType.toString());</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(instanceType.equals(InstanceType.INSTANCE2))&#123;</span><br><span class="line">                curr= <span class="keyword">new</span> StringIns2(instanceType.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        store.put(instanceType,curr);</span><br><span class="line">        <span class="keyword">return</span> curr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬å››éƒ¨åˆ†ï¼šå®¢æˆ·ç«¯è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        FlyWeight flyWeight = <span class="keyword">new</span> FlyWeight();</span><br><span class="line">        MyString ins1 = flyWeight.factory(InstanceType.INSTANCE1);</span><br><span class="line">        MyString ins2 = flyWeight.factory(InstanceType.INSTANCE1);</span><br><span class="line">        System.out.println(ins1.equals(ins2));<span class="comment">//true æ˜¯åŒä¸€ä¸ªå¯¹è±¡ å†…éƒ¨çŠ¶æ€ç›¸åŒ</span></span><br><span class="line">        ins1.create(<span class="string">"*****"</span>); <span class="comment">//é’ˆå¯¹å¤–éƒ¨çŠ¶æ€æ‰“å°ä¸åŒå†…å®¹</span></span><br><span class="line">        ins2.create(<span class="string">"-----"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">true</span><br><span class="line">create instance 1 -&gt; innerState:INSTANCE1</span><br><span class="line">create instance 1 -&gt; outerState:*****</span><br><span class="line">create instance 1 -&gt; innerState:INSTANCE1</span><br><span class="line">create instance 1 -&gt; outerState:-----</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹å¤–è§‚æ¨¡å¼</title>
      <link href="/2019/06/12/2019-06-12-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/12/2019-06-12-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹å¤–è§‚æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹å¤–è§‚æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹å¤–è§‚æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹å¤–è§‚æ¨¡å¼</h1><p>å¤–éƒ¨ä¸ä¸€ä¸ªå­ç³»ç»Ÿçš„é€šä¿¡å¿…é¡»é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¤–è§‚å¯¹è±¡è¿›è¡Œï¼Œä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼Œä½¿å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li>å› ä¸ºå­ç³»ç»Ÿéšç€å‘å±•ä¼šå˜æ›´çš„æ›´å¤æ‚ï¼Œå®¢æˆ·ç«¯æƒ³æ›´ç®€å•ç»Ÿä¸€ç»™å­ç³»ç»Ÿå»ºç«‹ä¸€ä¸ªå…¬å…±çš„è°ƒç”¨æ–¹å¼ã€‚è¿™æ ·å³ä½¿å­ç³»ç»Ÿçš„å†å¢åŠ å¯é‡ç”¨æ€§è€Œå˜å¾—æ›´åŠ å¤æ‚ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¸å¿…çŸ¥é“ï¼Œå› ä¸ºå®¢æˆ·ç«¯å¾€å¾€ä¸éœ€è¦é’ˆå¯¹æŸä¸€ä¸ªå­ç³»ç»Ÿè¿›è¡Œç‰¹å®šçš„å®šåˆ¶åŒ–ã€‚</li><li>å®ç°äº†å­ç³»ç»Ÿä¸å®¢æˆ·ä¹‹é—´çš„æ¾è€¦åˆå…³ç³»ï¼Œè¿™ä½¿å¾—å­ç³»ç»Ÿçš„ç»„ä»¶å˜åŒ–ä¸ä¼šå½±å“åˆ°è°ƒç”¨å®ƒçš„å®¢æˆ·ç±»ï¼Œåªéœ€è¦è°ƒæ•´å¤–è§‚ç±»å³å¯ã€‚</li></ul><h2 id="æ¨¡å¼ç»“æ„"><a href="#æ¨¡å¼ç»“æ„" class="headerlink" title="æ¨¡å¼ç»“æ„"></a>æ¨¡å¼ç»“æ„</h2><p>å¤–è§‚æ¨¡å¼ä¸­å®¢æˆ·ç«¯ä¾é Facadeç±»æ¥è°ƒç”¨å¤šä¸ªå­ç³»ç»Ÿï¼Œæ¥è¾¾åˆ°ç®€åŒ–å®¢æˆ·ç«¯è°ƒç”¨çš„ç›®çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190613005252.png" alt="å¤–è§‚æ¨¡å¼"></p><p>ä¾‹å­ä¸­ï¼Œæ¯æ¬¡å¼€æœºçš„æ—¶å€™éƒ½è¦å¯åŠ¨mysql,apacheæœåŠ¡ï¼Œä¸¤ä¸ªè¿˜å¥½ï¼Œè¦æ˜¯æœ‰æ›´å¤šæœåŠ¡å²‚ä¸æ˜¯å¾ˆæ¼äººï¼Œæ¯æ¬¡éƒ½è¦æ•²ä¸€å¤§å †å‘½ä»¤æ¥å¼€å¯æœåŠ¡ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œå°†æ‰€æœ‰æœåŠ¡åŠ å…¥åˆ°å¤–è§‚ç±»ä¸­ï¼Œæ¯æ¬¡å¼€æœºåªç”¨è°ƒç”¨å¤–è§‚ç±»ä¸­çš„æ¥å£å°±è¡Œäº†ã€‚æ¥è¾¾åˆ°ç®€åŒ–å®¢æˆ·ç«¯ä½¿ç”¨çš„ç›®çš„ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šå­ç³»ç»Ÿæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Services</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// mysql æœåŠ¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MysqlService</span> <span class="keyword">implements</span> <span class="title">Services</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"mysql is started"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"mysql is stopped"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"mysql is restart"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// apache æœåŠ¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApacheService</span> <span class="keyword">implements</span> <span class="title">Services</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"apache is started"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"apache is stopped"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"apache is restart"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒéƒ¨åˆ†ï¼šå¤–è§‚ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Facade</span> </span>&#123;</span><br><span class="line">    List&lt;Services&gt; services;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Facade</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        services = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addService</span><span class="params">(Services services)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.services.add(services);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Services services : <span class="keyword">this</span>.services)&#123;</span><br><span class="line">            services.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Services services : <span class="keyword">this</span>.services)&#123;</span><br><span class="line">            services.stop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Services services : <span class="keyword">this</span>.services)&#123;</span><br><span class="line">            services.restart();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®¢æˆ·ç«¯è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Facade facade = <span class="keyword">new</span> Facade();</span><br><span class="line">        facade.addService(<span class="keyword">new</span> MysqlService());</span><br><span class="line">        facade.addService(<span class="keyword">new</span> ApacheService());</span><br><span class="line">        facade.start();</span><br><span class="line">        facade.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql is started</span><br><span class="line">apache is started</span><br><span class="line">mysql is stopped</span><br><span class="line">apache is stopped</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹è£…é¥°è€…æ¨¡å¼</title>
      <link href="/2019/06/10/2019-06-10-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/10/2019-06-10-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹è£…é¥°è€…æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹è£…é¥°è€…æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹è£…é¥°è€…æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹è£…é¥°è€…æ¨¡å¼</h1><p>å¯ä»¥åŠ¨æ€åœ°å°†é™„åŠ èŒè´£é™„åŠ ç»™å¯¹è±¡ã€‚è£…é¥°å™¨ä¸ºå­ç±»åŒ–çš„æ–¹å¼æä¾›äº†çµæ´»çš„æ›¿ä»£æ‰©å±•åŠŸèƒ½ã€‚æ¯”å¦‚åšæ¢¦æ¢¦åˆ°äº†äº¤ä¸ªå¥³æœ‹å‹ï¼Œå¥¹çš„å‘å‹ï¼Œå‘è‰²ï¼Œç©¿ç€éƒ½æ˜¯æ ¹æ®åœºæ™¯åšæ¢¦æ¢¦åˆ°çš„æ—¶å€™é™„åŠ ä¸Šå»çš„ã€‚è¿™æ—¶ï¼Œå°±åº”è¯¥å¯¹â€œå¥³æœ‹å‹â€è¿™ä¸ªå¯¹è±¡å®è¡Œè£…é¥°è€…æ¨¡å¼æ¥åŠ¨æ€çš„ã€çµæ´»çš„æ‹“å±•ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ol><li>åŠ¨æ€ä¸”é€æ˜åœ°å‘å„ä¸ªå¯¹è±¡æ·»åŠ èŒè´£çš„åŒæ—¶ä¸å½±å“å…¶ä»–å¯¹è±¡ã€‚</li><li>çµæ´»çš„å¯æ’¤å›èŒè´£ã€‚</li><li>æœ‰æ—¶å€™éœ€è¦å¾ˆå¤šå­ç±»æ¥ç”¨äºæ”¯æŒæ¯ç§åŠŸèƒ½çš„ç»„åˆï¼Œè¿™æ ·æ¯æ¬¡å¢åŠ ä¸€ç§åŠŸèƒ½æ‹“å±•å°±è¦å¢åŠ å¾ˆå¤šå­ç±»çš„æƒ…å†µã€‚æ˜¾ç„¶è¿™æ ·æ˜¯ä¸ç¬¦åˆè¦æ±‚çš„ã€‚æ‰€ä»¥é‡åˆ°è¿™ç§å¤šåŠŸèƒ½æ‹“å±•æ—¶ï¼Œéœ€è¦ä½¿ç”¨è£…é¥°è€…æ¨¡å¼æ¥è§£å†³ã€‚</li></ol><h2 id="è£…é¥°è€…æ¨¡å¼ç»“æ„"><a href="#è£…é¥°è€…æ¨¡å¼ç»“æ„" class="headerlink" title="è£…é¥°è€…æ¨¡å¼ç»“æ„"></a>è£…é¥°è€…æ¨¡å¼ç»“æ„</h2><p>è£…é¥°è€…æ¨¡å¼å¯ä»¥å¤§è‡´åˆ†ä¸ºå››ç§ç»“æ„ï¼ˆæœ¬ä¾‹å­ä¸­çš„æŠ½è±¡æ„ä»¶å’ŒæŠ½è±¡è£…é¥°ç±»ä¸ºä¸€ä¸ªï¼‰æŠ½è±¡æ„ä»¶ï¼Œå…·ä½“æ„ä»¶ï¼ŒæŠ½è±¡è£…é¥°ç±»ï¼Œå®é™…è£…é¥°ç±»ã€‚</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190610190339.png" alt="è£…é¥°è€…æ¨¡å¼"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡æ„ä»¶ä¸æŠ½è±¡è£…é¥°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¶é€ ä¸€ä¸ªå‡æƒ³çš„â€œå¥³æœ‹å‹â€</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractGirl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dyeHair</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">wearClothes</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒéƒ¨åˆ†ï¼šå®ç°ç»„ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºæœ¬çš„åŠŸèƒ½å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalGirl</span> <span class="keyword">extends</span> <span class="title">AbstractGirl</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dyeHair</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"normal hair"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wearClothes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"normal clothes"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼šé™„åŠ è£…é¥°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å·¥ä½œä¸­çš„å¥³å­© ç©¿æ­£è£…</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WorkGirl</span> <span class="keyword">extends</span> <span class="title">AbstractGirl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    AbstractGirl abstractGirl;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WorkGirl</span><span class="params">(AbstractGirl abstractGirl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.abstractGirl = abstractGirl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wearClothes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        abstractGirl.wearClothes();</span><br><span class="line">        System.out.println(<span class="string">"wearClothes after : "</span>);</span><br><span class="line">        System.out.println(<span class="string">"wear formal clothes"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®é™…å‡ºå»é€›è¡—çš„å¥³å­©åº”è¯¥æ˜¯è¿™æ ·çš„</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FashionGirl</span> <span class="keyword">extends</span> <span class="title">AbstractGirl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    AbstractGirl abstractGirl;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FashionGirl</span><span class="params">(AbstractGirl abstractGirl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.abstractGirl = abstractGirl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dyeHair</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        abstractGirl.dyeHair();</span><br><span class="line">        System.out.println(<span class="string">"dyeHair after : "</span>);</span><br><span class="line">        System.out.println(<span class="string">"dye blue hair"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wearClothes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        abstractGirl.wearClothes();</span><br><span class="line">        System.out.println(<span class="string">"wearClothes after : "</span> );</span><br><span class="line">        System.out.println(<span class="string">"wear rock type clothes"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        abstractGirl.pack();</span><br><span class="line">        System.out.println(<span class="string">"wearClothes after : "</span> );</span><br><span class="line">        System.out.println(<span class="string">"take fashion pack"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå®¢æˆ·ç«¯çš„è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å…ˆåˆ¶é€ ä¸€ä¸ªæ•´ä½“ç»„ä»¶</span></span><br><span class="line">        AbstractGirl normalGirl = <span class="keyword">new</span> NormalGirl();</span><br><span class="line">        normalGirl.dyeHair();</span><br><span class="line">        <span class="comment">// ä¸ºç»„ä»¶æ·»åŠ è£…é¥°ï¼Œæ¯”å¦‚è¿™é‡ŒåŠ äº†ä¸ªæ—¶å°šçš„åŒ…åŒ…</span></span><br><span class="line">        AbstractGirl fashionHair = <span class="keyword">new</span> FashionGirl(normalGirl);</span><br><span class="line">        fashionHair.pack();</span><br><span class="line">        <span class="comment">//ç©¿ä¸€å¥—æ­£è£…</span></span><br><span class="line">        AbstractGirl workClose = <span class="keyword">new</span> WorkGirl(fashionHair);</span><br><span class="line">        workClose.wearClothes();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹æ¡¥æ¥æ¨¡å¼</title>
      <link href="/2019/06/03/2019-06-03-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/03/2019-06-03-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹æ¡¥æ¥æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹æ¡¥æ¥æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹æ¡¥æ¥æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹æ¡¥æ¥æ¨¡å¼</h1><p>ç›®çš„åœ¨äºå°†æŠ½è±¡ä¸å…¶å®ç°åˆ†ç¦»ï¼Œä»¥ä¾¿ä¸¤è€…å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚ç‹¬ç«‹å˜åŒ–çš„åŒæ—¶èƒ½å¤Ÿæ ¹æ®æŠ½è±¡ç±»çš„å¯¹è±¡å…³è”ä»è€Œèƒ½å¤Ÿå°†ä¸¤ä¸ªç»§æ‰¿ç»“æ„è”åŠ¨èµ·æ¥ã€‚å°±åƒåœ¨ä¸¤ä¸ªç»“æ„ä¹‹é—´å»ºç«‹ä¸ªæ¡¥æ¢ä¸€æ ·è¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥å«æ¡¥æ¥æ¨¡å¼ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ol><li>å¦‚æœæƒ³é¿å…æŠ½è±¡ç±»ä¸å®ç°çš„æ°¸ä¹…ç»‘å®šï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é—´é€‰æ‹©å’Œåˆ‡æ¢å®ç°ç±»ã€‚</li><li>æŠ½è±¡ç±»å’Œæ¥å£éƒ½åº”è¯¥é€šè¿‡å­ç±»æ¥è¿›è¡Œæ‹“å±•ï¼Œåœ¨æ¡¥æ¥æ¨¡å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å­ç±»æ¥è¿›è¡Œç»„åˆçš„åŒæ—¶èƒ½å¤Ÿç‹¬ç«‹æ‹“å±•ä»–ä»¬ã€‚</li><li>æ¥å£çš„å®ç°çš„å˜åŒ–å¯¹å®¢æˆ·ç«¯æ— å½±å“ã€‚</li><li>å¦‚æœæƒ³è¦åœ¨å¤šä¸ªå¯¹è±¡ç±»ä¸­å…±äº«å®ç°ï¼Œå¹¶ä¸”é¿å…è®©å®¢æˆ·ç«¯æ„ŸçŸ¥åˆ°ã€‚</li></ol><h2 id="æ¡¥æ¥æ¨¡å¼ç»“æ„å›¾"><a href="#æ¡¥æ¥æ¨¡å¼ç»“æ„å›¾" class="headerlink" title="æ¡¥æ¥æ¨¡å¼ç»“æ„å›¾"></a>æ¡¥æ¥æ¨¡å¼ç»“æ„å›¾</h2><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190603220348.png" alt="æ¡¥æ¥æ¨¡å¼"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ä¸»è¦åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œ1.æŠ½è±¡ç±» 2.æŠ½è±¡å®ç°ç±» 3.æ¥å£ç±» 4.æ¥å£å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// æŠ½è±¡ç±»ä¸æŠ½è±¡å®ç°ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Colors colors;</span><br><span class="line"></span><br><span class="line">    Shape(Colors colors) &#123;</span><br><span class="line">        <span class="keyword">this</span>.colors = colors;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildShape</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ†å½¢å®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeCircle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShapeCircle</span><span class="params">(Colors colors)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(colors);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildShape</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"\n first step : build circle\n and second step:"</span>);</span><br><span class="line">        colors.paint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ–¹å½¢å®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeSquare</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShapeSquare</span> <span class="params">(Colors colors)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(colors);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildShape</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"\n first step : build Square\n and second step:"</span>);</span><br><span class="line">        colors.paint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠ½è±¡æ–¹æ³•ä¸­å¼•ç”¨äº†Colorsç±»å˜é‡ï¼Œä½¿ç”¨å®ç°ç±»ä¸­çš„buildShapeæ–¹æ³•å®ç°å…·ä½“åŠŸèƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Colors</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorBlue</span> <span class="keyword">implements</span> <span class="title">Colors</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">" print blue !!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorRed</span> <span class="keyword">implements</span> <span class="title">Colors</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">" paint inner with red !!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨Coloræ¥å£ï¼Œå®ç°ç±»å®ç°Colorsä¸­çš„paintæ–¹æ³•å®ç°Color</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Shape circle = <span class="keyword">new</span> ShapeCircle(<span class="keyword">new</span> ColorBlue());</span><br><span class="line">        circle.buildShape();</span><br><span class="line">        Shape square = <span class="keyword">new</span> ShapeSquare(<span class="keyword">new</span> ColorRed());</span><br><span class="line">        square.buildShape();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœï¼š</span><br><span class="line"></span><br><span class="line"> first step : build circle</span><br><span class="line"> and second step:</span><br><span class="line"> print blue !!</span><br><span class="line"></span><br><span class="line"> first step : build Square</span><br><span class="line"> and second step:</span><br><span class="line"> paint red !!</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé¢œè‰²å’Œå›¾å½¢æ˜¯ä¸¤ä¸ªç‹¬ç«‹ä¸åŒçš„ç»´åº¦ï¼Œä¸¤ä¸ªå¯ä»¥åˆ†åˆ«å˜åŒ–ã€‚å°†ä¸¤ä¸ªç»´åº¦è®¾è®¡ä¸ºä¸¤ä¸ªä¸åŒçš„ç»§æ‰¿çš„ç»“æ„ï¼Œåœ¨ä¸¤ä¸ªç»“æ„ä¹‹é—´ä½¿ç”¨åœ¨æŠ½è±¡ç±»ä¸­çš„å…³è”æ¥è¾¾åˆ°é“¾æ¥çš„ç›®çš„ï¼Œè¿™ä¸ªé“¾æ¥æˆä¸ºä¸¤ä¸ªç»§æ‰¿ç»“æ„é€šä¿¡çš„æ¡¥æ¢ã€‚æ‰€ä»¥ä¸ºæ¡¥æ¥æ¨¡å¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹é€‚é…å™¨æ¨¡å¼</title>
      <link href="/2019/06/02/2019-06-02-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/02/2019-06-02-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹é€‚é…å™¨æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹é€‚é…å™¨æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹é€‚é…å™¨æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹é€‚é…å™¨æ¨¡å¼</h1><p>æˆ‘ä»¬å®é™…ä¸­ä¼šç”¨åˆ°ä¸¤ä¸ªä¸åŒæ¥å£çš„ç±»çš„é€šä¿¡,åœ¨ä¸ä¿®æ”¹ä¸¤ä¸ªç±»çš„å‰æä¸‹,ä½¿ç”¨æ–°çš„ä¸­é—´ç±»æ¥å®Œæˆè¡”æ¥çš„è¿‡ç¨‹,è¿™ä¸ªä¸­é—´ä»¶å°±æ˜¯é€‚é…å™¨.å¯ä»¥è®©ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ¥å£ç›¸äº’è½¬åŒ–.</p><p>é€‚é…å™¨æ¨¡å¼å…è®¸åœ¨é€‚é…å™¨ä¸­åŒ…è£…å…¶ä»–ä¸å…¼å®¹çš„å¯¹è±¡ï¼Œä»¥ä½¿å…¶ä¸å¦ä¸€ä¸ªç±»å…¼å®¹ã€‚</p><p>å°±å¦‚åŒç”Ÿæ´»ä¸­ä¹°äº†æ¸¯ç‰ˆçš„æ‰‹æœº,ä½†æ˜¯é™„èµ çš„æ˜¯ä¸‰è„šæ’å¤´ï¼Œè€Œå¤§é™†ä¸Šç”¨çš„æ˜¯ä¸¤è„šçš„ï¼Œéœ€è¦ä¸€ä¸ªé€‚é…å™¨æ¥å°†ä¸‰è§’æ’å¤´è½¬æ¢ä¸ºä¸¤è„šçš„ã€‚å…¶ä¸­è¿™ä¸ªä¸­é—´ä»¶å°±æ˜¯é€‚é…å™¨ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li>å½“ä½ æƒ³è¦è¿™ä¸ªç±»ï¼Œä½†æ˜¯ç±»ä¸­çš„æ¥å£ä¸æƒ³ç”¨çš„æ¥å£å¹¶ä¸åŒ¹é…</li><li>å½“æƒ³è¦å»åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨çš„ç±»ï¼Œè®©å®ƒä¸ä¸ç›¸å…³æˆ–ä¸å¯é¢„è§çš„ç±»åˆä½œï¼Œè¿™ä¸ªç±»ä¸å¿…è¦æœ‰å…¼å®¹çš„æ¥å£</li><li>å½“ä½ éœ€è¦ä¸€ç³»åˆ—çš„å­ç±»çš„æ—¶å€™ï¼Œå¦‚æœæƒ³è¦è°ƒæ•´è¿™äº›å­ç±»çš„æ¥å£æ–¹æ³•çš„æ—¶å€™ï¼Œå¯¹æ¯ä¸€ä¸ªæ¥å£å­ç±»åŒ–çš„è¿™ç§æ–¹æ³•æ˜¯ä¸å¯è¡Œçš„ã€‚è¿™æ—¶å°±å¯ä½¿ç”¨é€‚é…å™¨é€‚é…è¿™äº›å­ç±»çš„å¤«ç±»ã€‚</li></ul><h2 id="ç»“æ„å›¾"><a href="#ç»“æ„å›¾" class="headerlink" title="ç»“æ„å›¾"></a>ç»“æ„å›¾</h2><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190602120227.png" alt="é€‚é…å™¨æ¨¡å¼å›¾"></p><p>ä½¿ç”¨clientè°ƒç”¨é€‚é…å™¨ï¼Œé€‚é…å™¨ç»§æ‰¿ä¸ä¸‰è„šæ’å¤´ï¼Œä¾èµ–äºäºŒè„šæ’å¤´ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸‰è„šæ’å¤´çš„æ¥å£è°ƒç”¨äºŒè„šæ’å¤´çš„æ–¹æ³•ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸‰è§’æ’å¤´</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> nanyin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 11:13 2019-06-02</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreeLeggedPlug</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charge</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"use three legged plug"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äºŒè„šæ’å¤´</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> nanyin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 11:13 2019-06-02</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TwoLeggedPlug</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fastCharge</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"use two legged plug for fast charge !"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é€‚é…å™¨ ç»§æ‰¿ä¸‰è§’æ’å¤´</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TwoLeggedPlugAdapter</span> <span class="keyword">extends</span> <span class="title">ThreeLeggedPlug</span> </span>&#123;</span><br><span class="line">    TwoLeggedPlug twoLeggedPlug;</span><br><span class="line">    <span class="comment">// ä¾èµ–äºäºŒè„šæ’å¤´</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TwoLeggedPlugAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        twoLeggedPlug = <span class="keyword">new</span> TwoLeggedPlug();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨ä¸‰è§’æ’å¤´çš„chargeæ–¹æ³•ï¼Œè°ƒç”¨äºŒè„šæ’å¤´çš„fastChargeæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        twoLeggedPlug.fastCharge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŸS9æ¸¯ç‰ˆæ‰‹æœº</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">S9Plus</span> <span class="keyword">extends</span> <span class="title">ThreeLeggedPlug</span> </span>&#123;</span><br><span class="line">    ThreeLeggedPlug threeLeggedPlug;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">S9Plus</span><span class="params">(ThreeLeggedPlug threeLeggedPlug)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.threeLeggedPlug = threeLeggedPlug;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        threeLeggedPlug.charge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®¢æˆ·ç«¯æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCharge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸ä½¿ç”¨é€‚é…å™¨ ä½¿ç”¨ç±»ä¸‰è§’æ’å¤´</span></span><br><span class="line">        ThreeLeggedPlug s9Plus = <span class="keyword">new</span> S9Plus(<span class="keyword">new</span> ThreeLeggedPlug());</span><br><span class="line">        s9Plus.charge();</span><br><span class="line">        <span class="comment">// ä½¿ç”¨äºŒè„šæ’å¤´çš„é€‚é…å™¨</span></span><br><span class="line">        ThreeLeggedPlug s9PlusUseTwoLeggedPlug = <span class="keyword">new</span> S9Plus(<span class="keyword">new</span> TwoLeggedPlugAdapter());</span><br><span class="line">        s9PlusUseTwoLeggedPlug.charge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç»“æœï¼š</span><br><span class="line"></span><br><span class="line">use three legged plug</span><br><span class="line">use two legged plug for fast charge !</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹åŸå‹æ¨¡å¼</title>
      <link href="/2019/06/02/2019-06-02-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/02/2019-06-02-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹åŸå‹æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹åŸå‹æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹åŸå‹æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹åŸå‹æ¨¡å¼</h1><p>ä½¿ç”¨åŸå‹å®ä¾‹æŒ‡å®šè¦åˆ›å»ºçš„å¯¹è±¡ç±»å‹ï¼Œå¹¶é€šè¿‡å¤åˆ¶æ­¤åŸå‹æ¥åˆ›å»ºæ–°å¯¹è±¡.å®ç°æ–¹æ³•:é€šè¿‡å…‹éš†æ–¹æ³•,å®ç°å¯¹ç°æœ‰å¯¹è±¡çš„å¤åˆ¶å…‹éš†.</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li>å½“è¦åœ¨è¿è¡Œæ—¶æŒ‡å®šè¦å®ä¾‹åŒ–çš„ç±»æ—¶ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡åŠ¨æ€åŠ è½½.</li><li>é¿å…æ„å»ºä¸äº§å“ç±»å±‚æ¬¡ç»“æ„ç›¸ä¼¼çš„å·¥å‚ç±»å±‚æ¬¡ç»“æ„</li><li>å½“ä¸€ä¸ªç±»çš„å®ä¾‹å¯ä»¥åªæœ‰å‡ ä¸ªä¸åŒçš„çŠ¶æ€çš„ç»„åˆä¹‹ä¸€æ—¶.ç»„è£…ç›¸åº”æ•°é‡çš„åŸå‹å¹¶å…‹éš†å®ƒä»¬å¯èƒ½æ›´æ–¹ä¾¿ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨å®ä¾‹åŒ–ç±»ï¼Œæ¯æ¬¡éƒ½æœ‰é€‚å½“çš„çŠ¶æ€.</li><li>ä¸å¯¹è±¡åˆ›å»ºç›¸æ¯”,ä½¿ç”¨å…‹éš†æˆæœ¬æ›´ä½</li></ul><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ç›´æ¥ç”±ä»£ç çœ‹ç»“æ„,å…¶å®å…‹éš†çš„è¿‡ç¨‹å°±æ˜¯åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸€ä¸ªç»†èƒ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> nanyin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 23:49 2019-06-01</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cell</span> <span class="keyword">implements</span> <span class="title">Cloneable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Cell</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Cell</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Cell <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.clone();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cell(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ç¨‹åº:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPrototype</span><span class="params">()</span></span>&#123;</span><br><span class="line">       Cell cell = <span class="keyword">new</span> Cell();</span><br><span class="line">       cell.setName(<span class="string">"org"</span>);</span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           Cell cloneCell = cell.clone();</span><br><span class="line">           Assert.assertEquals(<span class="string">"org"</span>,cloneCell.getName());<span class="comment">//pass</span></span><br><span class="line">           Assert.assertEquals(cell,cloneCell);<span class="comment">//not pass</span></span><br><span class="line">       &#125;<span class="keyword">catch</span> (CloneNotSupportedException e)&#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼</title>
      <link href="/2019/06/01/2019-06-01-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/01/2019-06-01-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼</h1><p>å°†å¤æ‚å¯¹è±¡çš„æ„é€ ä¸å…¶è¡¨ç¤ºåˆ†å¼€ï¼Œä»¥ä¾¿ç›¸åŒçš„æ„é€ è¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚</p><p>æ¯”å¦‚åœ¨ç©æ¸¸æˆæ—¶çš„æäººç‰©çš„æ—¶å€™,åˆ›å»ºä¸€ä¸ªæ¸¸æˆä»»åŠ¡æœ€ç®€å•çš„æ–¹æ³•æ—¶è®¡ç®—æœºè‡ªå·±ç”Ÿæˆä¸€ä¸ªå›ºå®šçš„æ¸¸æˆä»»åŠ¡,ä½†æ˜¯æƒ³è‡ªå·±æ„å»ºè¿™ä¸ªäººç‰©ç»†èŠ‚çš„æ—¶å€™,è¿™ç§æƒ…å†µä¸‹,äººç‰©çš„ç”Ÿæˆæ—¶ä¸€æ­¥ä¸€æ­¥ç”Ÿæˆçš„.å†å½“æ‰€æœ‰ç±»å‹éƒ½é€‰æ‹©å®Œæˆå,æ‰èƒ½å¤Ÿåˆ›å»ºè¿™ä¸ªäººç‰©.</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li>å¯¹è±¡è¶³å¤Ÿå¤æ‚,åˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•åº”ä¸åˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„ç»„ä»¶å’Œç»„è£…æ–¹å¼åˆ†å¼€.</li><li>å½“æ„é€ å¯¹è±¡æ—¶è¦æ±‚å¯¹è¿™ä¸ªå¯¹è±¡å…·æœ‰ä¸åŒçš„è¡Œä¸º.</li></ul><h2 id="å»ºé€ è€…æ¨¡å¼ç»“æ„"><a href="#å»ºé€ è€…æ¨¡å¼ç»“æ„" class="headerlink" title="å»ºé€ è€…æ¨¡å¼ç»“æ„"></a>å»ºé€ è€…æ¨¡å¼ç»“æ„</h2><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190601231729.png" alt="å»ºé€ è€…æ¨¡å¼ç±»å›¾"></p><p>ä¸Šå›¾ä¸ºå»ºé€ è€…æ¨¡å¼ç±»å›¾:å…¶ä¸­CharacterBuilder å’Œ Characters ä¸­çš„å±æ€§ç›¸åŒ,CharacterBuilder å­˜åœ¨çš„ç›®çš„å°±æ˜¯å¤šç§æ„é€ ä¸åŒè¡Œä¸ºçš„Characters .</p><p>å…·ä½“å¯ä»¥çœ‹ä¸‹é¢ä»£ç å®ä¾‹</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>è§’è‰²å®ä½“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Characters</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è§’è‰²æ„é€ å™¨å†…æœ‰å¤šä¸ªè§’è‰²å±æ€§</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String skill;</span><br><span class="line">    <span class="keyword">private</span> String weapon;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ„é€ å™¨æ¥æ„é€ å®ä½“ å…¶ä¸­å®ä½“å±æ€§æœ‰builderä¸­æ¥</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Characters</span><span class="params">(CharacterBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = builder.getName();</span><br><span class="line">        <span class="keyword">this</span>.age = builder.getAge();</span><br><span class="line">        <span class="keyword">this</span>.sex = builder.getSex();</span><br><span class="line">        <span class="keyword">this</span>.skill = builder.getSkill();</span><br><span class="line">        <span class="keyword">this</span>.weapon = builder.getWeapon();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showCharacterBoard</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"äººç‰© ï¼š "</span> + <span class="keyword">this</span>.name + <span class="string">" å¹´é¾„ ï¼š"</span> + <span class="keyword">this</span>.age + <span class="string">" æ€§åˆ«ï¼š"</span> + <span class="keyword">this</span>.sex + <span class="string">" æŠ€èƒ½ï¼š"</span> +<span class="keyword">this</span>.skill + <span class="string">" æ­¦å™¨ï¼š"</span> + <span class="keyword">this</span>.weapon);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è§’è‰²æ„å»ºå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CharacterBuilder</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸è§’è‰²å®ä½“ä¿æŒç›¸åŒçš„å±æ€§ </span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String skill;</span><br><span class="line">    <span class="keyword">private</span> String weapon;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSkill</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> skill;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWeapon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> weapon;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ„é€ åŸºæœ¬å±æ€§çš„æ„é€ å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CharacterBuilder <span class="title">buildBasicAttributes</span><span class="params">(String name , <span class="keyword">int</span> age, String sex)</span></span>&#123;</span><br><span class="line">        <span class="comment">//ä¿è¯å§“åä¸èƒ½ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span>(name == <span class="keyword">null</span> || <span class="string">""</span>.equals(name))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"name can not be empty "</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">            <span class="keyword">this</span>.sex = sex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> CharacterBuilder <span class="title">buildSkill</span><span class="params">(String skill)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.skill = skill;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CharacterBuilder <span class="title">billdWeapon</span><span class="params">(String weapon)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.weapon = weapon;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”Ÿæˆè§’è‰²å®ä½“</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Characters <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Characters(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBuildCharacter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// é“¾å¼è°ƒç”¨,æœ€åä½¿ç”¨buildæ–¹æ³•æ–°å»ºä¸€ä¸ªè§’è‰²å®ä½“</span></span><br><span class="line">        Characters characters = <span class="keyword">new</span> CharacterBuilder()</span><br><span class="line">                .buildBasicAttributes(<span class="string">"jack"</span>,<span class="number">18</span>,<span class="string">"man"</span>)</span><br><span class="line">                .buildSkill(<span class="string">"Emission laser"</span>)</span><br><span class="line">                .billdWeapon(<span class="string">"Laser Cannon"</span>)</span><br><span class="line">                .build();</span><br><span class="line">                <span class="comment">//æ‰“å°è§’è‰²å±æ€§é¢æ¿</span></span><br><span class="line">        characters.showCharacterBoard();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Connected to the target VM, address: &apos;127.0.0.1:57347&apos;, transport: &apos;socket&apos;</span><br><span class="line">äººç‰© ï¼š jack å¹´é¾„ ï¼š18 æ€§åˆ«ï¼šman æŠ€èƒ½ï¼šEmission laser æ­¦å™¨ï¼šLaser Cannon</span><br><span class="line">Disconnected from the target VM, address: &apos;127.0.0.1:57347&apos;, transport: &apos;socket&apos;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹ç»„åˆæ¨¡å¼</title>
      <link href="/2019/06/01/2019-06-03-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/06/01/2019-06-03-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹ç»„åˆæ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹ç»„åˆæ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹ç»„åˆæ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹ç»„åˆæ¨¡å¼</h1><p>å°†å¯¹è±¡ç»„åˆæˆæ ‘ç»“æ„ä»¥è¡¨ç¤ºéƒ¨åˆ†æ•´ä½“å±‚æ¬¡ç»“æ„ã€‚å½“ä½¿ç”¨æ ‘ç»“æ„çš„ä¸Šå±‚å’Œä¸‹å±‚ç»„ä»¶å±æ€§å¯èƒ½å·®åˆ«å¾ˆå¤§ï¼Œæ‰€ä»¥è¯´ä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦å¯¹è¿™ä¸¤ç±»å¯¹è±¡è¿›è¡Œåˆ†åˆ«å¤„ç†ï¼Œ ä½†Compositeå…è®¸å®¢æˆ·ç«¯ç»Ÿä¸€å¤„ç†å•ä¸ªå¯¹è±¡å’Œå¯¹è±¡ç»„åˆã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥å°†å¶å­ç»„ä»¶ä¸æ•´ä½“è¿›è¡Œä¸€è‡´æ€§å¤„ç†ï¼Œå®ç°çš„æ–¹æ³•æ˜¯ç»„ä»¶å’Œæ•´ä½“å®ç°ç›¸åŒæ¥å£ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ol><li>æƒ³è¦è¡¨ç¤ºå¯¹è±¡çš„éƒ¨åˆ†ä¸æ•´ä½“ä¹‹é—´çš„å±‚æ¬¡ç»“æ„</li><li>æƒ³è¦å®¢æˆ·ç«¯å¿½ç•¥ç»„åˆå¯¹è±¡å’Œå•ä¸ªå¯¹è±¡çš„åŒºåˆ«ï¼Œä½¿ç”¨ç»„åˆæ¨¡å¼ä¼šç»Ÿä¸€å¤„ç†æœ€åçš„ç»„åˆå¯¹è±¡ã€‚</li></ol><h2 id="ç»„åˆæ¨¡å¼ç»“æ„"><a href="#ç»„åˆæ¨¡å¼ç»“æ„" class="headerlink" title="ç»„åˆæ¨¡å¼ç»“æ„"></a>ç»„åˆæ¨¡å¼ç»“æ„</h2><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190610110055.png" alt="ç»å…¸æ¨¡å¼"></p><p>æœ€å…¸å‹çš„æƒ…å†µå°±æ˜¯å¤šçº§æ ‘å½¢èœå•å’Œæ–‡ä»¶å¤¹ç»“æ„ã€‚ç›—ä¸ªå›¾ - - </p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190605154848.png" alt="ç»„åˆæ¨¡å¼ç»“æ„"></p><p>ä¸Šå›¾ï¼Œè™½ç„¶å›½å®¶ï¼Œåœ°åŒºï¼ŒåŸå¸‚å±äºä¸åŒçš„å±‚çº§ï¼Œä½†æ˜¯éƒ½éœ€è¦ç»§æ‰¿åŒä¸€ä¸ªæ¥å£ï¼Œæ˜¯å®¢æˆ·ç«¯èƒ½å¤Ÿç»Ÿä¸€çš„è°ƒç”¨ä¸åŒå±‚çº§çš„å¯¹è±¡ã€‚ç±»ä¼¼å¤šçº§æ ‘å½¢èœå•çš„ç»“æ„ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡ç»„ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªæŠ½è±¡ç»„ä»¶å³å®Œæˆäº†æŠ½è±¡ç»„ä»¶çš„åŠŸèƒ½ï¼Œåˆå®Œæˆäº†â€œæ ‘æâ€çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿé“¾æ¥å„ä¸ªå¶å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    Integer areaLevel;</span><br><span class="line">    List&lt;Component&gt; list = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Component</span><span class="params">(String name, Integer areaLevel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.areaLevel = areaLevel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Name : "</span>+name);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printLevel</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Area Level :"</span> + areaLevel);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// è¿™é‡Œåœ¨æŠ½è±¡ç±»çš„æ–¹æ³•ä¸­ç›´æ¥æ‰“å°å­ç»„ä»¶ï¼ˆps:åº”ç»Ÿä¸€é€’å½’è¾“å‡ºå­ç»„ä»¶çš„å­ç»„ä»¶ï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Component p:list</span><br><span class="line">             ) &#123;</span><br><span class="line">            System.out.println(<span class="string">"å­ç»„ä»¶ï¼š"</span>+ p.name);</span><br><span class="line">            p.printName();</span><br><span class="line">            p.printLevel();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Component component)</span></span>&#123;</span><br><span class="line">       list.add(component);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒéƒ¨åˆ†ï¼šæ ‘å¶æ„ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›½å®¶çº§åˆ«æ ‘å¶èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Country</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    List&lt;Province&gt; provinceList = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Country</span><span class="params">(String name, Integer areaLevel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, areaLevel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Country Name :"</span> + <span class="keyword">this</span>.name);;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Province province)</span></span>&#123;</span><br><span class="line">        provinceList.add(province);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">         System.out.println(<span class="string">"å½“å‰ç»„ä»¶:"</span>+name + <span class="string">"ç­‰çº§ï¼š"</span>+ areaLevel);</span><br><span class="line">        <span class="keyword">for</span> (Province p:provinceList</span><br><span class="line">        ) &#123;</span><br><span class="line">            p.printAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Country Level :"</span> + <span class="keyword">this</span>.areaLevel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çœçº§åˆ«æ ‘å¶èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Province</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   List&lt;City&gt; cityList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Province</span><span class="params">(String name, Integer areaLevel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, areaLevel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Province Name :"</span> +<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(City city)</span></span>&#123;</span><br><span class="line">       cityList.add(city);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å½“å‰ç»„ä»¶:"</span>+name + <span class="string">"ç­‰çº§ï¼š"</span>+ areaLevel);</span><br><span class="line">        <span class="keyword">for</span> (City p:cityList</span><br><span class="line">        ) &#123;</span><br><span class="line">            p.printAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¸‚çº§åˆ«æ ‘å¶èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">City</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">City</span><span class="params">(String name, Integer areaLevel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, areaLevel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"City Name :"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"City Level "</span> + <span class="keyword">this</span>.areaLevel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç»„ä»¶ï¼š"</span>+ <span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Country zhongguo = <span class="keyword">new</span> Country(<span class="string">"china"</span>, <span class="number">0</span>);</span><br><span class="line">        City langfang = <span class="keyword">new</span> City(<span class="string">"langfang"</span>, <span class="number">2</span>);</span><br><span class="line">        Province hebei = <span class="keyword">new</span> Province(<span class="string">"hebei"</span>, <span class="number">1</span>);</span><br><span class="line">        zhongguo.add(hebei);</span><br><span class="line">        hebei.add(langfang);</span><br><span class="line">        zhongguo.printAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å½“å‰ç»„ä»¶:china ç­‰çº§ï¼š0</span><br><span class="line">å½“å‰ç»„ä»¶:hebei ç­‰çº§ï¼š1</span><br><span class="line">ç»„ä»¶ï¼šlangfang</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹å•ä¾‹æ¨¡å¼</title>
      <link href="/2019/05/30/2019-05-30-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/05/30/2019-05-30-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h1><p>æ„åœ¨ä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹,å¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹.</p><p>é€šè¿‡å°†ç±»çš„æ„é€ å™¨ç§æœ‰åŒ–,åªå‘å¤–æä¾›ä¸€ä¸ªå•ç‹¬çš„åˆ›å»ºå”¯ä¸€å¯¹è±¡çš„æ–¹æ³•æ¥å®ç°ä¸€ä¸ªç±»åªåˆ›å»ºä¸€ä¸ªå¯¹è±¡.ä¸»è¦æœ‰ä¸‰ç§å®ç° 1. é¥¿æ±‰æ¨¡å¼ 2. æ‡’æ±‰æ¨¡å¼ 3.ä½¿ç”¨æšä¸¾å®ç°å•ä¾‹.ä¸‹é¢é€šè¿‡å…·ä½“å®ä¾‹æ¥åˆ†æå¦‚ä½•åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä»èƒ½æ»¡è¶³å•ä¾‹æ¨¡å¼åˆ›å»ºå¯¹è±¡.</p><h2 id="é¥¿æ±‰æ¨¡å¼"><a href="#é¥¿æ±‰æ¨¡å¼" class="headerlink" title="é¥¿æ±‰æ¨¡å¼"></a>é¥¿æ±‰æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">    <span class="comment">//1. ä½¿ç”¨é™æ€å˜é‡</span></span><br><span class="line"><span class="comment">//    private static Singleton singleton = new Singleton();</span></span><br><span class="line">    <span class="comment">//2.ä½¿ç”¨é™æ€ä»£ç å— æœªä½¿ç”¨æ—¶é€ æˆå†…å­˜ç©ºé—´æµªè´¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton singleton;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">newInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¸ä¼šå½±å“åˆ°å¤šçº¿ç¨‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºç±»çš„è£…è½½æœºåˆ¶åœ¨åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™æ˜¯ä¿è¯ä¸ä¼šæœ‰ç¬¬äºŒä¸ªçº¿ç¨‹è¿›å…¥çš„ã€‚ä½†æ˜¯æœ‰ä¸ªå¾ˆå¤§çš„å¼Šç«¯æ˜¯ä»–ä¸æ˜¯<code>lazy-loading</code>çš„ï¼Œè¿™å›äº§ç”Ÿèµ„æºçš„æµªè´¹ï¼Œæ¯”å¦‚åˆ›å»ºå®Œå¯¹è±¡åï¼Œè‡ªå§‹è‡³ç»ˆæ²¡ç”¨è¿‡ã€‚æ‰€ä»¥ä¸æ¨èä½¿ç”¨</p><h2 id="æ‡’æ±‰æ¨¡å¼"><a href="#æ‡’æ±‰æ¨¡å¼" class="headerlink" title="æ‡’æ±‰æ¨¡å¼"></a>æ‡’æ±‰æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton singleton;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ™®é€šçš„çº¿ç¨‹ä¸å®‰å…¨çš„</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">newInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(singleton == <span class="keyword">null</span>)&#123;</span><br><span class="line">            singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.é™æ€å†…éƒ¨ç±» ä¸€æ–¹é¢èƒ½å¤Ÿè¾¾åˆ°lazy-loadingçš„æ•ˆæœï¼Œå¦ä¸€æ–¹é¢èƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºjvmä¿è¯åˆå§‹åŒ–çš„æ—¶å€™åˆ«çš„çº¿ç¨‹æ˜¯ä¸èƒ½è¿›å…¥çš„</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">newSingleton</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">newInstanceInnerClass</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> newSingleton.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„ç¬¬ä¸€ç§æ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹ä¸‹ä¼šå¯¼è‡´å¤±æ•ˆã€‚è€Œç¬¬äºŒç§ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼å®ç°èƒ½å¤Ÿå®ç°çº¿ç¨‹å®‰å…¨å¾—å®œäºç±»çš„åŠ è½½æœºåˆ¶ï¼Œç±»ä¼¼é¥¿æ±‰æ¨¡å¼ã€‚ä½†åŒæ—¶å…·æœ‰<code>lazy-Loading</code>çš„ç‰¹æ€§ã€‚æ˜¯å¸¸ç”¨çš„å•ä¾‹æ¨¡å¼ç”¨æ³•ã€‚</p><h3 id="double-checkåŒé‡é”"><a href="#double-checkåŒé‡é”" class="headerlink" title="double-checkåŒé‡é”"></a><code>double-check</code>åŒé‡é”</h3><p>åŒé‡é”ç»“æ„åªæ˜¯ä¸ºäº†æ»¡è¶³å¤šçº¿ç¨‹å®‰å…¨è€Œå»ºç«‹çš„,æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ‡’æ±‰æ¨¡å¼,æ€æƒ³åŒæ‡’æ±‰æ¨¡å¼ç›¸åŒ.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoubleCheck</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DoubleCheck</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> DoubleCheck doubleCheck; <span class="comment">//ä½¿ç”¨volatileä¿è¯åŸå­æ€§ï¼Œé˜²æ­¢é‡æ’åº</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DoubleCheck <span class="title">newInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(doubleCheck == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">// å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åˆ°è¿™æ­¥ aå…ˆè¿›åŒæ­¥å—ï¼Œåœ¨aè¿›å…¥åè·å¾—instanceåï¼Œbè·å¾—é”ï¼Œè¿›å…¥åŒæ­¥å—ï¼Œ</span></span><br><span class="line">            <span class="comment">// è¿™æ—¶å€™ä¸‹ä¸€ä¸ªåˆ¤æ–­å°±èµ·åˆ°ä½œç”¨äº†ï¼Œè¿™æ—¶å€™çš„doubleCheckä¸ä¸ºç©ºï¼Œ</span></span><br><span class="line">            <span class="comment">// ç›´æ¥returnï¼Œå¦åˆ™åˆï¸æ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">            <span class="keyword">synchronized</span> (DoubleCheck.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(doubleCheck == <span class="keyword">null</span>)&#123;</span><br><span class="line">                    doubleCheck = <span class="keyword">new</span> DoubleCheck();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> doubleCheck;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šdouble-checkä¹Ÿæ˜¯æ‡’æ±‰æ¨¡å¼çš„ä¸€ç§ï¼Œèƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å¾ˆå®Œç¾ã€‚ã€‚</p><h2 id="ä½¿ç”¨æšä¸¾åˆ›å»ºå•ä¾‹"><a href="#ä½¿ç”¨æšä¸¾åˆ›å»ºå•ä¾‹" class="headerlink" title="ä½¿ç”¨æšä¸¾åˆ›å»ºå•ä¾‹"></a>ä½¿ç”¨æšä¸¾åˆ›å»ºå•ä¾‹</h2><p>åœ¨stackoverflowä¸­æœ‰ä¸€ä¸ªé—®é¢˜<a href="https://stackoverflow.com/questions/70689/what-is-an-efficient-way-to-implement-a-singleton-pattern-in-java" target="_blank" rel="noopener">What is an efficient way to implement a singleton pattern in Java?</a></p><p>è¿™é‡Œçš„å›ç­”å¼•ç”¨åˆ°äº†Effective Java ä½œè€… Joshua Blochå¯¹äºå•ä¾‹çš„å¤„ç†æ–¹å¼:ä½¿ç”¨æšä¸¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SingletonEnum &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] favoriteSongs =</span><br><span class="line">            &#123; <span class="string">"Hound Dog"</span>, <span class="string">"Heartbreak Hotel"</span> &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printFavorites</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(Arrays.toString(favoriteSongs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•ç­‰åŒä¸ä½¿ç”¨publicçš„æ„é€ æ–¹æ³•,å¹¶ä¸”æ¯”ä¸Šé¢çš„æ›´åŠ ç®€æ´,å¹¶ä¸”å³ä½¿é¢å¯¹å¤æ‚çš„åå°„ä¸åºåˆ—åŒ–ä¹Ÿèƒ½å¤Ÿä¿è¯å•ä¸€çš„å®ä¾‹.è™½ç„¶ç°å®ä»£ç ä¸­åº”ç”¨çš„è¾ƒå°‘,ä½†æ˜¯è¿™ç§ä½¿ç”¨æšä¸¾ç±»å‹æ˜¯åˆ›å»ºå•ä¾‹çš„æœ€ä½³æ–¹æ³•.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testEnum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">SingletonEnum singletonEnum = SingletonEnum.INSTANCE;</span><br><span class="line">SingletonEnum singletonEnumCopy = SingletonEnum.INSTANCE;</span><br><span class="line">Assert.assertEquals(singletonEnum, singletonEnumCopy); <span class="comment">//é€šè¿‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ideaå¯¹spring bootåº”ç”¨è¿›è¡Œçƒ­éƒ¨ç½²</title>
      <link href="/2019/05/29/2019-02-17-%E4%BD%BF%E7%94%A8IDEA%E8%AE%BE%E7%BD%AEspringboot%E7%83%AD%E9%83%A8%E7%BD%B2/"/>
      <url>/2019/05/29/2019-02-17-%E4%BD%BF%E7%94%A8IDEA%E8%AE%BE%E7%BD%AEspringboot%E7%83%AD%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨ideaå¯¹spring-bootåº”ç”¨è¿›è¡Œçƒ­éƒ¨ç½²"><a href="#ä½¿ç”¨ideaå¯¹spring-bootåº”ç”¨è¿›è¡Œçƒ­éƒ¨ç½²" class="headerlink" title="ä½¿ç”¨ideaå¯¹spring bootåº”ç”¨è¿›è¡Œçƒ­éƒ¨ç½²"></a>ä½¿ç”¨ideaå¯¹spring bootåº”ç”¨è¿›è¡Œçƒ­éƒ¨ç½²</h1><h2 id="POM"><a href="#POM" class="headerlink" title="POM"></a>POM</h2><h3 id="åœ¨pom-xmlä¸­æ·»åŠ mavenä¾èµ–"><a href="#åœ¨pom-xmlä¸­æ·»åŠ mavenä¾èµ–" class="headerlink" title="åœ¨pom.xmlä¸­æ·»åŠ mavenä¾èµ–"></a>åœ¨pom.xmlä¸­æ·»åŠ mavenä¾èµ–</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">        &lt;optional&gt;true&lt;/optional&gt; &lt;!-- è¿™è¡Œå¿…å¡« --&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h3 id="å¹¶ä¸”åœ¨åé¢çš„æ’ä»¶é…ç½®ä¸­é…ç½®dev"><a href="#å¹¶ä¸”åœ¨åé¢çš„æ’ä»¶é…ç½®ä¸­é…ç½®dev" class="headerlink" title="å¹¶ä¸”åœ¨åé¢çš„æ’ä»¶é…ç½®ä¸­é…ç½®dev"></a>å¹¶ä¸”åœ¨åé¢çš„æ’ä»¶é…ç½®ä¸­é…ç½®dev</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;!--å¦‚æœæ²¡æœ‰è¯¥é¡¹é…ç½®ï¼Œdevtoolsä¸ä¼šèµ·ä½œç”¨ï¼Œå³åº”ç”¨ä¸ä¼šrestart --&gt;</span><br><span class="line">                &lt;fork&gt;true&lt;/fork&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure><h2 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h2><h3 id="åœ¨IDEAä¸­æ·»åŠ é…ç½®å¦‚ä¸‹"><a href="#åœ¨IDEAä¸­æ·»åŠ é…ç½®å¦‚ä¸‹" class="headerlink" title="åœ¨IDEAä¸­æ·»åŠ é…ç½®å¦‚ä¸‹"></a>åœ¨IDEAä¸­æ·»åŠ é…ç½®å¦‚ä¸‹</h3><ol><li>æ‰“å¼€ setting ,æœç´¢ <code>compiler</code> åï¼ŒæŠŠ <code>Build Project automaticial</code> é€‰é¡¹å‹¾ä¸Š</li></ol><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190531171258.png" alt="compiler"></p><ol start="2"><li>ä½¿ç”¨  <code>ctrl+shift+A</code>  å¿«æ·é”®æ‰“å¼€çª—å£ï¼Œå¹¶æœç´¢ <code>Registry...</code> ã€‚å‹¾é€‰ <code>compiler.automake.allow.when.app.running</code> </li></ol><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190531171606.png" alt="running"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨springbootæ„å»ºjpa+springdata+reståº”ç”¨çš„åŸºæœ¬é…ç½®è¿‡ç¨‹</title>
      <link href="/2019/05/29/2019-01-30-%E5%88%A9%E7%94%A8springboot%E6%9E%84%E5%BB%BASpringData+JAP+RestFul%E5%BA%94%E7%94%A8/"/>
      <url>/2019/05/29/2019-01-30-%E5%88%A9%E7%94%A8springboot%E6%9E%84%E5%BB%BASpringData+JAP+RestFul%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ©ç”¨springbootæ„å»ºjpa-springdata-reståº”ç”¨çš„åŸºæœ¬é…ç½®è¿‡ç¨‹"><a href="#åˆ©ç”¨springbootæ„å»ºjpa-springdata-reståº”ç”¨çš„åŸºæœ¬é…ç½®è¿‡ç¨‹" class="headerlink" title="åˆ©ç”¨springbootæ„å»ºjpa+springdata+reståº”ç”¨çš„åŸºæœ¬é…ç½®è¿‡ç¨‹"></a>åˆ©ç”¨springbootæ„å»ºjpa+springdata+reståº”ç”¨çš„åŸºæœ¬é…ç½®è¿‡ç¨‹</h1><h2 id="å‰è¿°"><a href="#å‰è¿°" class="headerlink" title="å‰è¿°"></a>å‰è¿°</h2><p>åˆ©ç”¨SpringBootæ•´åˆspringData+JPAåº”ç”¨éå¸¸æ–¹ä¾¿ï¼Œæ‰€ä»¥æœ¬ç€å­¦ä¹ çš„ç›®çš„æ¥æ„å»ºä¸€ä¸ªåŸºæœ¬çš„webåº”ç”¨ï¼Œé…ç½®èµ·æ¥éå¸¸ç®€å•ã€‚ä¸‹é¢æ¥è¯´è¯´é…ç½®è¿‡ç¨‹å’Œè¸©è¿‡çš„å‘ã€‚</p><h2 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h2><h3 id="åç«¯é…ç½®"><a href="#åç«¯é…ç½®" class="headerlink" title="åç«¯é…ç½®"></a>åç«¯é…ç½®</h3><p>å› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯IDEAçš„spring initalizerï¼Œå‹¾é€‰å¦‚ä¸‹ï¼š</p><ul><li><p>Rest Repositories</p></li><li><p>Thymeleaf</p></li><li><p>JPA</p></li><li><p>H2</p></li><li><p>Lombok éœ€è¦ideä¸‹è½½æ’ä»¶ä½¿ç”¨</p></li></ul><p>ä»¥å‰åœ¨é…ç½®spring MVCæ¥å£æ—¶ï¼Œå¾€å¾€ä¼šæµªè´¹å¾ˆé•¿æ—¶é—´é…ç½®reståœ°å€ï¼Œspringdataè§£å†³äº†è¿™ä¸ªä¸€éåˆä¸€ééº»çƒ¦çš„è¿‡ç¨‹ã€‚</p><h4 id="é¦–å…ˆé…ç½®å®ä½“ç±»"><a href="#é¦–å…ˆé…ç½®å®ä½“ç±»" class="headerlink" title="é¦–å…ˆé…ç½®å®ä½“ç±»"></a>é¦–å…ˆé…ç½®å®ä½“ç±»</h4><p>ä»»ä½•åŸºäºSpring Data RESTçš„åº”ç”¨ç¨‹åºçš„åŸºçŸ³éƒ½æ˜¯åŸŸå¯¹è±¡ã€‚å…¶ä¸­çš„@Idç­‰éƒ½æ˜¯JPAè¯­æ³•ï¼Œå…·ä½“ç”¨æ³•å¯ä»¥çœ‹ä¸Šä¸€ç¯‡æ–‡ç« ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">@Getter</span><br><span class="line">@Setter</span><br><span class="line">@Table(name = &quot;user&quot;)</span><br><span class="line">public class User &#123;</span><br><span class="line"></span><br><span class="line">    @Id</span><br><span class="line">    private Long id;</span><br><span class="line"></span><br><span class="line">    @Column(name = &quot;username&quot;,nullable = true,length = 255)</span><br><span class="line">    private String username;</span><br><span class="line"></span><br><span class="line">    @Column(name = &quot;password&quot;,nullable = true,length = 255)</span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    @OneToOne()</span><br><span class="line">    @JoinColumn(name = &quot;person_id&quot;,nullable = false)</span><br><span class="line">    private Person person;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®šä¹‰ä¸€ä¸ªå­˜å‚¨åº“"><a href="#å®šä¹‰ä¸€ä¸ªå­˜å‚¨åº“" class="headerlink" title="å®šä¹‰ä¸€ä¸ªå­˜å‚¨åº“"></a>å®šä¹‰ä¸€ä¸ªå­˜å‚¨åº“</h4><p>Spring Data RESTåº”ç”¨ç¨‹åºçš„å¦ä¸€ä¸ªå…³é”®éƒ¨åˆ†æ˜¯åˆ›å»ºç›¸åº”çš„å­˜å‚¨åº“å®šä¹‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public interface UserRepository extends JpaRepository&lt;User,Long&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®serviceå’Œcontroller"><a href="#é…ç½®serviceå’Œcontroller" class="headerlink" title="é…ç½®serviceå’Œcontroller"></a>é…ç½®serviceå’Œcontroller</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class UserServiceImpl implements UserService &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    UserRepository userRepository;</span><br><span class="line">    @Override</span><br><span class="line">    public void save(User user) &#123;</span><br><span class="line">        user.setPassword(...); //å®šä¹‰ä»£ç </span><br><span class="line">        userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ•°æ®åº“å’Œapplication-properties"><a href="#é…ç½®æ•°æ®åº“å’Œapplication-properties" class="headerlink" title="é…ç½®æ•°æ®åº“å’Œapplication.properties"></a>é…ç½®æ•°æ®åº“å’Œapplication.properties</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># é©±åŠ¨é…ç½®ä¿¡æ¯</span><br><span class="line">spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">spring.datasource.url = jdbc:mysql://127.0.0.1:3306/jreact?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">spring.datasource.username = root</span><br><span class="line">spring.datasource.password = 123456</span><br><span class="line">spring.datasource.driverClassName = com.mysql.jdbc.Driver</span><br><span class="line">#éä¸¥æ ¼çš„htmlè§£æ</span><br><span class="line">spring.thymeleaf.mode =LEGACYHTML5</span><br><span class="line"># å½©è‰²è¾“å‡º</span><br><span class="line">spring.output.ansi.enabled=DETECT</span><br><span class="line"># è®¾ç½®é»˜è®¤å¼•æ“</span><br><span class="line">spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect</span><br><span class="line">#é…ç½®è‡ªåŠ¨å»ºè¡¨ï¼šupdata:æ²¡æœ‰è¡¨æ–°å»ºï¼Œæœ‰è¡¨æ›´æ–°æ“ä½œ,æ§åˆ¶å°æ˜¾ç¤ºå»ºè¡¨è¯­å¥</span><br><span class="line">spring.jpa.hibernate.ddl-auto=update</span><br><span class="line">spring.jpa.show-sql=true</span><br><span class="line">#é…ç½®spring data restçš„åŸºåœ°å€</span><br><span class="line">spring.data.rest.base-path=/api</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨åº”ç”¨"><a href="#å¯åŠ¨åº”ç”¨" class="headerlink" title="å¯åŠ¨åº”ç”¨"></a>å¯åŠ¨åº”ç”¨</h4><p>è®¿é—® <code>localhost:8080/api/users</code> å¯ä»¥æŸ¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯,è¯´æ˜é…ç½®æˆåŠŸäº†ã€‚åªæ˜¯è¡¨ä¸­è¿˜æ²¡æœ‰æ•°æ®ï¼Œå¦å¤–è¡¨å·²ç»ç”±è‡ªåŠ¨å»ºå¥½ï¼Œä»¥åå¦‚æœæ›´æ–°ï¼Œç›´æ¥æ›´æ–°ç¨‹åºå°±å¥½äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;_embedded&quot; : &#123;</span><br><span class="line">    &quot;users&quot; : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_links&quot; : &#123;</span><br><span class="line">    &quot;self&quot; : &#123;</span><br><span class="line">      &quot;href&quot; : &quot;http://localhost:8080/api/users&#123;?page,size,sort&#125;&quot;,</span><br><span class="line">      &quot;templated&quot; : true</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;profile&quot; : &#123;</span><br><span class="line">      &quot;href&quot; : &quot;http://localhost:8080/api/profile/users&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;page&quot; : &#123;</span><br><span class="line">    &quot;size&quot; : 20,</span><br><span class="line">    &quot;totalElements&quot; : 0,</span><br><span class="line">    &quot;totalPages&quot; : 0,</span><br><span class="line">    &quot;number&quot; : 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‰ç«¯é…ç½®"><a href="#å‰ç«¯é…ç½®" class="headerlink" title="å‰ç«¯é…ç½®"></a>å‰ç«¯é…ç½®</h3><p>ä½¿ç”¨reactæ¡†æ¶ä½œä¸ºå‰ç«¯æ¡†æ¶ï¼Œé¦–å…ˆä¸‹è½½create-react-appä½œä¸ºå¼€å‘çš„è„šæ‰‹æ¶ã€‚è¿™é‡Œæˆ‘é€‰ç”¨çš„æ˜¯meterial-UIçš„create-react-appï¼ŒæŒ‰ç…§æ–‡æ¡£ä¸­çš„è¯´æ˜æ¥ä¸‹è½½å¹¶å®‰è£…ã€‚</p><h4 id="é…ç½®proxy"><a href="#é…ç½®proxy" class="headerlink" title="é…ç½®proxy"></a>é…ç½®proxy</h4><p>åœ¨srcç›®å½•ä¸‹æ–°å»ºåç§°ä¸ºsetupProxy.jsçš„æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const proxy = require(&apos;http-proxy-middleware&apos;);</span><br><span class="line">module.exports = function(app) &#123;</span><br><span class="line">    app.use(proxy(&apos;/api/&apos;, </span><br><span class="line">        &#123; target: &apos;http://localhost:8080/&apos; &#125;</span><br><span class="line">    ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­/api/ä¸ºè®¿é—®åç«¯çš„åŸºåœ°å€ï¼Œtargetä¸ºè®¿é—®åç«¯çš„ä¸»æœºåœ°å€å’Œç«¯å£å·</p><h4 id="é…ç½®router"><a href="#é…ç½®router" class="headerlink" title="é…ç½®router"></a>é…ç½®router</h4><p>ä½¿ç”¨npmä¸‹è½½ <code>react-router-dom</code>åï¼Œåœ¨srcç›®å½•ä¸‹æ–°å»ºrouteræ–‡ä»¶å¤¹ï¼Œå¹¶åˆ›å»ºbaseRouter.jsæ–‡ä»¶ï¼Œå¼•å…¥åˆšä¸‹è½½çš„åŒ…ï¼ŒåŸºæœ¬çš„æ–‡ä»¶å†…å®¹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import &#123; BrowserRouter as Router, Route, Link,Switch &#125; from &quot;react-router-dom&quot;;</span><br><span class="line">import Index from &quot;../pages/index&quot;</span><br><span class="line">import SignIn from &quot;../pages/login/signIn&quot;</span><br><span class="line">import Error404 from &quot;../pages/error/404&quot;</span><br><span class="line">const About = () =&gt; &lt;h2&gt;About&lt;/h2&gt;;</span><br><span class="line">const Users = () =&gt; &lt;h2&gt;Users&lt;/h2&gt;;</span><br><span class="line"></span><br><span class="line">const AppRouter = () =&gt; (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">    &lt;Switch&gt;</span><br><span class="line">        &lt;Route exact path=&quot;/&quot; component=&#123;Index&#125; /&gt;</span><br><span class="line">        &lt;Route path=&quot;/SignIn&quot; component=&#123;SignIn&#125; /&gt;</span><br><span class="line">        &lt;Route path=&quot;/About&quot; component=&#123;About&#125; /&gt;</span><br><span class="line">        &#123;/* when none of the above match, &lt;NoMatch&gt; will be rendered */&#125;</span><br><span class="line">        &lt;Route component=&#123;Error404&#125; /&gt;</span><br><span class="line">    &lt;/Switch&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/Router&gt;</span><br><span class="line">);</span><br><span class="line">export default AppRouter;</span><br></pre></td></tr></table></figure><p>å¹¶æœ€ååœ¨index.jså…¥å£æ–‡ä»¶ä¸­å†™å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(&lt;AppRouter /&gt;, document.getElementById(&apos;root&apos;));</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥è®¿é—®localhost:3000çš„æ—¶å€™å¯ä»¥è®¿é—®åˆ°Indexæ–‡ä»¶å†…å®¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹å·¥å‚æ¨¡å¼</title>
      <link href="/2019/05/29/2019-05-29-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/05/29/2019-05-29-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹å·¥å‚æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹å·¥å‚æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹å·¥å‚æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹å·¥å‚æ¨¡å¼</h1><p>å·¥å‚æ¨¡å¼åˆ†ä¸º<code>ç®€å•å·¥å‚æ¨¡å¼</code>,<code>å·¥å‚æ–¹æ³•æ¨¡å¼</code>,<code>æŠ½è±¡å·¥å‚æ–¹æ³•æ¨¡å¼</code>ä¸‰ç§,ä½†æ˜¯å…¶ä¸­ç®€å•å·¥å‚æ–¹æ³•å…¶å®ä¸åœ¨23ä¸­è®¾è®¡æ¨¡å¼ä¹‹ä¸­,éƒ½å±äºåˆ›å»ºå‹çš„è®¾è®¡æ¨¡å¼.</p><h2 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h2><p>ç®€å•å·¥å‚æ–¹æ³•å…¶å®ä¸å±äºå·¥å‚æ¨¡å¼çš„,ä»–åªæ˜¯ä¸€ç§è®¾è®¡æ€è·¯,æ˜¯ä¸€ç§å¯¹æ¥å£çš„ç¼–ç¨‹çš„ä¹ æƒ¯è€Œå·².ç®€å•å·¥å‚æŠ½è±¡å‡ºä¸€ä¸ªå…¬å…±çš„æ¥å£,ä¸åŒçš„å¯¹è±¡å®ç°è¿™ä¸ªå…¬å…±çš„æ¥å£.å®šä¹‰ä¸€ä¸ªå·¥å‚ç±»,æ ¹æ®ä¸åŒçš„æ¡ä»¶æ¥è¿”å›ä¸åŒç±»å‹çš„å®ä¾‹.</p><h3 id="ç®€å•å·¥å‚ç»“æ„"><a href="#ç®€å•å·¥å‚ç»“æ„" class="headerlink" title="ç®€å•å·¥å‚ç»“æ„"></a>ç®€å•å·¥å‚ç»“æ„</h3><p>ç®€å•å·¥å‚çš„ç®€å•ç±»å›¾å¦‚ä¸‹:</p><p><img src="https://i.loli.net/2019/05/28/5ced33e62381b24104.png" alt="ç®€å•å·¥å‚ç±»å›¾"></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>æ¥å£ä¸å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shoes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getColor</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedShoes</span> <span class="keyword">implements</span> <span class="title">Shoes</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">" is red color shoes"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WhiteShoes</span> <span class="keyword">implements</span> <span class="title">Shoes</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"is white color shoes"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¥å‚ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShoesFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shoes <span class="title">getShoes</span><span class="params">(String color)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"red"</span>.equals(color))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> RedShoes();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"white"</span>.equals(color))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> WhiteShoes();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> OtherShoes();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h2><p>åˆ›å»ºä¸€ä¸ªå…¬å…±çš„å·¥å‚æ¥å£ç±»,å…¶ä¸­åœ¨æ¥å£ç±»ä¸­å®šä¹‰å·¥å‚æ–¹æ³•.ä½†æ˜¯é€šè¿‡å®ç°ç±»å»å®ç°ç»“æ„,åœ¨è°ƒç”¨çš„æ—¶å€™é€šè¿‡ä½¿ç”¨å®ç°ç±»æ¥å®ä¾‹åŒ–ç‰¹å®šçš„å·¥å‚.ä¹Ÿå°±æ˜¯è¯´,å·¥å‚æ–¹æ³•ç±»éœ€è¦é€šè¿‡å­ç±»å»å®ä¾‹åŒ–å»ºé€ å¯¹è±¡.</p><h3 id="å·¥å‚æ–¹æ³•ç»“æ„"><a href="#å·¥å‚æ–¹æ³•ç»“æ„" class="headerlink" title="å·¥å‚æ–¹æ³•ç»“æ„"></a>å·¥å‚æ–¹æ³•ç»“æ„</h3><p>å·¥å‚æ–¹æ³•çš„ç±»å›¾å¦‚ä¸‹:</p><p><img src="https://i.loli.net/2019/05/28/5ced3f6d5a12f11044.png" alt="å·¥å‚æ–¹æ³•æ¨¡å¼"></p><p>å’Œä¸Šé¢ç®€å•å·¥å‚ç±»çš„ä¾‹å­ç±»ä¼¼,è¿™é‡ŒåŒæ ·é€šè¿‡å®ç°é‹å­è¿™ä¸ªæ¥å£æ¥åˆ›å»ºçº¢é‹å­å’Œç™½é‹å­,ç®€å•å·¥å‚æ— è®ºç™½é‹å­ã€çº¢é‹å­è¿˜æ˜¯å…¶ä»–é¢œè‰²çš„é‹å­éƒ½æ˜¯åŒä¸€ä¸ªå·¥å‚æ¥åˆ›å»ºå‡ºæ¥çš„,è€Œ <strong>å·¥å‚æ–¹æ³•æ˜¯é€šè¿‡å…·ä½“çš„ç™½é‹å­å·¥å‚å’Œçº¢é‹å­å·¥å‚æ¥åˆ†åˆ«ç”Ÿäº§å¯¹åº”çš„ç™½é‹å­å’Œçº¢é‹å­</strong>.</p><p>æ‰€ä»¥å¦‚ç±»å›¾ä¸­æ‰€å±•ç¤ºçš„ä¸€æ ·,<code>RedShoesFactory</code>å’Œ<code>WhiteShoesFactroy</code>éƒ½å®ç°æ¥æ¥å£<code>ShoesFactory</code>,å¹¶ä¸”åœ¨getshoesæ–¹æ³•é‡Œåˆ†åˆ«åˆ›å»ºå¯¹åº”çš„<code>RedShoes</code>å’Œ<code>WhiteShoes</code>.</p><h3 id="å·¥å‚æ–¹æ³•æ¨¡å¼ä½¿ç”¨åœºæ™¯"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼ä½¿ç”¨åœºæ™¯" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼ä½¿ç”¨åœºæ™¯:"></a>å·¥å‚æ–¹æ³•æ¨¡å¼ä½¿ç”¨åœºæ™¯:</h3><ol><li>å®¢æˆ·ç«¯ä¸å¿…è¦çŸ¥é“å®ƒéœ€è¦åˆ›å»ºå¯¹è±¡çš„ç±»,åªéœ€è¦åˆ›å»ºå®Œå·¥å‚å,ä»å·¥å‚ä¸­ç›´æ¥å–å¯¹åº”çš„å¯¹è±¡å³å¯.</li><li>å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨æŒ‡å®šå®ç°å­ç±»æ¥åˆ›å»ºå¯¹åº”å¯¹è±¡.</li></ol><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‹å­æ¥å£ä¸å®ç°åŒç®€å•å·¥å‚ä¸­çš„ç›¸åŒ,æ‰€ä»¥è¿™é‡Œçœç•¥....</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ShoesFactory</span> </span>&#123;</span><br><span class="line">    <span class="function">Shoes <span class="title">getShoes</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedShoesFactory</span> <span class="keyword">implements</span> <span class="title">ShoesFactory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shoes <span class="title">getShoes</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedShoes();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WhiteShoesFactory</span> <span class="keyword">implements</span> <span class="title">ShoesFactory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shoes <span class="title">getShoes</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WhiteShoes();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯è°ƒç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ShoesFactory redFactory = <span class="keyword">new</span> RedShoesFactory();</span><br><span class="line">        <span class="comment">// åªéœ€è¦åˆ›å»ºä¸€ä¸ªå·¥å‚,æ¯æ¬¡è·å–çº¢é‹å­,åªéœ€è°ƒç”¨å·¥å‚çš„getShoesæ–¹æ³•å³å¯</span></span><br><span class="line">        Shoes redshoes = redFactory.getShoes();</span><br><span class="line">        redshoes.getColor();</span><br><span class="line">        ShoesFactory whiteFactory = <span class="keyword">new</span> WhiteShoesFactory();</span><br><span class="line">        Shoes whiteshoes = whiteFactory.getShoes();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p>æä¾›ç”¨äºåˆ›å»ºç›¸å…³æˆ–ä»å±çš„å¯¹è±¡æ—(å¤šä¸ªç»„ä»¶,å¹¶ä¸”ç»„ä»¶ä¹‹é—´æ˜¯ç”±å¿…è¦è”ç³»çš„)çš„æ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå…¶å…·ä½“ç±».æ˜¯å¯¹å·¥å‚æ–¹æ³•çš„å†æ¬¡å»¶å±•.</p><h3 id="æŠ½è±¡æ–¹æ³•ç»“æ„"><a href="#æŠ½è±¡æ–¹æ³•ç»“æ„" class="headerlink" title="æŠ½è±¡æ–¹æ³•ç»“æ„"></a>æŠ½è±¡æ–¹æ³•ç»“æ„</h3><p><img src="https://i.loli.net/2019/05/28/5ced50f7bd0d134180.png" alt="æŠ½è±¡å·¥å‚ç±»å›¾"></p><h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‹åº•</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Sole</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ææ–™</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getMaterial</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‹å¸¦</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shoelace</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é•¿åº¦</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">length</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ShoesFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sole <span class="title">createSole</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shoelace <span class="title">createShoelace</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nikeå·¥å‚éœ€è¦ç”Ÿäº§é‹å¸¦å’Œé‹åº•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NikeBrandSole</span> <span class="keyword">implements</span> <span class="title">Sole</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getMaterial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ©¡èƒ¶é‹åº•</span></span><br><span class="line">        System.out.println(<span class="string">"rubber"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NikeBrandShoelace</span> <span class="keyword">implements</span> <span class="title">Shoelace</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">length</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"1 m "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„LiNingå·¥å‚éœ€è¦ç”Ÿäº§é‹å¸¦å’Œé‹åº•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiNingBrandSole</span> <span class="keyword">implements</span> <span class="title">Sole</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getMaterial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"air cushion"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiNingBrandShoelace</span> <span class="keyword">implements</span> <span class="title">Shoelace</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">length</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"1.5 m"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LiNingå’ŒNikeå·¥å‚éƒ½éœ€è¦ç”Ÿäº§å„è‡ªçš„é‹å¸¦å’Œé‹åº•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NikeShoeFactory</span> <span class="keyword">implements</span> <span class="title">ShoesFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sole <span class="title">createSole</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> NikeBrandSole();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shoelace <span class="title">createShoelace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createShoelace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiNingShoeFactory</span> <span class="keyword">implements</span> <span class="title">ShoesFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sole <span class="title">createSole</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LiNingBrandSole();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shoelace <span class="title">createShoelace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LiNingBrandShoelace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä»£ç ,åˆ›å»ºå·¥å‚,ç”Ÿäº§å„è‡ªç»„ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ShoesFactory shoesFactory = <span class="keyword">new</span> NikeShoeFactory();</span><br><span class="line">        Shoelace nikeLace = shoesFactory.createShoelace();</span><br><span class="line">        Sole nikeSole = shoesFactory.createSole();</span><br><span class="line">        nikeLace.length();</span><br><span class="line">        nikeSole.getMaterial();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹ç­–ç•¥æ¨¡å¼</title>
      <link href="/2019/05/27/2019-05-28-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/05/27/2019-05-28-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="javaè®¾è®¡æ¨¡å¼ä¹‹ç­–ç•¥æ¨¡å¼"><a href="#javaè®¾è®¡æ¨¡å¼ä¹‹ç­–ç•¥æ¨¡å¼" class="headerlink" title="javaè®¾è®¡æ¨¡å¼ä¹‹ç­–ç•¥æ¨¡å¼"></a>javaè®¾è®¡æ¨¡å¼ä¹‹ç­–ç•¥æ¨¡å¼</h1><p>å¦‚æœå­˜åœ¨ä¸€ç§è¡Œä¸ºåœ¨å¤šç§æƒ…å†µä¸‹çš„å®ç°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¯èƒ½ä¼šä½¿ç”¨<code>if...else if...else..</code>æ¥å®ç°ã€‚ä½†æ˜¯æ¯å¢åŠ ä¸€ç§æƒ…å†µå°±è¦å¢åŠ ä¸€ç§ifåˆ¤æ–­ï¼Œè¿™æ ·ä¸ç¬¦åˆjavaè®¾è®¡çš„è§„èŒƒï¼Œè¿™æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥æ›¿æ¢è¿™ç§ç¹ççš„if..else</p><p>ç­–ç•¥è®¾è®¡æ¨¡å¼æ˜¯è¡Œä¸ºè®¾è®¡æ¨¡å¼çš„ä¸€ç§.å½“ä½¿ç”¨å¤šç§ç®—æ³•è§£å†³ä¸€ä¸ªç‰¹æ®Šçš„ä»»åŠ¡çš„æ—¶å€™,å®¢æˆ·ç«¯å†³å®šä½¿ç”¨å“ªç§å…·ä½“ç®—æ³•è¿›è¡Œç‰¹å®šçš„å®ç°.</p><h2 id="å“ªç§æƒ…å†µä¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼"><a href="#å“ªç§æƒ…å†µä¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼" class="headerlink" title="å“ªç§æƒ…å†µä¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼"></a>å“ªç§æƒ…å†µä¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼</h2><p>ä»¥ä¸‹æƒ…å†µå¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼: </p><ol><li>è®¸å¤šç›¸å…³ç±»åªæœ‰è¡Œä¸ºä¸Šæœ‰æ‰€ä¸åŒ,ç­–ç•¥æ¨¡å¼å¯ä»¥é€šè¿‡ç›¸åŒçš„è¡Œä¸ºæ–¹æ³•æ¥é…ç½®è¿™äº›ç±».</li><li>å½“éœ€è¦ä½¿ç”¨åˆ°ç®—æ³•çš„å˜ç§çš„æ—¶å€™,å½“å®šä¹‰ä¸åŒçš„è¡Œä¸ºå‚æ•°,å¦‚æœä½¿ç”¨ç±»çš„å±‚æ¬¡ç»“æ„å®ç°çš„æ—¶å€™,å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼(å½“ä½¿ç”¨æ–¹æ³•å±‚æ¬¡ç»“æ„çš„æ—¶å€™å°±æ˜¯å¤šæ€)</li><li>å®¢æˆ·ç«¯ä¸ç”¨æ¸…æ¥šç®—æ³•çš„ç»†èŠ‚å®ç°,åªéœ€å…³æ³¨æ¥å£.é¿å…æš´éœ²å…·ä½“çš„ç±»çš„å®ç°ã€ç‰¹æ®Šç®—æ³•çš„æ•°æ®ç»“æ„.</li><li>ä¸€ä¸ªç±»å®šä¹‰äº†å¤šç§ä¸åŒçš„è¡Œä¸º,å¹¶ä¸”ä½¿ç”¨æ‚ä¹±çš„æ¡ä»¶è¿›è¡Œåˆ¤æ–­å…·ä½“ä½¿ç”¨å“ªä¸€ä¸ªæ¡ä»¶,è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥ä»£æ›¿,å¯¹ä¸åŒçš„ç­–ç•¥å½¢æˆä¸åŒçš„ç±».å¯ä»¥æ¸…æ™°çš„è¡¨è¾¾å‡ºç±»çš„ä½œç”¨ä¸å®ç°çš„è¡Œä¸ºæ–¹å¼.</li></ol><h2 id="ç­–ç•¥æ¨¡å¼ç»“æ„"><a href="#ç­–ç•¥æ¨¡å¼ç»“æ„" class="headerlink" title="ç­–ç•¥æ¨¡å¼ç»“æ„"></a>ç­–ç•¥æ¨¡å¼ç»“æ„</h2><p><img src="https://i.loli.net/2019/05/27/5cebf32d8658d41858.png" alt="ç­–ç•¥æ¨¡å¼ç±»å›¾"></p><p>å¦‚ä¸Šå›¾å®šä¹‰ä¸€ä¸ªæ€»çš„Trafficæ¥å£,é‡Œé¢æœ‰ä¸€ä¸ªgo()æ–¹æ³•.ä½¿ç”¨carå’Œwalkåˆ†åˆ«æ¥å®ç°æ¥å£,å¹¶ä¸”å®ç°æ¥å£ä¸­çš„goæ–¹æ³•.</p><p>Contextç±»æ˜¯ç¯å¢ƒç±»,æŒæœ‰ä¸€ä¸ªTrafficStrategyçš„å¼•ç”¨,éšè—å…·ä½“çš„ç­–ç•¥æ¥å£çš„å®ç°,è®©å®¢æˆ·ç«¯ä¸“æ³¨äºæ–¹æ³•çš„è°ƒç”¨.</p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TrafficStrategy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">go</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WalkStrategy</span> <span class="keyword">implements</span> <span class="title">TrafficStrategy</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"i am walking"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarStrategy</span> <span class="keyword">implements</span> <span class="title">TrafficStrategy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"i am driving"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>contextç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TrafficStrategy trafficStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">(TrafficStrategy trafficStrategy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.trafficStrategy = trafficStrategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TrafficStrategy <span class="title">getTrafficStrategy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> trafficStrategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTrafficStrategy</span><span class="params">(TrafficStrategy trafficStrategy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.trafficStrategy = trafficStrategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doStrategy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        trafficStrategy.go();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Appå®¢æˆ·ç«¯ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Context context = <span class="keyword">new</span> Context(<span class="keyword">new</span> CarStrategy());</span><br><span class="line">        context.doStrategy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹‹è´£ä»»é“¾æ¨¡å¼</title>
      <link href="/2019/05/27/2019-05-27-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/05/27/2019-05-27-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¹‹è´£ä»»é“¾æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼ä¹‹è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¹‹è´£ä»»é“¾æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼ä¹‹è´£ä»»é“¾æ¨¡å¼</h1><p>è´£ä»»é“¾æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼.é€šè¿‡ä¸ºå¤šä¸ªå¯¹è±¡å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„æ–¹å¼,å®ç°é™ä½å‘é€è€…ä¸æ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆæ€§.å¯¹è±¡é“¾ç”±ä¸€ä¸ªå¯¹è±¡å¯¹ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ç»„æˆä¸€æ¡é“¾,è¯·æ±‚åœ¨è¿™ä¸ªé“¾ä¸Šä¼ é€’,çŸ¥é“è¿™ä¸ªé“¾ä¸Šçš„æŸä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒ.ä¸‹é¢å¼•ç”¨<a href="https://java-design-patterns.com/patterns/chain/" target="_blank" rel="noopener">https://java-design-patterns.com/patterns/chain/</a> æ¥è¯´æ˜</p><p><img src="https://i.loli.net/2019/05/27/5ceb9a338d29c93932.png" alt="..."></p><p>Kingåªéœ€è¦ä¸‹è¾¾å‘½ä»¤,å…·ä½“è°æ¥åšå¹¶ä¸å…³å¿ƒ,ç„¶è€Œè¿™ä¸ªå‘½ä»¤ä¼šé€šè¿‡commander, officer,soldier,è¿™ä¸‰ç±»äººåªéœ€è¦æ¥æ‰§è¡Œå„è‡ªè´Ÿè´£çš„éƒ¨åˆ†,å®Œæˆåä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŒè´£çš„äººå°±è¡Œäº†.è¿™å°±æ˜¯è´£ä»»é“¾æ¨¡å¼.ä¸‹é¢æ ¹æ®ä¾‹å­ç±»å›¾æ¥åˆ†æè´£ä»»é“¾ä¸­çš„ç»“æ„å…³ç³».</p><h3 id="è´£ä»»é“¾çš„ç»“æ„"><a href="#è´£ä»»é“¾çš„ç»“æ„" class="headerlink" title="è´£ä»»é“¾çš„ç»“æ„"></a>è´£ä»»é“¾çš„ç»“æ„</h3><p><img src="https://i.loli.net/2019/05/27/5ceba5ca3ceaf56696.png" alt="ç±»å›¾"></p><ul><li>æŠ½è±¡å¤„ç†è€… RequestHandler,å®šä¹‰æ¥å£æ–¹æ³•,ä½¿ç”¨handlerRequestæ–¹æ³•è§„å®šå®ç°ç±»é€šè¿‡è¯¥æ–¹æ³•æ¥è§„èŒƒå­ç±»çš„å®ç°.</li><li>å…·ä½“å¤„ç†è€… OrcCommanderå’ŒOrcOfficer,é€šè¿‡ç»§æ‰¿RequestHandlerå®ç°å…¶ä¸­çš„handleRequestæ–¹æ³•</li><li>è¯·æ±‚Request,Kingé€šè¿‡æ–¹æ³•å°†requestæ”¾å…¥å¤„ç†è€…é“¾ä¸­,å¤„ç†è€…ä¸€æ¬¡æ‰§è¡Œè¿™ä¸ªrequest.</li></ul><h3 id="è´£ä»»é“¾æ¨¡å¼çš„ä½¿ç”¨ç¯å¢ƒ"><a href="#è´£ä»»é“¾æ¨¡å¼çš„ä½¿ç”¨ç¯å¢ƒ" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼çš„ä½¿ç”¨ç¯å¢ƒ"></a>è´£ä»»é“¾æ¨¡å¼çš„ä½¿ç”¨ç¯å¢ƒ</h3><blockquote><p>1ã€æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œå…·ä½“å“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚ç”±è¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¡®å®šã€‚<br>2ã€åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚ã€‚<br>3ã€å¯åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚</p></blockquote><p>ç¤ºä¾‹ä»£ç :<a href="https://java-design-patterns.com/patterns/chain/" target="_blank" rel="noopener">java-design-patterns</a></p><ul><li>RequestHandler</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public abstract class RequestHandler &#123;</span><br><span class="line">      private RequestHandler next;</span><br><span class="line">  </span><br><span class="line">      public RequestHandler(RequestHandler next) &#123;</span><br><span class="line">          this.next = next;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      public void handleRequest(Request req) &#123;</span><br><span class="line">          if (next != null) &#123;</span><br><span class="line">              next.handleRequest(req);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      protected void printHandling(Request req) &#123;</span><br><span class="line">          System.out.println(&quot;1.&quot;+req.getRequestType() + &quot; 2.&quot;+req.getRequestDescription());</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      @Override</span><br><span class="line">      public abstract String toString();</span><br><span class="line">  &#125;</span><br><span class="line">  `</span><br></pre></td></tr></table></figure><ul><li>å…·ä½“å¤„ç†è€…</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class OrcCommander extends RequestHandler &#123;</span><br><span class="line"></span><br><span class="line">    public OrcCommander(RequestHandler handler) &#123;</span><br><span class="line">        super(handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void handleRequest(Request req) &#123;</span><br><span class="line">        if (req.getRequestType().equals(RequestType.DEFEND_CASTLE)) &#123;</span><br><span class="line">            printHandling(req);</span><br><span class="line">            req.markHandled();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            super.handleRequest(req);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Orc commander&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class OrcOfficer extends RequestHandler &#123;</span><br><span class="line"></span><br><span class="line">    public OrcOfficer(RequestHandler next) &#123;</span><br><span class="line">        super(next);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void handleRequest(Request req) &#123;</span><br><span class="line">        if (req.getRequestType().equals(RequestType.TORTURE_PRISONER)) &#123;</span><br><span class="line">            printHandling(req);</span><br><span class="line">            req.markHandled();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            super.handleRequest(req);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Orc officer&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```text</span><br><span class="line"></span><br><span class="line">- Requestè¯·æ±‚</span><br></pre></td></tr></table></figure><p>public class Request {</p><pre><code>private final RequestType requestType;private final String requestDescription;private boolean handled;public Request(final RequestType requestType, final String requestDescription) {    this.requestType = Objects.requireNonNull(requestType);    this.requestDescription = Objects.requireNonNull(requestDescription);}public String getRequestDescription() { return requestDescription; }public RequestType getRequestType() { return requestType; }public void markHandled() { this.handled = true; }public boolean isHandled() { return this.handled; }@Overridepublic String toString() { return getRequestDescription(); }</code></pre><p>}</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- å®¢æˆ·ç«¯å‘èµ·å‘½ä»¤è€…</span><br></pre></td></tr></table></figure><p>public class King {<br>    private static RequestHandler chain;<br>    private void buildChain() {<br>        chain = new OrcCommander(new OrcOfficer(null));<br>    }<br>    private void makeRequest(Request req) {<br>        chain.handleRequest(req);<br>    }<br>    public static void main(String[] args) {<br>        King king = new King();<br>        king.buildChain();<br>        king.makeRequest(new Request(RequestType.DEFEND_CASTLE, â€œdefend castleâ€));<br>        king.makeRequest(new Request(RequestType.TORTURE_PRISONER, â€œtorture prisonerâ€));<br>    }<br>}</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springé‡ç‚¹çŸ¥è¯†å­¦ä¹ </title>
      <link href="/2019/05/05/2019-05-05-Spring_Framework%E9%87%8D%E7%82%B9%E5%AD%A6%E4%B9%A0%202/"/>
      <url>/2019/05/05/2019-05-05-Spring_Framework%E9%87%8D%E7%82%B9%E5%AD%A6%E4%B9%A0%202/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Framework"><a href="#Spring-Framework" class="headerlink" title="Spring Framework"></a>Spring Framework</h1><p>ä½¿ç”¨springå¯ä»¥è½»æ˜“çš„åˆ›å»ºä¸€ä¸ªä¼ä¸šçº§åº”ç”¨,å®ƒä½¿ç”¨Javaè¯­è¨€æ‰€æœ‰çš„ä¼ä¸šçº§ç¯å¢ƒä¸­çš„æ‰€æœ‰ä¸œè¥¿,springæ˜¯å¼€æºçš„,æ‹¥æœ‰åºå¤§è€Œæ´»è·ƒçš„ç¤¾åŒºæ¥æä¾›æŒç»­çš„æ”¯æŒ.</p><h2 id="Spring-Core"><a href="#Spring-Core" class="headerlink" title="Spring Core"></a>Spring Core</h2><p>springåˆ†ä¸ºå¤šä¸ªæ¨¡å—,å…¶ä¸­coreä¸ºå…¶ä¸­çš„ä¸€ä¸ª,é‡Œé¢åŒ…å«springçš„æ ¸å¿ƒæŠ€æœ¯ç‚¹</p><h3 id="IOCå®¹å™¨-æ§åˆ¶åè½¬"><a href="#IOCå®¹å™¨-æ§åˆ¶åè½¬" class="headerlink" title="IOCå®¹å™¨(æ§åˆ¶åè½¬)"></a>IOCå®¹å™¨(æ§åˆ¶åè½¬)</h3><p>IOCä¹Ÿè¢«æˆä¸ºä¾èµ–æ³¨å…¥,è¿™æ˜¯ç”±ä¸€ä¸ªå¯¹è±¡å®šä¹‰ä»–æ‰€ä¾èµ–çš„å…³ç³»çš„è¿‡ç¨‹.å½“åˆ›å»ºè¿™ä¸ªbeançš„æ—¶å€™ä¹ŸåŒæ—¶åˆ›å»ºè¿™äº›ä¾èµ–ä¾›å…¶ä½¿ç”¨.è¿™æ ·çš„æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯åè½¬æ§åˆ¶çš„è¿‡ç¨‹,æ¯”å¦‚è¯´å»ºæˆ¿å­,ä»¥å‰éœ€è¦ç –,ç“¦,æ°´æ³¥æ‰èƒ½å»ºé€ æˆ¿å­,å¦‚æœä¸å®ç”¨iocæ—¶,å°±æ˜¯è‡ªå·±å»é€ ç –,é€ ç“¦,ç„¶åä½¿ç”¨.<br>ç°åœ¨ä½¿ç”¨iocå®¹å™¨,åªéœ€è¦æŠŠç –,ç“¦,æ°´æ³¥å†™åˆ°æ¸…å•ä¸Š,iocå®¹å™¨è‡ªåŠ¨æŠŠè¿™äº›å‡†å¤‡å¥½ä¾›ä½¿ç”¨,çœå»æ¥è‡ªå·±åˆ¶é€ çš„è¿‡ç¨‹.</p><p><code>org.springframework.beans</code> å’Œ <code>org.springframework.context</code> æ˜¯springå®ç°IOCå®¹å™¨çš„åŸºç¡€.<code>BeanFactory</code>æ¥å£æ˜¯èƒ½å¤Ÿç®¡ç†ä»»ä½•å¯¹è±¡çš„é«˜çº§çš„é…ç½®æ¥å£,<code>ApplicationContext</code>æ˜¯BeanFactoryçš„å­æ¥å£.å› ä¸º:</p><ul><li>æ›´å®¹æ˜“å’ŒSpring çš„AOPç‰¹æ€§ç›¸ç»“åˆ</li><li>æ¶ˆæ¯èµ„æºå¤„ç†,ç”¨äºå›½é™…åŒ–é—®é¢˜</li><li>äº‹ä»¶å‘å¸ƒ</li><li>ç”¨äºç‰¹å®šçš„ä¸Šä¸‹æ–‡æ¯”å¦‚webåº”ç”¨ç¨‹åºçš„<code>WebApplicationContext</code></li></ul><p>ç®€å•æ¥è¯´å°±æ˜¯<code>BeanFactory</code>æä¾›äº†åŸºæœ¬çš„åŠŸèƒ½,è€Œ<code>ApplicationContext</code>æä¾›äº†æ›´å¤šçš„ä¼ä¸šå®šåˆ¶åŒ–çš„åŠŸèƒ½.</p><p><code>ApplicationContext</code>ä»£è¡¨äº†IOCå®¹å™¨,æä¾›äº†åˆå§‹åŒ–ã€é…ç½®ã€ç»„è£…beans.é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥è·å–æœ‰å…³åˆå§‹åŒ–..ç­‰çš„æŒ‡ä»¤.è¿™é‡Œæ‰€æŒ‡çš„é…ç½®å…ƒæ•°æ®å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶,æ³¨è§£æˆ–è€…javaä»£ç æ¥å®ç°.é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥ä½“ç°å¯¹è±¡å’Œå…¶ä¾èµ–.</p><p>ä¸‹å›¾ä¸ºå®˜ç½‘æä¾›çš„springå·¥ä½œçš„ç®€åŒ–å›¾:</p><p><img src="https://docs.spring.io/spring/docs/current/spring-framework-reference/images/container-magic.png" alt="IOCå®¹å™¨"></p><h3 id="SpringBeançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#SpringBeançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="SpringBeançš„ç”Ÿå‘½å‘¨æœŸ"></a>SpringBeançš„ç”Ÿå‘½å‘¨æœŸ</h3><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190531170713.png" alt="ç”Ÿå‘½å‘¨æœŸ"><br>ç”Ÿå‘½å‘¨æœŸå¤§æ¦‚åŒ…å«è¿™å‡ ä¸ªé˜¶æ®µ:</p><ol><li>å®ä¾‹åŒ–Beanå¯¹è±¡,è¿™æ—¶è¿˜æœªè¿›è¡Œä¾èµ–æ³¨å…¥,æœ€åå°†beanåŠ å…¥åˆ°beanwapperä¸­.</li><li>è®¾ç½®å¯¹è±¡å±æ€§.Springæ ¹æ®BeanDefinitionä¸­çš„ä¿¡æ¯è¿›è¡Œä¾èµ–æ³¨å…¥.å¹¶ä¸”é€šè¿‡BeanWrapperæä¾›çš„è®¾ç½®å±æ€§çš„æ¥å£å®Œæˆä¾èµ–æ³¨å…¥ã€‚</li><li>æ³¨å…¥Awareæ¥å£,æ£€æµ‹æ˜¯å¦æ˜¯æƒ³ç›¸å…³Awareæ¥å£,å¹¶è£…é…ç›¸å…³æ¥å£çš„æ–¹æ³•.</li><li>BeanPostProcessor æ­¤æ—¶beanå·²ç»æˆåŠŸè¢«æ„é€ ,é€šè¿‡å®ç°è¿™ä¸ªæ¥å£æ¥è‡ªå®šä¹‰å‰ç½®å’Œåç½®çš„å¤„ç†è§„åˆ™.</li><li>è°ƒç”¨initialzingBeanå’Œint-methods,è¿™æ—¶å¯¹è±¡æˆåŠŸè¢«åˆå§‹åŒ–</li><li>æœ€åè°ƒç”¨disposableBeançš„afterpropertiesSetæ–¹æ³•å’Œdestroy-methodsæ¥å®ç°æŒ‡å®šå¯¹è±¡é”€æ¯.</li></ol><h3 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h3><p>AOPçš„æ„æ€æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹,åœ¨ç†è§£é¢å‘åˆ‡é¢å‰,ä¸å¾—ä¸è¯´é¢å‘å¯¹è±¡.ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡,é¢å‘å¯¹è±¡ç¼–ç¨‹å°±æ˜¯å°†äº‹åŠ¡å¯¹è±¡åŒ–,ä¾æ®å¯¹è±¡è¿›è¡Œå±‚çº§åŒ–,é¢å‘å¯¹è±¡é€šè¿‡å°è£…ç»§æ‰¿å¤šæ€çš„æ–¹å¼å®ç°äº†å¯¹è±¡å±‚æ¬¡ç»“æ„,ä½†æ˜¯å®é™…åº”ç”¨æ—¶å¯èƒ½ä¼šé‡åˆ°éœ€è¦æ¨ªå‘çš„è¿›è¡Œä¸šåŠ¡å¤„ç†,å…¸å‹çš„å°±å¦‚æ—¥å¿—,å› ä¸ºåœ¨å®é™…ä»£ç ç¼–å†™æ—¶,ä¸èƒ½æ¯æ¬¡åœ¨å†™æ–¹æ³•å‰åéƒ½åŠ å…¥ç›¸åŒçš„ä»£ç ,è¿™æ ·å³æµªè´¹æ—¶é—´,åˆå¯¼è‡´ä»£ç å†—ä½™.æ‰€ä»¥é¢å‘åˆ‡é¢ç¼–ç¨‹å¿…ä¸å¯å°‘.</p><p>AOPå°†å¤šä¸ªç›¸åŒçš„ä¸šåŠ¡ä»£ç æ•´åˆ,å½¢æˆä¸€ä¸ªé€šç”¨çš„<code>â€œåˆ‡é¢â€</code>,é€šè¿‡åˆ‡é¢å¯ä»¥åˆ†å‰²å‡º<code>â€œæ ¸å¿ƒå…³æ³¨ç‚¹â€</code>å’Œ<code>â€œæ¨ªåˆ‡å…³æ³¨ç‚¹â€</code>,æ ¸å¿ƒå…³æ³¨ç‚¹å°±æ˜¯å®é™…çš„æ ¸å¿ƒä¸šåŠ¡å…³æ³¨çš„ä»£ç é€»è¾‘éƒ¨åˆ†,æ¨ªåˆ‡å…³æ³¨ç‚¹å°±æ˜¯å…¬å…±çš„ä»£ç çš„å®ç°.</p><p>å…¶ä¸­AOPä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„æ¦‚å¿µ:</p><ol><li>æ¨ªåˆ‡å…³æ³¨ç‚¹:å¯¹å“ªäº›æ–¹æ³•è¿›è¡Œæ‹¦æˆª,æ‹¦æˆªåå¦‚ä½•å¤„ç†.è¿™äº›å…³æ³¨ç‚¹å«åšæ¨ªåˆ‡å…³æ³¨ç‚¹</li><li>åˆ‡é¢:åˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡,å°±å¦‚åŒç±»å¯¹äº‹ç‰©çš„æŠ½è±¡ç±»ä¼¼</li><li>è¿æ¥ç‚¹(joinpoint):è¢«æ‹¦æˆªåˆ°çš„ç‚¹,å¯ä»¥é€šè¿‡è¿æ¥ç‚¹è·å–è¢«æ‹¦æˆªçš„å‚æ•°ç­‰ä¿¡æ¯</li><li>åˆ‡å…¥ç‚¹:è¿æ¥ç‚¹è¿›è¡Œæ‹¦æˆªçš„å®šä¹‰</li><li>ç»‡å…¥:æ¨ªåˆ‡çš„è¿‡ç¨‹å«åšç»‡å…¥</li></ol><h4 id="ç®€å•çš„ä»£ç å®ç°-æ³¨è§£"><a href="#ç®€å•çš„ä»£ç å®ç°-æ³¨è§£" class="headerlink" title="ç®€å•çš„ä»£ç å®ç°(æ³¨è§£)"></a>ç®€å•çš„ä»£ç å®ç°(æ³¨è§£)</h4><p>ä¸‹é¢ä»£ç ä½¿ç”¨æ³¨è§£çš„æ–¹å¼å®ç°çš„Spring AOP,é…ç½®æ–‡ä»¶åŒç†,éœ€è¦é…ç½®åˆ‡é¢(ä¸»è¦æ˜¯åˆ‡ç‚¹å’Œé€šçŸ¥æ–¹æ³•)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// æ ‡å¿—ä¸ºAOP @Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceLog</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(ServiceLog.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HttpSession httpSession;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰ç½®é€šçŸ¥ åˆ‡å…¥ç‚¹å‰æ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"execution(* com.nanyin.jreact.service.serviceImpl..*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handelServiceMethodBefore</span><span class="params">(JoinPoint joinpoint)</span></span>&#123; <span class="comment">//JoinPoint ä¸ºè¿æ¥ç‚¹,é€šè¿‡è¿æ¥ç‚¹å¯è·å–å‚æ•°ç­‰</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            String username = (String) httpSession.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">            BaseUtil.setUser(Optional.ofNullable(username).orElse(<span class="string">"ç©º "</span>));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åç½®é€šçŸ¥ åˆ‡å…¥ç‚¹åæ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"execution(* com.nanyin.jreact.service.serviceImpl..*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handelServiceMethodAfter</span><span class="params">(JoinPoint joinpoint)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            String username = (String) httpSession.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">            BaseUtil.setUser(Optional.ofNullable(username).orElse(<span class="string">"ç©º "</span>));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†"><a href="#JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†" class="headerlink" title="JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†"></a>JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†</h4><p>ä¸¤è€…éƒ½å¯ä»¥å®ç°AOPä»£ç†åŠŸèƒ½,ä½†æ˜¯jdkä»£ç†éœ€è¦ä»£ç†ç±»å’Œå§”æ‰˜ç±»éƒ½å®ç°ç³»ç»Ÿçš„æ¥å£,ä½†æ˜¯å®é™…åº”ç”¨çš„æ—¶å€™è¿™ç§æƒ…å†µéå¸¸å°‘,è¿™æ—¶å€™ä¼šè‡ªåŠ¨ä½¿ç”¨CGLIBå®ç°åŠ¨æ€ä»£ç†</p><h3 id="Springäº‹åŠ¡ç®¡ç†"><a href="#Springäº‹åŠ¡ç®¡ç†" class="headerlink" title="Springäº‹åŠ¡ç®¡ç†"></a>Springäº‹åŠ¡ç®¡ç†</h3><p>äº‹åŠ¡åŒ…å«å››ä¸ªåŸºæœ¬ç‰¹æ€§,ä¹Ÿå°±æ˜¯å¸¸è¯´çš„ACID,åˆ†åˆ«ä¸ºåŸå­æ€§,ä¸€è‡´æ€§,éš”ç¦»æ€§,æŒä¹…æ€§</p><h4 id="äº‹åŠ¡çš„æ¥å£"><a href="#äº‹åŠ¡çš„æ¥å£" class="headerlink" title="äº‹åŠ¡çš„æ¥å£"></a>äº‹åŠ¡çš„æ¥å£</h4><ol><li>PlatformTransactionManagerï¼š ï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨</li></ol><blockquote><p>spring ä¸ç›´æ¥ç®¡ç†äº‹åŠ¡,è€Œæ˜¯å®ç°ä¸åŒçš„äº‹åŠ¡ç®¡ç†å™¨,å°†äº‹åŠ¡äº¤ç»™æ¡†æ¶å¤„ç†,å¦‚ä¸ºibaits å’Œ hibernate æœ‰ä¸åŒçš„å®ç°.</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- äº‹åŠ¡ç®¡ç†å™¨ xml é…ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ•°æ®æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>TransactionDefinitionï¼š äº‹åŠ¡å®šä¹‰ä¿¡æ¯(äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPropagationBehavior</span><span class="params">()</span></span>; </span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡ç®¡ç†å™¨æ ¹æ®å®ƒæ¥æ§åˆ¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°æœ¬äº‹åŠ¡å†…çš„å“ªäº›æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getIsolationLevel</span><span class="params">()</span></span>; </span><br><span class="line">    <span class="comment">//è¿”å›äº‹åŠ¡çš„åå­—</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span>ï¼›</span></span><br><span class="line"><span class="function">    <span class="comment">// è¿”å›äº‹åŠ¡å¿…é¡»åœ¨å¤šå°‘ç§’å†…å®Œæˆ</span></span></span><br><span class="line"><span class="function">    <span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="comment">// è¿”å›æ˜¯å¦ä¼˜åŒ–ä¸ºåªè¯»äº‹åŠ¡ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>TransactionStatusï¼š ç”¨æ¥è®°å½•äº‹åŠ¡è¿è¡ŒçŠ¶æ€</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionStatus</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isNewTransaction</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦æ˜¯æ–°çš„äº‹ç‰©</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasSavepoint</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦æœ‰æ¢å¤ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRollbackOnly</span><span class="params">()</span></span>;  <span class="comment">// è®¾ç½®ä¸ºåªå›æ»š</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isRollbackOnly</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦ä¸ºåªå›æ»š</span></span><br><span class="line">    <span class="keyword">boolean</span> isCompleted; <span class="comment">// æ˜¯å¦å·²å®Œæˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h3><h4 id="æ„é€ æ³¨è§£"><a href="#æ„é€ æ³¨è§£" class="headerlink" title="æ„é€ æ³¨è§£"></a>æ„é€ æ³¨è§£</h4><p>æ³¨è§£ä½¿ç”¨<code>@interface</code>æ¥æ ‡è¯†ä¸ºä¸€ä¸ªæ³¨è§£,å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒå¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @TargetåŸæ³¨è§£çš„æ„ä¹‰æ˜¯è¡¨æ˜ä½œç”¨åŸŸï¼Œæ¯”å¦‚typeå°±æ˜¯è¡¨ç¤ºè¦æ ‡æ³¨åˆ°ç±»æ¥å£ä¸Š</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="comment">// è¡¨ç¤ºä½œç”¨åŸŸ</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="comment">// è¡¨æ˜å…¶ä»–æ³¨è§£èƒ½å¤Ÿç»§æ‰¿è¯¥æ³¨è§£</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="comment">// javadocä¼šåŒ…å«</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TableDescription &#123;</span><br><span class="line">    <span class="function">String <span class="title">description</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­è¯¥æ³¨è§£çš„ä½œç”¨å°±æ˜¯1.æ ‡æ³¨åœ¨ç±»æ¥å£ä¸Š2.ä½œç”¨åœ¨è¿è¡Œæ—¶,èƒ½å¤Ÿé€šè¿‡åå°„å¾—åˆ°æ¥å£ä¸­çš„å†…å®¹3.èƒ½å¤Ÿè®©å…¶ä»–æ³¨è§£ç»§æ‰¿è¯¥æ³¨è§£4.èƒ½å¤Ÿç”Ÿæˆjavaddocæ–‡æ¡£</p><p>ä¸‹é¢æ¥é‡ç‚¹å…³æ³¨ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå…ƒæ³¨è§£:</p><ol><li>@Targetæ˜¯è¿™ä¸ªæ³¨è§£çš„ä½œç”¨åŸŸï¼ŒElementType.METHODæ˜¯è¿™ä¸ªæ³¨è§£çš„ä½œç”¨åŸŸçš„åˆ—è¡¨ï¼ŒMETHODæ˜¯æ–¹æ³•å£°æ˜ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ï¼šCONSTRUCTORï¼ˆæ„é€ æ–¹æ³•å£°æ˜ï¼‰,FIELDï¼ˆå­—æ®µå£°æ˜ï¼‰,LOCAL VARIABLEï¼ˆå±€éƒ¨å˜é‡å£°æ˜ï¼‰,METHODï¼ˆæ–¹æ³•å£°æ˜ï¼‰,PACKAGEï¼ˆåŒ…å£°æ˜ï¼‰,PARAMETERï¼ˆå‚æ•°å£°æ˜ï¼‰,TYPEï¼ˆç±»æ¥å£ï¼‰</li><li>@Retentionæ˜¯å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå‰é¢ä¸æ˜¯è¯´æ³¨è§£æŒ‰ç…§è¿è¡Œæœºåˆ¶æœ‰ä¸€ä¸ªåˆ†ç±»å˜›ï¼ŒRUNTIMEå°±æ˜¯åœ¨è¿è¡Œæ—¶å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡åå°„è¯»å–ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰: SOURCEï¼ˆåªåœ¨æºç æ˜¾ç¤ºï¼Œç¼–è¯‘æ—¶ä¸¢å¼ƒï¼‰,CLASSï¼ˆç¼–è¯‘æ—¶è®°å½•åˆ°classä¸­ï¼Œè¿è¡Œæ—¶å¿½ç•¥ï¼‰,RUNTIMEï¼ˆè¿è¡Œæ—¶å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡åå°„è¯»å–ï¼‰</li></ol><h4 id="å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£"><a href="#å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£"></a>å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£</h4><ul><li>æ·»åŠ æ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"person"</span>)</span><br><span class="line"><span class="comment">// è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸Šé¢çš„è‡ªå®šä¹‰æ³¨è§£TableDescription</span></span><br><span class="line"><span class="meta">@TableDescription</span>(description = <span class="string">"this is person table"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"name"</span>,length = <span class="number">128</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"age"</span>,length = <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">short</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è·å¾—æ³¨è§£å†…å®¹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAnn</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">// åå°„è·å–ç±»</span></span><br><span class="line">        Class clazz = Class.forName(<span class="string">"com.nanyin.jreact.entry.Person"</span>);</span><br><span class="line">        Boolean exist = clazz.isAnnotationPresent(TableDescription.class);</span><br><span class="line">        <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">           <span class="comment">//å¦‚æœæ³¨è§£åœ¨ç±»ä¸­å­˜åœ¨</span></span><br><span class="line">           TableDescription tableDescription = (TableDescription) clazz.getAnnotation(TableDescription.class);</span><br><span class="line">           <span class="comment">// è·å¾—æ³¨è§£å†…å®¹</span></span><br><span class="line">            System.out.println(tableDescription.description());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (ClassNotFoundException c)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢åªæ˜¯ç®€å•çš„æ©é¥°æ³¨è§£çš„ç”¨æ³•,ä½†å®é™…ä¸Šä¸šåŠ¡ä¼šæ¯”è¿™éš¾ä¸Šè®¸å¤š.</p><h3 id="springMVC-å·¥ä½œæµç¨‹"><a href="#springMVC-å·¥ä½œæµç¨‹" class="headerlink" title="springMVC å·¥ä½œæµç¨‹"></a>springMVC å·¥ä½œæµç¨‹</h3><p>å…ˆä¸Šä¸€å¼ å›¾:æ¥è‡ª<a href="https://www.cnblogs.com/xiaoxi/p/6164383.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaoxi/p/6164383.html</a><br><img src="https://i.loli.net/2019/05/12/5cd7cf13c933c.jpg" alt="SpringMvcå·¥ä½œåŸç†"></p><p>ç”±å›¾ä¸­å¯ä»¥çœ‹åˆ°SpringMvcä¸­æœ€é‡è¦çš„èµ·åˆ°ä¸­æ¢çš„æ˜¯<code>DispatcherServlet</code>(å‰ç«¯æ§åˆ¶å™¨).</p><ol><li>åœ¨DispatcherServletæ¥å—åˆ°å®¢æˆ·ç«¯è¯·æ±‚å,ä½¿ç”¨ <code>handlerMapping</code> è¿›è¡Œæ˜ å°„å¤„ç†.åœ¨ç”Ÿæˆå¤„ç†å™¨æ˜ å°„å™¨ä¹‹å, è¿”å›ä¸€ä¸ªhandler,å¦‚æœæœ‰æ‹¦æˆªå™¨çš„åŒ–è¿˜ç”Ÿæˆæ‹¦æˆªå™¨.äº¤ç»™ <code>DispatcherServlet</code> è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†.</li><li>ç¬¬äºŒæ­¥äº¤ç»™ <code>handlerAdatper</code> (å¤„ç†å™¨é€‚å™¨) <code>HandlerAdapter</code> ç»è¿‡é€‚é…è°ƒç”¨å…·ä½“çš„å¤„ç†å™¨( <code>Controller</code> ï¼Œä¹Ÿå«åç«¯æ§åˆ¶å™¨)ã€‚Controlleræ‰§è¡Œå®Œæˆè¿”å›ModelAndViewã€‚</li><li>ç¬¬ä¸‰æ­¥,DispatcherServletå°†æœ€ç»ˆçš„ç»“æœäº¤ç»™ <code>viewResolver</code> è¯•å›¾è§£æå™¨è¿›è¡Œè§†å›¾è§£æ</li><li>DispatcherServlet æ ¹æ®è¿”å›çš„viewè¿›è¡Œè§†å›¾æ¸²æŸ“,æœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯ç”¨æˆ·.</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springé‡ç‚¹çŸ¥è¯†å­¦ä¹ </title>
      <link href="/2019/05/05/2019-05-05-Spring_Framework%E9%87%8D%E7%82%B9%E5%AD%A6%E4%B9%A0/"/>
      <url>/2019/05/05/2019-05-05-Spring_Framework%E9%87%8D%E7%82%B9%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Framework"><a href="#Spring-Framework" class="headerlink" title="Spring Framework"></a>Spring Framework</h1><p>ä½¿ç”¨springå¯ä»¥è½»æ˜“çš„åˆ›å»ºä¸€ä¸ªä¼ä¸šçº§åº”ç”¨,å®ƒä½¿ç”¨Javaè¯­è¨€æ‰€æœ‰çš„ä¼ä¸šçº§ç¯å¢ƒä¸­çš„æ‰€æœ‰ä¸œè¥¿,springæ˜¯å¼€æºçš„,æ‹¥æœ‰åºå¤§è€Œæ´»è·ƒçš„ç¤¾åŒºæ¥æä¾›æŒç»­çš„æ”¯æŒ.</p><h2 id="Spring-Core"><a href="#Spring-Core" class="headerlink" title="Spring Core"></a>Spring Core</h2><p>springåˆ†ä¸ºå¤šä¸ªæ¨¡å—,å…¶ä¸­coreä¸ºå…¶ä¸­çš„ä¸€ä¸ª,é‡Œé¢åŒ…å«springçš„æ ¸å¿ƒæŠ€æœ¯ç‚¹</p><h3 id="IOCå®¹å™¨-æ§åˆ¶åè½¬"><a href="#IOCå®¹å™¨-æ§åˆ¶åè½¬" class="headerlink" title="IOCå®¹å™¨(æ§åˆ¶åè½¬)"></a>IOCå®¹å™¨(æ§åˆ¶åè½¬)</h3><p>IOCä¹Ÿè¢«æˆä¸ºä¾èµ–æ³¨å…¥,è¿™æ˜¯ç”±ä¸€ä¸ªå¯¹è±¡å®šä¹‰ä»–æ‰€ä¾èµ–çš„å…³ç³»çš„è¿‡ç¨‹.å½“åˆ›å»ºè¿™ä¸ªbeançš„æ—¶å€™ä¹ŸåŒæ—¶åˆ›å»ºè¿™äº›ä¾èµ–ä¾›å…¶ä½¿ç”¨.è¿™æ ·çš„æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯åè½¬æ§åˆ¶çš„è¿‡ç¨‹,æ¯”å¦‚è¯´å»ºæˆ¿å­,ä»¥å‰éœ€è¦ç –,ç“¦,æ°´æ³¥æ‰èƒ½å»ºé€ æˆ¿å­,å¦‚æœä¸å®ç”¨iocæ—¶,å°±æ˜¯è‡ªå·±å»é€ ç –,é€ ç“¦,ç„¶åä½¿ç”¨.<br>ç°åœ¨ä½¿ç”¨iocå®¹å™¨,åªéœ€è¦æŠŠç –,ç“¦,æ°´æ³¥å†™åˆ°æ¸…å•ä¸Š,iocå®¹å™¨è‡ªåŠ¨æŠŠè¿™äº›å‡†å¤‡å¥½ä¾›ä½¿ç”¨,çœå»æ¥è‡ªå·±åˆ¶é€ çš„è¿‡ç¨‹.</p><p><code>org.springframework.beans</code> å’Œ <code>org.springframework.context</code> æ˜¯springå®ç°IOCå®¹å™¨çš„åŸºç¡€.<code>BeanFactory</code>æ¥å£æ˜¯èƒ½å¤Ÿç®¡ç†ä»»ä½•å¯¹è±¡çš„é«˜çº§çš„é…ç½®æ¥å£,<code>ApplicationContext</code>æ˜¯BeanFactoryçš„å­æ¥å£.å› ä¸º:</p><ul><li>æ›´å®¹æ˜“å’ŒSpring çš„AOPç‰¹æ€§ç›¸ç»“åˆ</li><li>æ¶ˆæ¯èµ„æºå¤„ç†,ç”¨äºå›½é™…åŒ–é—®é¢˜</li><li>äº‹ä»¶å‘å¸ƒ</li><li>ç”¨äºç‰¹å®šçš„ä¸Šä¸‹æ–‡æ¯”å¦‚webåº”ç”¨ç¨‹åºçš„<code>WebApplicationContext</code></li></ul><p>ç®€å•æ¥è¯´å°±æ˜¯<code>BeanFactory</code>æä¾›äº†åŸºæœ¬çš„åŠŸèƒ½,è€Œ<code>ApplicationContext</code>æä¾›äº†æ›´å¤šçš„ä¼ä¸šå®šåˆ¶åŒ–çš„åŠŸèƒ½.</p><p><code>ApplicationContext</code>ä»£è¡¨äº†IOCå®¹å™¨,æä¾›äº†åˆå§‹åŒ–ã€é…ç½®ã€ç»„è£…beans.é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥è·å–æœ‰å…³åˆå§‹åŒ–..ç­‰çš„æŒ‡ä»¤.è¿™é‡Œæ‰€æŒ‡çš„é…ç½®å…ƒæ•°æ®å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶,æ³¨è§£æˆ–è€…javaä»£ç æ¥å®ç°.é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥ä½“ç°å¯¹è±¡å’Œå…¶ä¾èµ–.</p><p>ä¸‹å›¾ä¸ºå®˜ç½‘æä¾›çš„springå·¥ä½œçš„ç®€åŒ–å›¾:</p><p><img src="https://docs.spring.io/spring/docs/current/spring-framework-reference/images/container-magic.png" alt="IOCå®¹å™¨"></p><h3 id="SpringBeançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#SpringBeançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="SpringBeançš„ç”Ÿå‘½å‘¨æœŸ"></a>SpringBeançš„ç”Ÿå‘½å‘¨æœŸ</h3><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20190531170713.png" alt="ç”Ÿå‘½å‘¨æœŸ"><br>ç”Ÿå‘½å‘¨æœŸå¤§æ¦‚åŒ…å«è¿™å‡ ä¸ªé˜¶æ®µ:</p><ol><li>å®ä¾‹åŒ–Beanå¯¹è±¡,è¿™æ—¶è¿˜æœªè¿›è¡Œä¾èµ–æ³¨å…¥,æœ€åå°†beanåŠ å…¥åˆ°beanwapperä¸­.</li><li>è®¾ç½®å¯¹è±¡å±æ€§.Springæ ¹æ®BeanDefinitionä¸­çš„ä¿¡æ¯è¿›è¡Œä¾èµ–æ³¨å…¥.å¹¶ä¸”é€šè¿‡BeanWrapperæä¾›çš„è®¾ç½®å±æ€§çš„æ¥å£å®Œæˆä¾èµ–æ³¨å…¥ã€‚</li><li>æ³¨å…¥Awareæ¥å£,æ£€æµ‹æ˜¯å¦æ˜¯æƒ³ç›¸å…³Awareæ¥å£,å¹¶è£…é…ç›¸å…³æ¥å£çš„æ–¹æ³•.</li><li>BeanPostProcessor æ­¤æ—¶beanå·²ç»æˆåŠŸè¢«æ„é€ ,é€šè¿‡å®ç°è¿™ä¸ªæ¥å£æ¥è‡ªå®šä¹‰å‰ç½®å’Œåç½®çš„å¤„ç†è§„åˆ™.</li><li>è°ƒç”¨initialzingBeanå’Œint-methods,è¿™æ—¶å¯¹è±¡æˆåŠŸè¢«åˆå§‹åŒ–</li><li>æœ€åè°ƒç”¨disposableBeançš„afterpropertiesSetæ–¹æ³•å’Œdestroy-methodsæ¥å®ç°æŒ‡å®šå¯¹è±¡é”€æ¯.</li></ol><h3 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h3><p>AOPçš„æ„æ€æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹,åœ¨ç†è§£é¢å‘åˆ‡é¢å‰,ä¸å¾—ä¸è¯´é¢å‘å¯¹è±¡.ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡,é¢å‘å¯¹è±¡ç¼–ç¨‹å°±æ˜¯å°†äº‹åŠ¡å¯¹è±¡åŒ–,ä¾æ®å¯¹è±¡è¿›è¡Œå±‚çº§åŒ–,é¢å‘å¯¹è±¡é€šè¿‡å°è£…ç»§æ‰¿å¤šæ€çš„æ–¹å¼å®ç°äº†å¯¹è±¡å±‚æ¬¡ç»“æ„,ä½†æ˜¯å®é™…åº”ç”¨æ—¶å¯èƒ½ä¼šé‡åˆ°éœ€è¦æ¨ªå‘çš„è¿›è¡Œä¸šåŠ¡å¤„ç†,å…¸å‹çš„å°±å¦‚æ—¥å¿—,å› ä¸ºåœ¨å®é™…ä»£ç ç¼–å†™æ—¶,ä¸èƒ½æ¯æ¬¡åœ¨å†™æ–¹æ³•å‰åéƒ½åŠ å…¥ç›¸åŒçš„ä»£ç ,è¿™æ ·å³æµªè´¹æ—¶é—´,åˆå¯¼è‡´ä»£ç å†—ä½™.æ‰€ä»¥é¢å‘åˆ‡é¢ç¼–ç¨‹å¿…ä¸å¯å°‘.</p><p>AOPå°†å¤šä¸ªç›¸åŒçš„ä¸šåŠ¡ä»£ç æ•´åˆ,å½¢æˆä¸€ä¸ªé€šç”¨çš„<code>â€œåˆ‡é¢â€</code>,é€šè¿‡åˆ‡é¢å¯ä»¥åˆ†å‰²å‡º<code>â€œæ ¸å¿ƒå…³æ³¨ç‚¹â€</code>å’Œ<code>â€œæ¨ªåˆ‡å…³æ³¨ç‚¹â€</code>,æ ¸å¿ƒå…³æ³¨ç‚¹å°±æ˜¯å®é™…çš„æ ¸å¿ƒä¸šåŠ¡å…³æ³¨çš„ä»£ç é€»è¾‘éƒ¨åˆ†,æ¨ªåˆ‡å…³æ³¨ç‚¹å°±æ˜¯å…¬å…±çš„ä»£ç çš„å®ç°.</p><p>å…¶ä¸­AOPä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„æ¦‚å¿µ:</p><ol><li>æ¨ªåˆ‡å…³æ³¨ç‚¹:å¯¹å“ªäº›æ–¹æ³•è¿›è¡Œæ‹¦æˆª,æ‹¦æˆªåå¦‚ä½•å¤„ç†.è¿™äº›å…³æ³¨ç‚¹å«åšæ¨ªåˆ‡å…³æ³¨ç‚¹</li><li>åˆ‡é¢:åˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡,å°±å¦‚åŒç±»å¯¹äº‹ç‰©çš„æŠ½è±¡ç±»ä¼¼</li><li>è¿æ¥ç‚¹(joinpoint):è¢«æ‹¦æˆªåˆ°çš„ç‚¹,å¯ä»¥é€šè¿‡è¿æ¥ç‚¹è·å–è¢«æ‹¦æˆªçš„å‚æ•°ç­‰ä¿¡æ¯</li><li>åˆ‡å…¥ç‚¹:è¿æ¥ç‚¹è¿›è¡Œæ‹¦æˆªçš„å®šä¹‰</li><li>ç»‡å…¥:æ¨ªåˆ‡çš„è¿‡ç¨‹å«åšç»‡å…¥</li></ol><h4 id="ç®€å•çš„ä»£ç å®ç°-æ³¨è§£"><a href="#ç®€å•çš„ä»£ç å®ç°-æ³¨è§£" class="headerlink" title="ç®€å•çš„ä»£ç å®ç°(æ³¨è§£)"></a>ç®€å•çš„ä»£ç å®ç°(æ³¨è§£)</h4><p>ä¸‹é¢ä»£ç ä½¿ç”¨æ³¨è§£çš„æ–¹å¼å®ç°çš„Spring AOP,é…ç½®æ–‡ä»¶åŒç†,éœ€è¦é…ç½®åˆ‡é¢(ä¸»è¦æ˜¯åˆ‡ç‚¹å’Œé€šçŸ¥æ–¹æ³•)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// æ ‡å¿—ä¸ºAOP @Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceLog</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(ServiceLog.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HttpSession httpSession;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰ç½®é€šçŸ¥ åˆ‡å…¥ç‚¹å‰æ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"execution(* com.nanyin.jreact.service.serviceImpl..*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handelServiceMethodBefore</span><span class="params">(JoinPoint joinpoint)</span></span>&#123; <span class="comment">//JoinPoint ä¸ºè¿æ¥ç‚¹,é€šè¿‡è¿æ¥ç‚¹å¯è·å–å‚æ•°ç­‰</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            String username = (String) httpSession.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">            BaseUtil.setUser(Optional.ofNullable(username).orElse(<span class="string">"ç©º "</span>));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åç½®é€šçŸ¥ åˆ‡å…¥ç‚¹åæ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"execution(* com.nanyin.jreact.service.serviceImpl..*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handelServiceMethodAfter</span><span class="params">(JoinPoint joinpoint)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            String username = (String) httpSession.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">            BaseUtil.setUser(Optional.ofNullable(username).orElse(<span class="string">"ç©º "</span>));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†"><a href="#JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†" class="headerlink" title="JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†"></a>JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†</h4><p>ä¸¤è€…éƒ½å¯ä»¥å®ç°AOPä»£ç†åŠŸèƒ½,ä½†æ˜¯jdkä»£ç†éœ€è¦ä»£ç†ç±»å’Œå§”æ‰˜ç±»éƒ½å®ç°ç³»ç»Ÿçš„æ¥å£,ä½†æ˜¯å®é™…åº”ç”¨çš„æ—¶å€™è¿™ç§æƒ…å†µéå¸¸å°‘,è¿™æ—¶å€™ä¼šè‡ªåŠ¨ä½¿ç”¨CGLIBå®ç°åŠ¨æ€ä»£ç†</p><h3 id="Springäº‹åŠ¡ç®¡ç†"><a href="#Springäº‹åŠ¡ç®¡ç†" class="headerlink" title="Springäº‹åŠ¡ç®¡ç†"></a>Springäº‹åŠ¡ç®¡ç†</h3><p>äº‹åŠ¡åŒ…å«å››ä¸ªåŸºæœ¬ç‰¹æ€§,ä¹Ÿå°±æ˜¯å¸¸è¯´çš„ACID,åˆ†åˆ«ä¸ºåŸå­æ€§,ä¸€è‡´æ€§,éš”ç¦»æ€§,æŒä¹…æ€§</p><h4 id="äº‹åŠ¡çš„æ¥å£"><a href="#äº‹åŠ¡çš„æ¥å£" class="headerlink" title="äº‹åŠ¡çš„æ¥å£"></a>äº‹åŠ¡çš„æ¥å£</h4><ol><li>PlatformTransactionManagerï¼š ï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨</li></ol><blockquote><p>spring ä¸ç›´æ¥ç®¡ç†äº‹åŠ¡,è€Œæ˜¯å®ç°ä¸åŒçš„äº‹åŠ¡ç®¡ç†å™¨,å°†äº‹åŠ¡äº¤ç»™æ¡†æ¶å¤„ç†,å¦‚ä¸ºibaits å’Œ hibernate æœ‰ä¸åŒçš„å®ç°.</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- äº‹åŠ¡ç®¡ç†å™¨ xml é…ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ•°æ®æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>TransactionDefinitionï¼š äº‹åŠ¡å®šä¹‰ä¿¡æ¯(äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPropagationBehavior</span><span class="params">()</span></span>; </span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡ç®¡ç†å™¨æ ¹æ®å®ƒæ¥æ§åˆ¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°æœ¬äº‹åŠ¡å†…çš„å“ªäº›æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getIsolationLevel</span><span class="params">()</span></span>; </span><br><span class="line">    <span class="comment">//è¿”å›äº‹åŠ¡çš„åå­—</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span>ï¼›</span></span><br><span class="line"><span class="function">    <span class="comment">// è¿”å›äº‹åŠ¡å¿…é¡»åœ¨å¤šå°‘ç§’å†…å®Œæˆ</span></span></span><br><span class="line"><span class="function">    <span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="comment">// è¿”å›æ˜¯å¦ä¼˜åŒ–ä¸ºåªè¯»äº‹åŠ¡ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>TransactionStatusï¼š ç”¨æ¥è®°å½•äº‹åŠ¡è¿è¡ŒçŠ¶æ€</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionStatus</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isNewTransaction</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦æ˜¯æ–°çš„äº‹ç‰©</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasSavepoint</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦æœ‰æ¢å¤ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRollbackOnly</span><span class="params">()</span></span>;  <span class="comment">// è®¾ç½®ä¸ºåªå›æ»š</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isRollbackOnly</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦ä¸ºåªå›æ»š</span></span><br><span class="line">    <span class="keyword">boolean</span> isCompleted; <span class="comment">// æ˜¯å¦å·²å®Œæˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h3><h4 id="æ„é€ æ³¨è§£"><a href="#æ„é€ æ³¨è§£" class="headerlink" title="æ„é€ æ³¨è§£"></a>æ„é€ æ³¨è§£</h4><p>æ³¨è§£ä½¿ç”¨<code>@interface</code>æ¥æ ‡è¯†ä¸ºä¸€ä¸ªæ³¨è§£,å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒå¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @TargetåŸæ³¨è§£çš„æ„ä¹‰æ˜¯è¡¨æ˜ä½œç”¨åŸŸï¼Œæ¯”å¦‚typeå°±æ˜¯è¡¨ç¤ºè¦æ ‡æ³¨åˆ°ç±»æ¥å£ä¸Š</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="comment">// è¡¨ç¤ºä½œç”¨åŸŸ</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="comment">// è¡¨æ˜å…¶ä»–æ³¨è§£èƒ½å¤Ÿç»§æ‰¿è¯¥æ³¨è§£</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="comment">// javadocä¼šåŒ…å«</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TableDescription &#123;</span><br><span class="line">    <span class="function">String <span class="title">description</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­è¯¥æ³¨è§£çš„ä½œç”¨å°±æ˜¯1.æ ‡æ³¨åœ¨ç±»æ¥å£ä¸Š2.ä½œç”¨åœ¨è¿è¡Œæ—¶,èƒ½å¤Ÿé€šè¿‡åå°„å¾—åˆ°æ¥å£ä¸­çš„å†…å®¹3.èƒ½å¤Ÿè®©å…¶ä»–æ³¨è§£ç»§æ‰¿è¯¥æ³¨è§£4.èƒ½å¤Ÿç”Ÿæˆjavaddocæ–‡æ¡£</p><p>ä¸‹é¢æ¥é‡ç‚¹å…³æ³¨ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå…ƒæ³¨è§£:</p><ol><li>@Targetæ˜¯è¿™ä¸ªæ³¨è§£çš„ä½œç”¨åŸŸï¼ŒElementType.METHODæ˜¯è¿™ä¸ªæ³¨è§£çš„ä½œç”¨åŸŸçš„åˆ—è¡¨ï¼ŒMETHODæ˜¯æ–¹æ³•å£°æ˜ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ï¼šCONSTRUCTORï¼ˆæ„é€ æ–¹æ³•å£°æ˜ï¼‰,FIELDï¼ˆå­—æ®µå£°æ˜ï¼‰,LOCAL VARIABLEï¼ˆå±€éƒ¨å˜é‡å£°æ˜ï¼‰,METHODï¼ˆæ–¹æ³•å£°æ˜ï¼‰,PACKAGEï¼ˆåŒ…å£°æ˜ï¼‰,PARAMETERï¼ˆå‚æ•°å£°æ˜ï¼‰,TYPEï¼ˆç±»æ¥å£ï¼‰</li><li>@Retentionæ˜¯å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå‰é¢ä¸æ˜¯è¯´æ³¨è§£æŒ‰ç…§è¿è¡Œæœºåˆ¶æœ‰ä¸€ä¸ªåˆ†ç±»å˜›ï¼ŒRUNTIMEå°±æ˜¯åœ¨è¿è¡Œæ—¶å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡åå°„è¯»å–ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰: SOURCEï¼ˆåªåœ¨æºç æ˜¾ç¤ºï¼Œç¼–è¯‘æ—¶ä¸¢å¼ƒï¼‰,CLASSï¼ˆç¼–è¯‘æ—¶è®°å½•åˆ°classä¸­ï¼Œè¿è¡Œæ—¶å¿½ç•¥ï¼‰,RUNTIMEï¼ˆè¿è¡Œæ—¶å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡åå°„è¯»å–ï¼‰</li></ol><h4 id="å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£"><a href="#å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£"></a>å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£</h4><ul><li>æ·»åŠ æ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"person"</span>)</span><br><span class="line"><span class="comment">// è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸Šé¢çš„è‡ªå®šä¹‰æ³¨è§£TableDescription</span></span><br><span class="line"><span class="meta">@TableDescription</span>(description = <span class="string">"this is person table"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"name"</span>,length = <span class="number">128</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"age"</span>,length = <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">short</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è·å¾—æ³¨è§£å†…å®¹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAnn</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">// åå°„è·å–ç±»</span></span><br><span class="line">        Class clazz = Class.forName(<span class="string">"com.nanyin.jreact.entry.Person"</span>);</span><br><span class="line">        Boolean exist = clazz.isAnnotationPresent(TableDescription.class);</span><br><span class="line">        <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">           <span class="comment">//å¦‚æœæ³¨è§£åœ¨ç±»ä¸­å­˜åœ¨</span></span><br><span class="line">           TableDescription tableDescription = (TableDescription) clazz.getAnnotation(TableDescription.class);</span><br><span class="line">           <span class="comment">// è·å¾—æ³¨è§£å†…å®¹</span></span><br><span class="line">            System.out.println(tableDescription.description());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (ClassNotFoundException c)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢åªæ˜¯ç®€å•çš„æ©é¥°æ³¨è§£çš„ç”¨æ³•,ä½†å®é™…ä¸Šä¸šåŠ¡ä¼šæ¯”è¿™éš¾ä¸Šè®¸å¤š.</p><h3 id="springMVC-å·¥ä½œæµç¨‹"><a href="#springMVC-å·¥ä½œæµç¨‹" class="headerlink" title="springMVC å·¥ä½œæµç¨‹"></a>springMVC å·¥ä½œæµç¨‹</h3><p>å…ˆä¸Šä¸€å¼ å›¾:æ¥è‡ª<a href="https://www.cnblogs.com/xiaoxi/p/6164383.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaoxi/p/6164383.html</a><br><img src="https://i.loli.net/2019/05/12/5cd7cf13c933c.jpg" alt="SpringMvcå·¥ä½œåŸç†"></p><p>ç”±å›¾ä¸­å¯ä»¥çœ‹åˆ°SpringMvcä¸­æœ€é‡è¦çš„èµ·åˆ°ä¸­æ¢çš„æ˜¯<code>DispatcherServlet</code>(å‰ç«¯æ§åˆ¶å™¨).</p><ol><li>åœ¨DispatcherServletæ¥å—åˆ°å®¢æˆ·ç«¯è¯·æ±‚å,ä½¿ç”¨ <code>handlerMapping</code> è¿›è¡Œæ˜ å°„å¤„ç†.åœ¨ç”Ÿæˆå¤„ç†å™¨æ˜ å°„å™¨ä¹‹å, è¿”å›ä¸€ä¸ªhandler,å¦‚æœæœ‰æ‹¦æˆªå™¨çš„åŒ–è¿˜ç”Ÿæˆæ‹¦æˆªå™¨.äº¤ç»™ <code>DispatcherServlet</code> è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†.</li><li>ç¬¬äºŒæ­¥äº¤ç»™ <code>handlerAdatper</code> (å¤„ç†å™¨é€‚å™¨) <code>HandlerAdapter</code> ç»è¿‡é€‚é…è°ƒç”¨å…·ä½“çš„å¤„ç†å™¨( <code>Controller</code> ï¼Œä¹Ÿå«åç«¯æ§åˆ¶å™¨)ã€‚Controlleræ‰§è¡Œå®Œæˆè¿”å›ModelAndViewã€‚</li><li>ç¬¬ä¸‰æ­¥,DispatcherServletå°†æœ€ç»ˆçš„ç»“æœäº¤ç»™ <code>viewResolver</code> è¯•å›¾è§£æå™¨è¿›è¡Œè§†å›¾è§£æ</li><li>DispatcherServlet æ ¹æ®è¿”å›çš„viewè¿›è¡Œè§†å›¾æ¸²æŸ“,æœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯ç”¨æˆ·.</li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hibernateé‡ç‚¹çŸ¥è¯†æ€»ç»“</title>
      <link href="/2019/04/29/2019-04-29-Hibernate%E9%87%8D%E7%82%B9%E6%80%BB%E7%BB%93/"/>
      <url>/2019/04/29/2019-04-29-Hibernate%E9%87%8D%E7%82%B9%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="Hibernateé‡ç‚¹çŸ¥è¯†æ€»ç»“"><a href="#Hibernateé‡ç‚¹çŸ¥è¯†æ€»ç»“" class="headerlink" title="Hibernateé‡ç‚¹çŸ¥è¯†æ€»ç»“"></a>Hibernateé‡ç‚¹çŸ¥è¯†æ€»ç»“</h1><h2 id="Hibernateçš„ä¸‰ç§çŠ¶æ€"><a href="#Hibernateçš„ä¸‰ç§çŠ¶æ€" class="headerlink" title="Hibernateçš„ä¸‰ç§çŠ¶æ€"></a>Hibernateçš„ä¸‰ç§çŠ¶æ€</h2><ol><li>ç¬æ—¶æ€(transient):å½“å®ä½“è¿˜æœªå’Œsessionå…³è”,å¦‚new Person(â€œ1â€);</li><li>æŒä¹…æ€(persistent): é€šè¿‡getæˆ–è€…loadå¾—åˆ°çš„å®ä½“ç±»,è¿™æ—¶çš„çŠ¶æ€éƒ½æ˜¯æŒä¹…æ€.</li><li>æ¸¸ç¦»æ€(detached): å½“é€šè¿‡getæˆ–è€…loadå¾—åˆ°æŒä¹…æ€çš„å¯¹è±¡å,æ‰§è¡Œåˆ é™¤deleteæ—¶,è¿™æ—¶å·²ç»è„±ç¦»session.å› deleteè€Œå˜ä¸ºæ¸¸ç¦»æ€å¯æœ‰saveæˆ–è€…saveOrUpateè½¬åŒ–ä¸ºæŒä¹…æ€.æˆ–åˆ™å½“sessionå…³é—­å,sessionä¸­çš„å¯¹è±¡å°±å˜ä¸ºæ¸¸ç¦»æ€.</li></ol><h2 id="hibernateä¸­updateå’ŒsaveOrUpdateçš„åŒºåˆ«"><a href="#hibernateä¸­updateå’ŒsaveOrUpdateçš„åŒºåˆ«" class="headerlink" title="hibernateä¸­updateå’ŒsaveOrUpdateçš„åŒºåˆ«"></a>hibernateä¸­updateå’ŒsaveOrUpdateçš„åŒºåˆ«</h2><p>updateåªèƒ½æ˜¯å¯¹è±¡æœ‰ä¸»é”®æ—¶èµ·ä½œç”¨,è€ŒsaveOrUpdateåˆ™åœ¨å¯¹è±¡æ²¡æœ‰ä¸»é”®æ—¶æ‰§è¡Œæ’å…¥æ“ä½œ.å¯¹åº”çš„updateæ“ä½œåªèƒ½æ“ä½œæ¸¸ç¦»æ€çš„å¯¹è±¡,è€Œä¸èƒ½å¯¹ç¬æ—¶æ€çš„å¯¹è±¡æ“ä½œ.è€ŒsaveOrUpdateåˆ™ä¸¤ç§çŠ¶æ€çš„å¯¹è±¡éƒ½å¯ä»¥æ“ä½œ.</p><h2 id="hibernateä¸­çš„updateå’Œmergeæ–¹æ³•çš„åŒºåˆ«"><a href="#hibernateä¸­çš„updateå’Œmergeæ–¹æ³•çš„åŒºåˆ«" class="headerlink" title="hibernateä¸­çš„updateå’Œmergeæ–¹æ³•çš„åŒºåˆ«"></a>hibernateä¸­çš„updateå’Œmergeæ–¹æ³•çš„åŒºåˆ«</h2><p>å½“æ‰§è¡Œupdateæ–¹æ³•çš„æ—¶å€™,ä¸€ä¸ªsessionä¸­å…·æœ‰ä¸å½“å‰updateç›¸åŒçš„æŒä¹…åŒ–æ ‡è¯†(identifier)çš„å®ä¾‹,ä½¿ç”¨upateæ“ä½œåä¼šæŠ¥é”™,è€Œä½¿ç”¨mergeåæŠŠå¤„ç†è‡ªç”±æ€çš„poå¯¹è±¡Açš„å±æ€§copyåˆ°sessionå½“ä¸­å¤„äºæŒä¹…æ€çš„poçš„å±æ€§ä¸­ï¼Œæ‰§è¡Œå®ŒæˆååŸæ¥æ˜¯æŒä¹…çŠ¶æ€è¿˜æ˜¯æŒä¹…æ€ï¼Œè€Œæˆ‘ä»¬æä¾›çš„Aè¿˜æ˜¯è‡ªç”±æ€ã€‚</p><h2 id="hibernateä¸­getå’Œloadçš„åŒºåˆ«"><a href="#hibernateä¸­getå’Œloadçš„åŒºåˆ«" class="headerlink" title="hibernateä¸­getå’Œloadçš„åŒºåˆ«"></a>hibernateä¸­getå’Œloadçš„åŒºåˆ«</h2><p>ä¸€å¥è¯ï¼Œhibernateå¯¹äºloadæ–¹æ³•è®¤ä¸ºè¯¥æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¸€å®šå­˜åœ¨ï¼Œå¯ä»¥æ”¾å¿ƒçš„ä½¿ç”¨ä»£ç†æ¥å»¶è¿ŸåŠ è½½ï¼Œå¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°äº†é—®é¢˜ï¼Œåªèƒ½æŠ›å¼‚å¸¸ï¼›è€Œå¯¹äºgetæ–¹æ³•ï¼Œhibernateä¸€å®šè¦è·å–åˆ°çœŸå®çš„æ•°æ®ï¼Œå¦åˆ™è¿”å›nullã€‚</p><h2 id="hibernateä¸­listå’Œiteratorçš„åŒºåˆ«"><a href="#hibernateä¸­listå’Œiteratorçš„åŒºåˆ«" class="headerlink" title="hibernateä¸­listå’Œiteratorçš„åŒºåˆ«"></a>hibernateä¸­listå’Œiteratorçš„åŒºåˆ«</h2><p>(1)ã€Listæ–¹å¼æ˜¯1æ¬¡æ€§æŠŠæ‰€æœ‰çš„æ•°æ®å…¨éƒ¨å–åˆ°å†…å­˜ä¸­ï¼Œæ„é€ ä¸€ä¸ªè¶…å¤§çš„ç»“æœé›†ï¼Œä¸»è¦çš„æ—¶é—´å¼€é”€æ˜¯è¿™ä¸€æ­¥ï¼Œè¿™ä¸€æ­¥çš„æ—¶é—´å¼€é”€è¦è¿œè¿œè¶…è¿‡JDBCå’Œ Iteratoræ–¹å¼ä¸‹æ„é€ ç»“æœé›†çš„æ—¶é—´å¼€é”€ï¼Œå¹¶ä¸”å†…å­˜å¼€é”€ä¹Ÿå¾ˆæƒŠäººï¼›è€Œå¯¹ç»“æœé›†çš„éå†æ“ä½œï¼Œé€Ÿåº¦åˆ™æ˜¯éå¸¸çš„æƒŠäººï¼ˆç»è¿‡æµ‹è¯•ï¼Œ30ä¸‡è®°å½•çš„å†… å­˜éå†ä¸åˆ°100msï¼Œç”±äºè¿™ä¸€æ­¥ä¸å—JDBCå½±å“ï¼Œå› æ­¤ç»“æœå¯ä¿¡ï¼‰ã€‚å› æ­¤ï¼ŒListæ–¹å¼é€‚åˆäºå¯¹ç»“æœé›†è¿›è¡Œåå¤å¤šæ¬¡æ“ä½œçš„æƒ…å†µï¼Œä¾‹å¦‚åˆ†é¡µæ˜¾ç¤ºï¼Œå¾€åå¾€å‰ éå†ï¼Œè·³åˆ°ç¬¬ä¸€è¡Œï¼Œè·³åˆ°æœ€åä¸€è¡Œç­‰ç­‰ã€‚</p><p>(2)ã€Iteratoræ–¹å¼åªå–è®°å½•idåˆ°å†…å­˜ä¸­ï¼Œå¹¶æ²¡æœ‰æŠŠæ‰€æœ‰æ•°æ®å–åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤æ„é€ ç»“æœé›†çš„æ—¶é—´å¼€é”€å¾ˆå°ï¼Œæ¯”JDBCå’ŒListæ–¹å¼éƒ½è¦å°‘ï¼Œå¹¶ä¸”å†… å­˜å¼€é”€ä¹Ÿå°å¾ˆå¤šã€‚è€Œå¯¹ç»“æœé›†çš„éå†çš„æ“ä½œçš„æ—¶å€™ï¼ŒIteratorä»ç„¶è¦è®¿é—®æ•°æ®åº“ï¼Œæ‰€æœ‰ä¸»è¦çš„æ—¶é—´å¼€é”€éƒ½èŠ±åœ¨è¿™é‡Œã€‚å› æ­¤ï¼ŒIteratoræ–¹å¼é€‚åˆäºåª å¯¹ç»“æœé›†è¿›è¡Œ1æ¬¡éå†æ“ä½œçš„æƒ…å†µï¼Œå¹¶ä¸”Iteratoræ–¹å¼ç‰¹åˆ«é€‚åˆäºä»è¶…å¤§ç»“æœé›†ä¸­å–å°‘é‡æ•°æ®ï¼Œè¿™ç§æƒ…å†µIteratoræ€§èƒ½éå¸¸å¥½ã€‚</p><p>æ€»ç»“: listæŠŠæ•°æ®ä¸€æ¬¡åŠ è½½åˆ°å†…å­˜,å†è¿›è¡Œéå†æ“ä½œå°±éå¸¸å¿«äº†.è€ŒIteratoræ–¹å¼åªä¼šæŠŠidæ”¾åˆ°å†…å­˜ä¸­,ä½†æ˜¯å†æ¬¡éå†æ—¶ä»ç„¶è¦è®¿é—®æ•°æ®åº“æŸ¥è¯¢æ•°æ®,é€‚åˆä¸€æ¬¡éå†çš„æƒ…å†µ.</p><h2 id="hibernateä¸­çš„inverseå±æ€§"><a href="#hibernateä¸­çš„inverseå±æ€§" class="headerlink" title="hibernateä¸­çš„inverseå±æ€§"></a>hibernateä¸­çš„inverseå±æ€§</h2><p>è®¾ç½®inverse=â€œfalseâ€ä¸ºä¸»æ§æ–¹,ç”±ä¸»æ§æ–¹ç±»ç»´æŠ¤å¯¹è±¡é—´çš„å…³ç³».æ¯”å¦‚å†many-to-oneçš„å…³ç³»ä¸­,å†oneçš„ä¸€æ–¹è®¾ç½®<code>inverse=&quot;true&quot;</code>è¿™æ ·èƒ½å¤Ÿæé«˜æ•ˆç‡,æ¯”å¦‚ç­çº§é‡Œä¸€ä¸ªè€å¸ˆå¤šä¸ªå­¦ç”Ÿ,è€å¸ˆè®°ä½å¤šä¸ªå­¦ç”Ÿæ¯”è¾ƒå›°éš¾,è€Œå­¦ç”Ÿè®°ä½ä¸€ä¸ªè€å¸ˆå¾ˆå®¹æ˜“.åŒç†one-to-many.å†å¤šå¯¹å¤šçš„å…³ç³»ä¸­,å†ä»»æ„ä¸€æ–¹è®¾ç½®<code>inverse=&#39;true&#39;</code>å³å¯.</p><h2 id="hibernateä¸­çš„cascadeå±æ€§"><a href="#hibernateä¸­çš„cascadeå±æ€§" class="headerlink" title="hibernateä¸­çš„cascadeå±æ€§"></a>hibernateä¸­çš„cascadeå±æ€§</h2><p>çº§è”æ“ä½œï¼šæŒ‡å½“ä¸»æ§æ–¹æ‰§è¡ŒæŸé¡¹æ“ä½œæ—¶ï¼Œæ˜¯å¦è¦å¯¹è¢«å…³è”æ–¹ä¹Ÿæ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚</p><h2 id="ä»€ä¹ˆæƒ…å†µä¸‹æ‡’åŠ è½½èƒ½å¤Ÿæœ‰æ•ˆçš„æé«˜æ•ˆç‡"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹æ‡’åŠ è½½èƒ½å¤Ÿæœ‰æ•ˆçš„æé«˜æ•ˆç‡" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹æ‡’åŠ è½½èƒ½å¤Ÿæœ‰æ•ˆçš„æé«˜æ•ˆç‡"></a>ä»€ä¹ˆæƒ…å†µä¸‹æ‡’åŠ è½½èƒ½å¤Ÿæœ‰æ•ˆçš„æé«˜æ•ˆç‡</h2><p>æ‡’åŠ è½½æ˜¯å½“ç”¨åˆ°å¯¹è±¡çš„æ—¶å€™å†ä»æ•°æ®åº“åŠ è½½æ•°æ®,æŒä¹…åŒ–æ¥ä½¿ç”¨.ä»è¿™å¥è¯ä¸­å°±å¯ä»¥ç†è§£ä¸º,å› ä¸ºåŠè”çš„å…³ç³»,ä¸€ä¸ªè¡¨çš„æ•°æ®å¯èƒ½ä¼šå¸¦å‡ºå¤šå¼ è¡¨çš„æ•°æ®,è¿™æ—¶å€™ä½¿ç”¨æ‡’åŠ è½½å°±èƒ½å¤Ÿå®ç°æ•ˆç‡çš„æé«˜,æ²¡å¿…è¦ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®éƒ½åŠ è½½å‡ºæ¥,è€Œæ˜¯ç”¨æ—¶åŠ è½½.hibernateé»˜è®¤æ˜¯ä½¿ç”¨æ‡’åŠ è½½çš„,å½“ç„¶å¯ä»¥ä½¿ç”¨lazy=falseæ¥ç¦ç”¨æ‡’åŠ è½½.</p><h2 id="ä»€ä¹ˆæ˜¯hibernateçš„äºŒçº§ç¼“å­˜"><a href="#ä»€ä¹ˆæ˜¯hibernateçš„äºŒçº§ç¼“å­˜" class="headerlink" title="ä»€ä¹ˆæ˜¯hibernateçš„äºŒçº§ç¼“å­˜"></a>ä»€ä¹ˆæ˜¯hibernateçš„äºŒçº§ç¼“å­˜</h2><p>ç¼“å­˜å°±æ˜¯å°†ä»¥å‰çš„æ•°æ®å­˜æ”¾åˆ°å†…å­˜ä¸­,å½“æŸ¥è¯¢æ•°æ®çš„æ—¶å€™,ç°åœ¨å†…å­˜ä¸­æŸ¥è¯¢,æ˜¯å¦æœ‰è¿™ä¸ªå¯¹è±¡,å¦‚æœæ²¡æœ‰å†ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å¯¹è±¡,è¿™æ ·å¤§å¤§çš„æé«˜äº†æŸ¥è¯¢çš„æ•ˆç‡.</p><p>Hibenateçš„sessionå°±æ˜¯ä¸€çº§ç¼“å­˜,å½“æŸ¥è¯¢æ•°æ®çš„æ—¶å€™éƒ½ä¼šå…ˆä»sessionä¸­æŸ¥è¯¢å¯¹è±¡æ˜¯å¦å­˜åœ¨,ä¸å­˜åœ¨æ‰ä»æ•°æ®åº“æŸ¥è¯¢.ä½†æ˜¯sessionæ˜¯éçº¿ç¨‹å®‰å…¨çš„,å¤šçº¿ç¨‹å…±äº«çš„æƒ…å†µä¸‹ä¼šå‡ºç°é—®é¢˜.å¹¶ä¸”sessionæ˜¯è¡¨ç¤ºçš„æ˜¯ä¸€æ®µä¼šè¯,è¡¨ç¤ºçš„æ˜¯ä¸€æ¬¡äº‹åŠ¡,åŸºäºä»¥ä¸Šä¸¤ç‚¹,æ‰€ä»¥åœ¨ä¸€æ¬¡äº‹åŠ¡å®Œæˆå,sessionå°±åº”ç«‹å³å…³é—­.æ‰€ä»¥è¿™é‡Œè¯´çš„ä¸€çº§ç¼“å­˜æ„ä¹‰ä¸å¤§.</p><p>Hibernateçš„äºŒçº§ç¼“å­˜å…¶å®å°±æ˜¯ä½¿ç”¨å¤–éƒ¨ç¼“å­˜,å¦‚Echacheæˆ–è€…redisç­‰,ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®ç¼“å­˜ç­–ç•¥ç­‰.</p><h2 id="Hibernateä¸­ä½¿ç”¨hibernateTemplateçš„å¥½å¤„æœ‰å“ªäº›"><a href="#Hibernateä¸­ä½¿ç”¨hibernateTemplateçš„å¥½å¤„æœ‰å“ªäº›" class="headerlink" title="Hibernateä¸­ä½¿ç”¨hibernateTemplateçš„å¥½å¤„æœ‰å“ªäº›?"></a>Hibernateä¸­ä½¿ç”¨hibernateTemplateçš„å¥½å¤„æœ‰å“ªäº›?</h2><ol><li>HibernateTemplateç®€åŒ–äº†ä¸Hibernate Sessionçš„äº¤äº’</li><li>å¸¸è§çš„å‡½æ•°ç®€åŒ–ä¸ºå•ä¸ªæ–¹æ³•è°ƒç”¨ã€‚</li><li>å¼‚å¸¸ä¼šè‡ªåŠ¨æ•è·å¹¶è½¬æ¢ä¸ºè¿è¡Œæ—¶å¼‚å¸¸</li><li>session è‡ªåŠ¨å…³é—­</li></ol>]]></content>
      
      
      <categories>
          
          <category> Hibernate </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¸­çš„å„ç§IOæ“ä½œ</title>
      <link href="/2019/04/28/2019-04-28-Java_IO%E6%93%8D%E4%BD%9C/"/>
      <url>/2019/04/28/2019-04-28-Java_IO%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaä¸­çš„IOæ“ä½œ"><a href="#Javaä¸­çš„IOæ“ä½œ" class="headerlink" title="Javaä¸­çš„IOæ“ä½œ"></a>Javaä¸­çš„IOæ“ä½œ</h1><p>Javaæ€»çš„æ¥è¯´æœ‰ä¸‰ç±»IO,æ•ˆç‡ä¸é«˜,æ“ä½œç®€å•çš„BIO(blocking IO),éé˜»å¡çš„NIO(New IO),å’Œå¼‚æ­¥éé˜»å¡IO,ä¹Ÿå°±æ˜¯å‡çº§ç‰ˆçš„NIO(Asynchronous I/O).</p><p>åœ¨å­¦ä¹ è¿™ä¸‰ç±»IOå‰,éœ€è¦äº†è§£ä»€ä¹ˆæ˜¯é˜»å¡.ä»€ä¹ˆæ˜¯å¼‚æ­¥.ä¸¤ä¸ªçš„å«ä¹‰æœ‰ä»€ä¹ˆåŒºåˆ«.</p><blockquote><p>åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶ (synchronous communication/ asynchronous communication)æ‰€è°“åŒæ­¥ï¼Œå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ª<em>è°ƒç”¨*æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥ *è°ƒç”¨</em> å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ç”±<em>è°ƒç”¨è€…</em>ä¸»åŠ¨ç­‰å¾…è¿™ä¸ª<em>è°ƒç”¨</em>çš„ç»“æœã€‚è€Œå¼‚æ­¥åˆ™æ˜¯ç›¸åï¼Œ<em>è°ƒç”¨</em>åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœã€‚æ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœã€‚è€Œæ˜¯åœ¨<em>è°ƒç”¨</em>å‘å‡ºåï¼Œ<em>è¢«è°ƒç”¨è€…</em>é€šè¿‡çŠ¶æ€ã€é€šçŸ¥æ¥é€šçŸ¥è°ƒç”¨è€…ï¼Œæˆ–é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†è¿™ä¸ªè°ƒç”¨ã€‚</p></blockquote><blockquote><p>é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›å€¼ï¼‰æ—¶çš„çŠ¶æ€.é˜»å¡è°ƒç”¨æ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚éé˜»å¡è°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</p></blockquote><h2 id="BIO"><a href="#BIO" class="headerlink" title="BIO"></a>BIO</h2><p>BIOè¿‡ç¨‹å°±å¦‚åŒåå­—ä¸€æ ·,æ˜¯ä¸€ä¸ªé˜»å¡çš„IO,æœåŠ¡ç«¯é€šå¸¸ä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥é€šè¿‡è°ƒç”¨accept()æ¥ç›‘å¬å®¢æˆ·ç«¯æ¶ˆæ¯.å¦‚æœæƒ³å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚åˆ™æœåŠ¡ç«¯éœ€è¦å»ºç«‹ç­‰åŒæ•°é‡çš„çº¿ç¨‹æ¥å¤„ç†è¿™äº›æ¶ˆæ¯,è¿™å°±æ˜¯æ™®éçš„ä¸€è¯·æ±‚ä¸€åº”ç­”çš„æ¨¡å‹.å¤„ç†å®Œæˆåè¿”å›åº”ç­”ç»™å®¢æˆ·ç«¯åé”€æ¯çº¿ç¨‹,å› ä¸ºçº¿ç¨‹æ˜¯ä¸€ä¸ªæ˜‚è´µçš„èµ„æº,è¿™æ ·é‡å¤çš„æ–°å»ºçº¿ç¨‹,é”€æ¯çº¿ç¨‹,å¾ˆæµªè´¹å¤„ç†å™¨èµ„æº,æ‰€ä»¥ä½¿ç”¨BIOåŒæ—¶èƒ½å¤Ÿå°½å¯èƒ½çš„å°‘åˆ›å»ºçº¿ç¨‹,å°±å¯ä»¥ç”¨åˆ°çº¿ç¨‹æ± çš„æ–¹å¼å®ç°,æ¥è¾¾åˆ°æœåŠ¡ç«¯åˆ›å»ºçº¿ç¨‹æ•°è¿œè¿œå°äºå®¢æˆ·ç«¯æ•°çš„ç›®çš„,ä½†è¿™ç§æ–¹æ³•åªæ˜¯ä¼ªå¼‚æ­¥IO.</p><p>åœ¨å¤„ç†é“¾æ¥æ•°é‡å°‘çš„æƒ…å†µä¸‹,BIOçš„æ•ˆç‡è¿˜ä¸é”™,å¹¶ä¸”ä¸»è¦é€»è¾‘æ¨¡å‹æ¸…æ™°æ˜äº†,ä»£ç ç®€å•.ä½†æ˜¯åœ¨ä¸Šä¸‡çš„é“¾æ¥çš„æƒ…å†µä¸‹,BIOå¤„ç†èµ·æ¥å°±éå¸¸åƒç´§äº†.</p><h2 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h2><p>NIOæ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œåœ¨Java 1.4 ä¸­å¼•å…¥äº†NIOæ¡†æ¶ï¼Œå¯¹åº” java.nio åŒ…ï¼Œæä¾›äº† Channel , Selectorï¼ŒBufferç­‰æŠ½è±¡ã€‚</p><blockquote><p>NIOä¸­çš„Nå¯ä»¥ç†è§£ä¸ºNon-blockingï¼Œä¸å•çº¯æ˜¯Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„I/Oæ“ä½œæ–¹æ³•ã€‚ NIOæä¾›äº†ä¸ä¼ ç»ŸBIOæ¨¡å‹ä¸­çš„ Socket å’Œ ServerSocket ç›¸å¯¹åº”çš„ SocketChannel å’Œ ServerSocketChannel ä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°,ä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚é˜»å¡æ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿä¸­çš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼›éé˜»å¡æ¨¡å¼æ­£å¥½ä¸ä¹‹ç›¸åã€‚å¯¹äºä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡I/Oæ¥æå‡å¼€å‘é€Ÿç‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘ã€‚</p></blockquote><h3 id="NIOç‰¹æ€§å’ŒNIOä¸ä¼ ç»ŸIOçš„åŒºåˆ«"><a href="#NIOç‰¹æ€§å’ŒNIOä¸ä¼ ç»ŸIOçš„åŒºåˆ«" class="headerlink" title="NIOç‰¹æ€§å’ŒNIOä¸ä¼ ç»ŸIOçš„åŒºåˆ«"></a>NIOç‰¹æ€§å’ŒNIOä¸ä¼ ç»ŸIOçš„åŒºåˆ«</h3><ul><li>ä¼ ç»ŸIO(BIO)æ˜¯ä¸€ç§é˜»å¡IOæ¨¡å‹,è€ŒNIOæ˜¯éé˜»å¡çš„IOæ¨¡å‹,åŒºåˆ«ä¸ºå½“çº¿ç¨‹è¯»å–æ•°æ®çš„æ—¶å€™,éé˜»å¡IOå¯ä»¥ä¸ç”¨ç­‰,è€Œé˜»å¡IOéœ€è¦ä¸€ç›´ç­‰å¾…IOå®Œæˆåæ‰èƒ½ç»§ç»­.</li><li>IOé¢å‘æµ,è€ŒNIOé¢å‘ç¼“å†²åŒº.</li><li>é€šé“(channel) NIOé€šè¿‡é€šé“è¿›è¡Œæ•°æ®è¯»å†™.é€šé“æ˜¯åŒå‘çš„,è€Œä¼ ç»Ÿçš„IOæ˜¯å•å‘çš„.é€šé“é“¾æ¥çš„éƒ½æ˜¯Buffer,æ‰€ä»¥é€šé“å¯ä»¥å¼‚æ­¥çš„è¯»å†™.</li><li>é€‰æ‹©å™¨(Selectors) NIOæ‹¥æœ‰é€‰æ‹©å™¨,è€ŒIOæ²¡æœ‰.é€‰æ‹©å™¨çš„ä½œç”¨å°±æ˜¯ç”¨æ¥ä½¿ç”¨å•ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªé€šé“(NIOé¢å‘buffer,é€šé“åªä¸bufferäº¤äº’).<br><img src="https://camo.githubusercontent.com/3a68153ce17be90275df07a47409afaea91aff83/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d322f536c6563746f722e706e67" alt="Selectorå›¾è§£"><h2 id="AIO"><a href="#AIO" class="headerlink" title="AIO"></a>AIO</h2></li></ul><p>AIO ä¹Ÿå°±æ˜¯ NIO 2ã€‚åœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡çš„IOæ¨¡å‹ã€‚å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚</p><p>AIO æ˜¯å¼‚æ­¥IOçš„ç¼©å†™ï¼Œè™½ç„¶ NIO åœ¨ç½‘ç»œæ“ä½œä¸­ï¼Œæä¾›äº†éé˜»å¡çš„æ–¹æ³•ï¼Œä½†æ˜¯ NIO çš„ IO è¡Œä¸ºè¿˜æ˜¯åŒæ­¥çš„ã€‚å¯¹äº NIO æ¥è¯´ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡çº¿ç¨‹æ˜¯åœ¨ IO æ“ä½œå‡†å¤‡å¥½æ—¶ï¼Œå¾—åˆ°é€šçŸ¥ï¼Œæ¥ç€å°±ç”±è¿™ä¸ªçº¿ç¨‹è‡ªè¡Œè¿›è¡Œ IO æ“ä½œï¼ŒIOæ“ä½œæœ¬èº«æ˜¯åŒæ­¥çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMåŸºæœ¬çŸ¥è¯†æ•´ç†</title>
      <link href="/2019/04/24/2019-04-24-JVM%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"/>
      <url>/2019/04/24/2019-04-24-JVM%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="javaå†…å­˜ç©ºé—´"><a href="#javaå†…å­˜ç©ºé—´" class="headerlink" title="javaå†…å­˜ç©ºé—´"></a>javaå†…å­˜ç©ºé—´</h1><p><img src="https://i.loli.net/2019/05/12/5cd7c7e477235.jpg" alt="å†…å­˜ç©ºé—´"></p><p>å…¶ä¸­å¦‚å›¾ä¸­æ‰€å±•ç¤ºçš„ï¼ŒæŒ‰åŠŸèƒ½åˆ†äº†å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»ä¸ºçº¿ç¨‹å…±äº«çš„JAVAå †å’Œå…ƒæ•°æ®åŒºå’Œç›´æ¥å†…å­˜ï¼Œå¦ä¸€ç±»æ˜¯çº¿ç¨‹ç§æœ‰çš„è™šæ‹Ÿæœºæ ˆï¼Œæ–¹æ³•åŒºæ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚ </p><p>ä¸‹é¢é’ˆå¯¹è¿™å‡ ç§åŒºåŸŸæ¥è¯¦ç»†å°†è¿™å‡ ä¸ªåŒºåŸŸåˆ†åˆ«çš„ä½œç”¨æ˜¯ä»€ä¹ˆã€‚ </p><h2 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h2><p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰§è¡Œç¨‹åºçš„å­—èŠ‚ç çš„çš„è¡Œå·çš„æŒ‡ç¤ºå™¨ã€‚å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨çš„å€¼æ¥æ”¹å˜å°†è¦é€‰å–çš„ä¸‹ä¸€ä¸ªæŒ‡ä»¤ã€‚å¹¶ä¸”ç”±äºæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„è¿è¡Œçš„æŒ‡ä»¤ä¸åŒï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰ä¸ªå­—çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå¹¶ä¸”äº’ä¸å¹²æ‰°ã€‚æ‰€ä»¥ç¨‹åºè®¡æ•°å™¨è¢«ç§°ä½œæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚è¿™ç§çº¿ç¨‹ç§æœ‰çš„åŒºåŸŸæœ‰ç€å¾ˆæ˜æ˜¾çš„ç‰¹å¾å°±æ˜¯ç”Ÿå‘½å‘¨æœŸå’Œå½“å‰çº¿ç¨‹çš„å‘¨æœŸä¿æŒä¸€è‡´ã€‚å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ç¨‹åºè®¡æ•°å™¨æ˜¯å†…å­˜ä¸­å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç°<code>outOfMemory</code>çš„åŒºåŸŸã€‚ </p><p> ç¨‹åºè®¡æ•°å™¨æœ‰ä¸¤ä¸ªä½œç”¨ï¼š </p><p> A: å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡è¯»å–ç¨‹åºè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„è¯­å¥ã€‚ </p><p>B:åœ¨å¤šçº¿ç¨‹åˆ‡æ¢çš„æƒ…å†µä¸‹ï¼Œè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œæ–¹ä¾¿äºåˆ‡æ¢å›æ—¶è¿›ç¨‹è¿è¡Œçš„ä½ç½®ã€‚ </p><h2 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h2><p>Javaå†…å­˜å¯ä»¥ç²—ç³™çš„åˆ†ä¸ºå †å†…å­˜å’Œæ ˆå†…å­˜ï¼Œæ‰€è°“çš„å †å°±æ˜¯å›¾ä¸­çš„javaå †ï¼ˆ<code>Heap</code>ï¼‰ï¼Œè€Œæ‰€è°“çš„æ ˆå°±æ˜¯æŒ‡çš„è™šæ‹Ÿæœºæ ˆï¼ˆ<code>VM Stack</code>ï¼‰çš„å±€éƒ¨å˜é‡è¡¨ã€‚è™šæ‹Ÿæœºæ ˆæ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆé’ˆæ„æˆçš„ï¼Œå¯ä»¥æƒ³ä¸ºä¸€ä¸ªæ–¹æ³•ä¸ºä¸€ä¸ªæ ˆé’ˆï¼Œéšç€æ–¹æ³•çš„è¢«è°ƒç”¨å®Œæˆï¼ˆå®Œæˆçš„æ¡ä»¶æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯returnï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å‘ç”Ÿå¼‚å¸¸ï¼‰ï¼Œå¯¹åº”ç€æ–¹æ³•çš„æ ˆé’ˆå‡ºæ ˆã€‚æ ˆé’ˆä¸­éƒ½åŒ…å«ï¼šå±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼ŒåŠ¨æ€é“¾æ¥å’Œæ–¹æ³•å‡ºå£ã€‚<strong>å±€éƒ¨å˜é‡è¡¨ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘å™¨å¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹</strong>ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€<strong>å¯¹è±¡å¼•ç”¨</strong>ï¼ˆreferenceç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ </p><p><img src="https://i.loli.net/2019/05/12/5cd7cb63399f3.jpg" alt="è™šæ‹Ÿæœºæ ˆç»“æ„"></p><h2 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h2><p>æœ¬åœ°æ–¹æ³•æ ˆåŒæ ·æ˜¯çº¿ç¨‹ç§æœ‰çš„,åŒºåˆ«æ˜¯javaè™šæ‹Ÿæœºæ ˆæ˜¯ç”¨äºjavaå­—èŠ‚ç çš„,è€Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ç”¨æ¥æ‰§è¡ŒNativeæ–¹æ³•çš„.ç»“æ„éƒ½å’Œè™šæ‹Ÿæœºæ ˆçš„ç»“æ„ç›¸åŒ. </p><h2 id="Javaå †"><a href="#Javaå †" class="headerlink" title="Javaå †"></a>Javaå †</h2><p>Javaå †æ˜¯æ•´ä¸ªè™šæ‹Ÿæœºä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ,æ˜¯çº¿ç¨‹å…±äº«çš„åŒºåŸŸ,å†è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»º,è¯¥å—å­˜åœ¨çš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾ç±»çš„äº‹ä¾‹å’Œæ•°ç»„. </p><h2 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h2><p>å’ŒJavaå †ä¸€æ ·éƒ½æ˜¯çº¿ç¨‹å…±äº«çš„åŒºåŸŸ,ä¸»è¦ç”¨äºå­˜æ”¾å·²ç»è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯,å¸¸é‡,é™æ€å˜é‡å’Œå·²ç»è¢«ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®.æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³»å¾ˆåƒJavaä¸­æ¥å£å’Œç±»çš„å…³ç³»ï¼Œç±»å®ç°äº†æ¥å£ï¼Œè€Œæ°¸ä¹…ä»£å°±æ˜¯HotSpotè™šæ‹Ÿæœºå¯¹è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„ä¸€ç§å®ç°æ–¹å¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ°¸ä¹…ä»£æ˜¯HotSpotçš„æ¦‚å¿µï¼Œæ–¹æ³•åŒºæ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­çš„å®šä¹‰ï¼Œæ˜¯ä¸€ç§è§„èŒƒï¼Œè€Œæ°¸ä¹…ä»£æ˜¯ä¸€ç§å®ç°ï¼Œä¸€ä¸ªæ˜¯æ ‡å‡†ä¸€ä¸ªæ˜¯å®ç°ï¼Œå…¶ä»–çš„è™šæ‹Ÿæœºå®ç°å¹¶æ²¡æœ‰æ°¸ä¹…å¸¦è¿™ä¸€è¯´æ³•ã€‚ </p><h2 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h2><p>åŸæ¥çš„è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†,è€Œåœ¨1.7ä¹‹å,è®²è¿è¡Œæ—¶å¸¸é‡æ± æ”¾åˆ°å †(Heap)ä¸­å¼€è¾Ÿäº†ä¸€ä¸ªåŒºåŸŸä¸“é—¨ç”¨æ¥æ”¾è¿è¡Œæ—¶å¸¸é‡æ± .è¿è¡Œæ—¶å¸¸é‡æ± ä¸­é¥é¥åŒ…æ‹¬ä¸¤éƒ¨åˆ†,ä¸€éƒ¨åˆ†æ˜¯å®é™…å­˜åœ¨çš„å­—é¢é‡,æ‰€è°“å­—é¢é‡åŒ…æ‹¬[1.æ–‡æœ¬å­—ç¬¦ä¸²,2.è¢«å£°æ˜ä¸ºfinalçš„å¸¸é‡,åŸºæœ¬æ•°æ®ç±»å‹â€¦..],å¦ä¸€éƒ¨åˆ†æ˜¯ç¬¦å·å¼•ç”¨,åŒ…å«[ç±»å’Œç»“æ„çš„åç§°,å­—æ®µçš„åç§°,æ–¹æ³•çš„åç§°]</p><p><img src="https://i.loli.net/2019/05/12/5cd7cbf57ba27.jpg" alt="è¿è¡Œæ—¶å¸¸é‡æ± "></p><h2 id="å…ƒæ•°æ®åŒº"><a href="#å…ƒæ•°æ®åŒº" class="headerlink" title="å…ƒæ•°æ®åŒº"></a>å…ƒæ•°æ®åŒº</h2><p>æ›¿ä»£äº†æ°¸ä¹…ä»£,ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜,ä»€ä¹ˆæ˜¯ç›´æ¥å†…å­˜,å®ƒæœ‰èƒ½å¤Ÿå¹²ä»€ä¹ˆ? é¦–å…ˆç›´æ¥å†…å­˜åŒºåŸŸä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†,ä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºå®šä¹‰çš„ä¸€éƒ¨åˆ†,ä½†æ˜¯ç»å¸¸ä¼šä½¿ç”¨åˆ°.</p><blockquote><p>JDK1.4 ä¸­æ–°åŠ å…¥çš„ <strong>NIO(New Input/Output) ç±»</strong>ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäº<strong>é€šé“ï¼ˆChannelï¼‰</strong> ä¸<strong>ç¼“å­˜åŒºï¼ˆBufferï¼‰</strong> çš„ I/O æ–¹å¼ï¼Œå®ƒå¯ä»¥ç›´æ¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †ä¸­çš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·å°±èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸º<strong>é¿å…äº†åœ¨ Java å †å’Œ Native å †ä¹‹é—´æ¥å›å¤åˆ¶æ•°æ®</strong>ã€‚</p></blockquote><p>æœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šæ”¶åˆ° Java å †çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜å°±ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚</p><h1 id="å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"><a href="#å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"></a>å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</h1><p><img src="https://i.loli.net/2019/05/12/5cd7cbf57ba27.jpg" alt="å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"></p><p>å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹åˆ†ä¸ºä¸Šå›¾ä¸­çš„5æ­¥ </p><ol><li>ç±»åŠ è½½æ£€æŸ¥:å½“è™šæ‹Ÿæœºé‡åˆ°newçš„æ—¶å€™,ä¼šæ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦å­˜åœ¨,æ˜¯å¦è¢«åŠ è½½,è§£é‡Šå’Œåˆå§‹åŒ–è¿‡,å¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œç±»çš„åˆå§‹åŒ–è¿‡ç¨‹. </li><li>åˆ†é…å†…å­˜:å†è¿›è¡Œç±»åŠ è½½æ£€æŸ¥å,ä¼šåœ¨å †å†…å­˜ä¸­ä¸ºæ–°çš„å¯¹è±¡åˆ†é…å†…å­˜,åˆ†é…çš„è§„åˆ™æœ‰ä¸¤ç§,ä¸€ç§æ˜¯æŒ‡é’ˆç¢°æ’,å¦ä¸€ç§æ˜¯ç©ºé—²åˆ—è¡¨,é’ˆå¯¹ä¸åŒçš„åƒåœ¾å›æ”¶å™¨ä¼šä½¿ç”¨ä¸åŒçš„æ–¹æ³•.ç¬¬ä¸€ç§æ–¹æ³•æŒ‡é’ˆç¢°æ’çš„åŸç†å¤§è‡´ä¸ºå®ƒä¼šå°†åˆ†é…è¿‡çš„å†…å­˜å’Œæœªåˆ†é…çš„å†…å­˜é—´å»ºç«‹ä¸€ä¸ªæŒ‡é’ˆ,å½“åˆ†é…å†…å­˜çš„æ—¶å€™,å‘ä¸ºåˆ†é…å†…å­˜çš„åœ°æ–¹ç§»åŠ¨æ–°çš„å¯¹è±¡çš„å¤§å°çš„ä½ç½®,é€‚ç”¨äºæ¯”è¾ƒè§„æ•´çš„å†…å­˜ç©ºé—´.ç¬¬äºŒç§æ–¹æ³•æ˜¯ç»´æŠ¤ä¸€ä¸ªåˆ†é…å†…å­˜çš„åˆ—è¡¨,æ¯æ¬¡åˆ†é…å†…å­˜éƒ½æƒ³åˆ—è¡¨ä¸­æ·»åŠ ç›¸å…³è®°å½•,è¡¨æ˜è¿™äº›å¯¹è±¡åœ¨å“ª. </li><li>åˆå§‹åŒ–é›¶å€¼:ä¿è¯åœ¨åˆ†é…å®Œå†…å­˜å,ä¸ºåˆ†é…çš„å†…å­˜åŒºåŸŸåˆå§‹åŒ–ä¸ºé›¶å€¼ </li><li>è®¾ç½®å¯¹è±¡å¤´:è™šæ‹Ÿæœºå¯¹å¯¹è±¡çš„å„ç§è®¾ç½®ä¿¡æ¯,ä¿å­˜åœ¨å¯¹è±¡å¤´ä¸­. </li><li>æ‰§è¡Œinitæ–¹æ³•:åœ¨æ‰§è¡Œinitæ–¹æ³•å‰,ä»è™šæ‹Ÿæœºçš„è§’åº¦æ¥çœ‹å…¶å®å¯¹è±¡å·²ç»ç”Ÿæˆäº†,ä½†æ˜¯åœ¨ç¨‹åºå‘˜çš„è§’åº¦å¯¹è±¡å¹¶æ²¡æœ‰ç”Ÿæˆ,åªæœ‰åœ¨initæ–¹æ³•æ‰§è¡Œè¿‡å,å¯¹è±¡æ‰ç®—ç”Ÿæˆ. </li></ol><h1 id="å¯¹è±¡çš„å®šä½æ–¹å¼"><a href="#å¯¹è±¡çš„å®šä½æ–¹å¼" class="headerlink" title="å¯¹è±¡çš„å®šä½æ–¹å¼"></a>å¯¹è±¡çš„å®šä½æ–¹å¼</h1><p>Javaè™šæ‹Ÿæœºå®šä½å¯¹è±¡çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§,ä¸€æ˜¯ä½¿ç”¨å¥æŸ„,äºŒæ˜¯ç›´æ¥ä½¿ç”¨æŒ‡é’ˆ.</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‚²è§‚é”å’Œä¹è§‚é”</title>
      <link href="/2019/04/23/2019-04-08-%E6%82%B2%E8%A7%82%E9%94%81%E5%92%8C%E4%B9%90%E8%A7%82%E9%94%81/"/>
      <url>/2019/04/23/2019-04-08-%E6%82%B2%E8%A7%82%E9%94%81%E5%92%8C%E4%B9%90%E8%A7%82%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h1 id="æ‚²è§‚é”å’Œä¹è§‚é”"><a href="#æ‚²è§‚é”å’Œä¹è§‚é”" class="headerlink" title="æ‚²è§‚é”å’Œä¹è§‚é”"></a>æ‚²è§‚é”å’Œä¹è§‚é”</h1><h2 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h2><p>æ‚²è§‚é”æ˜¯æ€»ä¼šå…ˆå»æƒ³æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡çº¿ç¨‹æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šè®¤ä¸ºä»–ä¼šè¿›è¡Œä¿®æ”¹ï¼Œé€‚ç”¨äºçš„åœºæ™¯æ˜¯å¤šå†™å°‘è¯»ï¼Œè¿™æ—¶ä½¿ç”¨æ‚²è§‚é”æ•ˆç‡ä¼šé«˜ã€‚ç¨‹åºä¸­å…¸å‹çš„æ‚²è§‚é”æ—¶synchronizedå’ŒReentrantLock </p><h2 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h2><p>ä¹è§‚é”æ˜¯æ€»ä¼šå…ˆå»æƒ³å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡çº¿ç¨‹æ‹¿æ•°æ®åªä¼šçœ‹ä¸€çœ¼ï¼Œå¹¶ä¸ä¼šåšä¿®æ”¹æ“ä½œï¼Œè¿™æ—¶æ²¡æœ‰å¿…è¦åŠ é”ï¼Œç¨‹åºä¸­çš„atomåŸå­ç±»ä½¿ç”¨cas+volatile+nativeæ–¹æ³•å®ç°ä¹è§‚é”ã€‚ </p><p>ä¸¤ç§é”çš„æœºåˆ¶ï¼Œæœ‰å„è‡ªçš„å¥½å¤„ï¼Œä¸èƒ½è¯´è°å¥½è°åï¼Œå„æœ‰ä¼˜ç‚¹ï¼š </p><p>æ‚²è§‚é”é€‚ç”¨äºå¤šå†™å°‘è¯»çš„æƒ…å†µï¼Œè€Œä¹è§‚é”é€‚ç”¨äºå¤šè¯»å°‘å†™çš„æƒ…å†µï¼Œå¦‚æœåœ¨å¤šå†™çš„æƒ…å†µä¸‹ä½¿ç”¨ä¹è§‚é”ï¼Œä¼šç»å¸¸äº§ç”Ÿå†²çªï¼Œåè€Œä¼šé™ä½æ€§èƒ½ã€‚ </p><h3 id="ä¹è§‚é”å¸¸ç”¨çš„ä¸¤ç§æ–¹å¼"><a href="#ä¹è§‚é”å¸¸ç”¨çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="ä¹è§‚é”å¸¸ç”¨çš„ä¸¤ç§æ–¹å¼"></a>ä¹è§‚é”å¸¸ç”¨çš„ä¸¤ç§æ–¹å¼</h3><h4 id="ç‰ˆæœ¬å·çš„æ§åˆ¶"><a href="#ç‰ˆæœ¬å·çš„æ§åˆ¶" class="headerlink" title="ç‰ˆæœ¬å·çš„æ§åˆ¶"></a>ç‰ˆæœ¬å·çš„æ§åˆ¶</h4><p>æ¯æ¬¡è¯»å–æ•°æ®çš„æ—¶å€™éƒ½ä¼šè¿åŒç‰ˆæœ¬å·ä¸€åŒè¯»å–ï¼Œåœ¨å½“æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¼šæ¯”è¾ƒè¯»å–åˆ°çš„ç‰ˆæœ¬å·å’Œæ•°æ®åº“ä¸­çš„ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™æ›´æ–°ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™ç»§ç»­è¯»å–ï¼Œæ›´æ–°æ•°æ®ã€‚ </p><h4 id="CASæ“ä½œï¼ˆcompareAndSwapï¼‰"><a href="#CASæ“ä½œï¼ˆcompareAndSwapï¼‰" class="headerlink" title="CASæ“ä½œï¼ˆcompareAndSwapï¼‰"></a>CASæ“ä½œï¼ˆcompareAndSwapï¼‰</h4><p>ä¸¾ä¸ªä¾‹å­,åœ¨atomIntegerç±»ä¸­æ¶‰åŠäº†CAS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public final native boolean compareAndSwapInt(Object o, long offset,</span><br><span class="line">                                                  int expected,</span><br><span class="line">                                                  int x)</span><br><span class="line">//è¿™é‡Œæ˜¯nativeæ–¹æ³• offsetæ˜¯åç§»é‡å…ˆæš‚ä¸”ä¸æï¼Œoæ˜¯éœ€è¦æ¯”è¾ƒçš„å€¼ï¼Œexpectedæ˜¯é¢„æœŸå€¼ï¼Œxæ˜¯æ–°å€¼</span><br><span class="line">// å¦‚æœä½¿ç”¨ç¨‹åºå†™å‡ºæ¥å°±æ˜¯å¤§æ¦‚è¿™æ ·ï¼š</span><br><span class="line">    int value;</span><br><span class="line">    public boolean fakeCAS(int expect,int newValue)&#123;</span><br><span class="line">        if(value == expect)&#123;</span><br><span class="line">            value = newValue;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>æ¯”è¾ƒæ›¿æ¢(compareAndSwap)</code>æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè‡ªæ—‹æ“ä½œï¼Œç­‰å¾…ä¸€ä¸ªå‘¨æœŸå†æ¬¡å°è¯•ã€‚</p><h4 id="CASæ“ä½œçš„ç¼ºç‚¹"><a href="#CASæ“ä½œçš„ç¼ºç‚¹" class="headerlink" title="CASæ“ä½œçš„ç¼ºç‚¹"></a>CASæ“ä½œçš„ç¼ºç‚¹</h4><ol><li>ABAé—®é¢˜ï¼Œä½•è°“ABAï¼šå½“ä¸¤ä¸ªçº¿ç¨‹è¯»å–åˆ°å½“å‰å€¼ä¸ºAï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æŠŠå€¼æ”¹ä¸ºBåå†æŠŠBæ”¹ä¸ºAï¼Œè¿™æ˜¯å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨casæ“ä½œè¯»å–åˆ°çš„å€¼ä»ç„¶æ˜¯Aï¼ŒCASä¼šè®¤ä¸ºè¿™ä¸ªå€¼ä»æ¥æ²¡æœ‰å˜è¿‡ï¼Œè¿™å°±æ˜¯ABAé—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´é—å¤±æ‰ä¸­é—´çš„è¿‡ç¨‹ï¼Œåœ¨é“¾å¼çš„æ“ä½œæ€»æ›´èƒ½ä½“ä¼šåˆ°ABAé—®é¢˜çš„ä¸¥é‡æ€§ã€‚ </li><li>è‡ªæ—‹æ—¶é—´è¿‡é•¿ï¼Œæ¶ˆè€—CPUèµ„æºã€‚ </li><li>åªèƒ½å¯¹å•ä¸ªå…±äº«å˜é‡çš„åŸå­æ€§æ“ä½œ </li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> å¤šçº¿ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿ç¨‹æ± å’ŒAQSçŸ¥è¯†æ•´ç†</title>
      <link href="/2019/04/23/2019-04-23-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
      <url>/2019/04/23/2019-04-23-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="çº¿ç¨‹æ± å’ŒAQSä»£ç è§£æ"><a href="#çº¿ç¨‹æ± å’ŒAQSä»£ç è§£æ" class="headerlink" title="çº¿ç¨‹æ± å’ŒAQSä»£ç è§£æ"></a>çº¿ç¨‹æ± å’ŒAQSä»£ç è§£æ</h1><p>ä½¿ç”¨çº¿ç¨‹æ± æ˜¯ä¸ºäº†å°†çº¿ç¨‹å¾—ä»¥å¤ç”¨,çº¿ç¨‹åˆ›å»ºååœ¨çº¿ç¨‹æ± ä¸­è¢«å¾ªç¯åˆ©ç”¨,é˜²æ­¢äº†çº¿ç¨‹å¾—å¤šæ¬¡åˆ›å»ºå’Œé”€æ¯.ä¸‹é¢å°±é€šè¿‡ä»£ç æ¥çœ‹çº¿ç¨‹æ± çš„å·¥ä½œåŸç†.</p><p>çº¿ç¨‹æ± é…ç½®æ¯”è¾ƒç¹ç,æ‰€ä»¥javaæä¾›äº†ä¸€ä¸ªçº¿ç¨‹æ± çš„å·¥å…·ç±»<code>Executors</code> æ¥ä½¿ç”¨é™æ€çš„æ–¹æ³•æ¥åˆ›å»ºæ‹¥æœ‰ç‰¹å®šå±æ€§çš„çº¿ç¨‹æ± .ä¸‹é¢å…ˆæ€»ä½“çš„çœ‹ä¸€ä¸‹éƒ½æœ‰å“ªäº›åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•,å’Œå„è‡ªçš„å®ç°.</p><ol><li><code>newFixedThreadPool</code> åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚æ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°çº¿ç¨‹è¾¾åˆ°çº¿ç¨‹æ± çš„æœ€å¤§å¤§å°ã€‚çº¿ç¨‹æ± çš„å¤§å°ä¸€æ—¦è¾¾åˆ°æœ€å¤§å€¼å°±ä¼šä¿æŒä¸å˜ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å› ä¸ºæ‰§è¡Œå¼‚å¸¸è€Œç»“æŸï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šè¡¥å……ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚</li><li><code>newCachedThreadPool</code> åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ,æ­¤æ—¶çº¿ç¨‹æ± å¯¹çº¿ç¨‹å¾—å¤šå°‘æ²¡æœ‰é™åˆ¶,å¦‚æœå¤šäº†å°±å®šæ—¶å›æ”¶,å¦‚æœå°‘äº†,å°±ä¼šåªèƒ½æ·»åŠ </li><li><code>newScheduledThreadPool</code> åˆ›å»ºä¸€ä¸ªæ— é™å¤§å°çš„çº¿ç¨‹æ± ,æ­¤çº¿ç¨‹æ± å¯æ‰§è¡Œå®šæ—¶çš„ä»»åŠ¡</li><li><code>newSingleThreadExecutor</code> çº¿ç¨‹æ± ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡,å¦‚æœå› å¼‚å¸¸ç»“æŸ,åˆ™ä¼šç”Ÿæˆä¸€ä¸ªçº¿ç¨‹æ¥æ›¿æ¢åŸæ¥çš„çº¿ç¨‹.æ­¤ç§è¿æ¥æ± ä¼šæŒ‰ç…§ä»»åŠ¡çš„æäº¤é¡ºåºä¾æ¬¡æ‰§è¡Œ.å› ä¸ºæ± ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å·¥ä½œ.</li></ol><p>åœ¨<code>Excutors</code>ä¸­æœ‰ä¸Šé¢å››ç§æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹æ± ,é‚£ä¹ˆè¿™å‡ ç§çº¿ç¨‹æ± å…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢?é€šè¿‡æºç æ¥ä¸€æ¢ç©¶ç«Ÿ.</p><h2 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h2><p>é™¤äº†<code>newScheduledThreadPool</code>è¿æ¥æ± æ²¡æœ‰ä½¿ç”¨<code>ThreadPoolExcutor</code>æ¥å®ç°,å…¶ä»–ä¸‰ç§éƒ½ä½¿ç”¨åˆ°äº†<code>ThreadPoolExcutor</code>æ¥è¿›è¡Œè¿æ¥æ± çš„å®ç°å’Œå®šåˆ¶.ä¸‹å›¾æ˜¯<code>ThreadPoolExcutor</code>çš„ç»“æ„å…³ç³».å®ƒæ˜¯ExecutorServiceçš„ç›´æ¥å®ç°ç±».</p><p><img src="https://i.loli.net/2019/04/24/5cc08171ca014.jpg" alt="5cc08171ca014"></p><p>ThreadPoolExcutoræä¾›äº†ä¸‰ç§æ„é€ å‡½æ•°,ä¸åŒçš„æ„é€ å‡½æ•°å«æœ‰ä¸åŒçš„å‚æ•°.ä¸‹é¢å…ˆäº†è§£ä¸€ä¸‹å„å‚æ•°çš„å«ä¹‰</p><table><thead><tr><th align="center">å‚æ•°åç§°</th><th>å‚æ•°ç±»å‹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td align="center">corePoolSize</td><td>Int</td><td>æ± ä¸­çš„çº¿ç¨‹æ•°é‡,å³ä½¿ä»–ä»¬æ˜¯ç©ºé—²çš„,é™¤éè®¾ç½®allowCoreThreadTimeOutå‚æ•°</td></tr><tr><td align="center">maximumPoolSize</td><td>int</td><td>æ± ä¸­å…è®¸çš„æœ€å¤§çš„çº¿ç¨‹æ•°é‡</td></tr><tr><td align="center">keepAliveTime</td><td>long</td><td>å¦‚æœæ± ä¸­çš„çº¿ç¨‹è¶…è¿‡æ ¸å¿ƒæ•°,å¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´çº¿ç¨‹ä»æ˜¯ç©ºé—²çš„åˆ™ç»“æŸè¿™ä¸ªçº¿ç¨‹</td></tr><tr><td align="center">unit</td><td>TimeUnit</td><td>keepAilveTimeçš„æ—¶é—´çš„å•ä½</td></tr><tr><td align="center">workQueue</td><td>BlockingQueue<runnable></runnable></td><td>ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—,ç”¨æ¥å­˜å‚¨æœªè¿›è¡Œçš„ä»»åŠ¡.æœªæ‰§è¡Œçš„ä»»åŠ¡ä¼šä¸€ç›´åœ¨é˜Ÿåˆ—é‡Œ,çŸ¥é“ä½¿ç”¨Excuteæ–¹æ³•æ‰§è¡Œ.</td></tr><tr><td align="center">threadFactory</td><td>ThreadFactory</td><td>çº¿ç¨‹å·¥å‚,ç”¨äºç”Ÿäº§çº¿ç¨‹</td></tr><tr><td align="center">handle</td><td>RejectedExecutionHandler</td><td>æ‰§è¡Œé˜»å¡çš„å¤„ç†ç­–ç•¥,é€ æˆé˜»å¡çš„åŸå› å¯èƒ½æ˜¯è¾¾åˆ°äº†çº¿ç¨‹è¾¹ç•Œæˆ–è€…é˜Ÿåˆ—å®¹é‡</td></tr></tbody></table><p>å…¶ä¸­çº¿ç¨‹æ± ä½¿ç”¨ctlå˜é‡æ§åˆ¶çŠ¶æ€ä¿¡æ¯,ctlæ˜¯ä¸€ä¸ªAtomInteger,å…¶ä¸­é«˜28ä½è¡¨ç¤ºçº¿ç¨‹å¾—æ•°é‡,ä¹Ÿå°±æ˜¯workerCount,ä½ä½çš„4ä½è¡¨ç¤ºçº¿ç¨‹æ± çš„çŠ¶æ€.</p><table><thead><tr><th>åç§°</th><th>æ‰¿æ‹…çš„ä»»åŠ¡</th></tr></thead><tbody><tr><td>RUNNING</td><td>æ¥å—æ–°çš„ä»»åŠ¡,å¹¶ä¸”å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td></tr><tr><td>SHUTDOWN</td><td>ä¸æ¥å—æ–°çš„ä»»åŠ¡,ä½†æ˜¯ä¼šå¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td></tr><tr><td>STOP</td><td>ä¸æ¥å—æ–°ä»»åŠ¡,ä¸å¤„ç†æ’é˜Ÿçš„äººç‰©,å¹¶ä¸”ç»ˆæ­¢æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡</td></tr><tr><td>TIDYING</td><td>æ‰€æœ‰ä»»åŠ¡å·²ç»ç»ˆæ­¢,workerä¸ºç©º,é€šè¿‡terminateæ–¹æ³•æ¥è½¬æ¢ä¸ºTIDYING</td></tr><tr><td>TERMINATED</td><td>å½“terminateæ–¹æ³•æ‰§è¡Œè¿‡åçš„çŠ¶æ€</td></tr></tbody></table><p><img src="https://wx1.sinaimg.cn/large/006tNc79ly1g2cznnpfkqj311e0lcn0e.jpg" alt="Xnip2019-04-23_23-21-36"></p><h3 id="æ–¹æ³•æºç è§£æ"><a href="#æ–¹æ³•æºç è§£æ" class="headerlink" title="æ–¹æ³•æºç è§£æ"></a>æ–¹æ³•æºç è§£æ</h3><p>æäº¤çš„æ–¹æ³•submitå®åœ¨ExcutorServiceçš„å®ç°ç±»<code>AbstarctExecutorService</code>ä¸­æ‰€å®šä¹‰çš„,å¯ä»¥çœ‹å‡ºsubmitæ˜¯excuteæ–¹æ³•çš„å¤–å£³,å…¶å®æ ¸å¿ƒè¿˜æ˜¯æ‰§è¡Œexcuteæ–¹æ³•,ä½†æ˜¯ä¼šè¿”å›<code>Future</code>ç»“æœ.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public Future&lt;?&gt; submit(Runnable task) &#123;</span><br><span class="line">        if (task == null) throw new NullPointerException();</span><br><span class="line">        RunnableFuture&lt;Void&gt; ftask = newTaskFor(task, null);</span><br><span class="line">        execute(ftask);</span><br><span class="line">        return ftask;//è¿”å›Futureç»“æœ</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ‰§è¡Œçš„æ ¸å¿ƒæ–¹æ³•æ˜¯excute,æ‰€ä»¥è¿›åˆ°ThreadPoolExecutorç±»ä¸­çœ‹excuteæ–¹æ³•æ˜¯å¦‚ä½•æ‰§è¡Œçš„.å…¶å®æœ€é€šä¿—çš„è§£é‡Šexcuteçš„è¿‡ç¨‹å°±æ˜¯,å°†æ–°çš„workeråŠ å…¥åˆ°workerçš„é˜Ÿåˆ—ä¸­,å¹¶æ‰§è¡Œå½“å‰çš„commandçº¿ç¨‹.æ‰§è¡Œè¿‡ç¨‹å¯ä»¥å‚è€ƒå®˜æ–¹æ³¨é‡Š:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public void execute(Runnable command) &#123;</span><br><span class="line">        if (command == null)</span><br><span class="line">            throw new NullPointerException();</span><br><span class="line">        /**</span><br><span class="line">         * æ‰§è¡Œæ€»å…±åˆ†ä¸ºä¸‰æ­¥</span><br><span class="line">         * 1. å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°,åˆ™æ·»åŠ ä¸€ä¸ªworkeræ¥æ‰§è¡Œå½“å‰è¿™ä¸ªä»»åŠ¡</span><br><span class="line">         * 2. ä¸ºäº†é˜²æ­¢è¿›å…¥æ–¹æ³•åçº¿ç¨‹æ± å…³é—­æˆ–è€…çº¿ç¨‹æŒ‚æ‰éœ€è¦é‡æ–°è·å–ctl,å¹¶ä¸”è¿›è¡Œåˆ¤æ–­,æ˜¯å¦è¿›è¡Œ</span><br><span class="line">         * å›é€€æˆ–è€…æ˜¯ç©ºæ± åæ·»åŠ ä¸€ä¸ªç©ºçº¿ç¨‹.</span><br><span class="line">         * 3.å¦‚æœä¸èƒ½å°†ä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ä¸­,åˆ™æ‰§è¡Œrollback,å›é€€ä»»åŠ¡</span><br><span class="line">         */</span><br><span class="line">        int c = ctl.get();//è·å¾—ctlå˜é‡,ä»è€Œè·å¾—workercountå’ŒçŠ¶æ€ä¿¡æ¯</span><br><span class="line">        if (workerCountOf(c) &lt; corePoolSize) &#123; //å¦‚æœçº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°</span><br><span class="line">            if (addWorker(command, true)) //æ·»åŠ ä¸€ä¸ªæ–°çš„workeræ¥æ‰§è¡Œä»»åŠ¡</span><br><span class="line">                return;</span><br><span class="line">            c = ctl.get();</span><br><span class="line">        &#125;</span><br><span class="line">        if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; </span><br><span class="line">          //å¦‚æœå½“å‰æ± çš„çŠ¶æ€ä¸ºè¿è¡ŒçŠ¶æ€å¹¶ä¸”æ¥å—äº†è¿™ä¸ªä»»åŠ¡,ä¹Ÿå°±æ˜¯è¯´ä»»åŠ¡æˆåŠŸè¿›å…¥äº†æ‰§è¡Œé˜Ÿåˆ—</span><br><span class="line">            int recheck = ctl.get();</span><br><span class="line">          //é‡æ–°è·å–ctl,å› ä¸ºæœ‰å¯èƒ½åœ¨è¿›å…¥è¿™ä¸ªifè¯­å¥çš„æ—¶å€™ä¸€ä¸ªçº¿ç¨‹æŒ‚äº†,æˆ–è€…æ•´ä¸ªæ± è¢«å…³é—­äº†</span><br><span class="line">            if (! isRunning(recheck) &amp;&amp; remove(command)) //å¦‚æœçº¿ç¨‹æ± çš„çŠ¶æ€ä¸ºéè¿è¡ŒçŠ¶æ€</span><br><span class="line">              // ä»é˜Ÿåˆ—ä¸­ç§»é™¤ä»»åŠ¡,å¹¶ä¸”rejectä»»åŠ¡ ç›¸å½“äºç¬¬ä¸€æ­¥æ“ä½œçš„rollback</span><br><span class="line">                reject(command);</span><br><span class="line">            else if (workerCountOf(recheck) == 0) //å¦‚æœæ± æ˜¯ç©ºçš„</span><br><span class="line">                addWorker(null, false);//æ–°å»ºä¸€ä¸ªçº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">        else if (!addWorker(command, false))</span><br><span class="line">          //å¦‚æœæ”¾åˆ°é˜Ÿåˆ—ä¸­å¤±è´¥,åˆ™å°†ä»»åŠ¡rollback</span><br><span class="line">            reject(command);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹æ± ä¸­æ‹¥æœ‰çš„çŠ¶æ€æœ‰ä»¥ä¸‹å‡ ç§:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private static final int RUNNING    = -1 &lt;&lt; COUNT_BITS;</span><br><span class="line">private static final int SHUTDOWN   =  0 &lt;&lt; COUNT_BITS;</span><br><span class="line">private static final int STOP       =  1 &lt;&lt; COUNT_BITS;</span><br><span class="line">private static final int TIDYING    =  2 &lt;&lt; COUNT_BITS;</span><br><span class="line">private static final int TERMINATED =  3 &lt;&lt; COUNT_BITS;</span><br></pre></td></tr></table></figure><p>åœ¨excuteæ–¹æ³•ä¸­éœ€è¦ç”¨åˆ°addWorkeråœ¨å½“å‰çŠ¶æ€å’Œç»™å®šçš„è¾¹ç•Œæ¡ä»¶ä¸‹(æ ¸å¿ƒçº¿ç¨‹æ•°<code>core</code>æˆ–è€…æœ€å¤§çº¿ç¨‹æ•°<code>maximum</code>)èƒ½å¦æ·»åŠ ä¸€ä¸ªworkerçº¿ç¨‹æ‰§è¡Œä»»åŠ¡.å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸ºç©ºæˆ–è€…æœ‰èµ„æ ¼å…³é—­çº¿ç¨‹æ± .è¿™æ˜¯è°ƒç”¨è¯¥æ–¹æ³•ä¼šè¿”å›false.å¦‚æœçº¿ç¨‹æ± å·¥å‚<code>the thread factory</code>ä¸èƒ½å†äº§å‡ºæ›´å¤šçš„çº¿ç¨‹ä¹Ÿä¼šè¿”å›false.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">private boolean addWorker(Runnable firstTask, boolean core) &#123;</span><br><span class="line">  /**</span><br><span class="line">   * firstTask ç†è§£ä¸ºåˆå§‹åŒ–æ—¶ç»™çš„ç¬¬ä¸€ä¸ªä»»åŠ¡,å¯ä»¥ç»•è¿‡æ’é˜Ÿçš„è¿‡ç¨‹,ç›´æ¥ä½¿ç”¨æ–°çš„çº¿ç¨‹æ‰§è¡Œ</span><br><span class="line">   * core å¦‚æœæ˜¯trueåˆ™ä½¿ç”¨corePoolSizeä½œä¸ºè¾¹ç•Œ,å¦åˆ™ä½¿ç”¨maximumPoolSizeä½œä¸ºè¾¹ç•Œ</span><br><span class="line">   */</span><br><span class="line">        retry://flagæ ‡è®°</span><br><span class="line">        for (;;) &#123;</span><br><span class="line">            int c = ctl.get(); //è·å–ctlå˜é‡</span><br><span class="line">            int rs = runStateOf(c);// è·å–çŠ¶æ€å‚æ•°</span><br><span class="line"></span><br><span class="line">            // Check if queue empty only if necessary. æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span><br><span class="line">            if (rs &gt;= SHUTDOWN &amp;&amp;</span><br><span class="line">                ! (rs == SHUTDOWN &amp;&amp;</span><br><span class="line">                   firstTask == null &amp;&amp;</span><br><span class="line">                   ! workQueue.isEmpty()))</span><br><span class="line">                return false;</span><br><span class="line"></span><br><span class="line">            for (;;) &#123;</span><br><span class="line">                int wc = workerCountOf(c);</span><br><span class="line">                if (wc &gt;= CAPACITY ||</span><br><span class="line">                    wc &gt;= (core ? corePoolSize : maximumPoolSize))</span><br><span class="line">                  //å¦‚æœå¤§äºæœ€å¤§çš„CAPACITYæˆ–è€…wcå¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°</span><br><span class="line">                    return false;</span><br><span class="line">                if (compareAndIncrementWorkerCount(c))</span><br><span class="line">                  //ä½¿ç”¨CASæ·»åŠ workerå,æ“ä½œæˆåŠŸåè·³å‡ºå¾ªç¯</span><br><span class="line">                    break retry;</span><br><span class="line">                c = ctl.get();  // Re-read ctl</span><br><span class="line">                if (runStateOf(c) != rs)</span><br><span class="line">                    continue retry;</span><br><span class="line">                // else CAS failed due to workerCount change; retry inner loop</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        boolean workerStarted = false;</span><br><span class="line">        boolean workerAdded = false;</span><br><span class="line">        Worker w = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            w = new Worker(firstTask);//ä»¥åå•è¯´è¿™ä¸ªworker</span><br><span class="line">            final Thread t = w.thread;</span><br><span class="line">            if (t != null) &#123;</span><br><span class="line">                final ReentrantLock mainLock = this.mainLock;</span><br><span class="line">                mainLock.lock();</span><br><span class="line">              // ä½¿ç”¨ReentrantLockä¸Šé”ä¿æŒåŸå­æ€§</span><br><span class="line">                try &#123;</span><br><span class="line">                    // Recheck while holding lock.</span><br><span class="line">                    // Back out on ThreadFactory failure or if</span><br><span class="line">                    // shut down before lock acquired.</span><br><span class="line">                    int rs = runStateOf(ctl.get());</span><br><span class="line"></span><br><span class="line">                    if (rs &lt; SHUTDOWN ||</span><br><span class="line">                        (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123;</span><br><span class="line">                        if (t.isAlive()) // precheck that t is startable</span><br><span class="line">                            throw new IllegalThreadStateException();</span><br><span class="line">                        workers.add(w);</span><br><span class="line">                        int s = workers.size();</span><br><span class="line">                        if (s &gt; largestPoolSize)// å½“å‰workerçš„æ•°é‡å¤§äºlargestPoolSizeæ—¶</span><br><span class="line">                            largestPoolSize = s;</span><br><span class="line">                        workerAdded = true;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    mainLock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">                if (workerAdded) &#123;</span><br><span class="line">                    t.start();//çº¿ç¨‹å¼€å§‹æ‰§è¡Œ</span><br><span class="line">                    workerStarted = true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (! workerStarted) //å¦‚æœåˆ°è¿™é‡Œçº¿ç¨‹è¿˜æ˜¯æ²¡æœ‰å¼€å§‹,rollbackæ·»åŠ workerçš„è¿‡ç¨‹</span><br><span class="line">                addWorkerFailed(w);</span><br><span class="line">        &#125;</span><br><span class="line">        return workerStarted;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æ¶‰åŠåˆ°äº†wokerçº¿ç¨‹åˆ›å»ºçš„rollbackè¿‡ç¨‹,è°ƒç”¨äº†<code>addWorkerFailed</code>æ–¹æ³•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private void addWorkerFailed(Worker w) &#123;</span><br><span class="line">       final ReentrantLock mainLock = this.mainLock;</span><br><span class="line">       mainLock.lock();</span><br><span class="line">       try &#123;</span><br><span class="line">           if (w != null)</span><br><span class="line">               workers.remove(w);//å¦‚æœå­˜åœ¨åœ¨é˜Ÿåˆ—ä¸­ç§»é™¤w</span><br><span class="line">           decrementWorkerCount();//å‡å°‘workerCountå˜é‡çš„å€¼</span><br><span class="line">           tryTerminate();//é‡æ–°æ£€æŸ¥ç»ˆæ­¢è¿‡ç¨‹,ä»¥é˜²æ­¢å› ä¸ºè¿™ä¸ªworkerçš„å­˜åœ¨å¯¼è‡´ç»ˆæ­¢å¤±è´¥</span><br><span class="line">       &#125; finally &#123;</span><br><span class="line">           mainLock.unlock();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>åœ¨å½“è¿è¡Œçš„çº¿ç¨‹æ•°åˆ°è¾¾æ ¸å¿ƒçº¿ç¨‹æ•°å,å°±ä¼šå°†ä»»åŠ¡æ’å…¥åˆ°workQueueé‡Œé¢,è®©æ± ä¸­çš„å·¥ä½œçº¿ç¨‹å®Œæˆä»»åŠ¡,ä¸Šé¢çš„æºç ä¸­ä½¿ç”¨addWokeræ–¹æ³•æ¥æ‰§è¡Œå½“å‰æŒ‡å®šçš„ä»»åŠ¡,è€Œæœªæ¶‰åŠåˆ°åŠ å…¥åˆ°workQueueä¸­çš„ä»»åŠ¡æ˜¯å¦‚ä½•æ‰§è¡Œçš„,ä¸‹é¢é€šè¿‡æŸ¥çœ‹Wokerä¸­çš„runæ–¹æ³•æ¥æŸ¥çœ‹æ± ä¸­çš„çº¿ç¨‹å¦‚ä½•è·å–ä»»åŠ¡æ¥æ‰§è¡Œçš„è¿‡ç¨‹.</p><p>å› ä¸ºWorkerå®ç°AQSã€ŒAbstractQueuedSynchronizerã€,å¹¶ç»§æ‰¿æ¥Runnable,æ‰€ä»¥Workerå…¶å®æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªçº¿ç¨‹.åœ¨æ‰§è¡Œstartå,åŒæ ·ä¼šæ‰§è¡Œrunæ–¹æ³•.</p><p>Workerä¸­çš„å…¨å±€å˜é‡:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/** Thread this worker is running in.  Null if factory fails. æ‰§è¡Œå½“å‰å·¥ä½œçº¿ç¨‹*/</span><br><span class="line">final Thread thread;</span><br><span class="line">/** åˆå§‹åŒ–çš„ä»»åŠ¡,å¯èƒ½æ˜¯ç©º*/</span><br><span class="line">Runnable firstTask;</span><br><span class="line">/** æ¯ä¸ªçº¿ç¨‹çš„ä»»åŠ¡è®¡æ•°å™¨(ç»Ÿè®¡å®Œæˆçš„ä»»åŠ¡æ•°) */</span><br><span class="line">volatile long completedTasks;</span><br></pre></td></tr></table></figure><p>Workerçš„æ„é€ å™¨,é»˜è®¤æ˜¯éœ€è¦ä¼ å…¥Runnableçš„ä»»åŠ¡çš„.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Worker(Runnable firstTask) &#123;</span><br><span class="line">    setState(-1); // inhibit interrupts until runWorker</span><br><span class="line">    this.firstTask = firstTask;</span><br><span class="line">    this.thread = getThreadFactory().newThread(this);//ä¿å­˜ä»ThreadFactoryä¸­è·å–åˆ°çš„Thread</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>workerä¸­çš„æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//æŸ¥çœ‹æ˜¯å¦æ˜¯ç‹¬å çš„</span><br><span class="line">protected boolean isHeldExclusively() &#123;</span><br><span class="line">    return getState() != 0; //AQSä¸­çš„stateä¿å­˜è¿™ä¸ªçŠ¶æ€</span><br><span class="line">&#125;</span><br><span class="line">//å°è¯•è·å¾—é”</span><br><span class="line">protected boolean tryAcquire(int unused) &#123;</span><br><span class="line">    if (compareAndSetState(0, 1)) &#123; //é€šè¿‡æ”¹å˜stateæ¥å®ç° å¦‚æœstate&gt;0è¯´æ˜è·å–åˆ°äº†é”</span><br><span class="line">        setExclusiveOwnerThread(Thread.currentThread()); //è®¾ç½®ç‹¬å è®¿é—®çš„çº¿ç¨‹</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line">//å°è¯•é‡Šæ”¾é”</span><br><span class="line">protected boolean tryRelease(int unused) &#123;</span><br><span class="line">    setExclusiveOwnerThread(null);//æ¸…ç©ºç‹¬å è®¿é—®çš„çº¿ç¨‹</span><br><span class="line">    setState(0);//çŠ¶æ€ç½®ä¸ºã€Œé‡Šæ”¾é”ã€</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void lock()        &#123; acquire(1); &#125;</span><br><span class="line">public boolean tryLock()  &#123; return tryAcquire(1); &#125;</span><br><span class="line">public void unlock()      &#123; release(1); &#125;</span><br><span class="line">public boolean isLocked() &#123; return isHeldExclusively(); &#125;</span><br><span class="line"></span><br><span class="line">void interruptIfStarted() &#123;</span><br><span class="line">    Thread t;</span><br><span class="line">    if (getState() &gt;= 0 &amp;&amp; (t = thread) != null &amp;&amp; !t.isInterrupted()) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            t.interrupt();</span><br><span class="line">        &#125; catch (SecurityException ignore) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨addWorkeä¸­è°ƒç”¨runæ–¹æ³•æ‰§è¡Œä»»åŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">/** Delegates main run loop to outer runWorker  */</span><br><span class="line">public void run() &#123;</span><br><span class="line">    runWorker(this); //å§”æ‰˜runWorkeræ‰§è¡Œ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">final void runWorker(Worker w) &#123;</span><br><span class="line">    Thread wt = Thread.currentThread();//è·å¾—å½“å‰çº¿ç¨‹</span><br><span class="line">    Runnable task = w.firstTask;//è·å¾—ä»»åŠ¡</span><br><span class="line">    w.firstTask = null;</span><br><span class="line">    w.unlock(); // allow interrupts</span><br><span class="line">    boolean completedAbruptly = true;</span><br><span class="line">    try &#123;</span><br><span class="line">        while (task != null || (task = getTask()) != null) &#123; //å¦‚æœå­˜åœ¨ä»»åŠ¡</span><br><span class="line">            w.lock(); //å°†å½“å‰å·¥ä½œçº¿ç¨‹ä¸Šé”</span><br><span class="line">            // If pool is stopping, ensure thread is interrupted;</span><br><span class="line">            // if not, ensure thread is not interrupted.  This</span><br><span class="line">            // requires a recheck in second case to deal with</span><br><span class="line">            // shutdownNow race while clearing interrupt</span><br><span class="line">            //å¦‚æœçº¿ç¨‹æ± æ­£åœ¨è¢«åœæ­¢,éœ€è¦ç¡®ä¿çº¿ç¨‹å·²ç»è¢«ä¸­æ–­</span><br><span class="line">            //å¦‚æœçº¿ç¨‹æ± æ²¡æœ‰è¢«åœæ­¢,éœ€è¦ç¡®ä¿çº¿ç¨‹ä¸èƒ½è¢«ä¸­æ–­</span><br><span class="line">            if ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                 (Thread.interrupted() &amp;&amp;</span><br><span class="line">                  runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</span><br><span class="line">                !wt.isInterrupted())</span><br><span class="line">                wt.interrupt();</span><br><span class="line">            try &#123;</span><br><span class="line">                beforeExecute(wt, task);</span><br><span class="line">                Throwable thrown = null;</span><br><span class="line">                try &#123;</span><br><span class="line">                    task.run(); //æ‰§è¡Œä»»åŠ¡</span><br><span class="line">                &#125; catch (RuntimeException x) &#123;</span><br><span class="line">                    thrown = x; throw x;</span><br><span class="line">                &#125; catch (Error x) &#123;</span><br><span class="line">                    thrown = x; throw x;</span><br><span class="line">                &#125; catch (Throwable x) &#123;</span><br><span class="line">                    thrown = x; throw new Error(x);</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    afterExecute(task, thrown);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                task = null; //æ¸…ç©ºä»»åŠ¡</span><br><span class="line">                w.completedTasks++; //å½“å‰çº¿ç¨‹å¤„ç†ä»»åŠ¡æ•°åŠ ä¸€</span><br><span class="line">                w.unlock();//è§£é”</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        completedAbruptly = false;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        processWorkerExit(w, completedAbruptly);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="AQSã€ŒAbstractQueuedSynchronizerã€-é˜Ÿåˆ—åŒæ­¥å™¨"><a href="#AQSã€ŒAbstractQueuedSynchronizerã€-é˜Ÿåˆ—åŒæ­¥å™¨" class="headerlink" title="AQSã€ŒAbstractQueuedSynchronizerã€ é˜Ÿåˆ—åŒæ­¥å™¨"></a>AQSã€ŒAbstractQueuedSynchronizerã€ é˜Ÿåˆ—åŒæ­¥å™¨</h2><p>AQSçš„ä½¿ç”¨æ–¹å¼æ˜¯ç»§æ‰¿,ä¹‹ç±»é€šè¿‡ç»§æ‰¿AQS,å®ç°æŠ½è±¡æ–¹æ³•æ¥å®ç°ç®¡ç†åŒæ­¥å™¨. å…¶ä¸­ä¸Šæ–‡ä¸­çš„ThreadPoolExcutorä¸­çš„Workerå°±æ˜¯ç»§æ‰¿AQSæ¥å®ç°çš„.</p><p>AQSä½¿ç”¨ä¸€ä¸ªå…¨å±€å˜é‡stateæ¥è¡¨ç¤ºå½“å‰çš„é”çš„çŠ¶æ€,å¦‚æœstate&gt;0,è¯´æ˜å·²ç»è·å–åˆ°äº†é”,å¦‚æœstate=0,è¯´æ˜é‡Šæ”¾äº†é”.</p><p>AQSä¾é CLHé˜Ÿåˆ—å®Œæˆå¯¹çŠ¶æ€çš„ç®¡ç†.å½“å‰çº¿ç¨‹å¦‚æœè·å–åŒæ­¥çŠ¶æ€å¤±è´¥æ—¶ï¼ŒAQSåˆ™ä¼šå°†å½“å‰çº¿ç¨‹å·²ç»ç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æ„é€ æˆä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰å¹¶å°†å…¶åŠ å…¥åˆ°CLHåŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œå½“åŒæ­¥çŠ¶æ€é‡Šæ”¾æ—¶ï¼Œä¼šæŠŠé¦–èŠ‚ç‚¹å”¤é†’ï¼ˆå…¬å¹³é”ï¼‰ï¼Œä½¿å…¶å†æ¬¡å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚</p><p>å…¶ä¸­CLHçš„ä¸€ä¸ªèŠ‚ç‚¹åŒ…æ‹¬äº†:å½“å‰çš„çŠ¶æ€,å‰é©±,åç»§,å½“å‰èŠ‚ç‚¹ä¿å­˜çš„çº¿ç¨‹.</p><p>å…·ä½“çš„AQSè¿‡ç¨‹å¯ä»¥å‚è€ƒ<a href="https://juejin.im/entry/5ae02a7c6fb9a07ac76e7b70" target="_blank" rel="noopener">QASåŸç†</a></p><h2 id="è¡¥å……çš„countDownLatchå’ŒcyclicBarrierçš„åŒºåˆ«"><a href="#è¡¥å……çš„countDownLatchå’ŒcyclicBarrierçš„åŒºåˆ«" class="headerlink" title="è¡¥å……çš„countDownLatchå’ŒcyclicBarrierçš„åŒºåˆ«"></a>è¡¥å……çš„countDownLatchå’ŒcyclicBarrierçš„åŒºåˆ«</h2><p><img src="https://camo.githubusercontent.com/5c19d9e66ffaf3d7193b01948279db9b9b3b98d3/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f4a6176612532302545372541382538422545352542412538462545352539312539382545352542462538352545352541342538372545462542432539412545352542392542362545352538462539312545372539462541352545382541462538362545372542332542422545372542422539462545362538302542422545372542422539332f4151533333332e706e67" alt="åŒºåˆ«"></p>]]></content>
      
      
      <categories>
          
          <category> å¤šçº¿ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ç†è§£å’Œä½¿ç”¨synchronizedå…³é”®å­—</title>
      <link href="/2019/04/22/2019-04-22-Synchronized%E5%85%B3%E9%94%AE%E5%AD%97%E6%80%BB%E7%BB%93/"/>
      <url>/2019/04/22/2019-04-22-Synchronized%E5%85%B3%E9%94%AE%E5%AD%97%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h1><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨synchronized"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨synchronized" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨synchronized"></a>ä¸ºä»€ä¹ˆè¦ç”¨<code>synchronized</code></h2><p>å¤šçº¿ç¨‹æœ‰ä¸‰å¤§ç‰¹æ€§ï¼šåŸå­æ€§ï¼Œæœ‰åºæ€§ï¼ˆé‡æ’åºé—®é¢˜ï¼Ÿï¼‰å’Œå¯è§æ€§ï¼›å…¶ä¸­åŸå­æ€§åœ¨ç¨‹åºä¸Šçš„ä½“ç°å°±æ˜¯ä½¿ç”¨synchronized,ä¸ºäº†ä¿è¯å¯è§æ€§æ˜¯ä½¿ç”¨éœ€è¦ä½¿ç”¨volatile.ä½¿ç”¨synchronizedæ¥ä¿è¯ç¨‹åºçš„åŸå­æ€§</p><p>é¦–å…ˆåœ¨è®¨è®ºä¸‰å¤§ç‰¹æ€§å‰éœ€è¦çŸ¥é“javaçš„å†…å­˜æ¨¡å‹å’Œhappen-beforeåŸåˆ™ã€‚<a href="https://www.jianshu.com/p/cf57726e77f2" target="_blank" rel="noopener">å†…å­˜æ¨¡å‹ä¸happen-beforeåŸåˆ™</a></p><p>ç‰µæ‰¯å‡ºçš„é—®é¢˜ï¼š</p><ol><li><p>ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼šæˆ‘çš„ç†è§£å°±æ˜¯å¦‚æœä¿è¯å¤šçº¿ç¨‹æ‰§è¡Œçš„ç»“æœå’Œé¢„æœŸç»“æœç›¸åŒï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦åˆ™å°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</p></li><li><p>ä»€ä¹ˆæ˜¯JAVAå†…å­˜æ¨¡å‹ï¼Ÿ </p><p> åœ¨javaå†…å®¹ä¸­ç¨‹åºè®¡æ•°å™¨ï¼Œè™šæ‹Ÿæœºæ ˆï¼Œæœ¬åœ°æ–¹æ³•æ ˆéƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„åŒºåŸŸï¼Œè€Œæ–¹æ³•åŒºå’Œjavaå †æ˜¯çº¿ç¨‹å…±äº«çš„åŒºåŸŸ</p><p> å› ä¸ºcpuçš„å¤„ç†é€Ÿåº¦ä¸å†…å­˜çš„è¯»å†™é€Ÿåº¦ä¹‹é—´æœ‰ç€ç€å·¨å¤§çš„å·®è·ï¼Œæ‰€ä»¥åœ¨cpuå’Œå†…å­˜é—´æ·»åŠ ä¸€å±‚ç¼“å­˜ï¼Œæ¯æ¬¡ç°åœ¨cpuçš„ç¼“å­˜ä¸­ï¼Œè¿™ä¸ªç¼“å­˜åŒºåŸŸçš„è¯»å†™é€Ÿåº¦å¾€å¾€æ¯”å†…å­˜çš„è¯»å†™é€Ÿåº¦å¿«å¾ˆå¤šï¼Œè¿™æ ·å°±èƒ½å¤Ÿç¼“è§£cpuå’Œä¸»å­˜ä¹‹é—´çš„é€Ÿåº¦å·®è·ã€‚</p><p> æ‰€ä»¥æ¯æ¬¡cpuè¯»å†™æ•°æ®å‰ï¼Œä¼šå…ˆè¯»å–å…±äº«å˜é‡åˆ°æœ¬åœ°å†…å®¹ï¼Œcpuå†ä»æœ¬åœ°å†…å­˜ä¸­è¯»å–æ•°æ®ã€‚è¿™å°±æ˜¯javaçš„å†…å­˜æ¨¡å‹</p><p> è¿™æ ·ä¹Ÿä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œè¿™æ˜¯å°±è¦éœ€è¦ä¿è¯å…±äº«å˜é‡çš„æ•°æ®å¯è§æ€§ï¼Œå³çº¿ç¨‹1ä¿®æ”¹äº†å˜é‡ï¼Œåˆ™çº¿ç¨‹2å†ä¿®æ”¹å˜é‡å‰å·²ç»å¾—çŸ¥å˜é‡å·²ç»è¢«ä¿®æ”¹äº†ã€‚</p><h2 id="åº”ç”¨synchronized"><a href="#åº”ç”¨synchronized" class="headerlink" title="åº”ç”¨synchronized"></a>åº”ç”¨synchronized</h2></li></ol><p>ä¸ºäº†ä¿è¯ç¨‹åºçš„åŸå­æ€§ï¼šæˆ‘ä»¬åœ¨ç¨‹åºä¸­ä½¿ç”¨synchronizedå…³é”®å­—å¯¹ç¨‹åºè¿›è¡Œé”å®šï¼Œè¡¨ç¤ºåœ¨é”ä½çš„åŒºåŸŸå†…åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨synchronized"><a href="#å¦‚ä½•ä½¿ç”¨synchronized" class="headerlink" title="å¦‚ä½•ä½¿ç”¨synchronized"></a>å¦‚ä½•ä½¿ç”¨synchronized</h3><ul><li>ä½¿ç”¨synchronizedä¿®é¥°é™æ€æ–¹æ³•ï¼Œé’ˆå¯¹ç±»å˜é‡è¿›è¡ŒåŠ é”ã€‚è¿›å…¥æ–¹æ³•çš„å‰ææ˜¯è·å¾—ç±»çš„é”ã€‚</li><li>ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œé’ˆå¯¹å®ä¾‹å¯¹è±¡ï¼Œåœ¨è¿›å…¥æ–¹æ³•å‰è¦è·å¾—å®ä¾‹å˜é‡çš„é”ã€‚</li><li>ä¿®é¥°ä»£ç å—ã€‚æŒ‡å®šåŠ é”çš„å¯¹è±¡ï¼Œåœ¨è¿›å…¥ä»£ç å—é’±è¦å…ˆè·å¾—æŒ‡å®šå¯¹è±¡çš„é”ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class SynchronizedTest &#123;</span><br><span class="line"></span><br><span class="line">    //synchronizedçš„ä¸‰ç§ç”¨æ³•</span><br><span class="line">    //1.ä¿®é¥°å®ä¾‹æ–¹æ³• éœ€è¦æ‹¥æœ‰å®ä¾‹å¯¹è±¡çš„é”</span><br><span class="line">    public synchronized void hello()&#123;</span><br><span class="line">        System.out.println(&quot;hello&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //2.ä¿®é¥°é™æ€æ–¹æ³• éœ€è¦æ‹¥æœ‰ç±»å¯¹è±¡çš„é”</span><br><span class="line">    public synchronized static void staticHello()&#123;</span><br><span class="line">       System.out.println(&quot;staticHello&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void blockHello()&#123;</span><br><span class="line">        //3.ä¿®é¥°ä»£ç å— éœ€è¦æ‹¥æœ‰ã€thisã€‘çš„é”</span><br><span class="line">        synchronized(this)&#123;</span><br><span class="line">            System.out.println(&quot;code block hello&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¸å‹çš„ä½¿ç”¨synchronizedçš„åœºæ™¯â€“å•ä¾‹æ¨¡å¼çš„åŒé‡é”ç»“æ„"><a href="#å…¸å‹çš„ä½¿ç”¨synchronizedçš„åœºæ™¯â€“å•ä¾‹æ¨¡å¼çš„åŒé‡é”ç»“æ„" class="headerlink" title="å…¸å‹çš„ä½¿ç”¨synchronizedçš„åœºæ™¯â€“å•ä¾‹æ¨¡å¼çš„åŒé‡é”ç»“æ„"></a>å…¸å‹çš„ä½¿ç”¨synchronizedçš„åœºæ™¯â€“å•ä¾‹æ¨¡å¼çš„åŒé‡é”ç»“æ„</h3><p>åœ¨è®¨è®ºåŒé‡é”çš„å‰ï¼Œéœ€è¦èŠèŠå•ä¾‹æ¨¡å¼ï¼Œå•ä¾‹æ¨¡å¼é€šä¿—çš„æ¥è¯´ä¸€ä¸ªç±»åªèƒ½æ„é€ ä¸€ä¸ªå®ä¾‹ã€‚é’ˆå¯¹çš„å®ç°åˆä¸¤ç§ï¼š1.é¥¿æ±‰æ¨¡å¼ï¼Œ2.æ‡’æ±‰æ¨¡å¼</p><h4 id="é¥¿æ±‰æ¨¡å¼"><a href="#é¥¿æ±‰æ¨¡å¼" class="headerlink" title="é¥¿æ±‰æ¨¡å¼"></a>é¥¿æ±‰æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">    private Singleton()&#123;&#125;;</span><br><span class="line">    //1. ä½¿ç”¨é™æ€å˜é‡</span><br><span class="line">//    private static Singleton singleton = new Singleton();</span><br><span class="line">    //2.ä½¿ç”¨é™æ€ä»£ç å— æœªä½¿ç”¨æ—¶é€ æˆå†…å­˜ç©ºé—´æµªè´¹</span><br><span class="line">    private static Singleton singleton;</span><br><span class="line">    static &#123;</span><br><span class="line">        singleton = new Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">    public Singleton newInstance()&#123;</span><br><span class="line">        return singleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¸ä¼šå½±å“åˆ°å¤šçº¿ç¨‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºç±»çš„è£…è½½æœºåˆ¶åœ¨åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™æ˜¯ä¿è¯ä¸ä¼šæœ‰ç¬¬äºŒä¸ªçº¿ç¨‹è¿›å…¥çš„ã€‚ä½†æ˜¯æœ‰ä¸ªå¾ˆå¤§çš„å¼Šç«¯æ˜¯ä»–ä¸æ˜¯<code>lazy-loading</code>çš„ï¼Œè¿™å›äº§ç”Ÿèµ„æºçš„æµªè´¹ï¼Œæ¯”å¦‚åˆ›å»ºå®Œå¯¹è±¡åï¼Œè‡ªå§‹è‡³ç»ˆæ²¡ç”¨è¿‡ã€‚æ‰€ä»¥ä¸æ¨èä½¿ç”¨</p><h4 id="æ‡’æ±‰æ¨¡å¼"><a href="#æ‡’æ±‰æ¨¡å¼" class="headerlink" title="æ‡’æ±‰æ¨¡å¼"></a>æ‡’æ±‰æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">    private void Singleton()&#123;&#125;</span><br><span class="line">    private static Singleton singleton;</span><br><span class="line"></span><br><span class="line">    // æ™®é€šçš„çº¿ç¨‹ä¸å®‰å…¨çš„</span><br><span class="line">    public Singleton newInstance()&#123;</span><br><span class="line">        if(singleton == null)&#123;</span><br><span class="line">            singleton = new Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        return singleton;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //2.é™æ€å†…éƒ¨ç±» ä¸€æ–¹é¢èƒ½å¤Ÿè¾¾åˆ°lazy-loadingçš„æ•ˆæœï¼Œå¦ä¸€æ–¹é¢èƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºjvmä¿è¯åˆå§‹åŒ–çš„æ—¶å€™åˆ«çš„çº¿ç¨‹æ˜¯ä¸èƒ½è¿›å…¥çš„</span><br><span class="line">   private static class newSingleton&#123;</span><br><span class="line">        private static final Singleton INSTANCE = new Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Singleton newInstanceInnerClass()&#123;</span><br><span class="line">        return newSingleton.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„ç¬¬ä¸€ç§æ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹ä¸‹ä¼šå¯¼è‡´å¤±æ•ˆã€‚è€Œç¬¬äºŒç§ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼å®ç°èƒ½å¤Ÿå®ç°çº¿ç¨‹å®‰å…¨å¾—å®œäºç±»çš„åŠ è½½æœºåˆ¶ï¼Œç±»ä¼¼é¥¿æ±‰æ¨¡å¼ã€‚ä½†åŒæ—¶å…·æœ‰<code>lazy-Loading</code>çš„ç‰¹æ€§ã€‚æ˜¯å¸¸ç”¨çš„å•ä¾‹æ¨¡å¼ç”¨æ³•ã€‚</p><h4 id="double-check-åŒé‡é”"><a href="#double-check-åŒé‡é”" class="headerlink" title="double-check åŒé‡é”"></a>double-check åŒé‡é”</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class DoubleCheck &#123;</span><br><span class="line">    private void DoubleCheck()&#123;&#125;</span><br><span class="line">    private volatile DoubleCheck doubleCheck; //ä½¿ç”¨volatileä¿è¯åŸå­æ€§ï¼Œé˜²æ­¢é‡æ’åº</span><br><span class="line">    public DoubleCheck newInstance()&#123;</span><br><span class="line">        if(doubleCheck == null)&#123;</span><br><span class="line">            // å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åˆ°è¿™æ­¥ aå…ˆè¿›åŒæ­¥å—ï¼Œåœ¨aè¿›å…¥åè·å¾—instanceåï¼Œbè·å¾—é”ï¼Œè¿›å…¥åŒæ­¥å—ï¼Œ</span><br><span class="line">            // è¿™æ—¶å€™ä¸‹ä¸€ä¸ªåˆ¤æ–­å°±èµ·åˆ°ä½œç”¨äº†ï¼Œè¿™æ—¶å€™çš„doubleCheckä¸ä¸ºç©ºï¼Œ</span><br><span class="line">            // ç›´æ¥returnï¼Œå¦åˆ™åˆï¸æ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡</span><br><span class="line">            synchronized (DoubleCheck.class)&#123;</span><br><span class="line">                if(doubleCheck == null)&#123;</span><br><span class="line">                    doubleCheck = new DoubleCheck();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return doubleCheck;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šdouble-checkä¹Ÿæ˜¯æ‡’æ±‰æ¨¡å¼çš„ä¸€ç§ï¼Œèƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å¾ˆå®Œç¾ã€‚ã€‚</p><h3 id="synchronzied-åº•å±‚å®ç°"><a href="#synchronzied-åº•å±‚å®ç°" class="headerlink" title="synchronzied åº•å±‚å®ç°"></a>synchronzied åº•å±‚å®ç°</h3><p>synchronized åŒæ­¥<code>è¯­å¥å—</code>çš„å®ç°ä½¿ç”¨çš„æ˜¯<code>monitorenter</code> å’Œ<code>monitorexit</code> æŒ‡ä»¤ï¼Œå…¶ä¸­ <code>monitorenter</code> æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œ<code>monitorexit</code> æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚</p><blockquote><p> synchronized ä¿®é¥°çš„<code>æ–¹æ³•</code>å¹¶æ²¡æœ‰ monitorenter æŒ‡ä»¤å’Œ monitorexit æŒ‡ä»¤ï¼Œå–å¾—ä»£ä¹‹çš„ç¡®å®æ˜¯ ACC_SYNCHRONIZED æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼ŒJVM é€šè¿‡è¯¥ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—æ¥è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„åŒæ­¥è°ƒç”¨ã€‚</p></blockquote><h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><p>volatileæ˜¯javaæœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚</p><h2 id="volatile-ç‰¹æ€§"><a href="#volatile-ç‰¹æ€§" class="headerlink" title="volatile ç‰¹æ€§"></a>volatile ç‰¹æ€§</h2><ol><li>volatileä½œç”¨ä¸å˜é‡,ç”¨æ¥ä¿è¯å˜é‡çš„åœ¨å„çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§,ä½¿ç”¨volatileä¿®é¥°å˜é‡,è¡¨ç¤ºå˜é‡ä¸ç¨³å®š,æ¯æ¬¡éƒ½éœ€è¦å†™å…¥,å¹¶é‡æ–°è·å–.æ‰€ä»¥æ¯æ¬¡éƒ½æ˜¯è·å–çš„éƒ½æ˜¯ä¸»å­˜å†…æœ€æ–°çš„å˜é‡çš„å€¼.</li><li>ç¦æ­¢æŒ‡ä»¤é‡æ’åˆ—ä¼˜åŒ–</li><li>volatile åªèƒ½ä¿è¯å¯è§æ€§,ä¸èƒ½ä¿è¯åŸå­æ€§.</li></ol><h3 id="volatileå’Œsynachronizedçš„åŒºåˆ«"><a href="#volatileå’Œsynachronizedçš„åŒºåˆ«" class="headerlink" title="volatileå’Œsynachronizedçš„åŒºåˆ«"></a>volatileå’Œsynachronizedçš„åŒºåˆ«</h3><ol><li>volatileæ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡çº§å®ç°ï¼Œæ‰€ä»¥è¯´ä½¿ç”¨volatileçš„æ€§èƒ½è‚¯å®šè¦å¼ºäºsynchronizedã€‚</li><li>volatileä½œç”¨äºå˜é‡ï¼Œè€Œsynachronziedä½œç”¨äºæ–¹æ³•å’Œä»£ç å—ã€‚</li><li>å¤šçº¿ç¨‹é—´ä½¿ç”¨volatileä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œè€Œä½¿ç”¨synachronizedå¯èƒ½å‘ç”Ÿé˜»å¡</li><li>volatileä¿è¯å˜é‡åœ¨å¤šçº¿ç¨‹é—´çš„å¯è§æ€§ï¼Œè€Œsynchronizedæ—¢èƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼Œåˆèƒ½ä¿è¯åŸå­æ€§ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> å¤šçº¿ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¸­å¸¸ç”¨å…³é”®å­—æ€»ç»“</title>
      <link href="/2019/04/22/2019-04-12-Java%E4%B8%AD%E5%B8%B8%E7%94%A8%E5%85%B3%E9%94%AE%E5%AD%97/"/>
      <url>/2019/04/22/2019-04-12-Java%E4%B8%AD%E5%B8%B8%E7%94%A8%E5%85%B3%E9%94%AE%E5%AD%97/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaä¸­å…³é”®å­—æ€»ç»“"><a href="#Javaä¸­å…³é”®å­—æ€»ç»“" class="headerlink" title="Javaä¸­å…³é”®å­—æ€»ç»“"></a>Javaä¸­å…³é”®å­—æ€»ç»“</h1><h2 id="finalå…³é”®å­—"><a href="#finalå…³é”®å­—" class="headerlink" title="finalå…³é”®å­—"></a>finalå…³é”®å­—</h2><p><code>final</code>ä¸»è¦ç”¨äºä¸‰ä¸ªåœ°æ–¹ï¼šå˜é‡ã€æ–¹æ³•ã€ç±»</p><ul><li>å˜é‡ï¼š å¦‚æœ<code>final</code>ä¿®é¥°å˜é‡ï¼Œå¦‚æœå˜é‡æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ™è¡¨ç¤ºå¦‚æœè¯¥åŸºæœ¬æ•°æ®ç±»å‹ä¸€æ—¦åˆå§‹åŒ–åˆ™ä¸èƒ½å†æ”¹å˜ï¼Œå¦‚æœä¿®é¥°å¼•ç”¨å˜é‡ï¼Œåˆ™è¡¨ç¤ºåˆå§‹åŒ–ä¹‹åä¸èƒ½æ‰§è¡Œå¦å¤–ä¸€ä¸ªå˜é‡ã€‚</li><li>æ–¹æ³•ï¼š å¦‚æœ<code>final</code>ä½œç”¨åŸŸæ–¹æ³•ä¸Šï¼Œè¯´æ˜è¯¥æ–¹æ³•æ˜¯ä¸èƒ½æ”¹å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç»§æ‰¿ç´¯æ— æ³•æ”¹å˜æ–¹æ³•ã€‚æ‰€æœ‰<code>private</code>æ–¹æ³•é»˜è®¤æ˜¯<code>final</code>çš„</li><li>ç±»ï¼šå¦‚æœ<code>final</code>ä½œç”¨ä¸ç±»ä¸Šï¼Œè¯´æ˜è¯¥ç±»æ˜¯æ— æ³•è¢«ç»§æ‰¿çš„ã€‚å¹¶ä¸”ä»–çš„ç±»ä¸­çš„æ–¹æ³•é»˜è®¤éƒ½æ˜¯<code>private</code>çš„ã€‚</li></ul><h2 id="staticå…³é”®å­—"><a href="#staticå…³é”®å­—" class="headerlink" title="staticå…³é”®å­—"></a>staticå…³é”®å­—</h2><p><code>static</code>å…³é”®å­—åœ¨ä»¥ä¸‹å››ç§æƒ…å†µä¸‹ç”¨åˆ°ã€‚</p><ul><li>ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡æˆ–æ–¹æ³•ï¼Œé€šè¿‡<code>static</code>ä¿®é¥°çš„å˜é‡æˆ–è€…æ–¹æ³•è¢«ç§°ä½œä¸ºé™æ€å˜é‡å’Œé™æ€æ–¹æ³•ã€‚å¯ä»¥é€šè¿‡ç±»å.å˜é‡æˆ–æ–¹æ³•()è°ƒç”¨ï¼Œé™æ€å˜é‡å’Œæ–¹æ³•å±äºæ•´ä¸ªç±»å¯¹è±¡ï¼Œè€Œä¸å±äºå®ä¾‹å˜é‡ã€‚é™æ€å˜é‡å­˜æ”¾åœ¨<code>java</code>å†…å­˜ä¸­çš„æ–¹æ³•åŒºã€‚</li><li>ç”¨æ¥ä¿®é¥°é™æ€ä»£ç å—ã€‚ä½¿ç”¨<code>static</code>ä¿®é¥°çš„é™æ€ä»£ç å—ï¼Œä¼šå…ˆäºä»£ç å—å’Œæ„é€ æ–¹æ³•ã€‚å¹¶ä¸”åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</li><li>ç”¨æ¥ä¿®é¥°é™æ€å†…éƒ¨ç±»ã€‚ä½¿ç”¨<code>static</code>ä¿®é¥°é™æ€å†…éƒ¨ç±»ï¼Œæœ‰ä¸¤ä¸ªç‰¹æ€§ï¼Œå…¶ä¸€æ˜¯ä»–çš„åˆ›å»ºä¸ä¾èµ–äºå¤–éƒ¨ç±»ï¼Œå…¶äºŒæ˜¯ä»–åªèƒ½è°ƒç”¨å¤–éƒ¨ç±»çš„é™æ€å˜é‡æˆ–æ–¹æ³•ã€‚</li><li>ç”¨æ¥é™æ€å¯¼å…¥åŒ…ï¼Œè¿™ä¸ªä¸å¤ªå¸¸ç”¨ã€‚ä½¿ç”¨ <code>import static</code>å¯¼å…¥é™æ€èµ„æºã€‚</li></ul><h2 id="this-å…³é”®å­—"><a href="#this-å…³é”®å­—" class="headerlink" title="this å…³é”®å­—"></a>this å…³é”®å­—</h2><p><code>this</code>ç”¨äºæ‰§è¡Œå½“å‰å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½åœ¨<code>static</code>æ–¹æ³•æˆ–è€…ä»£ç å—ä¸­ä½¿ç”¨<code>this</code>æ¥æŒ‡å‘å¯¹è±¡ã€‚</p><h2 id="super-å…³é”®å­—"><a href="#super-å…³é”®å­—" class="headerlink" title="super å…³é”®å­—"></a>super å…³é”®å­—</h2><p><code>this</code>å…³é”®å­—æŒ‡å‘æœ¬èº«å¯¹è±¡ï¼Œè€Œ<code>super</code>å…³é”®å­—åˆ™æŒ‡å‘çˆ¶ç±»å¯¹è±¡ã€‚</p><h1 id="javaä¸­äºŒè¿›åˆ¶è¿ç®—æ“ä½œ"><a href="#javaä¸­äºŒè¿›åˆ¶è¿ç®—æ“ä½œ" class="headerlink" title="javaä¸­äºŒè¿›åˆ¶è¿ç®—æ“ä½œ"></a>javaä¸­äºŒè¿›åˆ¶è¿ç®—æ“ä½œ</h1><h2 id="ä¸è¿ç®—-amp"><a href="#ä¸è¿ç®—-amp" class="headerlink" title="ä¸è¿ç®— &amp;"></a>ä¸è¿ç®— &amp;</h2><p>è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œéƒ½ä¸ºä¸€æ—¶åˆ™ä¸ºä¸€</p><h2 id="æˆ–è¿ç®—"><a href="#æˆ–è¿ç®—" class="headerlink" title="æˆ–è¿ç®— |"></a>æˆ–è¿ç®— |</h2><p>è½¬æ¢ä¸ºäºŒè¿›åˆ¶åï¼Œåªè¦æœ‰ä¸€ä¸ªä¸ºä¸€ï¼Œåˆ™ç»“æœä¸ºä¸€</p><h2 id="å¼‚æˆ–æ“ä½œ"><a href="#å¼‚æˆ–æ“ä½œ" class="headerlink" title="å¼‚æˆ–æ“ä½œ ^"></a>å¼‚æˆ–æ“ä½œ ^</h2><p>è½¬æ¢ä¸ºäºŒè¿›åˆ¶åï¼Œä¸åŒåˆ™ä¸ºä¸€</p><h2 id="å–åæ“ä½œ-ï½"><a href="#å–åæ“ä½œ-ï½" class="headerlink" title="å–åæ“ä½œ ï½"></a>å–åæ“ä½œ ï½</h2><p>æŒ‰ä½å–åçš„æ“ä½œï¼ˆç”±æ­£æ•°å˜ä¸ºè´Ÿæ•°ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public void testBitOperating()&#123;</span><br><span class="line">        System.out.println(5&amp;6);</span><br><span class="line">        // 0101</span><br><span class="line">        // 0110</span><br><span class="line">        // -----</span><br><span class="line">        // 0100 ç»“æœæ˜¯4</span><br><span class="line">        System.out.println(5 | 6);</span><br><span class="line">        // 0101</span><br><span class="line">        // 0110</span><br><span class="line">        // -----</span><br><span class="line">        // 0111 ç»“æœæ˜¯7</span><br><span class="line">        System.out.println(5 ^ 6);</span><br><span class="line">        // 0101</span><br><span class="line">        // 0110</span><br><span class="line">        // -----</span><br><span class="line">        // 0011 ç»“æœæ˜¯ 3</span><br><span class="line">        System.out.println(~5);</span><br><span class="line">        // 0.... 0101</span><br><span class="line">        //-----------</span><br><span class="line">        // 0.... 0101 è¡¥ç  = æ­£æ•°çš„è¡¥ç å’Œæºç ç›¸åŒ è´Ÿæ•°çš„è¡¥ç ç­‰äºæºç å–åå+1</span><br><span class="line">        // 1.... 0110 æºç  =  å–å ååŠ ä¸€ -6</span><br><span class="line">        System.out.println(~-6);</span><br><span class="line">        // 1.....0110</span><br><span class="line">        // 1.....1010  è¡¥ç ï¼šè´Ÿæ•°çš„è¡¥ç ä¸ºåç +1</span><br><span class="line">        // 0.....0101  æº</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸ç”¨å‘½ä»¤æ•´ç†</title>
      <link href="/2019/01/29/2019-01-29-%E5%9F%BA%E6%9C%ACLlinux%E5%91%BD%E4%BB%A4(%E5%BF%85%E9%A1%BB%E6%8E%8C%E6%8F%A1)%202/"/>
      <url>/2019/01/29/2019-01-29-%E5%9F%BA%E6%9C%ACLlinux%E5%91%BD%E4%BB%A4(%E5%BF%85%E9%A1%BB%E6%8E%8C%E6%8F%A1)%202/</url>
      
        <content type="html"><![CDATA[<h1 id="linuxä¸­å¿…é¡»æŒæ¡çš„åŸºæœ¬å‘½ä»¤"><a href="#linuxä¸­å¿…é¡»æŒæ¡çš„åŸºæœ¬å‘½ä»¤" class="headerlink" title="linuxä¸­å¿…é¡»æŒæ¡çš„åŸºæœ¬å‘½ä»¤"></a>linuxä¸­å¿…é¡»æŒæ¡çš„åŸºæœ¬å‘½ä»¤</h1><p>åœ¨å¼€å§‹å‰ï¼Œæˆ‘æ¨èå®‰è£… <a href="https://github.com/tldr-pages/tldr" target="_blank" rel="noopener">trdrï¼ˆtoo long dont readï¼‰</a>å·¥å…·ï¼Œç”¨æ¥ç®€åŒ–manå‘½ä»¤ï¼Œæ¥å®ç°æŸ¥çœ‹å‘½ä»¤å«ä¹‰å’Œç”¨æ³•çš„ä½œç”¨ã€‚</p><h2 id="ä¸€-ã€ç³»ç»Ÿå·¥ä½œå‘½ä»¤"><a href="#ä¸€-ã€ç³»ç»Ÿå·¥ä½œå‘½ä»¤" class="headerlink" title="ä¸€ ã€ç³»ç»Ÿå·¥ä½œå‘½ä»¤"></a>ä¸€ ã€ç³»ç»Ÿå·¥ä½œå‘½ä»¤</h2><ol><li><p><code>echo</code></p><p><code>echo</code>å‘½ä»¤ä¸€èˆ¬ç”¨äºshellä¸­æ‰“å°å˜é‡æˆ–è€…å­—ç¬¦ä¸²çš„ä½œç”¨ï¼Œä¸»è¦ç”¨æ¥æ˜¾ç¤ºå’Œæé†’ã€‚</p><ul><li>è¾“å‡ºä¸€æ®µä¿¡æ¯ å¦‚ï¼š<code>echo &quot;hello world&quot;</code> å…¶ä¸­<code>&quot;</code>ä¸æ˜¯å¿…é¡»çš„ </li><li>è¾“å‡ºä¸€æ®µå¸¦ç¯å¢ƒå˜é‡çš„ä¿¡æ¯ å¦‚ï¼š<code>echo &quot;My Path is $PATH&quot;</code> </li><li>è¾“å‡ºå¹¶ä¸å¸¦æ¢è¡Œç¬¦å· å¦‚ï¼š<code>echo  -n &quot;Hello World&quot;</code></li><li>è¾“å‡ºä¸€æ®µæ¿€æ´»è½¬ä¾å­—ç¬¦ å¦‚ï¼š <code>echo -e &quot;Column 1 \t Column 2&quot;</code></li></ul></li><li><p><code>date</code> </p><p><code>date</code> å‘½ä»¤ä¸»è¦ç”¨æ¥è®¾ç½®å’Œæ‰“å°ç³»ç»Ÿæ—¶é—´ã€‚</p><ul><li>è¾“å‡ºé»˜è®¤æ—¶åŒºæ ¼å¼çš„äº‹ä»¶ <code>date +&quot;%c&quot;</code></li><li>è¾“å‡ºå½“å‰äº‹ä»¶æŒ‰ç…§UTCå’Œisoæ ¼å¼è¾“å‡º <code>date -u +&quot;%Y-%m-%dT%H:%M:%SZ&quot;</code></li><li>è¾“å‡ºäº‹ä»¶æˆ³ <code>date +&quot;%s&quot;</code></li></ul></li><li><p><code>reboot</code> å‘½ä»¤ä¸»è¦ç”¨æ¥é‡å¯ç³»ç»Ÿ</p><ul><li>é‡å¯ç³»ç»Ÿ <code>reboot</code></li><li>å¼ºåˆ¶é‡å¯ <code>reboot -f</code></li></ul></li><li><p><code>poweroff</code> å‘½ä»¤ç”¨æˆ·å…³æœº</p></li><li><p><code>wget</code> å‘½ä»¤ ç”¨äºä»webä¸­ä¸‹è½½æ–‡ä»¶ï¼Œæ”¯æŒ <code>http</code>,<code>https</code>,<code>ftp</code></p><ul><li>è·å–URLä¸­çš„å†…å®¹åˆ°<code>foo</code>ä¸­ <code>wget https://example.com/foo</code></li><li>è·å–URLä¸­çš„å†…å®¹åˆ°barä¸­ <code>wget -O bar https://example.com/foo</code></li><li>ç»§ç»­æœªå®Œæˆçš„ä¸‹è½½ <code>wget -c https://example.com</code></li><li>åå°ä¸‹è½½ <code>wget -q https://example.com</code></li></ul></li><li><p><code>ps</code>å‘½ä»¤ä¸»è¦ç”¨äºæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„ä¿¡æ¯</p><ul><li>æ‰“å°å…¨éƒ¨æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ <code>ps aux</code></li><li>æ‰“å°å…¨éƒ¨æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹å¹¶ä¸”ä¼´æœ‰å®Œæ•´çš„å‘½ä»¤ä¸² <code>ps auxww</code></li><li>é€šè¿‡ <code>grep</code> ç®¡é“è¿‡æ»¤ <code>ps aux | grep &quot;tomcat&quot;</code></li><li>å¾—åˆ°è¿›ç¨‹çš„çˆ¶è¿›ç¨‹<code>pid</code> :<code>ps -o ppid= -p pid</code> </li></ul></li><li><p><code>top</code>å‘½ä»¤ ä¸»è¦ç”¨æˆ·åŠ¨æ€çš„å®æ—¶çš„æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„ç¨‹åº</p><ul><li><code>top -i</code> ä¸æ˜¾ç¤ºç©ºé—²æˆ–è€…æ˜¯åƒµå°¸è¿›ç¨‹</li><li><code>top -u $user</code> æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·çš„è¿›ç¨‹ </li><li><code>top -p PID</code> åªæ˜¾ç¤ºæŒ‡å®šè¿›ç¨‹PID</li><li><code>top -p $(pgrep -d &#39;,&#39; process_name)</code> é€šè¿‡è¿›ç¨‹åæ¥æŸ¥è¯¢</li></ul></li><li><p><code>pidof</code> å‘½ä»¤ä¸»è¦ç”¨äºæŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹çš„idå·</p><ul><li><code>pidof -s</code> è¿›è¿”å›ä¸€ä¸ªè¿›ç¨‹å·</li><li><code>pidof</code> -c ä»…æ˜¾ç¤ºå…·æœ‰ç›¸åŒrootç›®å½•ä¸‹çš„è¿›ç¨‹</li></ul></li></ol><h2 id="äºŒã€ç³»ç»ŸçŠ¶æ€"><a href="#äºŒã€ç³»ç»ŸçŠ¶æ€" class="headerlink" title="äºŒã€ç³»ç»ŸçŠ¶æ€"></a>äºŒã€ç³»ç»ŸçŠ¶æ€</h2><ol><li><code>ifconfig</code> å‘½ä»¤ä¸»è¦ç”¨äºç½‘ç»œæ¥å£çš„æŸ¥çœ‹å’Œé…ç½®</li></ol><ul><li><code>Ifconfig eth0</code> æŸ¥çœ‹etho0æ¥å£ç½‘ç»œè®¾ç½®</li><li><code>ifconfig -a</code> æŸ¥çœ‹æ‰€æœ‰æ¥å£çš„è¯¦ç»†ä¿¡æ¯</li><li><code>ifconfig eth0 down</code> å…³é—­æ¥å£eth0</li><li><code>ifconfig eth0 ipaddr</code> è®¾ç½®ç«¯å£ipåœ°å€</li></ul><ol start="2"><li><code>uname</code> æ‰“å°å‡ºç°å½“å‰æœºå™¨å’Œç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯</li></ol><ul><li><code>uname -n</code> æ‰“å°å½“å‰çš„<code>hostname</code></li><li><code>uname -a</code> æ‰“å°å½“å‰å¯ç”¨çš„ç³»ç»Ÿçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è½¯ä»¶ã€‚</li></ul><ol start="3"><li><code>who</code> æ‰“å°å“ªäº›ç”¨æˆ·ç™»å½•å†è¿™å°æœºå™¨ä¸Š</li></ol><ul><li><code>who</code> æ˜¾ç¤º<code>username</code>ç­‰æ¯”è¾ƒå…¨çš„ä¿¡æ¯</li><li><code>who am i</code> æ‰“å°å‡ºå½“å‰ç”¨æˆ· </li></ul><ol start="4"><li><code>last</code> ç”¨äºæŸ¥çœ‹å½“å‰ç”¨æˆ·æœ€è¿‘çš„ç™»å½•ä¿¡æ¯</li></ol><h2 id="ä¸‰ã€æ–‡ä»¶å’Œç›®å½•"><a href="#ä¸‰ã€æ–‡ä»¶å’Œç›®å½•" class="headerlink" title="ä¸‰ã€æ–‡ä»¶å’Œç›®å½•"></a>ä¸‰ã€æ–‡ä»¶å’Œç›®å½•</h2><ol><li><p><code>pwd</code> ç”¨äºæ‰“å°å½“å‰ç›®å½•</p></li><li><p><code>cd</code> ç”¨äºåˆ‡æ¢ç›®å½•</p></li><li><p><code>ls</code> ç”¨äºç½—åˆ—ç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹</p></li></ol><ul><li><code>ls -l</code>æŒ‰è¡Œç½—åˆ—æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</li><li><code>ls -a</code> æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—çš„æ–‡ä»¶ã€‚</li><li><code>ls -lh</code> æŒ‰ç…§å¤§å°æ’æ³„æ’åˆ—</li></ul><ol start="4"><li><code>touch</code> å‘½ä»¤ä¸»è¦ç”¨äºæ”¹å˜æ–‡ä»¶çš„è®¿é—®æ—¶é—´å’Œä¿®æ”¹æ—¶é—´ã€‚</li></ol><ul><li><code>touch filename</code> ä»¥å½“å‰æ—¶é—´åˆ›å»ºæ–‡ä»¶</li><li><code>touch -t yyyy-mm-dd filename</code> ä»¥æŸä¸€æ—¶é—´æ¥æ”¹å˜æ–‡ä»¶æ—¶é—´</li></ul><ol start="5"><li><code>mkdir</code> å‘½ä»¤ä¸»è¦ç”¨äºåˆ›å»ºæ–‡ä»¶</li></ol><ul><li><code>mkdir dir</code> åˆ›å»ºæ–‡ä»¶å¤¹</li><li><code>mkdir -p /path/dir</code> åˆ›å»ºæŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶</li></ul><ol start="6"><li><code>cp</code> å‘½ä»¤ä¸»è¦ç”¨äºæ–‡ä»¶çš„å¤åˆ¶</li></ol><ul><li><code>cp path/to/file.ext path/to/copy.ext</code> å¤åˆ¶æ–‡ä»¶åˆ°å¦ä¸€ä¸ªåœ°å€</li><li><code>cp path/to/file.ext path/to/target_parent_directory</code> å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šåœ°å€ï¼Œå¹¶ä¸”ä¿æŒæ–‡ä»¶åä¸å˜</li><li><code>cp -r path/to/directory path/to/copy</code> é€’å½’çš„å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶ä¸­çš„å†…å®¹åˆ°æŒ‡å®šç›®å½•</li><li><code>cp -i *.txt path/to/target_directory</code> ä»¥äº¤äº’çš„æ¨¡å¼å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸­</li></ul><ol start="7"><li><code>mv</code> å‘½ä»¤ä¸»è¦ç”¨äºç§»åŠ¨æ–‡ä»¶</li></ol><ul><li><code>mv source target</code> ç§»åŠ¨æ–‡ä»¶</li><li><code>mv -f</code> å¼ºåˆ¶ç§»åŠ¨ï¼Œè¦†ç›–ç°æœ‰æ–‡ä»¶æ—¶ä¸è¦æç¤º</li></ul><ol start="8"><li><code>rm</code>å‘½ä»¤ä¸»è¦ç”¨äºåˆ é™¤æ–‡ä»¶</li></ol><ul><li><code>rm path/to/file path/to/another/file</code> åˆ é™¤ç‰¹å®šæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶</li><li><code>rm -r path/to/directory</code> é€’å½’åˆ é™¤æ–‡ä»¶å¤¹åŠæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶</li><li><code>rm -rf</code> é€’å½’åˆ é™¤ï¼Œå¹¶ä¸”ä¸è¦æç¤ºä¿¡æ¯</li></ul><ol start="9"><li><code>dd</code> å‘½ä»¤ä¸»è¦ç”¨äºè½¬åŒ–å’Œå¤åˆ¶æ–‡ä»¶,åˆ¶ä½œusbé•œåƒ</li></ol><ul><li>Clone a drive to another drive with 4MB block and ignore error <code>dd if=/dev/source_drive of=/dev/dest_drive bs=4m conv=noerror</code></li></ul><ol start="10"><li><code>file</code>å‘½ä»¤ä¸»è¦ç”¨äºç¡®å®šæ–‡ä»¶ç±»å‹</li></ol><ul><li><code>file filename</code> è¾“å‡ºæ–‡ä»¶ç±»å‹</li><li><code>file -s filename</code> ç”¨äºç‰¹æ®Šçš„æ–‡ä»¶æˆ–è€…è®¾å¤‡æ–‡ä»¶ã€‚</li></ul><h2 id="å››ã€æ–‡æœ¬ç¼–è¾‘å‘½ä»¤"><a href="#å››ã€æ–‡æœ¬ç¼–è¾‘å‘½ä»¤" class="headerlink" title="å››ã€æ–‡æœ¬ç¼–è¾‘å‘½ä»¤"></a>å››ã€æ–‡æœ¬ç¼–è¾‘å‘½ä»¤</h2><ol><li><code>cat</code> æ‰“å°å’Œä¸²è”æ–‡ä»¶</li></ol><ul><li><code>cat file</code> æ‰“å°æ–‡ä»¶å†…å®¹åˆ°æ ‡å‡†è¾“å‡º</li><li><code>cat file1 file2  &gt; targetFile</code> å°†å¤šä¸ªæ–‡ä»¶å†…å®¹ä¸²è”åˆ°ç›®æ ‡æ–‡ä»¶ä¸­</li><li><code>cat -n file</code> æ‰“å°å‡ºè¡Œæ•°åˆ°æ ‡å‡†è¾“å‡º</li></ul><ol start="2"><li><code>more</code> ç”¨äºäº’åŠ¨çš„é˜…è¯»æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥ä¸Šä¸‹æ»šåŠ¨</li></ol><ul><li><code>more file</code> æ‰“å¼€æ–‡ä»¶ï¼Œ<code>&lt;space&gt;</code>ç”¨äºç§»åŠ¨åˆ°ä¸‹ä¸€é¡µï¼Œ<code>/</code>ç”¨äºæœç´¢æ–‡ä»¶å†…å®¹ï¼Œ <code>q</code>ç”¨äºé€€å‡ºå½“å‰ç•Œé¢</li></ul><ol start="3"><li><code>head</code> è¾“å‡ºæ–‡ä»¶å¼€å§‹çš„éƒ¨åˆ†</li></ol><ul><li><code>head -n count_of_line filename</code> æŸ¥çœ‹æ–‡ä»¶çš„å‰nè¡Œ</li><li><code>head -c number_of_byte filename</code> æŸ¥çœ‹æ–‡ä»¶çš„å‰nä¸ªå­—èŠ‚</li></ul><ol start="4"><li><code>tail</code> è¾“å‡ºæ–‡ä»¶æœ€åçš„éƒ¨åˆ†</li></ol><ul><li><code>tail -n num file</code>æ‰“å°å‡ºæ–‡ä»¶æœ€ånumè¡Œ </li><li><code>tail -n +num file</code> æ‰“å°å‡ºæ–‡ä»¶ä»numå¼€å§‹çš„å‡ è¡Œ</li><li><code>tail -f file</code> ä¿æŒé˜…è¯»çŠ¶æ€ç›´åˆ° <code>Ctrl + c</code></li></ul><ol start="5"><li><code>wc</code>å‘½ä»¤ç”¨äºç»Ÿè®¡æ–‡ä»¶çš„å•è¯ï¼Œå­—èŠ‚ï¼Œè¡Œæ•° </li></ol><ul><li><code>wc -l filename</code> ç»Ÿè®¡æ–‡ä»¶çš„è¡Œæ•°</li><li><code>wc -w filename</code> ç»Ÿè®¡æ–‡ä»¶çš„å­—æ•°</li><li><code>wc -c filename</code> ç»Ÿè®¡æ–‡ä»¶çš„å­—èŠ‚æ•°</li></ul><ol start="6"><li><code>æ˜¾ç¤ºæ–‡ä»¶çš„çŠ¶æ€</code> </li></ol><ul><li><code>stat filename</code> æ˜¾ç¤ºæ–‡ä»¶çš„å±æ€§æ¯”å¦‚å¤§å°ï¼Œæƒé™ç­‰ã€‚</li><li><code>stat -x filename</code>æ ¼å¼åŒ–æ˜¾ç¤ºæ–‡ä»¶çš„è¯¦ç»†å±æ€§ä¿¡æ¯ã€‚</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸ç”¨å‘½ä»¤æ•´ç†</title>
      <link href="/2019/01/29/2019-01-29-%E5%9F%BA%E6%9C%ACLlinux%E5%91%BD%E4%BB%A4(%E5%BF%85%E9%A1%BB%E6%8E%8C%E6%8F%A1)/"/>
      <url>/2019/01/29/2019-01-29-%E5%9F%BA%E6%9C%ACLlinux%E5%91%BD%E4%BB%A4(%E5%BF%85%E9%A1%BB%E6%8E%8C%E6%8F%A1)/</url>
      
        <content type="html"><![CDATA[<h1 id="linuxä¸­å¿…é¡»æŒæ¡çš„åŸºæœ¬å‘½ä»¤"><a href="#linuxä¸­å¿…é¡»æŒæ¡çš„åŸºæœ¬å‘½ä»¤" class="headerlink" title="linuxä¸­å¿…é¡»æŒæ¡çš„åŸºæœ¬å‘½ä»¤"></a>linuxä¸­å¿…é¡»æŒæ¡çš„åŸºæœ¬å‘½ä»¤</h1><p>åœ¨å¼€å§‹å‰ï¼Œæˆ‘æ¨èå®‰è£… <a href="https://github.com/tldr-pages/tldr" target="_blank" rel="noopener">trdrï¼ˆtoo long dont readï¼‰</a>å·¥å…·ï¼Œç”¨æ¥ç®€åŒ–manå‘½ä»¤ï¼Œæ¥å®ç°æŸ¥çœ‹å‘½ä»¤å«ä¹‰å’Œç”¨æ³•çš„ä½œç”¨ã€‚</p><h2 id="ä¸€-ã€ç³»ç»Ÿå·¥ä½œå‘½ä»¤"><a href="#ä¸€-ã€ç³»ç»Ÿå·¥ä½œå‘½ä»¤" class="headerlink" title="ä¸€ ã€ç³»ç»Ÿå·¥ä½œå‘½ä»¤"></a>ä¸€ ã€ç³»ç»Ÿå·¥ä½œå‘½ä»¤</h2><ol><li><p><code>echo</code></p><p><code>echo</code>å‘½ä»¤ä¸€èˆ¬ç”¨äºshellä¸­æ‰“å°å˜é‡æˆ–è€…å­—ç¬¦ä¸²çš„ä½œç”¨ï¼Œä¸»è¦ç”¨æ¥æ˜¾ç¤ºå’Œæé†’ã€‚</p><ul><li>è¾“å‡ºä¸€æ®µä¿¡æ¯ å¦‚ï¼š<code>echo &quot;hello world&quot;</code> å…¶ä¸­<code>&quot;</code>ä¸æ˜¯å¿…é¡»çš„ </li><li>è¾“å‡ºä¸€æ®µå¸¦ç¯å¢ƒå˜é‡çš„ä¿¡æ¯ å¦‚ï¼š<code>echo &quot;My Path is $PATH&quot;</code> </li><li>è¾“å‡ºå¹¶ä¸å¸¦æ¢è¡Œç¬¦å· å¦‚ï¼š<code>echo  -n &quot;Hello World&quot;</code></li><li>è¾“å‡ºä¸€æ®µæ¿€æ´»è½¬ä¾å­—ç¬¦ å¦‚ï¼š <code>echo -e &quot;Column 1 \t Column 2&quot;</code></li></ul></li><li><p><code>date</code> </p><p><code>date</code> å‘½ä»¤ä¸»è¦ç”¨æ¥è®¾ç½®å’Œæ‰“å°ç³»ç»Ÿæ—¶é—´ã€‚</p><ul><li>è¾“å‡ºé»˜è®¤æ—¶åŒºæ ¼å¼çš„äº‹ä»¶ <code>date +&quot;%c&quot;</code></li><li>è¾“å‡ºå½“å‰äº‹ä»¶æŒ‰ç…§UTCå’Œisoæ ¼å¼è¾“å‡º <code>date -u +&quot;%Y-%m-%dT%H:%M:%SZ&quot;</code></li><li>è¾“å‡ºäº‹ä»¶æˆ³ <code>date +&quot;%s&quot;</code></li></ul></li><li><p><code>reboot</code> å‘½ä»¤ä¸»è¦ç”¨æ¥é‡å¯ç³»ç»Ÿ</p><ul><li>é‡å¯ç³»ç»Ÿ <code>reboot</code></li><li>å¼ºåˆ¶é‡å¯ <code>reboot -f</code></li></ul></li><li><p><code>poweroff</code> å‘½ä»¤ç”¨æˆ·å…³æœº</p></li><li><p><code>wget</code> å‘½ä»¤ ç”¨äºä»webä¸­ä¸‹è½½æ–‡ä»¶ï¼Œæ”¯æŒ <code>http</code>,<code>https</code>,<code>ftp</code></p><ul><li>è·å–URLä¸­çš„å†…å®¹åˆ°<code>foo</code>ä¸­ <code>wget https://example.com/foo</code></li><li>è·å–URLä¸­çš„å†…å®¹åˆ°barä¸­ <code>wget -O bar https://example.com/foo</code></li><li>ç»§ç»­æœªå®Œæˆçš„ä¸‹è½½ <code>wget -c https://example.com</code></li><li>åå°ä¸‹è½½ <code>wget -q https://example.com</code></li></ul></li><li><p><code>ps</code>å‘½ä»¤ä¸»è¦ç”¨äºæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„ä¿¡æ¯</p><ul><li>æ‰“å°å…¨éƒ¨æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ <code>ps aux</code></li><li>æ‰“å°å…¨éƒ¨æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹å¹¶ä¸”ä¼´æœ‰å®Œæ•´çš„å‘½ä»¤ä¸² <code>ps auxww</code></li><li>é€šè¿‡ <code>grep</code> ç®¡é“è¿‡æ»¤ <code>ps aux | grep &quot;tomcat&quot;</code></li><li>å¾—åˆ°è¿›ç¨‹çš„çˆ¶è¿›ç¨‹<code>pid</code> :<code>ps -o ppid= -p pid</code> </li></ul></li><li><p><code>top</code>å‘½ä»¤ ä¸»è¦ç”¨æˆ·åŠ¨æ€çš„å®æ—¶çš„æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„ç¨‹åº</p><ul><li><code>top -i</code> ä¸æ˜¾ç¤ºç©ºé—²æˆ–è€…æ˜¯åƒµå°¸è¿›ç¨‹</li><li><code>top -u $user</code> æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·çš„è¿›ç¨‹ </li><li><code>top -p PID</code> åªæ˜¾ç¤ºæŒ‡å®šè¿›ç¨‹PID</li><li><code>top -p $(pgrep -d &#39;,&#39; process_name)</code> é€šè¿‡è¿›ç¨‹åæ¥æŸ¥è¯¢</li></ul></li><li><p><code>pidof</code> å‘½ä»¤ä¸»è¦ç”¨äºæŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹çš„idå·</p><ul><li><code>pidof -s</code> è¿›è¿”å›ä¸€ä¸ªè¿›ç¨‹å·</li><li><code>pidof</code> -c ä»…æ˜¾ç¤ºå…·æœ‰ç›¸åŒrootç›®å½•ä¸‹çš„è¿›ç¨‹</li></ul></li></ol><h2 id="äºŒã€ç³»ç»ŸçŠ¶æ€"><a href="#äºŒã€ç³»ç»ŸçŠ¶æ€" class="headerlink" title="äºŒã€ç³»ç»ŸçŠ¶æ€"></a>äºŒã€ç³»ç»ŸçŠ¶æ€</h2><ol><li><code>ifconfig</code> å‘½ä»¤ä¸»è¦ç”¨äºç½‘ç»œæ¥å£çš„æŸ¥çœ‹å’Œé…ç½®</li></ol><ul><li><code>Ifconfig eth0</code> æŸ¥çœ‹etho0æ¥å£ç½‘ç»œè®¾ç½®</li><li><code>ifconfig -a</code> æŸ¥çœ‹æ‰€æœ‰æ¥å£çš„è¯¦ç»†ä¿¡æ¯</li><li><code>ifconfig eth0 down</code> å…³é—­æ¥å£eth0</li><li><code>ifconfig eth0 ipaddr</code> è®¾ç½®ç«¯å£ipåœ°å€</li></ul><ol start="2"><li><code>uname</code> æ‰“å°å‡ºç°å½“å‰æœºå™¨å’Œç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯</li></ol><ul><li><code>uname -n</code> æ‰“å°å½“å‰çš„<code>hostname</code></li><li><code>uname -a</code> æ‰“å°å½“å‰å¯ç”¨çš„ç³»ç»Ÿçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è½¯ä»¶ã€‚</li></ul><ol start="3"><li><code>who</code> æ‰“å°å“ªäº›ç”¨æˆ·ç™»å½•å†è¿™å°æœºå™¨ä¸Š</li></ol><ul><li><code>who</code> æ˜¾ç¤º<code>username</code>ç­‰æ¯”è¾ƒå…¨çš„ä¿¡æ¯</li><li><code>who am i</code> æ‰“å°å‡ºå½“å‰ç”¨æˆ· </li></ul><ol start="4"><li><code>last</code> ç”¨äºæŸ¥çœ‹å½“å‰ç”¨æˆ·æœ€è¿‘çš„ç™»å½•ä¿¡æ¯</li></ol><h2 id="ä¸‰ã€æ–‡ä»¶å’Œç›®å½•"><a href="#ä¸‰ã€æ–‡ä»¶å’Œç›®å½•" class="headerlink" title="ä¸‰ã€æ–‡ä»¶å’Œç›®å½•"></a>ä¸‰ã€æ–‡ä»¶å’Œç›®å½•</h2><ol><li><p><code>pwd</code> ç”¨äºæ‰“å°å½“å‰ç›®å½•</p></li><li><p><code>cd</code> ç”¨äºåˆ‡æ¢ç›®å½•</p></li><li><p><code>ls</code> ç”¨äºç½—åˆ—ç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹</p></li></ol><ul><li><code>ls -l</code>æŒ‰è¡Œç½—åˆ—æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</li><li><code>ls -a</code> æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—çš„æ–‡ä»¶ã€‚</li><li><code>ls -lh</code> æŒ‰ç…§å¤§å°æ’æ³„æ’åˆ—</li></ul><ol start="4"><li><code>touch</code> å‘½ä»¤ä¸»è¦ç”¨äºæ”¹å˜æ–‡ä»¶çš„è®¿é—®æ—¶é—´å’Œä¿®æ”¹æ—¶é—´ã€‚</li></ol><ul><li><code>touch filename</code> ä»¥å½“å‰æ—¶é—´åˆ›å»ºæ–‡ä»¶</li><li><code>touch -t yyyy-mm-dd filename</code> ä»¥æŸä¸€æ—¶é—´æ¥æ”¹å˜æ–‡ä»¶æ—¶é—´</li></ul><ol start="5"><li><code>mkdir</code> å‘½ä»¤ä¸»è¦ç”¨äºåˆ›å»ºæ–‡ä»¶</li></ol><ul><li><code>mkdir dir</code> åˆ›å»ºæ–‡ä»¶å¤¹</li><li><code>mkdir -p /path/dir</code> åˆ›å»ºæŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶</li></ul><ol start="6"><li><code>cp</code> å‘½ä»¤ä¸»è¦ç”¨äºæ–‡ä»¶çš„å¤åˆ¶</li></ol><ul><li><code>cp path/to/file.ext path/to/copy.ext</code> å¤åˆ¶æ–‡ä»¶åˆ°å¦ä¸€ä¸ªåœ°å€</li><li><code>cp path/to/file.ext path/to/target_parent_directory</code> å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šåœ°å€ï¼Œå¹¶ä¸”ä¿æŒæ–‡ä»¶åä¸å˜</li><li><code>cp -r path/to/directory path/to/copy</code> é€’å½’çš„å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶ä¸­çš„å†…å®¹åˆ°æŒ‡å®šç›®å½•</li><li><code>cp -i *.txt path/to/target_directory</code> ä»¥äº¤äº’çš„æ¨¡å¼å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸­</li></ul><ol start="7"><li><code>mv</code> å‘½ä»¤ä¸»è¦ç”¨äºç§»åŠ¨æ–‡ä»¶</li></ol><ul><li><code>mv source target</code> ç§»åŠ¨æ–‡ä»¶</li><li><code>mv -f</code> å¼ºåˆ¶ç§»åŠ¨ï¼Œè¦†ç›–ç°æœ‰æ–‡ä»¶æ—¶ä¸è¦æç¤º</li></ul><ol start="8"><li><code>rm</code>å‘½ä»¤ä¸»è¦ç”¨äºåˆ é™¤æ–‡ä»¶</li></ol><ul><li><code>rm path/to/file path/to/another/file</code> åˆ é™¤ç‰¹å®šæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶</li><li><code>rm -r path/to/directory</code> é€’å½’åˆ é™¤æ–‡ä»¶å¤¹åŠæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶</li><li><code>rm -rf</code> é€’å½’åˆ é™¤ï¼Œå¹¶ä¸”ä¸è¦æç¤ºä¿¡æ¯</li></ul><ol start="9"><li><code>dd</code> å‘½ä»¤ä¸»è¦ç”¨äºè½¬åŒ–å’Œå¤åˆ¶æ–‡ä»¶,åˆ¶ä½œusbé•œåƒ</li></ol><ul><li>Clone a drive to another drive with 4MB block and ignore error <code>dd if=/dev/source_drive of=/dev/dest_drive bs=4m conv=noerror</code></li></ul><ol start="10"><li><code>file</code>å‘½ä»¤ä¸»è¦ç”¨äºç¡®å®šæ–‡ä»¶ç±»å‹</li></ol><ul><li><code>file filename</code> è¾“å‡ºæ–‡ä»¶ç±»å‹</li><li><code>file -s filename</code> ç”¨äºç‰¹æ®Šçš„æ–‡ä»¶æˆ–è€…è®¾å¤‡æ–‡ä»¶ã€‚</li></ul><h2 id="å››ã€æ–‡æœ¬ç¼–è¾‘å‘½ä»¤"><a href="#å››ã€æ–‡æœ¬ç¼–è¾‘å‘½ä»¤" class="headerlink" title="å››ã€æ–‡æœ¬ç¼–è¾‘å‘½ä»¤"></a>å››ã€æ–‡æœ¬ç¼–è¾‘å‘½ä»¤</h2><ol><li><code>cat</code> æ‰“å°å’Œä¸²è”æ–‡ä»¶</li></ol><ul><li><code>cat file</code> æ‰“å°æ–‡ä»¶å†…å®¹åˆ°æ ‡å‡†è¾“å‡º</li><li><code>cat file1 file2  &gt; targetFile</code> å°†å¤šä¸ªæ–‡ä»¶å†…å®¹ä¸²è”åˆ°ç›®æ ‡æ–‡ä»¶ä¸­</li><li><code>cat -n file</code> æ‰“å°å‡ºè¡Œæ•°åˆ°æ ‡å‡†è¾“å‡º</li></ul><ol start="2"><li><code>more</code> ç”¨äºäº’åŠ¨çš„é˜…è¯»æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥ä¸Šä¸‹æ»šåŠ¨</li></ol><ul><li><code>more file</code> æ‰“å¼€æ–‡ä»¶ï¼Œ<code>&lt;space&gt;</code>ç”¨äºç§»åŠ¨åˆ°ä¸‹ä¸€é¡µï¼Œ<code>/</code>ç”¨äºæœç´¢æ–‡ä»¶å†…å®¹ï¼Œ <code>q</code>ç”¨äºé€€å‡ºå½“å‰ç•Œé¢</li></ul><ol start="3"><li><code>head</code> è¾“å‡ºæ–‡ä»¶å¼€å§‹çš„éƒ¨åˆ†</li></ol><ul><li><code>head -n count_of_line filename</code> æŸ¥çœ‹æ–‡ä»¶çš„å‰nè¡Œ</li><li><code>head -c number_of_byte filename</code> æŸ¥çœ‹æ–‡ä»¶çš„å‰nä¸ªå­—èŠ‚</li></ul><ol start="4"><li><code>tail</code> è¾“å‡ºæ–‡ä»¶æœ€åçš„éƒ¨åˆ†</li></ol><ul><li><code>tail -n num file</code>æ‰“å°å‡ºæ–‡ä»¶æœ€ånumè¡Œ </li><li><code>tail -n +num file</code> æ‰“å°å‡ºæ–‡ä»¶ä»numå¼€å§‹çš„å‡ è¡Œ</li><li><code>tail -f file</code> ä¿æŒé˜…è¯»çŠ¶æ€ç›´åˆ° <code>Ctrl + c</code></li></ul><ol start="5"><li><code>wc</code>å‘½ä»¤ç”¨äºç»Ÿè®¡æ–‡ä»¶çš„å•è¯ï¼Œå­—èŠ‚ï¼Œè¡Œæ•° </li></ol><ul><li><code>wc -l filename</code> ç»Ÿè®¡æ–‡ä»¶çš„è¡Œæ•°</li><li><code>wc -w filename</code> ç»Ÿè®¡æ–‡ä»¶çš„å­—æ•°</li><li><code>wc -c filename</code> ç»Ÿè®¡æ–‡ä»¶çš„å­—èŠ‚æ•°</li></ul><ol start="6"><li><code>æ˜¾ç¤ºæ–‡ä»¶çš„çŠ¶æ€</code> </li></ol><ul><li><code>stat filename</code> æ˜¾ç¤ºæ–‡ä»¶çš„å±æ€§æ¯”å¦‚å¤§å°ï¼Œæƒé™ç­‰ã€‚</li><li><code>stat -x filename</code>æ ¼å¼åŒ–æ˜¾ç¤ºæ–‡ä»¶çš„è¯¦ç»†å±æ€§ä¿¡æ¯ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootè¿‡ç¨‹é—®é¢˜</title>
      <link href="/2019/01/04/2019-01-25-%E8%BF%87%E7%A8%8B%E9%97%AE%E9%A2%98/"/>
      <url>/2019/01/04/2019-01-25-%E8%BF%87%E7%A8%8B%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootè¿‡ç¨‹é—®é¢˜"><a href="#SpringBootè¿‡ç¨‹é—®é¢˜" class="headerlink" title="SpringBootè¿‡ç¨‹é—®é¢˜"></a>SpringBootè¿‡ç¨‹é—®é¢˜</h1><h2 id="springæ³¨è§£ç›¸å…³"><a href="#springæ³¨è§£ç›¸å…³" class="headerlink" title="springæ³¨è§£ç›¸å…³"></a>springæ³¨è§£ç›¸å…³</h2><h3 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a><code>@RestController</code></h3><p>â€‹    <code>@RestController</code> æ˜¯<code>spring 4.0</code>æ¥å¼•å…¥çš„ç®€åŒ–çš„<code>RESTful WEB</code>åº”ç”¨çš„åˆ›å»ºï¼Œæ˜¯ä¸€ä¸ªç»“åˆ<code>@Constroller</code>å’Œ<code>@ResponseBody</code>çš„æ³¨è§£ï¼Œä¸ç”¨æ¯ä¸ªç±»éƒ½ä½¿ç”¨<code>ResponseBody</code>æ³¨è§£æ¥è¾¾åˆ°å¤„ç†è¯·æ±‚çš„ç›®çš„ã€‚</p><p>â€‹    æ§åˆ¶å™¨ä½¿ç”¨<code>@RestController</code>æ³¨é‡Šè¿›è¡Œæ³¨é‡Šï¼Œå› æ­¤ä¸éœ€è¦<code>@ResponseBody</code>ã€‚</p><h3 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a><code>@RequestMapping</code></h3><p><code>@RequestMapping</code>çš„æ³¨è§£ä¸­çš„å‚æ•°ï¼š</p><p>name ï¼š åœ¨4.0åå¼•å…¥çš„ï¼Œå¼€å§‹æˆ‘é”™æŠŠnameå½“valueç”¨ï¼Œç»“æœå‡ºç° <code>[java.lang.IllegalStateException: Ambiguous mapping found. Cannot map &#39;appController&#39; bean method]</code> ç±»ä¼¼è¿™ç§é”™è¯¯ã€‚å…¶å®nameå°±æ˜¯ä¸€ä¸ªåå­—è€Œå·²,æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šå«ä¹‰ï¼Œä½†æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­æŒ‡å‡º <code>åœ¨ç±»å‹çº§åˆ«å’Œæ–¹æ³•çº§åˆ«æ”¯æŒï¼åœ¨ä¸¤ä¸ªçº§åˆ«ä¸Šä½¿ç”¨æ—¶ï¼Œç»„åˆåç§°é€šè¿‡ä¸²è”ä»¥â€œï¼ƒâ€ä½œä¸ºåˆ†éš”ç¬¦æ´¾ç”Ÿ</code> ã€‚ä½¿ç”¨ä¸Šï¼Œå®˜æ–¹è¯´æ˜æ˜¯ä¸»è¦å¯ä»¥é€šè¿‡ä½¿ç”¨Spring jsp tagåŒ…é‡Œé¢çš„mvcUrlï¼Œæ¥ç”Ÿæˆjspåˆ°controllerçš„é“¾æ¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;/people&quot;)</span><br><span class="line"> class PersonController &#123;</span><br><span class="line"></span><br><span class="line">   @RequestMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">   public HttpEntity getPerson(@PathVariable String id) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=&quot;http://www.springframework.org/tags&quot; prefix=&quot;s&quot; %&gt;</span><br><span class="line"></span><br><span class="line"> &lt;a href=&quot;$&#123;s:mvcUrl(&apos;PC#getPerson&apos;).arg(0,&quot;123&quot;).build()&#125;&quot;&gt;Get Person&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>value:ç”¨æ¥è¡¨ç¤ºä¸»è¦æ˜ å°„,æ˜¯å¸¸ç”¨çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.GET,produces = &quot;application/json&quot;)</span><br><span class="line">    public @ResponseBody</span><br><span class="line">    List&lt;User&gt; findUsers() &#123;</span><br><span class="line">        return userService.findUsers();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>path: æŒ‡å®šè®¿é—®çš„uriåœ°å€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(path = &quot;/user&quot;,method = RequestMethod.POST,name = &quot;this is user`s post methods&quot;)</span><br><span class="line">    public String insertUser()&#123;</span><br><span class="line">        userService.saveUser();</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>method:æ˜ å°„çš„HTTPçš„è®¿é—®æ–¹æ³•ï¼Œæœ‰GET, POST, HEAD, OPTIONS, PUT, PATCH, DELETE, TRACE</p><p>consumesï¼š æŒ‡å®š<strong>å¤„ç†è¯·æ±‚çš„æäº¤å†…å®¹ç±»å‹ï¼ˆContent-Typeï¼‰</strong>ï¼Œä¾‹å¦‚application/json, text/html;</p><p>produces: æŒ‡å®š<strong>è¿”å›çš„å†…å®¹ç±»å‹</strong>ï¼Œä»…å½“requestè¯·æ±‚å¤´ä¸­çš„(Accept)ç±»å‹ä¸­åŒ…å«è¯¥æŒ‡å®šç±»å‹æ‰è¿”å›ï¼›</p><p>paramsï¼š æŒ‡å®šrequestä¸­å¿…é¡»åŒ…å«æŸäº›å‚æ•°å€¼æ—¶ï¼Œæ‰è®©è¯¥æ–¹æ³•å¤„ç†ã€‚</p><p>headersï¼š æŒ‡å®šrequestä¸­å¿…é¡»åŒ…å«æŸäº›æŒ‡å®šçš„headerå€¼ï¼Œæ‰èƒ½è®©è¯¥æ–¹æ³•å¤„ç†è¯·æ±‚ã€‚</p><h3 id="Jpaå¸¸ç”¨æ³¨è§£"><a href="#Jpaå¸¸ç”¨æ³¨è§£" class="headerlink" title="Jpaå¸¸ç”¨æ³¨è§£"></a><code>Jpa</code>å¸¸ç”¨æ³¨è§£</h3><h4 id="Entity"><a href="#Entity" class="headerlink" title="@Entity"></a>@Entity</h4><p>æ ‡æ³¨åœ¨ç±»å¤–ä¾§ï¼Œæ ‡æ³¨ç€è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªå®ä½“ç±»ã€‚</p><h4 id="Table"><a href="#Table" class="headerlink" title="@Table"></a><code>@Table</code></h4><p>â€‹    æ ‡æ³¨åœ¨ç±»å¤–ä¾§ï¼Œæ ‡æ³¨å®ä½“çš„ä¸»è¡¨ï¼Œå…¶ä¸­æœ‰ <code>catalog</code>,<code>indexes</code>, <code>name</code>, <code>schema</code>ï¼Œåˆ†åˆ«æ³¨æ˜ä¸ºï¼šæŒ‡å®šdatabaseçš„ç›®å½•ï¼Œç´¢å¼•ï¼Œåç§°ï¼Œå’Œè¡¨çš„ç»“æ„æè¿° </p><p>â€‹    æ³¨æ„ï¼šschemaå®šä¹‰äº†è¡¨ã€æ¯ä¸ªè¡¨çš„å­—æ®µï¼Œè¿˜æœ‰è¡¨å’Œå­—æ®µä¹‹é—´çš„å…³ç³»ã€‚ </p><h4 id="Id"><a href="#Id" class="headerlink" title="@Id"></a>@Id</h4><p>è¡¨ç¤ºæ˜¯å®ä½“ç±»çš„ä¸»é”®</p><h4 id="GeneratedValue"><a href="#GeneratedValue" class="headerlink" title="@GeneratedValue"></a>@GeneratedValue</h4><p>â€‹    æä¾›ä¸»é”®çš„å€¼å¾—ç”Ÿæˆç­–ç•¥è§„èŒƒã€‚GeneratedValueæ³¨é‡Šå¯ä»¥ä¸Idæ³¨é‡Šä¸€èµ·åº”ç”¨äºå®ä½“æˆ–æ˜ å°„è¶…ç±»çš„ä¸»é”®å±æ€§æˆ–å­—æ®µï¼Œæ´¾ç”Ÿä¸»é”®ä¸æ”¯æŒè¯¥æ³¨è§£ã€‚æä¾›ä¸¤ä¸ªå¯é€‰å€¼ï¼š1. <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/GeneratedValue.html#generator--" target="_blank" rel="noopener">generator</a> ï¼šè¦åœ¨SequenceGeneratoræˆ–TableGeneratoræ³¨è§£ä¸­æŒ‡å®šçš„ä¸»é”®ç”Ÿæˆå™¨çš„åç§°ã€‚2. <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/GeneratedValue.html#strategy--" target="_blank" rel="noopener">strategy</a> ç”Ÿæˆç­–ç•¥ï¼Œæœ‰å››ä¸ªå¯é€‰å€¼AUTO,INDENTITY,SEQUENCE å’Œ TABLE ï¼Œé»˜è®¤ä¸ºAUTO</p><h4 id="Column"><a href="#Column" class="headerlink" title="@Column"></a>@Column</h4><p>æŒ‡å®šæŒä¹…å±æ€§æˆ–å­—æ®µçš„æ˜ å°„åˆ—ã€‚å¦‚æœæœªæŒ‡å®šColumnæ³¨é‡Šï¼Œåˆ™åº”ç”¨é»˜è®¤å€¼ã€‚</p><p><a href="https://docs.oracle.com/javaee/7/api/javax/persistence/Column.html#updatable--" target="_blank" rel="noopener">updatable</a>ï¼šæ˜¯å¦åŒ…å«åœ¨æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆçš„updateè¯­å¥ä¸­ã€‚</p><p>å…¶ä»–å¯ä»¥é€šè¿‡ä¾‹å­ä¸€çœ‹ä¾¿çŸ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Column(name=&quot;description&quot;, nullable=false, length=512)</span><br><span class="line">public String getDescription() &#123; return description; &#125;</span><br></pre></td></tr></table></figure><h4 id="Transient"><a href="#Transient" class="headerlink" title="@Transient"></a>@Transient</h4><p><code>@Transient</code>è¡¨ç¤ºè¯¥å±æ€§å¹¶éä¸€ä¸ªåˆ°æ•°æ®åº“è¡¨çš„å­—æ®µçš„æ˜ å°„,<code>ORM</code>æ¡†æ¶å°†å¿½ç•¥è¯¥å±æ€§.<br>å¦‚æœä¸€ä¸ªå±æ€§å¹¶éæ•°æ®åº“è¡¨çš„å­—æ®µæ˜ å°„,å°±<strong>åŠ¡å¿…</strong>å°†å…¶æ ‡ç¤ºä¸º<code>@Transient</code>,å¦åˆ™,<code>ORM</code>æ¡†æ¶é»˜è®¤å…¶æ³¨è§£ä¸º<code>@Basic</code>.</p><h4 id="ManyToOne"><a href="#ManyToOne" class="headerlink" title="@ManyToOne"></a>@ManyToOne</h4><p>è¡¨ç¤ºä¸€ä¸ªå¤šå¯¹ä¸€çš„æ˜ å°„,è¯¥æ³¨è§£æ ‡æ³¨çš„å±æ€§é€šå¸¸æ˜¯æ•°æ®åº“è¡¨çš„å¤–é”®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//è®¢å•Orderå’Œç”¨æˆ·Useræ˜¯ä¸€ä¸ªManyToOneçš„å…³ç³»</span><br><span class="line">//åœ¨Orderç±»ä¸­å®šä¹‰</span><br><span class="line">@ManyToOne()</span><br><span class="line">@JoinColumn(name=â€USERâ€)</span><br><span class="line">public User getUser() &#123;</span><br><span class="line">    return user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JoinColumn"><a href="#JoinColumn" class="headerlink" title="@JoinColumn"></a>@JoinColumn</h4><p>â€‹    æŒ‡å®šç”¨äºè¿æ¥å®ä½“å…³è”æˆ–å…ƒç´ é›†åˆçš„åˆ—ã€‚å¦‚æœJoinColumnæ³¨è§£æœ¬èº«æ˜¯é»˜è®¤çš„ï¼Œåˆ™å‡å®šä½¿ç”¨å•ä¸ªè¿æ¥åˆ—å¹¶åº”ç”¨é»˜è®¤å€¼ã€‚å…¶é»˜è®¤çš„åç§°ä¸ºå®ä½“Userçš„åç§°+ä¸‹åˆ’çº¿+å®ä½“Userçš„ä¸»é”®åç§°ã€‚ä¹Ÿå°±æ˜¯USER_ID.</p><h4 id="OneToMany"><a href="#OneToMany" class="headerlink" title="@OneToMany"></a>@OneToMany</h4><p>@OneToManyæè¿°ä¸€ä¸ªä¸€å¯¹å¤šçš„å…³è”,è¯¥å±æ€§åº”è¯¥ä¸ºé›†ä½“ç±»å‹,åœ¨æ•°æ®åº“ä¸­å¹¶æ²¡æœ‰å®é™…å­—æ®µ.ä¾‹å¦‚:å®ä½“Userå’ŒOrderæ˜¯OneToManyçš„å…³ç³»,åˆ™å®ä½“Userè¢«åˆ é™¤æ—¶,å…¶å…³è”çš„å®ä½“Orderä¹Ÿåº”è¯¥è¢«å…¨éƒ¨åˆ é™¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@OneTyMany(cascade=ALL)</span><br><span class="line">public List getOrders() &#123;</span><br><span class="line">    return orders;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OneToOne"><a href="#OneToOne" class="headerlink" title="@OneToOne"></a>@OneToOne</h4><p>æè¿°ä¸€å¯¹ä¸€çš„å…³ç³»</p><p>å¦‚Userè¡¨å’Œpersonè¡¨ï¼Œä¸€ä¸ªæ˜¯åŸºæœ¬ä¿¡æ¯ä¸€ä¸ªæ˜¯è¯¦ç»†ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@OneToOne(fetch=FetchType.LAZY) // Fetchæ˜¯æŠ“å–ç­–ç•¥ï¼Œå¦‚æœä¸å†™ï¼Œè‡ªåŠ¨çš„ç­–ç•¥æ˜¯LAZY</span><br><span class="line">public Person getPerson() &#123;</span><br><span class="line">    return person;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ManyToMany"><a href="#ManyToMany" class="headerlink" title="@ManyToMany"></a>@ManyToMany</h4><p>@ManyToMany æè¿°ä¸€ä¸ªå¤šå¯¹å¤šçš„å…³è”.å¤šå¯¹å¤šå…³è”ä¸Šæ˜¯ä¸¤ä¸ªä¸€å¯¹å¤šå…³è”,ä½†æ˜¯åœ¨ManyToManyæè¿°ä¸­,ä¸­é—´è¡¨æ˜¯ç”±ORMæ¡†æ¶è‡ªåŠ¨å¤„ç†</p><h4 id="Embedded"><a href="#Embedded" class="headerlink" title="@Embedded"></a>@Embedded</h4><p>@Embeddedå°†å‡ ä¸ªå­—æ®µç»„åˆæˆä¸€ä¸ªç±»,å¹¶ä½œä¸ºæ•´ä¸ªEntityçš„ä¸€ä¸ªå±æ€§.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Embeddable</span><br><span class="line">public class Address &#123;city,street,zip&#125;</span><br><span class="line">    @Entity</span><br><span class="line">public class User &#123;</span><br><span class="line">    @Embedded</span><br><span class="line">    public Address getAddress() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>æ³¨è§£</th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>@Null</td><td>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º null</td></tr><tr><td>@NotNull</td><td>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º null</td></tr><tr><td>@AssertTrue</td><td>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º true</td></tr><tr><td>@Min(value)</td><td>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼,åŒç†@Max(value)</td></tr><tr><td>@DecimalMin(value)</td><td>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ï¼ŒåŒç†@DecimalMax(value)</td></tr><tr><td>@Size(max=, min=)</td><td>è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</td></tr><tr><td>@Past</td><td>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸï¼ŒåŒç†@Future</td></tr><tr><td>@Pattern(regex=,flag=)</td><td>ç¬¦åˆæ­£åˆ™</td></tr><tr><td>Hibernate Validator é™„åŠ çš„ constraint</td><td></td></tr><tr><td>@NotBlank(message =)</td><td>éªŒè¯å­—ç¬¦ä¸²énullï¼Œä¸”é•¿åº¦å¿…é¡»å¤§äº0ï¼Œmessageè¡¨ç¤ºæç¤ºä¿¡æ¯</td></tr><tr><td>@Email</td><td>é‚®ç®±éªŒè¯</td></tr><tr><td>@Range(min=,max=,message=)</td><td>è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†…</td></tr><tr><td></td><td></td></tr></tbody></table><h2 id="spring-boot-é…ç½®é—®é¢˜"><a href="#spring-boot-é…ç½®é—®é¢˜" class="headerlink" title="spring boot é…ç½®é—®é¢˜"></a>spring boot é…ç½®é—®é¢˜</h2><h3 id="spring2-0åé™æ€èµ„æºè®¿é—®ä¸åˆ°çš„é—®é¢˜"><a href="#spring2-0åé™æ€èµ„æºè®¿é—®ä¸åˆ°çš„é—®é¢˜" class="headerlink" title="spring2.0åé™æ€èµ„æºè®¿é—®ä¸åˆ°çš„é—®é¢˜"></a>spring2.0åé™æ€èµ„æºè®¿é—®ä¸åˆ°çš„é—®é¢˜</h3><p>éœ€è¦æ‰‹åŠ¨å†™é…ç½®ç±»è¿›è¡Œé™æ€èµ„æºé…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class WebMvcConfig implements WebMvcConfigurer &#123;</span><br><span class="line">    /**</span><br><span class="line">     * æ·»åŠ é™æ€èµ„æºæ–‡ä»¶ï¼Œå¤–éƒ¨å¯ä»¥ç›´æ¥è®¿é—®åœ°å€</span><br><span class="line">     * @param registry</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span><br><span class="line">        registry.addResourceHandler(&quot;/static/**&quot;).addResourceLocations(&quot;classpath:/static/&quot;);</span><br><span class="line">        registry.addResourceHandler(&quot;/templates/**&quot;).addResourceLocations(&quot;classpath:/templates/&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®SpringBoot-Jpaé»˜è®¤mysqlç”Ÿæˆè¡¨å¼•æ“ä¸ºInnoDB"><a href="#é…ç½®SpringBoot-Jpaé»˜è®¤mysqlç”Ÿæˆè¡¨å¼•æ“ä¸ºInnoDB" class="headerlink" title="é…ç½®SpringBoot Jpaé»˜è®¤mysqlç”Ÿæˆè¡¨å¼•æ“ä¸ºInnoDB"></a>é…ç½®<code>SpringBoot Jpa</code>é»˜è®¤<code>mysql</code>ç”Ÿæˆè¡¨å¼•æ“ä¸º<code>InnoDB</code></h3><p>åœ¨é…ç½®æ–‡ä»¶<code>appliction.properties</code>ä¸­åŠ å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu18.04 é…ç½®å…¨è¿‡ç¨‹</title>
      <link href="/2019/01/04/2019-01-04-Ubuntu%E9%85%8D%E7%BD%AE%E5%85%A8%E8%BF%87%E7%A8%8B%202/"/>
      <url>/2019/01/04/2019-01-04-Ubuntu%E9%85%8D%E7%BD%AE%E5%85%A8%E8%BF%87%E7%A8%8B%202/</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu18-04-é…ç½®å…¨è¿‡ç¨‹"><a href="#Ubuntu18-04-é…ç½®å…¨è¿‡ç¨‹" class="headerlink" title="Ubuntu18.04 é…ç½®å…¨è¿‡ç¨‹"></a>Ubuntu18.04 é…ç½®å…¨è¿‡ç¨‹</h1><p>å› ä¸ºæœ€è¿‘åœ¨å¼„win10åŒç³»ç»Ÿï¼Œåˆå› ä¸ºPopOsåœ¨è£…æœºçš„æ—¶å€™è®¾ç½®grubæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æ¢æˆæœ€æ–°çš„Ubuntuç¨³å®šç‰ˆæ¥åšæˆwin/ubunutåŒç³»ç»Ÿã€‚</p><h2 id="å®‰è£…é—®é¢˜"><a href="#å®‰è£…é—®é¢˜" class="headerlink" title="å®‰è£…é—®é¢˜"></a>å®‰è£…é—®é¢˜</h2><p>åœ¨è£…æœºçš„éœ€è¦ä½¿ç”¨grubåšå¯åŠ¨å¼•å¯¼ã€‚æ‰€ä»¥è®¾ç½®ä¿ç•™BIOSå¯åŠ¨åŒºåŸŸè€Œä¸æ˜¯æŒ‚è½½/bootã€‚äº²èº«ç»å†ï¼ŒUEFIå¯åŠ¨æ¨¡å¼ä¸‹ï¼ŒUbuntuçš„å¼•å¯¼æŒ‚è½½åº”è¯¥æ˜¯biosgrubï¼Œå¦åˆ™å‡ºé”™ã€‚å¯¼è‡´æ— æ³•å®¶åœ¨grubã€‚</p><h2 id="ç•Œé¢é…ç½®"><a href="#ç•Œé¢é…ç½®" class="headerlink" title="ç•Œé¢é…ç½®"></a>ç•Œé¢é…ç½®</h2><h3 id="å®‰è£…gnome-tweak-tool"><a href="#å®‰è£…gnome-tweak-tool" class="headerlink" title="å®‰è£…gnome-tweak-tool"></a>å®‰è£…gnome-tweak-tool</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gnome-tweak-tool</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦æ›´æ”¹shellåˆ™éœ€è¦å®‰è£…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gnome-shell-extensions</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½è½»æ¾æ„‰å¿«çš„ä½¿ç”¨gnome-tewak-tooläº†ã€‚</p><h3 id="ä¸»é¢˜æ–¹æ¡ˆ"><a href="#ä¸»é¢˜æ–¹æ¡ˆ" class="headerlink" title="ä¸»é¢˜æ–¹æ¡ˆ"></a>ä¸»é¢˜æ–¹æ¡ˆ</h3><h4 id="ä¸»ç•Œé¢"><a href="#ä¸»ç•Œé¢" class="headerlink" title="ä¸»ç•Œé¢"></a>ä¸»ç•Œé¢</h4><p>å› ä¸ºå‰ä¸€é˜µä½¿ç”¨Pop!_OSå‘ç°å®ƒé»˜è®¤çš„ä¸»é¢˜éå¸¸å¥½çœ‹ï¼Œæ‰€ä»¥ä¸‹è½½Poposé»˜è®¤çš„ä¸»é¢˜ï¼Œç„¶ååœ¨gnome-tweak-toolä¸­è®¾ç½®å¥½å°±okäº†ï¼Œ<a href="https://github.com/pop-os/gtk-theme" target="_blank" rel="noopener">è¿™é‡Œæ˜¯PopOsçš„gtkä¸»é¢˜åœ°å€</a>ã€‚ä½†æ˜¯å‘ç°PopOsé»˜è®¤çš„è¾“å…¥æ³•è¾“å…¥æ¡†æ˜¯é»˜è®¤ç±³é»„è‰²çš„ï¼Œæ‰“å­—çš„æ—¶å€™ä¸å¤ªæ˜¾çœ¼ï¼Œæ‰€ä»¥åœ¨åŸºç¡€ä¸Šæ·»åŠ äº†å¦‚ä¸‹ä»£ç ã€‚æ·»åŠ æ–¹æ³•ï¼š</p><ol><li>æ ¹æ®è¯´æ˜ä¸‹è½½Pop-theme</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:system76/pop</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install pop-theme</span><br></pre></td></tr></table></figure><ol start="2"><li>å®šä½åˆ° <code>/usr/share/themes/Pop/gnome-shell/</code> çš„gnome-shell.csså’ŒPop.css å°†IBusçš„ç•Œé¢ä»£ç æ›¿æ¢æˆå¦‚ä¸‹ä»£ç </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">.candidate-popup-content &#123;</span><br><span class="line">  padding: 8px;</span><br><span class="line">  spacing: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-index &#123;</span><br><span class="line">  padding: 0 4px 0 0;</span><br><span class="line">  color: rgba(255, 255, 255, 0.5);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-box:selected .candidate-index &#123;</span><br><span class="line">  color: rgba(255, 255, 255, 0.5);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-box &#123;</span><br><span class="line">  transition-duration: 0ms;</span><br><span class="line">  min-height: 28px;</span><br><span class="line">  padding: 0 8px;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-box:hover &#123;</span><br><span class="line">  background-color: rgba(255, 255, 255, 0.06);</span><br><span class="line">  color: rgba(255, 255, 255, 0.9);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-box:active &#123;</span><br><span class="line">background-color: rgba(255, 255, 255, 0.1);</span><br><span class="line">  color: rgba(255, 255, 255, 0.9);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-box:selected &#123;</span><br><span class="line">  background-color: #0046DB;</span><br><span class="line">  color: rgba(255, 255, 255, 0.85);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-page-button-box &#123;</span><br><span class="line">  height: 28px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.vertical .candidate-page-button-box &#123;</span><br><span class="line">  padding-top: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.horizontal .candidate-page-button-box &#123;</span><br><span class="line">  padding-left: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-page-button &#123;</span><br><span class="line">  min-width: 28px;</span><br><span class="line">  min-height: 28px;</span><br><span class="line">  padding: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-page-button-previous &#123;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">  border-right-width: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-page-button-next &#123;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-page-button-icon &#123;</span><br><span class="line">  icon-size: 1.23077em;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæˆå“ï¼š</p><p><img src="https://wx4.sinaimg.cn/large/006tNc79gy1g2dt15yse2j318u0miagk.jpg" alt="è¾“å…¥æ³•"></p><ol start="3"><li>åº”ç”¨ç¨‹åºçª—å£ç”¨çš„æ˜¯ macOS High Sierra  ä¸»é¢˜ï¼Œä»¿ç…§MACçš„çª—å£ã€‚æ¯”è¾ƒæ¼‚äº®ã€‚<a href="https://www.gnome-look.org/p/1013714/" target="_blank" rel="noopener">macOS High Sierra ä¸»é¢˜</a>ï¼Œä¸‹è½½ä¸‹æ¥åè§£å‹åæ”¾åˆ° <code>/usr/share/themes</code> ä¸‹ï¼Œä¹‹åå°±èƒ½åœ¨gnome-tweak-toolä¸­çœ‹åˆ°äº†ï¼Œè®¾ç½®å®Œæˆåå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæœã€‚</li></ol><p><img src="https://wx4.sinaimg.cn/large/006tNc79gy1g2dt17ye4jj31900u01dj.jpg" alt="ä¸»é¢˜"></p><h4 id="gdmä¸»é¢˜"><a href="#gdmä¸»é¢˜" class="headerlink" title="gdmä¸»é¢˜"></a>gdmä¸»é¢˜</h4><p>gdmä¸»é¢˜é€‰ç”¨ç±»ä¼¼MACç™»é™†çš„ä¸»é¢˜ï¼Œç•Œé¢ç¾è§‚ï¼Œè€Œä¸”è¿˜æœ‰æ¯›ç»ç’ƒæ•ˆæœã€‚<a href="https://www.gnome-look.org/p/1207015/" target="_blank" rel="noopener">High Ubunterra</a>ä¸‹è½½åè§£å‹ä¹‹åï¼Œç›´æ¥å‘½ä»¤è¡Œæ‰§è¡Œ./install.shã€‚ä¹‹åç›´æ¥å³é”®è®¾ç½®åï¼Œç›´æ¥å°†é”å±ç•Œé¢ç›´æ¥è®¾ç½®å¥½ã€‚å…¶å®ä¸»è¦ç›®çš„çš„å°±æ˜¯å°† <code>/usr/share/gnome-shell/theme</code> ä¸­çš„ubuntu.cssæ›¿æ¢æ‰ã€‚</p><h4 id="grubä¸»é¢˜"><a href="#grubä¸»é¢˜" class="headerlink" title="grubä¸»é¢˜"></a>grubä¸»é¢˜</h4><p>grubçš„ä¸»é¢˜æ¯”è¾ƒå°‘ï¼Œæ¨èçš„å°±æ˜¯<a href="https://www.gnome-look.org/p/1000140/" target="_blank" rel="noopener">Breeze GRUB2 theme</a> æ˜¯ä¸€æ¬¾æ¯”è¾ƒæ¼‚äº®ç¾è§‚çš„ä¸»é¢˜ã€‚å…·ä½“æˆæœç•Œé¢å¯ä»¥ç‚¹å‡»é“¾æ¥åœ°å€æŸ¥çœ‹ã€‚</p><p>æ™®é€šä¸»é¢˜éœ€è¦ä½œå¦‚ä¸‹é¡ºåºçš„æ“ä½œï¼Œä½†æ˜¯ Breeze Grub2 theme æœ‰è„šæœ¬ï¼Œç›´æ¥æ‰§è¡Œè§£å‹åçš„è„šæœ¬ç¨‹åºï¼Œå°±okäº†ã€‚</p><ol><li>åˆ›å»ºgrubçš„ä¸»é¢˜æ–‡ä»¶å¤¹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /boot/grub/themes</span><br></pre></td></tr></table></figure><ol start="2"><li>å°†ä¸»é¢˜åŒ…ç§»åŠ¨åˆ°è¿™ä¸ªç›®å½•ä¸‹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp ä¸»é¢˜åŒ…å /boot/grub/themes/</span><br></pre></td></tr></table></figure><ol start="3"><li>ä¿®æ”¹ä¸»é¢˜çš„é…ç½®æ–‡ä»¶</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/grub.d/00_header</span><br></pre></td></tr></table></figure><ol start="4"><li>åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRUB_THEME=&quot;/boot/grub/themes/ä¸»é¢˜åŒ…å/theme.txt&quot;</span><br><span class="line">GRUB_GFXMODE=&quot;1920x1080x32&quot;</span><br></pre></td></tr></table></figure><ol start="5"><li>æœ€åæ‰§è¡Œ update-grub å‘½ä»¤</li></ol><h3 id="gnomeæ‹“å±•æ¨è"><a href="#gnomeæ‹“å±•æ¨è" class="headerlink" title="gnomeæ‹“å±•æ¨è"></a>gnomeæ‹“å±•æ¨è</h3><p>æˆ‘æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æ‹“å±•å®‰è£…ï¼Œåœ¨Ubuntuç³»ç»Ÿä¸‹ï¼Œä¸€èˆ¬å®‰è£…å¦‚ä¸‹æ‹“å±•ã€‚</p><ol><li><p>User themes å¯ä»¥ä½¿ç”¨ç”¨æˆ·ç›®å½•ä¸‹çš„ä¸»é¢˜</p></li><li><p>removeable Drive Menu å½“æ’å…¥ç§»é™¤è®¾å¤‡çš„æ—¶å€™åœ¨ä¸Šæ–¹æœ‰çŠ¶æ€å›¾æ ‡æé†’ã€‚</p></li><li><p>Caffeine å¯ä»¥å…³é—­å±ä¿å’Œè‡ªåŠ¨æŒ‚èµ·ï¼Œå¾ˆå¥½ç”¨ã€‚</p></li><li><p>Dash To Dock å¦‚æœä½ ä¸å–œæ¬¢ubuntuçš„ä¾§è¾¹dockå¯ä»¥å°è¯•è¿™ä¸ªdockï¼Œæ¯”è¾ƒç¾è§‚çš„dockï¼Œå¯ä»¥è®¾ç½®åœ¨ä¾§è¾¹æˆ–è€…åœ¨åº•ä¸‹ã€‚</p></li><li><p>openWeather å¯ä»¥åœ¨é¡¶éƒ¨æ ä¸­æŸ¥çœ‹å¤©æ°”ï¼Œç‚¹å‡»å¯ä»¥æŸ¥çœ‹æœ€è¿‘å¤©æ°”ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ åœ°å€ã€‚</p></li><li><p>ClipBord Indicator æ˜¯å¯ä»¥è®°å½•ç²˜è´´æ¿çš„å†…å®¹ï¼Œæœ‰æ—¶å¯ä»¥é¿å…é‡å¤å¤åˆ¶çš„æ“ä½œã€‚</p></li></ol><p>æ¨èçš„æœ‰è¿™å‡ ä¸ªï¼Œä½†æ˜¯gnome-shellæ‹“å±•å¯è°“éå¸¸çš„å¤šï¼Œå¹¶ä¸”å¤§å¤šæ•°éƒ½éå¸¸å¥½ç”¨ï¼Œå¯ä»¥å» <a href="https://extensions.gnome.org/" target="_blank" rel="noopener">gnome extensions å®˜ç½‘</a> çœ‹ä¸€çœ‹ï¼Œçœ‹æœ‰æ²¡æœ‰æ›´é€‚åˆè‡ªå·±çš„ã€‚</p><h3 id="é…ç½®Vimå’Œç»ˆç«¯"><a href="#é…ç½®Vimå’Œç»ˆç«¯" class="headerlink" title="é…ç½®Vimå’Œç»ˆç«¯"></a>é…ç½®Vimå’Œç»ˆç«¯</h3><h4 id="é…ç½®vim"><a href="#é…ç½®vim" class="headerlink" title="é…ç½®vim"></a>é…ç½®vim</h4><p>æˆ‘vimä½¿ç”¨çš„æ˜¯vundleæ’ä»¶ç®¡ç†å™¨ï¼Œé¦–å…ˆè¦å®‰è£…vundle.</p><p>é¦–å…ˆè¦ä¸‹è½½git</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><p>ç„¶åå®‰è£…vundle</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vi</span><br></pre></td></tr></table></figure><p>å°†å¦‚ä¸‹é…ç½®æ›¿æ¢åˆ°.vimrc ä¸­ï¼Œé¦–å…ˆè¦è¿›è¡Œå¤‡ä»½å“¦ï¼ï¼ï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">set nocompatible &quot; be iMproved, required</span><br><span class="line">filetype off &quot; required</span><br><span class="line">set number</span><br><span class="line">let mapleader=&quot;,&quot;</span><br><span class="line">set rtp+=~/.vim/bundle/Vundle.vim</span><br><span class="line">call vundle#begin()</span><br><span class="line"></span><br><span class="line">Plugin &apos;VundleVim/Vundle.vim&apos;</span><br><span class="line">Plugin &apos;scrooloose/nerdtree&apos;</span><br><span class="line">Plugin &apos;kien/ctrlp.vim&apos;</span><br><span class="line">Plugin &apos;junegunn/fzf&apos;</span><br><span class="line">Plugin &apos;Shougo/neocomplete.vim&apos;</span><br><span class="line">Plugin &apos;vim-airline/vim-airline&apos;</span><br><span class="line">Plugin &apos;vim-airline/vim-airline-themes&apos;</span><br><span class="line">Plugin &apos;terryma/vim-smooth-scroll&apos;</span><br><span class="line">Plugin &apos;terryma/vim-expand-region&apos;</span><br><span class="line">Plugin &apos;tpope/vim-commentary&apos;</span><br><span class="line">Plugin &apos;tpope/vim-surround&apos;</span><br><span class="line">Plugin &apos;godlygeek/tabular&apos;</span><br><span class="line">Plugin &apos;plasticboy/vim-markdown&apos;</span><br><span class="line">Plugin &apos;tpope/vim-fugitive&apos;</span><br><span class="line">Plugin &apos;airblade/vim-gitgutter&apos;</span><br><span class="line">Plugin &apos;justinmk/vim-sneak&apos;</span><br><span class="line">Plugin &apos;powerline/fonts&apos;</span><br><span class="line">Plugin &apos;scrooloose/nerdcommenter&apos; </span><br><span class="line">Plugin &apos;suan/vim-instant-markdown&apos;</span><br><span class="line">Plugin &apos;mzlogin/vim-markdown-toc&apos;</span><br><span class="line">call vundle#end()            &quot; required</span><br><span class="line">filetype plugin indent on</span><br><span class="line">&quot; let g:airline_powerline_fonts = 1</span><br><span class="line">map &lt;C-n&gt; :NERDTreeToggle&lt;CR&gt;</span><br><span class="line">&quot; smooth-scroll</span><br><span class="line">function SmoothScroll(up)</span><br><span class="line">    if a:up</span><br><span class="line">        let scrollaction=&quot;^Y&quot;</span><br><span class="line">    else</span><br><span class="line">        let scrollaction=&quot;^E&quot;</span><br><span class="line">    endif</span><br><span class="line">    exec &quot;normal &quot; . scrollaction</span><br><span class="line">    redraw</span><br><span class="line">    let counter=1</span><br><span class="line">    while counter&lt;&amp;scroll</span><br><span class="line">        let counter+=1</span><br><span class="line">        sleep 10m</span><br><span class="line">        redraw</span><br><span class="line">        exec &quot;normal &quot; . scrollaction</span><br><span class="line">    endwhile</span><br><span class="line">endfunction</span><br><span class="line">noremap &lt;silent&gt; &lt;c-u&gt; :call smooth_scroll#up(&amp;scroll, 15, 2)&lt;CR&gt;</span><br><span class="line">noremap &lt;silent&gt; &lt;c-d&gt; :call smooth_scroll#down(&amp;scroll, 15, 2)&lt;CR&gt;</span><br><span class="line">noremap &lt;silent&gt; &lt;c-b&gt; :call smooth_scroll#up(&amp;scroll*2, 10, 4)&lt;CR&gt;</span><br><span class="line">noremap &lt;silent&gt; &lt;c-f&gt; :call smooth_scroll#down(&amp;scroll*2, 10, 4)&lt;CR&gt;</span><br><span class="line">set mouse= </span><br><span class="line">map &lt;ScrollWheelUp&gt; &lt;C-Y&gt;</span><br><span class="line">map &lt;ScrollWheelDown&gt; &lt;C-E&gt;</span><br><span class="line">&quot;é«˜äº®é”™è¯¯</span><br><span class="line">&quot; let g:syntastic_enable_highlighting=1</span><br><span class="line">&quot; å¿«é€Ÿé€‰ä¸­</span><br><span class="line">&quot; let g:expand_region_use_select_mode = 1</span><br><span class="line">&quot; map w &lt;Plug&gt;(expand_region_expand)</span><br><span class="line">&quot; map W &lt;Plug&gt;(expand_region_shrink)</span><br><span class="line">&quot; markdown setting</span><br><span class="line">let g:vim_markdown_toc_autofit = 1</span><br><span class="line">let g:vim_markdown_autowrite = 1</span><br><span class="line">let g:vim_markdown_folding_disabled = 1</span><br><span class="line">set updatetime=100</span><br><span class="line">let g:gitgutter_grep=&apos;&apos;</span><br><span class="line">let g:gitgutter_terminal_reports_focus=0</span><br></pre></td></tr></table></figure><p>æœ€ååœ¨vimä¸­ä½¿ç”¨<code>:PluginInstall</code> å®‰è£…æ’ä»¶ã€‚å…·ä½“çš„æ’ä»¶çš„ä½œç”¨ä»¥åä¼šä¸“é—¨å†™ä¸€ç¯‡æ¥ä»‹ç»ã€‚ä¹Ÿå¯è‡ªè¡Œç™¾åº¦ã€‚</p><h4 id="é…ç½®ç»ˆç«¯"><a href="#é…ç½®ç»ˆç«¯" class="headerlink" title="é…ç½®ç»ˆç«¯"></a>é…ç½®ç»ˆç«¯</h4><p>æˆ‘ä½¿ç”¨çš„æ˜¯zshï¼Œé¦–å…ˆå®‰è£…zsh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install zsh</span><br></pre></td></tr></table></figure><p>ç„¶åé…ç½®å°†zshä¸ºé»˜è®¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chsh -s /bin/zsh</span><br></pre></td></tr></table></figure><p>æœ€åä½¿ç”¨è‘—åçš„oh-my-zsh æ¥è£…ç‚¹Bå§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®gitç¯å¢ƒå’Œgithubè¿æ¥"><a href="#é…ç½®gitç¯å¢ƒå’Œgithubè¿æ¥" class="headerlink" title="é…ç½®gitç¯å¢ƒå’Œgithubè¿æ¥"></a>é…ç½®gitç¯å¢ƒå’Œgithubè¿æ¥</h3><p>å®‰è£…å¥½gitåï¼Œé…ç½®git</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;ä½ çš„githubç”¨æˆ·å&quot;</span><br><span class="line">git config --global user.email &quot;ä½ çš„githubé‚®ç®±åœ°å€&quot;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå¯†é’¥ï¼Œä¸€è·¯enterå°±å¯ä»¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;ä½ è‡ªå·±çš„githubå¯¹åº”çš„é‚®ç®±åœ°å€&quot;</span><br></pre></td></tr></table></figure><p>å°†æ–‡ä»¶ä¸­ç”Ÿæˆçš„å¯†é’¥å¤åˆ¶åˆ°githubä¸Šçš„é…ç½®ä¸­å»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><h3 id="é…ç½®Javaå¼€å‘ç¯å¢ƒ"><a href="#é…ç½®Javaå¼€å‘ç¯å¢ƒ" class="headerlink" title="é…ç½®Javaå¼€å‘ç¯å¢ƒ"></a>é…ç½®Javaå¼€å‘ç¯å¢ƒ</h3><h4 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h4><ol><li>åœ¨<a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸‹è½½jdkæºç ,å¹¶åœ¨è§£å‹å‰åˆ›å»º <code>/usr/local/java</code> æ–‡ä»¶å¤¹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/java</span><br></pre></td></tr></table></figure><ol start="2"><li>å°†æ–‡ä»¶è§£å‹åˆ°åˆšåˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸­ï¼Œä¹Ÿå¯ä»¥è§£å‹åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åç§»åŠ¨åˆ°åˆšæ‰åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸‹ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf jdk1.8.0_191.tar.gz </span><br><span class="line"></span><br><span class="line">mv jdk1.8.0_191 /usr/local/java/</span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨vimç¼–è¾‘<code>/etc/profile</code> æ–‡ä»¶,åœ¨ç»“å°¾å¤„æ·»åŠ å¦‚ä¸‹å†…å®¹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/java/jdk1.8.0_191 </span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH </span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure><ol start="4"><li>æ‰§è¡Œ <code>source /etc/profile</code> åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ <code>java -version</code>æ¥æŸ¥çœ‹æ˜¯å¦æˆåŠŸã€‚</li></ol><p><img src="https://wx3.sinaimg.cn/large/006tNc79gy1g2dt166451j318s03waav.jpg" alt="java"></p><h4 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h4><ol><li><p>åœ¨<a href="http://maven.apache.org/download.cgi" target="_blank" rel="noopener">å®˜ç½‘</a> ä¸‹è½½æºç åŒ…ï¼ŒåŒæ ·è§£å‹å‰åˆ›å»º <code>/usr/local/maven</code>æ–‡ä»¶å¤¹</p></li><li><p>å°†æ–‡ä»¶è§£å‹åˆ°<code>/usr/local/maven</code>ä¸­ã€‚</p></li><li><p>ä½¿ç”¨vimç¼–è¾‘ <code>/etc/profile</code>æ–‡ä»¶ï¼Œåœ¨æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export MAVEN_HOME=/usr/local/maven/apache-maven-3.6.0</span><br><span class="line">export PATH=$MAVEN_HOME/bin:$PATH</span><br></pre></td></tr></table></figure><ol start="4"><li><p>åŒæ ·ä½¿ç”¨<code>source /etc/profile</code> å‘½ä»¤åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨<code>mvn -v</code> å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚ </p></li><li><p>é…ç½®é˜¿é‡Œmavené•œåƒ</p></li></ol><p>ç¼–è¾‘ <code>/usr/local/maven/apache-maven-3.6.0/conf/setting.xml</code>ï¼Œåœ¨<code>&lt;mirrors&gt;&lt;/mirrors&gt;</code>æ ‡ç­¾å†…æ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;alimaven&lt;/id&gt;</span><br><span class="line">      &lt;name&gt;aliyun maven&lt;/name&gt;</span><br><span class="line">  ã€€ã€€&lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;</span><br><span class="line">      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;        </span><br><span class="line">    &lt;/mirror&gt;</span><br></pre></td></tr></table></figure><p><img src="https://wx1.sinaimg.cn/large/006tNc79gy1g2dt176wswj319k068di3.jpg" alt="maven"></p><h3 id="Mysqlå®‰è£…å’Œæ•°æ®åº“ç®¡ç†è½¯ä»¶æ¨è"><a href="#Mysqlå®‰è£…å’Œæ•°æ®åº“ç®¡ç†è½¯ä»¶æ¨è" class="headerlink" title="Mysqlå®‰è£…å’Œæ•°æ®åº“ç®¡ç†è½¯ä»¶æ¨è"></a>Mysqlå®‰è£…å’Œæ•°æ®åº“ç®¡ç†è½¯ä»¶æ¨è</h3><ol><li>è¿›å…¥<a href="https://dev.mysql.com/downloads/repo/apt/" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸‹è½½ubuntuçš„debåŒ…ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤å®‰è£…</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i mysql-apt-config_0.8.11-1_all.deb</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ·æ–°æºåˆ—è¡¨</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><ol start="3"><li>å®‰è£…mysql</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mysql-server mysql-client</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä¼šè®©ä½ è¾“å…¥å¯†ç ï¼Œè¾“å…¥å°±è¡Œäº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu18.04 é…ç½®å…¨è¿‡ç¨‹</title>
      <link href="/2019/01/04/2019-01-04-Ubuntu%E9%85%8D%E7%BD%AE%E5%85%A8%E8%BF%87%E7%A8%8B/"/>
      <url>/2019/01/04/2019-01-04-Ubuntu%E9%85%8D%E7%BD%AE%E5%85%A8%E8%BF%87%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu18-04-é…ç½®å…¨è¿‡ç¨‹"><a href="#Ubuntu18-04-é…ç½®å…¨è¿‡ç¨‹" class="headerlink" title="Ubuntu18.04 é…ç½®å…¨è¿‡ç¨‹"></a>Ubuntu18.04 é…ç½®å…¨è¿‡ç¨‹</h1><p>å› ä¸ºæœ€è¿‘åœ¨å¼„win10åŒç³»ç»Ÿï¼Œåˆå› ä¸ºPopOsåœ¨è£…æœºçš„æ—¶å€™è®¾ç½®grubæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æ¢æˆæœ€æ–°çš„Ubuntuç¨³å®šç‰ˆæ¥åšæˆwin/ubunutåŒç³»ç»Ÿã€‚</p><h2 id="å®‰è£…é—®é¢˜"><a href="#å®‰è£…é—®é¢˜" class="headerlink" title="å®‰è£…é—®é¢˜"></a>å®‰è£…é—®é¢˜</h2><p>åœ¨è£…æœºçš„éœ€è¦ä½¿ç”¨grubåšå¯åŠ¨å¼•å¯¼ã€‚æ‰€ä»¥è®¾ç½®ä¿ç•™BIOSå¯åŠ¨åŒºåŸŸè€Œä¸æ˜¯æŒ‚è½½/bootã€‚äº²èº«ç»å†ï¼ŒUEFIå¯åŠ¨æ¨¡å¼ä¸‹ï¼ŒUbuntuçš„å¼•å¯¼æŒ‚è½½åº”è¯¥æ˜¯biosgrubï¼Œå¦åˆ™å‡ºé”™ã€‚å¯¼è‡´æ— æ³•å®¶åœ¨grubã€‚</p><h2 id="ç•Œé¢é…ç½®"><a href="#ç•Œé¢é…ç½®" class="headerlink" title="ç•Œé¢é…ç½®"></a>ç•Œé¢é…ç½®</h2><h3 id="å®‰è£…gnome-tweak-tool"><a href="#å®‰è£…gnome-tweak-tool" class="headerlink" title="å®‰è£…gnome-tweak-tool"></a>å®‰è£…gnome-tweak-tool</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gnome-tweak-tool</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦æ›´æ”¹shellåˆ™éœ€è¦å®‰è£…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gnome-shell-extensions</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½è½»æ¾æ„‰å¿«çš„ä½¿ç”¨gnome-tewak-tooläº†ã€‚</p><h3 id="ä¸»é¢˜æ–¹æ¡ˆ"><a href="#ä¸»é¢˜æ–¹æ¡ˆ" class="headerlink" title="ä¸»é¢˜æ–¹æ¡ˆ"></a>ä¸»é¢˜æ–¹æ¡ˆ</h3><h4 id="ä¸»ç•Œé¢"><a href="#ä¸»ç•Œé¢" class="headerlink" title="ä¸»ç•Œé¢"></a>ä¸»ç•Œé¢</h4><p>å› ä¸ºå‰ä¸€é˜µä½¿ç”¨Pop!_OSå‘ç°å®ƒé»˜è®¤çš„ä¸»é¢˜éå¸¸å¥½çœ‹ï¼Œæ‰€ä»¥ä¸‹è½½Poposé»˜è®¤çš„ä¸»é¢˜ï¼Œç„¶ååœ¨gnome-tweak-toolä¸­è®¾ç½®å¥½å°±okäº†ï¼Œ<a href="https://github.com/pop-os/gtk-theme" target="_blank" rel="noopener">è¿™é‡Œæ˜¯PopOsçš„gtkä¸»é¢˜åœ°å€</a>ã€‚ä½†æ˜¯å‘ç°PopOsé»˜è®¤çš„è¾“å…¥æ³•è¾“å…¥æ¡†æ˜¯é»˜è®¤ç±³é»„è‰²çš„ï¼Œæ‰“å­—çš„æ—¶å€™ä¸å¤ªæ˜¾çœ¼ï¼Œæ‰€ä»¥åœ¨åŸºç¡€ä¸Šæ·»åŠ äº†å¦‚ä¸‹ä»£ç ã€‚æ·»åŠ æ–¹æ³•ï¼š</p><ol><li>æ ¹æ®è¯´æ˜ä¸‹è½½Pop-theme</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:system76/pop</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install pop-theme</span><br></pre></td></tr></table></figure><ol start="2"><li>å®šä½åˆ° <code>/usr/share/themes/Pop/gnome-shell/</code> çš„gnome-shell.csså’ŒPop.css å°†IBusçš„ç•Œé¢ä»£ç æ›¿æ¢æˆå¦‚ä¸‹ä»£ç </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">.candidate-popup-content &#123;</span><br><span class="line">  padding: 8px;</span><br><span class="line">  spacing: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-index &#123;</span><br><span class="line">  padding: 0 4px 0 0;</span><br><span class="line">  color: rgba(255, 255, 255, 0.5);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-box:selected .candidate-index &#123;</span><br><span class="line">  color: rgba(255, 255, 255, 0.5);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-box &#123;</span><br><span class="line">  transition-duration: 0ms;</span><br><span class="line">  min-height: 28px;</span><br><span class="line">  padding: 0 8px;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-box:hover &#123;</span><br><span class="line">  background-color: rgba(255, 255, 255, 0.06);</span><br><span class="line">  color: rgba(255, 255, 255, 0.9);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-box:active &#123;</span><br><span class="line">background-color: rgba(255, 255, 255, 0.1);</span><br><span class="line">  color: rgba(255, 255, 255, 0.9);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-box:selected &#123;</span><br><span class="line">  background-color: #0046DB;</span><br><span class="line">  color: rgba(255, 255, 255, 0.85);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-page-button-box &#123;</span><br><span class="line">  height: 28px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.vertical .candidate-page-button-box &#123;</span><br><span class="line">  padding-top: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.horizontal .candidate-page-button-box &#123;</span><br><span class="line">  padding-left: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-page-button &#123;</span><br><span class="line">  min-width: 28px;</span><br><span class="line">  min-height: 28px;</span><br><span class="line">  padding: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-page-button-previous &#123;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">  border-right-width: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-page-button-next &#123;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.candidate-page-button-icon &#123;</span><br><span class="line">  icon-size: 1.23077em;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæˆå“ï¼š</p><p><img src="https://wx4.sinaimg.cn/large/006tNc79gy1g2dt15yse2j318u0miagk.jpg" alt="è¾“å…¥æ³•"></p><ol start="3"><li>åº”ç”¨ç¨‹åºçª—å£ç”¨çš„æ˜¯ macOS High Sierra  ä¸»é¢˜ï¼Œä»¿ç…§MACçš„çª—å£ã€‚æ¯”è¾ƒæ¼‚äº®ã€‚<a href="https://www.gnome-look.org/p/1013714/" target="_blank" rel="noopener">macOS High Sierra ä¸»é¢˜</a>ï¼Œä¸‹è½½ä¸‹æ¥åè§£å‹åæ”¾åˆ° <code>/usr/share/themes</code> ä¸‹ï¼Œä¹‹åå°±èƒ½åœ¨gnome-tweak-toolä¸­çœ‹åˆ°äº†ï¼Œè®¾ç½®å®Œæˆåå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæœã€‚</li></ol><p><img src="https://wx4.sinaimg.cn/large/006tNc79gy1g2dt17ye4jj31900u01dj.jpg" alt="ä¸»é¢˜"></p><h4 id="gdmä¸»é¢˜"><a href="#gdmä¸»é¢˜" class="headerlink" title="gdmä¸»é¢˜"></a>gdmä¸»é¢˜</h4><p>gdmä¸»é¢˜é€‰ç”¨ç±»ä¼¼MACç™»é™†çš„ä¸»é¢˜ï¼Œç•Œé¢ç¾è§‚ï¼Œè€Œä¸”è¿˜æœ‰æ¯›ç»ç’ƒæ•ˆæœã€‚<a href="https://www.gnome-look.org/p/1207015/" target="_blank" rel="noopener">High Ubunterra</a>ä¸‹è½½åè§£å‹ä¹‹åï¼Œç›´æ¥å‘½ä»¤è¡Œæ‰§è¡Œ./install.shã€‚ä¹‹åç›´æ¥å³é”®è®¾ç½®åï¼Œç›´æ¥å°†é”å±ç•Œé¢ç›´æ¥è®¾ç½®å¥½ã€‚å…¶å®ä¸»è¦ç›®çš„çš„å°±æ˜¯å°† <code>/usr/share/gnome-shell/theme</code> ä¸­çš„ubuntu.cssæ›¿æ¢æ‰ã€‚</p><h4 id="grubä¸»é¢˜"><a href="#grubä¸»é¢˜" class="headerlink" title="grubä¸»é¢˜"></a>grubä¸»é¢˜</h4><p>grubçš„ä¸»é¢˜æ¯”è¾ƒå°‘ï¼Œæ¨èçš„å°±æ˜¯<a href="https://www.gnome-look.org/p/1000140/" target="_blank" rel="noopener">Breeze GRUB2 theme</a> æ˜¯ä¸€æ¬¾æ¯”è¾ƒæ¼‚äº®ç¾è§‚çš„ä¸»é¢˜ã€‚å…·ä½“æˆæœç•Œé¢å¯ä»¥ç‚¹å‡»é“¾æ¥åœ°å€æŸ¥çœ‹ã€‚</p><p>æ™®é€šä¸»é¢˜éœ€è¦ä½œå¦‚ä¸‹é¡ºåºçš„æ“ä½œï¼Œä½†æ˜¯ Breeze Grub2 theme æœ‰è„šæœ¬ï¼Œç›´æ¥æ‰§è¡Œè§£å‹åçš„è„šæœ¬ç¨‹åºï¼Œå°±okäº†ã€‚</p><ol><li>åˆ›å»ºgrubçš„ä¸»é¢˜æ–‡ä»¶å¤¹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /boot/grub/themes</span><br></pre></td></tr></table></figure><ol start="2"><li>å°†ä¸»é¢˜åŒ…ç§»åŠ¨åˆ°è¿™ä¸ªç›®å½•ä¸‹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp ä¸»é¢˜åŒ…å /boot/grub/themes/</span><br></pre></td></tr></table></figure><ol start="3"><li>ä¿®æ”¹ä¸»é¢˜çš„é…ç½®æ–‡ä»¶</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/grub.d/00_header</span><br></pre></td></tr></table></figure><ol start="4"><li>åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRUB_THEME=&quot;/boot/grub/themes/ä¸»é¢˜åŒ…å/theme.txt&quot;</span><br><span class="line">GRUB_GFXMODE=&quot;1920x1080x32&quot;</span><br></pre></td></tr></table></figure><ol start="5"><li>æœ€åæ‰§è¡Œ update-grub å‘½ä»¤</li></ol><h3 id="gnomeæ‹“å±•æ¨è"><a href="#gnomeæ‹“å±•æ¨è" class="headerlink" title="gnomeæ‹“å±•æ¨è"></a>gnomeæ‹“å±•æ¨è</h3><p>æˆ‘æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æ‹“å±•å®‰è£…ï¼Œåœ¨Ubuntuç³»ç»Ÿä¸‹ï¼Œä¸€èˆ¬å®‰è£…å¦‚ä¸‹æ‹“å±•ã€‚</p><ol><li><p>User themes å¯ä»¥ä½¿ç”¨ç”¨æˆ·ç›®å½•ä¸‹çš„ä¸»é¢˜</p></li><li><p>removeable Drive Menu å½“æ’å…¥ç§»é™¤è®¾å¤‡çš„æ—¶å€™åœ¨ä¸Šæ–¹æœ‰çŠ¶æ€å›¾æ ‡æé†’ã€‚</p></li><li><p>Caffeine å¯ä»¥å…³é—­å±ä¿å’Œè‡ªåŠ¨æŒ‚èµ·ï¼Œå¾ˆå¥½ç”¨ã€‚</p></li><li><p>Dash To Dock å¦‚æœä½ ä¸å–œæ¬¢ubuntuçš„ä¾§è¾¹dockå¯ä»¥å°è¯•è¿™ä¸ªdockï¼Œæ¯”è¾ƒç¾è§‚çš„dockï¼Œå¯ä»¥è®¾ç½®åœ¨ä¾§è¾¹æˆ–è€…åœ¨åº•ä¸‹ã€‚</p></li><li><p>openWeather å¯ä»¥åœ¨é¡¶éƒ¨æ ä¸­æŸ¥çœ‹å¤©æ°”ï¼Œç‚¹å‡»å¯ä»¥æŸ¥çœ‹æœ€è¿‘å¤©æ°”ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ åœ°å€ã€‚</p></li><li><p>ClipBord Indicator æ˜¯å¯ä»¥è®°å½•ç²˜è´´æ¿çš„å†…å®¹ï¼Œæœ‰æ—¶å¯ä»¥é¿å…é‡å¤å¤åˆ¶çš„æ“ä½œã€‚</p></li></ol><p>æ¨èçš„æœ‰è¿™å‡ ä¸ªï¼Œä½†æ˜¯gnome-shellæ‹“å±•å¯è°“éå¸¸çš„å¤šï¼Œå¹¶ä¸”å¤§å¤šæ•°éƒ½éå¸¸å¥½ç”¨ï¼Œå¯ä»¥å» <a href="https://extensions.gnome.org/" target="_blank" rel="noopener">gnome extensions å®˜ç½‘</a> çœ‹ä¸€çœ‹ï¼Œçœ‹æœ‰æ²¡æœ‰æ›´é€‚åˆè‡ªå·±çš„ã€‚</p><h3 id="é…ç½®Vimå’Œç»ˆç«¯"><a href="#é…ç½®Vimå’Œç»ˆç«¯" class="headerlink" title="é…ç½®Vimå’Œç»ˆç«¯"></a>é…ç½®Vimå’Œç»ˆç«¯</h3><h4 id="é…ç½®vim"><a href="#é…ç½®vim" class="headerlink" title="é…ç½®vim"></a>é…ç½®vim</h4><p>æˆ‘vimä½¿ç”¨çš„æ˜¯vundleæ’ä»¶ç®¡ç†å™¨ï¼Œé¦–å…ˆè¦å®‰è£…vundle.</p><p>é¦–å…ˆè¦ä¸‹è½½git</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><p>ç„¶åå®‰è£…vundle</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vi</span><br></pre></td></tr></table></figure><p>å°†å¦‚ä¸‹é…ç½®æ›¿æ¢åˆ°.vimrc ä¸­ï¼Œé¦–å…ˆè¦è¿›è¡Œå¤‡ä»½å“¦ï¼ï¼ï¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">set nocompatible &quot; be iMproved, required</span><br><span class="line">filetype off &quot; required</span><br><span class="line">set number</span><br><span class="line">let mapleader=&quot;,&quot;</span><br><span class="line">set rtp+=~/.vim/bundle/Vundle.vim</span><br><span class="line">call vundle#begin()</span><br><span class="line"></span><br><span class="line">Plugin &apos;VundleVim/Vundle.vim&apos;</span><br><span class="line">Plugin &apos;scrooloose/nerdtree&apos;</span><br><span class="line">Plugin &apos;kien/ctrlp.vim&apos;</span><br><span class="line">Plugin &apos;junegunn/fzf&apos;</span><br><span class="line">Plugin &apos;Shougo/neocomplete.vim&apos;</span><br><span class="line">Plugin &apos;vim-airline/vim-airline&apos;</span><br><span class="line">Plugin &apos;vim-airline/vim-airline-themes&apos;</span><br><span class="line">Plugin &apos;terryma/vim-smooth-scroll&apos;</span><br><span class="line">Plugin &apos;terryma/vim-expand-region&apos;</span><br><span class="line">Plugin &apos;tpope/vim-commentary&apos;</span><br><span class="line">Plugin &apos;tpope/vim-surround&apos;</span><br><span class="line">Plugin &apos;godlygeek/tabular&apos;</span><br><span class="line">Plugin &apos;plasticboy/vim-markdown&apos;</span><br><span class="line">Plugin &apos;tpope/vim-fugitive&apos;</span><br><span class="line">Plugin &apos;airblade/vim-gitgutter&apos;</span><br><span class="line">Plugin &apos;justinmk/vim-sneak&apos;</span><br><span class="line">Plugin &apos;powerline/fonts&apos;</span><br><span class="line">Plugin &apos;scrooloose/nerdcommenter&apos; </span><br><span class="line">Plugin &apos;suan/vim-instant-markdown&apos;</span><br><span class="line">Plugin &apos;mzlogin/vim-markdown-toc&apos;</span><br><span class="line">call vundle#end()            &quot; required</span><br><span class="line">filetype plugin indent on</span><br><span class="line">&quot; let g:airline_powerline_fonts = 1</span><br><span class="line">map &lt;C-n&gt; :NERDTreeToggle&lt;CR&gt;</span><br><span class="line">&quot; smooth-scroll</span><br><span class="line">function SmoothScroll(up)</span><br><span class="line">    if a:up</span><br><span class="line">        let scrollaction=&quot;^Y&quot;</span><br><span class="line">    else</span><br><span class="line">        let scrollaction=&quot;^E&quot;</span><br><span class="line">    endif</span><br><span class="line">    exec &quot;normal &quot; . scrollaction</span><br><span class="line">    redraw</span><br><span class="line">    let counter=1</span><br><span class="line">    while counter&lt;&amp;scroll</span><br><span class="line">        let counter+=1</span><br><span class="line">        sleep 10m</span><br><span class="line">        redraw</span><br><span class="line">        exec &quot;normal &quot; . scrollaction</span><br><span class="line">    endwhile</span><br><span class="line">endfunction</span><br><span class="line">noremap &lt;silent&gt; &lt;c-u&gt; :call smooth_scroll#up(&amp;scroll, 15, 2)&lt;CR&gt;</span><br><span class="line">noremap &lt;silent&gt; &lt;c-d&gt; :call smooth_scroll#down(&amp;scroll, 15, 2)&lt;CR&gt;</span><br><span class="line">noremap &lt;silent&gt; &lt;c-b&gt; :call smooth_scroll#up(&amp;scroll*2, 10, 4)&lt;CR&gt;</span><br><span class="line">noremap &lt;silent&gt; &lt;c-f&gt; :call smooth_scroll#down(&amp;scroll*2, 10, 4)&lt;CR&gt;</span><br><span class="line">set mouse= </span><br><span class="line">map &lt;ScrollWheelUp&gt; &lt;C-Y&gt;</span><br><span class="line">map &lt;ScrollWheelDown&gt; &lt;C-E&gt;</span><br><span class="line">&quot;é«˜äº®é”™è¯¯</span><br><span class="line">&quot; let g:syntastic_enable_highlighting=1</span><br><span class="line">&quot; å¿«é€Ÿé€‰ä¸­</span><br><span class="line">&quot; let g:expand_region_use_select_mode = 1</span><br><span class="line">&quot; map w &lt;Plug&gt;(expand_region_expand)</span><br><span class="line">&quot; map W &lt;Plug&gt;(expand_region_shrink)</span><br><span class="line">&quot; markdown setting</span><br><span class="line">let g:vim_markdown_toc_autofit = 1</span><br><span class="line">let g:vim_markdown_autowrite = 1</span><br><span class="line">let g:vim_markdown_folding_disabled = 1</span><br><span class="line">set updatetime=100</span><br><span class="line">let g:gitgutter_grep=&apos;&apos;</span><br><span class="line">let g:gitgutter_terminal_reports_focus=0</span><br></pre></td></tr></table></figure><p>æœ€ååœ¨vimä¸­ä½¿ç”¨<code>:PluginInstall</code> å®‰è£…æ’ä»¶ã€‚å…·ä½“çš„æ’ä»¶çš„ä½œç”¨ä»¥åä¼šä¸“é—¨å†™ä¸€ç¯‡æ¥ä»‹ç»ã€‚ä¹Ÿå¯è‡ªè¡Œç™¾åº¦ã€‚</p><h4 id="é…ç½®ç»ˆç«¯"><a href="#é…ç½®ç»ˆç«¯" class="headerlink" title="é…ç½®ç»ˆç«¯"></a>é…ç½®ç»ˆç«¯</h4><p>æˆ‘ä½¿ç”¨çš„æ˜¯zshï¼Œé¦–å…ˆå®‰è£…zsh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install zsh</span><br></pre></td></tr></table></figure><p>ç„¶åé…ç½®å°†zshä¸ºé»˜è®¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chsh -s /bin/zsh</span><br></pre></td></tr></table></figure><p>æœ€åä½¿ç”¨è‘—åçš„oh-my-zsh æ¥è£…ç‚¹Bå§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®gitç¯å¢ƒå’Œgithubè¿æ¥"><a href="#é…ç½®gitç¯å¢ƒå’Œgithubè¿æ¥" class="headerlink" title="é…ç½®gitç¯å¢ƒå’Œgithubè¿æ¥"></a>é…ç½®gitç¯å¢ƒå’Œgithubè¿æ¥</h3><p>å®‰è£…å¥½gitåï¼Œé…ç½®git</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;ä½ çš„githubç”¨æˆ·å&quot;</span><br><span class="line">git config --global user.email &quot;ä½ çš„githubé‚®ç®±åœ°å€&quot;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå¯†é’¥ï¼Œä¸€è·¯enterå°±å¯ä»¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;ä½ è‡ªå·±çš„githubå¯¹åº”çš„é‚®ç®±åœ°å€&quot;</span><br></pre></td></tr></table></figure><p>å°†æ–‡ä»¶ä¸­ç”Ÿæˆçš„å¯†é’¥å¤åˆ¶åˆ°githubä¸Šçš„é…ç½®ä¸­å»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><h3 id="é…ç½®Javaå¼€å‘ç¯å¢ƒ"><a href="#é…ç½®Javaå¼€å‘ç¯å¢ƒ" class="headerlink" title="é…ç½®Javaå¼€å‘ç¯å¢ƒ"></a>é…ç½®Javaå¼€å‘ç¯å¢ƒ</h3><h4 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h4><ol><li>åœ¨<a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸‹è½½jdkæºç ,å¹¶åœ¨è§£å‹å‰åˆ›å»º <code>/usr/local/java</code> æ–‡ä»¶å¤¹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/java</span><br></pre></td></tr></table></figure><ol start="2"><li>å°†æ–‡ä»¶è§£å‹åˆ°åˆšåˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸­ï¼Œä¹Ÿå¯ä»¥è§£å‹åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åç§»åŠ¨åˆ°åˆšæ‰åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸‹ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf jdk1.8.0_191.tar.gz </span><br><span class="line"></span><br><span class="line">mv jdk1.8.0_191 /usr/local/java/</span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨vimç¼–è¾‘<code>/etc/profile</code> æ–‡ä»¶,åœ¨ç»“å°¾å¤„æ·»åŠ å¦‚ä¸‹å†…å®¹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/java/jdk1.8.0_191 </span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH </span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure><ol start="4"><li>æ‰§è¡Œ <code>source /etc/profile</code> åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ <code>java -version</code>æ¥æŸ¥çœ‹æ˜¯å¦æˆåŠŸã€‚</li></ol><p><img src="https://wx3.sinaimg.cn/large/006tNc79gy1g2dt166451j318s03waav.jpg" alt="java"></p><h4 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h4><ol><li><p>åœ¨<a href="http://maven.apache.org/download.cgi" target="_blank" rel="noopener">å®˜ç½‘</a> ä¸‹è½½æºç åŒ…ï¼ŒåŒæ ·è§£å‹å‰åˆ›å»º <code>/usr/local/maven</code>æ–‡ä»¶å¤¹</p></li><li><p>å°†æ–‡ä»¶è§£å‹åˆ°<code>/usr/local/maven</code>ä¸­ã€‚</p></li><li><p>ä½¿ç”¨vimç¼–è¾‘ <code>/etc/profile</code>æ–‡ä»¶ï¼Œåœ¨æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export MAVEN_HOME=/usr/local/maven/apache-maven-3.6.0</span><br><span class="line">export PATH=$MAVEN_HOME/bin:$PATH</span><br></pre></td></tr></table></figure><ol start="4"><li><p>åŒæ ·ä½¿ç”¨<code>source /etc/profile</code> å‘½ä»¤åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨<code>mvn -v</code> å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚ </p></li><li><p>é…ç½®é˜¿é‡Œmavené•œåƒ</p></li></ol><p>ç¼–è¾‘ <code>/usr/local/maven/apache-maven-3.6.0/conf/setting.xml</code>ï¼Œåœ¨<code>&lt;mirrors&gt;&lt;/mirrors&gt;</code>æ ‡ç­¾å†…æ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;alimaven&lt;/id&gt;</span><br><span class="line">      &lt;name&gt;aliyun maven&lt;/name&gt;</span><br><span class="line">  ã€€ã€€&lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;</span><br><span class="line">      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;        </span><br><span class="line">    &lt;/mirror&gt;</span><br></pre></td></tr></table></figure><p><img src="https://wx1.sinaimg.cn/large/006tNc79gy1g2dt176wswj319k068di3.jpg" alt="maven"></p><h3 id="Mysqlå®‰è£…å’Œæ•°æ®åº“ç®¡ç†è½¯ä»¶æ¨è"><a href="#Mysqlå®‰è£…å’Œæ•°æ®åº“ç®¡ç†è½¯ä»¶æ¨è" class="headerlink" title="Mysqlå®‰è£…å’Œæ•°æ®åº“ç®¡ç†è½¯ä»¶æ¨è"></a>Mysqlå®‰è£…å’Œæ•°æ®åº“ç®¡ç†è½¯ä»¶æ¨è</h3><ol><li>è¿›å…¥<a href="https://dev.mysql.com/downloads/repo/apt/" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸‹è½½ubuntuçš„debåŒ…ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤å®‰è£…</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i mysql-apt-config_0.8.11-1_all.deb</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ·æ–°æºåˆ—è¡¨</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><ol start="3"><li>å®‰è£…mysql</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mysql-server mysql-client</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä¼šè®©ä½ è¾“å…¥å¯†ç ï¼Œè¾“å…¥å°±è¡Œäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntuç³»çš„IBUSè¾“å…¥æ³•ä¸Šæ–¹panelçš„è¾“å…¥æ³•å›¾æ ‡æ¶ˆå¤±é—®é¢˜</title>
      <link href="/2018/12/29/2018-12-18-Pop!_Os%E7%9A%84Ibus%E8%BE%93%E5%85%A5%E6%B3%95%E4%B8%8A%E6%96%B9panel%E5%9B%BE%E6%A0%87%E6%B6%88%E5%A4%B1%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2018/12/29/2018-12-18-Pop!_Os%E7%9A%84Ibus%E8%BE%93%E5%85%A5%E6%B3%95%E4%B8%8A%E6%96%B9panel%E5%9B%BE%E6%A0%87%E6%B6%88%E5%A4%B1%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntuç³»çš„IBUSè¾“å…¥æ³•ä¸Šæ–¹panelçš„è¾“å…¥æ³•å›¾æ ‡æ¶ˆå¤±é—®é¢˜"><a href="#Ubuntuç³»çš„IBUSè¾“å…¥æ³•ä¸Šæ–¹panelçš„è¾“å…¥æ³•å›¾æ ‡æ¶ˆå¤±é—®é¢˜" class="headerlink" title="Ubuntuç³»çš„IBUSè¾“å…¥æ³•ä¸Šæ–¹panelçš„è¾“å…¥æ³•å›¾æ ‡æ¶ˆå¤±é—®é¢˜"></a>Ubuntuç³»çš„IBUSè¾“å…¥æ³•ä¸Šæ–¹panelçš„è¾“å…¥æ³•å›¾æ ‡æ¶ˆå¤±é—®é¢˜</h1><p>æœ€è¿‘è¿·ä¸Šäº†Pop!_Osï¼ŒåŸºäºUbuntuçš„å‘è¡Œç‰ˆï¼Œéå¸¸ç®€æ´ï¼Œå¼€ç®±å³ç”¨ã€‚å’Œubuntuç›¸åŒï¼Œibusçš„è¾“å…¥æ³•å›¾æ ‡æœ‰æ—¶æ¶ˆå¤±ï¼Œåœ¨è¿™é‡Œæ€»ç»“ä»¥ä¸‹ï¼Œæ–¹ä¾¿åé¢å†å‡ºç°é—®é¢˜çš„æ—¶å€™æŸ¥é˜…ã€‚</p><p>æ‰“å¼€ç»ˆç«¯è¾“å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibus-daemon -drx</span><br></pre></td></tr></table></figure><p>è§£å†³ï¼ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºSpringMvcå®ç°restFulæ—¶DELETEå’ŒPUTå‡ºç°é”™è¯¯</title>
      <link href="/2018/11/09/2018-12-18-%E5%85%B3%E4%BA%8ESpringMvc%E4%BD%BF%E7%94%A8DELETE%E5%92%8CPUT%E8%AF%B7%E6%B1%82%E6%97%B6405%E9%94%99%E8%AF%AF/"/>
      <url>/2018/11/09/2018-12-18-%E5%85%B3%E4%BA%8ESpringMvc%E4%BD%BF%E7%94%A8DELETE%E5%92%8CPUT%E8%AF%B7%E6%B1%82%E6%97%B6405%E9%94%99%E8%AF%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="å…³äºRESTful"><a href="#å…³äºRESTful" class="headerlink" title="å…³äºRESTful"></a>å…³äºRESTful</h1><p>æˆ‘ç†è§£çš„restfulæ˜¯ä¸€ç§é£æ ¼ï¼Œæ¯ä¸€ä¸ªurlè¡¨ç¤ºä¸€ä¸ªèµ„æºï¼Œä¸€ä¸ªèµ„æºä¸åŒçš„æ“ä½œäº«ç”¨åŒä¸€ä¸ªæ¥å£ï¼Œä½†æ˜¯ä¼ è¾“çš„çŠ¶æ€æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚httpä¸­çš„POST,DELETE,PUT,GETã€‚</p><h1 id="å†springMVCä¸­å®ç°RESTful"><a href="#å†springMVCä¸­å®ç°RESTful" class="headerlink" title="å†springMVCä¸­å®ç°RESTful"></a>å†springMVCä¸­å®ç°RESTful</h1><ol><li>web.xmlä¸­é…ç½®</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;filter&gt;</span><br><span class="line">        &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;</span><br><span class="line">        &lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-class&gt;</span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line">    &lt;filter-mapping&gt;</span><br><span class="line">        &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/filter-mapping&gt;</span><br><span class="line"></span><br><span class="line">    &lt;filter&gt;</span><br><span class="line">        &lt;filter-name&gt;HttpMethodFilter&lt;/filter-name&gt;</span><br><span class="line">        &lt;filter-class&gt;org.springframework.web.filter.HttpPutFormContentFilter&lt;/filter-class&gt;</span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line">    &lt;filter-mapping&gt;</span><br><span class="line">        &lt;filter-name&gt;HttpMethodFilter&lt;/filter-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/filter-mapping&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>springmvc controlå±‚ä½¿ç”¨ç›¸åº”çŠ¶æ€ç æ¥æ ‡è¯†ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/navbarCategory/&#123;id&#125;&quot;, method = RequestMethod.DELETE)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«å’Œå…³ç³»</title>
      <link href="/2018/11/09/2018-11-08-String%E5%92%8CStringBuffer%E5%92%8CStringBuilder%E7%9A%84%E8%81%94%E7%B3%BB%E5%92%8C%E5%8C%BA%E5%88%AB/"/>
      <url>/2018/11/09/2018-11-08-String%E5%92%8CStringBuffer%E5%92%8CStringBuilder%E7%9A%84%E8%81%94%E7%B3%BB%E5%92%8C%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«å’Œå…³ç³»"><a href="#Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«å’Œå…³ç³»" class="headerlink" title="Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«å’Œå…³ç³»"></a>Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«å’Œå…³ç³»</h1><p><code>String</code>å£°æ˜åæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œè€Œ<code>Stringbuffer</code>å’Œ<code>StringBuilder</code>æ˜¯æ•°æ®ç»“æ„æ˜¯å˜é‡ï¼Œæ‰€ä»¥æ¯”Stringåœ¨è¿æ¥å­—ç¬¦æ—¶æ•ˆç‡é«˜ã€‚</p><p>å¹¶ä¸”StringBufferå’ŒStringBuilderçš„åŒºåˆ«æ˜¯StringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„(synchronized) ï¼Œè€ŒStringBuilderæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥é€Ÿåº¦å¤§è‡´æ’è¡Œä¸ºï¼šStringBuilder&gt;StringBuffer&gt;String</p><p>ä»¥ä¸Šåªæ˜¯åŸºäºå°è±¡æˆ–è€…è¯´æ˜¯æ­»è®°ç¡¬èƒŒçš„ä¸œè¥¿ï¼Œæ²¡æœ‰çœ‹æºç æ˜¯å¦çœŸçš„æ˜¯è¿™æ ·çš„ã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹String,StringBuilder,StringBufferçš„æºç æ¥çœŸæ­£çš„è®°ä½ã€‚</p><h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><p>Stringä¸­çš„concatæ–¹æ³•å®ç°äº†å­—ç¬¦ä¸²çš„æ‹¼æ¥ã€‚</p><h3 id="å®ä¾‹å˜é‡"><a href="#å®ä¾‹å˜é‡" class="headerlink" title="å®ä¾‹å˜é‡"></a>å®ä¾‹å˜é‡</h3><p>Stringç±»ä¸­æœ‰ä¸¤ä¸ªå®ä¾‹å˜é‡ï¼Œåˆ†åˆ«ä¸ºvalueå’Œhash</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The value is used for character storage. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Cache the hash code for the string */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> hash; <span class="comment">// Default to 0</span></span><br></pre></td></tr></table></figure><h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><p>Stringçš„æ„é€ æ–¹æ³•å¾ˆå¤šï¼Œä½†æ˜¯éƒ½æ¯”è¾ƒç®€å•ï¼Œä¸‹é¢æ¥è¯´æ¯”è¾ƒå¸¸ç”¨çš„å‡ ç§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“æ–°å»ºä¸€ä¸ªStringå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šé»˜è®¤ä»˜ä¸€ä¸ªç©ºçš„å­—ç¬¦åºåˆ—,è¯·æ³¨æ„ï¼Œç”±äºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤ä¸å¿…ä½¿ç”¨æ­¤æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = <span class="string">""</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è¿™ä¸ªæ„é€ æ–¹æ³•,ä¼šé»˜è®¤æ–°å»ºä¸€ä¸ªå€¼ä¸ºoriginalçš„å­—ç¬¦ä¸²ã€‚åŒä¸Šï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸å¯å˜çš„ï¼Œå°±æ²¡å¿…è¦è¿™æ ·å£°æ˜ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(String original)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = original.value;</span><br><span class="line">        <span class="keyword">this</span>.hash = original.hash;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨copyofæ–¹æ³•ç”¨æ¥å¤åˆ¶ä¸€ä¸ªæ–°çš„å­—ç¬¦æ•°ç»„ï¼Œåç»­ä¿®æ”¹å­—ç¬¦æ•°ç»„ï¼Œä¸ä¼šå½±å“åˆ°æ–°å»ºçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">char</span> value[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = Arrays.copyOf(value, value.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="concatæ–¹æ³•"><a href="#concatæ–¹æ³•" class="headerlink" title="concatæ–¹æ³•"></a>concatæ–¹æ³•</h3><p>ä¸ºä»€ä¹ˆè¯´Stringçš„æ•ˆç‡ä½ï¼Œå°±ä½“ç°åœ¨concatæ‹¼æ¥å­—ç¬¦ä¸²çš„æ—¶å€™æ¯æ¬¡éƒ½è¦è¿”å›ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">concat</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> otherLen = str.length();</span><br><span class="line">        <span class="keyword">if</span> (otherLen == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> len = value.length;</span><br><span class="line">        <span class="keyword">char</span> buf[] = Arrays.copyOf(value, len + otherLen);</span><br><span class="line">        str.getChars(buf, len);</span><br><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªæ–°å»ºçš„Stringå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(buf, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="StringBuilder"><a href="#StringBuilder" class="headerlink" title="StringBuilder"></a>StringBuilder</h2><p>StringBuilderç»§æ‰¿äº†AbstractStringBuilderï¼Œå…¶ä¸­çš„å®ä¾‹å˜é‡å’ŒStringä¸­çš„åŸºæœ¬ç›¸åŒï¼Œ</p><h3 id="æ„é€ æ–¹æ³•-1"><a href="#æ„é€ æ–¹æ³•-1" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuilder</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(capacity);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•</span></span><br><span class="line">AbstractStringBuilder(<span class="keyword">int</span> capacity) &#123;</span><br><span class="line">        value = <span class="keyword">new</span> <span class="keyword">char</span>[capacity];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="appendæ–¹æ³•"><a href="#appendæ–¹æ³•" class="headerlink" title="appendæ–¹æ³•"></a>appendæ–¹æ³•</h3><p>å¯ä»¥çœ‹åˆ°ï¼Œå¹¶æ²¡æœ‰æ–°å»ºå¯¹è±¡ï¼Œåªæ˜¯åœ¨æ”¹å˜å¯¹è±¡ä¸­çš„å†…å®¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> StringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.append(str);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// appendè°ƒç”¨çš„è¿˜æ˜¯çˆ¶ç±»çš„appendæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> appendNull();</span><br><span class="line">        <span class="keyword">int</span> len = str.length();</span><br><span class="line">        ensureCapacityInternal(count + len);</span><br><span class="line">        str.getChars(<span class="number">0</span>, len, value, count);</span><br><span class="line"><span class="comment">//æŠŠvalueæ‰©å®¹åå†æŠŠstråŠ è¿›å»</span></span><br><span class="line">        count += len;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="StringBuffer"><a href="#StringBuffer" class="headerlink" title="StringBuffer"></a>StringBuffer</h2><p>å’ŒStringBuilderä¸€æ ·ï¼Œä¹Ÿæ˜¯ç»§æ‰¿äº†AbstractStringBuilderç±»ï¼Œä½†æ˜¯çœ‹ä¸€ä¸ªappendè¿™ä¸ªæ–¹æ³•çš„æºç å°±èƒ½å¤ŸçŸ¥é“æœ‰ä»€ä¹ˆåŒºåˆ«äº†</p><h3 id="appendæ–¹æ³•-1"><a href="#appendæ–¹æ³•-1" class="headerlink" title="appendæ–¹æ³•"></a>appendæ–¹æ³•</h3><p>æ·»åŠ äº†synchronizedå…³é”®å­—ï¼Œä½¿å¾—å˜ä¸ºçº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯ä»£ä»·å°±æ˜¯æ•ˆç‡ä¸å¦‚StringBuilderé«˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> StringBuffer <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    toStringCache = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">super</span>.append(str);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒRPCæ¡†æ¶ï¼Œæ•°æ®åº“ä¸­é—´ä»¶çš„æ¦‚å¿µè®¤çŸ¥</title>
      <link href="/2018/10/30/2018-10-29-%E4%BB%80%E4%B9%88%E6%98%AF%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%8CRPC%E6%A1%86%E6%9E%B6%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
      <url>/2018/10/30/2018-10-29-%E4%BB%80%E4%B9%88%E6%98%AF%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%8CRPC%E6%A1%86%E6%9E%B6%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒRPCæ¡†æ¶ï¼Œæ•°æ®åº“ä¸­é—´ä»¶çš„æ¦‚å¿µè®¤çŸ¥"><a href="#æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒRPCæ¡†æ¶ï¼Œæ•°æ®åº“ä¸­é—´ä»¶çš„æ¦‚å¿µè®¤çŸ¥" class="headerlink" title="æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒRPCæ¡†æ¶ï¼Œæ•°æ®åº“ä¸­é—´ä»¶çš„æ¦‚å¿µè®¤çŸ¥"></a>æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒRPCæ¡†æ¶ï¼Œæ•°æ®åº“ä¸­é—´ä»¶çš„æ¦‚å¿µè®¤çŸ¥</h1><h2 id="æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="æ¶ˆæ¯ä¸­é—´ä»¶"></a>æ¶ˆæ¯ä¸­é—´ä»¶</h2><h3 id="ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶"></a>ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶</h3><p>å¯¹ä¸­é—´ä»¶çš„ç†è§£å¤§æ¦‚å°±æ˜¯å…·ä½“ä¸šåŠ¡å’Œåº•å±‚é€»è¾‘è§£è€¦çš„ç»„ä»¶ã€‚ç›¸å½“äºå‰ç«¯ä¸šåŠ¡å’Œåº•å±‚é€»è¾‘çš„ä¸­é—´æ¡¥æ¢ã€‚</p><p>æ¶ˆæ¯ä¸­é—´ä»¶æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€å’Œæ¥å—æ¶ˆæ¯çš„åŸºç¡€æœåŠ¡è®¾æ–½ã€‚</p><h3 id="èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ"><a href="#èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ" class="headerlink" title="èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ"></a>èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ</h3><ul><li>ä¸šåŠ¡è§£è€¦ï¼šäº¤æ˜“ç³»ç»Ÿä¸éœ€è¦çŸ¥é“çŸ­ä¿¡é€šçŸ¥æœåŠ¡çš„å­˜åœ¨ï¼Œåªéœ€è¦å‘å¸ƒæ¶ˆæ¯</li><li>å‰Šå³°å¡«è°·ï¼šæ¯”å¦‚ä¸Šæ¸¸ç³»ç»Ÿçš„ååèƒ½åŠ›é«˜äºä¸‹æ¸¸ç³»ç»Ÿï¼Œåœ¨æµé‡æ´ªå³°æ—¶å¯èƒ½ä¼šå†²å®ä¸‹æ¸¸ç³»ç»Ÿï¼Œæ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥åœ¨å³°å€¼æ—¶å †ç§¯æ¶ˆæ¯ï¼Œè€Œåœ¨å³°å€¼è¿‡å»åä¸‹æ¸¸ç³»ç»Ÿæ…¢æ…¢æ¶ˆè´¹æ¶ˆæ¯è§£å†³æµé‡æ´ªå³°çš„é—®é¢˜</li><li>äº‹ä»¶é©±åŠ¨ï¼šç³»ç»Ÿä¸ç³»ç»Ÿä¹‹é—´å¯ä»¥é€šè¿‡æ¶ˆæ¯ä¼ é€’çš„å½¢å¼é©±åŠ¨ä¸šåŠ¡ï¼Œä»¥æµå¼çš„æ¨¡å‹å¤„ç†</li></ul><h2 id="RPCæ¡†æ¶"><a href="#RPCæ¡†æ¶" class="headerlink" title="RPCæ¡†æ¶"></a>RPCæ¡†æ¶</h2><h3 id="ä»€ä¹ˆæ˜¯RPCæ¡†æ¶"><a href="#ä»€ä¹ˆæ˜¯RPCæ¡†æ¶" class="headerlink" title="ä»€ä¹ˆæ˜¯RPCæ¡†æ¶"></a>ä»€ä¹ˆæ˜¯RPCæ¡†æ¶</h3><p>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®RPCï¼ˆRemote Procedure Call Protocol) ä¸¤å°æœåŠ¡å™¨Aï¼ŒBï¼Œä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨AæœåŠ¡å™¨ä¸Šï¼Œæƒ³è¦è°ƒç”¨BæœåŠ¡å™¨ä¸Šåº”ç”¨æä¾›çš„å‡½æ•°/æ–¹æ³•ï¼Œ<br>ç”±äºä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰å’Œä¼ è¾¾è°ƒç”¨çš„æ•°æ®ã€‚</p><h3 id="èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ-1"><a href="#èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ-1" class="headerlink" title="èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ"></a>èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ</h3><ul><li>å»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„TCPé“¾æ¥ï¼Œä¸åŒçš„RPCåè®®ï¼Œæœ‰ä¸åŒçš„è¿æ¥å¯»å€æ–¹å¼ã€‚</li><li>åœ¨å‘èµ·è¿œç¨‹è°ƒç”¨æ—¶ï¼Œç”±äºç½‘ç»œåè®®æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæ‰€ä»¥åœ¨ä¼ è¾“å‰è¦è¿›è¡Œå¯¹ä¼ è¾“å®ä½“è¿›è¡Œè½¬æ¢äºŒè¿›åˆ¶çš„è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯å°±åºåˆ—åŒ–è¿‡ç¨‹ï¼ˆSerializeï¼‰ï¼Œé€šè¿‡å¯»å€å’ŒäºŒè¿›åˆ¶çš„æ•°æ®ä¼ è¾“åˆ°æœåŠ¡å™¨ç«¯</li><li>åœ¨æ¥å—åˆ°æ•°æ®åï¼Œéœ€è¦è¿›è¡Œååºåˆ—åŒ–è¿‡ç¨‹è§£æäºŒè¿›åˆ¶æ•°æ®ã€‚</li></ul><p>å…¶å®å°±æ˜¯è§£å†³åœ¨åˆ†å¸ƒå¼ä¸‹ï¼Œæ¨ªå‘æ‹“å±•çš„å‰æä¸‹ï¼Œä¸åŒæœåŠ¡å™¨ç›¸äº’è°ƒç”¨æ–¹æ³•çš„é—®é¢˜ã€‚</p><h2 id="æ•°æ®åº“ä¸­é—´ä»¶"><a href="#æ•°æ®åº“ä¸­é—´ä»¶" class="headerlink" title="æ•°æ®åº“ä¸­é—´ä»¶"></a>æ•°æ®åº“ä¸­é—´ä»¶</h2><h3 id="ä»€ä¹ˆæ˜¯æ•°æ®åº“ä¸­é—´ä»¶"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®åº“ä¸­é—´ä»¶" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®åº“ä¸­é—´ä»¶"></a>ä»€ä¹ˆæ˜¯æ•°æ®åº“ä¸­é—´ä»¶</h3><p>åŒæ ·åœ¨åˆ†å¸ƒå¼çš„æ¶æ„ä¸­ï¼Œæ•°æ®åº“ä¹Ÿæ”¾åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œéœ€è¦é€šè¿‡ä¸­é—´çš„è·¯ç”±è¿›è¡Œè°ƒç”¨ã€‚è¿™ä¸ªè·¯ç”±å®é™…ä¸Šå°±æ˜¯æ•°æ®åº“ä¸­é—´ä»¶ã€‚</p><h3 id="èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ-2"><a href="#èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ-2" class="headerlink" title="èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ"></a>èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ</h3><ul><li>å®ç°è¯»å†™åˆ†ç¦»ï¼Œä½†æ˜¯æ¯ä¸ªæœåŠ¡å™¨ä¸Šéƒ½éœ€è¦æœ‰ä¸€ä»½å®Œæ•´çš„æ•°æ®åº“</li><li>å®ç°åˆ†åº“åˆ†è¡¨ï¼Œé€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡ŒæŸ¥è¯¢åˆ†æ´¾åˆ°æŸä¸€ä¸ªç‰¹å®šçš„æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡è¿™ä¸ªæœåŠ¡å™¨æŸ¥è¯¢å‡ºå†…å®¹è¿”å›åˆ°æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå†é€šè¿‡ä¸­é—´ä»¶è¿”å›åˆ°å®¢æˆ·ç«¯ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Junitçš„ä½¿ç”¨å’Œæºç åˆ†æ</title>
      <link href="/2018/10/29/2018-10-28-Junit4%202/"/>
      <url>/2018/10/29/2018-10-28-Junit4%202/</url>
      
        <content type="html"><![CDATA[<h1 id="Junitçš„ä½¿ç”¨å’Œæºç åˆ†æ"><a href="#Junitçš„ä½¿ç”¨å’Œæºç åˆ†æ" class="headerlink" title="Junitçš„ä½¿ç”¨å’Œæºç åˆ†æ"></a>Junitçš„ä½¿ç”¨å’Œæºç åˆ†æ</h1><p>Junitæ˜¯ä¸€ä¸ªç¼–å†™å¯é‡å¤æµ‹è¯•çš„Javaæµ‹è¯•æ¡†æ¶ï¼Œä»£ç ç¼–å†™éå¸¸æœ‰æŠ€å·§æ€§ï¼Œå€¼å¾—åå¤é˜…è¯»ã€‚</p><h2 id="è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ Junit"><a href="#è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ Junit" class="headerlink" title="è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ Junit"></a>è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ Junit</h2><p>å®˜æ–¹æ–‡æ¡£å¾€å¾€æ˜¯å­¦ä¹ æœ€å¥½çš„èµ„æ–™ã€‚</p><h3 id="ç®€å•æµ‹è¯•ä¾‹å­"><a href="#ç®€å•æµ‹è¯•ä¾‹å­" class="headerlink" title="ç®€å•æµ‹è¯•ä¾‹å­"></a>ç®€å•æµ‹è¯•ä¾‹å­</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FirstTest firstTest = <span class="keyword">new</span> FirstTest();</span><br><span class="line">        <span class="keyword">int</span> result = firstTest.add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//  assertEquals(4,result); </span></span><br><span class="line">        assertEquals(<span class="number">3</span>,result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">       - å¦‚æœåˆ¤æ–­ä¸ç›¸ç­‰çš„æ—¶å€™ï¼Œåå°æŠ¥é”™ä¿¡æ¯</span><br><span class="line">       - java.lang.AssertionError: </span><br><span class="line">       - Expected :<span class="number">4</span></span><br><span class="line">       - Actual   :<span class="number">3</span></span><br><span class="line">       - &lt;Click to see difference&gt;</span><br><span class="line">     --&gt;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™åªæ˜¯ç®€å•çš„ä¾‹å­ï¼Œå®é™…ä¸Šçš„å•å…ƒæµ‹è¯•è¦æ¯”è¿™ä¸ªå¤æ‚çš„å¤šï¼Œåœ¨å®é™…åº”ç”¨ä¸Šå•å…ƒæµ‹è¯•ååˆ†æœ‰å¿…è¦ï¼Œç¼–å†™åå°ä»£ç æ—¶èƒ½å¤Ÿå°½å¿«æ£€éªŒä»£ç çš„æ­£ç¡®æ€§ã€‚</p><h3 id="Assertions-æ–­è¨€"><a href="#Assertions-æ–­è¨€" class="headerlink" title="Assertions æ–­è¨€"></a>Assertions æ–­è¨€</h3><p>Junitæä¾›äº†æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒObjectç±»å’Œæ•°ç»„çš„æ–­è¨€ï¼Œå‚æ•°æ˜¯ é¢„æœŸå€¼åé¢æ˜¯å®é™…å€¼ï¼Œå¯é€‰é¡¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯æ–­è¨€å¤±è´¥æ—¶è¾“å‡ºçš„å†…å®¹ï¼Œä¸å…¶ä»–æ–­è¨€ç¨æœ‰ä¸åŒçš„æ˜¯ï¼ŒAssertThatçš„å‚æ•°æ˜¯ å¤±è´¥è¾“å‡ºçš„å†…å®¹ï¼Œå®é™…å€¼å’Œä¸€ä¸ªMatcher<br>Objectã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AssertTests</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertArrayEquals</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span>[] expected = <span class="string">"trial"</span>.getBytes();</span><br><span class="line">    <span class="keyword">byte</span>[] actual = <span class="string">"trial"</span>.getBytes();</span><br><span class="line">    assertArrayEquals(<span class="string">"failure - byte arrays not same"</span>, expected, actual);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertEquals</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertEquals(<span class="string">"failure - strings are not equal"</span>, <span class="string">"text"</span>, <span class="string">"text"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertFalse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertFalse(<span class="string">"failure - should be false"</span>, <span class="keyword">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertNotNull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertNotNull(<span class="string">"should not be null"</span>, <span class="keyword">new</span> Object());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertNotSame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertNotSame(<span class="string">"should not be same Object"</span>, <span class="keyword">new</span> Object(), <span class="keyword">new</span> Object());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertNull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertNull(<span class="string">"should be null"</span>, <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertSame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Integer aNumber = Integer.valueOf(<span class="number">768</span>);</span><br><span class="line">    assertSame(<span class="string">"should be same"</span>, aNumber, aNumber);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// JUnit Matchers assertThat</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatBothContainsString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThat(<span class="string">"albumen"</span>, both(containsString(<span class="string">"a"</span>)).and(containsString(<span class="string">"b"</span>)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatHasItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThat(Arrays.asList(<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>), hasItems(<span class="string">"one"</span>, <span class="string">"three"</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatEveryItemContainsString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThat(Arrays.asList(<span class="keyword">new</span> String[] &#123; <span class="string">"fun"</span>, <span class="string">"ban"</span>, <span class="string">"net"</span> &#125;), everyItem(containsString(<span class="string">"n"</span>)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Core Hamcrest Matchers with assertThat</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatHamcrestCoreMatchers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThat(<span class="string">"good"</span>, allOf(equalTo(<span class="string">"good"</span>), startsWith(<span class="string">"good"</span>)));</span><br><span class="line">    assertThat(<span class="string">"good"</span>, not(allOf(equalTo(<span class="string">"bad"</span>), equalTo(<span class="string">"good"</span>))));</span><br><span class="line">    assertThat(<span class="string">"good"</span>, anyOf(equalTo(<span class="string">"bad"</span>), equalTo(<span class="string">"good"</span>)));</span><br><span class="line">    assertThat(<span class="number">7</span>, not(CombinableMatcher.&lt;Integer&gt; either(equalTo(<span class="number">3</span>)).or(equalTo(<span class="number">4</span>))));</span><br><span class="line">    assertThat(<span class="keyword">new</span> Object(), not(sameInstance(<span class="keyword">new</span> Object())));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertTrue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertTrue(<span class="string">"failure - should be true"</span>, <span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼‚å¸¸æµ‹è¯•"><a href="#å¼‚å¸¸æµ‹è¯•" class="headerlink" title="å¼‚å¸¸æµ‹è¯•"></a>å¼‚å¸¸æµ‹è¯•</h3><p>ä¸‹é¢åˆ†ä¸ºä¸¤ç§æ–¹å¼æ¥å®Œæˆå¯¹å¼‚å¸¸çš„æµ‹è¯•</p><h4 id="æœŸå¾…çš„å¼‚å¸¸"><a href="#æœŸå¾…çš„å¼‚å¸¸" class="headerlink" title="æœŸå¾…çš„å¼‚å¸¸"></a>æœŸå¾…çš„å¼‚å¸¸</h4><p>å¦‚ä½•æ£€æµ‹ç¨‹åºæ˜¯å¦å¦‚æœŸçš„æŠ›å‡ºå¼‚å¸¸ï¼Œjunitå¯ä»¥ä½¿ç”¨æ³¨è§£çš„å‚æ•°æ¥å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>(expected = IndexOutOfBoundsException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testException</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">new</span> ArrayList&lt;Integer&gt;().get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·±å…¥çš„å¼‚å¸¸"><a href="#æ·±å…¥çš„å¼‚å¸¸" class="headerlink" title="æ·±å…¥çš„å¼‚å¸¸"></a>æ·±å…¥çš„å¼‚å¸¸</h4><p>ä¸Šè¿°æ–¹æ³•å¯¹äºç®€å•çš„æƒ…å†µå¾ˆæœ‰ç”¨ï¼Œä½†å®ƒæœ‰å…¶å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œæ‚¨æ— æ³•åœ¨å¼‚å¸¸ä¸­æµ‹è¯•æ¶ˆæ¯çš„å€¼ï¼Œä¹Ÿæ— æ³•åœ¨æŠ›å‡ºå¼‚å¸¸åæµ‹è¯•åŸŸå¯¹è±¡çš„çŠ¶æ€</p><ul><li>try/catch è¯­å¥</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTryCatch</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> ArrayList&lt;Integer&gt;().get(<span class="number">0</span>);</span><br><span class="line">        fail(<span class="string">"å¤±è´¥ä¿¡æ¯"</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (IndexOutOfBoundsException indexOutOfBoundsExecption)&#123;</span><br><span class="line">          assertThat(indexOutOfBoundsExecption.getMessage(), is(<span class="string">"Index: 0, Size: 0"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>rule è§„åˆ™</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Rule</span></span><br><span class="line"><span class="keyword">public</span> ExpectedException thrown = ExpectedException.none();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testExpectException</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line">    thrown.expect(IndexOutOfBoundsException.class);</span><br><span class="line">    thrown.expectMessage(<span class="string">"Index: 0, Size: 0"</span>);</span><br><span class="line">    list.get(<span class="number">0</span>); <span class="comment">// execution will never get past this line</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Matchers-and-assertThat-åŒ¹é…å™¨å’ŒassertThat"><a href="#Matchers-and-assertThat-åŒ¹é…å™¨å’ŒassertThat" class="headerlink" title="Matchers and assertThat [ åŒ¹é…å™¨å’ŒassertThat ]"></a>Matchers and assertThat [ åŒ¹é…å™¨å’ŒassertThat ]</h3><p>æ–°åŠ å…¥äº†<code>assertThat</code>æ–­è¨€æœºåˆ¶ assertThat([value], [matcher statement]);</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">assertThat(x, is(<span class="number">3</span>));</span><br><span class="line">assertThat(x, is(not(<span class="number">4</span>)));</span><br><span class="line">assertThat(responseString, either(containsString(<span class="string">"color"</span>)).or(containsString(<span class="string">"colour"</span>)));</span><br><span class="line">assertThat(myList, hasItem(<span class="string">"3"</span>));</span><br></pre></td></tr></table></figure><p><code>assertThat</code> æ›´å…·æœ‰å¯è¯»æ€§å’Œå¯è¾“å…¥æ€§ï¼Œå¹¶ä¸”æœ‰ç»„åˆæ€§ï¼Œå°±åƒ <code>is(not(4))</code> ä»»ä½•Macherséƒ½å¯ä»¥ç»„åˆèµ·æ¥ä½¿ç”¨</p><p>ä»¥å‰çš„assertEqualsç­‰ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ï¼Œ<code>assertThat</code> åœ¨ä½¿ç”¨Matchersçš„æ—¶å€™éœ€è¦ä½¿ç”¨ <code>import static org.hamcrest.CoreMatchers.*;</code>æ¥å¼•ç”¨ã€‚é‡Œé¢çš„æ–¹æ³•éå¸¸å¤šã€‚ã€‚</p><h2 id="junitæºç è·Ÿè¯»"><a href="#junitæºç è·Ÿè¯»" class="headerlink" title="junitæºç è·Ÿè¯»"></a>junitæºç è·Ÿè¯»</h2><h3 id="ä½¿ç”¨junitæµç¨‹"><a href="#ä½¿ç”¨junitæµç¨‹" class="headerlink" title="ä½¿ç”¨junitæµç¨‹"></a>ä½¿ç”¨junitæµç¨‹</h3><h4 id="ä½¿ç”¨ç»§æ‰¿è‡ªTestCaseç±»"><a href="#ä½¿ç”¨ç»§æ‰¿è‡ªTestCaseç±»" class="headerlink" title="ä½¿ç”¨ç»§æ‰¿è‡ªTestCaseç±»"></a>ä½¿ç”¨ç»§æ‰¿è‡ªTestCaseç±»</h4><p>ä¸‹é¢é€šè¿‡è¿è¡Œjunitçš„è‡ªå¸¦çš„testï¼Œæºç¨‹åºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Some simple tests.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> fValue1;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> fValue2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        fValue1 = <span class="number">2</span>;</span><br><span class="line">        fValue2 = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Test <span class="title">suite</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           * the type safe way</span></span><br><span class="line"><span class="comment">           *</span></span><br><span class="line"><span class="comment">          TestSuite suite= new TestSuite();</span></span><br><span class="line"><span class="comment">          suite.addTest(</span></span><br><span class="line"><span class="comment">              new SimpleTest("add") &#123;</span></span><br><span class="line"><span class="comment">                   protected void runTest() &#123; testAdd(); &#125;</span></span><br><span class="line"><span class="comment">              &#125;</span></span><br><span class="line"><span class="comment">          );</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          suite.addTest(</span></span><br><span class="line"><span class="comment">              new SimpleTest("testDivideByZero") &#123;</span></span><br><span class="line"><span class="comment">                   protected void runTest() &#123; testDivideByZero(); &#125;</span></span><br><span class="line"><span class="comment">              &#125;</span></span><br><span class="line"><span class="comment">          );</span></span><br><span class="line"><span class="comment">          return suite;</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * the dynamic way</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TestSuite(SimpleTest.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> result = fValue1 + fValue2;</span><br><span class="line">        <span class="comment">// forced failure result == 5</span></span><br><span class="line">        assertTrue(result == <span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> unused;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDivideByZero</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> zero = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">8</span> / zero;</span><br><span class="line">        unused = result; <span class="comment">// avoid warning for not using result</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testEquals</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertEquals(<span class="number">12</span>, <span class="number">12</span>);</span><br><span class="line">        assertEquals(<span class="number">12L</span>, <span class="number">12L</span>);</span><br><span class="line">        assertEquals(<span class="keyword">new</span> Long(<span class="number">12</span>), <span class="keyword">new</span> Long(<span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        assertEquals(<span class="string">"Size"</span>, <span class="number">12</span>, <span class="number">13</span>);</span><br><span class="line">        assertEquals(<span class="string">"Capacity"</span>, <span class="number">12.0</span>, <span class="number">11.99</span>, <span class="number">0.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        junit.textui.TestRunner.run(suite());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹mainæ–¹æ³•ï¼Œä½¿ç”¨ <code>junit.textui.TestRunner.run(suite());</code> ä½¿ç”¨TestRunnerè¿è¡Œtestã€‚é¦–å…ˆå…ˆæ¥çœ‹suiteæ–¹æ³•ï¼Œæœ‰ä¸¤ç§æ–¹æ³•</p><ol><li>é™æ€çš„,éœ€è¦æ‰‹åŠ¨åœ¨testSuiteä¸­æ·»åŠ testã€‚</li><li>åŠ¨æ€çš„ï¼Œé™æ€éœ€è¦å®ç°TestCaseçš„runTestæ–¹æ³•ã€‚è€ŒåŠ¨æ€çš„åªéœ€è¦è¿”å› TestSuite(SimpleTest.class);ï¼Œä¸‹é¢æ¥çœ‹è¿™ä¸ªTestSuiteç±»</li></ol><p>testSuiteå®é™…ä¸Šå°±æ˜¯è¿è¡Œtestçš„é›†åˆï¼Œä½¿ç”¨vectoræ¥å­˜å‚¨test,å…¶ä¸­è¿™é‡Œä½¿ç”¨åˆ°çš„TestSuiteæ„é€ æ–¹æ³•æ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TestSuite</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; theClass)</span> </span>&#123;</span><br><span class="line">        addTestsFromTestCase(theClass);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addTestsFromTestCase</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; theClass)</span> </span>&#123;</span><br><span class="line">        fName = theClass.getName();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            getTestConstructor(theClass); <span class="comment">// Avoid generating multiple error messages</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            addTest(warning(<span class="string">"Class "</span> + theClass.getName() + <span class="string">" has no public constructor TestCase(String name) or TestCase()"</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// è¿™ä¸ªç±»æ˜¯å¦æ˜¯publicçš„ å¦‚æœä¸æ˜¯ å‘å‡ºwarning ï¼Œå¹¶ä¸”fail(message)</span></span><br><span class="line">        <span class="keyword">if</span> (!Modifier.isPublic(theClass.getModifiers())) &#123;</span><br><span class="line">            addTest(warning(<span class="string">"Class "</span> + theClass.getName() + <span class="string">" is not public"</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; superClass = theClass;</span><br><span class="line">        List&lt;String&gt; names = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"><span class="comment">//        è¿™å¥è¯è¯´æ˜çš„æ˜¯å¦‚æœè¿™ä¸ªç±»æ˜¯superClassçš„è¶…ç±»ï¼Œæˆ–è€…æ¥å£å°±è¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line">        <span class="keyword">while</span> (Test.class.isAssignableFrom(superClass)) &#123;</span><br><span class="line"><span class="comment">//            å¦‚æœæ˜¯true  æœ‰é¡ºåºçš„è¿”å›å£°æ˜çš„æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">for</span> (Method each : MethodSorter.getDeclaredMethods(superClass)) &#123;</span><br><span class="line">                addTestMethod(each, names, theClass);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            è·å¾—superclassç±»ï¼Œé€’å½’çš„æŸ¥æ‰¾testæ–¹æ³•</span></span><br><span class="line">            superClass = superClass.getSuperclass();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (fTests.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            addTest(warning(<span class="string">"No tests found in "</span> + theClass.getName()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æœ€åæåˆ°çš„ <code>fTests.size() == 0</code> è¿™é‡Œä¼šå‘ç”Ÿwarning ç„¶åfailã€‚è¿™ä¸ªfTests å·²ç»å†å‰é¢å£°æ˜<br>äº†ï¼Œå£°æ˜æ–¹æ³•æ˜¯ï¼š<code>private Vector&lt;Test&gt; fTests = new Vector&lt;Test&gt;(10);</code> </p><p>åœ¨å¯¹æ¯ä¸ªå£°æ˜çš„æ–¹æ³•å¾ªç¯çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ° <code>addTestMethod</code> æ–¹æ³•ï¼Œæ¥å¯¹æ¯ä¸ªæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addTestMethod</span><span class="params">(Method m, List&lt;String&gt; names, Class&lt;?&gt; theClass)</span> </span>&#123;</span><br><span class="line"><span class="comment">// è·å¾—æ–¹æ³•åå¦‚æœlistæ•°ç»„ä¸­å·²ç»åŒ…å«è¿™ä¸ªæ–¹æ³•åï¼Œå°±ç›´æ¥é€€å‡º</span></span><br><span class="line">        String name = m.getName();</span><br><span class="line">        <span class="keyword">if</span> (names.contains(name)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!isPublicTestMethod(m)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isTestMethod(m)) &#123;</span><br><span class="line">                addTest(warning(<span class="string">"Test method isn't public: "</span> + m.getName() + <span class="string">"("</span> + theClass.getCanonicalName() + <span class="string">")"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// æŠŠè¿™ä¸ªæ–¹æ³•ååŠ å…¥åˆ°names Listä¸­</span></span><br><span class="line">        names.add(name);</span><br><span class="line">        addTest(createTest(theClass, name));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//å†æ¥çœ‹å¤–å±‚çš„addTestæ–¹æ³• æŠŠæ‹¥æœ‰çš„testæ–¹æ³•æ”¾åˆ°fTestsä¸­ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTest</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">        fTests.add(test);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨createTestæ¥é’ˆå¯¹testæ–¹æ³•åˆ›å»ºä¸€ä¸ªTestç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> Test <span class="title">createTest</span><span class="params">(Class&lt;?&gt; theClass, String name)</span> </span>&#123;</span><br><span class="line">        Constructor&lt;?&gt; constructor;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            constructor = getTestConstructor(theClass);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> warning(<span class="string">"Class "</span> + theClass.getName() + <span class="string">" has no public constructor TestCase(String name) or TestCase()"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Object test;</span><br><span class="line"><span class="comment">// é€šè¿‡åå°„æ–¹å¼è·å¾—æ–¹æ³•çš„testå®ä¾‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (constructor.getParameterTypes().length == <span class="number">0</span>) &#123;</span><br><span class="line">                test = constructor.newInstance(<span class="keyword">new</span> Object[<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">if</span> (test <span class="keyword">instanceof</span> TestCase) &#123;</span><br><span class="line">                    ((TestCase) test).setName(name);<span class="comment">//å¦‚æœç»§æ‰¿TestCase</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                test = constructor.newInstance(<span class="keyword">new</span> Object[]&#123;name&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> (warning(<span class="string">"Cannot instantiate test case: "</span> + name + <span class="string">" ("</span> + Throwables.getStacktrace(e) + <span class="string">")"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> (warning(<span class="string">"Exception in constructor: "</span> + name + <span class="string">" ("</span> + Throwables.getStacktrace(e.getTargetException()) + <span class="string">")"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> (warning(<span class="string">"Cannot access test case: "</span> + name + <span class="string">" ("</span> + Throwables.getStacktrace(e) + <span class="string">")"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (Test) test;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤è·å¾—äº†è¿™ä¸ªç±»ä¸­åŠå…¶çˆ¶ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•çš„Testã€‚</p><p>ä½¿ç”¨testRunner.runè¿è¡Œtest</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        junit.textui.TestRunner.run(suite());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨TestRunnerçš„runçš„é™æ€æ–¹æ³• è¿”å›ä¸€ä¸ªTestResultç”¨æ¥è¿”å›ç»“æœã€‚   </span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> TestResult <span class="title">run</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">        TestRunner runner = <span class="keyword">new</span> TestRunner();</span><br><span class="line">        <span class="keyword">return</span> runner.doRun(test);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨runnerçš„doRunæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TestResult <span class="title">doRun</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> doRun(test, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> TestResult <span class="title">doRun</span><span class="params">(Test suite, <span class="keyword">boolean</span> wait)</span> </span>&#123;</span><br><span class="line"><span class="comment">//      ç”¨æ¥è¿”å›ç»“æœçš„TestResult</span></span><br><span class="line">        TestResult result = createTestResult();</span><br><span class="line"><span class="comment">// æ³¨å†Œä¸€ä¸ªTestListener</span></span><br><span class="line">        result.addListener(fPrinter);</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line"><span class="comment">//      test.runæ–¹æ³•</span></span><br><span class="line">        suite.run(result);</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">long</span> runTime = endTime - startTime;</span><br><span class="line">        fPrinter.print(result, runTime);</span><br><span class="line">        pause(wait);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿è¡ŒTestçš„æ ¸å¿ƒæ–¹æ³• è¿”å›TestResultè¿”å›ç»“æœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates the TestResult to be used for the test run.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> TestResult <span class="title">createTestResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TestResult();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">addListener</span><span class="params">(TestListener listener)</span> </span>&#123;</span><br><span class="line"><span class="comment">// protected List&lt;TestListener&gt; fListeners;</span></span><br><span class="line">        fListeners.add(listener);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// suite.run() fTestsä¸­çš„æ¯ä¸€ä¸ªtest </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(TestResult result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Test each : fTests) &#123;</span><br><span class="line">            <span class="keyword">if</span> (result.shouldStop()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            runTest(each, result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Runs the test case and collects the results in TestResult.</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨testResultçš„runæ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(TestResult result)</span> </span>&#123;</span><br><span class="line">    result.run(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿è¡Œtest</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">final</span> TestCase test)</span> </span>&#123;</span><br><span class="line">        startTest(test);</span><br><span class="line">        Protectable p = <span class="keyword">new</span> Protectable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">protect</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                test.runBare();<span class="comment">//æ‰§è¡ŒrunBareæ–¹æ³•æ‰§è¡Œtestç”¨ä¾‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        runProtected(test, p);</span><br><span class="line"></span><br><span class="line">        endTest(test);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startTest</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> count = test.countTestCases();</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            fRunTests += count;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (TestListener each : cloneListeners()) &#123;</span><br><span class="line">            each.startTest(test);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨resultPriterä¸­ä½¿ç”¨ç»§æ‰¿TestListenerä¸­çš„startTestæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startTest</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">        getWriter().print(<span class="string">"."</span>);<span class="comment">//è¿è¡Œä¸€ä¸ªåˆ™åŠ ä¸€ä¸ªç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (fColumn++ &gt;= <span class="number">40</span>) &#123;</span><br><span class="line">            getWriter().println();</span><br><span class="line">            fColumn = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œä¸€ä¸ªç©ºçš„æµ‹è¯•åºåˆ—</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runBare</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Throwable exception = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">// è®¾ç½®è£…ç½®ã€‚æ¯”å¦‚æ‰“å¼€ç½‘ç»œè¿æ¥ç­‰ï¼Œåœ¨æ‰§è¡Œæµ‹è¯•ä¹‹å‰è°ƒç”¨æ–¹æ³•ã€‚</span></span><br><span class="line">        setUp();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// çœ‹ä¸‹é¢çš„runTestæ–¹æ³• </span></span><br><span class="line">            runTest();<span class="comment">//æ‰§è¡Œtest</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable running) &#123;</span><br><span class="line">            exception = running;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                tearDown();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable tearingDown) &#123;</span><br><span class="line">                <span class="keyword">if</span> (exception == <span class="keyword">null</span>) exception = tearingDown;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (exception != <span class="keyword">null</span>) <span class="keyword">throw</span> exception;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">runTest</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        assertNotNull(<span class="string">"TestCase.fName cannot be null"</span>, fName); <span class="comment">// Some VMs crash when calling getMethod(null,null);</span></span><br><span class="line">        Method runMethod = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            runMethod = getClass().getMethod(fName, (Class[]) <span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            fail(<span class="string">"Method \""</span> + fName + <span class="string">"\" not found"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// .......... runMethod.invoke(this); æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">            runMethod.invoke(<span class="keyword">this</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ–¹æ³•æ‰§è¡Œé”™è¯¯ï¼Œä¼šè§¦å‘è¿™ä¸ªå¼‚å¸¸ ä¼šè¿ç»­è¢«ä¸Šå±‚æ•æ‰åˆ°</span></span><br><span class="line">            e.fillInStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> e.getTargetException();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.fillInStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œåˆ™æœ€ç»ˆå°†è¢«runProtectedä¸­çš„try/catchæ•æ‰åˆ°åè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runProtected</span><span class="params">(<span class="keyword">final</span> Test test, Protectable p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        p.protect();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (AssertionFailedError e) &#123;</span><br><span class="line">    <span class="comment">// éªŒè¯å¤±è´¥ï¼Œæ·»åŠ ä¸€æ¡å¤±è´¥ä¿¡æ¯</span></span><br><span class="line">        addFailure(test, e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ThreadDeath e) &#123; <span class="comment">// don't catch ThreadDeath by accident</span></span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        addError(test, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤æ‰§è¡Œå®Œä¸€ä¸ªtestã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Junitçš„ä½¿ç”¨å’Œæºç åˆ†æ</title>
      <link href="/2018/10/29/2018-10-28-Junit4/"/>
      <url>/2018/10/29/2018-10-28-Junit4/</url>
      
        <content type="html"><![CDATA[<h1 id="Junitçš„ä½¿ç”¨å’Œæºç åˆ†æ"><a href="#Junitçš„ä½¿ç”¨å’Œæºç åˆ†æ" class="headerlink" title="Junitçš„ä½¿ç”¨å’Œæºç åˆ†æ"></a>Junitçš„ä½¿ç”¨å’Œæºç åˆ†æ</h1><p>Junitæ˜¯ä¸€ä¸ªç¼–å†™å¯é‡å¤æµ‹è¯•çš„Javaæµ‹è¯•æ¡†æ¶ï¼Œä»£ç ç¼–å†™éå¸¸æœ‰æŠ€å·§æ€§ï¼Œå€¼å¾—åå¤é˜…è¯»ã€‚</p><h2 id="è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ Junit"><a href="#è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ Junit" class="headerlink" title="è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ Junit"></a>è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ Junit</h2><p>å®˜æ–¹æ–‡æ¡£å¾€å¾€æ˜¯å­¦ä¹ æœ€å¥½çš„èµ„æ–™ã€‚</p><h3 id="ç®€å•æµ‹è¯•ä¾‹å­"><a href="#ç®€å•æµ‹è¯•ä¾‹å­" class="headerlink" title="ç®€å•æµ‹è¯•ä¾‹å­"></a>ç®€å•æµ‹è¯•ä¾‹å­</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FirstTest firstTest = <span class="keyword">new</span> FirstTest();</span><br><span class="line">        <span class="keyword">int</span> result = firstTest.add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//  assertEquals(4,result); </span></span><br><span class="line">        assertEquals(<span class="number">3</span>,result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">       - å¦‚æœåˆ¤æ–­ä¸ç›¸ç­‰çš„æ—¶å€™ï¼Œåå°æŠ¥é”™ä¿¡æ¯</span><br><span class="line">       - java.lang.AssertionError: </span><br><span class="line">       - Expected :<span class="number">4</span></span><br><span class="line">       - Actual   :<span class="number">3</span></span><br><span class="line">       - &lt;Click to see difference&gt;</span><br><span class="line">     --&gt;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™åªæ˜¯ç®€å•çš„ä¾‹å­ï¼Œå®é™…ä¸Šçš„å•å…ƒæµ‹è¯•è¦æ¯”è¿™ä¸ªå¤æ‚çš„å¤šï¼Œåœ¨å®é™…åº”ç”¨ä¸Šå•å…ƒæµ‹è¯•ååˆ†æœ‰å¿…è¦ï¼Œç¼–å†™åå°ä»£ç æ—¶èƒ½å¤Ÿå°½å¿«æ£€éªŒä»£ç çš„æ­£ç¡®æ€§ã€‚</p><h3 id="Assertions-æ–­è¨€"><a href="#Assertions-æ–­è¨€" class="headerlink" title="Assertions æ–­è¨€"></a>Assertions æ–­è¨€</h3><p>Junitæä¾›äº†æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒObjectç±»å’Œæ•°ç»„çš„æ–­è¨€ï¼Œå‚æ•°æ˜¯ é¢„æœŸå€¼åé¢æ˜¯å®é™…å€¼ï¼Œå¯é€‰é¡¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯æ–­è¨€å¤±è´¥æ—¶è¾“å‡ºçš„å†…å®¹ï¼Œä¸å…¶ä»–æ–­è¨€ç¨æœ‰ä¸åŒçš„æ˜¯ï¼ŒAssertThatçš„å‚æ•°æ˜¯ å¤±è´¥è¾“å‡ºçš„å†…å®¹ï¼Œå®é™…å€¼å’Œä¸€ä¸ªMatcher<br>Objectã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AssertTests</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertArrayEquals</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span>[] expected = <span class="string">"trial"</span>.getBytes();</span><br><span class="line">    <span class="keyword">byte</span>[] actual = <span class="string">"trial"</span>.getBytes();</span><br><span class="line">    assertArrayEquals(<span class="string">"failure - byte arrays not same"</span>, expected, actual);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertEquals</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertEquals(<span class="string">"failure - strings are not equal"</span>, <span class="string">"text"</span>, <span class="string">"text"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertFalse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertFalse(<span class="string">"failure - should be false"</span>, <span class="keyword">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertNotNull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertNotNull(<span class="string">"should not be null"</span>, <span class="keyword">new</span> Object());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertNotSame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertNotSame(<span class="string">"should not be same Object"</span>, <span class="keyword">new</span> Object(), <span class="keyword">new</span> Object());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertNull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertNull(<span class="string">"should be null"</span>, <span class="keyword">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertSame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Integer aNumber = Integer.valueOf(<span class="number">768</span>);</span><br><span class="line">    assertSame(<span class="string">"should be same"</span>, aNumber, aNumber);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// JUnit Matchers assertThat</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatBothContainsString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThat(<span class="string">"albumen"</span>, both(containsString(<span class="string">"a"</span>)).and(containsString(<span class="string">"b"</span>)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatHasItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThat(Arrays.asList(<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>), hasItems(<span class="string">"one"</span>, <span class="string">"three"</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatEveryItemContainsString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThat(Arrays.asList(<span class="keyword">new</span> String[] &#123; <span class="string">"fun"</span>, <span class="string">"ban"</span>, <span class="string">"net"</span> &#125;), everyItem(containsString(<span class="string">"n"</span>)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Core Hamcrest Matchers with assertThat</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatHamcrestCoreMatchers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertThat(<span class="string">"good"</span>, allOf(equalTo(<span class="string">"good"</span>), startsWith(<span class="string">"good"</span>)));</span><br><span class="line">    assertThat(<span class="string">"good"</span>, not(allOf(equalTo(<span class="string">"bad"</span>), equalTo(<span class="string">"good"</span>))));</span><br><span class="line">    assertThat(<span class="string">"good"</span>, anyOf(equalTo(<span class="string">"bad"</span>), equalTo(<span class="string">"good"</span>)));</span><br><span class="line">    assertThat(<span class="number">7</span>, not(CombinableMatcher.&lt;Integer&gt; either(equalTo(<span class="number">3</span>)).or(equalTo(<span class="number">4</span>))));</span><br><span class="line">    assertThat(<span class="keyword">new</span> Object(), not(sameInstance(<span class="keyword">new</span> Object())));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertTrue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertTrue(<span class="string">"failure - should be true"</span>, <span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼‚å¸¸æµ‹è¯•"><a href="#å¼‚å¸¸æµ‹è¯•" class="headerlink" title="å¼‚å¸¸æµ‹è¯•"></a>å¼‚å¸¸æµ‹è¯•</h3><p>ä¸‹é¢åˆ†ä¸ºä¸¤ç§æ–¹å¼æ¥å®Œæˆå¯¹å¼‚å¸¸çš„æµ‹è¯•</p><h4 id="æœŸå¾…çš„å¼‚å¸¸"><a href="#æœŸå¾…çš„å¼‚å¸¸" class="headerlink" title="æœŸå¾…çš„å¼‚å¸¸"></a>æœŸå¾…çš„å¼‚å¸¸</h4><p>å¦‚ä½•æ£€æµ‹ç¨‹åºæ˜¯å¦å¦‚æœŸçš„æŠ›å‡ºå¼‚å¸¸ï¼Œjunitå¯ä»¥ä½¿ç”¨æ³¨è§£çš„å‚æ•°æ¥å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>(expected = IndexOutOfBoundsException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testException</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">new</span> ArrayList&lt;Integer&gt;().get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·±å…¥çš„å¼‚å¸¸"><a href="#æ·±å…¥çš„å¼‚å¸¸" class="headerlink" title="æ·±å…¥çš„å¼‚å¸¸"></a>æ·±å…¥çš„å¼‚å¸¸</h4><p>ä¸Šè¿°æ–¹æ³•å¯¹äºç®€å•çš„æƒ…å†µå¾ˆæœ‰ç”¨ï¼Œä½†å®ƒæœ‰å…¶å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œæ‚¨æ— æ³•åœ¨å¼‚å¸¸ä¸­æµ‹è¯•æ¶ˆæ¯çš„å€¼ï¼Œä¹Ÿæ— æ³•åœ¨æŠ›å‡ºå¼‚å¸¸åæµ‹è¯•åŸŸå¯¹è±¡çš„çŠ¶æ€</p><ul><li>try/catch è¯­å¥</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTryCatch</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> ArrayList&lt;Integer&gt;().get(<span class="number">0</span>);</span><br><span class="line">        fail(<span class="string">"å¤±è´¥ä¿¡æ¯"</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (IndexOutOfBoundsException indexOutOfBoundsExecption)&#123;</span><br><span class="line">          assertThat(indexOutOfBoundsExecption.getMessage(), is(<span class="string">"Index: 0, Size: 0"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>rule è§„åˆ™</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Rule</span></span><br><span class="line"><span class="keyword">public</span> ExpectedException thrown = ExpectedException.none();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testExpectException</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line">    thrown.expect(IndexOutOfBoundsException.class);</span><br><span class="line">    thrown.expectMessage(<span class="string">"Index: 0, Size: 0"</span>);</span><br><span class="line">    list.get(<span class="number">0</span>); <span class="comment">// execution will never get past this line</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Matchers-and-assertThat-åŒ¹é…å™¨å’ŒassertThat"><a href="#Matchers-and-assertThat-åŒ¹é…å™¨å’ŒassertThat" class="headerlink" title="Matchers and assertThat [ åŒ¹é…å™¨å’ŒassertThat ]"></a>Matchers and assertThat [ åŒ¹é…å™¨å’ŒassertThat ]</h3><p>æ–°åŠ å…¥äº†<code>assertThat</code>æ–­è¨€æœºåˆ¶ assertThat([value], [matcher statement]);</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">assertThat(x, is(<span class="number">3</span>));</span><br><span class="line">assertThat(x, is(not(<span class="number">4</span>)));</span><br><span class="line">assertThat(responseString, either(containsString(<span class="string">"color"</span>)).or(containsString(<span class="string">"colour"</span>)));</span><br><span class="line">assertThat(myList, hasItem(<span class="string">"3"</span>));</span><br></pre></td></tr></table></figure><p><code>assertThat</code> æ›´å…·æœ‰å¯è¯»æ€§å’Œå¯è¾“å…¥æ€§ï¼Œå¹¶ä¸”æœ‰ç»„åˆæ€§ï¼Œå°±åƒ <code>is(not(4))</code> ä»»ä½•Macherséƒ½å¯ä»¥ç»„åˆèµ·æ¥ä½¿ç”¨</p><p>ä»¥å‰çš„assertEqualsç­‰ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ï¼Œ<code>assertThat</code> åœ¨ä½¿ç”¨Matchersçš„æ—¶å€™éœ€è¦ä½¿ç”¨ <code>import static org.hamcrest.CoreMatchers.*;</code>æ¥å¼•ç”¨ã€‚é‡Œé¢çš„æ–¹æ³•éå¸¸å¤šã€‚ã€‚</p><h2 id="junitæºç è·Ÿè¯»"><a href="#junitæºç è·Ÿè¯»" class="headerlink" title="junitæºç è·Ÿè¯»"></a>junitæºç è·Ÿè¯»</h2><h3 id="ä½¿ç”¨junitæµç¨‹"><a href="#ä½¿ç”¨junitæµç¨‹" class="headerlink" title="ä½¿ç”¨junitæµç¨‹"></a>ä½¿ç”¨junitæµç¨‹</h3><h4 id="ä½¿ç”¨ç»§æ‰¿è‡ªTestCaseç±»"><a href="#ä½¿ç”¨ç»§æ‰¿è‡ªTestCaseç±»" class="headerlink" title="ä½¿ç”¨ç»§æ‰¿è‡ªTestCaseç±»"></a>ä½¿ç”¨ç»§æ‰¿è‡ªTestCaseç±»</h4><p>ä¸‹é¢é€šè¿‡è¿è¡Œjunitçš„è‡ªå¸¦çš„testï¼Œæºç¨‹åºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Some simple tests.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> fValue1;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> fValue2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        fValue1 = <span class="number">2</span>;</span><br><span class="line">        fValue2 = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Test <span class="title">suite</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           * the type safe way</span></span><br><span class="line"><span class="comment">           *</span></span><br><span class="line"><span class="comment">          TestSuite suite= new TestSuite();</span></span><br><span class="line"><span class="comment">          suite.addTest(</span></span><br><span class="line"><span class="comment">              new SimpleTest("add") &#123;</span></span><br><span class="line"><span class="comment">                   protected void runTest() &#123; testAdd(); &#125;</span></span><br><span class="line"><span class="comment">              &#125;</span></span><br><span class="line"><span class="comment">          );</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          suite.addTest(</span></span><br><span class="line"><span class="comment">              new SimpleTest("testDivideByZero") &#123;</span></span><br><span class="line"><span class="comment">                   protected void runTest() &#123; testDivideByZero(); &#125;</span></span><br><span class="line"><span class="comment">              &#125;</span></span><br><span class="line"><span class="comment">          );</span></span><br><span class="line"><span class="comment">          return suite;</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * the dynamic way</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TestSuite(SimpleTest.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> result = fValue1 + fValue2;</span><br><span class="line">        <span class="comment">// forced failure result == 5</span></span><br><span class="line">        assertTrue(result == <span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> unused;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDivideByZero</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> zero = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">8</span> / zero;</span><br><span class="line">        unused = result; <span class="comment">// avoid warning for not using result</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testEquals</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertEquals(<span class="number">12</span>, <span class="number">12</span>);</span><br><span class="line">        assertEquals(<span class="number">12L</span>, <span class="number">12L</span>);</span><br><span class="line">        assertEquals(<span class="keyword">new</span> Long(<span class="number">12</span>), <span class="keyword">new</span> Long(<span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        assertEquals(<span class="string">"Size"</span>, <span class="number">12</span>, <span class="number">13</span>);</span><br><span class="line">        assertEquals(<span class="string">"Capacity"</span>, <span class="number">12.0</span>, <span class="number">11.99</span>, <span class="number">0.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        junit.textui.TestRunner.run(suite());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹mainæ–¹æ³•ï¼Œä½¿ç”¨ <code>junit.textui.TestRunner.run(suite());</code> ä½¿ç”¨TestRunnerè¿è¡Œtestã€‚é¦–å…ˆå…ˆæ¥çœ‹suiteæ–¹æ³•ï¼Œæœ‰ä¸¤ç§æ–¹æ³•</p><ol><li>é™æ€çš„,éœ€è¦æ‰‹åŠ¨åœ¨testSuiteä¸­æ·»åŠ testã€‚</li><li>åŠ¨æ€çš„ï¼Œé™æ€éœ€è¦å®ç°TestCaseçš„runTestæ–¹æ³•ã€‚è€ŒåŠ¨æ€çš„åªéœ€è¦è¿”å› TestSuite(SimpleTest.class);ï¼Œä¸‹é¢æ¥çœ‹è¿™ä¸ªTestSuiteç±»</li></ol><p>testSuiteå®é™…ä¸Šå°±æ˜¯è¿è¡Œtestçš„é›†åˆï¼Œä½¿ç”¨vectoræ¥å­˜å‚¨test,å…¶ä¸­è¿™é‡Œä½¿ç”¨åˆ°çš„TestSuiteæ„é€ æ–¹æ³•æ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TestSuite</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; theClass)</span> </span>&#123;</span><br><span class="line">        addTestsFromTestCase(theClass);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addTestsFromTestCase</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; theClass)</span> </span>&#123;</span><br><span class="line">        fName = theClass.getName();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            getTestConstructor(theClass); <span class="comment">// Avoid generating multiple error messages</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            addTest(warning(<span class="string">"Class "</span> + theClass.getName() + <span class="string">" has no public constructor TestCase(String name) or TestCase()"</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// è¿™ä¸ªç±»æ˜¯å¦æ˜¯publicçš„ å¦‚æœä¸æ˜¯ å‘å‡ºwarning ï¼Œå¹¶ä¸”fail(message)</span></span><br><span class="line">        <span class="keyword">if</span> (!Modifier.isPublic(theClass.getModifiers())) &#123;</span><br><span class="line">            addTest(warning(<span class="string">"Class "</span> + theClass.getName() + <span class="string">" is not public"</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; superClass = theClass;</span><br><span class="line">        List&lt;String&gt; names = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"><span class="comment">//        è¿™å¥è¯è¯´æ˜çš„æ˜¯å¦‚æœè¿™ä¸ªç±»æ˜¯superClassçš„è¶…ç±»ï¼Œæˆ–è€…æ¥å£å°±è¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line">        <span class="keyword">while</span> (Test.class.isAssignableFrom(superClass)) &#123;</span><br><span class="line"><span class="comment">//            å¦‚æœæ˜¯true  æœ‰é¡ºåºçš„è¿”å›å£°æ˜çš„æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">for</span> (Method each : MethodSorter.getDeclaredMethods(superClass)) &#123;</span><br><span class="line">                addTestMethod(each, names, theClass);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            è·å¾—superclassç±»ï¼Œé€’å½’çš„æŸ¥æ‰¾testæ–¹æ³•</span></span><br><span class="line">            superClass = superClass.getSuperclass();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (fTests.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            addTest(warning(<span class="string">"No tests found in "</span> + theClass.getName()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æœ€åæåˆ°çš„ <code>fTests.size() == 0</code> è¿™é‡Œä¼šå‘ç”Ÿwarning ç„¶åfailã€‚è¿™ä¸ªfTests å·²ç»å†å‰é¢å£°æ˜<br>äº†ï¼Œå£°æ˜æ–¹æ³•æ˜¯ï¼š<code>private Vector&lt;Test&gt; fTests = new Vector&lt;Test&gt;(10);</code> </p><p>åœ¨å¯¹æ¯ä¸ªå£°æ˜çš„æ–¹æ³•å¾ªç¯çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ° <code>addTestMethod</code> æ–¹æ³•ï¼Œæ¥å¯¹æ¯ä¸ªæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addTestMethod</span><span class="params">(Method m, List&lt;String&gt; names, Class&lt;?&gt; theClass)</span> </span>&#123;</span><br><span class="line"><span class="comment">// è·å¾—æ–¹æ³•åå¦‚æœlistæ•°ç»„ä¸­å·²ç»åŒ…å«è¿™ä¸ªæ–¹æ³•åï¼Œå°±ç›´æ¥é€€å‡º</span></span><br><span class="line">        String name = m.getName();</span><br><span class="line">        <span class="keyword">if</span> (names.contains(name)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!isPublicTestMethod(m)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isTestMethod(m)) &#123;</span><br><span class="line">                addTest(warning(<span class="string">"Test method isn't public: "</span> + m.getName() + <span class="string">"("</span> + theClass.getCanonicalName() + <span class="string">")"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// æŠŠè¿™ä¸ªæ–¹æ³•ååŠ å…¥åˆ°names Listä¸­</span></span><br><span class="line">        names.add(name);</span><br><span class="line">        addTest(createTest(theClass, name));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//å†æ¥çœ‹å¤–å±‚çš„addTestæ–¹æ³• æŠŠæ‹¥æœ‰çš„testæ–¹æ³•æ”¾åˆ°fTestsä¸­ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTest</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">        fTests.add(test);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨createTestæ¥é’ˆå¯¹testæ–¹æ³•åˆ›å»ºä¸€ä¸ªTestç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> Test <span class="title">createTest</span><span class="params">(Class&lt;?&gt; theClass, String name)</span> </span>&#123;</span><br><span class="line">        Constructor&lt;?&gt; constructor;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            constructor = getTestConstructor(theClass);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> warning(<span class="string">"Class "</span> + theClass.getName() + <span class="string">" has no public constructor TestCase(String name) or TestCase()"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Object test;</span><br><span class="line"><span class="comment">// é€šè¿‡åå°„æ–¹å¼è·å¾—æ–¹æ³•çš„testå®ä¾‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (constructor.getParameterTypes().length == <span class="number">0</span>) &#123;</span><br><span class="line">                test = constructor.newInstance(<span class="keyword">new</span> Object[<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">if</span> (test <span class="keyword">instanceof</span> TestCase) &#123;</span><br><span class="line">                    ((TestCase) test).setName(name);<span class="comment">//å¦‚æœç»§æ‰¿TestCase</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                test = constructor.newInstance(<span class="keyword">new</span> Object[]&#123;name&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> (warning(<span class="string">"Cannot instantiate test case: "</span> + name + <span class="string">" ("</span> + Throwables.getStacktrace(e) + <span class="string">")"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> (warning(<span class="string">"Exception in constructor: "</span> + name + <span class="string">" ("</span> + Throwables.getStacktrace(e.getTargetException()) + <span class="string">")"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> (warning(<span class="string">"Cannot access test case: "</span> + name + <span class="string">" ("</span> + Throwables.getStacktrace(e) + <span class="string">")"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (Test) test;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤è·å¾—äº†è¿™ä¸ªç±»ä¸­åŠå…¶çˆ¶ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•çš„Testã€‚</p><p>ä½¿ç”¨testRunner.runè¿è¡Œtest</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        junit.textui.TestRunner.run(suite());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨TestRunnerçš„runçš„é™æ€æ–¹æ³• è¿”å›ä¸€ä¸ªTestResultç”¨æ¥è¿”å›ç»“æœã€‚   </span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> TestResult <span class="title">run</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">        TestRunner runner = <span class="keyword">new</span> TestRunner();</span><br><span class="line">        <span class="keyword">return</span> runner.doRun(test);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨runnerçš„doRunæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TestResult <span class="title">doRun</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> doRun(test, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> TestResult <span class="title">doRun</span><span class="params">(Test suite, <span class="keyword">boolean</span> wait)</span> </span>&#123;</span><br><span class="line"><span class="comment">//      ç”¨æ¥è¿”å›ç»“æœçš„TestResult</span></span><br><span class="line">        TestResult result = createTestResult();</span><br><span class="line"><span class="comment">// æ³¨å†Œä¸€ä¸ªTestListener</span></span><br><span class="line">        result.addListener(fPrinter);</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line"><span class="comment">//      test.runæ–¹æ³•</span></span><br><span class="line">        suite.run(result);</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">long</span> runTime = endTime - startTime;</span><br><span class="line">        fPrinter.print(result, runTime);</span><br><span class="line">        pause(wait);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿è¡ŒTestçš„æ ¸å¿ƒæ–¹æ³• è¿”å›TestResultè¿”å›ç»“æœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates the TestResult to be used for the test run.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> TestResult <span class="title">createTestResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TestResult();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">addListener</span><span class="params">(TestListener listener)</span> </span>&#123;</span><br><span class="line"><span class="comment">// protected List&lt;TestListener&gt; fListeners;</span></span><br><span class="line">        fListeners.add(listener);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// suite.run() fTestsä¸­çš„æ¯ä¸€ä¸ªtest </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(TestResult result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Test each : fTests) &#123;</span><br><span class="line">            <span class="keyword">if</span> (result.shouldStop()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            runTest(each, result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Runs the test case and collects the results in TestResult.</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨testResultçš„runæ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(TestResult result)</span> </span>&#123;</span><br><span class="line">    result.run(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿è¡Œtest</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">final</span> TestCase test)</span> </span>&#123;</span><br><span class="line">        startTest(test);</span><br><span class="line">        Protectable p = <span class="keyword">new</span> Protectable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">protect</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                test.runBare();<span class="comment">//æ‰§è¡ŒrunBareæ–¹æ³•æ‰§è¡Œtestç”¨ä¾‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        runProtected(test, p);</span><br><span class="line"></span><br><span class="line">        endTest(test);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startTest</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> count = test.countTestCases();</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            fRunTests += count;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (TestListener each : cloneListeners()) &#123;</span><br><span class="line">            each.startTest(test);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨resultPriterä¸­ä½¿ç”¨ç»§æ‰¿TestListenerä¸­çš„startTestæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startTest</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">        getWriter().print(<span class="string">"."</span>);<span class="comment">//è¿è¡Œä¸€ä¸ªåˆ™åŠ ä¸€ä¸ªç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (fColumn++ &gt;= <span class="number">40</span>) &#123;</span><br><span class="line">            getWriter().println();</span><br><span class="line">            fColumn = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œä¸€ä¸ªç©ºçš„æµ‹è¯•åºåˆ—</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runBare</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Throwable exception = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">// è®¾ç½®è£…ç½®ã€‚æ¯”å¦‚æ‰“å¼€ç½‘ç»œè¿æ¥ç­‰ï¼Œåœ¨æ‰§è¡Œæµ‹è¯•ä¹‹å‰è°ƒç”¨æ–¹æ³•ã€‚</span></span><br><span class="line">        setUp();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// çœ‹ä¸‹é¢çš„runTestæ–¹æ³• </span></span><br><span class="line">            runTest();<span class="comment">//æ‰§è¡Œtest</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable running) &#123;</span><br><span class="line">            exception = running;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                tearDown();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable tearingDown) &#123;</span><br><span class="line">                <span class="keyword">if</span> (exception == <span class="keyword">null</span>) exception = tearingDown;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (exception != <span class="keyword">null</span>) <span class="keyword">throw</span> exception;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">runTest</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        assertNotNull(<span class="string">"TestCase.fName cannot be null"</span>, fName); <span class="comment">// Some VMs crash when calling getMethod(null,null);</span></span><br><span class="line">        Method runMethod = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            runMethod = getClass().getMethod(fName, (Class[]) <span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            fail(<span class="string">"Method \""</span> + fName + <span class="string">"\" not found"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// .......... runMethod.invoke(this); æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">            runMethod.invoke(<span class="keyword">this</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ–¹æ³•æ‰§è¡Œé”™è¯¯ï¼Œä¼šè§¦å‘è¿™ä¸ªå¼‚å¸¸ ä¼šè¿ç»­è¢«ä¸Šå±‚æ•æ‰åˆ°</span></span><br><span class="line">            e.fillInStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> e.getTargetException();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.fillInStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œåˆ™æœ€ç»ˆå°†è¢«runProtectedä¸­çš„try/catchæ•æ‰åˆ°åè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runProtected</span><span class="params">(<span class="keyword">final</span> Test test, Protectable p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        p.protect();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (AssertionFailedError e) &#123;</span><br><span class="line">    <span class="comment">// éªŒè¯å¤±è´¥ï¼Œæ·»åŠ ä¸€æ¡å¤±è´¥ä¿¡æ¯</span></span><br><span class="line">        addFailure(test, e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ThreadDeath e) &#123; <span class="comment">// don't catch ThreadDeath by accident</span></span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        addError(test, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤æ‰§è¡Œå®Œä¸€ä¸ªtestã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¸­Dequeå’ŒArrayDeque</title>
      <link href="/2018/10/26/2018-10-24-Java%E4%B8%ADDeque%E5%8F%8A%E5%85%B6%E5%AD%90%E7%B1%BB/"/>
      <url>/2018/10/26/2018-10-24-Java%E4%B8%ADDeque%E5%8F%8A%E5%85%B6%E5%AD%90%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaä¸­Dequeå’ŒArrayDeque"><a href="#Javaä¸­Dequeå’ŒArrayDeque" class="headerlink" title="Javaä¸­Dequeå’ŒArrayDeque"></a>Javaä¸­Dequeå’ŒArrayDeque</h1><h2 id="Dequeç±»"><a href="#Dequeç±»" class="headerlink" title="Dequeç±»"></a>Dequeç±»</h2><p>ä¸€ä¸ªçº¿æ€§çš„å¯åœ¨åŒç«¯æ’å…¥ã€åˆ é™¤èŠ‚ç‚¹çš„ç»“æ„ã€‚ä»–åå­—æ—¶Dequeï¼Œå®é™…ä¸Šæ—¶â€œdouble ended queueâ€çš„ç®€å†™ï¼›</p><h2 id="ArrayDequeç±»"><a href="#ArrayDequeç±»" class="headerlink" title="ArrayDequeç±»"></a>ArrayDequeç±»</h2><p>å¯¹äºArrayDequeä¸­çš„æ•°ç»„ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„å¾ªç¯æ•°ç»„ï¼Œæ‰€è°“å¾ªç¯æ˜¯æŒ‡å…ƒç´ åˆ°æ•°ç»„å°¾ä¹‹åå¯ä»¥æ¥ç€ä»æ•°ç»„å¤´å¼€å§‹ï¼Œæ•°ç»„çš„é•¿åº¦ã€ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ éƒ½ä¸headå’Œtailè¿™ä¸¤ä¸ªå˜é‡æœ‰å…³</p><h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><p>ArrayDequeå°±åƒä»–çš„åå­—ä¸€æ ·ï¼Œä½¿ç”¨Arrayæ•°ç»„æ¥å®ç°Dequeç»“æ„ã€‚æ„é€ æ–¹æ³•å’Œä»¥å‰æåˆ°çš„ArrayListç›¸ä¼¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayDeque</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–çš„æ•°ç»„å¤§å°æ˜¯16</span></span><br><span class="line">        elements = <span class="keyword">new</span> Object[<span class="number">16</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayDeque</span><span class="params">(<span class="keyword">int</span> numElements)</span> </span>&#123;</span><br><span class="line">        allocateElements(numElements);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayDeque</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        allocateElements(c.size());</span><br><span class="line">        <span class="comment">// addAllæ–¹æ³•å°±æ˜¯ä¸ºc è¿›è¡Œforå¾ªç¯æ·»åŠ </span></span><br><span class="line">        addAll(c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å’Œç§»é™¤æ–¹æ³•"><a href="#æ·»åŠ å’Œç§»é™¤æ–¹æ³•" class="headerlink" title="æ·»åŠ å’Œç§»é™¤æ–¹æ³•"></a>æ·»åŠ å’Œç§»é™¤æ–¹æ³•</h3><ul><li>addæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨å‰é¢æ·»åŠ å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ä¸ŠåŠ å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">            <span class="comment">// åœ¨å‰é¢æ·»åŠ çš„æ—¶å€™ï¼Œhead-1 çš„ä½ç½®ä¸Šæ’å…¥ e</span></span><br><span class="line">        elements[head = (head - <span class="number">1</span>) &amp; (elements.length - <span class="number">1</span>)] = e;</span><br><span class="line">        <span class="keyword">if</span> (head == tail)</span><br><span class="line">            doubleCapacity();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">            æ·»åŠ åˆ°ä¸‹ä¸€ä¸ªä½ç½®</span><br><span class="line">        elements[tail] = e;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">         * å¦‚æœå½“å‰æ·»åŠ ä½ç½®çš„ä¸‹ä¸€ä¸ªä½ç½® ä¸ä¸Š é•¿åº¦-1 </span></span><br><span class="line"><span class="comment">         *ï¼ˆå› ä¸ºé•¿åº¦éƒ½æ˜¯2çš„å€æ•°ï¼Œæ‰€ä»¥-1ä¹‹åï¼Œ2è¿›åˆ¶åå‡ ä½éƒ½æ˜¯1ï¼Œä¿è¯è´Ÿæ•°çš„æ—¶å€™ä¹Ÿèƒ½å¤Ÿæ‰¾åˆ°æ­£ç¡®çš„ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="comment">         * å¦‚æœtailå’Œheadç›¸ç­‰è¯´æ˜æ•°ç»„æ»¡äº†ï¼Œéœ€è¦æ‰©å®¹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> ( (tail = (tail + <span class="number">1</span>) &amp; (elements.length - <span class="number">1</span>)) == head)</span><br><span class="line">            doubleCapacity();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸¤ç§æ–¹æ³•ï¼Œé˜Ÿåˆ—æˆ–è€…æ ˆçš„æ–¹æ³•éƒ½å¯ä»¥è½»æ¾å®ç°äº†ã€‚</p><p>åœ¨è¿›è¡Œå¢åŠ å…ƒç´ çš„æ—¶å€™æ¶‰åŠåˆ° <code>doubleCapacity</code> è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥æ‰©å……æ•°ç»„çš„å®¹é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doubleCapacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> head == tail;</span><br><span class="line">        <span class="keyword">int</span> p = head;</span><br><span class="line">        <span class="keyword">int</span> n = elements.length;</span><br><span class="line">        <span class="keyword">int</span> r = n - p; <span class="comment">// headå³è¾¹å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">int</span> newCapacity = n &lt;&lt; <span class="number">1</span>; <span class="comment">// æ‰©å……ä¸ºåŸæ¥çš„2å€</span></span><br><span class="line">        <span class="keyword">if</span> (newCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Sorry, deque too big"</span>);</span><br><span class="line">        Object[] a = <span class="keyword">new</span> Object[newCapacity]; <span class="comment">//åˆ›å»ºæ–°æ•°ç»„</span></span><br><span class="line">        Systkkem.arraycopy(elements, p, a, <span class="number">0</span>, r); </span><br><span class="line">        System.arraycopy(elements, <span class="number">0</span>, a, r, p);<span class="comment">// ä¸¤éƒ¨copyæ•°ç»„ç›¸å½“äºä» head -&gt; tail é‡æ–°æ’åºäº†</span></span><br><span class="line">        elements = a;</span><br><span class="line">        head = <span class="number">0</span>;</span><br><span class="line">        tail = n;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>removeæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> removeFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        E x = pollFirst();</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">pollFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> h = head;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        E result = (E) elements[h];</span><br><span class="line">        <span class="comment">// Element is null if deque empty</span></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        elements[h] = <span class="keyword">null</span>;     <span class="comment">// Must null out slot</span></span><br><span class="line">        <span class="comment">// æŠŠelementçš„å¤´éƒ¨ä½ç½®ç½®ç©ºåï¼Œå°†headå‘å‰ç§»</span></span><br><span class="line">        head = (h + <span class="number">1</span>) &amp; (elements.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>toArrayæ–¹æ³•</li></ul><p>toArrayæ–¹æ³•ä¸»è¦æ˜¯æ–¹ä¾¿è¾“å‡ºã€‚ç”¨æ¥çœŸæ­£çš„æŒ‰ç…§é€»è¾‘é¡ºåºï¼Œè¿›è¡Œç‰©ç†é‡æ’ï¼Œå®ç°æ–¹æ³•å’ŒdoubleCapacityå®ç°ç›¸åŒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object[] toArray() &#123;</span><br><span class="line">        <span class="keyword">return</span> copyElements(<span class="keyword">new</span> Object[size()]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; T[] copyElements(T[] a) &#123;</span><br><span class="line">        <span class="keyword">if</span> (head &lt; tail) &#123;</span><br><span class="line">         <span class="comment">// å¦‚æœé¡ºåºæ­£å¸¸</span></span><br><span class="line">            System.arraycopy(elements, head, a, <span class="number">0</span>, size());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (head &gt; tail) &#123;</span><br><span class="line">         <span class="comment">// å¦åˆ™å°†headå³ä¾§çš„å…ˆcopyåˆ°æ•°ç»„ä¸­ï¼Œåœ¨copyå‰©ä¸‹çš„</span></span><br><span class="line">            <span class="keyword">int</span> headPortionLen = elements.length - head;</span><br><span class="line">            System.arraycopy(elements, head, a, <span class="number">0</span>, headPortionLen);</span><br><span class="line">            System.arraycopy(elements, <span class="number">0</span>, a, headPortionLen, tail);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ul><li>sizeæ–¹æ³•</li></ul><p>å’Œå¾ˆå¤šæ•°æ®ç»“æ„ç±»ä¸åŒçš„æ˜¯ï¼Œä»–çš„sizeå¹¶ä¸æ˜¯ä¾é æœ¬èº«çš„å˜é‡å­—æ®µè¿›è¡Œç»´æŠ¤ï¼Œè€Œæ˜¯é€šè¿‡sizeæ–¹æ³•è®¡ç®—è€Œæ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> (tail - head) &amp; (elements.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹ï¼ŒArrayDequeå®ç°äº†åŒç«¯é˜Ÿåˆ—çš„ç‰¹ç‚¹ï¼Œèƒ½å¤Ÿå®Œæˆæ ˆå’Œé˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œæ•ˆç‡æ¯”åŒæ ·ç»§æ‰¿Dequeçš„LinkedListæ•ˆç‡é«˜ï¼Œå› ä¸ºåœ¨ArrayDequeä¸­çš„è®¡ç®—å¤§éƒ¨åˆ†ä¸ºä½è¿ç®—ã€‚ArrayDequeé€»è¾‘ä¸Šå¾ªç¯çš„æ•°ç»„ï¼Œä½†å®é™…ä¸Šå¹¶ä¸æ˜¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¸­çš„æ ˆå’Œé˜Ÿåˆ—</title>
      <link href="/2018/10/18/2018-10-17-Java%E4%B8%AD%E7%9A%84%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/"/>
      <url>/2018/10/18/2018-10-17-Java%E4%B8%AD%E7%9A%84%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<!-- vim-markdown-toc GFM --><ul><li><a href="#javaä¸­çš„æ ˆå’Œé˜Ÿåˆ—">javaä¸­çš„æ ˆå’Œé˜Ÿåˆ—</a><ul><li><a href="#stack-æ ˆ">Stack æ ˆ</a><ul><li><a href="#pushæ–¹æ³•å’Œpopæ–¹æ³•">pushæ–¹æ³•å’Œpopæ–¹æ³•</a></li><li><a href="#peekæ–¹æ³•">peekæ–¹æ³•</a></li></ul></li><li><a href="#queue-é˜Ÿåˆ—">Queue é˜Ÿåˆ—</a><ul><li><a href="#offer-æ–¹æ³•å’Œ-pullæ–¹æ³•">offer æ–¹æ³•å’Œ pullæ–¹æ³•</a></li><li><a href="#addæ–¹æ³•å’Œremoveæ–¹æ³•">addæ–¹æ³•å’Œremoveæ–¹æ³•</a></li></ul></li></ul></li></ul><!-- vim-markdown-toc --><h1 id="javaä¸­çš„æ ˆå’Œé˜Ÿåˆ—"><a href="#javaä¸­çš„æ ˆå’Œé˜Ÿåˆ—" class="headerlink" title="javaä¸­çš„æ ˆå’Œé˜Ÿåˆ—"></a>javaä¸­çš„æ ˆå’Œé˜Ÿåˆ—</h1><h2 id="Stack-æ ˆ"><a href="#Stack-æ ˆ" class="headerlink" title="Stack æ ˆ"></a>Stack æ ˆ</h2><p>æ ˆæ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ï¼Œæœ‰è¿™æ ·çš„æ•°æ®ç»“æ„åŠŸèƒ½çš„è¿˜æœ‰Dequç±»ï¼Œæ¨èä½¿ç”¨Dequ</p><h3 id="pushæ–¹æ³•å’Œpopæ–¹æ³•"><a href="#pushæ–¹æ³•å’Œpopæ–¹æ³•" class="headerlink" title="pushæ–¹æ³•å’Œpopæ–¹æ³•"></a>pushæ–¹æ³•å’Œpopæ–¹æ³•</h3><p>pushæ–¹æ³•æ˜¯å‘æ ˆé¡¶æ”¾å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public E push(E item) &#123;</span><br><span class="line">// è¿™é‡Œè°ƒç”¨çˆ¶ç±»Vectorçš„addElementæ–¹æ³•</span><br><span class="line">        addElement(item);</span><br><span class="line"></span><br><span class="line">        return item;</span><br><span class="line">    &#125;</span><br><span class="line">// addElementæ–¹æ³•æ˜¯åŠ é”çš„æ–¹æ³• è°ƒç”¨elementå®é™…ä¸Šå°±æ˜¯æ•°ç»„é•¿åº¦åŠ ä¸€å¹¶ä¸”åœ¨è¯¥é—®ä¹‹ä¸Šä»˜å€¼</span><br><span class="line">public synchronized void addElement(E obj) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line">        ensureCapacityHelper(elementCount + 1);</span><br><span class="line">        elementData[elementCount++] = obj;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>popæ–¹æ³•æ˜¯åœ¨å°†æ ˆé¡¶çš„å€¼å‡ºæ ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// åŒæ ·åŠ é”çš„æ–¹æ³• è°ƒç”¨æ–¹æ³• ç§»é™¤åœ¨æ•°ç»„æœ€åä½ç½®çš„å…ƒç´ </span><br><span class="line">public synchronized E pop() &#123;</span><br><span class="line">        E       obj;</span><br><span class="line">        int     len = size();</span><br><span class="line"></span><br><span class="line">        obj = peek();</span><br><span class="line">        removeElementAt(len - 1);</span><br><span class="line"></span><br><span class="line">        return obj;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="peekæ–¹æ³•"><a href="#peekæ–¹æ³•" class="headerlink" title="peekæ–¹æ³•"></a>peekæ–¹æ³•</h3><p>peekæ–¹æ³•æ˜¯çœ‹ä¸€ä¸‹æ ˆé¡¶å…ƒç´ çš„å€¼ï¼Œä½†ä¸åšä»»ä½•æ“ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public synchronized E peek() &#123;</span><br><span class="line">        int     len = size();</span><br><span class="line"></span><br><span class="line">        if (len == 0)</span><br><span class="line">            throw new EmptyStackException();</span><br><span class="line">        return elementAt(len - 1);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™å‡ ä¸ªæ–¹æ³•å’ŒlinkedListç±»ä¸­çš„å¯¹åº”çš„æ–¹æ³•éå¸¸åƒï¼Œæ‰€ä»¥å…¶å®LindedListä¹Ÿå¯ä»¥å½“ä½œæ ˆç”¨ã€‚</p><h2 id="Queue-é˜Ÿåˆ—"><a href="#Queue-é˜Ÿåˆ—" class="headerlink" title="Queue é˜Ÿåˆ—"></a>Queue é˜Ÿåˆ—</h2><p>é˜Ÿåˆ—å’Œæ ˆç›¸åï¼Œæ˜¯ä¸€ä¸ªå…ˆè¿›åå‡ºçš„æ•°æ®ç»“æ„ï¼Œæƒ³æˆç°å®ä¸­çš„æ’é˜Ÿå†æ˜ç™½ä¸è¿‡äº†ã€‚</p><h3 id="offer-æ–¹æ³•å’Œ-pullæ–¹æ³•"><a href="#offer-æ–¹æ³•å’Œ-pullæ–¹æ³•" class="headerlink" title="offer æ–¹æ³•å’Œ pullæ–¹æ³•"></a>offer æ–¹æ³•å’Œ pullæ–¹æ³•</h3><p>offeræ–¹æ³•å¯ä»¥å°†å…ƒç´ æ”¾å…¥é˜Ÿåˆ—å½“ä¸­ï¼Œpullå¯ä»¥å°†å…ƒç´ ä»å¤´éƒ¨ç§»é™¤ã€‚</p><h3 id="addæ–¹æ³•å’Œremoveæ–¹æ³•"><a href="#addæ–¹æ³•å’Œremoveæ–¹æ³•" class="headerlink" title="addæ–¹æ³•å’Œremoveæ–¹æ³•"></a>addæ–¹æ³•å’Œremoveæ–¹æ³•</h3><p>addå’Œremoveæ–¹æ³•åˆ†åˆ«è°ƒç”¨offerå’Œpullæ–¹æ³•ï¼Œä¸åŒçš„æ˜¯ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œaddæ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œofferæ–¹æ³•ä¼šè¿”å›nullã€‚å¦‚æœé˜Ÿåˆ—ç©ºäº†ï¼Œremoveæ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œpullæ–¹æ³•ä¼šè¿”å›nullã€‚</p><p>ä»¥åä¼šæåŠé˜Ÿåˆ—çš„å®ç°ç±»ä»¥åŠDequç›¸å…³ç±»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Enumæšä¸¾ç±»åˆ†æå’Œç›¸å…³æ‹“å±•</title>
      <link href="/2018/10/16/2018-10-15-Enum%E7%B1%BB%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8B%93%E5%B1%95/"/>
      <url>/2018/10/16/2018-10-15-Enum%E7%B1%BB%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8B%93%E5%B1%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Enumæšä¸¾ç±»åˆ†æå’Œç›¸å…³æ‹“å±•"><a href="#Enumæšä¸¾ç±»åˆ†æå’Œç›¸å…³æ‹“å±•" class="headerlink" title="Enumæšä¸¾ç±»åˆ†æå’Œç›¸å…³æ‹“å±•"></a>Enumæšä¸¾ç±»åˆ†æå’Œç›¸å…³æ‹“å±•</h1><p>å…¶å®æˆ‘è®¤ä¸ºä½¿ç”¨æšä¸¾ç±»å°±æ˜¯å¯¹ä½¿ç”¨å¸¸é‡çš„æ‰©å……ï¼Œä¾‹å¦‚ç±»ä¸­ä½¿ç”¨ç±»å‹ï¼Œåˆ†ç±»ç›¸åŒçš„ç±»å˜é‡çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æšä¸¾ç±»æ¥æ›¿æ¢æ‰ã€‚</p><p>å‚è€ƒäº†ç½‘ä¸Šçš„æ–‡ç« ï¼Œå¤§è‡´æœ‰ä¸¤ä¸ªå¥½å¤„ï¼Œç¬¬ä¸€æ˜¯ç¡®å®šä¼ å…¥çš„å‚æ•°ç±»å‹ã€‚è€Œä¸æ˜¯å½¢å‚æ˜¯intç±»å‹ï¼Œéšä¾¿ä¸€ä¸ªintç±»å‹å°±èƒ½å¤Ÿæ»¡è¶³ã€‚ç¬¬äºŒæ˜¯å¯¹æ¯”staticé™æ€å˜é‡æ›´èƒ½å¤Ÿç¡®å®šå˜é‡çš„æ„ä¹‰ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­æ¥çœ‹ã€‚</p><h2 id="Enumç±»å®ä¾‹"><a href="#Enumç±»å®ä¾‹" class="headerlink" title="Enumç±»å®ä¾‹"></a>Enumç±»å®ä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åˆ—ä¸¾ç®€å•çš„è¡Œé©¶å·¥å…· */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> trafficTool &#123;</span><br><span class="line">    BIKE,CAR,BUS,TRAIN,AIRPLANE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrafficToolTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">chooseTool</span><span class="params">(TrafficTool trafficTool)</span></span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (trafficTool)&#123;</span><br><span class="line">            <span class="keyword">case</span> BIKE:</span><br><span class="line">                System.out.println(<span class="string">"è‡ªè¡Œè½¦"</span>);<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CAR:</span><br><span class="line">                System.out.println(<span class="string">"æ±½è½¦"</span>);<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TrafficToolTest trafficToolTest = <span class="keyword">new</span> TrafficToolTest();</span><br><span class="line">        trafficToolTest.chooseTool(TrafficTool.BIKE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œæ™®é€šçš„ç±»ä¸€æ ·ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥æ·»åŠ æ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SPRING(<span class="string">"æ˜¥å¤©"</span>),SUMMER(<span class="string">"å¤å¤©"</span>),FALL(<span class="string">"ç§‹å¤©"</span>),WINTER(<span class="string">"å†¬å¤©"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">SeasonEnum(String name)&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç»§æ‰¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SeasonEnum &#123;</span><br><span class="line">    SPRING(<span class="string">"æ˜¥å¤©"</span>) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">comm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"è¿™æ˜¯æ˜¥å¤©"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,SUMMER(<span class="string">"å¤å¤©"</span>) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">comm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"è¿™æ˜¯å¤å¤©"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,FALL(<span class="string">"ç§‹å¤©"</span>) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">comm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"è¿™æ˜¯å†¬å¤©"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,WINTER(<span class="string">"å†¬å¤©"</span>) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">comm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"è¿™æ˜¯å†¬å¤©"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    SeasonEnum(String name)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">comm</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯æšä¸¾ç±»çš„åŸºæœ¬ä½¿ç”¨ã€‚</p><h2 id="EnumMap-å’Œ-EnumSet"><a href="#EnumMap-å’Œ-EnumSet" class="headerlink" title="EnumMap å’Œ EnumSet"></a><code>EnumMap</code> å’Œ <code>EnumSet</code></h2><p><code>public class EnumMap&lt;K extends Enum&lt;K&gt;, V&gt; extends AbstractMap&lt;K, V&gt;</code> è¿™æ˜¯å…³äºEnumMapçš„ç»§æ‰¿å…³ç³»ã€‚<br>å¯ä»¥å‘ç°è¿™æ˜¯keyä¸ºæšä¸¾ç±»çš„ä¸€ä¸ªMapã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ç®€å•åˆ›å»ºï¼Œä»¥åå°±å¯ä»¥å®ç°æšä¸¾ç±»çš„å¤šç§å¤ç”¨ */</span></span><br><span class="line">EnumMap&lt;SeasonEnum,Integer&gt; enumIntegerEnumMap = <span class="keyword">new</span> EnumMap&lt;SeasonEnum, Integer&gt;(SeasonEnum.class);</span><br><span class="line">Set&lt;SeasonEnum&gt; set = enumIntegerEnumMap.keySet();</span><br><span class="line">enumIntegerEnumMap.put(SeasonEnum.SPRING,<span class="number">1</span>);</span><br><span class="line">System.out.println(enumIntegerEnumMap.get(SeasonEnum.SPRING));</span><br></pre></td></tr></table></figure><p><code>EnumSet</code> ç›¸å¯¹äº <code>EnumMap</code> ç­‰åŒäº <code>hashSet</code> ç›¸å¯¹äº <code>HashMap</code> çš„å­˜åœ¨ï¼Œå¾ˆå¥½ç†è§£ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HashSetå’ŒHashTableçš„çš„æºç åˆ†æ</title>
      <link href="/2018/10/16/2018-10-15-HashSet%E5%92%8CHashTable%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
      <url>/2018/10/16/2018-10-15-HashSet%E5%92%8CHashTable%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 --><ul><li><a href="#hashsetå’Œhashtableçš„çš„æºç åˆ†æ">HashSetå’ŒHashTableçš„çš„æºç åˆ†æ</a><ul><li><a href="#hashset">HashSet</a><ul><li><a href="#hashsetç»“æ„æºç ">HashSetç»“æ„æºç </a></li><li><a href="#hashsetçš„åŸºæœ¬æ–¹æ³•">HashSetçš„åŸºæœ¬æ–¹æ³•</a></li><li><a href="#hashsetçš„iteratorå’Œcontainsæ–¹æ³•">HashSetçš„Iteratorå’Œcontainsæ–¹æ³•</a></li></ul></li><li><a href="#hashtable">HashTable</a></li></ul></li></ul><!-- /TOC --><h1 id="HashSetå’ŒHashTableçš„çš„æºç åˆ†æ"><a href="#HashSetå’ŒHashTableçš„çš„æºç åˆ†æ" class="headerlink" title="HashSetå’ŒHashTableçš„çš„æºç åˆ†æ"></a>HashSetå’ŒHashTableçš„çš„æºç åˆ†æ</h1><h2 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h2><p>HashSetå…¶å®å°±æ˜¯ä½¿ç”¨HashMapæ¥å®ç°çš„ï¼Œæ–¹æ³•éƒ½æ˜¯ä¾é Hash Mapçš„æ–¹æ³•ã€‚å¦‚hashSetæ„é€ ï¼ŒhashSetçš„æ·»åŠ ç­‰æ“ä½œã€‚è¿™æ ·èƒ½å¤Ÿå®ç°hashsetå»é‡ã€‚å› ä¸ºhashMapçš„keyä¸èƒ½é‡å¤ã€‚è¿™æ ·å°±èƒ½çœ‹ä¸Šç¯‡ï¼Œå½“hashMapé‡åˆ°keyå€¼é‡å¤çš„å¤„ç†ã€‚</p><h3 id="HashSetç»“æ„æºç "><a href="#HashSetç»“æ„æºç " class="headerlink" title="HashSetç»“æ„æºç "></a>HashSetç»“æ„æºç </h3><p>HashSetçš„ç»“æ„å°±ç›¸å½“äºHashMapåªå°†keyå€¼putè¿›å»ï¼Œä½†æ˜¯Valueå€¼å´ä¸ºç©ºçš„new Objectã€‚å¯ä»¥çœ‹ä½œä¸ºåªæœ‰keyçš„HashMap.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å¯ä»¥çœ‹åˆ°hashSetçš„è¿™å‡ ä¸ªæ„é€ æ–¹æ³•å’ŒHashMapæ¯æ¯ç›¸å…³ */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> HashMap&lt;E,Object&gt; map;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(Math.max((<span class="keyword">int</span>) (c.size()/.<span class="number">75f</span>) + <span class="number">1</span>, <span class="number">16</span>));</span><br><span class="line">    addAll(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">HashSet(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor, <span class="keyword">boolean</span> dummy) &#123;</span><br><span class="line">    map = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashSetçš„åŸºæœ¬æ–¹æ³•"><a href="#HashSetçš„åŸºæœ¬æ–¹æ³•" class="headerlink" title="HashSetçš„åŸºæœ¬æ–¹æ³•"></a>HashSetçš„åŸºæœ¬æ–¹æ³•</h3><p>addå’Œremoveå’Œsizeç­‰åŸºæœ¬æ–¹æ³•éƒ½æ˜¯è°ƒç”¨HashMapçš„</p><p>å¦‚addæ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* è¿™é‡Œçš„PRESENTç­‰äºnew Object() */</span></span><br><span class="line">       <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="HashSetçš„Iteratorå’Œcontainsæ–¹æ³•"><a href="#HashSetçš„Iteratorå’Œcontainsæ–¹æ³•" class="headerlink" title="HashSetçš„Iteratorå’Œcontainsæ–¹æ³•"></a>HashSetçš„Iteratorå’Œcontainsæ–¹æ³•</h3><p>åŒæ ·çš„ä¹Ÿæ˜¯è°ƒç”¨çš„HashMapçš„åŸºæœ¬æ–¹æ³•ï¼Œä½†æ˜¯éœ€è¦å…ˆå¾—åˆ°Mapçš„keySeté›†åˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.keySet().iterator();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.containsKey(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h2><p>é¦–å…ˆHashTableå’ŒHashMapçš„ç»“æ„ç±»ä¼¼ã€‚ä½†æ˜¯æœ‰æœ€é‡è¦çš„åŒºåˆ«å°±æ˜¯HashTableæ˜¯synchronizedçš„ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨ä»–çš„åŸºæœ¬æ–¹æ³•å‰éƒ½æœ‰synchronizedé”æ‰€é™åˆ¶ã€‚</p><p>ç»“æ„å°±ä¸çœ‹äº†ï¼Œåªçœ‹ä¸€ä¸ªPutæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* å…¶å®å¤§è‡´å’ŒHashMapæ˜¯ç±»ä¼¼çš„ä¹Ÿæ˜¯ä½¿ç”¨Entryä½œä¸ºåŸºæœ¬ç»“æ„ */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// Make sure the value is not null</span></span><br><span class="line">     <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// Makes sure the key is not already in the hashtable.</span></span><br><span class="line">     Entry&lt;?,?&gt; tab[] = table;</span><br><span class="line">     <span class="keyword">int</span> hash = key.hashCode();</span><br><span class="line">     <span class="comment">/* è¿™é‡Œçš„0x7FFFFFFF æ˜¯32-bitçš„intçš„æœ€å¤§å€¼ */</span></span><br><span class="line">     <span class="keyword">int</span> index = (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length;</span><br><span class="line">     <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">     Entry&lt;K,V&gt; entry = (Entry&lt;K,V&gt;)tab[index];</span><br><span class="line">     <span class="comment">/* å¦‚æœè¿™ä¸ªentryå­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯é”®å€¼é‡å¤ */</span></span><br><span class="line">     <span class="keyword">for</span>(; entry != <span class="keyword">null</span> ; entry = entry.next) &#123;</span><br><span class="line">         <span class="keyword">if</span> ((entry.hash == hash) &amp;&amp; entry.key.equals(key)) &#123;</span><br><span class="line">             V old = entry.value;</span><br><span class="line">             entry.value = value;</span><br><span class="line">             <span class="keyword">return</span> old;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="comment">/* å¦åˆ™æ·»åŠ EntryèŠ‚ç‚¹ */</span></span><br><span class="line">     addEntry(hash, key, value, index);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line"></span><br><span class="line">    Entry&lt;?,?&gt; tab[] = table;</span><br><span class="line">    <span class="keyword">if</span> (count &gt;= threshold) &#123;</span><br><span class="line">      <span class="comment">/* å¦‚æœå½“å‰countå¤§äºé˜ˆå€¼çš„å¤§å° é‡æ–°ç”Ÿæˆtable sizeå’Œhashå€¼ */</span></span><br><span class="line">        <span class="comment">// Rehash the table if the threshold is exceeded</span></span><br><span class="line">        rehash();</span><br><span class="line"></span><br><span class="line">        tab = table;</span><br><span class="line">        hash = key.hashCode();</span><br><span class="line">        index = (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Creates the new entry.</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;) tab[index];</span><br><span class="line">    tab[index] = <span class="keyword">new</span> Entry&lt;&gt;(hash, key, value, e);</span><br><span class="line">    count++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºHashTableå’ŒHashMapçš„ç»“æ„è¿˜æ˜¯æœ‰å·®å¼‚çš„ï¼ŒHashMapæ˜¯çºµå‘çš„åˆ—è¡¨å½“å‡ºç°ç›¸åŒçš„hashå€¼çš„æ—¶å€™ï¼Œæ‰©å±•å‡ºæ¨ªå‘åˆ—è¡¨ï¼Œå½“æ¨ªå‘çš„åˆ—è¡¨åˆ°è¾¾ä¸€å®šçš„é•¿åº¦çš„æ—¶å€™ï¼Œè¿™ä¸ªæ¨ªå‘çš„é“¾è¡¨å°±ä¼šè‡ªåŠ¨æ•´ç†æˆçº¢é»‘æ ‘çš„å½¢å¼ï¼Œè€ŒhashTableä¸å­˜åœ¨æ¨ªå‘çš„è¿™ç§ç»“æ„çš„ï¼Œå½“count&gt;=é˜ˆå€¼çš„æ—¶å€™å°±ä¼šæŠŠHashé‡ç½®ï¼Œä½¿ä¹‹ä¸ä¼šå‡ºç°hashå€¼é‡å¤çš„æƒ…å†µã€‚å¯ä»¥è¯´hashTableæ¯”è¾ƒhashMapçš„ç»“æ„æ›´ç®€å•ï¼Œä½†æ˜¯æ•ˆç‡ä¼šæ¯”HashMapçš„ä½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HashMapçš„æºç æŸ¥çœ‹</title>
      <link href="/2018/10/11/2018-10-10-hashmap%E7%9A%84%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B/"/>
      <url>/2018/10/11/2018-10-10-hashmap%E7%9A%84%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="HashMapçš„æºç æŸ¥çœ‹"><a href="#HashMapçš„æºç æŸ¥çœ‹" class="headerlink" title="HashMapçš„æºç æŸ¥çœ‹"></a>HashMapçš„æºç æŸ¥çœ‹</h1><p>HashMapæ˜¯å¸¸è§çš„,ä»¥K-Vå­˜å‚¨çš„æ•°æ®ç»“æ„.</p><p>åœ¨çœ‹æºç ä¹‹å‰ï¼Œå…ˆéœ€è¦äº†è§£HashMapçš„ç»“æ„æƒ…å†µï¼Œå‰é¢çš„ä»£ç ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ä¸»ä½“æ•°æ®æ˜¯ç”±Node&lt;K,V&gt;ç»„æˆçš„æ•°ç»„æ„æˆï¼Œè€ŒNodeè¿˜æœ‰æŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå‚è€ƒä¸‹å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20191218133708.png" alt="å›¾1"></p><h2 id="NodeèŠ‚ç‚¹"><a href="#NodeèŠ‚ç‚¹" class="headerlink" title="NodeèŠ‚ç‚¹"></a>NodeèŠ‚ç‚¹</h2><p>é¦–å…ˆçœ‹åˆ°hashmapä¸­çš„nodeç±»ç»§æ‰¿äº†map.Entry&lt;k,v&gt;ç»“æ„ï¼Œæœ‰ç±»å‹ä¸ºKçš„keyå’Œç±»å‹ä¸ºVçš„valueï¼›å…¶æ¬¡nodeæ˜¯ä¸€ä¸ªå•é“¾è¡¨ç»“æ„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    <span class="comment">// æŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹çš„æŒ‡é’ˆ</span></span><br><span class="line">    Node&lt;K,V&gt; next;</span><br><span class="line">    Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">        <span class="keyword">this</span>.hash = hash;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> K <span class="title">getKey</span><span class="params">()</span>        </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">getValue</span><span class="params">()</span>      </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">setValue</span><span class="params">(V newValue)</span> </span>&#123;</span><br><span class="line">        V oldValue = value;</span><br><span class="line">        value = newValue;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line">            <span class="keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class="line">                Objects.equals(value, e.getValue()))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HashMapæºç "><a href="#HashMapæºç " class="headerlink" title="HashMapæºç "></a>HashMapæºç </h2><h3 id="åŸºæœ¬å±æ€§"><a href="#åŸºæœ¬å±æ€§" class="headerlink" title="åŸºæœ¬å±æ€§"></a>åŸºæœ¬å±æ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å®é™…ä¸Šç»“æ„å°±æ˜¯ä¸€ä¸ªç±»å‹ä¸ºNodeçš„æ•°ç»„,ä½¿ç”¨transient é˜²æ­¢å¯¹æ•´ä¸ªtableå…¨éƒ¨åºåˆ—åŒ– */</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Holds cached entrySet(). Note that AbstractMap fields are used</span></span><br><span class="line"><span class="comment"> * for keySet() and values().</span></span><br><span class="line"><span class="comment"> * å¾—åˆ°entryset</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The number of key-value mappings contained in this map.</span></span><br><span class="line"><span class="comment">   mapçš„å¤§å°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ“ä½œæ¬¡æ•° */</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* é˜ˆå€¼ï¼Œå¦‚æœè¶…è¿‡ä¸´ç•Œå€¼å°±ä¼šè‡ªåŠ¨æ‰©å……æ•°ç»„ */</span></span><br><span class="line"><span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* åŠ è½½å› å­  */</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br></pre></td></tr></table></figure><h3 id="hashMapçš„ä¸‰ä¸ªæ„é€ æ–¹æ³•"><a href="#hashMapçš„ä¸‰ä¸ªæ„é€ æ–¹æ³•" class="headerlink" title="hashMapçš„ä¸‰ä¸ªæ„é€ æ–¹æ³•"></a>hashMapçš„ä¸‰ä¸ªæ„é€ æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ç¬¬ä¸€ä¸ªå‚æ•° æ˜¯é»˜è®¤çš„åˆå§‹åŒ–é˜ˆå€¼å¤§å°ï¼Œç¬¬äºŒä¸ªæ˜¯åŠ è½½å› å­å¤§å° */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">    <span class="comment">/* å¦‚æœåˆ¶å®šçš„åˆå§‹åŒ–é˜ˆå€¼å°äº0 */</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal initial capacity: "</span> +</span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">    <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal load factor: "</span> +</span><br><span class="line">                                           loadFactor);</span><br><span class="line">    <span class="keyword">this</span>.loadFactor = loadFactor;</span><br><span class="line">    <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä½¿ç”¨thisè°ƒç”¨ä¸Šé¢çš„æ–¹æ³• */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨é»˜è®¤çš„é˜ˆå€¼å’Œå› å­ï¼Œå¤§å°åˆ†åˆ«ä¸º16å’Œ0.75</span></span><br><span class="line"><span class="comment"> * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the default initial capacity</span></span><br><span class="line"><span class="comment"> * (16) and the default load factor (0.75).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="hashMapçš„æ–¹æ³•æºç "><a href="#hashMapçš„æ–¹æ³•æºç " class="headerlink" title="hashMapçš„æ–¹æ³•æºç "></a>hashMapçš„æ–¹æ³•æºç </h2><p>åœ¨å¤§è‡´äº†è§£å®ŒHashMapçš„ç»“æ„åï¼Œé€šè¿‡æŸ¥çœ‹putæ–¹æ³•ï¼Œæ¥åˆ†æå…ƒç´ æ˜¯å¦‚ä½•æ”¾åˆ°è¿™ç§ç»“æ„ä¸­çš„ã€‚å¤§è‡´æ­¥éª¤å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20191218134303.png" alt="å›¾2"></p><h3 id="putæ–¹æ³•"><a href="#putæ–¹æ³•" class="headerlink" title="putæ–¹æ³•"></a>putæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* è°ƒç”¨putValæ–¹æ³• */</span></span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.put and related methods</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash hash for key keyçš„hashç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key keyå€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the value to put valueå€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> onlyIfAbsent if true, don't change existing value å¦‚æœæ˜¯true ä¸æ”¹å˜å½“å‰å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> evict if false, the table is in creation mode. å¦‚æœæ˜¯falseï¼Œé‚£ä¹ˆtableå°±å±äºåˆ›å»ºæ¨¡å¼ ï¼ˆï¼Ÿï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> previous value, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">               <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="comment">/* å½“Mapä¸ºç©ºçš„æ—¶å€™  è¿™æ—¶å€™tabä¸º16ä¹Ÿå°±æ˜¯nä¸º16*/</span></span><br><span class="line">    <span class="comment">/* è¿™æ˜¯å½“mapä¸­çš„å†…å®¹ä¸ºç©ºçš„æ—¶å€™</span></span><br><span class="line"><span class="comment">     * newCap = DEFAULT_INITIAL_CAPACITY;</span></span><br><span class="line"><span class="comment">     * newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">/* å¦‚æœå½“å‰tabçš„length&amp;hashå€¼å†tabåˆ—è¡¨ä¸­ä¸é‡å¤ */</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">    <span class="comment">/* æ–°å»ºä¸€ä¸ªnoede å†tab[i]çš„ä½ç½®ä¸Š */</span></span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">/* å½“æ·»åŠ é‡å¤çš„keyçš„æ—¶å€™ è¿™æ—¶å€™hashå’Œkeyçš„å€¼éƒ½ç›¸ç­‰ï¼Œå°±ç›¸å½“äºä¸æ·»åŠ  */</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">        <span class="comment">/* å¦‚æœeæ˜¯treeNodeçš„æ—¶å€™  */</span></span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å°†æ–°å€¼æ·»åŠ åˆ°pçš„åé¢</span></span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                    <span class="comment">/* å¦‚æœå½“å‰åˆ—è¡¨ä¸­çš„é•¿åº¦å¤§äºç­‰äº 8-1 çš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸ªåˆ—è¡¨æ•´ç†æˆæ ‘å½¢ç»“æ„ */</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">/* å¦‚æœå½“å‰sizeå¤§äºthresholdçš„æ—¶å€™æ‰©å……table */</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœ¨çœ‹getæ–¹æ³•ä¹‹å‰å…ˆçœ‹å’Œputæ–¹æ³•æ¯æ¯ç›¸å…³çš„resizeæ–¹æ³•"><a href="#åœ¨çœ‹getæ–¹æ³•ä¹‹å‰å…ˆçœ‹å’Œputæ–¹æ³•æ¯æ¯ç›¸å…³çš„resizeæ–¹æ³•" class="headerlink" title="åœ¨çœ‹getæ–¹æ³•ä¹‹å‰å…ˆçœ‹å’Œputæ–¹æ³•æ¯æ¯ç›¸å…³çš„resizeæ–¹æ³•"></a>åœ¨çœ‹getæ–¹æ³•ä¹‹å‰å…ˆçœ‹å’Œputæ–¹æ³•æ¯æ¯ç›¸å…³çš„resizeæ–¹æ³•</h4><p>å¦‚æœ <code>hash&amp;length-1</code> çš„å€¼é‡å¤çš„è¯ï¼Œè¯´æ˜ä½ç½®å†²çªï¼Œé¦–å…ˆä¼šæ·»åŠ åœ¨è¿™ä¸ªä½ç½®å…ƒç´ åé¢ï¼Œå¦‚æœå¤§å°è¶…è¿‡ <code>TREEIFY_THRESHOLD - 1</code> çš„æ—¶å€™è‡ªåŠ¨ä¸ºè¿™åˆ—æ•´ç†æˆæ ‘å½¢çŠ¶ã€‚è¿™æ ·å°±ä¼šå˜ä¸ºæ•°ç»„å’Œæ¨ªå‘åˆ—è¡¨æˆ–æ ‘çš„ç»„åˆç»“æ„ã€‚</p><p>åœ¨æœªé‡å¤hashçš„å‰æä¸‹ï¼Œå¦‚æœtableçš„å¤§å°è¶…è¿‡è®¾ç½®çš„ <code>threshold</code> çš„å¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘ <code>resize</code> æ–¹æ³•ã€‚åœ¨resizeæ—¶ä¼šå°†HashMapä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œé‡æ–°æ’åˆ—ï¼Œä»¥ä¾¿ä¸é˜²æ²»åˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µå‘ç”Ÿã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹resizeæ–¹æ³•çš„ä»£ç ç»“æ„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">        <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">        <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">        <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">                threshold = Integer.MAX_VALUE;</span><br><span class="line">                <span class="keyword">return</span> oldTab;</span><br><span class="line">            &#125; <span class="comment">//newcapæ˜¯oldcapçš„2å€</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                     oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">                newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">            newCap = oldThr;</span><br><span class="line">        <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">            newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">            newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">            newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                      (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line">        threshold = newThr;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</span><br><span class="line">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">        table = newTab;</span><br><span class="line">        <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//å¾ªç¯åŸtableæ•°ç»„ ï¼Ÿå› ä¸ºåœ¨æ‰©å®¹å hash &amp; (size-1) çš„ä½ç½®å‘ç”Ÿäº†å˜åŒ– ï¼Œæ‰€ä»¥åº”å½“è¿›è¡Œé‡æ’</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123; </span><br><span class="line">                Node&lt;K,V&gt; e;</span><br><span class="line">                <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)<span class="comment">//è¯´æ˜eä¸å­˜åœ¨hashå†²çª</span></span><br><span class="line">                        newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                        ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                    <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                        Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; next;</span><br><span class="line">                        <span class="keyword">do</span> &#123; <span class="comment">//å†å»å¾ªç¯bin</span></span><br><span class="line">                            next = e.next;</span><br><span class="line">                            <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123; <span class="comment">//å¦‚æœåœ¨ä½ä½ ï¼ˆè€ï¼‰æ•°ç»„ä¸­ä¹Ÿå°±æ˜¯å…ƒç´ hastå’Œå°±æ•°ç»„å–æ¨¡ä¸º0æ—¶ï¼Œè¯´æ˜é‡æ’åä»åœ¨è€æ•°ç»„å†…</span></span><br><span class="line">                                <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                    loHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    loTail.next = e;</span><br><span class="line">                                loTail = e;<span class="comment">//é€’å½’å‘ä¸‹ç»§ç»­æ’</span></span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;<span class="comment">//å¦åˆ™åœ¨é«˜ä½æ•°ç»„ä¸­ ï¼Œä¹Ÿå°±æ˜¯åœ¨æ‰©å®¹å‡ºæ¥çš„æ•°ç»„ä¸­</span></span><br><span class="line">                                <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                    hiHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    hiTail.next = e;</span><br><span class="line">                                hiTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                            newTab[j] = loHead; <span class="comment">//ä½ä½æ•°ç»„è¿˜æ˜¯åœ¨åŸæ¥çš„ä½ç½®ä¸Š</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                            newTab[j + oldCap] = hiHead; <span class="comment">//é«˜ä½æ•°ç»„åœ¨æ—§æ•°ç»„+jçš„ä½ç½®ä¸Š</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newTab;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="getæ–¹æ³•"><a href="#getæ–¹æ³•" class="headerlink" title="getæ–¹æ³•"></a>getæ–¹æ³•</h3><p>getæ–¹æ³•æ˜¯æ ¹æ®hashå’Œkeyå€¼è¿›è¡ŒæŸ¥æ‰¾,åŒç†containKeyæ–¹æ³•ä¹Ÿæ˜¯è°ƒç”¨getNodeæ–¹æ³•è¿›è¡Œåˆ¤æ–­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// å…ˆå›æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">              <span class="comment">/* ä»ç¬¬äºŒä¸ªèŠ‚ç‚¹å¼€å§‹å¾ªç¯ æŸ¥æ‰¾hashå’Œkeyåˆ†åˆ«ç›¸åŒ  */</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="removeæ–¹æ³•"><a href="#removeæ–¹æ³•" class="headerlink" title="removeæ–¹æ³•"></a>removeæ–¹æ³•</h3><p>ä½¿ç”¨removeæ–¹æ³•æ ¹æ®keyç§»é™¤èŠ‚ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = removeNode(hash(key), key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>)) == <span class="keyword">null</span> ?</span><br><span class="line">        <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.remove and related methods</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash keyçš„hashå€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key é”®å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value å¦‚æœæƒ³åŒ¹é…çš„è¯å°±æ˜¯valueï¼Œå¦åˆ™ç©º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> matchValue å¦‚æœæ˜¯tureé‚£ä¹ˆå°±ç§»é™¤å’Œvalue equalçš„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> movable å¦‚æœæ˜¯falseçš„è¯ï¼Œç§»é™¤è¿™ä¸ªèŠ‚ç‚¹ä¸è¦ç§»åŠ¨å…¶ä»–èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the node, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">removeNode</span><span class="params">(<span class="keyword">int</span> hash, Object key, Object value,</span></span></span><br><span class="line"><span class="function"><span class="params">                           <span class="keyword">boolean</span> matchValue, <span class="keyword">boolean</span> movable)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, index;</span><br><span class="line">    <span class="comment">/* ç¡®å®šèŠ‚ç‚¹ */</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (p = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Node&lt;K,V&gt; node = <span class="keyword">null</span>, e; K k; V v;</span><br><span class="line">        <span class="comment">/* å¦‚æœhashå€¼ç›¸åŒ keyå€¼ä¹Ÿç›¸åŒ è¯´æ˜å°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹ */</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            node = p;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((e = p.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="comment">/* å¦åˆ™æ¨ªå‘æŸ¥æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ */</span></span><br><span class="line">            <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="comment">/* çœç•¥-------- */</span></span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node != <span class="keyword">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                             (value != <span class="keyword">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class="line">            <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="keyword">this</span>, tab, movable);</span><br><span class="line">                <span class="comment">/* æ¥ä¸‹æ¥æŠŠtabä¸­å¯¹åº”çš„index removeæ‰ */</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (node == p)</span><br><span class="line">                tab[index] = node.next;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                p.next = node.next;</span><br><span class="line">            ++modCount;</span><br><span class="line">            --size;</span><br><span class="line">            afterNodeRemoval(node);</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="keySetæ–¹æ³•"><a href="#keySetæ–¹æ³•" class="headerlink" title="keySetæ–¹æ³•"></a>keySetæ–¹æ³•</h3><p>ketSetæ–¹æ³•ä¹Ÿæ˜¯ç»å¸¸ç”¨åˆ°çš„æ–¹æ³•ï¼ŒkeySetæ–¹æ³•å®é™…ä¸Šå°±æ˜¯è¿”å›æ–°å»ºçš„keysetç»“æ„ã€‚å…·ä½“ç»“æ„å¯ä»¥çœ‹å¦‚ä¸‹ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰ä½¿ç”¨forEachå’ŒIteratoræ–¹æ³•çš„æ—¶å€™æ‰ä¼šå¾ªç¯tabæ¥æ‰¾keyçš„setæ•°æ®ã€‚æ•°æ®ç»“æ„ä¸­éƒ½æ˜¯è°ƒç”¨å¤–éƒ¨æ–¹æ³•çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KeySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span>                 </span>&#123; <span class="keyword">return</span> size; &#125; <span class="comment">//è¿”å›å½“å‰size</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span>               </span>&#123; HashMap.<span class="keyword">this</span>.clear(); &#125; <span class="comment">//ç›´æ¥è°ƒç”¨hashMapçš„clearæ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Iterator&lt;K&gt; <span class="title">iterator</span><span class="params">()</span>     </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> KeyIterator(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123; <span class="keyword">return</span> containsKey(o); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> removeNode(hash(key), key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>) != <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Spliterator&lt;K&gt; <span class="title">spliterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> KeySpliterator&lt;&gt;(HashMap.<span class="keyword">this</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">forEach</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> K&gt; action)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab;</span><br><span class="line">        <span class="keyword">if</span> (action == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">if</span> (size &gt; <span class="number">0</span> &amp;&amp; (tab = table) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> mc = modCount;</span><br><span class="line">            <span class="comment">/* æŠŠå½“å‰æ“ä½œæ•°è®°ä¸‹æ¥  */</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class="keyword">null</span>; e = e.next)</span><br><span class="line">                    action.accept(e.key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (modCount != mc)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å‡ ä¸ªéå¸¸å¸¸ç”¨çš„hashMapçš„æ–¹æ³•å’ŒåŸºæœ¬çš„æ•°æ®ç»“æ„æºç çš„åˆ†ææŸ¥çœ‹ã€‚å°±å½“åšç¬”è®°è®°å½•ä¸€ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinkedListçš„æºç æŸ¥çœ‹</title>
      <link href="/2018/10/08/2018-10-08-LinkedList%E7%9A%84%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B/"/>
      <url>/2018/10/08/2018-10-08-LinkedList%E7%9A%84%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="LinkedListçš„æºç æŸ¥çœ‹"><a href="#LinkedListçš„æºç æŸ¥çœ‹" class="headerlink" title="LinkedListçš„æºç æŸ¥çœ‹"></a>LinkedListçš„æºç æŸ¥çœ‹</h1><h2 id="ç»“æ„æºç "><a href="#ç»“æ„æºç " class="headerlink" title="ç»“æ„æºç "></a>ç»“æ„æºç </h2><p>LinkedListæ˜¯ä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong>ï¼Œå› ä¸ºå®ƒå…·æœ‰nextå’Œprevçš„å‰åå¼•ç”¨ã€‚æ‰€ä»¥æ¯æ¬¡æ·»åŠ å…ƒç´ ï¼Œç§»é™¤å…ƒç´ æ—¶ï¼Œéœ€è¦è€ƒè™‘ä¸¤ä¸ªæŒ‡é’ˆçš„å¼•ç”¨æƒ…å†µï¼Œä¿è¯å¯¹å‰ä¸€ä¸ªå…ƒç´ çš„å®Œå…¨æ–­å¼€å’Œæ–°å…ƒç´ çš„å®Œå…¨å¼•ç”¨ï¼Œå¦‚æœåœ¨æŒ‡å®šä½ç½®ä¸Šè¿æ¥å…ƒç´ çš„è¿‡ç¨‹å’Œç»“æ„å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/20191219112513.png" alt="LinkedListç»“æ„å‚è€ƒ"></p><h3 id="ä¾èµ–ç»“æ„"><a href="#ä¾èµ–ç»“æ„" class="headerlink" title="ä¾èµ–ç»“æ„"></a>ä¾èµ–ç»“æ„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* LinkedListçš„å†…éƒ¨å˜é‡ å¯ä»¥çœ‹å‡ºLinkedListå…¶å®å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ */</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‡å‘é¦–èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * Invariant: (first == null &amp;&amp; last == null) ||</span></span><br><span class="line"><span class="comment"> *            (first.prev == null &amp;&amp; first.item != null)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; first;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‡å‘å°¾èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * Invariant: (first == null &amp;&amp; last == null) ||</span></span><br><span class="line"><span class="comment"> *            (last.next == null &amp;&amp; last.item != null)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; last;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å†…éƒ¨nodeå®ç° */</span></span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line">    Node&lt;E&gt; prev;</span><br><span class="line"><span class="comment">/* åŒå‘é“¾è¡¨ */</span></span><br><span class="line">    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class="line">        <span class="keyword">this</span>.item = element;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">        <span class="keyword">this</span>.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="LinkedListæ„é€ å‡½æ•°"><a href="#LinkedListæ„é€ å‡½æ•°" class="headerlink" title="LinkedListæ„é€ å‡½æ•°"></a>LinkedListæ„é€ å‡½æ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ç©ºæ„é€ å‡½æ•° æ¯”è¾ƒå¸¸ç”¨ */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æœ‰collectionå‚æ•°çš„æ„é€ å‡½æ•° */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>();</span><br><span class="line">    addAll(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addAll(size, c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å‚æ•°ï¼šå½“å‰æ•°é‡ä¹Ÿå°±æ˜¯è¦å¾—åˆ°å½“å‰é“¾è¡¨çš„ä½ç½® */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> index, Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    checkPositionIndex(index);</span><br><span class="line"></span><br><span class="line">    Object[] a = c.toArray();</span><br><span class="line">    <span class="keyword">int</span> numNew = a.length;</span><br><span class="line">    <span class="keyword">if</span> (numNew == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    Node&lt;E&gt; pred, succ;</span><br><span class="line">    <span class="comment">// å¯¹æ’å…¥å‰æƒ…å†µçš„åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (index == size) &#123;</span><br><span class="line"><span class="comment">//          å¦‚æœåœ¨å°¾éƒ¨æ’å…¥ pred=æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        succ = <span class="keyword">null</span>;</span><br><span class="line">        pred = last;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//          å¦åˆ™åœ¨ä¸­éƒ¨æ’å…¥ succ=å½“å‰èŠ‚ç‚¹ pred=å‰ä¸€èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">/* - - - - - - - - -  */</span></span><br><span class="line"><span class="comment">/*     ^ ^ */</span></span><br><span class="line"><span class="comment">/*     1 2  å¦‚æœæƒ³åœ¨2ä½ç½®æ’å…¥å…ƒç´ ï¼Œå‰ä¸€ä¸ªå…ƒç´ ä¸åŠ¨ï¼Œå°†åé¢çš„å…ƒç´ åç§»*/</span></span><br><span class="line">        succ = node(index);</span><br><span class="line">        pred = succ.prev;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (Object o : a) &#123;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) E e = (E) o;</span><br><span class="line"><span class="comment">// æ„é€ æ–¹æ³• å‰èŠ‚ç‚¹/å†…å®¹/åèŠ‚ç‚¹ å§‹ç»ˆpredæ˜¯å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">        Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(pred, e, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (pred == <span class="keyword">null</span>)</span><br><span class="line"><span class="comment">// å¦‚æœpred==null è¯´æ˜ æœ¬èº«åˆ—è¡¨å¼€å§‹å°±æ˜¯ç©ºçš„æˆ–è€…åœ¨å¼€å¤´æ’å…¥å…ƒç´ </span></span><br><span class="line">            first = newNode;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line"><span class="comment">// å¦åˆ™åœ¨åé¢æ’å…¥newNode</span></span><br><span class="line">            pred.next = newNode;</span><br><span class="line"><span class="comment">// å‘åå¾ªç¯èŠ‚ç‚¹</span></span><br><span class="line">        pred = newNode;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å¦‚æœsucc==null è¯´æ˜åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹åä½ç½® </span></span><br><span class="line"><span class="comment">// å°†æœ€åçš„æ–°æ’å…¥çš„å…ƒç´ predèµ‹å€¼ç»™last</span></span><br><span class="line">    <span class="keyword">if</span> (succ == <span class="keyword">null</span>) &#123;</span><br><span class="line">        last = pred;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">/* å¦åˆ™æ’å…¥åœ¨succå‰ */</span></span><br><span class="line">        pred.next = succ;</span><br><span class="line">        succ.prev = pred;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    size += numNew;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸºæœ¬æ–¹æ³•"><a href="#åŸºæœ¬æ–¹æ³•" class="headerlink" title="åŸºæœ¬æ–¹æ³•"></a>åŸºæœ¬æ–¹æ³•</h2><h3 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* addæ–¹æ³•é»˜è®¤è°ƒç”¨linklastæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å‘åæ·»åŠ å…ƒç´  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    linkLast(e);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* åŒæ ·æœ‰addLast è¾¾åˆ°ç›¸åŒçš„ç›®çš„ï¼Œå°±æ˜¯ä¸è¿”å›ä»»ä½•ä¸œè¥¿ */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        linkLast(e);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨addæ–¹æ³•åä¼šé»˜è®¤çš„è°ƒç”¨ linkLast åå°†å…ƒç´ æ·»åŠ è‡³Listçš„æœ«å°¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">linkLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; l = last;</span><br><span class="line">    <span class="comment">/* è·å¾—æœ€åä¸€ä¸ªå…ƒç´ å½“ä½œæ–°èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ */</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(l, e, <span class="keyword">null</span>);</span><br><span class="line">    <span class="comment">/* æŠŠå½“å‰èŠ‚ç‚¹ä»˜ç»™last */</span></span><br><span class="line">    last = newNode;</span><br><span class="line">    <span class="keyword">if</span> (l == <span class="keyword">null</span>)</span><br><span class="line">        first = newNode;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="comment">// å°†lastçš„nextæŒ‡å‘æ–°èŠ‚ç‚¹,å®ŒæˆåŒæ–¹ç›¸äº’é“¾æ¥</span></span><br><span class="line">        l.next = newNode;</span><br><span class="line">    size++;</span><br><span class="line">    modCount++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥è°ƒç”¨æ–¹æ³•åœ¨æœ€å‰é¢æ·»åŠ å…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    linkFirst(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">linkFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–é¦–èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; f = first;</span><br><span class="line">    <span class="comment">// è®¾ç½®æ–°èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(<span class="keyword">null</span>, e, f);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ–°èŠ‚ç‚¹ä¸ºé¦–èŠ‚ç‚¹</span></span><br><span class="line">    first = newNode;</span><br><span class="line">    <span class="keyword">if</span> (f == <span class="keyword">null</span>)</span><br><span class="line">        last = newNode;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="comment">// å°†æ–°èŠ‚ç‚¹ä¸åŸé¦–èŠ‚ç‚¹è¿æ¥</span></span><br><span class="line">        f.prev = newNode;</span><br><span class="line">    size++;</span><br><span class="line">    modCount++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç§»é™¤"><a href="#ç§»é™¤" class="headerlink" title="ç§»é™¤"></a>ç§»é™¤</h3><h4 id="removeæ–¹æ³•"><a href="#removeæ–¹æ³•" class="headerlink" title="removeæ–¹æ³•"></a>removeæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* å…ˆåˆ¤æ–­æ˜¯å¦è¶Šç•Œ */</span></span><br><span class="line">      checkElementIndex(index);</span><br><span class="line">      <span class="keyword">return</span> unlink(node(index));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">E <span class="title">unlink</span><span class="params">(Node&lt;E&gt; x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// assert x != null;</span></span><br><span class="line">    <span class="keyword">final</span> E element = x.item;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; next = x.next;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; prev = x.prev;</span><br><span class="line"><span class="comment">/* å¦‚æœprevæ˜¯ç©º è¯´æ˜å½“å‰å…ƒç´ æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´  å¦‚ A B C ç§»é™¤Aï¼Œç›´æ¥å°†BæŒ‡å‘é¦–èŠ‚ç‚¹å³å¯ */</span></span><br><span class="line">    <span class="keyword">if</span> (prev == <span class="keyword">null</span>) &#123;</span><br><span class="line">        first = next;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">/* å½“å‰èŠ‚ç‚¹ä¸å‰åèŠ‚ç‚¹æ–­ç»é“¾æ¥ å¦‚ABCç§»é™¤Bï¼Œåˆ™éœ€è¦å°†A.nextæŒ‡å‘Cï¼ŒB.preæŒ‡å‘ç©º */</span></span><br><span class="line">        prev.next = next;</span><br><span class="line">        x.prev = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å› ä¸ºLinkedListä¸ºåŒå‘é“¾è¡¨ï¼Œéœ€è¦å–æ¶ˆnextå’Œprev</span></span><br><span class="line"><span class="comment">/* å¦‚æœæ˜¯æœ€åä¸€ä¸ªå…ƒç´  */</span></span><br><span class="line">    <span class="keyword">if</span> (next == <span class="keyword">null</span>) &#123;</span><br><span class="line">        last = prev;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">/* å½“å‰èŠ‚ç‚¹ä¸å‰åèŠ‚ç‚¹æ–­ç»é“¾æ¥ å› ä¸ºLinkedListæ˜¯åŒå‘é“¾è¡¨ */</span></span><br><span class="line">        next.prev = prev;</span><br><span class="line">        x.next = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/* ç½®ç©º */</span></span><br><span class="line">    x.item = <span class="keyword">null</span>; </span><br><span class="line">    size--;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="removeFirst"><a href="#removeFirst" class="headerlink" title="removeFirst"></a>removeFirst</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; f = first;</span><br><span class="line">    <span class="keyword">if</span> (f == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    <span class="keyword">return</span> unlinkFirst(f);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> E <span class="title">unlinkFirst</span><span class="params">(Node&lt;E&gt; f)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// assert f == first &amp;&amp; f != null;</span></span><br><span class="line">    <span class="keyword">final</span> E element = f.item;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; next = f.next;</span><br><span class="line">    f.item = <span class="keyword">null</span>;</span><br><span class="line">    f.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">    first = next;</span><br><span class="line">    <span class="keyword">if</span> (next == <span class="keyword">null</span>)</span><br><span class="line">        last = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        next.prev = <span class="keyword">null</span>;</span><br><span class="line">    size--;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="removeLast-å’ŒremoveFirståŒç†"><a href="#removeLast-å’ŒremoveFirståŒç†" class="headerlink" title="removeLast å’ŒremoveFirståŒç†"></a>removeLast å’ŒremoveFirståŒç†</h4><h3 id="èµ‹å€¼å–å€¼æ“ä½œ"><a href="#èµ‹å€¼å–å€¼æ“ä½œ" class="headerlink" title="èµ‹å€¼å–å€¼æ“ä½œ"></a>èµ‹å€¼å–å€¼æ“ä½œ</h3><h4 id="getæ–¹æ³•"><a href="#getæ–¹æ³•" class="headerlink" title="getæ–¹æ³•"></a>getæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    checkElementIndex(index);</span><br><span class="line">    <span class="comment">/* å¾—åˆ°indexå¤„èŠ‚ç‚¹çš„itemä¿¡æ¯ */</span></span><br><span class="line">    <span class="keyword">return</span> node(index).item;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Node&lt;E&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// assert isElementIndex(index);</span></span><br><span class="line">        <span class="comment">// åˆ†ä¸¤ä¸ªæ–¹å‘æŸ¥æ‰¾ï¼Œ1.å¦‚æœç»™å®šçš„indexå°äºsizeçš„ä¸€åŠ</span></span><br><span class="line">    <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) &#123;</span><br><span class="line">        Node&lt;E&gt; x = first;</span><br><span class="line">        <span class="comment">//ä»å¤´å¼€å§‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">            x = x.next;</span><br><span class="line">            <span class="comment">// è¿”å›æœ€åä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 2.å¦‚æœç»™å®šçš„indexå¤§äºsizeçš„ä¸€åŠ</span></span><br><span class="line">        Node&lt;E&gt; x = last;</span><br><span class="line">        <span class="comment">// ä»å°¾éƒ¨å¼€å§‹æ‰¾</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">            x = x.prev;</span><br><span class="line">            <span class="comment">//è¿”å›æœ€åçš„é‚£ä¸ª</span></span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="setæ–¹æ³•"><a href="#setæ–¹æ³•" class="headerlink" title="setæ–¹æ³•"></a>setæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    checkElementIndex(index);</span><br><span class="line">    Node&lt;E&gt; x = node(index);</span><br><span class="line">    E oldVal = x.item;</span><br><span class="line">    x.item = element;</span><br><span class="line">    <span class="comment">/* setæ–¹æ³•ä¼šè¿”å›åŸæ¥çš„å€¼ */</span></span><br><span class="line">    <span class="keyword">return</span> oldVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="LinkedListä¸­çš„æ ˆæ“ä½œ"><a href="#LinkedListä¸­çš„æ ˆæ“ä½œ" class="headerlink" title="LinkedListä¸­çš„æ ˆæ“ä½œ"></a>LinkedListä¸­çš„æ ˆæ“ä½œ</h3><h4 id="peekæ–¹æ³•"><a href="#peekæ–¹æ³•" class="headerlink" title="peekæ–¹æ³•"></a>peekæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Retrieves, but does not remove, the head (first element) of this list.</span></span><br><span class="line"><span class="comment"> * åªæ˜¯æ£€ç´¢æ ˆé¦–å…ƒç´ ï¼Œä½†å¹¶ä¸å¼¹å‡º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the head of this list, or &#123;<span class="doctag">@code</span> null&#125; if this list is empty</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; f = first;</span><br><span class="line">    <span class="keyword">return</span> (f == <span class="keyword">null</span>) ? <span class="keyword">null</span> : f.item;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒç† <code>peekFirst</code> å’Œ <code>peekLast</code></p><h4 id="pollæ–¹æ³•"><a href="#pollæ–¹æ³•" class="headerlink" title="pollæ–¹æ³•"></a>pollæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Retrieves and removes the head (first element) of this list.</span></span><br><span class="line"><span class="comment"> * æ£€ç´¢å¹¶ä¸”ç§»é™¤æ ˆé¦–å…ƒç´  unlinkFirstæ˜¯å¯ä»¥è¿”å›ç§»é™¤å…ƒç´ çš„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the head of this list, or &#123;<span class="doctag">@code</span> null&#125; if this list is empty</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">poll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; f = first;</span><br><span class="line">    <span class="keyword">return</span> (f == <span class="keyword">null</span>) ? <span class="keyword">null</span> : unlinkFirst(f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒç†  <code>pollFirst</code> å’Œ <code>pollLast</code></p><h4 id="pushæ–¹æ³•"><a href="#pushæ–¹æ³•" class="headerlink" title="pushæ–¹æ³•"></a>pushæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Pushes an element onto the stack represented by this list.  In other</span></span><br><span class="line"><span class="comment"> * words, inserts the element at the front of this list.</span></span><br><span class="line"><span class="comment"> * åœ¨æ ˆé¦–å †ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This method is equivalent to &#123;<span class="doctag">@link</span> #addFirst&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e the element to push</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    addFirst(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="popæ–¹æ³•"><a href="#popæ–¹æ³•" class="headerlink" title="popæ–¹æ³•"></a>popæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Pops an element from the stack represented by this list.  In other</span></span><br><span class="line"><span class="comment"> * words, removes and returns the first element of this list.</span></span><br><span class="line"><span class="comment"> * å‡ºæ ˆ</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This method is equivalent to &#123;<span class="doctag">@link</span> #removeFirst()&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the element at the front of this list (which is the top</span></span><br><span class="line"><span class="comment"> *         of the stack represented by this list)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchElementException if this list is empty</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> removeFirst();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="offeræ–¹æ³•"><a href="#offeræ–¹æ³•" class="headerlink" title="offeræ–¹æ³•"></a>offeræ–¹æ³•</h4><p>å®é™…ä¸Š <code>offer</code> æ˜¯è°ƒç”¨çš„ <code>add</code> æ–¹æ³•ï¼Œä½†æ˜¯åŒºåˆ«å°±åœ¨ <code>linkedlist</code> ç»§æ‰¿äº† <code>Dequ</code> å’Œ <code>List</code> çˆ¶ç±»ã€‚ä¸€èˆ¬å½“ <code>queue</code> ç”¨çš„æ—¶å€™è¦ç”¨ <code>offer/push/pop</code>  è€Œå½“ä½¿ç”¨ <code>list</code> çš„æ—¶å€™ç”¨ <code>add/remove</code> ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡æŸ¥çœ‹LinkedListçš„æºç å¯ä»¥å‘ç°ï¼š</p><ol><li>é¦–å…ˆå¯ä»¥ç¡®å®šLinkedLIstæ˜¯ä¸€ä¸ªé€šè¿‡Nodeç»“æ„å®ç°çš„åŒå‘é“¾è¡¨</li><li>å…¶æ¬¡é€šè¿‡addå’Œremoveæ–¹æ³•å¯ä»¥çœ‹å‡ºå®ƒä¸å‘ArrayListä¸€æ ·ï¼Œéœ€è¦å¯¹å®¹é‡è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œè€Œæ˜¯é€šè¿‡â€˜æŒ‡é’ˆâ€™æŒ‡å‘å‰åèŠ‚ç‚¹å®ç°çš„â€˜è¿æ¥â€™ã€‚</li><li>ç„¶åé€šè¿‡getæ–¹æ³•å¯ä»¥çœ‹å‡ºæŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šä½ç½®ä¸Šçš„éå¸¸éº»çƒ¦ï¼Œéœ€è¦éå†Listï¼Œå°½ç®¡ä½¿ç”¨äº†äºŒåˆ†çš„æ–¹å¼è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½†æ˜¯æŸ¥æ‰¾æ€§èƒ½ä¾æ—§ä¸èƒ½å’ŒArrayListç›¸æ¯”ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ArrayListçš„æºç æŸ¥çœ‹</title>
      <link href="/2018/10/04/2018-10-04-ArrayList%E7%9A%84%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B/"/>
      <url>/2018/10/04/2018-10-04-ArrayList%E7%9A%84%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="ArrayListçš„æºç "><a href="#ArrayListçš„æºç " class="headerlink" title="ArrayListçš„æºç "></a>ArrayListçš„æºç </h1><table><thead><tr><th>å˜é‡</th><th>å«ä¹‰</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>DEFAULT_CAPACITY</td><td>é»˜è®¤çš„Liståˆå§‹åŒ–å®¹é‡</td><td>10</td></tr><tr><td>EMPTY_ELEMENTDATA</td><td>ç©ºå®ä¾‹çš„ç©ºæ•°ç»„å†…å®¹</td><td>{}</td></tr><tr><td>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</td><td>å…±äº«çš„ç©ºæ•°ç»„å®ä¾‹ï¼Œç”¨äºé»˜è®¤å¤§å°çš„ç©ºå®ä¾‹ã€‚</td><td>{}</td></tr><tr><td>elementData</td><td>å­˜å‚¨ArrayListå†…å®¹çš„æ•°ç»„ç¼“å†²åŒº,é»˜è®¤æ—¶ elementData == DEL</td><td>[]</td></tr><tr><td>size</td><td>elementDataæ•°ç»„å¤§å°</td><td></td></tr></tbody></table><p>å…¶ä¸­ <strong>elementDataæ•°ç»„æ˜¯ArrayListçš„å­˜å‚¨ç»“æ„,ä¹Ÿå°±æ˜¯è¯´ArrayListä½¿ç”¨æ•°ç»„å­˜å‚¨å…ƒç´ </strong>, ä½†åŒæ—¶æ˜¯ä½¿ç”¨transientè¿›è¡Œä¿®é¥°çš„,ä¹Ÿå°±æ˜¯ä¸èƒ½åºåˆ—åŒ–çš„,ä½†å®é™…ä¸ŠArrayListå®ç°äº†Serializableæ¥å£,é‚£ä¹ˆè¿™ä¹ˆåšçš„åŸå› æ—¶ä»€ä¹ˆ?</p><p>å› ä¸ºArrayListå…·æœ‰è‡ªåŠ¨æ‰©å®¹æœºåˆ¶,å…ƒç´ åˆ°ä¸€å®šçš„å¤§å°å°±ä¼šè‡ªåŠ¨æ‰©å®¹,è¿™å°±ä¼šå¯¼è‡´ArrayListä¸­çš„å…ƒç´ ä¸€å®šä¸æ˜¯æ»¡çš„,ä¹Ÿå°±æ˜¯è¯´å¦‚æœå½“å‰ArrayListçš„å¤§å°æ—¶50,å®é™…å…ƒç´ å¯èƒ½è¿œè¿œå°äº50,æ­¤æ—¶å°±æ²¡æœ‰å°†å…¨éƒ¨elementDataéƒ½åºåˆ—åŒ–çš„å¿…è¦äº†.</p><p>æ‰€ä»¥,ArrayListæä¾›äº†ä¸€ä¸ªwriteObjectæ–¹æ³•,ä¸“é—¨å¯¹elementDataè¿›è¡Œåºåˆ—åŒ–.é‡Œé¢ä½¿ç”¨å¯¹å°äºsizeçš„æ‰€æœ‰å…ƒç´ è¿›è¡Œåºåˆ—åŒ–,å°±é¿å…äº†ä¸Šé¢é˜è¿°çš„é—®é¢˜.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">    s.writeObject(elementData[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ„é€ å‡½æ•°æºç "><a href="#æ„é€ å‡½æ•°æºç " class="headerlink" title="æ„é€ å‡½æ•°æºç "></a>æ„é€ å‡½æ•°æºç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ²¡æœ‰å‚æ•°çš„æƒ…å†µä¸‹ */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®é»˜è®¤çš„å†…å®¹ä¸º&#123;&#125;</span></span><br><span class="line">    <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* é»˜è®¤æ˜¯æ‹¥æœ‰é»˜è®¤å®¹é‡ï¼ˆ10ï¼‰çš„ç©ºçš„ array list */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"><span class="comment">/* è¿™ä¸ªé»˜è®¤çš„å®¹é‡æ˜¯å®šä¹‰å¥½çš„10  */</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å½“å‚æ•°æ˜¯å®¹é‡çš„å¤§å°çš„æ—¶å€™  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">/* å¦‚æœè‡ªå®šä¹‰åˆå§‹å®¹é‡å¤§å°*/</span></span><br><span class="line">        <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">/* å¦‚æœå‚æ•°å°äº0 æŠ¥å‚æ•°å¼‚å¸¸çš„é”™è¯¯ï¼ˆIllegalArgumentExceptionï¼‰ */</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal Capacity: "</span>+</span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å½“å‚æ•°æ˜¯ä¸€ä¸ªCollectionç»“æ„çš„æ—¶å€™ */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">     elementData = c.toArray();</span><br><span class="line">     <span class="keyword">if</span> ((size = elementData.length) != <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class="line">         <span class="keyword">if</span> (elementData.getClass() != Object[].class)</span><br><span class="line">         <span class="comment">/* å¦‚æœä¸æ˜¯objectç±»å‹çš„è¯ è½¬æ¢æˆobjectç±»å‹ */</span></span><br><span class="line">             elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// replace with empty array.</span></span><br><span class="line">         <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨æ–¹æ³•æºç "><a href="#å¸¸ç”¨æ–¹æ³•æºç " class="headerlink" title="å¸¸ç”¨æ–¹æ³•æºç "></a>å¸¸ç”¨æ–¹æ³•æºç </h2><p>åœ¨çœ‹æºç ä¹‹å‰å…ˆé€šè¿‡ä¸‹é¢è¿™å¼ å›¾ç‰‡äº†è§£ä»¥ä¸‹å¦‚æœæ–°å»ºä¸€ä¸ªArrayListåæ·»åŠ ä¸€ä¸ªå…ƒç´ çš„å¤§è‡´è¿‡ç¨‹ï¼š</p><p><img src="https://raw.githubusercontent.com/NanYinIU/PicRoom/master/img/ArrayList%E6%B7%BB%E5%8A%A0%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90.png" alt="è¿‡ç¨‹å›¾"></p><ul><li>add æ·»åŠ æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ·»åŠ  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* æ‰©å……å®¹é‡ */</span></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    <span class="comment">/* ArrayListå…¶å®å°±æ˜¯ä¸ªæ•°ç»„ å°†æ–°addçš„å€¼æ”¾åˆ°æ•°ç»„çš„æœ€åé¢ */</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">      ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calculateCapacity</span><span class="params">(Object[] elementData, <span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* å¦‚æœæ˜¯ç©ºçš„è¯è¿”å› é»˜è®¤æˆ–å½“å‰ */</span></span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœelementData == &#123;&#125;æ—¶ï¼Œè¿”å›ç»™å‡ºçš„å€¼å’Œé»˜è®¤çš„DEFAULT_CAPACITYå…¶ä¸­å¤§çš„é‚£ä¸ª</span></span><br><span class="line">        <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">return</span> minCapacity;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* The number of times this list has been &lt;i&gt;structurally modified&lt;/i&gt;. */</span></span><br><span class="line">  <span class="comment">// è¿™ä¸ªmodCount æŒ‡çš„æ˜¯æ•°æ®ç»“æ„æ”¹å˜çš„æ¬¡æ•°ï¼ˆæ¯”å¦‚æ·»åŠ ã€ç§»é™¤å…ƒç´ ï¼‰</span></span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">    <span class="comment">/* å¦‚æœå½“å‰çš„å®¹é‡å¤§äºç»™å®šçš„é•¿åº¦çš„æ—¶å€™ éœ€è¦æ‰©å…… */</span></span><br><span class="line">        grow(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length; <span class="comment">// åŸé•¿åº¦</span></span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>); <span class="comment">//æ–°é•¿åº¦ å³ç§»è¿ç®—ã€‚é•¿åº¦ä¸º1.5å€çš„åŸé•¿åº¦</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">   <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨Arrays.copyofæ–¹æ³•è¿›è¡Œæœ€ç»ˆæ‰©å®¹ï¼Œæ‰€ä»¥ArrayListæ·»åŠ å…ƒç´ æ—¶æ¯”è¾ƒè€—è´¹æ€§èƒ½ã€‚</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>remove ç§»é™¤å…ƒç´ æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å¦‚æœè¶…å‡º åˆ™æŠ›å‡ºIndexOutOfBoundsExceptionå¼‚å¸¸</span></span><br><span class="line">    rangeCheck(index);</span><br><span class="line"></span><br><span class="line">    modCount++;</span><br><span class="line">    E oldValue = elementData(index);</span><br><span class="line">    <span class="comment">/* æƒ³è¦ç§»é™¤å…ƒç´ åé¢å…ƒç´ çš„ä¸ªæ•°*/</span></span><br><span class="line">    <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">    <span class="comment">/* arraycopyæ˜¯ä¸ªnativeæ–¹æ³• ç›¸å½“äºæŠŠindex+1ä½ç½®ä¸Šçš„å…ƒç´ æŒªåˆ°indexä½ç½®ä¸Š */</span></span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                         numMoved);</span><br><span class="line">    elementData[--size] = <span class="keyword">null</span>; <span class="comment">//æ¸…ç©ºå…ƒç´ ï¼Œåˆ©äºGC </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* åªä¼šç§»é™¤ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ¡ç›® */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">              <span class="keyword">if</span> (elementData[index] == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">/* è¿™ä¸ªfastRemoveæ–¹æ³•å’Œä¸Šé¢çš„æ–¹æ³•å¤§ç›¸å¾„åº­  */</span></span><br><span class="line">                  fastRemove(index);</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">              &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">              <span class="keyword">if</span> (o.equals(elementData[index])) &#123;</span><br><span class="line">                  fastRemove(index);</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">              &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li>contain æ˜¯å¦åŒ…å«</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> indexOf(o) &gt;= <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">               <span class="keyword">if</span> (elementData[i]==<span class="keyword">null</span>)</span><br><span class="line">                   <span class="keyword">return</span> i;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">/* å†…éƒ¨å°±æ˜¯forå¾ªç¯ä¸€ä¸ªä¸€ä¸ªåˆ¤æ–­çš„ */</span></span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">               <span class="keyword">if</span> (o.equals(elementData[i]))</span><br><span class="line">                   <span class="keyword">return</span> i;</span><br><span class="line">                         &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>get æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    rangeCheck(index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> elementData(index);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* æœ¬è´¨å°±æ˜¯è¿”å›æ•°ç»„ä½ç½®çš„å…ƒç´  */</span></span><br><span class="line"><span class="function">E <span class="title">elementData</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (E) elementData[index];</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>æœ‰åºæ€§,å¯é‡å¤æ€§ â€”&gt; å› ä¸ºå†…éƒ¨ä½¿ç”¨æ•°ç»„å®ç°,æ‰€ä»¥å…ƒç´ èƒ½å¤Ÿä¿è¯æœ‰åºæ€§ä¸”èƒ½å¤Ÿæ·»åŠ é‡å¤çš„å…ƒç´ </li><li>è®¿é—®å¿« â€”&gt; ArrayListå®ç°äº† RandomAccess æ¥å£,èƒ½å¤Ÿé€šè¿‡getå®ç°å¿«é€Ÿçš„éšæœºè®¿é—®.å› ä¸ºArrayListå…¶ä¸­å†…éƒ¨å­˜å‚¨æ˜¯ä½¿ç”¨æ•°ç»„å®ç°çš„,å…ƒç´ æ˜¯è¿ç»­çš„,é€šè¿‡ä¸‹æ ‡å°±èƒ½å¤Ÿå¾—åˆ°å¯¹åº”å…ƒç´ ,æ‰€ä»¥æ£€ç´¢ä¼šæ¯”è¾ƒå¿«.</li><li>æ’å…¥åˆ é™¤æ…¢ â€”&gt; æ’å…¥å’Œç§»é™¤å…ƒç´ æ—¶ï¼Œåœ¨æ‰©å®¹æ—¶,ä½¿ç”¨çš„æ˜¯copyOfæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å°†åŸæ•°ç»„å…ƒç´ æ‹·è´åˆ°ç›®æ ‡æ•°ç»„çš„æ–¹å¼,æ•ˆç‡ä½ä¸‹.</li><li>éçº¿ç¨‹å®‰å…¨ â€”&gt; ArrayListæ˜¯éçº¿ç¨‹å®‰å…¨çš„,Vectoræ˜¯ArrayListçš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬.åœ¨å¤šçº¿ç¨‹æ—¶,å¯ä½¿ç”¨Vectorä»£æ›¿ArrayList.</li></ol><blockquote><p>RandomAccess åªæ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£,å…¶ä¸­å¹¶æ²¡æœ‰å®ç°æ–¹æ³•,ä»–çš„ä½œç”¨åªæ˜¯ç”¨æ¥æ ‡è®°è¯¥ç»“æ„æ”¯æŒéšæœºè®¿é—®.ä¹Ÿå°±æ˜¯è¯´å®ç°äº†è¿™ä¸ªæ¥å£çš„é›†åˆæ˜¯æ”¯æŒ å¿«é€Ÿéšæœºè®¿é—® ç­–ç•¥çš„.ä¸¾ä¾‹æ¥è®²å°±æ˜¯ ArrayList çš„è®¿é—®æ˜¯éšæœºè®¿é—®,è€Œ LinkedListçš„è®¿é—®åˆ™æ˜¯é¡ºåºè®¿é—®çš„.<br>éšæœºè®¿é—®åœ¨ä½¿ç”¨foriå¾ªç¯æ—¶è¦æ¯”ä½¿ç”¨è¿­ä»£å™¨è®¿é—®å…ƒç´ æ—¶æ•ˆç‡é«˜.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•´ç†å¹¶å­¦ä¹ stackOverFlowä¸Šçš„çƒ­é—¨å›ç­”</title>
      <link href="/2018/07/25/2018-07-25-stackOverFlow%E4%B8%8A%E7%9A%84%E7%83%AD%E9%97%A8%E9%97%AE%E9%A2%98/"/>
      <url>/2018/07/25/2018-07-25-stackOverFlow%E4%B8%8A%E7%9A%84%E7%83%AD%E9%97%A8%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºç¡€JavaçŸ¥è¯†"><a href="#åŸºç¡€JavaçŸ¥è¯†" class="headerlink" title="åŸºç¡€JavaçŸ¥è¯†"></a>åŸºç¡€JavaçŸ¥è¯†</h1><p>å¹³å¸¸æ²¡äº‹çš„æ—¶å€™ä¼šé€›é€›stackOverFlow,ä¸Šé¢æœ‰å¾ˆå¤šéå¸¸åŸºç¡€çš„é—®é¢˜ï¼Œå¹¶ä¸”å›ç­”è€…è®²è§£çš„éå¸¸çš„é€å½»ï¼Œæˆ‘æƒ³é€šè¿‡æ•´ç†ä¸Šé¢çš„çƒ­é—¨å›ç­”æ¥æ¢³ç†ä¸€ä¸‹è‡ªå·±çš„JavaåŸºç¡€çŸ¥è¯†ã€‚</p><h2 id="çƒ­é—¨"><a href="#çƒ­é—¨" class="headerlink" title="çƒ­é—¨"></a>çƒ­é—¨</h2><h3 id="ä»€ä¹ˆæ˜¯NullPointerExpection-å¦‚ä½•å»å°½å¯èƒ½çš„é¿å…"><a href="#ä»€ä¹ˆæ˜¯NullPointerExpection-å¦‚ä½•å»å°½å¯èƒ½çš„é¿å…" class="headerlink" title="ä»€ä¹ˆæ˜¯NullPointerExpection,å¦‚ä½•å»å°½å¯èƒ½çš„é¿å…"></a>ä»€ä¹ˆæ˜¯NullPointerExpection,å¦‚ä½•å»å°½å¯èƒ½çš„é¿å…</h3><p>å½“ä½ å£°æ˜ä¸€ä¸ªå¼•ç”¨å˜é‡(å¯¹è±¡)çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆã€‚å‚è€ƒå¦‚ä¸‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x ;</span><br><span class="line">x = <span class="number">10</span> ;</span><br></pre></td></tr></table></figure><p>åœ¨ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†å˜é‡ <code>x</code> ã€‚å› ä¸ºæ˜¯åŸå§‹ç±»å‹ï¼Œç³»ç»Ÿä¼šé»˜è®¤ä»˜ç»™å˜é‡<code>x</code>åˆå§‹å€¼æ˜¯0ã€‚ä½†æ˜¯ç¬¬äºŒè¡Œä½¿ç”¨<code>x=10</code>ï¼Œå°†æ•°å€¼10ä»˜ç»™å˜é‡xï¼Œå®é™…è¿‡ç¨‹æ˜¯å°†10å†™å…¥å˜é‡xæ‰€æŒ‡å‘çš„å†…å­˜ä½ç½®ã€‚<br>ç„¶è€Œï¼Œå½“æˆ‘ä»¬å£°æ˜ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œå¯¹äºintæ¥è¯´ä¹Ÿå°±æ˜¯å…¶åŒ…è£…ç±»å‹ã€‚ä¼šå‡ºç°ä¸ä¸€æ ·çš„æƒ…å½¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer num;</span><br><span class="line">num = <span class="keyword">new</span> Integer(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><p>å½“ä½ åˆ›å»ºnumçš„æ—¶å€™ï¼Œç³»ç»Ÿä¸ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªé»˜è®¤å€¼ï¼Œå› ä¸ºä»–å¼•ç”¨å¯¹è±¡ï¼Œç„¶è€Œï¼Œä»–ä¼šåŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆè™½ç„¶å­˜åœ¨ï¼Œä½†æ˜¯ä»–æ²¡æœ‰åˆå§‹å€¼ï¼Œæ‰€ä»¥javaä¼šå°†å˜é‡çš„æŒ‡é’ˆæŒ‡å‘ç©º(null)ã€‚<br>åœ¨ç¬¬äºŒè¡Œä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–äº†numï¼Œè¿™æ—¶ï¼Œä¼šå°†å˜é‡numæŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå®ä¾‹å¯¹è±¡ã€‚</p><p>åœ¨å½“ç”¨åˆ°è¿™ä¸ªå˜é‡ä¹‹å‰æœªç»™å˜é‡åšå®ä¾‹åŒ–æ—¶ï¼Œä¹Ÿå°±æ˜¯å˜é‡çš„æŒ‡é’ˆè¿˜æŒ‡å‘ç©ºæ—¶ï¼Œè¿è¡Œåä¼šå‡ºç°NullPointerExpection è¿™ä¸ªé—®é¢˜ã€‚</p><p>å¯èƒ½è§‰å¾—åœ¨å®é™…codeingçš„æ—¶å€™ä¸ä¼šå‡ºç°ä¸Šé¢çš„é—®é¢˜ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œæ¯ä¸ªæ–¹æ³•çš„å¼•ç”¨å¯¹è±¡å¦‚æœä¸åˆ¤æ–­ä¼ è¿›æ¥çš„å€¼æ˜¯å¦éç©ºï¼Œéƒ½å¯èƒ½ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜</p><p>é”™è¯¯çš„ç¤ºèŒƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(SomeObject obj)</span> </span>&#123;</span><br><span class="line">   <span class="comment">//do something to obj</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨çš„æ—¶å€™ ä¼ é€’nullå€¼æ—¶,ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">doSomething(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure><p>æ­£ç¡®çš„ç¤ºèŒƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(SomeObject obj)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(obj != <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="comment">//do something</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="comment">//do something else</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°½é‡åœ¨æ¯æ¬¡å¼€å‘çš„è¿‡ç¨‹å½“ä¸­ï¼Œä»”ç»†æ–Ÿé…Œå˜é‡æ˜¯å¦å¯èƒ½ä¸ºç©ºï¼Œå½“å¯èƒ½ä¸ºç©ºæ—¶ä¸€å®šè¦åšè¿™ç§åˆ¤æ–­æ¥é¢„é˜²ç©ºæŒ‡é’ˆã€‚ä¿è¯ä»£ç çš„å¥å£®æ€§ã€‚</p><h3 id="å¦‚ä½•æ¯”è¾ƒå­—ç¬¦ä¸²"><a href="#å¦‚ä½•æ¯”è¾ƒå­—ç¬¦ä¸²" class="headerlink" title="å¦‚ä½•æ¯”è¾ƒå­—ç¬¦ä¸²"></a>å¦‚ä½•æ¯”è¾ƒå­—ç¬¦ä¸²</h3><p>åœ¨å½“ä½¿ç”¨ <code>==</code> æ¯”è¾ƒå­—ç¬¦ä¸²æ˜¯å¯èƒ½ä¼šå‡ºç°bugï¼Œè¿™æ—¶å¯ä»¥ç”¨equalsè§£å†³ã€‚æ‰€ä»¥å¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨ <code>==</code> ä»€ä¹ˆæ—¶å€™ä½¿ç”¨equals</p><p>ä¸»è¦æœ‰ä¸¤æ–¹é¢çš„å·®å¼‚ï¼š</p><ol><li><p><code>==</code> æ˜¯æ¯”è¾ƒå¯¹è±¡å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£çš„æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æˆ–è€…å˜é‡çš„åœ°å€æ˜¯å¦æ˜¯ç›¸åŒçš„ã€‚è€Œequalsæ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸ç­‰ã€‚</p></li><li><p><code>==</code> æ²¡æœ‰éç©ºçš„åˆ¤æ–­ï¼Œè€Œequalså¦‚æœæ¯”è¾ƒçš„å¯¹è±¡å¦‚æœæ˜¯ç©ºåˆ™ä¼šå‡ºç°å¼‚å¸¸ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨equalsçš„æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨å·²çŸ¥çš„éç©ºå¯¹è±¡.equals(Object) å¦‚ <code>&quot;hello&quot;.equals(x)</code></p></li></ol><p>equalsæ˜¯Objectçš„æ–¹æ³•ï¼Œå¤§éƒ¨åˆ†ç±»ä¸­ä¹Ÿé‡å†™äº†equalsæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨æ¯”è¾ƒå¯¹è±¡çš„æ—¶å€™åº”è¯¥ä½¿ç”¨equals,è€Œå½“æ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹å¦‚intçš„æ—¶å€™å¯ä»¥ä½¿ç”¨ <code>==</code></p><h3 id="Javaæ˜¯ä¼ å€¼è¿˜æ˜¯ä¼ å¼•ç”¨"><a href="#Javaæ˜¯ä¼ å€¼è¿˜æ˜¯ä¼ å¼•ç”¨" class="headerlink" title="Javaæ˜¯ä¼ å€¼è¿˜æ˜¯ä¼ å¼•ç”¨"></a>Javaæ˜¯ä¼ å€¼è¿˜æ˜¯ä¼ å¼•ç”¨</h3><p><strong>Javaæ˜¯ä¼ å€¼çš„</strong> ã€‚ä½†æ˜¯ï¼Œé€šå¸¸æˆ‘ä»¬å®šä½å€¼çš„æ—¶å€™ç§°ä»–ä¸º â€œå¼•ç”¨â€ ã€‚å…·ä¸€ä¸ªéå¸¸å…¸å‹çš„ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Dog aDog = <span class="keyword">new</span> Dog(<span class="string">"Max"</span>);</span><br><span class="line">    <span class="comment">// we pass the object to foo</span></span><br><span class="line">    foo(aDog);</span><br><span class="line">    <span class="comment">// aDog variable is still pointing to the "Max" dog when foo(...) returns</span></span><br><span class="line">    aDog.getName().equals(<span class="string">"Max"</span>); <span class="comment">// true</span></span><br><span class="line">    aDog.getName().equals(<span class="string">"Fifi"</span>); <span class="comment">// false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(Dog d)</span> </span>&#123;</span><br><span class="line">    d.getName().equals(<span class="string">"Max"</span>); <span class="comment">// true</span></span><br><span class="line">    <span class="comment">// change d inside of foo() to point to a new Dog instance "Fifi"</span></span><br><span class="line">    d = <span class="keyword">new</span> Dog(<span class="string">"Fifi"</span>);</span><br><span class="line">    d.getName().equals(<span class="string">"Fifi"</span>); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶fooæ–¹æ³•å†…æ”¹å˜äº†ä¼ è¿›æ¥çš„aDogçš„å€¼ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ <code>å€¼</code>ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨å®Œfooæ–¹æ³•ä¹‹åå†å»åˆ¤æ–­å˜é‡aDogçš„æ—¶å€™ä»–çš„å¼•ç”¨åˆ°çš„å€¼æ²¡æœ‰å˜ï¼Œå˜çš„åªæ˜¯å½“æ—¶ä¼ è¿›å»çš„å€¼è€Œä¸æ˜¯å˜é‡çš„åº”ç”¨ï¼Œæ‰€ä»¥å¯ä»¥è¯´ï¼Œå¯¹è±¡çš„å¼•ç”¨æ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚å¦‚æœè¿™æ ·è¿˜æ˜¯è¿·ç³Šçš„è¯ï¼Œ<br>è¿˜å¯ä»¥é€†å‘æ¥æƒ³ï¼Œå¦‚æœæ˜¯ä¼ å¼•ç”¨çš„è¯ï¼Œåœ¨å½“fooæ–¹æ³•æ”¹å˜äº†aDogçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜æ”¹å˜äº†aDogæ‰€å¼•ç”¨åˆ°çš„çœŸæ­£çš„è¿™ä¸ªå€¼ã€‚è¿™æ ·æ˜¯ä¸èƒ½æˆç«‹ã€‚</p><p>æ‰€ä»¥ä¸ç®¡æ€ä¹ˆæƒ³ï¼šJavaæ˜¯ä¼ å€¼çš„ï¼ï¼</p><h3 id="æ€æ ·å¿«é€Ÿæ‰“å°å‡ºarrayæ•°ç»„å†…çš„å€¼"><a href="#æ€æ ·å¿«é€Ÿæ‰“å°å‡ºarrayæ•°ç»„å†…çš„å€¼" class="headerlink" title="æ€æ ·å¿«é€Ÿæ‰“å°å‡ºarrayæ•°ç»„å†…çš„å€¼"></a>æ€æ ·å¿«é€Ÿæ‰“å°å‡ºarrayæ•°ç»„å†…çš„å€¼</h3><p>å› ä¸ºarrayå¹¶æ²¡æœ‰å®ç°toString()æ–¹æ³•ï¼Œæ‰€ä»¥å½“ä½¿ç”¨array.toString()çš„æ—¶å€™ä¼šæ‰“å°å‡ºç±»ä¼¼ <code>[I@17f052a3</code> çš„åœ°å€ä¿¡æ¯ï¼Œåœ¨jdk1.5ä¹‹åå¯ä»¥ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] x = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">String arrayString = Arrays.toString(x);</span><br><span class="line">System.out.println(arrayString);</span><br><span class="line"><span class="comment">//ç»“æœï¼š [1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„æ–¹å¼å¯ä»¥éå¸¸æ–¹ä¾¿çš„æ‰“å°å‡ºæ•°ç»„å†…æ‰€æœ‰å…ƒç´ ,åµŒå¥—æ•°ç»„å¯ä»¥ä½¿ç”¨deepToStringæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(Arrays.toString(deepArray));</span><br><span class="line"><span class="comment">//output: [[Ljava.lang.String;@106d69c, [Ljava.lang.String;@52e922]</span></span><br><span class="line">System.out.println(Arrays.deepToString(deepArray));</span><br><span class="line">ç»“æœï¼š[[John, Mary], [Alice, Bob]]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashç›¸å…³é—®é¢˜æ€»ç»“</title>
      <link href="/2018/07/13/2018-07-12-bash%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/"/>
      <url>/2018/07/13/2018-07-12-bash%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="bashç›¸å…³é—®é¢˜æ€»ç»“"><a href="#bashç›¸å…³é—®é¢˜æ€»ç»“" class="headerlink" title="bashç›¸å…³é—®é¢˜æ€»ç»“"></a>bashç›¸å…³é—®é¢˜æ€»ç»“</h1><h2 id="ä¸ƒæœˆä¸“é¢˜"><a href="#ä¸ƒæœˆä¸“é¢˜" class="headerlink" title="ä¸ƒæœˆä¸“é¢˜ - -"></a>ä¸ƒæœˆä¸“é¢˜ - -</h2><h3 id="å…³äºbashä¸­çš„-lt-lt-lt-çš„å«ä¹‰"><a href="#å…³äºbashä¸­çš„-lt-lt-lt-çš„å«ä¹‰" class="headerlink" title="å…³äºbashä¸­çš„ &lt;&lt;&lt; çš„å«ä¹‰"></a>å…³äºbashä¸­çš„ <code>&lt;&lt;&lt;</code> çš„å«ä¹‰</h3><p>åœ¨StackOverflowä¸­æœ‰ä¸ªä¾‹å­éå¸¸çš„è¯¦ç»†ã€‚ã€‚å…ˆè´´è¿æ¥ <a href="https://unix.stackexchange.com/questions/80362/what-does-mean" target="_blank" rel="noopener">What does &lt;&lt;&lt; mean? </a>ä»¥ä¸‹æ˜¯æˆ‘çš„æ¸£ç¿»è¯‘ï¼Œå¯èƒ½ä¼šç¿»è¯‘é”™ã€‚ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·å¯¹å­—ç¬¦ä¸²è¿›è¡Œå¤„ç†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;$string&quot; | command</span><br></pre></td></tr></table></figure><p>ç„¶è€Œåœ¨bashä¸­ï¼Œè¿™æ ·å†™ï¼ˆä½¿ç”¨ç®¡é“ï¼‰å°±ç›¸å½“äºæŠŠå‘½ä»¤åˆ†åˆ°å­shellä¸­è¿›è¡Œå¤„ç†ï¼Œè€ƒè™‘è¿™ç§æƒ…å†µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;hello world&quot; | read first second</span><br><span class="line">echo $second $first</span><br></pre></td></tr></table></figure><p>å®ƒä¼šè¾“å‡ºä¸€ä¸ªç©ºè¡Œï¼Œå­shellæˆåŠŸçš„è¯»åˆ°äº†ä¸¤ä¸ªå˜é‡ï¼Œä½†æ˜¯éšåå­shellé€€å‡ºï¼Œä¸¤ä¸ªå˜é‡å°±æ¶ˆå¤±æ‰äº†ã€‚æ‰€ä»¥è¾“å‡ºæ˜¯æ²¡æœ‰ç»“æœçš„ã€‚åº”å½“è¿™æ ·å†™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;hello world&quot; | &#123;</span><br><span class="line">    read first second</span><br><span class="line">    echo $second $first</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·è¿˜æ˜¯æ²¡æœ‰è§£å†³è¿™ç§åˆ†æˆå­shellå»æ‰§è¡Œçš„å°´å°¬ã€‚è¿™æ—¶å€™å°±èƒ½å¤Ÿä½¿ç”¨ <code>&lt;&lt;&lt;</code> äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read first second &lt;&lt;&lt; echo &quot;hello world&quot;</span><br></pre></td></tr></table></figure><h3 id="å…³äº-var-varæ˜¯å˜é‡å"><a href="#å…³äº-var-varæ˜¯å˜é‡å" class="headerlink" title="å…³äº${!var} varæ˜¯å˜é‡å"></a>å…³äº${!var} varæ˜¯å˜é‡å</h3><p>ä½¿ç”¨${!var}çš„ä½œç”¨æ˜¯å½“verä¸å­˜åœ¨çš„æ—¶å€™ä¼šåŸæ ·è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯æ˜¾ç¤º${var}</p><h3 id="å…³äºbashä¸­çš„trapå‘½ä»¤çš„ä½¿ç”¨"><a href="#å…³äºbashä¸­çš„trapå‘½ä»¤çš„ä½¿ç”¨" class="headerlink" title="å…³äºbashä¸­çš„trapå‘½ä»¤çš„ä½¿ç”¨"></a>å…³äºbashä¸­çš„trapå‘½ä»¤çš„ä½¿ç”¨</h3><p>trapå¯ä»¥å¼ºåŒ–bashè„šæœ¬ï¼Œè®©è„šæœ¬æ›´åŠ ç¨³å®šã€‚</p><h4 id="trapçš„ä½¿ç”¨æ–¹å¼"><a href="#trapçš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="trapçš„ä½¿ç”¨æ–¹å¼"></a>trapçš„ä½¿ç”¨æ–¹å¼</h4><p>trapæœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼Œå¯¹åº”è¿™ä¸åŒçš„å¯¹ä¿¡å·çš„å›åº”æ–¹å¼ã€‚</p><ol><li>trap â€somethingâ€œ signal</li></ol><p>å…¶ä¸­â€somethingâ€œ æ˜¯åœ¨æ¥å—signalä¿¡å·ä¹‹åä½œå‡ºçš„å‘½ä»¤</p><ol start="2"><li>trap signal </li></ol><p>trapä¸æŒ‡å®šä»»ä½•å‘½ä»¤ï¼Œæ¥å—ä¿¡å·çš„é»˜è®¤æ“ä½œï¼Œé»˜è®¤æ“ä½œæ˜¯ç»“æŸè¿›ç¨‹çš„è¿è¡Œ</p><ol start="3"><li>trap â€œâ€ signal</li></ol><p>trapå‘½ä»¤æŒ‡å®šä¸€ä¸ªç©ºå‘½ä»¤ä¸²ï¼Œå…è®¸å¿½è§†ä¿¡å·</p><h4 id="å¸¸ç”¨ä¿¡å·"><a href="#å¸¸ç”¨ä¿¡å·" class="headerlink" title="å¸¸ç”¨ä¿¡å·"></a>å¸¸ç”¨ä¿¡å·</h4><ul><li><p>HUB(1) æŒ‚èµ·ï¼Œé€šå¸¸å› ç»ˆç«¯æ‰çº¿æˆ–ç”¨æˆ·é€€å‡ºè€Œå¼•å‘</p></li><li><p>INT(2) ä¸­æ–­ï¼Œé€šå¸¸å› æŒ‰ä¸‹Ctrl+Cç»„åˆé”®è€Œå¼•å‘</p></li><li><p>QUIT(3) é€€å‡ºï¼Œé€šå¸¸å› æŒ‰ä¸‹Ctrl+/ç»„åˆé”®è€Œå¼•å‘</p></li><li><p>ABRT(6) ä¸­æ­¢ï¼Œé€šå¸¸å› æŸäº›ä¸¥é‡çš„æ‰§è¡Œé”™è¯¯è€Œå¼•å‘</p></li><li><p>ALRM(14) æŠ¥è­¦ï¼Œé€šå¸¸ç”¨æ¥å¤„ç†è¶…æ—¶</p></li><li><p>TERM(15) ç»ˆæ­¢ï¼Œé€šå¸¸åœ¨ç³»ç»Ÿå…³æœºæ—¶å‘é€</p></li><li><p>KILL(9) æ€æ­»è¿›ç¨‹</p></li><li><p>STOP åœæ­¢è¿›ç¨‹æ‰§è¡Œ</p></li></ul><p>æ›´è¿‡çš„ä¿¡å· å¯ä»¥ä½¿ç”¨ trap -l å‘½ä»¤æ¥æŸ¥çœ‹</p>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA ä¸­çš„å¿«æ·é”®</title>
      <link href="/2018/07/13/2018-07-15-idea%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
      <url>/2018/07/13/2018-07-15-idea%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="IDEA-ä¸­çš„å¿«æ·é”®"><a href="#IDEA-ä¸­çš„å¿«æ·é”®" class="headerlink" title="IDEA ä¸­çš„å¿«æ·é”®"></a>IDEA ä¸­çš„å¿«æ·é”®</h1><p>ä»¥å‰ç»å¸¸ç”¨ideaå¼€å‘ï¼Œä½†æ˜¯ç«Ÿç„¶æ²¡æœ‰æ€ä¹ˆä½¿ç”¨åˆ°ideaçš„å¿«æ·é”®ã€‚ã€‚æ²¡æœ‰çœŸæ­£çš„ä½¿ç”¨åˆ°ideaä¸­éå¸¸é‡è¦çš„ç‰¹æ€§ã€‚ä»Šå¤©æ­£å¥½çœ‹åˆ°äº†æœ‰ä¸€ç¯‡å¾®ä¿¡å…¬ä¼—å·é‡Œæ–‡ç« æ€»ç»“äº†å…³äºå¸¸ç”¨çš„ideaå¿«æ·é”®ã€‚<br>é‚è€Œä¹Ÿæƒ³å°å°æ€»ç»“ä¸€ä¸‹ï¼Œå¸Œæœ›åœ¨ä»¥åçš„å¼€å‘ä¸­å¤šç”¨å¿«æ·é”®ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><ol><li><p>ctrl+alt+o = ä¼˜åŒ–å¯¼å…¥çš„åŒ…</p></li><li><p>alt+insert = åŠ å…¥ä»£ç </p></li><li><p>ctrl+alt+T = ç”Ÿæˆtryâ€“catchç»“æ„</p></li><li><p>alt+å›è½¦   = å¯¼å…¥åŒ…</p></li><li><p>ctrl+alt+l = æ ¼å¼åŒ–ä»£ç </p></li><li><p>ctrl+e     = æœ€è¿‘æ›´æ”¹çš„ä»£ç </p></li><li><p>Shift+F6   = é‡æ„-é‡å‘½å åŒ…ã€ç±»ã€æ–¹æ³•ã€å˜é‡ã€ç”šè‡³æ³¨é‡Šç­‰</p></li></ol><h2 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h2><ol><li><p>ctrl+Shift+backspace =å›åˆ°ä¸Šæ¬¡ç¼–è¾‘çš„åœ°æ–¹</p></li><li><p>ctrl+alt+left/right = å›åˆ°å‰åç¼–è¾‘çš„åœ°æ–¹</p></li><li><p>Shift+Shift åœ¨ç›®å½•ä¸­æŸ¥æ‰¾ç±»</p></li><li><p>ctrl+n æŸ¥æ‰¾ç±»</p></li><li><p>ctrl+Shift+n æŸ¥æ‰¾æ–‡ä»¶</p></li><li><p>ctrl+e æ‰“å¼€æœ€è¿‘æ–‡ä»¶</p></li><li><p>ctrl+f æ–‡ä»¶å†…å®¹æŸ¥æ‰¾</p></li><li><p>ctrl+shift+f å…¨å±€å†…å®¹æŸ¥æ‰¾</p></li><li><p>ctrl+w å¿«é€Ÿé€‰ä¸­</p></li><li><p>ctrl+b/ctrl+alt+b å¯¹åº”è¿™å›æº¯åˆ°çˆ¶ç±»å’Œåˆ°å­ç±»çš„å¿«æ·é”®</p></li></ol><h2 id="å¯¹è¡Œçš„åˆ é™¤ï¼Œå¤åˆ¶ï¼Œç²˜è´´æ“ä½œå¯ä»¥ä½¿ç”¨vimæ’ä»¶æ¥å®ç°"><a href="#å¯¹è¡Œçš„åˆ é™¤ï¼Œå¤åˆ¶ï¼Œç²˜è´´æ“ä½œå¯ä»¥ä½¿ç”¨vimæ’ä»¶æ¥å®ç°" class="headerlink" title="å¯¹è¡Œçš„åˆ é™¤ï¼Œå¤åˆ¶ï¼Œç²˜è´´æ“ä½œå¯ä»¥ä½¿ç”¨vimæ’ä»¶æ¥å®ç°"></a>å¯¹è¡Œçš„åˆ é™¤ï¼Œå¤åˆ¶ï¼Œç²˜è´´æ“ä½œå¯ä»¥ä½¿ç”¨vimæ’ä»¶æ¥å®ç°</h2><h2 id="æœ€åvimçš„åå¤§å¿«æ·é”®ï¼ˆcopyçš„ï¼‰"><a href="#æœ€åvimçš„åå¤§å¿«æ·é”®ï¼ˆcopyçš„ï¼‰" class="headerlink" title="æœ€åvimçš„åå¤§å¿«æ·é”®ï¼ˆcopyçš„ï¼‰"></a>æœ€åvimçš„åå¤§å¿«æ·é”®ï¼ˆcopyçš„ï¼‰</h2><p>Ã˜  Top #10åˆ‡æ¥åˆ‡å»ï¼šCtrl+Tab</p><p>Ã˜  Top #9é€‰ä½ æ‰€æƒ³ï¼šCtrl+W</p><p>Ã˜  Top #8ä»£ç ç”Ÿæˆï¼šTemplate/Postfix +Tab</p><p>Ã˜  Top #7å‘å·æ–½ä»¤ï¼šCtrl+Shift+A</p><p>Ã˜  Top #6æ— å¤„è—èº«ï¼šShift+Shift</p><p>Ã˜  Top #5è‡ªåŠ¨å®Œæˆï¼šCtrl+Shift+Enter</p><p>Ã˜  Top #4åˆ›é€ ä¸‡ç‰©ï¼šAlt+Insert</p><p>å¤ªéš¾å‰²èˆï¼Œå‰ä¸‰åå¹¶åˆ—å§ï¼</p><p>Ã˜  Top #1æ™ºèƒ½è¡¥å…¨ï¼šCtrl+Shift+Space</p><p>Ã˜  Top #1è‡ªæˆ‘ä¿®å¤ï¼šAlt+Enter</p><p>Ã˜  Top #1é‡æ„ä¸€åˆ‡ï¼šCtrl+Shift+Alt+T</p><h2 id="å¦å¤–è¡¥å……"><a href="#å¦å¤–è¡¥å……" class="headerlink" title="å¦å¤–è¡¥å……"></a>å¦å¤–è¡¥å……</h2><ol><li><p>alt+1 projectè§†å›¾</p></li><li><p>alt+7 ç±»æ–¹æ³•ç»“æ„</p></li><li><p>alt+home æ˜¾ç¤ºå¯¼èˆªæ </p></li><li><p>shift+f6 é‡å‘½å</p></li><li><p>ctrl+shift+åŠ å· æŠ˜å ä»£ç </p></li></ol><p>å…³é—­tabé¡µå…¶å®æ˜¯æœ‰å¿…è¦çš„</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> idea </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆåå…­ï¼‰ bashå­¦ä¹ ç»ˆç« </title>
      <link href="/2018/07/08/2018-07-06-bash_15_%E7%BB%88%E7%AB%A0/"/>
      <url>/2018/07/08/2018-07-06-bash_15_%E7%BB%88%E7%AB%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="bashå­¦ä¹ ç»ˆç« "><a href="#bashå­¦ä¹ ç»ˆç« " class="headerlink" title="bashå­¦ä¹ ç»ˆç« "></a>bashå­¦ä¹ ç»ˆç« </h1><p>å­¦ä¹ bashæœ‰å¾ˆé•¿æ—¶é—´äº†ï¼Œå¾ˆå¤šæ—¶é—´èŠ±è´¹åœ¨å­¦ä¹ åŸºç¡€è¯­æ³•ä¸Šï¼Œæ²¡æœ‰çœŸæ­£çš„ä¸Šæ‰‹å®è·µç¼–å†™ä¸€äº›ä½¿ç”¨çš„bashè„šæœ¬ï¼Œæ¥ä¸‹æ¥æˆ‘æŠŠå‰©ä½™çš„æ¯”è¾ƒå¸¸è§çš„bashè¯­æ³•å­¦ä¹ å®Œï¼Œæ‰¾ä¸€äº›githubä¸Šçš„çš„å¤§ç‰›å†™è¿‡çš„bashè„šæœ¬å»å…ˆ<br>åˆ†æï¼Œç„¶åè‡ªå·±è¾¹ç†è§£è¾¹å®è·µå§ï¼Œæˆ‘çš„ç›®æ ‡å°±æ˜¯èƒ½å¤ŸåŸºæœ¬ç†Ÿç»ƒçš„ä½¿ç”¨bashè„šæœ¬ã€‚</p><h2 id="bashçš„listç»“æ„"><a href="#bashçš„listç»“æ„" class="headerlink" title="bashçš„listç»“æ„"></a>bashçš„listç»“æ„</h2><p>è¿™é‡Œæ‰€è¯´åˆ°çš„listç»“æ„ä¸æ˜¯Javaè¯­è¨€ä¸­çš„listç»“æ„ï¼Œè€Œæ˜¯åœ¨åšæ¡ä»¶çš„æ—¶å€™çš„ä¸€ç§é“¾å¼æœºæ„ï¼Œå¯ä»¥ä½¿ç”¨ <code>&amp;&amp;</code> æˆ–è€… <code>||</code> æ¥å¤„ç†å¤šä¸ªå‘½ä»¤çš„æ–¹æ³•ã€‚</p><p>å…¶ä¸­åˆ†ä¸ºä¸¤ç§ç®€å•çš„ç»“æ„</p><ul><li>å’Œç»“æ„ ï¼ˆand listï¼‰</li></ul><p>è¿™ç§ç»“æ„ä¼šåŒæ—¶æ¯”è¾ƒå¤šä¸ªå‘½ä»¤ï¼Œå¦‚æœå‰ä¸€ä¸ªå‘½ä»¤è¿”å›trueï¼Œåˆ™ä¸‹ä¸€ä¸ªå‘½ä»¤ä¸€æ¬¡å»æ‰§è¡Œã€‚ä½†æ˜¯å¦‚æœå‰ä¸€ä¸ªå‘½ä»¤è¿”å›falseï¼Œé‚£ä¹ˆåé¢éƒ½ä¸å»æ‰§è¡Œï¼ˆå‘½ä»¤é“¾ç»ˆæ­¢ï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># command-1 &amp;&amp; command-2 &amp;&amp; command-3 &amp;&amp; ... command-n</span><br><span class="line">if [ ! -z &quot;$1&quot; ] &amp;&amp; echo &quot;Argument #1 = $1&quot; &amp;&amp; [ ! -z &quot;$2&quot; ] &amp;&amp;</span><br></pre></td></tr></table></figure><ul><li>ä¸ç»“æ„ ï¼ˆor listï¼‰</li></ul><p>è¿™ä¸ªç»“æ„å’Œ and listæ­£å¥½ç›¸åï¼Œå¦‚æœå‰ä¸€ä¸ªå‘½ä»¤è¿”å›falseï¼Œåˆ™ä¸‹ä¸€ä¸ªå‘½ä»¤ä¾æ¬¡å»æ‰§è¡Œã€‚å¦‚æœå‰ä¸€ä¸ªå‘½ä»¤æ—¶tureï¼Œé‚£ä¹ˆç»ˆæ­¢å‘½ä»¤é“¾ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># command-1 || command-2 || command-3 || ... command-n</span><br><span class="line">[ ! -f &quot;$file&quot; ] || (rm -f $file; echo &quot;File \&quot;$file\&quot; deleted.&quot;)</span><br></pre></td></tr></table></figure><h2 id="bashä¸­çš„æ•°ç»„"><a href="#bashä¸­çš„æ•°ç»„" class="headerlink" title="bashä¸­çš„æ•°ç»„"></a>bashä¸­çš„æ•°ç»„</h2><p>æ•°ç»„ä¹Ÿæ˜¯éå¸¸å¸¸è§çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆåœ¨bashä¸­å¦‚ä½•åˆå§‹åŒ–å’Œä½¿ç”¨æ•°ç»„å‘¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ç¬¬ä¸€ç§æ–¹å¼ä¸ºæ•°ç»„èµ‹å€¼</span><br><span class="line">area[11]=23</span><br><span class="line">area[13]=37</span><br><span class="line">area[51]=UFOs</span><br><span class="line"># ç¬¬äºŒç§æ–¹å¼</span><br><span class="line">area2=( zero one two three four )</span><br><span class="line"># ç¬¬ä¸‰ç§æ–¹å¼</span><br><span class="line">area3=([17]=seventeen [24]=twenty-four)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨å°æ‹¬å·è¿›è¡Œæ•°ç»„çš„åˆå§‹åŒ–ï¼Œä»¥åä¼šæ¥è§¦åˆ°æ›´å¤šå…³äºbashæ•°ç»„çš„å®ä¾‹ï¼Œæ¯”å¦‚å†™ä¸€ä¸ªä½¿ç”¨bashçš„å†’æ³¡æ’åºã€‚</p><h2 id="Linuxä¸­çš„-devå’Œ-proc"><a href="#Linuxä¸­çš„-devå’Œ-proc" class="headerlink" title="Linuxä¸­çš„ /devå’Œ /proc"></a>Linuxä¸­çš„ <code>/dev</code>å’Œ <code>/proc</code></h2><ul><li><code>/dev</code> æ˜¯è®¾å¤‡æ–‡ä»¶çš„ç›®å½•ï¼Œå¯ä»¥çœ‹å‡ºæ¥devæ—¶deviceè®¾å¤‡çš„ç¼©å†™ã€‚å¦‚æœæƒ³æŸ¥çœ‹æŸäº›ç‰¹å®šè®¾å¤‡çš„æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥å»å¯¹åº”çš„ <code>/dev/*</code>çš„ç›®å½•ä¸‹é¢å»æ‰¾å¯¹åº”çš„ç›®å½•å°±è¡Œäº†ã€‚</li></ul><p>ä½œä¸ºå‚è€ƒ</p><pre><code>/dev/hd[a-t]ï¼šIDEè®¾å¤‡/dev/sd[a-z]ï¼šSCSIè®¾å¤‡/dev/fd[0-7]ï¼šæ ‡å‡†è½¯é©±/dev/md[0-31]ï¼šè½¯raidè®¾å¤‡/dev/loop[0-7]ï¼šæœ¬åœ°å›ç¯è®¾å¤‡/dev/ram[0-15]ï¼šå†…å­˜/dev/nullï¼šæ— é™æ•°æ®æ¥æ”¶è®¾å¤‡ ,ç›¸å½“äºå›æ”¶ç«™/dev/zeroï¼šæ— é™é›¶èµ„æº/dev/tty[0-63]ï¼šè™šæ‹Ÿç»ˆç«¯/dev/ttyS[0-3]ï¼šä¸²å£/dev/lp[0-3]ï¼šå¹¶å£/dev/consoleï¼šæ§åˆ¶å°/dev/fb[0-31]ï¼šframebuffer/dev/cdrom =&gt; /dev/hdc/dev/modem =&gt; /dev/ttyS[0-9]/dev/pilot =&gt; /dev/ttyS[0-9]</code></pre><ul><li><code>/proc</code> å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯æ˜¯ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºä»–ä¹‹å­˜å‚¨ä¸€äº›å½“å‰å†…æ ¸çŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ã€‚ä»¥ä¸‹å°±ä¸è¯¦ç»†ä¸¾ä¾‹äº†ï¼Œå¯ä»¥çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ã€‚ä½¿ç”¨ catå‘½ä»¤æˆ–è€…lessä¹‹ç±»çš„æŸ¥çœ‹ã€‚</li></ul><h2 id="bashä¸­çš„nullå’Œ0"><a href="#bashä¸­çš„nullå’Œ0" class="headerlink" title="bashä¸­çš„nullå’Œ0"></a>bashä¸­çš„nullå’Œ0</h2><p>bashä¸­çš„nullå’Œzeroæ˜¯é€šè¿‡è®¾å¤‡èµ„æºæ–‡ä»¶ <code>/dev/null</code> , <code>/dev/zero</code> æ¥å®ç°çš„</p><ul><li>null ä½¿ç”¨ <code>dev/null</code> è¿™ä¸ªè®¾å¤‡æ–‡ä»¶æ˜¯ä¸€ä¸ªâ€é»‘æ´â€ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåªèƒ½å¤Ÿå†™æ–‡ä»¶ã€‚å†™è¿›å»çš„ä¸œè¥¿éƒ½ä¼šè¢«æ¸…ç©ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ä» <code>/dev/null</code> å†™å…¥åˆ°æ–‡ä»¶æ¥å®ç°æ¸…ç©ºæ–‡ä»¶å†…å®¹çš„ç›®çš„ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat newfile1 &gt; /dev/null #ä¼šä»€ä¹ˆä¹Ÿä¸è¾“å‡º</span><br><span class="line">cat /dev/null &gt; /var/log/wtmp # æ¸…ç©ºè¯¥æ–‡ä»¶å†…å®¹</span><br></pre></td></tr></table></figure><ul><li>zero ä¸ºæŒ‡å®šç›®çš„çš„æ–‡ä»¶æ¥æ¸…é›¶ï¼ˆæŒ‡å®šå¤§å°çš„æ–‡ä»¶ï¼‰</li></ul><h3 id="ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨bashå­¦ä¹ ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œå½“ç„¶ä¼šåœ¨ä»¥åå†™ä¸€äº›å®é™…çš„bashè„šæœ¬ã€‚è¿™ä¸ªbashå­¦ä¹ ç³»åˆ—å°±å†™åˆ°è¿™ã€‚"><a href="#ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨bashå­¦ä¹ ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œå½“ç„¶ä¼šåœ¨ä»¥åå†™ä¸€äº›å®é™…çš„bashè„šæœ¬ã€‚è¿™ä¸ªbashå­¦ä¹ ç³»åˆ—å°±å†™åˆ°è¿™ã€‚" class="headerlink" title="ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨bashå­¦ä¹ ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œå½“ç„¶ä¼šåœ¨ä»¥åå†™ä¸€äº›å®é™…çš„bashè„šæœ¬ã€‚è¿™ä¸ªbashå­¦ä¹ ç³»åˆ—å°±å†™åˆ°è¿™ã€‚"></a>ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨bashå­¦ä¹ ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œå½“ç„¶ä¼šåœ¨ä»¥åå†™ä¸€äº›å®é™…çš„bashè„šæœ¬ã€‚è¿™ä¸ªbashå­¦ä¹ ç³»åˆ—å°±å†™åˆ°è¿™ã€‚</h3>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆåäº”ï¼‰bashä¸­çš„å‡½æ•°å®šä¹‰ä¸ä½¿ç”¨</title>
      <link href="/2018/07/03/2018-07-03-bash_14_bash%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0/"/>
      <url>/2018/07/03/2018-07-03-bash_14_bash%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="bashä¸­çš„å‡½æ•°"><a href="#bashä¸­çš„å‡½æ•°" class="headerlink" title="bashä¸­çš„å‡½æ•°"></a>bashä¸­çš„å‡½æ•°</h1><p>å…¶å®bashå‡½æ•°å’Œbashè„šæœ¬æ—¶ä¸€æ ·çš„ï¼Œå‡½æ•°çš„ä½¿ç”¨å¦‚åŒä½¿ç”¨ä¸€æ®µbashè„šæœ¬å—ä¸€æ ·ã€‚ä½†æ˜¯å®šä¹‰ä¸ºbashå‡½æ•°æ‰§è¡Œæ›´å¿«ã€‚</p><h2 id="å‡½æ•°å®šä¹‰ä¸è°ƒç”¨"><a href="#å‡½æ•°å®šä¹‰ä¸è°ƒç”¨" class="headerlink" title="å‡½æ•°å®šä¹‰ä¸è°ƒç”¨"></a>å‡½æ•°å®šä¹‰ä¸è°ƒç”¨</h2><p>ä¸å¾ˆå¤šè„šæœ¬è¯­è¨€ä¸€æ ·ï¼Œä½¿ç”¨ <code>function</code> ä½œä¸ºå…³é”®è¯æ¥å£°æ˜å‡½æ•°ã€‚ä¸‹é¢æ¥ä½¿ç”¨ä¸€æ®µä¾‹å­ä»£ç æ¥è¯´æ˜å‡½æ•°çš„å®šä¹‰çš„æ ¼å¼ã€‚ä¹ä¸€çœ‹æ˜¯ä¸æ˜¯å’Œjsæœ‰ç‚¹åƒå‘¢ã€‚ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function hello()&#123;</span><br><span class="line">echo &quot;ä½¿ç”¨å‡½æ•°ä¼šè¾“å‡ºè¿™å¥è¯&quot;</span><br><span class="line">return 1</span><br><span class="line">&#125;</span><br><span class="line">hello #ä½¿ç”¨å‡½æ•°</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°çš„å‚æ•°ä¼ é€’"><a href="#å‡½æ•°çš„å‚æ•°ä¼ é€’" class="headerlink" title="å‡½æ•°çš„å‚æ•°ä¼ é€’"></a>å‡½æ•°çš„å‚æ•°ä¼ é€’</h2><p>ä¸ç¼–å†™bashç›¸ä¼¼ï¼Œå‚æ•°ä½¿ç”¨ <code>$+ä½ç½®çš„å½¢å¼è·å–</code> å¦‚$1è·å–ç´§è·Ÿåœ¨è°ƒç”¨å‡½æ•°åçš„ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function hello()&#123;</span><br><span class="line">echo &quot;ä½¿ç”¨å‡½æ•°ä¼šè¾“å‡ºè¿™å¥è¯&quot;</span><br><span class="line">echo &quot;è¾“å‡ºç¬¬ä¸€ä¸ªå‚æ•° $1&quot;</span><br><span class="line">return 1</span><br><span class="line">&#125;</span><br><span class="line">hello world</span><br><span class="line"># è¾“å‡ºç»“æœ â€˜ è¾“å‡ºç¬¬ä¸€ä¸ªå‚æ•° world â€™</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°çš„è¿”å›å€¼"><a href="#å‡½æ•°çš„è¿”å›å€¼" class="headerlink" title="å‡½æ•°çš„è¿”å›å€¼"></a>å‡½æ•°çš„è¿”å›å€¼</h2><p>ä½¿ç”¨returnæ¥è¿”å›ç‰¹å®šå€¼ å¦‚ä¸Šé¢çš„å‡½æ•°ä¸­ä½¿ç”¨åˆ°äº† <code>return 1</code> ,åœ¨returnåå‘ç”Ÿçš„è¯­å¥éƒ½ä¸èƒ½è¢«æ‰§è¡Œã€‚å¹¶ä¸”returnçš„çš„å€¼åªèƒ½åœ¨1~256ä¹‹é—´çš„æ•°ã€‚ä½¿ç”¨$?æ¥è·å–è¿”å›åˆ°å€¼ã€‚</p><h2 id="å‡½æ•°çš„åµŒå¥—"><a href="#å‡½æ•°çš„åµŒå¥—" class="headerlink" title="å‡½æ•°çš„åµŒå¥—"></a>å‡½æ•°çš„åµŒå¥—</h2><p>å¦‚åŒåœ¨Java jsä¸­ä½¿ç”¨å‡½æ•°ç±»ä¼¼ï¼Œbashä¸­çš„å‡½æ•°ä¹Ÿå…è®¸ä½¿ç”¨åµŒå¥—ç»“æ„ã€‚ä½†æ˜¯éœ€è¦åœ¨å¤–å±‚å‡½æ•°è°ƒç”¨å†…å®¹å‡½æ•°ã€‚è¿™æ˜¯å½“ç„¶çš„äº†ï¼Œå› ä¸ºåœ¨å†…éƒ¨å£°æ˜å‡½æ•°ï¼Œå´æ²¡æœ‰è°ƒç”¨ï¼Œè¿™å½“ç„¶æ—¶ä¸èµ·ä½œç”¨çš„äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function x1()&#123;</span><br><span class="line">        echo &quot;åœ¨å‡½æ•°x1ä¸­ï¼&quot;</span><br><span class="line">        function x2()&#123;</span><br><span class="line">        echo &quot;åœ¨å‡½æ•°x2ä¸­ï¼&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        x2 # è¿™é‡Œéœ€è¦è°ƒç”¨å†…å±‚å‡½æ•°</span><br><span class="line">&#125;</span><br><span class="line">x1</span><br><span class="line">#ç»“æœï¼š</span><br><span class="line">#åœ¨å‡½æ•°x1ä¸­ï¼</span><br><span class="line">#åœ¨å‡½æ•°x2ä¸­ï¼</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆåå››ï¼‰linuxä¸­çš„IO</title>
      <link href="/2018/07/01/2018-07-01-bash_13_bash%E4%B8%AD%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/"/>
      <url>/2018/07/01/2018-07-01-bash_13_bash%E4%B8%AD%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="linuxä¸­çš„IO"><a href="#linuxä¸­çš„IO" class="headerlink" title="linuxä¸­çš„IO"></a>linuxä¸­çš„IO</h1><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><p>linuxä¸­æ€»æœ‰ä¸‰ç§æ–‡ä»¶ï¼Œä¸€ç§æ—¶stdinï¼ˆæ ‡å‡†è¾“å…¥ï¼‰ï¼Œstdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ï¼Œstderrï¼ˆæ ‡å‡†é”™è¯¯ï¼‰ï¼Œå¯ä»¥é‡å®šå‘è¿™äº›å’Œå…¶ä»–ä»»æ„æ–‡ä»¶ï¼Œé‡å®šå‘çš„ç›®çš„å°±æ˜¯å¯ä»¥å°†æ–‡ä»¶ä¸­çš„ä»»æ„å†…å®¹ä½œä¸ºè¾“å‡ºæˆ–è€…è¾“å‡ºæºã€‚</p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>ç³»ç»Ÿä¸ºæ¯ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶åˆ†é…ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆFDï¼‰ï¼Œä¸ºæ ‡å‡†è¾“å…¥stdinï¼Œæ ‡å‡†è¾“å‡ºstdout,æ ‡å‡†é”™è¯¯stderråˆ†åˆ«åˆ†é…ç»™0ï¼Œ1ï¼Œ2</p><p>ç®€å•è¾“å…¥è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;helloworld&quot;  &gt; newfile1</span><br><span class="line">echo &quot;helloworld&quot; 1 &gt; newfile1 #ç­‰åŒäºç¬¬ä¸€å¥</span><br><span class="line">echo &quot;helloworld&quot; 1 &gt;&gt; newfile1 #è¿½åŠ å†…å®¹</span><br><span class="line"></span><br><span class="line">command &lt; newfile1 #æ ‡å‡†è¾“å…¥ åŒç†ç­‰åŒäºcat 0 &lt; newfile1</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls 2&gt; newfile #å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°newfileä¸­</span><br><span class="line">ls &gt; newfile 2&gt;1&amp; #å°†æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡ºä¸€èµ·è¾“å‡ºåˆ°newfileä¸­</span><br><span class="line"># å…¶ä¸­&amp;è¡¨ç¤ºå’Œçš„å…³ç³»</span><br></pre></td></tr></table></figure><p>ç»‘å®šé‡å®šå‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls &gt;&amp; m #æŠŠæ ‡å‡†è¾“å‡ºåˆ°æ–‡ä»¶æè¿°ç¬¦mä¸­</span><br><span class="line">ls &lt; &amp;- #å…³é—­æ ‡å‡†è¾“å…¥</span><br><span class="line">n &lt; &amp;- #å…³é—­è¾“å…¥æ–‡ä»¶æè¿°ç¬¦n</span><br><span class="line">n &gt; &amp;- #å…³é—­è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦n</span><br><span class="line">1&gt;&amp;-, &gt;&amp;- # å…³é—­æ ‡å‡†è¾“å‡º</span><br></pre></td></tr></table></figure><h3 id="å…¶å®åœ¨linux-ä¸‹ä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ã€‚æŠŠæ‰€æœ‰éƒ½æƒ³æˆæ–‡ä»¶å°±å¥½ç†è§£çš„å¤šäº†ã€‚"><a href="#å…¶å®åœ¨linux-ä¸‹ä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ã€‚æŠŠæ‰€æœ‰éƒ½æƒ³æˆæ–‡ä»¶å°±å¥½ç†è§£çš„å¤šäº†ã€‚" class="headerlink" title="å…¶å®åœ¨linux ä¸‹ä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ã€‚æŠŠæ‰€æœ‰éƒ½æƒ³æˆæ–‡ä»¶å°±å¥½ç†è§£çš„å¤šäº†ã€‚"></a>å…¶å®åœ¨linux ä¸‹ä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ã€‚æŠŠæ‰€æœ‰éƒ½æƒ³æˆæ–‡ä»¶å°±å¥½ç†è§£çš„å¤šäº†ã€‚</h3>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆåä¸€ï¼‰å‘½ä»¤ç¯‡ï¼ˆ2ï¼‰</title>
      <link href="/2018/06/24/2018-06-24-bash_10_bash%E5%91%BD%E4%BB%A4%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2018/06/24/2018-06-24-bash_10_bash%E5%91%BD%E4%BB%A4%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="bashå‘½ä»¤ä»¤ç¯‡ï¼ˆäºŒï¼‰"><a href="#bashå‘½ä»¤ä»¤ç¯‡ï¼ˆäºŒï¼‰" class="headerlink" title="bashå‘½ä»¤ä»¤ç¯‡ï¼ˆäºŒï¼‰"></a>bashå‘½ä»¤ä»¤ç¯‡ï¼ˆäºŒï¼‰</h1><h2 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h2><p>åŸºæœ¬å‘½ä»¤å°±æ˜¯éå¸¸éœ€è¦åˆå­¦è€…æŒæ¡çš„é‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œåªæœ‰æŒæ¡è¿™ç§åŸºæœ¬çš„å‘½ä»¤æ‰èƒ½ç¨å¾®ç†Ÿç»ƒçš„æ“ä½œlinuxã€‚å…·ä½“çš„åŸºæœ¬å‘½ä»¤ä¹Ÿä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œå¯¹äºè¿™ç§åŸºæœ¬å‘½ä»¤ç”¨å‡ éå°±èƒ½å¤ŸæŒæ¡äº†ã€‚è€Œä¸”ç½‘ä¸Šçš„æ•™ç¨‹ä¸€å¤§å †ã€‚</p><h2 id="æ—¶é—´æ—¥æœŸå‘½ä»¤"><a href="#æ—¶é—´æ—¥æœŸå‘½ä»¤" class="headerlink" title="æ—¶é—´æ—¥æœŸå‘½ä»¤"></a>æ—¶é—´æ—¥æœŸå‘½ä»¤</h2><ul><li><p>date: æ‰“å°æˆ–è€…æ˜¯è®¾ç½®æœ¬åœ°æ—¶é—´ã€‚ä¸»è¦è¯­æ³•å¯ä»¥ <code>man date</code>  ä¸»è¦æœ‰date -u æ‰“å° UTCæ—¶é—´ã€‚åœ¨åé¢å¯ä»¥ä½¿ç”¨ +å‚æ•°çš„å½¢å¼æ ¼å¼åŒ–ä¸ºå…·ä½“çš„æ—¶é—´æ ¼å¼ã€‚</p></li><li><p>zdump: è¾“å‡ºç‰¹æ®Šæ—¶åŒºçš„æ—¶é—´ã€‚å¦‚ <code>zdump EMP</code></p></li><li><p>timeï¼š è¾“å‡ºè¯¦ç»†çš„æ—¶é—´ä¿¡æ¯æ¯”å¦‚ <code>time ls -l</code></p></li><li><p>at: atå‘½ä»¤ä¸€èˆ¬ä½¿ç”¨åœ¨ç‰¹å®šæ—¶é—´æ‰§è¡Œçš„æ—¶å€™ã€‚</p></li><li><p>batchï¼šbatchå‘½ä»¤å’Œatå‘½ä»¤ç›¸ä¼¼ã€‚ä¸åŒåœ¨äºbatchå‘½ä»¤èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šæ¡å‘½ä»¤ã€‚</p></li><li><p>calï¼šcalå‘½ä»¤å¯ä»¥æ•´æ´çš„æ‰“å°å‡ºæ¥æ—¥å†</p></li><li><p>sleepï¼šsleepå¯ä»¥ä½¿shellæš‚åœå›ºå®šæ—¶é—´é•¿åº¦</p></li><li><p>hwclockï¼šè®¿é—®ç¡¬ä»¶ç³»ç»Ÿæ—¶é—´ã€‚éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚</p></li></ul><h2 id="æ–‡æœ¬å’Œæ–‡ä»¶å¤„ç†å‘½ä»¤"><a href="#æ–‡æœ¬å’Œæ–‡ä»¶å¤„ç†å‘½ä»¤" class="headerlink" title="æ–‡æœ¬å’Œæ–‡ä»¶å¤„ç†å‘½ä»¤"></a>æ–‡æœ¬å’Œæ–‡ä»¶å¤„ç†å‘½ä»¤</h2><ul><li><p>sortï¼šæ–‡ä»¶æ’åºçš„å®ç”¨æ€§å·¥å…·ï¼ŒåŒæ—¶å‡ºç°åœ¨ç®¡é“å½“ä¸­ï¼Œå¯ä»¥ä½¿ç”¨-mé€‰é¡¹åˆå¹¶é¢„åˆ†ç±»çš„è¾“å…¥æ–‡ä»¶ã€‚</p></li><li><p>uniqï¼šä½¿ç”¨uniqå‘½ä»¤èƒ½å¤Ÿå»é™¤é‡å¤çš„è¡Œï¼Œé€šå¸¸å’Œsortä½¿ç”¨åœ¨ç®¡é“å½“ä¸­ã€‚</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat list_1.txt|uniq -c|sort -nr</span><br><span class="line">     5 this is the second line</span><br><span class="line">     3 this is the first line</span><br><span class="line">     1 this is the third line</span><br></pre></td></tr></table></figure><ul><li>expand:å¯ä»¥å°†tabè½¬æ¢æˆæ™®é€šç©ºæ ¼ï¼Œunexpandå¯ä»¥å°†ç©ºæ ¼è½¬æ¢æˆtabï¼ŒåŒæ ·æ¯”è¾ƒå¸¸è§åœ¨ç®¡é“å‘½ä»¤å½“ä¸­ã€‚</li></ul><p>cutï¼šä»æ–‡ä»¶ä¸­æå–å­—æ®µçš„å·¥å…·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cut -d &apos; &apos; -f 1,2 list_1.txt</span><br></pre></td></tr></table></figure><ul><li><p>paste:åˆå¹¶ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæ˜¯æ¯è¡Œéƒ½å¯¹åº”åˆå¹¶ã€‚è€Œä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶åˆå¹¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶çš„ä¸‹é¢ã€‚</p></li><li><p>joinï¼šå’Œpasteå‘½ä»¤ç›¸ä¼¼ï¼Œä½†æ˜¯joinå‘½ä»¤åªç²˜è´´ä¸¤æ–‡ä»¶æœ‰å…±åŒæ ‡è®°çš„è¡Œï¼Œä¸€èˆ¬è¿™ä¸ªæ ‡è®°æ˜¯æ•°å­—ã€‚</p></li><li><p>headï¼šè¾“å‡ºæ–‡ä»¶çš„å‰10è¡Œï¼Œä¹Ÿå¯ä»¥æ›´æ”¹è¾“å‡ºçš„è¡Œæ•°ã€‚</p></li><li><p>tailï¼šè¾“å‡ºæ–‡ä»¶çš„æœ«å°¾10è¡Œï¼ŒåŒæ ·çš„å¯ä»¥æ›´æ”¹è¾“å‡ºçš„è¡Œæ•°ã€‚</p></li><li><p>grepï¼šæ­£åˆ™åŒ¹é…å‡ºæ–‡ä»¶çš„å†…å®¹ï¼Œä¸€èˆ¬ä½¿ç”¨åœ¨ç®¡é“ä¸­ï¼Œç”¨æ¥åŒ¹é…ä¸Šä¸€ä¸ªè¾“å…¥æˆ–è€…æ–‡ä»¶çš„åŒ¹é…åˆ°çš„å†…å®¹</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat list_1.txt| grep &quot;third&quot;  </span><br><span class="line">this is the third line</span><br><span class="line">              ^ è¿™é‡Œçš„thirdæ˜¯çº¢è‰²çš„è¡¨ç¤ºåŒ¹é…åˆ°çš„å†…å®¹</span><br></pre></td></tr></table></figure><ul><li>wcï¼šè¾“å‡ºæ–‡ä»¶çš„è¡Œæ•°å­—æ•°ç­‰ä¿¡æ¯</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wc /usr/share/doc/sed-4.1.2/README</span><br><span class="line">13  70  447 README</span><br><span class="line">[13 lines  70 words  447 characters]</span><br></pre></td></tr></table></figure><ul><li>tr å­—ç¬¦ç¿»è¯‘çš„è¿‡æ»¤å™¨ï¼Œå°†ç‰¹å®šå­—ç¬¦æ›¿æ¢æˆå…¶ä»–å­—ç¬¦</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ tr &quot;is&quot; &quot;*&quot; &lt; list_1.txt  </span><br><span class="line">th** ** the f*r*t l*ne</span><br><span class="line">th** ** the *econd l*ne</span><br><span class="line">th** ** the th*rd l*ne</span><br></pre></td></tr></table></figure><ul><li><p>nl nlå’Œcat -bæœ‰ç€ç›¸ä¼¼çš„æ„ä¹‰ï¼Œéƒ½èƒ½å¤Ÿè¿åŒè¡Œå·æ‰“å°å‡ºæ¥ï¼Œä¸åŒçš„æ˜¯ï¼Œnlå¯ä»¥å°†ç©ºè¡Œå»é™¤æ‰ã€‚</p></li><li><p>iconv è¿™ä¸ªå‘½ä»¤èƒ½å¤Ÿå°†æ–‡ä»¶è½¬æ¢ç¼–ç ï¼Œå¦‚utf-8è½¬æ¢æˆutf-16è¿™ç±»çš„è½¬åŒ–ã€‚</p></li></ul><h3 id="è¿™ç±»å‘½ä»¤çœŸçš„å¾ˆå¤šï¼Œéœ€è¦ç§¯ç´¯çš„ä¸œè¥¿ä¹Ÿå¾ˆå¤šï¼Œæˆ‘åœ¨è¿™é‡Œå°±åšä¸ªç®€å•çš„è¯´æ˜ï¼Œå…·ä½“çš„ä½¿ç”¨å¯ä»¥-man-å‘½ä»¤-æŸ¥çœ‹å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ã€‚ä¹Ÿæ˜¯å­¦ä¹ çš„ä¸€ç§æ–¹å¼ï¼ï¼"><a href="#è¿™ç±»å‘½ä»¤çœŸçš„å¾ˆå¤šï¼Œéœ€è¦ç§¯ç´¯çš„ä¸œè¥¿ä¹Ÿå¾ˆå¤šï¼Œæˆ‘åœ¨è¿™é‡Œå°±åšä¸ªç®€å•çš„è¯´æ˜ï¼Œå…·ä½“çš„ä½¿ç”¨å¯ä»¥-man-å‘½ä»¤-æŸ¥çœ‹å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ã€‚ä¹Ÿæ˜¯å­¦ä¹ çš„ä¸€ç§æ–¹å¼ï¼ï¼" class="headerlink" title="è¿™ç±»å‘½ä»¤çœŸçš„å¾ˆå¤šï¼Œéœ€è¦ç§¯ç´¯çš„ä¸œè¥¿ä¹Ÿå¾ˆå¤šï¼Œæˆ‘åœ¨è¿™é‡Œå°±åšä¸ªç®€å•çš„è¯´æ˜ï¼Œå…·ä½“çš„ä½¿ç”¨å¯ä»¥ man å‘½ä»¤ æŸ¥çœ‹å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ã€‚ä¹Ÿæ˜¯å­¦ä¹ çš„ä¸€ç§æ–¹å¼ï¼ï¼"></a>è¿™ç±»å‘½ä»¤çœŸçš„å¾ˆå¤šï¼Œéœ€è¦ç§¯ç´¯çš„ä¸œè¥¿ä¹Ÿå¾ˆå¤šï¼Œæˆ‘åœ¨è¿™é‡Œå°±åšä¸ªç®€å•çš„è¯´æ˜ï¼Œå…·ä½“çš„ä½¿ç”¨å¯ä»¥ man å‘½ä»¤ æŸ¥çœ‹å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ã€‚ä¹Ÿæ˜¯å­¦ä¹ çš„ä¸€ç§æ–¹å¼ï¼ï¼</h3>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆåäºŒï¼‰å‘½ä»¤ç¯‡ï¼ˆ3ï¼‰</title>
      <link href="/2018/06/24/2018-06-27-bash_11_bash%E5%91%BD%E4%BB%A4%E7%AF%87%EF%BC%88%E4%B8%89%EF%BC%89/"/>
      <url>/2018/06/24/2018-06-27-bash_11_bash%E5%91%BD%E4%BB%A4%E7%AF%87%EF%BC%88%E4%B8%89%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="bashå‘½ä»¤ç¯‡ï¼ˆä¸‰ï¼‰"><a href="#bashå‘½ä»¤ç¯‡ï¼ˆä¸‰ï¼‰" class="headerlink" title="bashå‘½ä»¤ç¯‡ï¼ˆä¸‰ï¼‰"></a>bashå‘½ä»¤ç¯‡ï¼ˆä¸‰ï¼‰</h1><h2 id="bashä¸­çš„å…³äºé€šä¿¡çš„å‘½ä»¤"><a href="#bashä¸­çš„å…³äºé€šä¿¡çš„å‘½ä»¤" class="headerlink" title="bashä¸­çš„å…³äºé€šä¿¡çš„å‘½ä»¤"></a>bashä¸­çš„å…³äºé€šä¿¡çš„å‘½ä»¤</h2><ol><li>host é€šè¿‡ipæˆ–è€…åŸŸåæœç´¢äº’è”ç½‘çš„ä¸»æœºåœ°å€ï¼ˆä½¿ç”¨DNSï¼‰</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ host www.baidu.com</span><br><span class="line">www.baidu.com has address 61.135.169.125</span><br><span class="line">www.baidu.com has address 61.135.169.121</span><br><span class="line">www.baidu.com is an alias for www.a.shifen.com.</span><br><span class="line">www.baidu.com is an alias for www.a.shifen.com.</span><br></pre></td></tr></table></figure><ol start="2"><li>nslookup å‘ä¸Šå¯»æ‰¾name server</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ nslookup  -sil 66.97.104.180 </span><br><span class="line">Server:127.0.1.1</span><br><span class="line">Address:127.0.1.1#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">180.104.97.66.in-addr.arpaname = 66-97-104-180.dynamic.bugtusselwireless.com.</span><br><span class="line"></span><br><span class="line">Authoritative answers can be found from:</span><br><span class="line">104.97.66.in-addr.arpanameserver = ns2.bugnet.net.</span><br><span class="line">104.97.66.in-addr.arpanameserver = ns1.bugnet.net.</span><br><span class="line">ns1.bugnet.netinternet address = 204.11.133.241</span><br><span class="line">ns2.bugnet.netinternet address = 204.11.133.244</span><br></pre></td></tr></table></figure><ol start="3"><li><p>ping ç†ŸçŸ¥çš„pingå‘½ä»¤ï¼Œå¸¸ç”¨æ¥æ¢æµ‹ä¸å¦ä¸€ä¸ªä¸»æœºæ˜¯å¦æœ‰ç½‘ç»œé“¾æ¥</p></li><li><p>ftp ä»è¿œç¨‹ä¸»æœºä¸‹è½½æˆ–è€…ä¸Šä¼ ç»™è¿œç¨‹ä¸»æœºçš„åè®®ã€‚</p></li><li><p>telnt é“¾æ¥è¿œç¨‹ä¸»æœºçš„åè®®</p></li><li><p>wget ä½¿ç”¨éäº¤äº’å¼çš„ä»ç½‘ç«™webæˆ–è€…ftpç«™ç‚¹ä¸‹è½½æ–‡ä»¶ã€‚</p></li><li><p>rcp è¿œç¨‹æ‹·è´ï¼Œåœ¨ä¸¤å°ä¸åŒçš„æœºå™¨é—´æ‹·è´ã€‚</p></li><li><p>ssh <code>secure shell</code> ä»–ä»£æ›¿äº†telnt rcpç­‰å‘½ä»¤ã€‚</p></li><li><p>scp <code>secure cp</code> ä»–ç”¨æ¥ä»£æ›¿rcpå‘½ä»¤ï¼Œéœ€è¦ç™»å½•æˆæƒçš„è¿œç¨‹æ‹·è´æ–‡ä»¶çš„å‘½ä»¤ã€‚</p><p> è¿™é‡Œåªæ˜¯ç®€ç•¥çš„è°ˆè°ˆå¸¸è§çš„å…³äºæœºå™¨äº¤äº’çš„å‘½ä»¤ï¼Œè¿™äº›éƒ½æ˜¯ç†Ÿèƒ½ç”Ÿå·§çš„ä¸œè¥¿ï¼Œæœ€é‡è¦çš„æ˜¯è¦ä¸Šæ‰‹ç»ƒä¹ ã€‚</p></li></ol><h2 id="æ•°å­¦è¿ç®—ç¬¦"><a href="#æ•°å­¦è¿ç®—ç¬¦" class="headerlink" title="æ•°å­¦è¿ç®—ç¬¦"></a>æ•°å­¦è¿ç®—ç¬¦</h2><ol><li><p>dcï¼šdcæ˜¯ä½¿ç”¨é€†æ³¢å…°è¡¨ç¤ºæ³•è¿›è¡Œè®¡ç®—ï¼Œå¦‚ 11 +   ï¼Œ3 6 *</p></li><li><p>bcï¼šbcæ˜¯ç°ä»£linuxä¸‹æ¯”è¾ƒå¸¸è§å¤„ç†å¤æ‚è¿ç®—çš„å‘½ä»¤é‚£ä¸ªï¼Œå¯ä»¥è®¡ç®—æµ®ç‚¹æ•°ã€‚</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$bc -l -q</span><br><span class="line">4/3                   /*æœªæŒ‡å®šç²¾åº¦é»˜è®¤ä¿ç•™æ•´æ•°*/</span><br><span class="line">scale=5               /*æŒ‡å®šç²¾åº¦ä¸º5*/</span><br><span class="line">4/3</span><br><span class="line">1.33333</span><br><span class="line">ibase=2               /*æŒ‡å®šè¿›åˆ¶è½¬æ¢çš„è¾“å…¥æœºåˆ¶ä¸ºäºŒè¿›åˆ¶ï¼Œè¾“å‡ºé»˜è®¤ä¸ºæ˜¯åè¿›åˆ¶*/</span><br><span class="line">10</span><br><span class="line">4^2                   /*æŒ‡æ•°è¿ç®—ï¼Œæ³¨ï¼šæŒ‡æ•°ä¸èƒ½ä¸ºæµ®ç‚¹æ•°*/</span><br><span class="line">4*a(1)                /*è®¡ç®—Ï€å€¼ï¼Œa()æ˜¯ä¸ªå‡½æ•°ï¼šarctan()ï¼Œå¥½å§ï¼Œè€å¸ˆæ•™çš„éƒ½è¢«ç‹—åƒäº†ï¼ŒÏ€å€¼æ˜¯ç­‰äºå››å€çš„arctan(1)ä¹ˆï¼Ÿ*/</span><br><span class="line">3.14159265358979323844</span><br><span class="line">quit                  /*é€€å‡º*/</span><br></pre></td></tr></table></figure><ol start="3"><li>let: è¡¨è¾¾å¼å¯ä»¥åº”ç”¨åœ¨letå‘½ä»¤å½“ä¸­ã€‚</li></ol><h3 id="å…¶å®åœ¨æˆ‘ä½¿ç”¨linuxç³»ç»Ÿçš„å‡ å¹´é‡Œï¼Œæ„Ÿè§‰å‘½ä»¤ä¸èƒ½æ­»è®°ç¡¬èƒŒï¼Œå¤šç”¨è‡ªç„¶å°±ä¼šæŒæ¡äº†ã€‚ä½†æ˜¯æœ‰äº›æ¯”è¾ƒå†·é—¨çš„å‘½ä»¤è¿˜æ˜¯èƒŒä¸‹æ¥æ¯”è¾ƒå¥½-ã€‚"><a href="#å…¶å®åœ¨æˆ‘ä½¿ç”¨linuxç³»ç»Ÿçš„å‡ å¹´é‡Œï¼Œæ„Ÿè§‰å‘½ä»¤ä¸èƒ½æ­»è®°ç¡¬èƒŒï¼Œå¤šç”¨è‡ªç„¶å°±ä¼šæŒæ¡äº†ã€‚ä½†æ˜¯æœ‰äº›æ¯”è¾ƒå†·é—¨çš„å‘½ä»¤è¿˜æ˜¯èƒŒä¸‹æ¥æ¯”è¾ƒå¥½-ã€‚" class="headerlink" title="å…¶å®åœ¨æˆ‘ä½¿ç”¨linuxç³»ç»Ÿçš„å‡ å¹´é‡Œï¼Œæ„Ÿè§‰å‘½ä»¤ä¸èƒ½æ­»è®°ç¡¬èƒŒï¼Œå¤šç”¨è‡ªç„¶å°±ä¼šæŒæ¡äº†ã€‚ä½†æ˜¯æœ‰äº›æ¯”è¾ƒå†·é—¨çš„å‘½ä»¤è¿˜æ˜¯èƒŒä¸‹æ¥æ¯”è¾ƒå¥½ - -ã€‚"></a>å…¶å®åœ¨æˆ‘ä½¿ç”¨linuxç³»ç»Ÿçš„å‡ å¹´é‡Œï¼Œæ„Ÿè§‰å‘½ä»¤ä¸èƒ½æ­»è®°ç¡¬èƒŒï¼Œå¤šç”¨è‡ªç„¶å°±ä¼šæŒæ¡äº†ã€‚ä½†æ˜¯æœ‰äº›æ¯”è¾ƒå†·é—¨çš„å‘½ä»¤è¿˜æ˜¯èƒŒä¸‹æ¥æ¯”è¾ƒå¥½ - -ã€‚</h3>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆåä¸‰ï¼‰å‘½ä»¤ç¯‡ï¼ˆ4ï¼‰</title>
      <link href="/2018/06/24/2018-06-28-bash_12_bash%E7%AE%A1%E7%90%86%E5%91%98%E5%91%BD%E4%BB%A4/"/>
      <url>/2018/06/24/2018-06-28-bash_12_bash%E7%AE%A1%E7%90%86%E5%91%98%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="ç³»ç»Ÿå‘½ä»¤"><a href="#ç³»ç»Ÿå‘½ä»¤" class="headerlink" title="ç³»ç»Ÿå‘½ä»¤"></a>ç³»ç»Ÿå‘½ä»¤</h1><p>linuxä¸Šæä¾›éå¸¸å¤šçš„æœ‰å…³äºç³»ç»Ÿçš„å‘½ä»¤ï¼Œæˆ‘åªèƒ½æŒ‘å‡ºæˆ‘æ¯”è¾ƒå¸¸è§çš„å‘½ä»¤æ¥è®°å½•ä¸‹æ¥ã€‚</p><h2 id="ç”¨æˆ·ä¸ç”¨æˆ·ç»„"><a href="#ç”¨æˆ·ä¸ç”¨æˆ·ç»„" class="headerlink" title="ç”¨æˆ·ä¸ç”¨æˆ·ç»„"></a>ç”¨æˆ·ä¸ç”¨æˆ·ç»„</h2><ul><li><p>users æ˜¾ç¤ºæ‰€æœ‰ç™»å½•ç”¨æˆ·</p></li><li><p>groups åˆ—å‡ºå½“å‰ç”¨æˆ·å’Œä»–æ‰€åœ¨çš„ç”¨æˆ·ç»„</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ groups</span><br><span class="line">nanyin adm cdrom sudo dip plugdev input lpadmin sambashare</span><br></pre></td></tr></table></figure><ul><li><p>chown å‘½ä»¤å¯ä»¥æ”¹å˜æ–‡ä»¶æ‰€å±çš„ç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„ã€‚ä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ç»™ç”¨æˆ·æŸäº›æ–‡ä»¶çš„æƒé™ã€‚</p></li><li><p>chgrp å‘½ä»¤å¯ä»¥æ”¹å˜ç”¨æˆ·æ‰€å±ç»„ã€‚</p></li><li><p>useradd å¯ä»¥ä¸ºç³»ç»Ÿæ·»åŠ ä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºè¯¥ç”¨æˆ·çš„homeæ–‡ä»¶å¤¹ã€‚åˆ é™¤ç”¨æˆ·å¯ä»¥ä½¿ç”¨userdelå‘½ä»¤è¿›è¡Œåˆ é™¤ã€‚</p></li><li><p>usermod å‘½ä»¤å¯ä»¥æ”¹å˜ç”¨æˆ·å±æ€§ï¼Œå¯ä»¥æ˜¯å¯†ç ä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·ç»„ä¹‹ç±»çš„</p></li><li><p>id å‘½ä»¤å¯ä»¥æ‰“å°å‡ºç”¨æˆ·åŠæ‰€åœ¨ç”¨æˆ·ç»„çš„ç”¨æˆ·åå’Œç»„åä»¥åŠå¯¹åº”çš„idå€¼</p></li><li><p>whoami æ‰“å°å‡ºå½“å‰ç”¨æˆ·çš„ç”¨æˆ·åç§°</p></li><li><p>passwd è®¾ç½®ï¼Œæ›´æ”¹å’Œç®¡ç†ç”¨æˆ·çš„å¯†ç </p></li></ul><h2 id="åŸºæœ¬ä¿¡æ¯å’ŒçŠ¶æ€"><a href="#åŸºæœ¬ä¿¡æ¯å’ŒçŠ¶æ€" class="headerlink" title="åŸºæœ¬ä¿¡æ¯å’ŒçŠ¶æ€"></a>åŸºæœ¬ä¿¡æ¯å’ŒçŠ¶æ€</h2><ul><li><p>uname å¯ä»¥è¾“å‡ºç³»ç»Ÿçš„å…·ä½“å‚æ•°å¦‚å†…æ ¸ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚</p></li><li><p>arch å¯ä»¥è¾“å‡ºç³»ç»ŸåŸºäºå¤šå°‘ä½</p></li><li><p>nc ï¼ˆnetcatï¼‰æ˜¯ç”¨äºè¿æ¥å’Œä¾¦å¬TCPå’ŒUDPç«¯å£çš„å®Œæ•´å·¥å…·åŒ…ã€‚</p></li><li><p>lsdev è¾“å‡ºè®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯ç¡¬ä»¶ä¿¡æ¯</p></li><li><p>df æ ¼å¼åŒ–è¾“å‡ºæ–‡ä»¶ç³»ç»Ÿå ç”¨æ¯” ä¸€èˆ¬ä½¿ç”¨df -h</p></li><li><p>stat è¾“å‡ºæ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ã€‚</p></li></ul><h2 id="ç³»ç»Ÿå·¥ä½œæµ"><a href="#ç³»ç»Ÿå·¥ä½œæµ" class="headerlink" title="ç³»ç»Ÿå·¥ä½œæµ"></a>ç³»ç»Ÿå·¥ä½œæµ</h2><ul><li><p>ps æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ é€šå¸¸åé¢åŠ  <code>ax</code> æˆ–è€… <code>aux</code> ä½¿ç”¨ã€‚</p></li><li><p>pstree ä»¥æ ‘å½¢ç»“æ„å±•ç¤ºè¿›ç¨‹ä¿¡æ¯ã€‚</p></li><li><p>top è¾“å‡ºcpuçš„ä¿¡æ¯ä½¿ç”¨ -bå‚æ•°ä»¥textçš„å½¢å¼è¾“å‡ºã€‚èƒ½å¤Ÿä»¥é™æ€çš„æ–¹å¼æŸ¥çœ‹ã€‚</p></li><li><p>niceç”¨äºæŒ‡å®šè¿›ç¨‹è°ƒèŠ‚ä¼˜å…ˆçº§çš„å‘½ä»¤ã€‚</p></li><li><p>pidof å¯ä»¥è¾“å‡ºå…·ä½“è¿›ç¨‹çš„id å¦‚ï¼š<code>pidof xclock</code> ä¼šè¾“å‡º xclockçš„è¿›ç¨‹idå·ã€‚</p></li></ul><h2 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h2><ul><li><p>nmap ç½‘ç»œæ˜ å°„å’Œç«¯å£æ‰«æï¼ˆç°åœ¨åªè®°å¾—å¤§å­¦æ—¶ç½‘ç»œæ”»é˜²é‡Œç”¨è¿‡windowsé‡Œæœ‰ä¸ªå·¥å…·å«nmapä»€ä¹ˆçš„ã€‚ã€‚ï¼‰å‚æ•°æœ‰å¾ˆå¤šã€‚ã€‚</p></li><li><p>ifconfig æœ€ç†Ÿçš„æŸ¥çœ‹ç½‘ç»œæ¥å£è®¾ç½®ã€‚</p></li><li><p>netstat è¾“å‡ºç½‘ç»œçŠ¶æ€å’Œä¿¡æ¯ï¼Œå¦‚è·¯ç”±è¡¨å’Œè¿æ¥çŠ¶æ€ç­‰ã€‚</p></li><li><p>ip å¯ä»¥æŸ¥è¯¢å’Œè®¾ç½®ipå’Œè®¿é—®ç½‘å¡è®¾åˆ«ä¿¡æ¯</p></li></ul><h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><ul><li><p>mount æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ</p></li><li><p>umount å¸è½½è®¾å¤‡</p></li><li><p>sync å¼ºåˆ¶ç«‹å³ä»ç¼“å†²åŒºå†™å…¥æ•°æ®ä»¥æ¥è¾¾åˆ°ç«‹å³æ›´æ–°æ•°æ®çš„ç›®çš„ã€‚</p></li><li><p>mkswap swapon swapoff åˆ†åˆ«å¯¹åº”æ ¼å¼åŒ–ä¸ºäº¤æ¢åˆ†åŒºï¼Œå¯åŠ¨äº¤æ¢åˆ†åŒºï¼Œå…³é—­äº¤æ¢åˆ†åŒºã€‚</p></li><li><p>fdisk åˆ›å»ºæˆ–æ›´æ”¹åˆ†åŒºè¡¨ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥åˆ†åŒºçš„å·¥å…·ã€‚éå¸¸å¸¸è§ã€‚å½“æ—¶æˆ‘è¿˜æ˜¯é€‰æ‹©cfdisk</p></li><li><p>lspci è¾“å‡ºæ€»çº¿ä¿¡æ¯ï¼Œå’Œè¿æ¥æ€»çº¿çš„è®¾å¤‡ä¿¡æ¯ã€‚</p></li></ul><h3 id="å…¶å®è¿˜æœ‰å¾ˆå¤šå‘½ä»¤æ²¡æœ‰æ¶‰åŠåˆ°ï¼Œå¦‚æœæƒ³ç»ƒä¹ è¿™äº›åŸºæœ¬çš„ç³»ç»Ÿå‘½ä»¤çš„è¯ï¼Œå¯ä»¥è·Ÿç€arch-wiki-è£…ä¸€éarchï¼Œè£…å®Œåè¿™é‡Œçš„å‘½ä»¤å°±éƒ½èƒ½è®°ä½äº†ã€‚"><a href="#å…¶å®è¿˜æœ‰å¾ˆå¤šå‘½ä»¤æ²¡æœ‰æ¶‰åŠåˆ°ï¼Œå¦‚æœæƒ³ç»ƒä¹ è¿™äº›åŸºæœ¬çš„ç³»ç»Ÿå‘½ä»¤çš„è¯ï¼Œå¯ä»¥è·Ÿç€arch-wiki-è£…ä¸€éarchï¼Œè£…å®Œåè¿™é‡Œçš„å‘½ä»¤å°±éƒ½èƒ½è®°ä½äº†ã€‚" class="headerlink" title="å…¶å®è¿˜æœ‰å¾ˆå¤šå‘½ä»¤æ²¡æœ‰æ¶‰åŠåˆ°ï¼Œå¦‚æœæƒ³ç»ƒä¹ è¿™äº›åŸºæœ¬çš„ç³»ç»Ÿå‘½ä»¤çš„è¯ï¼Œå¯ä»¥è·Ÿç€arch wiki è£…ä¸€éarchï¼Œè£…å®Œåè¿™é‡Œçš„å‘½ä»¤å°±éƒ½èƒ½è®°ä½äº†ã€‚"></a>å…¶å®è¿˜æœ‰å¾ˆå¤šå‘½ä»¤æ²¡æœ‰æ¶‰åŠåˆ°ï¼Œå¦‚æœæƒ³ç»ƒä¹ è¿™äº›åŸºæœ¬çš„ç³»ç»Ÿå‘½ä»¤çš„è¯ï¼Œå¯ä»¥è·Ÿç€arch wiki è£…ä¸€éarchï¼Œè£…å®Œåè¿™é‡Œçš„å‘½ä»¤å°±éƒ½èƒ½è®°ä½äº†ã€‚</h3>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºElementryOSå›¾å½¢ç•Œé¢æŒ‚èµ·ä¹‹åå”¤é†’åå‡ºç°é»‘å±é—®é¢˜</title>
      <link href="/2018/06/23/2018-06-23-%E5%85%B3%E4%BA%8EelementryOS%E6%8C%82%E8%B5%B7%E4%B9%8B%E5%90%8E%E5%94%A4%E9%86%92%E6%97%B6%E9%BB%91%E5%B1%8F%E9%97%AE%E9%A2%98/"/>
      <url>/2018/06/23/2018-06-23-%E5%85%B3%E4%BA%8EelementryOS%E6%8C%82%E8%B5%B7%E4%B9%8B%E5%90%8E%E5%94%A4%E9%86%92%E6%97%B6%E9%BB%91%E5%B1%8F%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å…³äºElementryOSå›¾å½¢ç•Œé¢æŒ‚èµ·ä¹‹åå”¤é†’åå‡ºç°é»‘å±é—®é¢˜"><a href="#å…³äºElementryOSå›¾å½¢ç•Œé¢æŒ‚èµ·ä¹‹åå”¤é†’åå‡ºç°é»‘å±é—®é¢˜" class="headerlink" title="å…³äºElementryOSå›¾å½¢ç•Œé¢æŒ‚èµ·ä¹‹åå”¤é†’åå‡ºç°é»‘å±é—®é¢˜"></a>å…³äºElementryOSå›¾å½¢ç•Œé¢æŒ‚èµ·ä¹‹åå”¤é†’åå‡ºç°é»‘å±é—®é¢˜</h1><p>è¿™ä¸¤å¤©åœ¨ElementryOsä¸Šè¸©åˆ°äº†å‘ï¼Œä¸ºäº†ä»¥åå°‘è¸©ç‚¹è¿™ç§å‘ï¼Œæ‰“ç®—ä»¥åå°†è¿™ç§å°é—®é¢˜ä¹Ÿå†™ä¸‹æ¥ã€‚</p><p>å¦‚ä½•è§£å†³ï¼šå®‰è£…  <code>xserver-xorg</code></p><p>åœ¨ElementryOSçš„ç»ˆç«¯ä¸­ä½¿ç”¨ <code>$ sudo apt-get install xserver-xorg</code>  æˆ‘ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥è§£å†³é—®é¢˜</p><p>è§£å†³æ—¶é—´ï¼š2018-6-23 ç‰ˆæœ¬ï¼šElementryOS Loki 0.4</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆåï¼‰å‘½ä»¤ç¯‡ï¼ˆ1ï¼‰</title>
      <link href="/2018/06/19/2018-06-19-bash_09-bash%E5%91%BD%E4%BB%A4%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2018/06/19/2018-06-19-bash_09-bash%E5%91%BD%E4%BB%A4%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Bashä¸­çš„å‘½ä»¤"><a href="#Bashä¸­çš„å‘½ä»¤" class="headerlink" title="Bashä¸­çš„å‘½ä»¤"></a>Bashä¸­çš„å‘½ä»¤</h1><h2 id="å†…å»ºå‘½ä»¤"><a href="#å†…å»ºå‘½ä»¤" class="headerlink" title="å†…å»ºå‘½ä»¤"></a>å†…å»ºå‘½ä»¤</h2><p>å†…å»ºå‘½ä»¤æ˜¯bashå·¥å…·é›†ä¸­è‡ªå¸¦çš„å‘½ä»¤ï¼Œå¥½å¤„æ˜¯æ‰§è¡Œé€Ÿåº¦æ¯”å¤–éƒ¨å‘½ä»¤è¦å¿«ï¼Œå› ä¸ºå†…å»ºå‘½ä»¤ä¸€èˆ¬ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œè€Œå¤–éƒ¨å‘½ä»¤ä¸€èˆ¬è¦åˆ†æ”¯å‡ºä¸€ä¸ªå­è¿›ç¨‹ã€‚</p><h3 id="I-Oæ“ä½œ"><a href="#I-Oæ“ä½œ" class="headerlink" title="I/Oæ“ä½œ"></a>I/Oæ“ä½œ</h3><ul><li><code>echo</code> å½“ç„¶æ˜¯æœ€ç†Ÿæ‚‰çš„echoå‘½ä»¤è¿›è¡Œè¾“å‡ºäº†ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ä½¿ç”¨ echo `command ` çš„æ—¶å€™echoä¼šé»˜è®¤å°†å–æ¶ˆè¾“å‡ºçš„æ‰€æœ‰æ¢è¡Œã€‚</li></ul><p>å†å½“ä½¿ç”¨ echo â€œ`command`â€œçš„æ—¶å€™å¯ä»¥é¿å…æ¢è¡Œç¬¦çš„ç¼ºå¤±ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;`ll`&quot;</span><br><span class="line">total 12K</span><br><span class="line">drwxr-xr-x 2 nanyin nanyin 4.0K Jun 19 21:18 bash</span><br><span class="line">drwxr-xr-x 3 nanyin nanyin 4.0K Jun 18 21:16 git</span><br><span class="line">-rw-r--r-- 1 nanyin nanyin 1.1K Jun 19 21:31 æ€»ç»“.txt</span><br></pre></td></tr></table></figure><ul><li><code>printf</code> åœ¨Cä¸­ä½¿ç”¨çš„printf èƒ½å¤Ÿæ ¼å¼åŒ–è¾“å‡ºå†…å®¹ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># åŸºæœ¬ä½¿ç”¨</span><br><span class="line">printf format-string... parameter...</span><br><span class="line"># ä¾‹å­</span><br><span class="line">declare -r PI=3.1415926535</span><br><span class="line">printf &quot;pi to 2 decimal is  %1.2f&quot; $PI # pi to 2 decimal is  3.14%</span><br></pre></td></tr></table></figure><ul><li><code>read</code> è¯»å–å‚æ•°çš„å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤è¯»å–è¾“å…¥å‚æ•°ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨è¾“å…¥readæ•°æ®æœŸé—´è¾“å…¥\ä¼šæŠ‘åˆ¶æ¢è¡Œç¬¦ã€‚ -ré€‰é¡¹ä¼šå¯¼è‡´è¾“å…¥çš„\è¢«å­—é¢è§£é‡Šã€‚åŒæ ·readå‘½ä»¤æœ‰å¾ˆå¤šå‚æ•°å¯ä»¥ä½¿ç”¨</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;please input a value:&quot;</span><br><span class="line">read var1</span><br><span class="line">echo &quot;input var1 is $var1&quot;</span><br></pre></td></tr></table></figure><p>å½“read åé¢ä¸è·Ÿä»»ä½•å€¼çš„è¯ä»–é»˜è®¤ç»™ $REPLY èµ‹å€¼ï¼Œä¹‹åå¯ä»¥å–è¿™ä¸ªå€¼ä½œä¸ºreadè¿›æ¥çš„å€¼ã€‚</p><p>åœ¨å½“è¾“å…¥å†…å®¹åé¢åŠ ä¸Š <code>/</code> çš„è¯ä¼šèµ·åˆ°è¾“å…¥æ—¶å€™çš„æ¢è¡Œçš„ä½œç”¨ï¼Œè€Œä½¿ç”¨ -r å‚æ•°ä¼šå°† <code>/</code>æŒ‰ç…§åŸæ ·è¾“å‡ºå‡ºæ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;input var1 is $var1&quot;</span><br><span class="line">echo &quot;Enter a string terminated by a \\, then press &lt;ENTER&gt;.&quot;</span><br><span class="line">echo &quot;Then, enter a second string (no \\ this time), and again press &lt;ENTER&gt;.&quot;</span><br><span class="line">read</span><br><span class="line">echo &quot;the default value is $REPLY&quot;</span><br><span class="line"># å½“readåé¢ä¸å†™å…·ä½“å€¼çš„æ—¶å€™ä¼šæŠŠå€¼ä»˜ç»™ REPLY</span><br></pre></td></tr></table></figure><p>readæœ‰å¾ˆå¤šæœ‰ç”¨çš„å‚æ•°å¯ä»¥è°ƒç”¨ï¼Œå®ç°å¤æ‚çš„è¾“å…¥åŠŸèƒ½ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">read -s -n1 -p &quot;Hit a key &quot; keypress</span><br><span class="line"># read æœ‰å¾ˆå¤šéå¸¸æœ‰æ„æ€çš„å‚æ•°ï¼Œæ¯”å¦‚ -sçš„æ„æ€å°±æ˜¯ä¸è¦å›æ˜¾è¾“å…¥</span><br><span class="line"># -n1 çš„æ„æ€æ˜¯è¾“å…¥æŒ‡å®šæ•°é‡çš„å­—ç¬¦</span><br><span class="line"># -p æ˜¯å…ˆè¾“å‡ºå‰é¢çš„æç¤ºã€‚</span><br><span class="line">echo; echo &quot;Keypress was &quot;\&quot;$keypress\&quot;&quot;.&quot;</span><br></pre></td></tr></table></figure><p>readä¹Ÿå¯ä»¥ä½¿ç”¨æ–‡ä»¶ä½œä¸ºè¾“å…¥çš„æº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;æ–‡ä»¶temp_fileä¸­å†…å®¹æœ‰ä¸¤è¡Œ ä¸€è¡Œæ˜¯hello world ç¬¬äºŒè¡Œæ˜¯ Hello World&quot;</span><br><span class="line">read var1 var2 &lt; temp_file</span><br><span class="line">echo &quot;var1 is $var1 var2 is $var2&quot;</span><br><span class="line">echo &quot;è¿™é‡Œæ˜¾ç„¶è¾“å‡ºçš„ç¬¬ä¸€è¡Œçš„å†…å®¹&quot;</span><br><span class="line">echo &quot;---------------------------&quot;</span><br><span class="line">echo &quot;å…¶å®è¿˜èƒ½è‡ªå®šä¹‰IFSåˆ†å‰²ç¬¦ç„¶åæ ¹æ®è§„åˆ™è‡ªå®šä¹‰æ–‡ä»¶è¾“å…¥&quot;</span><br><span class="line">echo &quot;all users in the list:&quot;</span><br><span class="line">OIFS=$IFS ; IFS=:</span><br><span class="line">while read name passwd uid gid fullname ignore</span><br><span class="line">do</span><br><span class="line">echo &quot;$name ($fullname)&quot;</span><br><span class="line">done &lt; /etc/passwd</span><br><span class="line">IFS=$OIFS</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶ç³»ç»Ÿæ“ä½œ"><a href="#æ–‡ä»¶ç³»ç»Ÿæ“ä½œ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿæ“ä½œ"></a>æ–‡ä»¶ç³»ç»Ÿæ“ä½œ</h3><p>æ“ä½œæ–‡ä»¶ç³»ç»Ÿçš„å‘½ä»¤æœ‰å¾ˆå¤šä½†æ˜¯éƒ½éå¸¸çš„å¸¸ç”¨ä¹Ÿéå¸¸çš„ç®€å•ã€‚è¿™é‡Œä¸åšå…·ä½“çš„è¯´æ˜å…¶ä¸­ä¸¾ä¸€ä¸¤ä¸ªéå¸¸å¸¸è§çš„ã€‚</p><p>cd : åˆ‡æ¢ç›®å½•</p><p>pwd ï¼š æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•</p><h3 id="å˜é‡æ“ä½œ"><a href="#å˜é‡æ“ä½œ" class="headerlink" title="å˜é‡æ“ä½œ"></a>å˜é‡æ“ä½œ</h3><p>let æ˜¯èƒ½å¤Ÿè¿›è¡Œç®€å•å˜é‡è¿ç®—çš„å‘½ä»¤ æ¯”å¦‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let a=1+2</span><br><span class="line">echo $a</span><br><span class="line">let b=&quot;2+3&quot;</span><br><span class="line">echo $b</span><br></pre></td></tr></table></figure><p>eval å‘½ä»¤æ˜¯èƒ½å¤Ÿå°†å­—ç¬¦ä¸²è½¬æ¢æˆæˆå‘½ä»¤ã€‚å¹¶ä¸”å¯ä»¥å¤šæ¬¡è°ƒç”¨ä»¥å»è¯„ä¼°æ˜¯å¦æ˜¯å‘½ä»¤å»æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> command_string=&quot;ps ax&quot;</span><br><span class="line"> process=&quot;ps ax&quot;</span><br><span class="line"> eval &quot;$command_string&quot; | grep &quot;$process&quot;</span><br><span class="line"># 26973 pts/3    R+     0:00 grep --color ps ax</span><br><span class="line"># 26974 pts/3    R+     0:00 ps ax</span><br><span class="line"></span><br><span class="line">a=&apos;$b&apos;</span><br><span class="line">b=&apos;$c&apos;</span><br><span class="line">c=d</span><br><span class="line">echo $a             # $b</span><br><span class="line">                    # First level.</span><br><span class="line">eval echo $a        # $c</span><br><span class="line">                    # Second level.</span><br><span class="line">eval eval echo $a   # d</span><br><span class="line">                    # Third level.</span><br></pre></td></tr></table></figure><p>setå’Œunsetå‘½ä»¤ï¼Œä¸€çœ‹å°±çŸ¥é“æ˜¯è®¾ç½®å’Œå–æ¶ˆå˜é‡çš„æ„æ€ã€‚</p><p>export å‘½ä»¤ä¸€èˆ¬ä½¿ç”¨åœ¨è®¾ç½®ç¯å¢ƒå˜é‡ä¸Šï¼Œå¦‚åœ¨/etc/profileæ–‡ä»¶ä¸­è®¾ç½®JAVA_HOME</p><p>declareå’Œtypesetå‘½ä»¤æŒ‡å®šå’Œ/æˆ–é™åˆ¶å˜é‡çš„å±æ€§ã€‚</p><p>getopts æ˜¯èƒ½å¤Ÿå®šä¹‰å±æ€§çš„ æ¯”å¦‚ åœ¨è§£å‹taråŒ…çš„æ—¶å€™ä½¿ç”¨<code>-xvf</code><br>ä¹‹ç±»çš„å‘½ä»¤çš„æ—¶å€™å°±æ˜¯ä½¿ç”¨getoptsæ¥è¾¾åˆ°ä¸åŒçš„ -a -b ä¹‹ç±»çš„å®ç°ã€‚è¿™ä¸ªå‘½ä»¤ä¸€èˆ¬å‡ºç°åœ¨case æˆ–è€…whileå¾ªç¯ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">while getopts &quot;:abcde:fg&quot; Option</span><br><span class="line"># Initial declaration.</span><br><span class="line"># a, b, c, d, e, f, and g are the options (flags) expected.</span><br><span class="line"># The : after option &apos;e&apos; shows it will have an argument passed with it.</span><br><span class="line"># eå‚æ•°åé¢çš„çš„è¡¨ç¤ºä¼šæœ‰å‚æ•°ä¼ é€’ç»™ä»–</span><br><span class="line">do</span><br><span class="line">  case $Option in</span><br><span class="line">    a ) # Do something with variable &apos;a&apos;.</span><br><span class="line">    b ) # Do something with variable &apos;b&apos;.</span><br><span class="line">    ...</span><br><span class="line">    e)  # Do something with &apos;e&apos;, and also with $OPTARG,</span><br><span class="line">        # which is the associated argument passed with option &apos;e&apos;.</span><br><span class="line">    ...</span><br><span class="line">    g ) # Do something with variable &apos;g&apos;.</span><br><span class="line">  esac</span><br><span class="line">done</span><br><span class="line">shift $(($OPTIND - 1))</span><br><span class="line"># Move argument pointer to next.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆå…«ï¼‰å¾ªç¯å’Œåˆ†æ”¯ï¼ˆ2ï¼‰</title>
      <link href="/2018/06/12/2018-06-12-bash_08_bash%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%92%8C%E5%88%86%E6%94%AF%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2018/06/12/2018-06-12-bash_08_bash%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%92%8C%E5%88%86%E6%94%AF%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="å¾ªç¯å’Œåˆ†æ”¯-äºŒ"><a href="#å¾ªç¯å’Œåˆ†æ”¯-äºŒ" class="headerlink" title="å¾ªç¯å’Œåˆ†æ”¯(äºŒ)"></a>å¾ªç¯å’Œåˆ†æ”¯(äºŒ)</h1><h2 id="å¤šé‡å¾ªç¯"><a href="#å¤šé‡å¾ªç¯" class="headerlink" title="å¤šé‡å¾ªç¯"></a>å¤šé‡å¾ªç¯</h2><p>å°±åƒCï¼ŒJavaä¸€æ ·ï¼ŒbashåŒæ ·å¯ä»¥å®ç°å¤šé‡å¾ªç¯,ä¸‹é¢çš„ä¾‹å­ç®€å•çš„å®ç°åŒé‡å¾ªç¯ï¼Œå¦‚æœåŠ ä¸Šå¾ªç¯æ§åˆ¶å¯èƒ½å°±æ›´éš¾ä¸€äº›äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">for ((i=0;i&lt;5;i++))</span><br><span class="line">do</span><br><span class="line">    for bin in 1 2 4</span><br><span class="line">    do</span><br><span class="line">    echo $bin</span><br><span class="line">    done</span><br><span class="line">echo $i</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h2 id="å¾ªç¯æ§åˆ¶"><a href="#å¾ªç¯æ§åˆ¶" class="headerlink" title="å¾ªç¯æ§åˆ¶"></a>å¾ªç¯æ§åˆ¶</h2><p>å½±å“å¾ªç¯è¡Œä¸ºçš„è¯­å¥ã€‚æœ‰ <code>break</code> å’Œ <code>continue</code> ä¸¤ä¸ªå¾ªç¯æ§åˆ¶å‘½ä»¤,break å‘½ä»¤å¯ä»¥ç»ˆæ­¢å¾ªç¯ï¼Œè€Œcontinueå¯ä»¥è·³è¿‡å½“å‰å¾ªç¯æå‰è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œè¿™é‡Œå’ŒCè¯­è¨€å®šä¹‰çš„ç±»ä¼¼ã€‚</p><p>ä¸‹é¢ä¸¾ä¸€ä¸ªç®€å•çš„breakå’Œcontinueçš„ä¾‹å­ï¼›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">LIMIT=9</span><br><span class="line">a=0</span><br><span class="line">#while [[ $a -le $LIMIT ]]</span><br><span class="line">#do</span><br><span class="line">#let &quot;a=a+1&quot;</span><br><span class="line">#if [ $a -eq 3 ] || [ $a -eq 11 ]</span><br><span class="line">#then</span><br><span class="line">#continue</span><br><span class="line">#fi</span><br><span class="line">#echo $a</span><br><span class="line"># done</span><br><span class="line"></span><br><span class="line">while [[ $a -le $LIMIT ]]</span><br><span class="line">do</span><br><span class="line">    let &quot;a=a+1&quot;</span><br><span class="line">    if [ $a -gt 2 ]</span><br><span class="line">    then</span><br><span class="line">    break</span><br><span class="line">    fi</span><br><span class="line">    echo $a</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>ç®€å•çš„breakå¾ªç¯åªèƒ½è·³å‡ºæœ€å†…å®¹çš„å¾ªç¯ï¼Œè€Œä¸èƒ½è·³å‡ºå¤šå±‚çš„å¾ªç¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>break N</code> æ¥è·³å‡ºå¤šå±‚å¾ªç¯ã€‚nä¸ºæƒ³è¦è·³å‡ºå¾ªç¯çš„å±‚æ•°ã€‚</p><p>å’Œbreakåƒä¼¼çš„continueï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ <code>continue N</code> æ¥å®ç°ã€‚è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸€ä¸ªéå¸¸ç®€å•æ˜äº†çš„ä¾‹å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">for outer in I II III IV V           # outer loop</span><br><span class="line">do</span><br><span class="line">  echo; echo -n &quot;Group $outer: &quot;</span><br><span class="line"></span><br><span class="line">  # --------------------------------------------------------------------</span><br><span class="line">  for inner in 1 2 3 4 5 6 7 8 9 10  # inner loop</span><br><span class="line">  do</span><br><span class="line"></span><br><span class="line">    if [[ &quot;$inner&quot; -eq 7 &amp;&amp; &quot;$outer&quot; = &quot;III&quot; ]]</span><br><span class="line">    then</span><br><span class="line">      continue 2  # Continue at loop on 2nd level, that is &quot;outer loop&quot;.</span><br><span class="line">                  # Replace above line with a simple &quot;continue&quot;</span><br><span class="line">                  # to see normal loop behavior.</span><br><span class="line">    fi  </span><br><span class="line">    echo -n &quot;$inner &quot;  # 7 8 9 10 will not echo on &quot;Group III.&quot;</span><br><span class="line">  done  </span><br><span class="line">  # --------------------------------------------------------------------</span><br><span class="line">done</span><br><span class="line">echo; echo</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•å’Œåˆ†æ”¯"><a href="#æµ‹è¯•å’Œåˆ†æ”¯" class="headerlink" title="æµ‹è¯•å’Œåˆ†æ”¯"></a>æµ‹è¯•å’Œåˆ†æ”¯</h2><p>ä½¿ç”¨ <code>case</code> å’Œ <code>select</code> ç»“æ„ä½“ï¼Œä¸åƒä¸€ä¸ªå¾ªç¯ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä¸€ä¸ªè¿­ä»£çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯å®ƒä»¬èƒ½å¤Ÿé€šè¿‡æ¡ä»¶æŒ‡å¯¼ç¨‹åºçš„æµå‘ã€‚</p><h3 id="é€šè¿‡ç¨‹åºå—æ§åˆ¶ç¨‹åºæµå‘"><a href="#é€šè¿‡ç¨‹åºå—æ§åˆ¶ç¨‹åºæµå‘" class="headerlink" title="é€šè¿‡ç¨‹åºå—æ§åˆ¶ç¨‹åºæµå‘"></a>é€šè¿‡ç¨‹åºå—æ§åˆ¶ç¨‹åºæµå‘</h3><h4 id="Case-in-esac"><a href="#Case-in-esac" class="headerlink" title="Case (in) /esac"></a>Case (in) /esac</h4><p>åœ¨bashä¸­çš„caseç»“æ„ç±»ä¼¼Cä¸­çš„switchç»“æ„ï¼Œæ˜¯åœ¨æ‹¥æœ‰å¤šç§æ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨åˆ°çš„ä»£ç å—ã€‚caseç»“æ„å¯ä»¥å‚è§ä¸‹é¢ä»£ç ã€‚ (å…¶å®æ˜¯å¯ä»¥æœ‰conditionçš„å·¦è¾¹çš„æ‹¬å·çš„ï¼Œå—¯ï¼Œå¯ä»¥åŠ ä¸Šçš„)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">case &quot;$variable&quot; in </span><br><span class="line"></span><br><span class="line"> &quot;$condition1&quot; ) </span><br><span class="line"> command... </span><br><span class="line"> ;; </span><br><span class="line"></span><br><span class="line"> &quot;$condition2&quot; ) </span><br><span class="line"> command... </span><br><span class="line"> ;;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ä»¥åä¼šéå¸¸æœ‰ç”¨å¤„çš„ä¾‹å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  &quot;&quot;) echo &quot;Usage: $&#123;0##*/&#125; &lt;filename&gt;&quot;; exit $E_PARAM;;</span><br><span class="line">                      # No command-line parameters,</span><br><span class="line">                      # or first parameter empty.</span><br><span class="line"># Note that $&#123;0##*/&#125; is $&#123;var##pattern&#125; param substitution. </span><br><span class="line"># å¯ä»¥é€šè¿‡ä½¿ç”¨##parternæŠŠå‰é¢çš„./å»æ‰</span><br><span class="line"></span><br><span class="line">  -*) FILENAME=./$1;;   #  If filename passed as argument ($1)</span><br><span class="line">                      #+ starts with a dash,</span><br><span class="line">                      #+ replace it with ./$1</span><br><span class="line">                      #+ so further commands don&apos;t interpret it</span><br><span class="line">                      #+ as an option.</span><br><span class="line"></span><br><span class="line">  * ) FILENAME=$1;;     # Otherwise, $1.</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><p>selectæ˜¯å’Œcaseç»“æ„æ„ä¹‰ç›¸åŒçš„ç»“æ„ä½“ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„PS3ä¹Ÿå°±æ˜¯é€‰æ‹©æç¤ºç¬¦ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select variable [in list]</span><br><span class="line">do</span><br><span class="line"> command...</span><br><span class="line"> break</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>ç®€å•å®ä¾‹ï¼Œè¿™ä¸ªä¾‹å­ä¸å®Œæ•´éœ€è¦å†å»è€ƒè™‘å¾ˆå¤šä¸œè¥¿ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PS3=&quot;Choose your favorite vegetable:&quot;</span><br><span class="line">select vegetable in &quot;beans&quot; &quot;carrots&quot; &quot;potatoes&quot;</span><br><span class="line">do</span><br><span class="line">if [[ $vegetable = &quot;beans&quot; ]] || [[ $vegetable = &quot;carrots&quot; ]] || [[$vegetable = &quot;potatoes&quot; ]]</span><br><span class="line">then </span><br><span class="line">echo </span><br><span class="line">echo &quot;your favorite veggie is $vegetable&quot;</span><br><span class="line">echo </span><br><span class="line">continue</span><br><span class="line">else</span><br><span class="line">echo &quot;your vegetable not on this list&quot;</span><br><span class="line">break</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">done</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆä¹ï¼‰å‘½ä»¤ç½®æ¢å’Œç®—æ•°æ‰©å±•</title>
      <link href="/2018/06/12/2018-06-16-bash_09_%E5%91%BD%E4%BB%A4%E7%BD%AE%E6%8D%A2/"/>
      <url>/2018/06/12/2018-06-16-bash_09_%E5%91%BD%E4%BB%A4%E7%BD%AE%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="å‘½ä»¤ç½®æ¢"><a href="#å‘½ä»¤ç½®æ¢" class="headerlink" title="å‘½ä»¤ç½®æ¢"></a>å‘½ä»¤ç½®æ¢</h1><p>å‘½ä»¤ç½®æ¢å¯ä»¥è¾“å‡ºä¸€æ¡æˆ–è€…å¤šæ¡å‘½ä»¤çš„è¾“å‡ºã€‚å¯ä»¥è®©å‘½ä»¤åœ¨ä¸åŒè¯­å¢ƒä¸‹èµ·ä½œç”¨ï¼Œæœ€å¸¸è§çš„æ˜¯ä½¿ç”¨  <code>\</code>`` ç¬¦å·è¿›è¡Œå¯¹å‘½ä»¤çš„åŒ…è£¹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè¾“å‡ºä½¿ç”¨å‘½ä»¤å¾—å‡ºçš„ç»“æœã€‚å¯ä»¥æˆä¸ºå¦å¤–ä¸€ä¸ªå‘½ä»¤çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥æˆä¸ºå¾ªç¯çš„å‚æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo `hostname`</span><br><span class="line">echo $(&quot;hostname&quot;)</span><br><span class="line"># ä¸¤ç§ä½¿ç”¨éƒ½å¯ä»¥ï¼Œéƒ½èƒ½å¤Ÿè¾¾åˆ°å‘½ä»¤ç½®æ¢çš„ç›®çš„</span><br></pre></td></tr></table></figure><h1 id="ç®—æ•°è¿ç®—"><a href="#ç®—æ•°è¿ç®—" class="headerlink" title="ç®—æ•°è¿ç®—"></a>ç®—æ•°è¿ç®—</h1><p>ä½¿ç”¨åå¼•å·ï¼ŒåŒæ‹¬å·ï¼Œå’Œletè¿›è¡Œç›¸å¯¹æ¥è¯´ç®€å•</p><h2 id="ä½¿ç”¨åå¼•å·"><a href="#ä½¿ç”¨åå¼•å·" class="headerlink" title="ä½¿ç”¨åå¼•å·"></a>ä½¿ç”¨åå¼•å·</h2><p>ä½¿ç”¨åå¼•å·å†…ç”¨exprå‘½ä»¤è¿›è¡Œæ•´å‹æ•°çš„è¿ç®—ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">z=`expr $z+1`</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨åŒæ‹¬å·å’Œletè¿›è¡Œè¿ç®—"><a href="#ä½¿ç”¨åŒæ‹¬å·å’Œletè¿›è¡Œè¿ç®—" class="headerlink" title="ä½¿ç”¨åŒæ‹¬å·å’Œletè¿›è¡Œè¿ç®—"></a>ä½¿ç”¨åŒæ‹¬å·å’Œletè¿›è¡Œè¿ç®—</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">z=$((z+3))</span><br><span class="line"></span><br><span class="line">let z=z+3</span><br><span class="line">let &quot;z += 3&quot;  #  Quotes permit the use of spaces in variable assignment.</span><br></pre></td></tr></table></figure><p>ä»Šå¤©çš„å†…å®¹æœ‰ç‚¹å°‘ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆä¸ƒï¼‰å¾ªç¯å’Œåˆ†æ”¯ï¼ˆ1ï¼‰</title>
      <link href="/2018/06/12/2018-06-11-bash_07_bash%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%92%8C%E5%88%86%E6%94%AF/"/>
      <url>/2018/06/12/2018-06-11-bash_07_bash%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%92%8C%E5%88%86%E6%94%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="å¾ªç¯å’Œåˆ†æ”¯"><a href="#å¾ªç¯å’Œåˆ†æ”¯" class="headerlink" title="å¾ªç¯å’Œåˆ†æ”¯"></a>å¾ªç¯å’Œåˆ†æ”¯</h1><h2 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h2><p>å¾ªç¯å°±æ˜¯ä¸€å—å½“æ¡ä»¶ä¸ºçœŸçš„è¿­ä»£çš„ä»£ç å—ã€‚</p><h3 id="forå¾ªç¯"><a href="#forå¾ªç¯" class="headerlink" title="forå¾ªç¯"></a>forå¾ªç¯</h3><p>for arg in [list] è¿™æ˜¯æœ€åŸºç¡€çš„å¾ªç¯å½¢å¼ã€‚å¦‚æœdoå’Œforåœ¨ä¸€è¡Œé‡Œï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨doå‰é¢åŠ åˆ†å·å¦‚ï¼š<code>for arg in list ;do</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for arg in list</span><br><span class="line">do</span><br><span class="line">.. commend(s)</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>forå¾ªç¯æœ‰å¾ˆå¤šç”¨æ³•ï¼Œä¸¾å‡ ä¸ªä¾‹å­æ¥äº†è§£ä¸€ä¸‹forå¾ªç¯éƒ½èƒ½å¤Ÿå¹²äº›ä»€ä¹ˆå§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"># for i in &quot;hello world !&quot; # è¿™æ ·å½“ä½œæ•´ä¸ªå­—ç¬¦ä¸²</span><br><span class="line">for i in  hello world !</span><br><span class="line">do</span><br><span class="line">echo $i</span><br><span class="line">done</span><br><span class="line"># ä¸å‘½ä»¤ç»“åˆ</span><br><span class="line">if [ -e &quot;/bin/bash&quot; ]</span><br><span class="line">then</span><br><span class="line">echo &quot;is exist&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># è¾“å‡ºå½“å‰ç›®å½•ä¸‹åŒ¹é…æ–‡ä»¶çš„å†…å®¹ ç±»ä¼¼ä½¿ç”¨findå‘½ä»¤</span><br><span class="line">FILE=&quot;*txt&quot;</span><br><span class="line">for file in $FILE</span><br><span class="line">do</span><br><span class="line">echo &quot;Contents of $file&quot;</span><br><span class="line">echo &quot;------------------&quot;</span><br><span class="line">cat &quot;$file&quot;</span><br><span class="line">echo</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># å¦‚æœin listå†…å®¹ç¼ºå¤±å°±è¡¨ç¤ºä½¿ç”¨ in $@ ä¹Ÿå°±æ˜¯æ‰€æœ‰ä¼ è¿›æ¥çš„å‚æ•°</span><br><span class="line">for a</span><br><span class="line">do</span><br><span class="line">echo  &quot;$a&quot;</span><br><span class="line">done</span><br><span class="line">#é€šè¿‡ä½¿ç”¨å‘½ä»¤æ¥æ„é€ forå¾ªç¯çš„list</span><br><span class="line">for b in `ls`</span><br><span class="line">do</span><br><span class="line">echo $b</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨forå¾ªç¯è¾“å‡ºç”¨æˆ·çš„ä¿¡æ¯</span><br><span class="line">PASSWORD_FILE=/etc/passwd</span><br><span class="line">n=1</span><br><span class="line">for name in $(awk &apos;BEGIN&#123;FS=&quot;:&quot;;&#125;&#123;print $1&#125;&apos;&lt; &quot;$PASSWORD_FILE&quot;)</span><br><span class="line">do</span><br><span class="line">echo &quot;USER #$n=$name&quot;</span><br><span class="line">let &quot;n+=1&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#ä½¿ç”¨å‡½æ•°ç»™forå¾ªç¯ä½œå€¼</span><br><span class="line">give_parm()&#123;</span><br><span class="line">echo &quot;1 2 3 5 6&quot;</span><br><span class="line">&#125;</span><br><span class="line">for c in $(give_parm)</span><br><span class="line">do</span><br><span class="line">echo $c</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># ç±»Cè¯­è¨€çš„forå¾ªç¯</span><br><span class="line">for (( ai=1;ai&lt;5;ai++))</span><br><span class="line">do</span><br><span class="line">echo $ai</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="whileå¾ªç¯"><a href="#whileå¾ªç¯" class="headerlink" title="whileå¾ªç¯"></a>whileå¾ªç¯</h3><p>whileå¾ªç¯ç”¨æ¥æµ‹è¯•ä¸€ä¸ªæ¡ä»¶,å¹¶ä¸”ä¸€ç›´å¾ªç¯ç›´åˆ°æ¡ä»¶ä¸ºtrueä¹Ÿå°±æ˜¯é€€å‡ºç ä¸º0çš„æ—¶å€™é€€å‡ºå¾ªç¯ã€‚ä¸€èˆ¬whileå¾ªç¯ç”¨åœ¨æå‰ä¸çŸ¥é“å¾ªç¯æ¬¡æ•°çš„æ—¶å€™ã€‚whileå¾ªç¯ä½¿ç”¨ä¸­æ‹¬å·æŠŠæ¡ä»¶æ‹¬èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒä¸­æ‹¬å·ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while [condition]</span><br><span class="line">do</span><br><span class="line">Â·Â·Â·Â·commends</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>å½“whileæœ‰å¤šä¸ªæ¡ä»¶çš„æ—¶å€™ï¼Œåªæœ‰æœ€åä¸€ä¸ªå‚æ•°ä¼šå†³å®šå¾ªç¯æ¬¡æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">while echo &quot;previous-variable = $previous&quot;</span><br><span class="line">      echo</span><br><span class="line">      previous=$var1</span><br><span class="line">      [ &quot;$var1&quot; != end ] # Keeps track of what $var1 was previously.</span><br><span class="line">      # Four conditions on *while*, but only the final one controls loop.</span><br><span class="line">      # The *last* exit status is the one that counts.</span><br><span class="line">do</span><br><span class="line">echo &quot;Input variable #1 (end to exit) &quot;</span><br><span class="line">  read var1</span><br><span class="line">  echo &quot;variable #1 = $var1&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>ä¹Ÿæœ‰ç±»ä¼¼Cè¯­è¨€çš„whileæ¡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">while (( a &lt;= LIMIT ))   #  Double parentheses,</span><br><span class="line">do                       # + and no &quot;$&quot; preceding variables.</span><br><span class="line">  echo -n &quot;$a &quot;</span><br><span class="line">  ((a += 1))             # let &quot;a+=1&quot; ç®—æ•°è¿ç®—</span><br><span class="line">  # Yes, indeed.</span><br><span class="line">  # Double parentheses permit incrementing a variable with C-like syntax.</span><br><span class="line">  # åŒå°æ‹¬å·å…è®¸é€’å¢ä¸€ä¸ªå˜é‡ä½¿ç”¨ç±»Cçš„è¿ç®—æ–¹å¼</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„whileåçš„æ¡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">condition ()</span><br><span class="line">&#123;</span><br><span class="line">  ((t++))</span><br><span class="line">  if [ $t -lt 5 ]</span><br><span class="line">  then</span><br><span class="line">    return 0  # true</span><br><span class="line">  else</span><br><span class="line">    return 1  # false</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line">while condition</span><br><span class="line">#     ^^^^^^^^^</span><br><span class="line">#     Function call -- four loop iterations.</span><br><span class="line">do</span><br><span class="line">  echo &quot;Still going: t = $t&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>whileå¯ä»¥å’Œreadå‘½ä»¤è¿›è¡Œç»“åˆï¼Œå½¢æˆ <code>while read</code> ç»“æ„ä½“ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„è¯»å’Œå¤„ç†æ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while read line</span><br><span class="line">do</span><br><span class="line">    echo $line #è¯»å–1.txtä¸­çš„æ¯ä¸€è¡Œ</span><br><span class="line">done &lt; 1.txt</span><br></pre></td></tr></table></figure><h3 id="untilå¾ªç¯"><a href="#untilå¾ªç¯" class="headerlink" title="untilå¾ªç¯"></a>untilå¾ªç¯</h3><p>untilå¾ªç¯æ˜¯å’Œwhileå¾ªç¯æ­£å¥½ç›¸åï¼Œuntilä¼šä¸€ç›´è¿›è¡Œå¾ªç¯ï¼Œç›´åˆ°æ¡ä»¶å˜ä¸ºfalseï¼›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">until [ condition-is-true ]</span><br><span class="line">do</span><br><span class="line"> command(s)...</span><br><span class="line">done</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­£åˆ™è¡¨è¾¾å¼çš„å…¥é—¨</title>
      <link href="/2018/06/07/2018-06-06-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2018/06/07/2018-06-06-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h1><p>æœ€è¿‘ä¼šæ—¶å¸¸é‡åˆ°ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ‰€ä»¥ç°åœ¨å†™ä¸€ç¯‡æ­£åˆ™è¡¨è¾¾å¼çš„æ–‡ç« æ¥ç®€å•è®°å½•ä¸€ä¸‹å­¦ä¹ æ­£åˆ™çš„è¿‡ç¨‹ã€‚</p><p>åœ¨è¿™ä¸ªç½‘ç«™æœ‰æ­£åˆ™è¡¨è¾¾å¼çš„ä¸­æ–‡æ–‡æ¡£ -ã€‹ <a href="http://tool.oschina.net/uploads/apidocs/jquery/regexp.html" target="_blank" rel="noopener">æ­£åˆ™è¡¨è¾¾å¼æ‰‹å†Œ</a></p><h2 id="ç‰¹æ®Šå­—ç¬¦"><a href="#ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦"></a>ç‰¹æ®Šå­—ç¬¦</h2><p>ä¸€èˆ¬ä½¿ç”¨åæ–œæ  \ æ¥è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ å¦‚åœ¨æ­£åˆ™ä¸­æœ‰ç‰¹æ®Šæ„ä¹‰çš„* æˆ–è€…. å¦‚æœè¦ä½¿ç”¨åŸæ„åˆ™éœ€è¦ä½¿ç”¨\æ¥è¿›è¡Œè½¬ä¹‰ å¦‚ \*ã€‚ä¸‹é¢ä»‹ç»å‡ ä¸ªå…·ä½“çš„å®ä¾‹ã€‚</p><ol><li>^ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®</li><li>$ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸä½ç½®</li><li>. åŒ¹é…é™¤å»æ¢è¡Œç¬¦ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦</li><li>* åŒ¹é…å‰é¢å­—ç¬¦0æ¬¡æˆ–è€…å¤šæ¬¡</li><li>? åŒ¹é…å‰é¢å¤§çš„å­—ç¬¦0æ¬¡æˆ–è€…1æ¬¡</li><li>+ åŒ¹é…å‰é¢å­—ç¬¦ä¸€æ¬¡æˆ–å¤šæ¬¡</li><li>\w åŒ¹é…å­—æ¯æˆ–è€…æ•°å­—</li><li>\s åŒ¹é…ä»»æ„ç©ºç™½</li><li>\d åŒ¹é…æ•°å­—</li><li>\b åŒ¹é…å•è¯çš„å¼€å§‹æˆ–è€…ç»“æŸ</li></ol><p>ä¸€èˆ¬ä½¿ç”¨ ^ å¼€å¤´å¹¶ä¸”ä»¥ $ ç»“æŸï¼Œå¦‚éªŒè¯5-12ä½æ•°å­—çš„æ—¶å€™å¯ä»¥è¿™æ ·å†™ <code>^\d{5,12}$</code> å½“å­—ç¬¦ä¸²ä¸º <code>&quot;hello world</code> æ˜¯ï¼Œä½¿ç”¨$æ—¶åŒ¹é…åˆ°ä¸€å¤„ï¼Œè€Œä½¿ç”¨\bæ—¶ä¼šåŒ¹é…åˆ°å››å¤„ï¼Œåˆ†åˆ«ä¸ºæ¯ä¸ªå•è¯çš„å¼€å¤´å’Œç»“å°¾ã€‚</p><p>ç‰¹æ®Šå­—ç¬¦éå¸¸é‡è¦ï¼Œæ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„åŸºæœ¬ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨åˆ°äº†é‡å¤ï¼Œä¹Ÿå°±æ˜¯{m,n} må’Œnæ˜¯é‡å¤çš„æ¬¡æ•°ï¼Œå¦‚æœnå­˜åœ¨ï¼Œé‚£ä¹ˆå°±é‡å¤måˆ°næ¬¡å¦‚æœä¸å­˜åœ¨ï¼Œå°±é‡å¤mæ¬¡ã€‚</p><h2 id="å­—ç¬¦åŒ¹é…"><a href="#å­—ç¬¦åŒ¹é…" class="headerlink" title="å­—ç¬¦åŒ¹é…"></a>å­—ç¬¦åŒ¹é…</h2><p><strong>å½“ä½¿ç”¨åˆ°éç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™</strong>ï¼Œå¯ä»¥ä½¿ç”¨ä¸­æ‹¬å·ï¼Œå¦‚ [aeiou]ç”¨æ¥è¡¨ç¤ºå…¶ä¸­çš„å­—ç¬¦éƒ½å¯ä»¥åŒ¹é…åˆ°ã€‚æ¯”å¦‚ å­—ç¬¦ä¸² <code>â€˜how helloâ€™</code> ä½¿ç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼ <code>h[oe]</code> è¿™æ ·å¯ä»¥æç¤ºåŒ¹é…åˆ°ä¸¤å¤„</p><p><strong>å½“éœ€è¦ä½¿ç”¨ä¸ç‰¹æ®Šå­—ç¬¦ç›¸åçš„å«ä¹‰çš„æ—¶å€™</strong> ä½¿ç”¨åæ–œæ +å¤§å†™å­—ç¬¦çš„æ ¼å¼æ¥è¿›è¡ŒåŒ¹é…ã€‚æ¯”å¦‚åŒ¹é…éå­—æ¯å’Œæ•°å­—çš„å­—ç¬¦å°±åº”è¯¥ä½¿ç”¨<code>\W</code>(å› ä¸ºä½¿ç”¨åŒ¹é…å­—æ¯å’Œæ•°å­—çš„ç‰¹æ®Šå­—ç¬¦æ˜¯\w)ã€‚éç‰¹æ®Šå­—ç¬¦çš„åä¹‰ä½¿ç”¨^å·ã€‚å¦‚[^aeiou]è¡¨ç¤ºåŸå› å­—ç¬¦æ„å¤–çš„ä»»æ„å­—ç¬¦ã€‚</p><p><strong>å½“æƒ³åŒ¹é…å¤šç§æƒ…å†µçš„æ—¶å€™</strong>ï¼Œæ¯”å¦‚æˆ‘æƒ³åŒ¹é…xæˆ–è€…yå­—ç¬¦ä¸²é‚£ä¹ˆå°±ä½¿ç”¨ x|y æ¥è¡¨ç¤ºåŒ¹é…xæˆ–è€…yã€‚è¿™æ ·å¯ä»¥è§£å†³å¾ˆå¤šäºŒä¹‰æ€§çš„åŒ¹é…ä¸²ã€‚</p><h2 id="åˆ†ç»„çš„åŒ¹é…"><a href="#åˆ†ç»„çš„åŒ¹é…" class="headerlink" title="åˆ†ç»„çš„åŒ¹é…"></a>åˆ†ç»„çš„åŒ¹é…</h2><p>å½“æƒ³å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œé‡å¤ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨åˆ†ç»„çš„åŠŸèƒ½ã€‚ä½¿ç”¨å°æ‹¬å·æ¥å®ç°ã€‚å…¸å‹çš„ipåœ°å€çš„åŒ¹é…å°±å¯ä»¥è¿™æ ·ä½¿ç”¨(\d{1,3}.){3}\d{1,3}</p><p>ä½¿ç”¨ <code>\\+æ•°å­—</code> çš„å½¢å¼ æ¥å®ç°é‡å¤é‚£ä¸ªåˆ†ç»„çš„æ“ä½œ<br>å¦‚ <code>\b(\w+)\b\s+\1\b</code> å°±å¯ä»¥åŒ¹é…ç›¸åŒçš„å­—ç¬¦ä¸²ã€‚</p><h2 id="è´ªå©ªæ¨¡å¼"><a href="#è´ªå©ªæ¨¡å¼" class="headerlink" title="è´ªå©ªæ¨¡å¼"></a>è´ªå©ªæ¨¡å¼</h2><p>å½“ä½¿ç”¨?ç´§è·Ÿå…¶ä»–ä»»ä½•ä¸€ä¸ªå…¶ä»–é™åˆ¶ç¬¦ä¹‹åæ¯”å¦‚. * ä¹‹åï¼ŒåŒ¹é…æ¨¡å¼æ˜¯éè´ªå©ªçš„ï¼Œå°½å¯èƒ½å°‘çš„åŒ¹é…æœç´ çš„æ‰€æœ‰å­—ç¬¦ä¸²ã€‚æ¯”å¦‚æœå¤špppppppå­—ç¬¦ä¸²ï¼Œä½¿ç”¨â€˜o+?â€™ä¼šåŒ¹é…åˆ°å•ä¸ªo</p><h2 id="å…³äº-çš„åç»­"><a href="#å…³äº-çš„åç»­" class="headerlink" title="å…³äº çš„åç»­"></a>å…³äº çš„åç»­</h2><ul><li><p>(?:pattern) åŒ¹é…patternä½†ä¸è·å–ç»“æœã€‚è¿™åœ¨ä½¿ç”¨|æ¥ç»„åˆä¸€ä¸ªæ¨¡å¼çš„å„ä¸ªéƒ¨åˆ†éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚å¸¸è§„åŒ¹é…ä¸¤ç§å­—ç¬¦ä¸²â€œusername|userMannerâ€å¯ä»¥ä½¿ç”¨user(?:name|Manner)æ¥ç®€å†™ã€‚</p></li><li><p>(?=pattern) æ­£å‘è‚¯å®šé¢„æŸ¥ã€‚æ¯”å¦‚windows(?=95|03|NT)èƒ½å¤ŸåŒ¹é…åˆ°windows95ä¸­çš„windowsè€Œä¸èƒ½åŒ¹é…åˆ°windowsxpä¸­çš„windows</p></li><li><p>(?!pattern) æ­£å‘å¦å®šé¢„æŸ¥ã€‚ä¸ä¸Šé¢çš„æ„æ€ç›¸ä¼¼ï¼Œå°±æ˜¯èƒ½å¤ŸåŒ¹é…åˆ°éçš„æŒ‡å®šæ¡ä»¶ã€‚æ¯”å¦‚windows(?!95|03|NT`èƒ½å¤ŸåŒ¹é…åˆ°windowsxpä¸­çš„windowsè€Œä¸èƒ½åŒ¹é…åˆ°windows95ä¸­çš„windows</p></li><li><p>(?&lt;=pattern) åå‘è‚¯å®šé¢„æŸ¥ã€‚å’Œç¬¬ä¸€ä¸ªå¾ˆç›¸è¿‘ï¼Œåªä¸è¿‡æ–¹å‘ä¸åŒã€‚</p></li><li><p>(?&lt;!) åå‘å¦å®šé¢„æŸ¥ ã€‚</p></li></ul><p>è¿™æ¬¡çš„æ­£åˆ™è¡¨è¾¾å¼å°±å…ˆæ€»ç»“åˆ°è¿™é‡Œï¼Œä»¥åè‚¯å®šä¼šé‡åˆ°æ›´å¤šçš„å…³äºæ­£åˆ™çš„é—®é¢˜ã€‚æœ‰æ—¶é—´ä¸€å®šè¿˜è¦è¯»è¯»<a href="https://www.regular-expressions.info/" target="_blank" rel="noopener">è‹±æ–‡çš„æ­£åˆ™æ•™ç¨‹</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> æ­£åˆ™è¡¨è¾¾å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆäº”ï¼‰ bashä¸­å…³äºå˜é‡çš„æ›´å¤šçš„çŸ¥è¯†</title>
      <link href="/2018/05/02/2018-05-05-bash_05_%E6%93%8D%E4%BD%9C%E5%8F%98%E9%87%8F%202/"/>
      <url>/2018/05/02/2018-05-05-bash_05_%E6%93%8D%E4%BD%9C%E5%8F%98%E9%87%8F%202/</url>
      
        <content type="html"><![CDATA[<h1 id="å­—ç¬¦ä¸²æ“ä½œ"><a href="#å­—ç¬¦ä¸²æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²æ“ä½œ"></a>å­—ç¬¦ä¸²æ“ä½œ</h1><p>bashæ”¯æŒå¾ˆå¤šå…³äºå­—ç¬¦ä¸²çš„æ“ä½œï¼Œä¸è¿‡å¯æƒœçš„æ˜¯ï¼Œè¿™äº›æ“ä½œç¼ºä¹ç»Ÿä¸€æ€§ï¼Œæœ‰ä¸€äº›æ˜¯ä½¿ç”¨å‚æ•°ç­‰ï¼Œå¦å¤–ä¸€äº›æ˜¯é€šè¿‡å†…å»ºå‘½ä»¤<code>expr</code>å‘½ä»¤æ¥å®ç°ï¼Œè¿™ä¼šå¯¼è‡´ä¸åŒçš„è¯­æ³•åŠŸèƒ½çš„é‡å ï¼Œä¼šæ¯”è¾ƒæ··ä¹±ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹ä½¿ç”¨å‚æ•°å’Œå‘½ä»¤çš„å®ç°å­—ç¬¦ä¸²çš„æ“ä½œã€‚</p><ul><li><p>å­—ç¬¦ä¸²é•¿åº¦ï¼ˆString Lengthï¼‰</p><ol><li><p>$(#string) è¿™é‡Œæ˜¯å’ŒCè¯­è¨€ä¸­çš„strlen()æ˜¯ç›¸åŒçš„ã€‚</p></li><li><p>expr length $string åŒæ ·è¡¨ç¤ºstringä¸²çš„é•¿åº¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line">string=abcdefgHIGKL</span><br><span class="line"><span class="comment">#ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•$(#string)</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"stringçš„é•¿åº¦æ˜¯ï¼š<span class="variable">$&#123;#string&#125;</span>"</span></span><br><span class="line"><span class="comment">#ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ä½¿ç”¨exprå†…å»ºå‘½ä»¤ ä¼˜ç‚¹ç®€å•æ˜“æ‡‚</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"stringçš„é•¿åº¦æ˜¯ï¼š`expr length <span class="variable">$string</span>`"</span></span><br><span class="line">`</span><br></pre></td></tr></table></figure></li></ol></li><li><p>å­—ç¬¦ä¸²ä»å¼€å¤´åŒ¹é…å­å­—ä¸²çš„é•¿åº¦</p><p>  æ–¹æ³•å¦‚ä¸‹ï¼š</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stringZ=abcABC123ABCab </span><br><span class="line"><span class="built_in">echo</span> `expr match <span class="string">"<span class="variable">$stringZ</span>"</span> <span class="string">'abc[A-Z]*.2'</span>`</span><br><span class="line"><span class="built_in">echo</span> `expr <span class="variable">$stringZ</span> : <span class="string">'abc[A-Z]*.2'</span>`</span><br></pre></td></tr></table></figure></li><li><p>åŒ¹é…åˆ°å­ä¸²çš„ä½ç½® (index)</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> `expr index <span class="variable">$stringZ</span> <span class="string">'abc[A-Z]*.2'</span>`</span><br></pre></td></tr></table></figure></li><li><p>å­å­—ç¬¦ä¸²çš„æˆªå–</p><ol><li><p>${string:position} ä»positonä½ç½®æˆªå–å­—ç¬¦ä¸²stringã€‚</p></li><li><p>${string:positong:length} ä»positonä½ç½®æˆªå–å­—ç¬¦ä¸²stringï¼Œå¹¶ä¸”é™å®šæˆªå–é•¿åº¦ä¸ºlengthã€‚</p></li><li><p>expr substr $string $positon $length æ„æ€åŒä¸Šã€‚</p></li><li><p>expr match $string â€˜\(substring \)â€™ è¿™é‡Œçš„substringæ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æˆªå–å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ:5&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ:5:4&#125;</span></span><br><span class="line"><span class="built_in">echo</span> `expr substr <span class="variable">$stringZ</span> 5 4`</span><br><span class="line"><span class="built_in">echo</span> `expr match <span class="variable">$stringZ</span> <span class="string">'\(abc[A-Z]*.2\)'</span>`</span><br></pre></td></tr></table></figure></li></ol></li><li><p>ä»å­—ç¬¦ä¸²ä¸­ç§»é™¤å­å­—ç¬¦ä¸²</p><ol><li><p>${string#substring} substringæ˜¯å­å­—ç¬¦ä¸²ã€‚å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯å‘åç§»é™¤è¯¥å­å­—ç¬¦ä¸²æœ€çŸ­åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚</strong></p></li><li><p>${string##substring} ä¸ä¸Šé¢çš„æ­£å¥½ç›¸åã€‚<strong>è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯å‘åç§»é™¤è¯¥å­—ç¬¦ä¸²æœ€é•¿åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚</strong></p></li><li><p>${string%substring} <strong>è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯ç”±åå‘å‰ç§»é™¤è¯¥å­å­—ç¬¦ä¸²æœ€çŸ­åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚</strong></p></li><li><p>${string%%substring} <strong>è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯ç”±åå‘å‰ç§»é™¤è¯¥å­—ç¬¦ä¸²æœ€é•¿åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"ç§»é™¤å­—ç¬¦ä¸²"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ#a*b&#125;</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ##a*b&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ%a*c&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ%%a*c&#125;</span></span><br><span class="line"><span class="comment">#ç»“æœï¼š</span></span><br><span class="line"><span class="comment">#ABC123ABCabc</span></span><br><span class="line"><span class="comment">#c</span></span><br><span class="line"><span class="comment">#abcABC123ABC</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p>å­å­—ç¬¦ä¸²æ›¿æ¢</p><ol><li><p>${string/substring/replacement}  æ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°substringçš„å­—ç¬¦ä¸²ï¼Œæ›¿æ¢ä¸ºreplacementã€‚</p></li><li><p>${string//substring/replacement} æ›¿æ¢æ‰€æœ‰åŒ¹é…åˆ°çš„å­—ç¬¦ã€‚</p></li><li><p>${string/#substring/replacement} æ›¿æ¢ç”±å‰å‘ååŒ¹é…åˆ°çš„å­—ç¬¦ã€‚</p></li><li><p>${string/%substring/replacement} æ›¿æ¢ç”±åå‘å‰åŒ¹é…åˆ°çš„å­—ç¬¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"---------å­—ç¬¦ä¸²æ›¿æ¢---------"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ/abc/xyz&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ//abc/xyz&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ/#abc/xyz&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ/%abc/xyz&#125;</span></span><br><span class="line"><span class="comment">#ç»“æœï¼š</span></span><br><span class="line"><span class="comment">#xyzABC123ABCabc</span></span><br><span class="line"><span class="comment">#xyzABC123ABCxyz</span></span><br><span class="line"><span class="comment">#xyzABC123ABCabc</span></span><br><span class="line"><span class="comment">#abcABC123ABCxyz</span></span><br></pre></td></tr></table></figure></li></ol></li></ul><h2 id="ä½¿ç”¨awkæ“ä½œå­—ç¬¦ä¸²"><a href="#ä½¿ç”¨awkæ“ä½œå­—ç¬¦ä¸²" class="headerlink" title="ä½¿ç”¨awkæ“ä½œå­—ç¬¦ä¸²"></a>ä½¿ç”¨awkæ“ä½œå­—ç¬¦ä¸²</h2><p>ç°å­¦å…ˆå–ï¼Œ<a href="http://blog.jobbole.com/109089/" target="_blank" rel="noopener">ä¸‰ååˆ†é’Ÿå­¦ä¼šAWK</a>,å¿«é€Ÿäº†è§£å’Œåº”ç”¨awkã€‚</p><p>åŸºäºä»¥ä¸Šï¼Œä½¿ç”¨awkç»ƒä¹ ã€‚</p><p>å·¥ä½œæµåˆ†ä¸ºå¤§è‡´ä¸‰éƒ¨åˆ†ï¼Œ read-&gt;excute-&gt;repeat,å®ç°å¯¹æ–‡æœ¬çš„å¤„ç†ã€‚</p><h3 id="ç¨‹åºæœºæ„"><a href="#ç¨‹åºæœºæ„" class="headerlink" title="ç¨‹åºæœºæ„"></a>ç¨‹åºæœºæ„</h3><ul><li><p>BEGIN è¯­æ³•ï¼š<code>BEGIN {awk-commands}</code> æ˜¯å¯ä»¥çœç•¥çš„éƒ¨åˆ†å—ï¼Œä¸»è¦ä½œç”¨æ˜¯å£°æ˜å˜é‡ï¼Œåˆå§‹åŒ–å˜é‡ï¼Œ</p></li><li><p>BODYå— ï¼š<code>{commonds}</code>ï¼Œæ˜¯å¿…é¡»å¡«å†™çš„éƒ¨åˆ†ï¼Œä¸»è¦ä½œç”¨æ˜¯å¤„ç†æ–‡æœ¬ï¼Œä¼šå¯¹è¾“å…¥çš„æ¯ä¸€è¡Œéƒ½æ‰§è¡Œbodyå—ä¸­çš„å‘½ä»¤ï¼Œå¹¶ä¸”bodyæ˜¯æ²¡æœ‰å…³é”®å­—çš„ã€‚</p></li></ul><p>-END ï¼š<code>END {commands}</code>,åŒBEGINï¼Œæ˜¯å¯ä»¥çœç•¥çš„éƒ¨åˆ†</p><h3 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h3><ul><li><p>awkå‘½ä»¤è¡Œï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ<code>awk [-option] files</code>æ¥å®ç°å¯¹filesæ–‡ä»¶çš„å¤„ç†ã€‚ å¦‚ <code>awk {print} mark.txt</code> è¿™é‡Œå°±ä¸å…·ä½“ä¸¾ä¾‹äº†ï¼Œå¼€å¤´çš„é“¾æ¥é‡Œè®²çš„éå¸¸è¯¦ç»†ï¼Œè¿™é‡Œåªåšç®€å•çš„è®°å½•å’ŒæŸ¥çœ‹ã€‚</p></li><li><p>ä½¿ç”¨å‘½ä»¤æ–‡ä»¶æ–¹å¼ <code>awk -f command.awk marks.txt</code> ä½¿ç”¨-få‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</p></li><li><p>awkåŸºæœ¬é€‰é¡¹ ï¼š è¿™é‡Œä¸å…·ä½“æ€»ç»“ï¼Œlinuxç¯å¢ƒä¸‹ç»ˆç«¯ <code>man awk</code>å¯ä»¥çœ‹åˆ°éå¸¸å¤šçš„é€‰é¡¹ã€‚</p></li></ul><h3 id="åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹"><a href="#åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹"></a>åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹</h3><ol><li><p>åŸºæœ¬æ‰“å°æ–‡ä»¶å†…å®¹</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'&#123;print&#125;'</span> mark.txt </span><br><span class="line">1)  Amit    Physics  80</span><br><span class="line">2)  Rahul   Maths    90</span><br><span class="line">3)  Shyam   Biology  87</span><br><span class="line">4)  Kedar   English  85</span><br><span class="line">5)  Hari    History  89</span><br></pre></td></tr></table></figure></li><li><p>æ‰“å°å…·ä½“é¡¹å†…å®¹</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'&#123;print $1 "\t" $2 &#125;'</span> mark.txt</span><br><span class="line">1)      Amit</span><br><span class="line">2)      Rahul</span><br><span class="line">3)      Shyam</span><br><span class="line">4)      Kedar</span><br><span class="line">5)      Hari</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ é™å®šæ¡ä»¶çš„æ‰“å°å†…å®¹</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ awk  <span class="string">'/a/  &#123;print $1 "\t" $2 &#125;'</span> mark.txt</span><br><span class="line">2)      Rahul</span><br><span class="line">3)      Shyam</span><br><span class="line">4)      Kedar</span><br><span class="line">5)      Hari</span><br></pre></td></tr></table></figure><p> ç»“æœåªæ˜¾ç¤ºåŒ¹é…åˆ°açš„è¡Œ</p></li><li><p>æ‰“å°åŒ¹é…åˆ°çš„è¡Œæ•°</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;count=0&#125; /a/ &#123; count++&#125; END&#123;print count&#125;'</span> mark.txt</span><br><span class="line">4</span><br></pre></td></tr></table></figure></li><li><p>æ‰“å°å­—ç¬¦æ•°é‡è¶…è¿‡16çš„è¡Œ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'length($0) &gt; 18'</span> marks.txt</span><br><span class="line">3) Shyam   Biology   87</span><br><span class="line">4) Kedar   English   85</span><br></pre></td></tr></table></figure></li></ol><p>NOTE:åœ¨è¿™é‡Œçš„å‚æ•°å’Œbashä¸­çš„å‚æ•°ç±»ä¼¼ã€‚$0å½“å‰è¡Œï¼Œ$1ä¹‹åè¡¨ç¤ºå¯¹åº”æ–‡ä»¶çš„è¡Œçš„åˆ—ã€‚</p><h3 id="å†…å»ºå˜é‡"><a href="#å†…å»ºå˜é‡" class="headerlink" title="å†…å»ºå˜é‡"></a>å†…å»ºå˜é‡</h3><p>AWKæä¾›äº†å¾ˆå¤šå†…å»ºå˜é‡æä¾›ä½¿ç”¨ï¼Œèƒ½å¤Ÿèµ·åˆ°å¾ˆå¤§çš„ä½œç”¨ã€‚</p><h4 id="æ ‡å‡†awkå˜é‡"><a href="#æ ‡å‡†awkå˜é‡" class="headerlink" title="æ ‡å‡†awkå˜é‡"></a>æ ‡å‡†awkå˜é‡</h4><ul><li><p>ARGC å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;print "argument=",ARGC&#125;'</span> one two three</span><br><span class="line">argument= 4</span><br></pre></td></tr></table></figure></li><li><p>ARGV  å‘½ä»¤è¡Œå‚æ•°æ•°ç»„ å¦‚ <code>ARGV[1]=...</code></p></li><li><p>CONVFMT  æ•°å­—çš„çº¦å®šæ ¼å¼ï¼Œé»˜è®¤å€¼æ˜¯%.6g</p></li><li><p>ENVIRON ç¯å¢ƒå˜é‡ </p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN &#123;print "User is",ENVIRON["USER"]&#125;'</span></span><br><span class="line">User is nanyin</span><br></pre></td></tr></table></figure></li><li><p>FILENAME å½“å‰æ–‡ä»¶çš„åç§°</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'END&#123;print "this file name is", FILENAME&#125;'</span> mark.txt</span><br><span class="line">this file name is mark.txt</span><br></pre></td></tr></table></figure></li><li><p>FS åˆ†å‰²ç¬¦ é»˜è®¤æ˜¯ç©ºæ ¼ä¹Ÿå¯ä»¥ä½¿ç”¨-Fè®¾ç½®åˆ†å‰²ç¬¦</p></li><li><p>NF å½“å‰è¡Œçš„å­—æ®µæ•°ç›®</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'END&#123;print NF&#125;'</span> mark.txt</span><br><span class="line">4</span><br></pre></td></tr></table></figure></li><li><p>NR è¡Œå· </p></li><li><p>FNR å½“å‰æ–‡ä»¶çš„è¡Œå·</p></li><li><p>OFS è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦</p></li><li><p>ORS è¾“å‡ºè¡Œåˆ†å‰²ç¬¦</p></li><li><p>RLENGTH è¡¨ç¤ºmatchå‡½æ•°åŒ¹é…å­—ç¬¦åºŠçš„é•¿åº¦</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN &#123;if(match("One  Three","ree")) &#123;print RLENGTH&#125;&#125;'</span></span><br><span class="line">3</span><br></pre></td></tr></table></figure></li><li><p>RSTART è¡¨ç¤ºmatchå‡½æ•°ç¬¬ä¸€æ¬¡åŒ¹é…åˆ°çš„ä½ç½®</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN &#123;if(match("One  Three","ree")) &#123;print RSTART&#125;&#125;'</span> </span><br><span class="line">8</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ“ä½œç¬¦"><a href="#æ“ä½œç¬¦" class="headerlink" title="æ“ä½œç¬¦"></a>æ“ä½œç¬¦</h3><p>ä¸Cè¯­è¨€çš„æ“ä½œç¬¦åŸºæœ¬ç›¸åŒï¼Œå¦‚æ•°å­—çš„ä¸€å…ƒäºŒå…ƒä¸‰å…ƒæ“ä½œç­‰ï¼Œå­—ç¬¦ä¸²çš„é“¾æ¥ï¼Œæ•°ç»„å…ƒç´ ç­‰</p><h3 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h3><p>AWKå¯¹æ­£åˆ™çš„å¤„ç†éå¸¸å¼ºå¤§ï¼Œé€šå¸¸ä½ ä¸€ä¸ªå°å°çš„æ­£åˆ™è¡¨è¾¾å¼èƒ½å¤Ÿå¤„ç†å¾ˆå¤æ‚çš„é—®é¢˜ã€‚å…³äºæ­£åˆ™ï¼Œæœ‰æ—¶é—´æ•´ç†ä¸€ç¯‡ä¸“é—¨å…³äºæ­£åˆ™çš„æ–‡ç« ã€‚</p><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><p>AWKæ”¯æŒå…³è”æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä»…å¯ä»¥ä½¿ç”¨æ•°å­—ç´¢å¼•çš„æ•°ç»„ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºç´¢å¼•ã€‚åˆ é™¤æ•°ç»„å…ƒç´ ä½¿ç”¨deleteè¯­å¥</p><h3 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h3><p>æµç¨‹æ§åˆ¶if while for ä¸Cç›¸åŒ</p><h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><p>æŸ¥æ‰‹å†Œå§ã€‚ã€‚ä¸€æ¬¡æ€§çœ‹ä¸å®Œã€‚ã€‚ã€‚ã€‚<a href="https://www.gnu.org/software/gawk/manual/gawk.html#Built_002din" target="_blank" rel="noopener">å†…å»ºå‡½æ•°æ‰‹å†Œ</a>ï¼Œè¿™é‡Œæœ‰åœ¨è¿™ç« æ¯”è¾ƒé‡è¦çš„å­—ç¬¦ä¸²å‡½æ•°ã€‚æ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹æœ‰å“ªäº›å‡½æ•°æ¯”è¾ƒé‡è¦ã€‚</p><h4 id="AWKå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•°"><a href="#AWKå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•°" class="headerlink" title="AWKå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•°"></a>AWKå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•°</h4><p> æ•´ç†å‡ºawkå¯¹å­—ç¬¦ä¸²çš„å‡ ä¸ªå…·ä½“å‡½æ•°æ“ä½œã€‚</p><ol><li><p>asort(source,dest,how) </p></li><li><p>asorti(source,dest,how)</p><p>ä»¥ä¸Šä¸¤ä¸ªå‡½æ•°çš„howå…ˆä¸è§£é‡Šï¼Œå‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºsourceæ•°ç»„å’Œæ’åºæ–¹å¼ï¼Œç¬¬äºŒä¸ªå¯ä»¥ä¸å†™ï¼Œé»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä½çš„è¿›è¡Œæ’ä½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">'BEGIN&#123;a[0]="xiaohong";a[1]="aiaolan";asort(a);for(i=2;i&gt;=0;i--) &#123;print a[i]&#125;&#125;'</span></span><br><span class="line">    xiaohong</span><br><span class="line">    aiaolan</span><br><span class="line">`</span><br></pre></td></tr></table></figure><p>asorti()å‡½æ•°ä¼šå°†é¡ºåºæ›¿æ¢åˆ°æ•°ç»„çš„valueå¤„å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">'BEGIN&#123;a[0]="xiaohong";a[1]="aiaolan";asorti(a);for(i=2;i&gt;=0;i--) &#123;print a[i]&#125;&#125;'</span></span><br><span class="line">    1</span><br><span class="line">    0</span><br></pre></td></tr></table></figure></li><li><p>gensub(regexp,replacement,how[,target]) ç±»ä¼¼gsubå’Œsub</p><p>æ›¿æ¢åŒ¹é…åˆ°çš„æ­£åˆ™<em>regexp</em>ä¸ºreplacement.å¦‚æœhowæ˜¯gæˆ–è€…G(globalçš„ç®€å†™),åˆ™è¡¨ç¤ºæ›¿æ¢æ‰€æœ‰ä½¿ç”¨regexpåŒ¹é…åˆ°çš„å­—ç¬¦ä¸²,targetæ˜¯ç›®æ ‡å­—ç¬¦ä¸²</p><p>å¦‚æœä½¿ç”¨regexpæœªåŒ¹é…åˆ°ï¼Œåˆ™è¿”å›åŸå§‹targetçš„å€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ª</span></span><br><span class="line"><span class="built_in">echo</span> a b c a d | gawk <span class="string">'&#123;print gensub(/a/,"AA",2)&#125;'</span> </span><br><span class="line">a b c AA d</span><br><span class="line"><span class="comment"># ç¬¬äºŒä¸ª</span></span><br><span class="line">awk <span class="string">'</span></span><br><span class="line"><span class="string">BEGIN&#123;</span></span><br><span class="line"><span class="string">a="abc def"</span></span><br><span class="line"><span class="string">b = gensub(/(.+) (.+)/,"\\2 \\1","g",a)</span></span><br><span class="line"><span class="string">print b</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">def abc</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>gsub(regexp,replacement[,target]) </p><p> gsubä¸­çš„â€˜gâ€™å…¶å®æ˜¯è¡¨ç¤ºçš„æ˜¯global,å¯»æ‰¾ç›®æ ‡çš„åŒ¹é…åˆ°ä»å·¦æœ€é•¿çš„ï¼Œä¸é‡å çš„,æ‰¾åˆ°å¹¶ä¸”æ›¿æ¢æ‰ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; gsub(/Britain/, <span class="string">"United Kingdom"</span>); <span class="built_in">print</span> &#125;</span><br></pre></td></tr></table></figure><p> è¿”å›çš„å€¼ä¸ºåŒ¹é…åˆ°çš„æ¬¡æ•°</p></li><li><p>index(in,find)</p><p> å¯»æ‰¾inä¸²å†…ç¬¦åˆfindåŒ¹é…åˆ°çš„å­—ç¬¦çš„indexä½ç½®</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">quote&gt; print index("hello","lo")&#125;'</span></span><br><span class="line">4</span><br></pre></td></tr></table></figure></li><li><p>length([string]) é¡¾åæ€ä¹‰ï¼Œä¸è§£é‡Šäº†</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;print length("hello")&#125;'</span></span><br><span class="line">5</span><br></pre></td></tr></table></figure><p> NOTE: If no argument is supplied, length() returns the length of $0. </p></li><li><p>match(string,regexp,[,array]) </p><p> ä½¿ç”¨æ­£åˆ™åŒ¹é…å­—ç¬¦ä¸²ï¼Œè¿”å›åŒ¹é…åˆ°çš„ä½ç½®ï¼Œè‹¥æœªåŒ¹é…åˆ°è¿”å›0</p></li><li><p>split(string,array[,fieldsep[,seps]])</p><p> åˆ†å‰²stringå­—ç¬¦ä¸²ï¼Œä½¿ç”¨arrayå­˜æ”¾åˆ†å‰²åäº§ç”Ÿçš„å­—ç¬¦ç»„ï¼Œä½¿ç”¨fieldsepç»„ä¸ºåˆ†å‰²ç¬¦ï¼Œsepså­˜æ”¾æ¯æ¬¡åˆ†å‰²äº§ç”Ÿçš„åˆ†å‰²ç¬¦ã€‚ä¸€ä¸ªåˆ†å‰²å‡ºæ¥çš„å­˜æ”¾åˆ°array[1]ä¸­ï¼Œç¬¬äºŒä¸ªå­˜æ”¾åˆ°array[2]ä¸­ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœåˆ†å‰²ç¬¦fieldsepä¸å†™ï¼Œåˆ™é»˜è®¤åˆ†å‰²ç¬¦ä¸ºç©ºæ ¼ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;print split("cul-de-sac",a,"-",seps);for(i=1;i&lt;4;i++)&#123;print a[i]&#125;&#125;'</span> </span><br><span class="line">3</span><br><span class="line">cul</span><br><span class="line">de</span><br><span class="line">sac</span><br></pre></td></tr></table></figure></li><li><p>sprintf(format,expression1,..)</p><p> æ˜¯printfçš„åŠŸèƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¿”å›å­—ç¬¦ä¸²</p></li><li><p>strtonum (str)</p><p>ç±»ä¼¼javaçš„parseInt()å‡½æ•°ï¼Œç”±Stringå­—ç¬¦ä¸²è½¬æˆæ•°å­—</p></li><li><p>subï¼ˆregexp,replacement[,target]ï¼‰</p><p>æœ€å·¦æœ€é•¿åŒ¹é…åŸåˆ™è¿›è¡ŒåŒ¹é…ï¼Œsubä¸ªgsubçš„ä½œç”¨ç›¸åŒï¼Œåˆ†å‰²å­—ç¬¦ä¸²ï¼Œå¹¶è¿›è¡Œæ›¿æ¢</p></li><li><p>substr(string,start[,end])</p><p>åˆ†å‰²å­—ç¬¦ä¸²</p></li><li><p>tolower(string) &amp; toupper(string)</p><p>å¤§å°å†™è½¬æ¢</p></li></ol><p>å…³äºawkçš„å°±æ€»ç»“åˆ°è¿™äº†ã€‚ã€‚ååˆ†åŸºç¡€çš„æ€»ç»“ã€‚ã€‚æ¨èæ–‡æ¡£ï¼Œæ¸…æ™°æ˜äº†ã€‚ä¸‹ä¸€ç¯‡æ‰“ç®—å…ˆæ•´ç†æ•´ç†æ­£åˆ™è¡¨è¾¾å¼ã€‚ç°åœ¨å“ªé‡Œéƒ½ä¼šç”¨åˆ°æ­£åˆ™ï¼Œè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çœ‹çœ‹æ­£åˆ™çš„ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆäº”ï¼‰ bashä¸­å…³äºå˜é‡çš„æ›´å¤šçš„çŸ¥è¯†</title>
      <link href="/2018/05/02/2018-05-05-bash_05_%E6%93%8D%E4%BD%9C%E5%8F%98%E9%87%8F/"/>
      <url>/2018/05/02/2018-05-05-bash_05_%E6%93%8D%E4%BD%9C%E5%8F%98%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="å­—ç¬¦ä¸²æ“ä½œ"><a href="#å­—ç¬¦ä¸²æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²æ“ä½œ"></a>å­—ç¬¦ä¸²æ“ä½œ</h1><p>bashæ”¯æŒå¾ˆå¤šå…³äºå­—ç¬¦ä¸²çš„æ“ä½œï¼Œä¸è¿‡å¯æƒœçš„æ˜¯ï¼Œè¿™äº›æ“ä½œç¼ºä¹ç»Ÿä¸€æ€§ï¼Œæœ‰ä¸€äº›æ˜¯ä½¿ç”¨å‚æ•°ç­‰ï¼Œå¦å¤–ä¸€äº›æ˜¯é€šè¿‡å†…å»ºå‘½ä»¤<code>expr</code>å‘½ä»¤æ¥å®ç°ï¼Œè¿™ä¼šå¯¼è‡´ä¸åŒçš„è¯­æ³•åŠŸèƒ½çš„é‡å ï¼Œä¼šæ¯”è¾ƒæ··ä¹±ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹ä½¿ç”¨å‚æ•°å’Œå‘½ä»¤çš„å®ç°å­—ç¬¦ä¸²çš„æ“ä½œã€‚</p><ul><li><p>å­—ç¬¦ä¸²é•¿åº¦ï¼ˆString Lengthï¼‰</p><ol><li><p>$(#string) è¿™é‡Œæ˜¯å’ŒCè¯­è¨€ä¸­çš„strlen()æ˜¯ç›¸åŒçš„ã€‚</p></li><li><p>expr length $string åŒæ ·è¡¨ç¤ºstringä¸²çš„é•¿åº¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line">string=abcdefgHIGKL</span><br><span class="line"><span class="comment">#ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•$(#string)</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"stringçš„é•¿åº¦æ˜¯ï¼š<span class="variable">$&#123;#string&#125;</span>"</span></span><br><span class="line"><span class="comment">#ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ä½¿ç”¨exprå†…å»ºå‘½ä»¤ ä¼˜ç‚¹ç®€å•æ˜“æ‡‚</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"stringçš„é•¿åº¦æ˜¯ï¼š`expr length <span class="variable">$string</span>`"</span></span><br><span class="line">`</span><br></pre></td></tr></table></figure></li></ol></li><li><p>å­—ç¬¦ä¸²ä»å¼€å¤´åŒ¹é…å­å­—ä¸²çš„é•¿åº¦</p><p>  æ–¹æ³•å¦‚ä¸‹ï¼š</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stringZ=abcABC123ABCab </span><br><span class="line"><span class="built_in">echo</span> `expr match <span class="string">"<span class="variable">$stringZ</span>"</span> <span class="string">'abc[A-Z]*.2'</span>`</span><br><span class="line"><span class="built_in">echo</span> `expr <span class="variable">$stringZ</span> : <span class="string">'abc[A-Z]*.2'</span>`</span><br></pre></td></tr></table></figure></li><li><p>åŒ¹é…åˆ°å­ä¸²çš„ä½ç½® (index)</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> `expr index <span class="variable">$stringZ</span> <span class="string">'abc[A-Z]*.2'</span>`</span><br></pre></td></tr></table></figure></li><li><p>å­å­—ç¬¦ä¸²çš„æˆªå–</p><ol><li><p>${string:position} ä»positonä½ç½®æˆªå–å­—ç¬¦ä¸²stringã€‚</p></li><li><p>${string:positong:length} ä»positonä½ç½®æˆªå–å­—ç¬¦ä¸²stringï¼Œå¹¶ä¸”é™å®šæˆªå–é•¿åº¦ä¸ºlengthã€‚</p></li><li><p>expr substr $string $positon $length æ„æ€åŒä¸Šã€‚</p></li><li><p>expr match $string â€˜\(substring \)â€™ è¿™é‡Œçš„substringæ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æˆªå–å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ:5&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ:5:4&#125;</span></span><br><span class="line"><span class="built_in">echo</span> `expr substr <span class="variable">$stringZ</span> 5 4`</span><br><span class="line"><span class="built_in">echo</span> `expr match <span class="variable">$stringZ</span> <span class="string">'\(abc[A-Z]*.2\)'</span>`</span><br></pre></td></tr></table></figure></li></ol></li><li><p>ä»å­—ç¬¦ä¸²ä¸­ç§»é™¤å­å­—ç¬¦ä¸²</p><ol><li><p>${string#substring} substringæ˜¯å­å­—ç¬¦ä¸²ã€‚å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯å‘åç§»é™¤è¯¥å­å­—ç¬¦ä¸²æœ€çŸ­åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚</strong></p></li><li><p>${string##substring} ä¸ä¸Šé¢çš„æ­£å¥½ç›¸åã€‚<strong>è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯å‘åç§»é™¤è¯¥å­—ç¬¦ä¸²æœ€é•¿åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚</strong></p></li><li><p>${string%substring} <strong>è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯ç”±åå‘å‰ç§»é™¤è¯¥å­å­—ç¬¦ä¸²æœ€çŸ­åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚</strong></p></li><li><p>${string%%substring} <strong>è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯ç”±åå‘å‰ç§»é™¤è¯¥å­—ç¬¦ä¸²æœ€é•¿åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"ç§»é™¤å­—ç¬¦ä¸²"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ#a*b&#125;</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ##a*b&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ%a*c&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ%%a*c&#125;</span></span><br><span class="line"><span class="comment">#ç»“æœï¼š</span></span><br><span class="line"><span class="comment">#ABC123ABCabc</span></span><br><span class="line"><span class="comment">#c</span></span><br><span class="line"><span class="comment">#abcABC123ABC</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p>å­å­—ç¬¦ä¸²æ›¿æ¢</p><ol><li><p>${string/substring/replacement}  æ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°substringçš„å­—ç¬¦ä¸²ï¼Œæ›¿æ¢ä¸ºreplacementã€‚</p></li><li><p>${string//substring/replacement} æ›¿æ¢æ‰€æœ‰åŒ¹é…åˆ°çš„å­—ç¬¦ã€‚</p></li><li><p>${string/#substring/replacement} æ›¿æ¢ç”±å‰å‘ååŒ¹é…åˆ°çš„å­—ç¬¦ã€‚</p></li><li><p>${string/%substring/replacement} æ›¿æ¢ç”±åå‘å‰åŒ¹é…åˆ°çš„å­—ç¬¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"---------å­—ç¬¦ä¸²æ›¿æ¢---------"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ/abc/xyz&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ//abc/xyz&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ/#abc/xyz&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;stringZ/%abc/xyz&#125;</span></span><br><span class="line"><span class="comment">#ç»“æœï¼š</span></span><br><span class="line"><span class="comment">#xyzABC123ABCabc</span></span><br><span class="line"><span class="comment">#xyzABC123ABCxyz</span></span><br><span class="line"><span class="comment">#xyzABC123ABCabc</span></span><br><span class="line"><span class="comment">#abcABC123ABCxyz</span></span><br></pre></td></tr></table></figure></li></ol></li></ul><h2 id="ä½¿ç”¨awkæ“ä½œå­—ç¬¦ä¸²"><a href="#ä½¿ç”¨awkæ“ä½œå­—ç¬¦ä¸²" class="headerlink" title="ä½¿ç”¨awkæ“ä½œå­—ç¬¦ä¸²"></a>ä½¿ç”¨awkæ“ä½œå­—ç¬¦ä¸²</h2><p>ç°å­¦å…ˆå–ï¼Œ<a href="http://blog.jobbole.com/109089/" target="_blank" rel="noopener">ä¸‰ååˆ†é’Ÿå­¦ä¼šAWK</a>,å¿«é€Ÿäº†è§£å’Œåº”ç”¨awkã€‚</p><p>åŸºäºä»¥ä¸Šï¼Œä½¿ç”¨awkç»ƒä¹ ã€‚</p><p>å·¥ä½œæµåˆ†ä¸ºå¤§è‡´ä¸‰éƒ¨åˆ†ï¼Œ read-&gt;excute-&gt;repeat,å®ç°å¯¹æ–‡æœ¬çš„å¤„ç†ã€‚</p><h3 id="ç¨‹åºæœºæ„"><a href="#ç¨‹åºæœºæ„" class="headerlink" title="ç¨‹åºæœºæ„"></a>ç¨‹åºæœºæ„</h3><ul><li><p>BEGIN è¯­æ³•ï¼š<code>BEGIN {awk-commands}</code> æ˜¯å¯ä»¥çœç•¥çš„éƒ¨åˆ†å—ï¼Œä¸»è¦ä½œç”¨æ˜¯å£°æ˜å˜é‡ï¼Œåˆå§‹åŒ–å˜é‡ï¼Œ</p></li><li><p>BODYå— ï¼š<code>{commonds}</code>ï¼Œæ˜¯å¿…é¡»å¡«å†™çš„éƒ¨åˆ†ï¼Œä¸»è¦ä½œç”¨æ˜¯å¤„ç†æ–‡æœ¬ï¼Œä¼šå¯¹è¾“å…¥çš„æ¯ä¸€è¡Œéƒ½æ‰§è¡Œbodyå—ä¸­çš„å‘½ä»¤ï¼Œå¹¶ä¸”bodyæ˜¯æ²¡æœ‰å…³é”®å­—çš„ã€‚</p></li></ul><p>-END ï¼š<code>END {commands}</code>,åŒBEGINï¼Œæ˜¯å¯ä»¥çœç•¥çš„éƒ¨åˆ†</p><h3 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h3><ul><li><p>awkå‘½ä»¤è¡Œï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ<code>awk [-option] files</code>æ¥å®ç°å¯¹filesæ–‡ä»¶çš„å¤„ç†ã€‚ å¦‚ <code>awk {print} mark.txt</code> è¿™é‡Œå°±ä¸å…·ä½“ä¸¾ä¾‹äº†ï¼Œå¼€å¤´çš„é“¾æ¥é‡Œè®²çš„éå¸¸è¯¦ç»†ï¼Œè¿™é‡Œåªåšç®€å•çš„è®°å½•å’ŒæŸ¥çœ‹ã€‚</p></li><li><p>ä½¿ç”¨å‘½ä»¤æ–‡ä»¶æ–¹å¼ <code>awk -f command.awk marks.txt</code> ä½¿ç”¨-få‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</p></li><li><p>awkåŸºæœ¬é€‰é¡¹ ï¼š è¿™é‡Œä¸å…·ä½“æ€»ç»“ï¼Œlinuxç¯å¢ƒä¸‹ç»ˆç«¯ <code>man awk</code>å¯ä»¥çœ‹åˆ°éå¸¸å¤šçš„é€‰é¡¹ã€‚</p></li></ul><h3 id="åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹"><a href="#åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹"></a>åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹</h3><ol><li><p>åŸºæœ¬æ‰“å°æ–‡ä»¶å†…å®¹</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'&#123;print&#125;'</span> mark.txt </span><br><span class="line">1)  Amit    Physics  80</span><br><span class="line">2)  Rahul   Maths    90</span><br><span class="line">3)  Shyam   Biology  87</span><br><span class="line">4)  Kedar   English  85</span><br><span class="line">5)  Hari    History  89</span><br></pre></td></tr></table></figure></li><li><p>æ‰“å°å…·ä½“é¡¹å†…å®¹</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'&#123;print $1 "\t" $2 &#125;'</span> mark.txt</span><br><span class="line">1)      Amit</span><br><span class="line">2)      Rahul</span><br><span class="line">3)      Shyam</span><br><span class="line">4)      Kedar</span><br><span class="line">5)      Hari</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ é™å®šæ¡ä»¶çš„æ‰“å°å†…å®¹</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ awk  <span class="string">'/a/  &#123;print $1 "\t" $2 &#125;'</span> mark.txt</span><br><span class="line">2)      Rahul</span><br><span class="line">3)      Shyam</span><br><span class="line">4)      Kedar</span><br><span class="line">5)      Hari</span><br></pre></td></tr></table></figure><p> ç»“æœåªæ˜¾ç¤ºåŒ¹é…åˆ°açš„è¡Œ</p></li><li><p>æ‰“å°åŒ¹é…åˆ°çš„è¡Œæ•°</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;count=0&#125; /a/ &#123; count++&#125; END&#123;print count&#125;'</span> mark.txt</span><br><span class="line">4</span><br></pre></td></tr></table></figure></li><li><p>æ‰“å°å­—ç¬¦æ•°é‡è¶…è¿‡16çš„è¡Œ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'length($0) &gt; 18'</span> marks.txt</span><br><span class="line">3) Shyam   Biology   87</span><br><span class="line">4) Kedar   English   85</span><br></pre></td></tr></table></figure></li></ol><p>NOTE:åœ¨è¿™é‡Œçš„å‚æ•°å’Œbashä¸­çš„å‚æ•°ç±»ä¼¼ã€‚$0å½“å‰è¡Œï¼Œ$1ä¹‹åè¡¨ç¤ºå¯¹åº”æ–‡ä»¶çš„è¡Œçš„åˆ—ã€‚</p><h3 id="å†…å»ºå˜é‡"><a href="#å†…å»ºå˜é‡" class="headerlink" title="å†…å»ºå˜é‡"></a>å†…å»ºå˜é‡</h3><p>AWKæä¾›äº†å¾ˆå¤šå†…å»ºå˜é‡æä¾›ä½¿ç”¨ï¼Œèƒ½å¤Ÿèµ·åˆ°å¾ˆå¤§çš„ä½œç”¨ã€‚</p><h4 id="æ ‡å‡†awkå˜é‡"><a href="#æ ‡å‡†awkå˜é‡" class="headerlink" title="æ ‡å‡†awkå˜é‡"></a>æ ‡å‡†awkå˜é‡</h4><ul><li><p>ARGC å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;print "argument=",ARGC&#125;'</span> one two three</span><br><span class="line">argument= 4</span><br></pre></td></tr></table></figure></li><li><p>ARGV  å‘½ä»¤è¡Œå‚æ•°æ•°ç»„ å¦‚ <code>ARGV[1]=...</code></p></li><li><p>CONVFMT  æ•°å­—çš„çº¦å®šæ ¼å¼ï¼Œé»˜è®¤å€¼æ˜¯%.6g</p></li><li><p>ENVIRON ç¯å¢ƒå˜é‡ </p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN &#123;print "User is",ENVIRON["USER"]&#125;'</span></span><br><span class="line">User is nanyin</span><br></pre></td></tr></table></figure></li><li><p>FILENAME å½“å‰æ–‡ä»¶çš„åç§°</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'END&#123;print "this file name is", FILENAME&#125;'</span> mark.txt</span><br><span class="line">this file name is mark.txt</span><br></pre></td></tr></table></figure></li><li><p>FS åˆ†å‰²ç¬¦ é»˜è®¤æ˜¯ç©ºæ ¼ä¹Ÿå¯ä»¥ä½¿ç”¨-Fè®¾ç½®åˆ†å‰²ç¬¦</p></li><li><p>NF å½“å‰è¡Œçš„å­—æ®µæ•°ç›®</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'END&#123;print NF&#125;'</span> mark.txt</span><br><span class="line">4</span><br></pre></td></tr></table></figure></li><li><p>NR è¡Œå· </p></li><li><p>FNR å½“å‰æ–‡ä»¶çš„è¡Œå·</p></li><li><p>OFS è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦</p></li><li><p>ORS è¾“å‡ºè¡Œåˆ†å‰²ç¬¦</p></li><li><p>RLENGTH è¡¨ç¤ºmatchå‡½æ•°åŒ¹é…å­—ç¬¦åºŠçš„é•¿åº¦</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN &#123;if(match("One  Three","ree")) &#123;print RLENGTH&#125;&#125;'</span></span><br><span class="line">3</span><br></pre></td></tr></table></figure></li><li><p>RSTART è¡¨ç¤ºmatchå‡½æ•°ç¬¬ä¸€æ¬¡åŒ¹é…åˆ°çš„ä½ç½®</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN &#123;if(match("One  Three","ree")) &#123;print RSTART&#125;&#125;'</span> </span><br><span class="line">8</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ“ä½œç¬¦"><a href="#æ“ä½œç¬¦" class="headerlink" title="æ“ä½œç¬¦"></a>æ“ä½œç¬¦</h3><p>ä¸Cè¯­è¨€çš„æ“ä½œç¬¦åŸºæœ¬ç›¸åŒï¼Œå¦‚æ•°å­—çš„ä¸€å…ƒäºŒå…ƒä¸‰å…ƒæ“ä½œç­‰ï¼Œå­—ç¬¦ä¸²çš„é“¾æ¥ï¼Œæ•°ç»„å…ƒç´ ç­‰</p><h3 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h3><p>AWKå¯¹æ­£åˆ™çš„å¤„ç†éå¸¸å¼ºå¤§ï¼Œé€šå¸¸ä½ ä¸€ä¸ªå°å°çš„æ­£åˆ™è¡¨è¾¾å¼èƒ½å¤Ÿå¤„ç†å¾ˆå¤æ‚çš„é—®é¢˜ã€‚å…³äºæ­£åˆ™ï¼Œæœ‰æ—¶é—´æ•´ç†ä¸€ç¯‡ä¸“é—¨å…³äºæ­£åˆ™çš„æ–‡ç« ã€‚</p><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><p>AWKæ”¯æŒå…³è”æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä»…å¯ä»¥ä½¿ç”¨æ•°å­—ç´¢å¼•çš„æ•°ç»„ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºç´¢å¼•ã€‚åˆ é™¤æ•°ç»„å…ƒç´ ä½¿ç”¨deleteè¯­å¥</p><h3 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h3><p>æµç¨‹æ§åˆ¶if while for ä¸Cç›¸åŒ</p><h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><p>æŸ¥æ‰‹å†Œå§ã€‚ã€‚ä¸€æ¬¡æ€§çœ‹ä¸å®Œã€‚ã€‚ã€‚ã€‚<a href="https://www.gnu.org/software/gawk/manual/gawk.html#Built_002din" target="_blank" rel="noopener">å†…å»ºå‡½æ•°æ‰‹å†Œ</a>ï¼Œè¿™é‡Œæœ‰åœ¨è¿™ç« æ¯”è¾ƒé‡è¦çš„å­—ç¬¦ä¸²å‡½æ•°ã€‚æ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹æœ‰å“ªäº›å‡½æ•°æ¯”è¾ƒé‡è¦ã€‚</p><h4 id="AWKå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•°"><a href="#AWKå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•°" class="headerlink" title="AWKå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•°"></a>AWKå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•°</h4><p> æ•´ç†å‡ºawkå¯¹å­—ç¬¦ä¸²çš„å‡ ä¸ªå…·ä½“å‡½æ•°æ“ä½œã€‚</p><ol><li><p>asort(source,dest,how) </p></li><li><p>asorti(source,dest,how)</p><p>ä»¥ä¸Šä¸¤ä¸ªå‡½æ•°çš„howå…ˆä¸è§£é‡Šï¼Œå‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºsourceæ•°ç»„å’Œæ’åºæ–¹å¼ï¼Œç¬¬äºŒä¸ªå¯ä»¥ä¸å†™ï¼Œé»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä½çš„è¿›è¡Œæ’ä½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">'BEGIN&#123;a[0]="xiaohong";a[1]="aiaolan";asort(a);for(i=2;i&gt;=0;i--) &#123;print a[i]&#125;&#125;'</span></span><br><span class="line">    xiaohong</span><br><span class="line">    aiaolan</span><br><span class="line">`</span><br></pre></td></tr></table></figure><p>asorti()å‡½æ•°ä¼šå°†é¡ºåºæ›¿æ¢åˆ°æ•°ç»„çš„valueå¤„å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">'BEGIN&#123;a[0]="xiaohong";a[1]="aiaolan";asorti(a);for(i=2;i&gt;=0;i--) &#123;print a[i]&#125;&#125;'</span></span><br><span class="line">    1</span><br><span class="line">    0</span><br></pre></td></tr></table></figure></li><li><p>gensub(regexp,replacement,how[,target]) ç±»ä¼¼gsubå’Œsub</p><p>æ›¿æ¢åŒ¹é…åˆ°çš„æ­£åˆ™<em>regexp</em>ä¸ºreplacement.å¦‚æœhowæ˜¯gæˆ–è€…G(globalçš„ç®€å†™),åˆ™è¡¨ç¤ºæ›¿æ¢æ‰€æœ‰ä½¿ç”¨regexpåŒ¹é…åˆ°çš„å­—ç¬¦ä¸²,targetæ˜¯ç›®æ ‡å­—ç¬¦ä¸²</p><p>å¦‚æœä½¿ç”¨regexpæœªåŒ¹é…åˆ°ï¼Œåˆ™è¿”å›åŸå§‹targetçš„å€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ª</span></span><br><span class="line"><span class="built_in">echo</span> a b c a d | gawk <span class="string">'&#123;print gensub(/a/,"AA",2)&#125;'</span> </span><br><span class="line">a b c AA d</span><br><span class="line"><span class="comment"># ç¬¬äºŒä¸ª</span></span><br><span class="line">awk <span class="string">'</span></span><br><span class="line"><span class="string">BEGIN&#123;</span></span><br><span class="line"><span class="string">a="abc def"</span></span><br><span class="line"><span class="string">b = gensub(/(.+) (.+)/,"\\2 \\1","g",a)</span></span><br><span class="line"><span class="string">print b</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">def abc</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>gsub(regexp,replacement[,target]) </p><p> gsubä¸­çš„â€˜gâ€™å…¶å®æ˜¯è¡¨ç¤ºçš„æ˜¯global,å¯»æ‰¾ç›®æ ‡çš„åŒ¹é…åˆ°ä»å·¦æœ€é•¿çš„ï¼Œä¸é‡å çš„,æ‰¾åˆ°å¹¶ä¸”æ›¿æ¢æ‰ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; gsub(/Britain/, <span class="string">"United Kingdom"</span>); <span class="built_in">print</span> &#125;</span><br></pre></td></tr></table></figure><p> è¿”å›çš„å€¼ä¸ºåŒ¹é…åˆ°çš„æ¬¡æ•°</p></li><li><p>index(in,find)</p><p> å¯»æ‰¾inä¸²å†…ç¬¦åˆfindåŒ¹é…åˆ°çš„å­—ç¬¦çš„indexä½ç½®</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">quote&gt; print index("hello","lo")&#125;'</span></span><br><span class="line">4</span><br></pre></td></tr></table></figure></li><li><p>length([string]) é¡¾åæ€ä¹‰ï¼Œä¸è§£é‡Šäº†</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;print length("hello")&#125;'</span></span><br><span class="line">5</span><br></pre></td></tr></table></figure><p> NOTE: If no argument is supplied, length() returns the length of $0. </p></li><li><p>match(string,regexp,[,array]) </p><p> ä½¿ç”¨æ­£åˆ™åŒ¹é…å­—ç¬¦ä¸²ï¼Œè¿”å›åŒ¹é…åˆ°çš„ä½ç½®ï¼Œè‹¥æœªåŒ¹é…åˆ°è¿”å›0</p></li><li><p>split(string,array[,fieldsep[,seps]])</p><p> åˆ†å‰²stringå­—ç¬¦ä¸²ï¼Œä½¿ç”¨arrayå­˜æ”¾åˆ†å‰²åäº§ç”Ÿçš„å­—ç¬¦ç»„ï¼Œä½¿ç”¨fieldsepç»„ä¸ºåˆ†å‰²ç¬¦ï¼Œsepså­˜æ”¾æ¯æ¬¡åˆ†å‰²äº§ç”Ÿçš„åˆ†å‰²ç¬¦ã€‚ä¸€ä¸ªåˆ†å‰²å‡ºæ¥çš„å­˜æ”¾åˆ°array[1]ä¸­ï¼Œç¬¬äºŒä¸ªå­˜æ”¾åˆ°array[2]ä¸­ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœåˆ†å‰²ç¬¦fieldsepä¸å†™ï¼Œåˆ™é»˜è®¤åˆ†å‰²ç¬¦ä¸ºç©ºæ ¼ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'BEGIN&#123;print split("cul-de-sac",a,"-",seps);for(i=1;i&lt;4;i++)&#123;print a[i]&#125;&#125;'</span> </span><br><span class="line">3</span><br><span class="line">cul</span><br><span class="line">de</span><br><span class="line">sac</span><br></pre></td></tr></table></figure></li><li><p>sprintf(format,expression1,..)</p><p> æ˜¯printfçš„åŠŸèƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¿”å›å­—ç¬¦ä¸²</p></li><li><p>strtonum (str)</p><p>ç±»ä¼¼javaçš„parseInt()å‡½æ•°ï¼Œç”±Stringå­—ç¬¦ä¸²è½¬æˆæ•°å­—</p></li><li><p>subï¼ˆregexp,replacement[,target]ï¼‰</p><p>æœ€å·¦æœ€é•¿åŒ¹é…åŸåˆ™è¿›è¡ŒåŒ¹é…ï¼Œsubä¸ªgsubçš„ä½œç”¨ç›¸åŒï¼Œåˆ†å‰²å­—ç¬¦ä¸²ï¼Œå¹¶è¿›è¡Œæ›¿æ¢</p></li><li><p>substr(string,start[,end])</p><p>åˆ†å‰²å­—ç¬¦ä¸²</p></li><li><p>tolower(string) &amp; toupper(string)</p><p>å¤§å°å†™è½¬æ¢</p></li></ol><p>å…³äºawkçš„å°±æ€»ç»“åˆ°è¿™äº†ã€‚ã€‚ååˆ†åŸºç¡€çš„æ€»ç»“ã€‚ã€‚æ¨èæ–‡æ¡£ï¼Œæ¸…æ™°æ˜äº†ã€‚ä¸‹ä¸€ç¯‡æ‰“ç®—å…ˆæ•´ç†æ•´ç†æ­£åˆ™è¡¨è¾¾å¼ã€‚ç°åœ¨å“ªé‡Œéƒ½ä¼šç”¨åˆ°æ­£åˆ™ï¼Œè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çœ‹çœ‹æ­£åˆ™çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaè®¾è®¡æ¨¡å¼åˆ†ç±»å’ŒåŸåˆ™</title>
      <link href="/2018/04/17/2018-04-17-Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%88%86%E7%B1%BB%E5%92%8C%E5%8E%9F%E5%88%99/"/>
      <url>/2018/04/17/2018-04-17-Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%88%86%E7%B1%BB%E5%92%8C%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaè®¾è®¡æ¨¡å¼åˆ†ç±»ä¸åŸåˆ™"><a href="#Javaè®¾è®¡æ¨¡å¼åˆ†ç±»ä¸åŸåˆ™" class="headerlink" title="Javaè®¾è®¡æ¨¡å¼åˆ†ç±»ä¸åŸåˆ™"></a>Javaè®¾è®¡æ¨¡å¼åˆ†ç±»ä¸åŸåˆ™</h1><p>æ¯æ¬¡å­¦ä¹ å®Œè®¾è®¡æ¨¡å¼ï¼Œè¿‡ä¸€é˜µå°±å¿˜äº†ï¼Œæ‰€ä»¥å†™å‡ ç¯‡åšå®¢è®°å½•ä¸‹ï¼Œè®©è‡ªå·±çš„è®°å¿†æ›´æ·±åˆ»ä¸€ä¸‹ã€‚</p><p>æ¨è <a href="https://www.cnblogs.com/malihe/p/6891920.html" target="_blank" rel="noopener">Javaä¸­23ç§è®¾è®¡æ¨¡å¼â€“è¶…å¿«é€Ÿå…¥é—¨åŠä¸¾ä¾‹ä»£ç </a> è¿™ç¯‡åšå®¢ã€‚èƒ½å¿«é€Ÿäº†è§£è®¾è®¡æ¨¡å¼ã€‚</p><p>æ¨ègithubä¸Šçš„é¡¹ç›®<a href="https://github.com/iluwatar/java-design-patterns" target="_blank" rel="noopener">java-design-patterns</a> æœ‰ä¾‹å­æºç ï¼Œå¯ä»¥é€šè¿‡å…·ä½“ä¾‹å­äº†è§£è®¾è®¡æ¨¡å¼ã€‚</p><h2 id="Javaè®¾è®¡æ¨¡å¼çš„åŸºæœ¬åˆ†ç±»"><a href="#Javaè®¾è®¡æ¨¡å¼çš„åŸºæœ¬åˆ†ç±»" class="headerlink" title="Javaè®¾è®¡æ¨¡å¼çš„åŸºæœ¬åˆ†ç±»"></a>Javaè®¾è®¡æ¨¡å¼çš„åŸºæœ¬åˆ†ç±»</h2><p>javaçš„è®¾è®¡æ¨¡å¼å¤§ä½“ä¸Šåˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p><ul><li><p>åˆ›å»ºå‹æ¨¡å¼ï¼ˆ5ç§ï¼‰ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œå•ä¾‹æ¨¡å¼ï¼Œå»ºé€ è€…æ¨¡å¼ï¼ŒåŸå‹æ¨¡å¼ã€‚</p></li><li><p>ç»“æ„å‹æ¨¡å¼ï¼ˆ7ç§ï¼‰ï¼šé€‚é…å™¨æ¨¡å¼ï¼Œè£…é¥°å™¨æ¨¡å¼ï¼Œä»£ç†æ¨¡å¼ï¼Œå¤–è§‚æ¨¡å¼ï¼Œæ¡¥æ¥æ¨¡å¼ï¼Œç»„åˆæ¨¡å¼ï¼Œäº«å…ƒæ¨¡å¼ã€‚</p></li><li><p>è¡Œä¸ºå‹æ¨¡å¼ï¼ˆ11ç§ï¼‰ï¼šç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼</p></li></ul><h2 id="è®¾è®¡æ¨¡å¼éµå¾ªçš„åŸåˆ™æœ‰å…­ä¸ª"><a href="#è®¾è®¡æ¨¡å¼éµå¾ªçš„åŸåˆ™æœ‰å…­ä¸ª" class="headerlink" title="è®¾è®¡æ¨¡å¼éµå¾ªçš„åŸåˆ™æœ‰å…­ä¸ª"></a>è®¾è®¡æ¨¡å¼éµå¾ªçš„åŸåˆ™æœ‰å…­ä¸ª</h2><ul><li><p><strong>å¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰</strong></p><p>  ã€€å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p></li><li><p><strong>é‡Œæ°ä»£æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰</strong></p><p>  åªæœ‰å½“è¡ç”Ÿç±»å¯ä»¥æ›¿æ¢æ‰åŸºç±»ï¼Œè½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼ŒåŸºç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œè¡ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨åŸºç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚</p></li><li><p><strong>ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰</strong></p><p>  ã€€ã€€è¿™ä¸ªæ˜¯å¼€é—­åŸåˆ™çš„åŸºç¡€ï¼Œå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸ä¾èµ–äºå…·ä½“ã€‚</p></li><li><p><strong>æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰</strong></p><p>  ä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æ¥å£æ¥é™ä½è€¦åˆåº¦ã€‚</p></li><li><p><strong>è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆæœ€å°‘çŸ¥é“åŸåˆ™ï¼‰ï¼ˆDemeter Principleï¼‰</strong></p><p>  ä¸€ä¸ªå®ä½“åº”å½“å°½é‡å°‘çš„ä¸å…¶ä»–å®ä½“ä¹‹é—´å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œä½¿å¾—ç³»ç»ŸåŠŸèƒ½æ¨¡å—ç›¸å¯¹ç‹¬ç«‹ã€‚</p></li><li><p><strong>åˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuse Principleï¼‰</strong></p><p>  ã€€åŸåˆ™æ˜¯å°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚ç»§æ‰¿å®é™…ä¸Šç ´åäº†ç±»çš„å°è£…æ€§ï¼Œè¶…ç±»çš„æ–¹æ³•å¯èƒ½ä¼šè¢«å­ç±»ä¿®æ”¹ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆå››ï¼‰ bashä¸­çš„æ“ä½œåŠç›¸å…³è¯é¢˜</title>
      <link href="/2018/04/12/2018-04-16-bash_operationAndRelatedTopics/"/>
      <url>/2018/04/12/2018-04-16-bash_operationAndRelatedTopics/</url>
      
        <content type="html"><![CDATA[<h1 id="bashå­¦ä¹ è®°å½•ï¼ˆå››ï¼‰-bashä¸­çš„æ“ä½œåŠç›¸å…³è¯é¢˜"><a href="#bashå­¦ä¹ è®°å½•ï¼ˆå››ï¼‰-bashä¸­çš„æ“ä½œåŠç›¸å…³è¯é¢˜" class="headerlink" title="bashå­¦ä¹ è®°å½•ï¼ˆå››ï¼‰ bashä¸­çš„æ“ä½œåŠç›¸å…³è¯é¢˜"></a>bashå­¦ä¹ è®°å½•ï¼ˆå››ï¼‰ bashä¸­çš„æ“ä½œåŠç›¸å…³è¯é¢˜</h1><h2 id="è®¡ç®—ç¬¦-Operators"><a href="#è®¡ç®—ç¬¦-Operators" class="headerlink" title="è®¡ç®—ç¬¦ Operators"></a>è®¡ç®—ç¬¦ Operators</h2><h3 id="ä¸€-èµ‹å€¼ï¼ˆassignmentï¼‰"><a href="#ä¸€-èµ‹å€¼ï¼ˆassignmentï¼‰" class="headerlink" title="ä¸€.èµ‹å€¼ï¼ˆassignmentï¼‰"></a>ä¸€.èµ‹å€¼ï¼ˆassignmentï¼‰</h3><p><em>å˜é‡èµ‹å€¼</em>ï¼šåˆå§‹åŒ–å˜é‡æˆ–è€…æ”¹å˜å˜é‡çš„å€¼</p><p>åœ¨æ‰€æœ‰çš„èµ‹å€¼æ“ä½œä¸­ï¼Œè®¡ç®—èµ‹å€¼å’Œå­—ç¬¦ä¸²å¤åˆ¶éƒ½æ˜¯å¯ä»¥çš„ï¼Œå¹¶ä¸å­˜åœ¨å·®å¼‚ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var=27</span><br><span class="line">category=minerals  </span><br><span class="line"># No spaces allowed after the &quot;=&quot;.</span><br></pre></td></tr></table></figure><h3 id="äºŒ-è®¡ç®—æ“ä½œç¬¦"><a href="#äºŒ-è®¡ç®—æ“ä½œç¬¦" class="headerlink" title="äºŒ.è®¡ç®—æ“ä½œç¬¦"></a>äºŒ.è®¡ç®—æ“ä½œç¬¦</h3><p><code>+</code>ï¼Œ<code>-</code>ï¼Œ<code>*</code>ï¼Œ<code>/</code>,<code>%</code>ï¼ˆå–æ¨¡è¿ç®—ï¼‰ï¼Œ<code>+=</code>ï¼Œ<code>-=</code>ï¼Œ<code>*=</code>,<code>/=</code>,<code>%=</code>è¿™äº›æ“ä½œç¬¦å’Œå…¶ä»–è¯­è¨€ï¼ˆæ¯”å¦‚javaï¼‰è¯­ä¹‰ç›¸åŒã€‚å”¯ä¸€æœ‰ä¸ªå·®å¼‚çš„æ˜¯ <code>**</code> æ˜¯ä¹˜æ–¹æ“ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#ä¸€èˆ¬èµ‹å€¼</span><br><span class="line">i=1</span><br><span class="line">bash=&quot;/bin/bash&quot;</span><br><span class="line"></span><br><span class="line">#ä¸€èˆ¬æ“ä½œç¬¦</span><br><span class="line">let &quot;z=i+1&quot;</span><br><span class="line">echo $z</span><br><span class="line"></span><br><span class="line">let &quot;i+=2&quot;</span><br><span class="line">echo $i</span><br><span class="line"></span><br><span class="line">let &quot;z=i**2&quot;</span><br><span class="line">echo $z</span><br></pre></td></tr></table></figure><blockquote><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong>bashä¸èƒ½ç†è§£æµ®ç‚¹æ•°ï¼Œä»–ä¼šé»˜è®¤æŠŠæµ®ç‚¹æ•°å½“ä½œå­—ç¬¦ä¸²æ¥å¤„ç†ã€‚</p></blockquote><blockquote><p>éœ€è¦åœ¨è„šæœ¬ä¸­ä½¿ç”¨ <code>bc</code>æ¥è®¡ç®—æµ®ç‚¹æ•°</p></blockquote><h3 id="ä¸‰-å…¶ä»–æ“ä½œç¬¦"><a href="#ä¸‰-å…¶ä»–æ“ä½œç¬¦" class="headerlink" title="ä¸‰.å…¶ä»–æ“ä½œç¬¦"></a>ä¸‰.å…¶ä»–æ“ä½œç¬¦</h3><ul><li><p>æŒ‰ä½æ“ä½œï¼š</p><p>  <code>&lt;&lt;</code> : bitwise left shift (multiplies by 2 for each shift position)</p><p>  <code>&gt;&gt;</code>: bitwise right shift (divides by 2 for each shift position)</p><p>  <code>&amp;,|ï¼Œï½ï¼Œ^</code> : åˆ†åˆ«å¯¹åº” ä½ä¸ï¼Œä½æˆ–ï¼Œä½å¦,å¼‚æˆ–</p></li><li><p>é€»è¾‘æ“ä½œ</p><p>  <code>ï¼</code> ï¼šé</p><p>  <code>&amp;&amp;</code> ï¼š AND</p><p>  <code>||</code>  ï¼š OR</p></li><li><p>æ‚é¡¹</p><p>  <code>ï¼Œ</code> ï¼šé€—å·æ“ä½œç¬¦ï¼Œè¿æ¥å¤šä¸ªè®¡ç®—è¡¨è¾¾å¼ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ ·åªèƒ½è¿”å›æœ€åä¸€ä¸ªç®—å¼çš„å€¼</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> <span class="string">"t1 = ((5 + 3, 7 - 1, 15 - 4))"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"t1 = <span class="variable">$t1</span>"</span>            <span class="comment"># t1 = 11</span></span><br><span class="line"><span class="comment"># Here t1 is set to the result of the last operation. Why?</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> <span class="string">"t2 = ((a = 9, 15 / 3))"</span>      <span class="comment"># Set "a" and calculate "t2".</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"t2 = <span class="variable">$t2</span>    a = <span class="variable">$a</span>"</span>         <span class="comment"># t2 = 5    a = 9</span></span><br><span class="line">`</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆä¸‰ï¼‰ bashä¸­çš„é€€å‡ºç å’Œæµ‹è¯•ï¼ˆTestï¼‰</title>
      <link href="/2018/04/12/2018-04-12-bash_exitCode/"/>
      <url>/2018/04/12/2018-04-12-bash_exitCode/</url>
      
        <content type="html"><![CDATA[<h1 id="bashå­¦ä¹ è®°å½•ï¼ˆä¸‰ï¼‰-bashé€€å‡ºç å’Œæµ‹è¯•"><a href="#bashå­¦ä¹ è®°å½•ï¼ˆä¸‰ï¼‰-bashé€€å‡ºç å’Œæµ‹è¯•" class="headerlink" title="bashå­¦ä¹ è®°å½•ï¼ˆä¸‰ï¼‰ bashé€€å‡ºç å’Œæµ‹è¯•"></a>bashå­¦ä¹ è®°å½•ï¼ˆä¸‰ï¼‰ bashé€€å‡ºç å’Œæµ‹è¯•</h1><h2 id="1-Bashé€€å‡ºç "><a href="#1-Bashé€€å‡ºç " class="headerlink" title="1. Bashé€€å‡ºç "></a>1. Bashé€€å‡ºç </h2><ul><li><p>è„šæœ¬çš„é€€å‡ºå‘½ä»¤ï¼Œç±»ä¼¼Cè¯­è¨€ä¸­çš„ <code>return value</code> ï¼Œå¯ä»¥ä¾›è„šæœ¬çš„çˆ¶è¿›ç¨‹è°ƒç”¨ã€‚</p></li><li><p>æ¯æ¡å‘½ä»¤è¿”å›ä¸€æ¡çŠ¶æ€çŠ¶æ€ï¼Œå‘½ä»¤æ‰§è¡ŒæˆåŠŸè¿”å›<code>0</code>ï¼Œæ‰§è¡Œå¤±è´¥è¿”å›<code>é0</code>çŠ¶æ€ç å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé”™è¯¯ç ï¼ˆ<code>error code</code>ï¼‰ã€‚</p></li><li><p>æœ€åçš„å‘½ä»¤è¿”å›çš„çŠ¶æ€æˆ–è€… exit nnnï¼ˆè¿™é‡Œçš„nnnå¿…é¡»æ˜¯1ï½255ä¹‹é—´çš„æ•´æ•°ï¼‰ä¼ é€’ç»™shellã€‚</p></li></ul><p><code>exit nnn</code> <code>exit</code> <code>exit $?</code> æˆ–è€…<code>ç©º</code>ã€‚éƒ½å¯ä»¥ï¼Œæ˜¯bash <code>Return value</code>çš„æ–¹å¼ã€‚</p><ul><li>å¯ä»¥ä½¿ç”¨ <code>ï¼</code>æ¥åè½¬çŠ¶æ€ã€‚</li></ul><h2 id="2-Bashä¸­çš„test"><a href="#2-Bashä¸­çš„test" class="headerlink" title="2. Bashä¸­çš„test"></a>2. Bashä¸­çš„test</h2><p>æ¯ä¸ªç¼–ç¨‹è¯­è¨€éƒ½ä¼šæœ‰å¯¹ä¸€ä¸ªæƒ…å†µä¸‹æµ‹è¯•çš„åŠŸèƒ½ï¼ŒBashä¹Ÿä¸ä¾‹å¤–ï¼Œbashæä¾›testå‘½ä»¤ï¼Œå¤šç§çš„æ‹¬å·æ“ä½œï¼Œæœ€ç»ˆè¦çš„If/elseç»“æ„è¯­å¥æ¥å®ç°teståŠŸèƒ½ã€‚</p><h3 id="æµ‹è¯•ç»“æ„ä½“-Test-Constructs"><a href="#æµ‹è¯•ç»“æ„ä½“-Test-Constructs" class="headerlink" title="æµ‹è¯•ç»“æ„ä½“(Test Constructs)"></a>æµ‹è¯•ç»“æ„ä½“(Test Constructs)</h3><ul><li><p>ä¸€ä¸ªif/elseç»“æ„ä½“ä¼šæµ‹è¯•ä¸€ç³»åˆ—å‘½ä»¤çš„è¿”å›å€¼æ˜¯å¦æ˜¯0ä¹Ÿå°±æ˜¯å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚å¦‚æœæˆåŠŸæ‰§è¡Œå¦å¤–ä¸€ç³»åˆ—æ“ä½œã€‚</p></li><li><p>bashä½¿ç”¨ <code>[</code> æ¥è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯åœ¨åæ¥çš„ç‰ˆæœ¬é‡Œï¼Œbashå¼•è¿›äº† <code>[[</code> æ¥æ‹“å±•testå‘½ä»¤ï¼ŒbashæŠŠ<code>[[$a -lt $b]]</code>çœ‹ä½œä¸€ä¸ªå…ƒç´ ï¼Œä»–ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ç ï¼ˆæˆåŠŸ0ï¼Œä¸æˆåŠŸæ˜¯é0ï¼‰</p></li><li><p>å½“ä½¿ç”¨<code>let</code> å’Œ <code>(())</code> çš„æ—¶å€™ï¼Œå¯¹è®¡ç®—è¡¨è¾¾å¼è¿›è¡Œè¿ç®—çš„æ—¶å€™ä¹Ÿä¼šè¿”å›exit codeï¼Œç”¨äºå¯¹ç®—å¼çš„æµ‹è¯•</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">(( 0 &amp;&amp; 1 ))                 # Logical AND</span><br><span class="line">echo $?     # 1     ***</span><br><span class="line"># And so ...</span><br><span class="line">let &quot;num = (( 0 &amp;&amp; 1 ))&quot;</span><br><span class="line">echo $num   # 0</span><br><span class="line"># But ...</span><br><span class="line">let &quot;num = (( 0 &amp;&amp; 1 ))&quot;</span><br><span class="line">echo $?     # 1     ***</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(( 200 || 11 ))              # Logical OR</span><br><span class="line">echo $?     # 0     ***</span><br><span class="line"># ...</span><br><span class="line">let &quot;num = (( 200 || 11 ))&quot;</span><br><span class="line">echo $num   # 1</span><br><span class="line">let &quot;num = (( 200 || 11 ))&quot;</span><br><span class="line">echo $?     # 0     ***</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(( 200 | 11 ))               # Bitwise OR</span><br><span class="line">echo $?                      # 0     ***</span><br><span class="line"># ...</span><br><span class="line">let &quot;num = (( 200 | 11 ))&quot;</span><br><span class="line">echo $num                    # 203</span><br><span class="line">let &quot;num = (( 200 | 11 ))&quot;</span><br><span class="line">echo $?                      # 0     ***</span><br><span class="line"></span><br><span class="line"># The &quot;let&quot; construct returns the same exit status</span><br><span class="line">#+ as the double-parentheses arithmetic expansion.</span><br></pre></td></tr></table></figure><ul><li><p>ifå¯ä»¥æµ‹è¯•ä»»ä½•æ¡ä»¶ ä¸ä»…ä»…æ˜¯åŒ…åœ¨æ‹¬å·é‡Œé¢çš„æ¡ä»¶ã€‚</p></li><li><p><strong>Else if and elif</strong></p><blockquote><p>elifç›¸å½“ä¸ else ifï¼Œè¦è¯·æ±‚åˆ†æ”¯éœ€è¦ç”¨åˆ°elif</p></blockquote>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ condition1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">command1</span><br><span class="line">command2</span><br><span class="line">command3</span><br><span class="line"><span class="keyword">elif</span> [ condition2 ]</span><br><span class="line"><span class="comment"># Same as else if</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">command4</span><br><span class="line">command5</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">default-command</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li><li><p>Equivalence of test, <code>/usr/bin/test</code>,<code>[ ]</code>, and <code>/usr/bin/[</code> ä½¿ç”¨è¿™å‡ ä¸ªåšåˆ¤æ–­éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ›´å¤æ‚çš„è¡¨è¾¾å¼è¦ä½¿ç”¨<code>[[]]</code>æ¥ä»£æ›¿<code>[]</code>ã€‚</p><blockquote><p>Using the [[ â€¦ ]] test construct, rather than [ â€¦ ] can prevent many logic errors in scripts. è¿™æ˜¯Advanced Bash-Scripting Guideç»™å‡ºçš„å»ºè®®ã€‚</p></blockquote></li></ul><h3 id="æ–‡ä»¶æµ‹è¯•æ“ä½œï¼ˆFileï¼‰"><a href="#æ–‡ä»¶æµ‹è¯•æ“ä½œï¼ˆFileï¼‰" class="headerlink" title="æ–‡ä»¶æµ‹è¯•æ“ä½œï¼ˆFileï¼‰"></a>æ–‡ä»¶æµ‹è¯•æ“ä½œï¼ˆFileï¼‰</h3><ul><li><p>-e æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p></li><li><p>-a æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆä»¥å¼ƒç”¨ï¼‰</p></li><li><p>-f æ˜¯å¦æ˜¯æ™®é€šæ–‡ä»¶(ä¸æ˜¯ç›®å½•æ–‡ä»¶æˆ–è€…è®¾å¤‡æ–‡ä»¶)</p></li><li><p>-s æ˜¯å¦æ˜¯ç©ºæ–‡ä»¶</p></li><li><p>-d æ˜¯å¦æ˜¯ç›®å½•</p></li><li><p>-b æ˜¯å¦æ˜¯å—è®¾å¤‡(block device)</p></li><li><p>-c æ˜¯å¦æ˜¯å­—ç¬¦è®¾å¤‡(character device)</p></li><li><p>-h æ˜¯å¦æ˜¯é“¾æ¥æ–‡ä»¶(symbolic link)</p></li><li><p>-S file is socket</p></li><li><p>-r -w -x åˆ†åˆ«å¯¹åº”æ–‡ä»¶çš„ è¯»å†™æ‰§è¡Œæƒé™</p></li><li><p>-O æ˜¯å¦æ˜¯æ–‡ä»¶çš„æ‹¥æœ‰è€…</p></li><li><p>-G group-idæ˜¯å¦å’Œä½ è‡ªå·±çš„ç›¸åŒ</p></li><li><p>-N åœ¨æœ€åä¸€æ¬¡è¢«è¯»ä¹‹åæ–‡ä»¶å·²ç»æ›´æ”¹</p></li><li><p>f1 <code>-nt</code> f2 f1æ¯”f2æ–° </p></li><li><p><code>-ot</code> f1æ¯”f2æ—§ </p></li><li><p><code>-ef</code> f1å’Œf2 å¼•ç”¨åŒä¸€ä¸ªæ–‡ä»¶</p></li><li><p>ä¾‹å­</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> directory <span class="keyword">in</span> <span class="variable">$directorys</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="variable">$directory</span> ]</span><br><span class="line">    <span class="keyword">then</span> linkchk <span class="variable">$directory</span></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$directory</span> is not a directory"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> dir1 dir2 ..."</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="å…¶ä»–æ¯”è¾ƒæ“ä½œï¼ˆIntegerï¼ŒStringï¼‰"><a href="#å…¶ä»–æ¯”è¾ƒæ“ä½œï¼ˆIntegerï¼ŒStringï¼‰" class="headerlink" title="å…¶ä»–æ¯”è¾ƒæ“ä½œï¼ˆIntegerï¼ŒStringï¼‰"></a>å…¶ä»–æ¯”è¾ƒæ“ä½œï¼ˆIntegerï¼ŒStringï¼‰</h3><p>æ•´å‹å’Œå­—ç¬¦ä¸²ç±»å‹ä½¿ç”¨ä¸¤ç»„ä¸åŒçš„æ“ä½œ</p><h4 id="æ•´å½¢"><a href="#æ•´å½¢" class="headerlink" title="æ•´å½¢"></a>æ•´å½¢</h4><ul><li><p>-eq ç›¸ç­‰æ¯”è¾ƒ <code>if [ &quot;$a&quot; -eq &quot;$b&quot; ]</code></p></li><li><p>-ne æ¯”è¾ƒä¸ç›¸ç­‰ <code>if [ &quot;$a&quot; -ne &quot;$b&quot; ]</code></p></li><li><p>-gt å¤§äºç­‰äº(is greater than or equal to) <code>if [ &quot;$a&quot; -ge &quot;$b&quot; ]</code></p></li><li><p>-lt å°äº(is less than) <code>if [ &quot;$a&quot; -lt &quot;$b&quot; ]</code></p></li><li><p>-le å°äºç­‰äº(is less than or equal to) `if [ â€œ$aâ€ -le â€œ$bâ€ ]</p></li><li><p><code>&lt;</code> <code>&gt;</code> <code>&lt;=</code> <code>&gt;=</code> å¯¹åº”å¤§äºï¼Œå°äºï¼Œå°äºç­‰äºï¼Œå¤§äºç­‰äºè¿™äº›ç›¸åº”çš„æ“ä½œ</p></li></ul><h4 id="Stringç±»å‹"><a href="#Stringç±»å‹" class="headerlink" title="Stringç±»å‹"></a>Stringç±»å‹</h4><ul><li><p>= åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰</p></li><li><p>== å’Œ = ç›¸åŒï¼ŒåŒæ ·æ˜¯åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸åŒ ä½† == åœ¨ [] å’Œ [[]] ä¸­å®šä¹‰ä¸åŒï¼Œä¸‹é¢ä¸¾ä¾‹ï¼š</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[[ $a == z* ]]   # True if $a starts with an &quot;z&quot; (pattern matching).</span><br><span class="line">[[ $a == &quot;z*&quot; ]] # True if $a is equal to z* (literal matching).</span><br><span class="line"></span><br><span class="line">[ $a == z* ]     # File globbing and word splitting take place.</span><br><span class="line">[ &quot;$a&quot; == &quot;z*&quot; ] # True if $a is equal to z* (literal matching).</span><br></pre></td></tr></table></figure><ul><li><p>!= ä¸ç­‰äº</p></li><li><p>&lt; and &gt; å¤§äºå°äº æŒ‰ç…§ASCII ç æ¯”è¾ƒ</p></li><li><p>-z ç©ºå­—ç¬¦ä¸²,å› æ­¤ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¸º0</p></li><li><p>-n å­—ç¬¦ä¸²ä¸ä¸ºç©º</p></li></ul><h4 id="é€»è¾‘æ¯”è¾ƒ"><a href="#é€»è¾‘æ¯”è¾ƒ" class="headerlink" title="é€»è¾‘æ¯”è¾ƒ"></a>é€»è¾‘æ¯”è¾ƒ</h4><ul><li><p>-a è¡¨ç¤ºé€»è¾‘ä¸</p></li><li><p>-o è¡¨ç¤ºé€»è¾‘æˆ–</p><p>  -a -o è¦ä½¿ç”¨åœ¨å•ä¸ªä¸­æ‹¬å·ä¸­<code>if [ &quot;$expr1&quot; -a &quot;$expr2&quot; ]</code></p><p>  &amp;&amp; and || ä½†æ˜¯è¦åœ¨åŒä¸­æ‹¬å·ä¸­ä½¿ç”¨<code>[[ condition1 &amp;&amp; condition2 ]]</code> </p></li></ul><h3 id="åµŒå¥—-if-else"><a href="#åµŒå¥—-if-else" class="headerlink" title="åµŒå¥— if else"></a>åµŒå¥— <code>if else</code></h3><p>å¦‚å…¶ä»–ç¼–ç¨‹è¯­è¨€ç±»ä¼¼,if elseç»“æ„èƒ½å¤ŸåµŒå¥—ï¼Œä½†æ˜¯åµŒå¥—ç»“æ„å’Œä½¿ç”¨ <code>&amp;&amp;</code> æ¯”è¾ƒç¬¦ç»“æœç›¸åŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">a=3</span><br><span class="line"></span><br><span class="line">if [ &quot;$a&quot; -gt 0 ]</span><br><span class="line">then</span><br><span class="line">  if [ &quot;$a&quot; -lt 5 ]</span><br><span class="line">  then</span><br><span class="line">    echo &quot;The value of \&quot;a\&quot; lies somewhere between 0 and 5.&quot;</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># Same result as:</span><br><span class="line"></span><br><span class="line">if [ &quot;$a&quot; -gt 0 ] &amp;&amp; [ &quot;$a&quot; -lt 5 ]</span><br><span class="line">then</span><br><span class="line">  echo &quot;The value of \&quot;a\&quot; lies somewhere between 0 and 5.&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆäºŒï¼‰ bashä¸­çš„å˜é‡å’Œå‚æ•°</title>
      <link href="/2018/04/11/2018-4-11-bash_%E5%8F%98%E9%87%8F/"/>
      <url>/2018/04/11/2018-4-11-bash_%E5%8F%98%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="bashå­¦ä¹ è®°å½•ï¼ˆäºŒï¼‰-bashä¸­çš„å˜é‡å’Œå‚æ•°"><a href="#bashå­¦ä¹ è®°å½•ï¼ˆäºŒï¼‰-bashä¸­çš„å˜é‡å’Œå‚æ•°" class="headerlink" title="bashå­¦ä¹ è®°å½•ï¼ˆäºŒï¼‰ bashä¸­çš„å˜é‡å’Œå‚æ•°"></a>bashå­¦ä¹ è®°å½•ï¼ˆäºŒï¼‰ bashä¸­çš„å˜é‡å’Œå‚æ•°</h1><p>å˜é‡å°±æ˜¯ä¸€ä¸ªæ ‡ç­¾åœ¨è„šæœ¬ä¸­ä»£è¡¨æ•°æ®ï¼Œä¸è¿‡æ˜¯ç»™åˆ†é…åœ¨ç”µè„‘å†…å­˜ä¸­çš„æ•°æ®ä¸€ä¸ªåå­—ï¼Œç»å¸¸ä¼šå‡ºç°åœ¨æ•°å­¦è®¡ç®—å’Œå¤§é‡æ“ä½œ(manipulation of quantities)å’Œå­—ç¬¦ä¸²è§£æ(string parsing)ä¸­ã€‚</p><h2 id="å˜é‡ç½®æ¢-Variable-Substitution"><a href="#å˜é‡ç½®æ¢-Variable-Substitution" class="headerlink" title="å˜é‡ç½®æ¢ (Variable Substitution) $"></a>å˜é‡ç½®æ¢ (Variable Substitution) $</h2><p>The name of a variable is a placeholder for its value, the data it holds. Referencing (retrieving) its value is called variable substitution. å¤§è‡´æ„æ€å°±æ˜¯å˜é‡å¼•ç”¨å…·ä½“çš„å€¼ã€‚ä½¿ç”¨$æ¥å¼•ç”¨å˜é‡ å¦‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bash$ variable1=23</span><br><span class="line"></span><br><span class="line">bash$ echo variable1</span><br><span class="line">//variable1</span><br><span class="line"></span><br><span class="line">bash$ echo $variable1</span><br><span class="line">//23</span><br></pre></td></tr></table></figure><p>åœ¨(â€œ..â€)é‡Œå¼•ç”¨ä¸ä¼šå¹²æ¶‰å˜é‡çš„å¼•ç”¨ï¼Œè¿™å«åšå±€éƒ¨å¼•ç”¨(<code>partial quoting</code>),ä¹Ÿå«å¼±å¼•ç”¨.ä½†ä½¿ç”¨(â€˜..â€™)å•å¼•å·ä¼šç›´æ¥æŠŠå˜é‡åæ‰“å°å‡ºæ¥ï¼Œä¸ä¼šå¼•ç”¨å˜é‡ï¼Œå«åšå…¨å¼•ç”¨(<code>full quoting</code>),ä¹Ÿå«åšå¼ºå¼•ç”¨ã€‚</p><blockquote><p>æ³¨æ„ï¼šå…¶å®ä½¿ç”¨$variable1å’Œä½¿ç”¨${variable1}æ˜¯ä¸€æ ·çš„ä½†æ˜¯æŸäº›è¯­å¢ƒä¸‹å‰è€…å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚</p></blockquote><blockquote><p>æœªåˆå§‹åŒ–çš„å˜é‡æœ‰ä¸€ä¸ªé»˜è®¤çš„çš„å€¼ä¸ºâ€nullâ€œè€Œä¸æ˜¯â€˜0â€™ï¼Œå¹¶ä¸”bashä¸­çš„å˜é‡ä¸åˆ†ç±»å‹ã€‚</p></blockquote><h2 id="å˜é‡åˆ†é…-Variable-Assignment"><a href="#å˜é‡åˆ†é…-Variable-Assignment" class="headerlink" title="å˜é‡åˆ†é…(Variable Assignment) ="></a>å˜é‡åˆ†é…(Variable Assignment) =</h2><p>ç­‰å·-&gt; the assignment operator (no space before and after) å‰åä¸èƒ½æœ‰ç©ºæ ¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ä¸¾ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„å°ä¾‹å­ï¼Œä¹‹å‰ä¸çŸ¥é“åŒºåˆ«ã€‚ã€‚</span><br><span class="line">a=`ls -l`         # Assigns result of &apos;ls -l&apos; command to &apos;a&apos;</span><br><span class="line">echo $a           # Unquoted, however, it removes tabs and newlines.</span><br><span class="line">echo</span><br><span class="line">echo &quot;$a&quot;         # The quoted variable preserves whitespace.</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åŒå¼•å·æ‰©èµ·æ¥çš„$aæœ‰ç©ºæ ¼ï¼Œè€Œæ²¡æœ‰åŒå¼•å·çš„æ˜¯å»æ‰ç©ºæ ¼çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">R=$(cat /etc/redhat-release)</span><br><span class="line">arch=$(uname -m)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºä½¿ç”¨$()çš„ä½œç”¨å’Œä½¿ç”¨``çš„ä½œç”¨ç›¸åŒï¼Œéƒ½å¯ä»¥å¯¹å‘½ä»¤è¿›è¡ŒåŒ…è£¹ã€‚</p><h2 id="bashå˜é‡æ²¡æœ‰ç±»å‹"><a href="#bashå˜é‡æ²¡æœ‰ç±»å‹" class="headerlink" title="bashå˜é‡æ²¡æœ‰ç±»å‹"></a>bashå˜é‡æ²¡æœ‰ç±»å‹</h2><p>ä¸åƒå…¶ä»–çš„å¾ˆå¤šç¼–ç¨‹è¯­è¨€ï¼Œbashè„šæœ¬ä¸­çš„å˜é‡æ˜¯æ²¡æœ‰ç±»å‹çš„ã€‚æ— ç±»å‹çš„å˜é‡æ˜¯æŠŠåŒåˆƒå‰‘ï¼Œä¸€æ–¹é¢æ›´åŠ çµæ´»ï¼Œå¦ä¸€æ–¹é¢ä¼šæ¸—é€ä¸€äº›å°çš„é—®é¢˜ã€‚</p><p>æ‰€ä»¥bashæä¾›å£°æ˜å˜é‡ï¼Œä¼šåœ¨åé¢çš„ç« èŠ‚å¯¹å£°æ˜å˜é‡çš„å‚æ•°ç­‰ä¿¡æ¯è¯¦ç»†åˆ—å‡ºæ¥ã€‚</p><h2 id="ç‰¹æ®Šçš„å˜é‡ç±»å‹-Special-Variable-Types"><a href="#ç‰¹æ®Šçš„å˜é‡ç±»å‹-Special-Variable-Types" class="headerlink" title="ç‰¹æ®Šçš„å˜é‡ç±»å‹(Special Variable Types)"></a>ç‰¹æ®Šçš„å˜é‡ç±»å‹(Special Variable Types)</h2><ul><li><p>æœ¬åœ°å˜é‡ï¼šå˜é‡åªèƒ½åœ¨ä»£ç å—å’Œå‡½æ•°ä¸­å¯è§</p></li><li><p>ç³»ç»Ÿå˜é‡ï¼šå˜é‡å½±å“shellçš„è¡Œä¸ºå’Œç”¨æˆ·çš„æ¥å£ï¼ˆæ¯”å¦‚è®¾ç½®Javaç¯å¢ƒå˜é‡ï¼‰</p><p>  å¦‚æœè„šæœ¬éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡é‚£ä¹ˆå°±å» <code>export ..</code></p></li><li><p>ä½ç½®å‚æ•°ï¼š</p><p>  $0æ˜¯è„šæœ¬åç§°ï¼Œ1-9ç­‰å¯¹åº”å…¶ä½ç½®ï¼Œ10ä¹‹åè¦ä½¿ç”¨å¤§æ‹¬å·æ‰©èµ·æ¥ã€‚$#å¯¹åº”æœ€åä¸€ä¸ªå…ƒç´ </p><p>  ä½¿ç”¨shiftå‘½ä»¤å¯ä»¥å°†ä½ç½®å‚æ•°é‡æ–°æ’åˆ—ï¼Œå®é™…ä¸Šå°±æ˜¯å‘å·¦ç§»åŠ¨ä¸€çº§ã€‚</p></li></ul><h3 id="è¿™æ¬¡ç¯‡å¹…è¾ƒå°ï¼Œä¸»è¦è®²äº†è®²bashä¸­çš„å˜é‡å’Œä½ç½®å‚æ•°çš„å«ä¹‰å’Œä½¿ç”¨ï¼Œå±äºéå¸¸åŸºç¡€ï¼Œéå¸¸å®¹æ˜“ç†è§£çš„éƒ¨åˆ†ã€‚"><a href="#è¿™æ¬¡ç¯‡å¹…è¾ƒå°ï¼Œä¸»è¦è®²äº†è®²bashä¸­çš„å˜é‡å’Œä½ç½®å‚æ•°çš„å«ä¹‰å’Œä½¿ç”¨ï¼Œå±äºéå¸¸åŸºç¡€ï¼Œéå¸¸å®¹æ˜“ç†è§£çš„éƒ¨åˆ†ã€‚" class="headerlink" title="è¿™æ¬¡ç¯‡å¹…è¾ƒå°ï¼Œä¸»è¦è®²äº†è®²bashä¸­çš„å˜é‡å’Œä½ç½®å‚æ•°çš„å«ä¹‰å’Œä½¿ç”¨ï¼Œå±äºéå¸¸åŸºç¡€ï¼Œéå¸¸å®¹æ˜“ç†è§£çš„éƒ¨åˆ†ã€‚"></a>è¿™æ¬¡ç¯‡å¹…è¾ƒå°ï¼Œä¸»è¦è®²äº†è®²bashä¸­çš„å˜é‡å’Œä½ç½®å‚æ•°çš„å«ä¹‰å’Œä½¿ç”¨ï¼Œå±äºéå¸¸åŸºç¡€ï¼Œéå¸¸å®¹æ˜“ç†è§£çš„éƒ¨åˆ†ã€‚</h3>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bashå­¦ä¹ è®°å½•ï¼ˆä¸€ï¼‰ åˆè¯†å’Œbashä¸­çš„ç‰¹æ®Šå­—ç¬¦</title>
      <link href="/2018/04/10/2018-04-10-bash%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
      <url>/2018/04/10/2018-04-10-bash%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="bashå­¦ä¹ è®°å½•ï¼ˆä¸€ï¼‰åˆè¯†bashå’Œç‰¹æ®Šå­—ç¬¦"><a href="#bashå­¦ä¹ è®°å½•ï¼ˆä¸€ï¼‰åˆè¯†bashå’Œç‰¹æ®Šå­—ç¬¦" class="headerlink" title="bashå­¦ä¹ è®°å½•ï¼ˆä¸€ï¼‰åˆè¯†bashå’Œç‰¹æ®Šå­—ç¬¦"></a>bashå­¦ä¹ è®°å½•ï¼ˆä¸€ï¼‰åˆè¯†bashå’Œç‰¹æ®Šå­—ç¬¦</h1><h2 id="åˆè¯†Bash"><a href="#åˆè¯†Bash" class="headerlink" title="åˆè¯†Bash"></a>åˆè¯†Bash</h2><p>é‰´äºæœ¬äººçš„è¡¨è¾¾èƒ½åŠ›ï¼Œä¸é€‚åˆæƒ³è¦å»ç³»ç»Ÿå­¦ä¹ bashçš„äººæ¥æŸ¥çœ‹ï¼Œæå‰åˆ†äº«ä¸¤ä¸ªä¸åŒé˜¶æ®µï¼Œä¸åŒäººç¾¤å­¦ä¹ çš„èµ„æ–™ã€‚</p><ol><li><p>æƒ³è¦å­¦ä¹ bashä½†æ˜¯ä¸æƒ³å­¦ä¹ å¤ªæ·±çš„äºº:       <a href="https://github.com/denysdovhan/bash-handbook/blob/master/translations/zh-CN/README.md#%E5%89%8D%E8%A8%80" target="_blank" rel="noopener">bash-handbook</a></p></li><li><p>æƒ³è¦ç³»ç»Ÿå­¦ä¹ bashçš„äººï¼š<a href="http://tldp.org/LDP/abs/html/index.html" target="_blank" rel="noopener">Advanced Bash-Scripting Guide</a></p></li></ol><p>å…¶å®bashå¾ˆéš¾ï¼Œè¦è€ƒè™‘çš„ä¸œè¥¿å¾ˆå¤šï¼Œä½†ç°åœ¨å­¦åˆ°çš„åªæ˜¯çš®æ¯›ï¼Œå¸Œæœ›èƒ½å¤Ÿå¤šçœ‹å¤šå®è·µï¼Œæ‰èƒ½æ›´è¿›ä¸€æ­¥ã€‚</p><h3 id="Starting-Off-With-a-Sha-Bang"><a href="#Starting-Off-With-a-Sha-Bang" class="headerlink" title="Starting Off With a Sha-Bang"></a>Starting Off With a Sha-Bang</h3><p>sha-bang(#!)åœ¨èµ·å§‹çš„ä½ç½®æ¥å‘Šè¯‰ä½ çš„ç³»ç»Ÿè¿™ä¸ªæ–‡ä»¶æ˜¯å‘½ä»¤çš„é›†åˆï¼Œèƒ½å¤Ÿä½¿ç”¨å“ªä¸ªå‘½ä»¤è§£é‡Šå™¨æ¥æ‰§è¡Œï¼ˆ/bin/bashï¼‰-&gt;path,è¿™ä¸ªå‘½ä»¤è·¯å¾„å¿…é¡»æ­£ç¡®</p><p>å¦‚æœç³»ç»Ÿé»˜è®¤è§£é‡Šå™¨æ˜¯/bin/bash æˆ–è€…å…¶ä»– åˆ™ä¸ç”¨ä½¿ç”¨ #! /bin/bash æ¥æ”¾åˆ°å¼€å¤´</p><h2 id="Special-Characters"><a href="#Special-Characters" class="headerlink" title="Special Characters"></a>Special Characters</h2><p>ä¸‹é¢æ¥ç®€å•æ€»ç»“ä¸€ä¸‹æœ‰ç‰¹æ®Šæ„ä¹‰çš„å­—ç¬¦</p><ol><li><p><strong>â€˜#â€˜</strong>  è·Ÿåœ¨#å·åé¢çš„ç›¸å½“ä¸æ˜¯æ³¨é‡Šï¼Œä¸ä¼šè¢«è§£é‡Šå™¨æ‰§è¡Œ,å¯ä»¥å‡ºç°å•è¡Œï¼Œä¹Ÿå¯ä»¥å‡ºç°åœ¨å‘½ä»¤åä½œæ³¨é‡Šç”¨</p></li><li><p><strong>; åˆ†å·</strong> å…è®¸å°†å¤šæ¡å‘½ä»¤æ”¾åˆ°å•è¡Œç”¨</p></li><li><p><strong>;;  ä¸¤ä¸ªåˆ†å·</strong>ï¼Œåœ¨<code>case</code>çš„åœºæ™¯ä¸‹ä½¿ç”¨ å¦‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$variable</span>"</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">abc)  <span class="built_in">echo</span> <span class="string">"\$variable = abc"</span> ;;</span><br><span class="line"></span><br><span class="line">xyz)  <span class="built_in">echo</span> <span class="string">"\$variable = xyz"</span> ;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure></li><li><p><strong>. dot</strong></p><p>  ç›¸å½“ä¸linuxçš„å†…å»ºå‘½ä»¤source</p><p>  ä½œä¸ºæ–‡ä»¶åçš„ä¸€éƒ¨åˆ† å¦‚ .vimrcç­‰</p><p>  ä½œä¸ºç›®å½•å¯¼å‘ å¦‚ ./è¡¨ç¤ºå½“å‰ç›®å½• ../ç›¸å½“ä¸çˆ¶ç›®å½•</p><p>  æ­£åˆ™è¡¨è¾¾å¼ä¸­å¯ä»¥è¡¨ç¤ºä¸º1ä¸ªå­—ç¬¦</p></li><li><p><strong>â€œ åŒå¼•å·</strong> éƒ¨åˆ†å¼•ç”¨å­—ç¬¦ä¸²ï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯èƒ½å¤Ÿå¼•ç”¨å˜é‡ â€˜$valueâ€™ï¼Œå¹¶ä¸”ç‰¹æ®Šå­—ç¬¦éœ€è¦è½¬ä¹‰</p></li><li><p><strong>â€˜ å•å¼•å·</strong> å¯ä»¥ä¿å­˜å…¨éƒ¨ç‰¹æ®Šå­—ç¬¦ï¼Œä¸èƒ½å¼•ç”¨å˜é‡</p></li><li><p><strong>, é€—å·</strong> è¡¨ç¤ºè¿æ¥å¤šä¸ªè®¡ç®—è¡¨è¾¾å¼,å¤šä¸ªè¡¨è¾¾å¼éƒ½ä¼šæ‰§è¡Œï¼Œä½†æ˜¯åªæœ‰æœ€åä¸€ä¸ªè®¡ç®—å¼ä¼šè¿”å›å€¼ ã€‚ä¹Ÿåšé“¾æ¥å­—ç¬¦ä¸²</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> <span class="string">"t2 = ((a = 9, 15 / 3))"</span></span><br><span class="line"><span class="comment"># Set "a = 9" and "t2 = 15 / 3"</span></span><br></pre></td></tr></table></figure></li><li><p><strong>\ åæ–œæ </strong> <code>escape [backslash]</code> å¯æ˜¯å®ç°å¯¹å•ä¸ªå­—ç¬¦çš„è½¬ä¹‰</p></li><li><p><strong>/ æ–œæ </strong> <code>Filename path separator [forward slash]</code>æœ¬èº«å°±å«åšæ–‡ä»¶åˆ†å‰²ç¬¦å¯ä»¥æ˜äº†åšä»€ä¹ˆç”¨çš„äº†</p></li><li><p><strong>` <code>command substitution</code></strong> å‘½ä»¤æ›¿æ¢ å¦‚ a=`echo â€œhello worldâ€ `;echo $a ç­‰ æˆ–è€… a=`date` ; echo $a</p></li><li><p><strong>: å†’å·</strong> ç©ºå‘½ä»¤ç­‰ä»·ä¸â€˜NOPâ€™ <code>do-nothing operation</code> ä¹Ÿæ˜¯æœ‰çŠ¶æ€çš„ç›¸å½“ä¸å†…å»ºå‡½æ•° <code>true</code> æ¯”å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">operation-1</span><br><span class="line">operation-2</span><br><span class="line">...</span><br><span class="line">operation-n</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Same as:</span></span><br><span class="line"><span class="comment">#    while true</span></span><br><span class="line"><span class="comment">#    do</span></span><br><span class="line"><span class="comment">#      ...</span></span><br><span class="line"><span class="comment">#    done</span></span><br></pre></td></tr></table></figure><p>ä½œifåˆ¤æ–­çš„åˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> condition</span><br><span class="line"><span class="keyword">then</span> :   <span class="comment"># Do nothing and branch ahead</span></span><br><span class="line"><span class="keyword">else</span>     <span class="comment"># Or else ...</span></span><br><span class="line">take-some-action</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>æ”¾åœ¨å¿…é¡»è¦æœ‰ä¸¤å…ƒæ“ä½œçš„åœ°æ–¹ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå¦‚ï¼š: ${username=`whoami`}</p><p>é…åˆç®¡é“å‘½ä»¤ <code>:&gt;</code> <code>:&gt;&gt;</code>å¦‚æœæ–‡ä»¶æ²¡æœ‰å­˜åœ¨åˆ™åˆ›å»º</p><p>åšåˆ†å‰²ç¬¦ å¦‚ echo $PATH ä¼šå‡ºç°å¾ˆå¤šä»¥ï¼šä½œä¸ºåˆ†å‰²ç¬¦çš„å­—ç¬¦ä¸²</p><p>åœ¨å‡½æ•°é‡Œå¯ä»¥ä½œä¸ºç«™ä½ç¬¦é˜²æ­¢å‡½æ•°æä¸ºç©º</p></li><li><p><strong>!å¹å·</strong>  ä½œä¸º <code>é</code>å‡ºç° å¦‚ ï¼null æˆ–è€…é€€å‡ºç  exit codeã€‚åœ¨ä¸åŒçš„è¯­å¢ƒä¸‹å¯ä»¥ä½œä¸ºé—´æ¥å˜é‡å¼•ç”¨ã€‚</p></li><li><p><strong>* æ˜Ÿå·</strong> å¯ä»¥ä½œä¸ºå…¨åŒ¹é…æ¥ä½¿ç”¨ å¦‚ echo * ã€‚ è¡¨ç¤ºä¹˜æ³• 1*2</p></li><li><p><strong>? é—®å·</strong> <code>test operator</code>. Within certain expressions, the ? indicates a test for a condition. è¿˜å¯ä»¥ä½œä¸ºåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚</p></li><li><p><strong>$</strong> å˜é‡å¼•ç”¨  æ­£åˆ™è¡¨è¾¾å¼ä¸­è¡¨ç¤ºè¡Œå°¾</p></li><li><p><strong>${}</strong> å˜é‡å¼•ç”¨</p></li><li><p><strong>$(â€¦)</strong> å¤šä¸ªå˜é‡åŒæ—¶å¼•ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file1=<span class="string">"file"</span></span><br><span class="line">file2=<span class="string">"nofile"</span></span><br><span class="line"><span class="built_in">echo</span> $<span class="string">'file1,file2'</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºå†…å®¹ï¼šfile1,file2</p></li><li><p><strong><code>$* $@</code></strong>  ä½ç½®å‚æ•° $*æ˜¯å°†æ‰€æœ‰å‚æ•°ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿”å›ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œè€Œ$@æ˜¯å°†æ¯ä¸ªå‚æ•°ä½œä¸ºå•å…ƒè¿”å›ä¸€ä¸ªå‚æ•°åˆ—è¡¨</p></li><li><p><strong>() å°æ‹¬å·</strong></p></li></ol><ul><li>æ“ä½œç»„<code>(a=hello; echo $a)</code></li><li>æ•°ç»„åˆå§‹åŒ–</li></ul><ol start="20"><li><p><strong>{} èŠ±æ‹¬å·æ‰©å±•</strong> ç”¨æ¥æ‰©å±•å‚æ•° å¦‚ abou{t,y,u}</p></li><li><p><strong>[] ä¸­æ‹¬å·</strong></p></li></ol><ul><li>shellå†…å»ºæµ‹è¯•çš„ä¸€éƒ¨åˆ†</li><li>è¡¨è¾¾æ•°ç»„çš„éƒ¨åˆ†å¦‚array[1]</li><li>è¡¨ç¤ºå­—ç¬¦é›†çš„èŒƒå›´ï¼Œåœ¨æ­£è¡¨è¾¾å¼ä¸­ï¼Œæ–¹æ‹¬å·è¡¨ç¤ºè¯¥ä½ç½®å¯ä»¥åŒ¹é…çš„å­—ç¬¦é›†èŒƒå›´ã€‚</li></ul><ol start="22"><li><p><strong>[[]] åŒä¸­æ‹¬å·</strong>(double brackets)ã€‚</p><blockquote><p>è¿™ä¸ªç»“æ„ä¹Ÿæ˜¯æµ‹è¯•ï¼Œæµ‹è¯•[[]]ä¹‹ä¸­çš„è¡¨è¾¾å¼(Shellçš„å…³é”®å­—)ã€‚è¿™ä¸ªæ¯”å•ä¸­æ‹¬å·æ›´èƒ½é˜²æ­¢è„šæœ¬é‡Œé¢çš„é€»è¾‘é”™è¯¯</p></blockquote></li><li><p>$[ â€¦ ] and (()) éƒ½è¡¨ç¤ºIntegerè®¡ç®— integer expansion.</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=3</span><br><span class="line">b=7</span><br><span class="line">echo $[$a+$b]</span><br><span class="line">echo (($a+$b))</span><br></pre></td></tr></table></figure><ol start="24"><li><p><strong>| ç®¡é“</strong> éå¸¸åŸºç¡€çš„æ¦‚å¿µ å¦‚ ls|grep .. ã€‚</p></li><li><p>&amp;ï¼šåå°æ‰§è¡Œ  &amp;&amp; å’Œ || ï¼šé€»è¾‘æ“ä½œç¬¦</p></li><li><p>+ - * % å„è‡ªæ„ä¹‰å°±ä¸è¯¦ç»†è§£é‡Šäº†</p></li></ol><p>èµ„æ–™å¼•ç”¨ <a href="http://tldp.org/LDP/abs/html/index.html" target="_blank" rel="noopener">Advanced Bash-Scripting Guide</a> æ–‡ç« ç‰¹åˆ«è¯¦å°½ï¼Œæœ‰å…´è¶£éå¸¸é¼“åŠ±çœ‹åŸæ–‡ã€‚è¿™é‡Œæˆ‘åªåšäº†éƒ¨åˆ†æ¯”è¾ƒå¸¸ç”¨çš„æ¯”è¾ƒå®¹æ˜“ç†è§£çš„éƒ¨åˆ†åšäº†ç²¾ç®€ï¼ˆåŸè°…æˆ‘è‹±æ–‡ä¸å¥½ :) ç ´äº§ç‰ˆæ€»ç»“ - - ï¼‰ã€‚</p><p>ä½œä¸ºbashå­¦ä¹ æ€»ç»“çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œç¯‡å¹…ä¸å¤§ï¼Œå°½é‡åšåˆ°ç®€å•ï¼Œè¯¦å°½æ˜“æ‡‚ã€‚å½“é‡åˆ°é—®é¢˜èƒ½å¤Ÿå›å¤´çœ‹ä¸€çœ‹ï¼Œå¸Œæœ›èƒ½å¤Ÿèµ·åˆ°å¥½çš„ä½œç”¨ï¼ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Bash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MarkDownåŸºæœ¬è¯­æ³•</title>
      <link href="/2018/04/04/2018-04-08-markdown%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/"/>
      <url>/2018/04/04/2018-04-08-markdown%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Markdownè¯­æ³•æ€»ç»“"><a href="#Markdownè¯­æ³•æ€»ç»“" class="headerlink" title="Markdownè¯­æ³•æ€»ç»“"></a>Markdownè¯­æ³•æ€»ç»“</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>å…¶å®markdownè¯­æ³•å¾ˆç®€æ´ï¼Œå¹¶ä¸”ç›¸å½“å¤šçš„åšå®¢ï¼Œè¿˜æœ‰é‡è¦çš„githubä¸Šçš„readmeä¹Ÿæ˜¯ç”¨markdownè¿›è¡Œç¼–è¾‘ã€‚æ‰€ä»¥æœ‰å¿…è¦æ•´ç†ä¸€ä¸‹ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œè¿›å…¥æ­£æ–‡</p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>ä¸€ä¸ª Markdown æ®µè½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„æ–‡æœ¬è¡Œç»„æˆï¼Œå®ƒçš„å‰åè¦æœ‰ä¸€ä¸ªä»¥ä¸Šçš„ç©ºè¡Œï¼ˆç©ºè¡Œçš„å®šä¹‰æ˜¯æ˜¾ç¤ºä¸Šçœ‹èµ·æ¥åƒæ˜¯ç©ºçš„ï¼Œä¾¿ä¼šè¢«è§†ä¸ºç©ºè¡Œã€‚æ¯”æ–¹è¯´ï¼Œè‹¥æŸä¸€è¡ŒåªåŒ…å«ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ï¼Œåˆ™è¯¥è¡Œä¹Ÿä¼šè¢«è§†ä¸ºç©ºè¡Œï¼‰ã€‚æ™®é€šæ®µè½ä¸è¯¥ç”¨ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦æ¥ç¼©è¿›ã€‚</p><p>åœ¨ç¼–è¾‘çš„è¿‡ç¨‹å½“ä¸­æ¯ç¼–è¾‘ä¸€å—çš„å†…å®¹ï¼Œå°±è¦ç©ºä¸€è¡Œï¼Œå¦åˆ™ä¼šå‡ºé—®é¢˜ã€‚ã€‚ã€‚</p><h3 id="æ ‡é¢˜"><a href="#æ ‡é¢˜" class="headerlink" title="æ ‡é¢˜"></a><strong>æ ‡é¢˜</strong></h3><p>markdownæ”¯æŒä¸¤ç§æ ‡é¢˜çš„è¯­æ³•ï¼Œç±» Setext å’Œç±» atx å½¢å¼ã€‚<br>ç±» Setext å½¢å¼æ˜¯ç”¨åº•çº¿çš„å½¢å¼ï¼Œåˆ©ç”¨ = ï¼ˆæœ€é«˜é˜¶æ ‡é¢˜ï¼‰å’Œ - ï¼ˆç¬¬äºŒé˜¶æ ‡é¢˜ï¼‰ï¼Œä¾‹å¦‚ï¼š</p><blockquote><p>This is an H1</p><p>=============</p><p>This is an H2</p><p>-â€”â€”â€”â€”</p></blockquote><p>æ•ˆæœ</p><blockquote><h1 id="This-is-an-H1"><a href="#This-is-an-H1" class="headerlink" title="This is an H1"></a>This is an H1</h1><h2 id="This-is-an-H2"><a href="#This-is-an-H2" class="headerlink" title="This is an H2"></a>This is an H2</h2></blockquote><p>ä¹Ÿèƒ½ä½¿ç”¨atx ä½¿ç”¨ # æ¥è¿›è¡Œ1-6é˜¶çš„åˆ’åˆ† å¦‚ï¼š</p><blockquote><p># This is an H1</p><p>## This is an H2</p></blockquote><p>æ•ˆæœ</p><blockquote><h1 id="This-is-an-H1-1"><a href="#This-is-an-H1-1" class="headerlink" title="This is an H1"></a>This is an H1</h1><h2 id="This-is-an-H2-1"><a href="#This-is-an-H2-1" class="headerlink" title="This is an H2"></a>This is an H2</h2></blockquote><h3 id="åŒºå—å¼•ç”¨"><a href="#åŒºå—å¼•ç”¨" class="headerlink" title="åŒºå—å¼•ç”¨"></a><strong>åŒºå—å¼•ç”¨</strong></h3><blockquote><p>åŒºå—åº”ç”¨ ä½¿ç”¨ &gt; ç¬¦å·è¿›è¡Œæ ‡è¯† ã€‚<br>èƒ½æ¯è¡Œéƒ½ä½¿ç”¨ &gt; è¿›è¡Œæ ‡è¯†ï¼Œä¹Ÿèƒ½åªåœ¨ç¬¬ä¸€è¡Œæ ‡è¯†æ•ˆæœç›¸åŒ</p></blockquote><h3 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a><strong>åˆ—è¡¨</strong></h3><ol><li>æ— åºåˆ—è¡¨ å¯ä»¥ä½¿ç”¨*å·æˆ–è€…+å·æˆ–è€…-å·éƒ½æ˜¯ä¸€æ ·çš„</li><li>æœ‰åºåˆ—è¡¨ å¯ä»¥ä½¿ç”¨æ•°å­—åŠ è‹±æ–‡.åŠ ç©ºæ ¼ä½¿ç”¨æœ‰åºåˆ—è¡¨</li></ol><h3 id="åˆ†å‰²çº¿"><a href="#åˆ†å‰²çº¿" class="headerlink" title="åˆ†å‰²çº¿"></a>åˆ†å‰²çº¿</h3><p>ä¸‰ä¸ªä»¥ä¸Šçš„* å°±æ˜¯åˆ†å‰²çº¿</p><hr><h3 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h3><p>Markdown æ”¯æŒä¸¤ç§å½¢å¼çš„é“¾æ¥è¯­æ³•ï¼š è¡Œå†…å¼å’Œå‚è€ƒå¼ä¸¤ç§å½¢å¼ã€‚</p><p>ä¸ç®¡æ˜¯å“ªä¸€ç§ï¼Œé“¾æ¥æ–‡å­—éƒ½æ˜¯ç”¨ [æ–¹æ‹¬å·] æ¥æ ‡è®°ã€‚</p><p>è¦å»ºç«‹ä¸€ä¸ªè¡Œå†…å¼çš„é“¾æ¥ï¼Œåªè¦åœ¨æ–¹å—æ‹¬å·åé¢ç´§æ¥ç€åœ†æ‹¬å·å¹¶æ’å…¥ç½‘å€é“¾æ¥å³å¯ï¼Œå¦‚æœä½ è¿˜æƒ³è¦åŠ ä¸Šé“¾æ¥çš„ title æ–‡å­—ï¼Œåªè¦åœ¨ç½‘å€åé¢ï¼Œç”¨åŒå¼•å·æŠŠ title æ–‡å­—åŒ…èµ·æ¥å³å¯ï¼Œä¾‹å¦‚ï¼š</p><blockquote><p>This is [an example](<a href="http://example.com/" target="_blank" rel="noopener">http://example.com/</a> â€œTitleâ€) inline link.</p></blockquote><blockquote><p>[This link](<a href="http://example.net/" target="_blank" rel="noopener">http://example.net/</a>) has no title attribute.</p></blockquote><p> æ•ˆæœ</p><p> This is <a href="http://example.com/" title="Title" target="_blank" rel="noopener">an example</a> inline link.</p><p><a href="http://example.net/" target="_blank" rel="noopener">This link</a> has no title attribute.</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå‚è€ƒå¼é“¾æ¥çš„èŒƒä¾‹ï¼š</p><p>I get 10 times more traffic from [Google] [1] than from<br>[Yahoo] [2] or [MSN] [3].</p><p>[1]: <a href="http://google.com/" target="_blank" rel="noopener">http://google.com/</a>        â€œGoogleâ€</p><p>[2]: <a href="http://search.yahoo.com/" target="_blank" rel="noopener">http://search.yahoo.com/</a>  â€œYahoo Searchâ€</p><p>[3]: <a href="http://search.msn.com/" target="_blank" rel="noopener">http://search.msn.com/</a>    â€œMSN Searchâ€</p><p>I get 10 times more traffic from <a href="http://google.com/" title="Google" target="_blank" rel="noopener">Google</a> than from<br><a href="http://search.yahoo.com/" title="Yahoo Search" target="_blank" rel="noopener">Yahoo</a> or <a href="http://search.msn.com/" title="MSN Search" target="_blank" rel="noopener">MSN</a>.</p><h3 id="å¼ºè°ƒ"><a href="#å¼ºè°ƒ" class="headerlink" title="å¼ºè°ƒ"></a><strong>å¼ºè°ƒ</strong></h3><p>ä½¿ç”¨ä¸¤ä¸ª*<em>æˆ–è€…_è¡¨ç¤ºå¼ºè°ƒ ä½¿ç”¨ä¸€ä¸ª</em>æˆ–è€…ä¸€ä¸ª_è¡¨ç¤ºæ–œä½“</p><p>å¦‚ï¼š <strong>helloworld</strong> <em>helloworld</em></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a><strong>ä»£ç </strong></h3><p>ä½¿ç”¨`ç¬¦å·æ¥ä½¿ç”¨ä»£ç å—<br>è¡Œå†…ä»£ç ä½¿ç”¨`åŒ…èµ·æ¥ å¦‚ <code>print()</code></p><h3 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a><strong>å›¾ç‰‡</strong></h3><p>åŒæ ·çš„å›¾ç‰‡ä¹Ÿæœ‰è¡Œå†…å¼å’Œå‚è€ƒå¼<br>å‘é“¾æ¥ä¸€æ ·åªä¸è¿‡åœ¨å‰é¢å¤šä¸ª !</p><h3 id="å¤§æ¦‚è¯­æ³•å°±æ˜¯è¿™ä¹ˆå¤š-markdownç®€å•æ–¹ä¾¿ï¼Œæ¨èä½¿ç”¨ã€‚ã€‚"><a href="#å¤§æ¦‚è¯­æ³•å°±æ˜¯è¿™ä¹ˆå¤š-markdownç®€å•æ–¹ä¾¿ï¼Œæ¨èä½¿ç”¨ã€‚ã€‚" class="headerlink" title="å¤§æ¦‚è¯­æ³•å°±æ˜¯è¿™ä¹ˆå¤š markdownç®€å•æ–¹ä¾¿ï¼Œæ¨èä½¿ç”¨ã€‚ã€‚"></a>å¤§æ¦‚è¯­æ³•å°±æ˜¯è¿™ä¹ˆå¤š markdownç®€å•æ–¹ä¾¿ï¼Œæ¨èä½¿ç”¨ã€‚ã€‚</h3><p>è‡ªå·±å†™è¿™ç§ä¸œè¥¿è‡ªå·±æ„Ÿè§‰å†™çš„éƒ½å¥½èœï¼Œå¯èƒ½æ²¡æœ‰ä»€ä¹ˆå†™åšå®¢çš„ä¹ æƒ¯ï¼Œæ…¢æ…¢å†™å§ï¼Œæ€»æœ‰ä¸€å¤©ä¼šæ•´ä½“æ¸…æ™°çš„ã€‚ç®—äº†ï¼Œè‡ªå·±çœ‹å§  :)</p>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
            <tag> è¯­æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysqlä¸­å‡ºç°Invalid default value for CREATE_TIME é”™è¯¯</title>
      <link href="/2018/01/01/2019-01-01-Mysql%E4%B8%AD%E5%87%BA%E7%8E%B0Invalid_default_value_for_CREATE_TIME%E7%9A%84%E9%94%99%E8%AF%AF/"/>
      <url>/2018/01/01/2019-01-01-Mysql%E4%B8%AD%E5%87%BA%E7%8E%B0Invalid_default_value_for_CREATE_TIME%E7%9A%84%E9%94%99%E8%AF%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="Mysqlä¸­å‡ºç°Invalid-default-value-for-â€˜CREATE-TIMEâ€™é”™è¯¯"><a href="#Mysqlä¸­å‡ºç°Invalid-default-value-for-â€˜CREATE-TIMEâ€™é”™è¯¯" class="headerlink" title="Mysqlä¸­å‡ºç°Invalid default value for â€˜CREATE_TIMEâ€™é”™è¯¯"></a>Mysqlä¸­å‡ºç°Invalid default value for â€˜CREATE_TIMEâ€™é”™è¯¯</h1><p>æœ€è¿‘åšäº†æ–°çš„ç³»ç»Ÿï¼Œå¹¶æŠŠmysqlå‡çº§åˆ°äº†5.7ç‰ˆæœ¬ï¼Œåœ¨å€’å…¥sqlæ—¶å€™ï¼Œå‡ºç°å¦‚é¢˜çš„é”™è¯¯â€˜Mysqlä¸­å‡ºç°Invalid default value for â€˜CREATE_TIMEâ€™é”™è¯¯â€™,æ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚</p><p>æ˜¯å› ä¸ºåœ¨5.7ç‰ˆæœ¬ä¸­çš„sql_modeæœ‰NO_ZERO_IN_DATE,NO_ZERO_DATEè¿™ä¸¤ä¸ªä¸œè¥¿ï¼Œå»æ‰å°±å¥½äº†ã€‚å¦‚ä½•å»æ‰ï¼Ÿ</p><ol><li>ä¸´æ—¶æ–¹æ³•</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set session</span><br><span class="line"> -&gt; sql_mode=&apos;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&apos;;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><ol start="2"><li>æ°¸ä¹…æ€§ä¿®æ”¹</li></ol><p>ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/mysql/mysql.conf.d</span><br><span class="line">vim mysqld.cnf</span><br><span class="line"># æ‰¾åˆ°ã€mysqldã€‘åœ¨ä¸‹é¢æ’å…¥</span><br><span class="line">sql_mode=&apos;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&apos;</span><br></pre></td></tr></table></figure><p>æˆ‘ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•è§£å†³äº†é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MYSQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MYSQL </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>

<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[lambdaè¡¨è¾¾å¼å­¦ä¹ å’Œåº”ç”¨]]></title>
    <url>%2F2020%2F03%2F24%2FLambda%20expression%2F</url>
    <content type="text"><![CDATA[Lambdaè¡¨è¾¾å¼Lamdba è¡¨è¾¾å¼æ˜¯Java 8 çš„æ–°ç‰¹æ€§ï¼Œä¹Ÿæ˜¯Java 8 ä¸­æœ€é‡è¦çš„çš„æ–°åŠŸèƒ½ã€‚Lamdabaè¡¨è¾¾å¼ä¿ƒè¿›äº†Javaä½¿ç”¨å‡½æ•°æ–¹å¼è¿›è¡Œç¼–ç¨‹ã€‚ åœ¨è¿›è¡Œè¯­æ³•çš„è®²è§£ä¹‹å‰,éœ€è¦äº†è§£å’ŒLambdaæ¯æ¯ç›¸å…³çš„Function Interface,å¯ä»¥è¯´åªæœ‰å‡½æ•°å¼æŽ¥å£çš„å­˜åœ¨,æ‰æœ‰lambdaè¡¨è¾¾å¼çš„å­˜åœ¨,æ¢å¥è¯å¯ä»¥è¯´lambdaè¡¨è¾¾å¼æ˜¯å‡½æ•°å¼æŽ¥å£çš„å®žçŽ°. å‡½æ•°å¼æŽ¥å£Function æŽ¥å£å…·æœ‰å•ä¸ªåŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æœ‰å•ä¸ªæŠ½è±¡æ–¹æ³•.å¦‚ Comparable æŽ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³• compareTo ç”¨æ¥è¿›è¡Œæ¯”è¾ƒã€‚ Java8å®šä¹‰äº†å‡½æ•°æŽ¥å£è¢«ç”¨æ¥æ‹“å±•Lamdbaè¡¨è¾¾å¼ã€‚åœ¨ java.util.Function åŒ…ä¸‹æœ‰éžå¸¸å¤šçš„å‡½æ•°æŽ¥å£ã€‚ å¸¸ç”¨çš„æŽ¥å£åŒ…æ‹¬ï¼› æŽ¥å£ æŠ½è±¡æ–¹æ³• ç”¨æ³• Function&lt;T,R&gt; R apply(T t); æŽ¥å—Tç±»åž‹å‚æ•°,è¿”å›žRç±»åž‹ç»“æžœ Consumer void accept(T t); æŽ¥å—Tç±»åž‹å‚æ•°,ä¸è¿”å›žç»“æžœ Predicate boolean test(T t); æŽ¥å—Tç±»åž‹å‚æ•°,è¿”å›žBooleanç»“æžœ Suppler T get(); æ— å‚æ•°,è¿”å›žTç±»åž‹ç»“æžœ å®šä¹‰å‡½æ•°æŽ¥å£ ä½¿ç”¨ @FunctionalInterface æ³¨è§£,è¯¥æ³¨è§£ä¸æ˜¯å¿…é¡»çš„,ä½†æ˜¯å¦‚æžœæ ‡æ³¨,åˆ™ç¼–è¯‘å™¨ä¼šæ£€æŸ¥è¿™ä¸ªæŽ¥å£ä¸‹æ˜¯å¦åªæœ‰å•ä¸ªæŠ½è±¡æ–¹æ³•,å¦‚æžœä¸æ˜¯ä¼šæŠ¥é”™. æ–°å¢ždefaultæ–¹æ³•,æ˜¯ä¸ºäº†åœ¨çŽ°æœ‰çš„ç±»åº“ä¸­ä¸­æ–°å¢žåŠŸèƒ½è€Œä¸å½±å“ä»–ä»¬çš„å®žçŽ°ç±» æ–°å¢žæŽ¥å£å†…staticæ–¹æ³•,å¯å®šä¹‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªé™æ€æ–¹æ³•,å’Œæ™®é€šçš„é™æ€æ–¹æ³•æ²¡æœ‰åŒºåˆ«,éƒ½æ˜¯æŽ¥å£å.æ–¹æ³•åè¿›è¡Œè°ƒç”¨ åœ¨å‡½æ•°å¼æŽ¥å£çš„å®šä¹‰ä¸­æ˜¯åªå…è®¸æœ‰ä¸”åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•(å¿…é¡»)ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªstaticæ–¹æ³•å’Œdefaultæ–¹æ³•ã€‚ Lambdaè¯­æ³•ä¸€ä¸ªLambdaè¡¨è¾¾å¼æœ‰å¦‚ä¸‹ï¼š 1paramter -&gt; expression body ä»¥ä¸‹æ˜¯lambdaè¡¨è¾¾å¼çš„å‡ ä¸ªç‰¹æ€§ å¯é€‰çš„ç±»åž‹æè¿° - ä¸éœ€è¦å£°æ˜Žå‚æ•°çš„ç±»åž‹ï¼Œç¼–è¯‘å™¨å¯æ ¹æ®å‚æ•°çš„å€¼è¿›è¡ŒæŽ¨æ–­ å¯é€‰çš„å‚æ•°ä¸¤æ—çš„æ‹¬å· - å£°æ˜Žå•ä¸ªå‚æ•°çš„æ—¶å€™ä¸éœ€è¦ä½¿ç”¨æ‹¬å·ï¼Œä½†æ˜¯å¦‚ä½•å£°æ˜Žå¤šä¸ªå‚æ•°ï¼Œæ‹¬å·è¿˜æ˜¯å¿…é¡»çš„ã€‚ å¯é€‰çš„å¤§æ‹¬å· - å¦‚æžœå‡½æ•°ä½“ä¸­åªæœ‰å•è¡Œï¼Œåˆ™ä¸éœ€è¦åœ¨å‡½æ•°ä½“ä¸¤ä¾§æ·»åŠ å¤§æ‹¬å· å¯é€‰çš„è¿”å›žå€¼ - å¦‚æžœå‡½æ•°ä¸­åªæœ‰å•è¡Œï¼Œç¼–è¯‘å™¨è‡ªåŠ¨è¿”å›žè¿™ä¸ªå•è¡Œçš„è¿”å›žå€¼ ä¸‹é¢æ ¹æ®å®žä¾‹æ¥çœ‹ä¸Šé¢çš„å››ä¸ªç‰¹æ€§ï¼š 12345678910111213141516171819202122public class Java8Tester &#123; public static void main(String args[]) &#123; GreetingService greetService1 = message -&gt; System.out.println("Say:"+message); greetService1.sayMessage("Hello!!"); MathOperation add = (int a,int b) -&gt; a+b; MathOperation sub= (a,b) -&gt; a-b; MathOperation muti = (a,b) -&gt; &#123;return a*b;&#125;; System.out.println("add å‡½æ•°ç»“æžœï¼š"+add.operation(2,2)); &#125; interface GreetingService &#123; void sayMessage(String message); &#125; interface MathOperation&#123; int operation(int a,int b); &#125;&#125;// ç»“æžœï¼šSay:Hello!!add å‡½æ•°ç»“æžœï¼š4 é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹é‡è¦çš„ä¸¤ç‚¹ï¼š Lambda è¡¨è¾¾å¼ä¸»è¦ç”¨æ¥å®šä¹‰åŠŸèƒ½æŽ¥å£çš„å†…è”å®žçŽ°ï¼Œå¦‚ï¼šä¸€ä¸ªæŽ¥å£é‡Œåªæœ‰ä¸€ä¸ªæŽ¥å£æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œé¢æˆ‘ä»¬ä½¿ç”¨äº†å¯¹MathOperationæŽ¥å£è¿›è¡Œäº†å¤šç§å®žçŽ°ã€‚ Lambda è¡¨è¾¾å¼æ¶ˆé™¤äº†å¯¹åŒ¿åç±»çš„éœ€æ±‚ï¼Œå¦‚new Thread(new Runnable{..}) ,ä¸ºJavaæä¾›äº†éžå¸¸ç®€å•è€Œå¼ºå¤§çš„å‡½æ•°ç¼–ç¨‹èƒ½åŠ›ã€‚ ä½¿ç”¨æ–¹æ³•å¼•ç”¨æ–¹æ³•å¼•ç”¨ï¼ˆMethod Refrencesï¼‰å¸®åŠ©é€šè¿‡æ–¹æ³•åç§°æŒ‡å‘æ–¹æ³•ã€‚æ–¹æ³•å¼•ç”¨ä½¿ç”¨ç¬¦å·â€œ::â€è¡¨ç¤ºã€‚æ–¹æ³•å¼•ç”¨å¯ä»¥ç”¨çˆ±æŒ‡å‘å¦‚ä¸‹ç±»åž‹çš„æ–¹æ³•ï¼š é™æ€æ–¹æ³• å®žä¾‹æ–¹æ³• æž„é€ æ–¹æ³•ä½¿ç”¨newå…³é”®å­—ï¼ˆTreeSet::newï¼‰ [æ–¹æ³•å¼•ç”¨]çš„æ ¼å¼æ˜¯ ç±»å::æ–¹æ³•å 1Arrays.stream(objectArray).forEach(System.out::println); ä½¿ç”¨Lambda ç†Ÿèƒ½ç”Ÿå·§,å¸¸å¸¸ç»ƒä¹ è‚¯å®šèƒ½è®°ä½ 1. åˆ›å»ºThread1234567891011// ä¸ä½¿ç”¨Lambdaåˆ›å»ºThread// å¯ä»¥çœ‹å‡ºå†…éƒ¨ç›´æŽ¥åˆ›å»ºäº†Runnableçš„åŒ¿åç±»new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println("æ–°å»ºçº¿ç¨‹ã€‚ã€‚"); &#125;&#125;).start();// ä½¿ç”¨lambdaåˆ›å»ºThreadnew Thread(() -&gt; System.out.println("ä½¿ç”¨Lambdaæ–°å»ºçº¿ç¨‹ã€‚ã€‚")).start(); 2. åˆ—è¡¨è¿­ä»£12345678910List&lt;Integer&gt; list = Arrays.asList(1, 2, 3);// ä¸ä½¿ç”¨Lambdafor (Integer integer : list) &#123; System.out.println(integer);&#125;//ä½¿ç”¨Lambdalist.forEach((s) -&gt; System.out.println(s));//æ–¹æ³•å¼•ç”¨list.forEach(System.out::println); 3. Map&amp;Reduce ä½¿ç”¨Mapå¤„ç†åˆ—è¡¨å†…æ‰€æœ‰å…ƒç´ å…¨éƒ¨åŠ 2 1234567// ä¸ä½¿ç”¨Lambdafor (Integer integer : list) &#123; int order = integer + 2; System.out.println(order);&#125;// ä½¿ç”¨Lambdalist.stream().map((a) -&gt; a + 2).forEach(System.out::println); ä½¿ç”¨ Map + collect å®Œæˆå¯¹æ¯ä¸ªå…ƒç´ è®¡ç®—åŽè¿”å›žæ–°çš„ç»“æžœåˆ—è¡¨ 1234567891011121314List&lt;Integer&gt; newList = new ArrayList&lt;&gt;();// ä¸ä½¿ç”¨Lambdafor (Integer integer : list) &#123; int order = integer + 2; int result = order / integer; newList.add(result);&#125;for (Integer integer : newList) &#123; System.out.println(integer);&#125;// ä½¿ç”¨LambdanewList = list.stream().map((a) -&gt; (a + 2)/a).collect(Collectors.toList());newList.forEach(System.out::println); 4. ä½¿ç”¨filterå®žçŽ°å…ƒç´ çš„è¿‡æ»¤ä½¿ç”¨lambda,å¯ç›´æŽ¥ä½¿ç”¨filterè¿›è¡Œå…ƒç´ çš„è¿‡æ»¤ 123456789101112// ä¸ä½¿ç”¨lambdaæ—¶List&lt;Integer&gt; list_1 = new ArrayList&lt;&gt;();for (Integer integer : list) &#123; if(integer != 3)&#123; list_1.add(integer); &#125;&#125;// ä½¿ç”¨ filter è¿›è¡Œè¿‡æ»¤List&lt;Integer&gt; list_2 = list.stream().filter((a) -&gt; a!=3).collect(Collectors.toList());list_2.forEach(System.out::println); 5. æ‰§è¡Œå‡½æ•°ç¨å¤æ‚çš„å­—ç¬¦ä¸²å¤„ç†,ç”¨lambdaåˆé€‚ä¸è¿‡äº†,ä¸‹é¢çš„ä¾‹å­,åªå°†ç‰¹å®šå­—ç¬¦çš„å­—ç¬¦ä¸²è¿›è¡Œ toUpperCase 12345678910List&lt;String&gt; s = new ArrayList&lt;&gt;();s.add("hello ");s.add("world ");s.add("!! ");List&lt;String&gt; s_1 = s.stream() .filter(a -&gt; a.startsWith("h") || a.startsWith("w")) .map(String::toUpperCase) .collect(Collectors.toList());s_1.forEach(System.out::println); 6. ç®—æ•°è¿ç®—æ”¯æŒä½¿ç”¨minã€maxç­‰ç›´æŽ¥å®žçŽ°Comparatorè¿›è¡Œè¿ç®—,å¦‚: 1Optional&lt;Integer&gt; min = list.stream().min(Integer::compareTo); ä¹Ÿæ”¯æŒä½¿ç”¨ IntSummaryStatistics çŠ¶æ€,å¦‚: 12345IntSummaryStatistics intSummaryStatistics = list.stream().mapToInt(x -&gt; x).summaryStatistics();System.out.println("æœ€å¤§å€¼ï¼š"+intSummaryStatistics.getMax());System.out.println("æœ€å°å€¼ï¼š"+intSummaryStatistics.getMin());System.out.println("å¹³å‡å€¼ï¼š"+intSummaryStatistics.getAverage());System.out.println("æ•°é‡ï¼š"+intSummaryStatistics.getCount()); 7. è‡ªå®šä¹‰æ–¹æ³•ä½¿ç”¨Function Intefaceå®žçŽ°å¤æ‚åŠŸèƒ½Java 8 æä¾›äº†ä¸‰ä¸ªå¸¸ç”¨çš„å‡½æ•°æŽ¥å£åŒ…æ‹¬ï¼› Function&lt;T,R&gt; Predicate åˆ¤æ–­ Consumer æ¶ˆè´¹ é€šè¿‡å®šä¹‰æ–¹æ³•ä½¿ç”¨è¿™ä¸‰ç±»æŽ¥å£,èƒ½å®Œæˆæ›´å¤æ‚çš„è°ƒç”¨é€»è¾‘,åœ¨è¿™é‡Œä»…ä»…ä¸¾ä¸€ä¸ªå°ä¾‹å­ðŸŒ° 1234567891011121314151617List&lt;Integer&gt; functionMethods2(List&lt;Integer&gt; a, Function&lt;List&lt;Integer&gt;, List&lt;Integer&gt;&gt; function) &#123; a = a.stream() .filter(demoFilter(2)) .collect(Collectors.toList()); return function.apply(a);&#125;Predicate&lt;Integer&gt; demoFilter(Integer number) &#123; return (a) -&gt; !a.equals(number);&#125;// å®¢æˆ·ç«¯è°ƒç”¨JavaTester javaTester = new JavaTester();List&lt;Integer&gt; resList = javaTester.functionMethods2(list, a -&gt; &#123; a.add(2); return a; &#125;);]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mysqlä¸­çš„INSTRå’ŒFIND_IN_SETå‡½æ•°åº”ç”¨]]></title>
    <url>%2F2020%2F03%2F09%2FINSTR%E5%92%8CFIND_IN_SET%E5%87%BD%E6%95%B0%2F</url>
    <content type="text"><![CDATA[INSTRå‡½æ•°The INSTR() function returns the position of the first occurrence of a string in another string. This function performs a case-insensitive search. èƒ½å¤Ÿæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°ä½ç½®,ç±»ä¼¼javaä¸­çš„firstIndexOf,å¹¶ä¸”æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„æœç´¢ ç”¨æ³•é¦–å…ˆ:äº†è§£åˆ° INSTR å‡½æ•°çš„åŸºæœ¬åŠŸèƒ½æ—¶èƒ½å¤Ÿ è¿”å›žå­—ç¬¦ä¸²åœ¨æŸä¸€ä¸ªå­—æ®µçš„å†…å®¹ä¸­çš„ä½ç½®, æ²¡æœ‰æ‰¾åˆ°å­—ç¬¦ä¸²è¿”å›ž0ï¼Œå¦åˆ™è¿”å›žä½ç½®ï¼ˆä»Ž1å¼€å§‹ï¼‰ .æ¯”å¦‚: 1234-- ç»“æžœä¸º10select INSTR("this is mysql","y") -- ç»“æžœä¸º0select INSTR("this is mysql","a") 2å¦‚æžœinstrå½“ä½œæŸ¥è¯¢æ¡ä»¶,å°±èƒ½èµ·åˆ°ç±»ä¼¼inçš„ä½œç”¨ 12-- è¿”å›žç”¨æˆ·idä¸º12çš„æ•°æ®,åŒæ ·çš„,ä¹Ÿä¼šè¿”å›židä¸º 1,2çš„æ•°æ®select * from user u where INSTR('12',u.id); æ›´å¤æ‚çš„èƒ½å¤ŸæŸ¥è¯¢æ•°æ®ä¸ºå­—ç¬¦ä¸²,å¹¶ä¸”ç”¨ç‰¹å®šç¬¦å·åˆ†éš”çš„ç‰¹å®šçš„æ•°æ® 1234567select ( select GROUP_CONCAT(u.username) as name from `user` u where INSTR(concat(',',(p.leaderIds),','),concat(',',(u.id),','))) from product p WHERE p.product_uid ='02124ff31eac4c14934b045358b10cca' FIND_IN_SET å‡½æ•°The FIND_IN_SET() function returns the position of a string within a list of strings. èƒ½å¤Ÿè¿”å›žlistä¸­çš„å­—ç¬¦ä¸²ä½ç½®(ä½¿ç”¨é€—å·åˆ†éš”) åŸºç¡€çš„å°±ä¸å¤šè¯´,ç›´æŽ¥ä¸¾ä¾‹ 12-- ä¼šåªè¿”å›židä¸º12,13çš„æ•°æ®select * from user u where FIND_IN_SET(u.id,'12,13') find_in_set å’Œ instr å‡½æ•°åšä¾‹å­ä¸Šçš„å¯¹æ¯”æ—¶,å‘çŽ°instræ˜¯æ¨¡ç³ŠåŒ¹é…,åªè¦ç¬¦åˆéƒ½ä¼šæŸ¥å‡ºæ¥,è€Œfind_in_setæ˜¯é’ˆå¯¹ä½¿ç”¨é€—å·åˆ†éš”çš„å¯¹instrçš„è¿›ä¸€æ­¥å¤„ç†,åªæœ‰å‡ºçŽ°åœ¨é€—å·ä¹‹é—´çš„è¿›è¡Œç²¾ç¡®åŒ¹é….]]></content>
      <categories>
        <category>MYSQL</category>
      </categories>
      <tags>
        <tag>MYSQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootæ•´åˆJPAä½¿ç”¨]]></title>
    <url>%2F2020%2F03%2F05%2FSpringBoot%E6%95%B4%E5%90%88JPA%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[SpringBootæ•´åˆJPAä½¿ç”¨æ•´åˆJPASpringBootæ•´åˆJPAååˆ†æ–¹ä¾¿,åœ¨Pomä¸­æ·»åŠ å¦‚ä¸‹: 123456789101112131415&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- æ•°æ®åº“é…ç½®,ä½¿ç”¨druid --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.16&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.47&lt;/version&gt;&lt;/dependency&gt; JPAåŸºæœ¬é…ç½®åœ¨application.properties æˆ–è€… application.yaml æ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“é“¾æŽ¥å’ŒJPAçš„åŸºæœ¬é…ç½®(æœ¬ä¾‹ä½¿ç”¨yamlæ–‡ä»¶): 123456789101112131415161718192021222324spring: datasource: driver-class-name: com.mysql.jdbc.Driver druid: initial-size: 5 max-active: 20 max-wait: 60000 stat-view-servlet: login-password: admin login-username: admin password: 123456 url: jdbc:mysql://127.0.0.1:3306/web?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false username: root jpa: # é…ç½®åˆ›å»ºè¡¨ä½¿ç”¨çš„SQLDialect database-platform: org.hibernate.dialect.MySQL5InnoDBDialect show-sql: true # è‡ªåŠ¨æ›´æ–°æ•°æ®åº“è¡¨ hibernate: ddl-auto: update properties: hibernate: # ä½¿ç”¨@Queryæ—¶SQLçš„dialectæ–¹è¨€ dialect: org.hibernate.dialect.MySQL5InnoDBDialect ä½¿ç”¨JPAåœ¨SpringBootä¸­ä½¿ç”¨JPAååˆ†ç®€å•,åªè¦å¼•ç”¨JPAçš„starterå³å¯ å®žä½“ç±»ä¸­å±žæ€§ä½¿ç”¨Spring Data JPA,ä¸ŽMybatisä¸åŒ,æ›´å¤šçš„æ˜¯é¢å‘å¯¹è±¡æŸ¥è¯¢.æ‰€ä»¥æž„é€ å¯¹è±¡å®žä½“ç±»å°±éžå¸¸é‡è¦,å¦‚æžœé…ç½®äº†è‡ªåŠ¨æ›´æ–°è¡¨ç»“æž„,å°±éœ€è¦æ³¨æ„å¦‚ä½•åœ¨å®žä½“ä¸­ä½¿ç”¨ç‰¹å®šçš„æ³¨è§£å®Œæˆå¯¹å®žä½“çš„é…ç½®. 1. @Entityä½¿ç”¨ @Entity æ³¨è§£åœ¨ç±»ä¸Š,ç”¨æ¥è¡¨ç¤ºè¯¥ç±»ä¸ºä¸€ä¸ªå®žä½“ç±» 2. @Tableä½¿ç”¨ @Table æ³¨è§£æ ‡æ³¨åœ¨ç±»ä¸Š, å¯ä»¥æŒ‡å®šä½¿ç”¨ @Entity æ³¨è§£æ ‡æ³¨çš„ç±»æ‰€ç”Ÿæˆçš„æ•°æ®åº“è¡¨ä¿¡æ¯,å¦‚è¡¨åç§°ç­‰. 12345@Entity // æŒ‡å®šè¿™ä¸ªç±»ä¸ºå®žä½“ç±»@Table(name="user") // æŒ‡å®š@Entityæ ‡æ³¨çš„ä¸»è¡¨public class User implements Serializable &#123;// ...&#125; 3. @Id,@Columnä½¿ç”¨ @Id æ³¨è§£æ ‡æ³¨åœ¨å˜é‡æˆ–è€…setæ–¹æ³•ä¸Š,ç”¨æ¥æ ‡æ³¨è¯¥å˜é‡ä¸ºä¸»é”®ID. ä½¿ç”¨ @Column æ³¨è§£åŒæ ·æ ‡æ³¨åœ¨å˜é‡ä¸Š,èƒ½å¤Ÿè®¾ç½®ç”Ÿæˆè¡¨çš„å„ç§è¯¦ç»†ä¿¡æ¯,å¦‚å­—æ®µåç§°,å­—æ®µé•¿åº¦ç­‰ç­‰â€¦ 12345678@Id@Column(columnDefinition = "INT(11)")@GeneratedValue(strategy=GenerationType.IDENTITY)private Integer id;@Column(name = "is_deleted",columnDefinition = "TINYINT(1)",nullable =false)private Short isDeleted=0; 4. @GeneratedValueä½¿ç”¨ @GeneratedValue æ³¨è§£æ ‡æ³¨åœ¨ å’Œ @Id ç›¸åŒçš„ä½ç½®,ç”¨æ¥è¡¨ç¤ºä¸»é”®IDçš„ç”Ÿæˆç­–ç•¥.è¯¥æ³¨è§£æœ‰ä¸¤ä¸ªå±žæ€§,ç¬¬ä¸€ä¸ªæ˜¯å¸¸ç”¨åˆ°çš„ strategy å³ç”Ÿæˆç­–ç•¥,ç¬¬äºŒä¸ªæ˜¯ä¸å¸¸ç”¨åˆ°çš„generatoræŒ‡å®šç”Ÿæˆå™¨. strategyGenerationType åŒ…å«å››ç§ç­–ç•¥: TABLE,ä½¿ç”¨ç‰¹å®šçš„è¡¨æ¥å­˜å‚¨ç”Ÿæˆçš„ä¸»é”®,ä¹Ÿå°±æ˜¯è¯´ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ç§è®°å½•ä¸»é”®çš„è¡¨,ä¸€èˆ¬ä¼šåŒ…å«ä¸¤ä¸ªå­—æ®µ,ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯å­—æ®µç”Ÿæˆç­–ç•¥çš„åç§°,ç¬¬äºŒä¸ªæ˜¯IDçš„æœ€å¤§åºåˆ—å€¼.é€šå¸¸ä¼šå’Œ @TableGenerator ä¸€èµ·æ¥ä½¿ç”¨,èƒ½å¤ŸæŒ‡å®šç‰¹å®šè¡¨æ¥ç”Ÿæˆä¸»é”®,å¦‚æžœä¸æŒ‡å®š,ä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªåç§°ä¸º sequence çš„è¡¨æ¥è®°å½•. SEQUENCE,åœ¨ç‰¹å®šçš„æ•°æ®åº“,å¦‚ORACLE,ä¸æ”¯æŒè‡ªå¢žä¸»é”®,ä½†æ˜¯ä¼šæä¾›ä¸€ç§å«åšåºåˆ—çš„æ–¹å¼ç”Ÿæˆä¸»é”®,æ­¤æ—¶å°±éœ€è¦æŒ‡å®š SEQUENCE ä¸ºç”Ÿæˆä¸»é”®çš„ç­–ç•¥,å’ŒTABLEç›¸ä¼¼,é€šå¸¸ä¼šä½¿ç”¨ @SequenceGenerator ä¸€èµ·ä½¿ç”¨ IDENTITY ,é‡åˆ°å‘MYSQLèƒ½å¤Ÿè®©ä¸»é”®è‡ªå¢žçš„æ•°æ®åº“,å°±å¯ä»¥æŒ‡å®šç”Ÿæˆç­–ç•¥ä¸ºIDENTITY,ç”Ÿæˆè¡¨åŽ, Mysqlä¼šé»˜è®¤å°†è¯¥å­—æ®µè®¾ç½®ä¸º â€˜auto_incrementâ€™, AUTO ,ä½¿ç”¨ @GeneratedValue é»˜è®¤çš„ç”Ÿæˆç­–ç•¥,æŠŠå…·ä½“ç”Ÿæˆä¸»é”®çš„è§„åˆ™äº¤ç»™æŒä¹…åŒ–å¼•æ“Žæ¥å®žçŽ°,ä¹Ÿæ˜¯æˆ‘ä½¿ç”¨æœ€å¤šçš„ä¸€ç§æ–¹å¼. 123456789101112131415161718// ä½¿ç”¨ GenerationType.TABLE æŒ‡å®šç”Ÿæˆçš„è®°å½•è¡¨,å…¶ä¸­nameå¿…é¡»,å…¶ä»–å¯é€‰@Id@GeneratedValue(strategy = GenerationType.TABLE, generator = "roleSeq")@TableGenerator(name = "roleSeq", allocationSize = 1, table = "seq_table", pkColumnName = "seq_id", valueColumnName = "seq_count")private Integer id;// ä½¿ç”¨ SEQUENCE @Id@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "menuSeq")@SequenceGenerator(name = "menuSeq", initialValue = 1, allocationSize = 1, sequenceName = "MENU_SEQUENCE")private Integer id;// ä½¿ç”¨ IDENTITY è¿›è¡Œè‡ªå¢ž@Id@GeneratedValue(strategy = GenerationType.IDENTITY)private Integer id;// ä½¿ç”¨AUTO,æˆ–è€…ä¸æŒ‡å®šç­–ç•¥@Id@GeneratedValue(strategy = GenerationType.AUTO)private Integer id generatoré€šè¿‡ä¸Šé¢å¯¹ç­–ç•¥çš„æè¿°,ä¹Ÿå°±æ˜Žç™½generatorçš„ä½œç”¨,å°±æ˜¯æŒ‡å®šç‰¹å®šnameçš„Generator 5. @Transientä½¿ç”¨ @Transient æ³¨è§£,æ ‡æ³¨åœ¨å­—æ®µä¸Š,åœ¨JPAç”Ÿæˆè¡¨å­—æ®µæ—¶èƒ½å¤Ÿå¿½ç•¥è¯¥å­—æ®µ,è®©å­—æ®µä¸å‡ºçŽ°åœ¨æ•°æ®åº“ä¸­. 6. @Embeddedå’Œ@Embeddableå½“å®žä½“Aå‡ºçŽ°åœ¨å®žä½“Bä¸­,ä½†å®žä½“Aä¸éœ€è¦å•ç‹¬ç”Ÿæˆä¸€å¼ è¡¨çš„ä½¿ç”¨,ä½¿ç”¨@@Embeddedå’Œ@Embeddableæ ‡æ³¨åœ¨ç±»ä¸Š,èƒ½å¤Ÿé˜²æ­¢å®žä½“Aç”Ÿæˆæ•°æ®åº“è¡¨. 7. @Temporalä½¿ç”¨ @Temporal æ³¨è§£ç‰¹æ®Šæ ‡è®°åœ¨éœ€è¦æŒä¹…åŒ–çš„å­—æ®µä¸Š,å¹¶ä¸”å­—æ®µç±»åž‹ä¸º java.util.Date æˆ– java.util.Calendarçš„æ—¶å€™,å¯æŒ‡å®š TemporalType æ¥ç”Ÿæˆå¯¹åº”æ•°æ®åº“ä¸­çš„æ—¶é—´æ ¼å¼(java.sql.xxxx). 8. ä¸€å¯¹ä¸€,ä¸€å¯¹å¤š,å¤šå¯¹å¤šå…³ç³»åœ¨ä½¿ç”¨å…³ç³»åž‹æ•°æ®åº“ä¸­,å…ä¸äº†ä¸Šè¿°å…³ç³»çš„ç”Ÿæˆ,ä¸‹é¢å°±æ¥è¯´ä¸€ä¸‹,å¦‚ä½•é’ˆå¯¹ä¸€å¯¹ä¸€å…³ç³»ã€ä¸€å¯¹å¤šå…³ç³»ã€å¤šå¯¹å¤šå…³ç³»çš„é€šç”¨è®¾ç½®,åœ¨åˆ†åˆ«å®žéªŒå‰,å…ˆäº†è§£ä¸€ä¸‹ @JoinColumn çš„ä½œç”¨ æˆ‘è®¤ä¸ºçš„JoinColumnæ˜¯ç‰¹æ®Šçš„@Column,å½“éœ€è¦ä½¿ç”¨åˆ°â€œå…³ç³»â€æ—¶,éœ€è¦ä½¿ç”¨åˆ°JoinColumnæ¥æ›¿ä»£æ™®é€šçš„Columnæ³¨è§£ OneToOneä½¿ç”¨OneToOneæ³¨è§£,æŒ‡å®šä¸¤æ–¹å…³ç³»æ˜¯ä¸€å¯¹ä¸€çš„.æ¯”å¦‚Userå’ŒStatus,Statusæ˜¯Userçš„ä¸€ä¸ªå±žæ€§,åœ¨Userè¡¨ä¸­åªéœ€è®°å½•Stautsè¡¨ä¸­çš„ä¸»é”®,æ‰€ä»¥éœ€è¦åœ¨Userè¡¨(ä¸»)ä¸­å£°æ˜Žä¸€ä¸ªStatus(ä»Ž)å³å¯: 123@OneToOne()@JoinColumn(columnDefinition = "INT(11)",name = "status_id")private Status status; OneToManyã€ManyToOneä½¿ç”¨ @OneToMany æˆ– @ManyToOne æ³¨è§£æ¥è¡¨ç¤ºä¸€å¯¹å¤šã€å¤šå¯¹ä¸€çš„å…³ç³».å…¸åž‹çš„å¦‚Projectä¹‹äºŽTask,ä¸€ä¸ªProjectåŒ…å«å¤šä¸ªTask,æ‰€ä»¥Projectä¸ºOne,Taskä¸ºMany. å¦‚æžœåœ¨Project(ä¸»)ä¸­å£°æ˜ŽTask(ä»Ž)æ—¶,å¯ä»¥ä½¿ç”¨ OneToMany è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³» 123@OneToMany(cascade = CascadeType.ALL)@JoinColumn(name="project_id") // taskè¡¨æŒ‡å‘projectè¡¨çš„å¤–é”®Set&lt;Task&gt; tasks; ä¹Ÿå¯ä»¥åœ¨å¤šçš„ä¸€æ–¹ä½¿ç”¨ ManyToOne æ³¨è§£,è¡¨ç¤ºå¤šå¯¹ä¸€çš„å…³ç³» 1234@ManyToOne// åœ¨ one çš„ä¸€æ–¹ç”Ÿæˆ nameä¸º project_id çš„å­—æ®µ,æŒ‡å‘task@JoinColumn(name="project_id") Project project; ä»¥ä¸Šæ˜¯å•ç‹¬ä½¿ç”¨ @OneToMany æˆ– @ManyToOne æž„é€ å•å‘çš„å…³ç³»,ä½†æ˜¯è¿™æ ·æœ‰ç¼ºç‚¹,æ³¨å®šæœ‰ä¸€æ–¹æ‰¾ä¸åˆ°å¦å¤–ä¸€æ–¹(åªå»ºç«‹äº†å•å‘å…³ç³»).æ‰€ä»¥ç¨³å¦¥çš„æ–¹å¼æ˜¯æž„å»ºåŒå‘å…³ç³»,åœ¨Oneå’ŒManyåŒæ–¹,ä½¿ç”¨ä¸¤ä¸ªæ³¨è§£ç›¸äº’æŒ‡å®š 12345678// Projectä¸­,å…¶ä¸­mappedByæ˜¯åŒå‘å…³ç³»ä¸­å¿…é¡»è¦ä½¿ç”¨çš„å±žæ€§@OneToMany(cascade = CascadeType.ALL,mappedBy ="project_id")Set&lt;Task&gt; tasks;// Taskä¸­@ManyToOne@JoinColumn(name="project_id")Project project ManyToManyä½¿ç”¨ @ManyToMany æ³¨è§£æ¥æ ‡æ³¨å¤šå¯¹å¤šå…³ç³»,æ¯”å¦‚ç”¨æˆ·å’Œè§’è‰²ä¹‹é—´å°±å¯ä»¥ç†è§£ä¸ºå¤šå¯¹å¤šçš„å…³ç³»,åŒæ–¹éœ€è¦äº’ç›¸æ‹¥æœ‰å¤šä¸ª.å¤šåœ°å¤šå…³ç³»éœ€è¦ä½¿ç”¨ä¸­é—´è¡¨æ¥ç»´æŠ¤ä¸¤æ–¹å…³ç³».å»ºç«‹å…³ç³»è¡¨ä½¿ç”¨@JoinTableæ³¨è§£æ¥æŒ‡å®šå®žçŽ°. 123456789101112// Userè¡¨ä¸­@JSONField(name = "roles")@ManyToMany(mappedBy = "users",fetch = FetchType.EAGER,cascade = CascadeType.ALL)private Set&lt;Role&gt; roles;// Role è¡¨ä¸­@JSONField(serialize = false)@ManyToMany(cascade = CascadeType.ALL,fetch = FetchType.EAGER)@JoinTable(name = "r_user_role", joinColumns = &#123;@JoinColumn(name = "role_id")&#125;, inverseJoinColumns = &#123;@JoinColumn(name = "user_id")&#125;)private List&lt;User&gt; users; å…³ç³»ä½¿ç”¨æ—¶çš„å‘ åŒå‘å…³ç³»éœ€è¦åŒæ–¹éƒ½è¿›è¡Œç»´æŠ¤,å¦åˆ™ä¿å­˜ä¸ä¸Š :) 1234User user = one.get();// å¤šå¯¹å¤šå…³ç³»éœ€è¦åŒå‘å…³è”ä¿å­˜æ‰èµ·ä½œç”¨user.getRoles().add(role);role.getUsers().add(user); ä½¿ç”¨JSONæ—¶,å¦‚æžœå‡ºçŽ°å¾ªçŽ¯å¼•ç”¨å¯¼å‡ºæº¢å‡ºæ—¶,åœ¨ä¸€æ–¹åŠ å…¥è®¾ç½®é˜²æ­¢åºåˆ—åŒ– 1234567// æˆ‘ä½¿ç”¨çš„æ˜¯FastJosn,Jacksonæœ‰ä¸åŒçš„å®žçŽ°æ–¹å¼@JSONField(serialize = false)@ManyToMany(cascade = CascadeType.ALL,fetch = FetchType.EAGER)@JoinTable(name = "r_user_routemeta", joinColumns = &#123;@JoinColumn(name = "role_id")&#125;, inverseJoinColumns = &#123;@JoinColumn(name = "meta_id")&#125;)private Set&lt;RouteMeta&gt; routeMeta; ä½¿ç”¨ Repository æŸ¥è¯¢Repository æ˜¯ Spring Data JPA ä¸­æœ€é‡è¦çš„æŽ¥å£,ä½¿ç”¨å®žä½“ç±»å’Œå®žä½“ç±»ä¸­çš„ä¸»é”®IDä½œä¸ºç±»åž‹å‚æ•°.å…¶ä¸­CURDRepositoryä¸ºå®žä½“ç±»æä¾›äº†å¤æ‚å¢žåˆ æ”¹æŸ¥çš„å‡½æ•°. 1. CrudRepositoryæŽ¥å£1public interface CrudRepository&lt;T, ID&gt; extends Repository&lt;T, ID&gt; &#123;&#125; åŒæ ·æä¾›äº†ç‰¹å®šçš„Repository,æ¯”å¦‚JPARepositoryã€MongoRepository,è¿™å‡ ä¸ªéƒ½æ˜¯ç»§æ‰¿çš„ CrudRepository æŽ¥å£,æ ¹æ®ä¸åŒçš„æŠ€æœ¯ç‰¹æ€§æš´éœ²ä¸åŒçš„æŽ¥å£æ–¹æ³•.ä¸€èˆ¬ä½¿ç”¨ä¸Šç›´æŽ¥ç»§æ‰¿CurdRepositoryå°±å¯ä»¥å®ŒæˆåŸºæœ¬çš„å·¥ä½œ. 2. PagingAndSortingRepositoryæŽ¥å£å¦‚æžœä½¿ç”¨åˆ†é¡µæˆ–è€…æŽ’åºéœ€è¦ç»§æ‰¿ PagingAndSortingRepository æŽ¥å£,è¿™ä¸ªæŽ¥å£ä¸­åŒ…å« Iterable&lt;T&gt; findAll(Sort sort); å’Œ Page&lt;T&gt; findAll(Pageable pageable);,è¿™æ ·èƒ½å¤Ÿå…·æœ‰æŸ¥è¯¢æ—¶åˆ†é¡µçš„ç‰¹æ€§ 3. æŽ¥å£ä¸­çš„åç§°æŽ¨å¯¼æŸ¥è¯¢ é€šè¿‡å‘½åæŸ¥è¯¢,å…·ä½“å¯æŸ¥çœ‹ç›¸å…³æ–‡æ¡£,å†™çš„éžå¸¸å…¨ create-query å…³é”®å­— æ–¹æ³•å‘½å sql whereå­—å¥ And findByNameAndPwd where name= ? and pwd =? Or findByNameOrSex where name= ? or sex=? Is,Equals findById,findByIdEquals where id= ? Between findByIdBetween where id between ? and ? LessThan findByIdLessThan where id &lt; ? LessThanEquals findByIdLessThanEquals where id &lt;= ? GreaterThan findByIdGreaterThan where id &gt; ? GreaterThanEquals findByIdGreaterThanEquals where id &gt; = ? After findByIdAfter where id &gt; ? Before findByIdBefore where id &lt; ? IsNull findByNameIsNull where name is null isNotNull,NotNull findByNameNotNull where name is not null Like findByNameLike where name like ? NotLike findByNameNotLike where name not like ? StartingWith findByNameStartingWith where name like â€˜?%â€™ EndingWith findByNameEndingWith where name like â€˜%?â€™ Containing findByNameContaining where name like â€˜%?%â€™ OrderBy findByIdOrderByXDesc where id=? order by x desc Not findByNameNot where name &lt;&gt; ? In findByIdIn(Collection&lt;?&gt; c) where id in (?) NotIn findByIdNotIn(Collection&lt;?&gt; c) where id not in (?) True findByAaaTue where aaa = true False findByAaaFalse where aaa = false IgnoreCase findByNameIgnoreCase where UPPER(name)=UPPER(?) 4. ä½¿ç”¨ Repository æŸ¥è¯¢å®žä¾‹ å£°æ˜Žä¸€ä¸ªæŽ¥å£ç»§æ‰¿ç‰¹å®šçš„Repository 123456/** * JpaRepository ç»§æ‰¿è‡ª PagingAndSortingRepository,å…¶ä¸­ç±»åž‹å‚æ•° * ç¬¬ä¸€ä¸ªæ˜¯æ“ä½œå®žä½“ç±»çš„ç±»åž‹ * ç¬¬äºŒä¸ªæ˜¯æ“ä½œå®žä½“ç±»çš„æ ‡è¯†ID**/public interface UserRepository extends JpaRepository&lt;User,Integer&gt; &#123;&#125; (å¯é€‰)åœ¨æŽ¥å£ä¸­å®šä¹‰æ–¹æ³• 12// å…·ä½“åç§°æŽ¨å¯¼æŸ¥è¯¢å¯ä»¥æŸ¥çœ‹ä¸Šé¢çš„è¡¨æ ¼List&lt;User&gt; findByLastname(String lastname); ä½¿ç”¨@AutoWireæ³¨è§£injectåˆ°ç‰¹å®šçš„serviceä¸­è°ƒç”¨ 123456@AutowiredUserRepository userRepository;@Overridepublic User getUserFromUserName(String name) &#123; return userRepository.findUserByName(name);&#125; åˆ°è¿™é‡Œ,å¢žåˆ æ”¹æŸ¥åŸºæœ¬éƒ½èƒ½å¤Ÿå®žçŽ°,å¤æ‚çš„åœ¨äºŽåˆ†é¡µã€å¤šæ¡ä»¶å¤æ‚æŸ¥è¯¢. 5. ä½¿ç”¨ PagingAndSortingRepository è¿›è¡Œåˆ†é¡µæŸ¥è¯¢å‰é¢è¯´åˆ° PagingAndSortingRepository æä¾›äº†ä¸¤ä¸ªæ–¹æ³•,ä¸€ä¸ªæ˜¯è¿”å›žIterableçš„ findAll(Sort) æ–¹æ³•,å¦ä¸€ä¸ªæ˜¯è¿”å›žPageçš„findAllæ–¹æ³• åœ¨æ²¡æœ‰å…¶ä»–æŸ¥è¯¢æ¡ä»¶çš„æƒ…å†µä¸‹,ç›´æŽ¥å®šä¹‰ä¸€ä¸ªPageableå˜é‡,ç„¶åŽä½¿ç”¨ç‰¹å®šæ–¹æ³•å³å¯: 12345@Overridepublic Page&lt;Book&gt; findBookNoCriteria(Integer page,Integer size) &#123; Pageable pageable = new PageRequest(page, size, Sort.Direction.ASC, "id"); return bookRepository.findAll(pageable);&#125; åœ¨å­˜åœ¨å¤šæ ·çš„æŸ¥è¯¢æ¡ä»¶çš„æƒ…å†µä¸‹,è¿˜éœ€è¦æŽ¥å£ç»§æ‰¿ JpaSpecificationExecutor 1234567891011121314public Page&lt;Book&gt; findBookCriteria(Integer page, Integer size, final BookQuery bookQuery) &#123; Pageable pageable = new PageRequest(page, size, Sort.Direction.ASC, "id"); Page&lt;Book&gt; bookPage = bookRepository.findAll(new Specification&lt;Book&gt;()&#123; @Override public Predicate toPredicate(Root&lt;Book&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder criteriaBuilder) &#123; Predicate p1 = criteriaBuilder.equal(root.get("name").as(String.class), bookQuery.getName()); Predicate p2 = criteriaBuilder.equal(root.get("isbn").as(String.class), bookQuery.getIsbn()); Predicate p3 = criteriaBuilder.equal(root.get("author").as(String.class), bookQuery.getAuthor()); query.where(criteriaBuilder.and(p1,p2,p3)); return query.getRestriction(); &#125; &#125;,pageable); return bookPage;&#125; ä½¿ç”¨@Queryè¯­å¥æŸ¥è¯¢å°½ç®¡é€šè¿‡ä¸Šé¢çš„æ–¹æ³•èƒ½å¤Ÿéžå¸¸æ–¹ä¾¿å¿«æ·çš„ä½¿ç”¨æŸ¥è¯¢,ä½†æ˜¯æœ‰æ—¶å€™åŒ…å«ç‰¹æ®Šå­—æ®µçš„æŸ¥è¯¢æˆ–è€…ä½¿ç”¨åç§°ç»„åˆå‡ºæ¥çš„æ–¹æ³•ååˆé•¿æœ‰ä¸‘â€¦è€Œä¸”æ‹…å¿ƒæ•ˆçŽ‡ä½Ž,è¿™æ—¶å€™JPAæä¾›äº†ä¸€ç§ç±»ä¼¼Hibernateçš„æ–¹æ³•,å°±æ˜¯ä½¿ç”¨@Queryè¿›è¡ŒæŸ¥è¯¢ 12@Query("select u from User u where u.emailAddress = ?1")User findByEmailAddress(String emailAddress); æˆ–è€…ä½¿ç”¨åŽŸç”ŸSQLæŸ¥è¯¢,å°†Queryçš„å‚æ•°nativeQueryè®¾ç½®ä¸ºtrue 12@Query(nativeQuery = true,value = "select u.name from user u where u.id:id limit 1")String getUserNameById(Integer id); ä½¿ç”¨QueryDSLè¿›è¡Œå¤æ‚æŸ¥è¯¢å¦‚æžœä¸Šé¢çš„æŸ¥è¯¢æ–¹å¼ä»ç„¶æ»¡è¶³ä¸äº†éœ€æ±‚,é‚£ä¹ˆå¯ä»¥å°è¯•ä½¿ç”¨QueryDSLè¿›è¡ŒæŸ¥è¯¢ QueryDSL 1. è¿‡ç¨‹ æ·»åŠ MAVENä¾èµ– 12345678910111213141516171819202122232425262728293031 &lt;dependency&gt; &lt;groupId&gt;com.querydsl&lt;/groupId&gt; &lt;artifactId&gt;querydsl-apt&lt;/artifactId&gt; &lt;version&gt;$&#123;querydsl.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.querydsl&lt;/groupId&gt; &lt;artifactId&gt;querydsl-jpa&lt;/artifactId&gt; &lt;version&gt;$&#123;querydsl.version&#125;&lt;/version&gt; &lt;/dependency&gt;&lt;!-- æ·»åŠ APT PLUGIN --&gt;&lt;plugin&gt; &lt;groupId&gt;com.mysema.maven&lt;/groupId&gt; &lt;artifactId&gt;apt-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.1.3&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;process&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;outputDirectory&gt;target/generated-sources/java&lt;/outputDirectory&gt; &lt;processor&gt;com.querydsl.apt.jpa.JPAAnnotationProcessor&lt;/processor&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt;&lt;/plugin&gt; JPAAnnotationProcessor ä¼šæŸ¥æ‰¾æ‰€æœ‰çš„ Entity æ³¨è§£æ ‡æ³¨çš„å®žä½“ç±»åœ¨ç›®æ ‡è·¯å¾„ä¸‹ç”Ÿæˆ Qxxx çš„ç±».ç¬¬ä¸€æ¬¡éœ€è¦ä½¿ç”¨ maven install ç”Ÿæˆä¸€ä¸‹. ä½¿ç”¨æŸ¥è¯¢ 123456789/** * æ³¨å…¥ jpaQueryFactory * @param entityManager * @return */@Beanpublic JPAQueryFactory jpaQueryFactory(EntityManager entityManager)&#123; return new JPAQueryFactory(entityManager);&#125; åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨@BeanæŠŠJPAQueryFactoryæ³¨å…¥åˆ°å®¹å™¨ä¸­,ç„¶åŽä½¿ç”¨JpaQueryFactoryæŸ¥è¯¢. 12345678910private List&lt;User&gt; doGetrolePerson(Integer role,boolean in,List&lt;User&gt; users)&#123; QUser user = QUser.user; Predicate predicate = user.isNotNull().or(user.isNull()); if(in)&#123; predicate = role == null ? predicate : ExpressionUtils.and(predicate, user.roles.any().id.in(role)); &#125;else&#123; predicate = role == null ? predicate : ExpressionUtils.and(predicate, user.notIn(users)); &#125; return jpaQueryFactory.selectFrom(user).where(predicate).fetch();&#125; ä»¥ä¸Šæ˜¯ä½¿ç”¨åŸºæœ¬çš„QueryDSLè¿›è¡ŒæŸ¥è¯¢çš„æ–¹å¼,æ›´å¤šçš„å¢žåˆ æ”¹æŸ¥çš„æ–¹æ³•å¯ä»¥å‚è€ƒä¸Šé¢å¼•ç”¨çš„æ–‡æ¡£,è¿™é‡Œä¸åœ¨è¿‡å¤šæè¿°. 2. ç»“åˆæŸ¥è¯¢SpringDataJPA å¯¹ QueryDSL æä¾›äº†ä¸€ä¸ªé€šç”¨çš„Repository â€“ QuerydslPredicateExecutor 1234567891011121314151617public interface QuerydslPredicateExecutor&lt;T&gt; &#123; Optional&lt;T&gt; findOne(Predicate var1); Iterable&lt;T&gt; findAll(Predicate var1); Iterable&lt;T&gt; findAll(Predicate var1, Sort var2); Iterable&lt;T&gt; findAll(Predicate var1, OrderSpecifier&lt;?&gt;... var2); Iterable&lt;T&gt; findAll(OrderSpecifier&lt;?&gt;... var1); Page&lt;T&gt; findAll(Predicate var1, Pageable var2); long count(Predicate var1); boolean exists(Predicate var1);&#125; ä½¿ç”¨éœ€è¦è®©å®šä¹‰çš„Repositoryç»§æ‰¿è¿™ä¸ªQuerydslPredicateExecutor,ç„¶åŽè°ƒç”¨æ–¹æ³•å³å¯: 123456789101112131415161718192021public Page&lt;User&gt; findUsers(Integer offset, Integer limit, String order, String search, Integer status, Integer sex, Integer role) throws Exception &#123; Sort sort = null; String propertie = order.substring(1); if (order.startsWith("-")) &#123; sort = Sort.by(propertie).descending(); &#125; else if (order.startsWith("+")) &#123; sort = Sort.by(propertie).ascending(); &#125; if(offset == null || limit == null)&#123; offset = 1; limit = Integer.MAX_VALUE; &#125; PageRequest pageRequest = new PageRequest(offset - 1, limit, sort); QUser user = QUser.user; com.querydsl.core.types.Predicate predicate = user.isNotNull().or(user.isNull()); predicate = search == null ? predicate : ExpressionUtils.and(predicate, user.name.like("%" + search + "%")); predicate = sex == null ? predicate : ExpressionUtils.and(predicate, user.sex.id.eq(sex)); predicate = status == null ? predicate : ExpressionUtils.and(predicate, user.status.id.eq(status)); predicate = role == null ? predicate : ExpressionUtils.and(predicate, user.roles.any().id.eq(role)); return userRepository.findAll(predicate, pageRequest);&#125;]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springçš„Beançš„å®žä¾‹åŒ–]]></title>
    <url>%2F2020%2F01%2F17%2FSpring%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E5%9B%9B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Beançš„å®žä¾‹åŒ–åœ¨refreshæ–¹æ³•æ‰§è¡Œåˆ° finishBeanFacotyInitializawtion æ—¶ï¼Œåœ¨æ–¹æ³•å†…éƒ¨ä¼šæ‰§è¡Œå¯¹Beançš„å®žä¾‹åŒ–æ“ä½œï¼š 123456789101112131415161718192021222324252627282930313233// Instantiate all remaining (non-lazy-init) singletons.finishBeanFactoryInitialization(beanFactory);protected void finishBeanFactoryInitialization(ConfigurableListableBeanFactory beanFactory) &#123; // ä¸ºBeanFactoyæ·»åŠ conversionService if (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp; // æ˜¯å¦åŒ…å« conversionService beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123; beanFactory.setConversionService( beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)); &#125; // Register a default embedded value resolver if no bean post-processor // (such as a PropertyPlaceholderConfigurer bean) registered any before: // at this point, primarily for resolution in annotation attribute values. if (!beanFactory.hasEmbeddedValueResolver()) &#123; beanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal)); &#125; // å°½æ—©åˆå§‹åŒ–LoadTimeWeaverAware Beanï¼Œä»¥ä¾¿å°½æ—©æ³¨å†Œå…¶è½¬æ¢å™¨ã€‚ String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, false, false); for (String weaverAwareName : weaverAwareNames) &#123; getBean(weaverAwareName); &#125; // å–æ¶ˆä½¿ç”¨ä¸´æ—¶çš„classLoader beanFactory.setTempClassLoader(null); // å…è®¸ç¼“å­˜æ‰€æœ‰çš„Bean Definition å…ƒæ•°æ®ï¼Œ beanFactory.freezeConfiguration(); // åˆå§‹åŒ–æ‰€æœ‰å‰©ä½™çš„ï¼ˆéžæ‡’åŠ è½½çš„ï¼‰å•ä¾‹çš„Bean beanFactory.preInstantiateSingletons();&#125; é‡ç‚¹åœ¨äºŽ preInstantiateSingletons æ–¹æ³•ï¼Œç”¨æ¥åˆå§‹åŒ–æ‰€æœ‰çš„å•ä¾‹Beanã€‚å®žé™…ä¸Šåœ¨å‰é¢çš„getBeanèŽ·å–weaverAwareå°±èƒ½å¤Ÿçœ‹å‡ºçœŸæ­£è°ƒç”¨èŽ·å–å•å®žä¾‹çš„Beançš„æ–¹æ³•å°±æ˜¯ getBean æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041public void preInstantiateSingletons() throws BeansException &#123; // logging .... List&lt;String&gt; beanNames = new ArrayList&lt;&gt;(this.beanDefinitionNames); // è§¦å‘æœ‰éžæ‡’åŠ è½½çš„Beançš„åˆå§‹åŒ– for (String beanName : beanNames) &#123; // èŽ·å–æ‰€æœ‰çš„RootBeanDefinition,æ‰€è°“çš„Rootxxxï¼Œå…¶å®žå°±æ˜¯ç»Ÿä¸€çš„BeanDefinitionè§†å›¾ RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName); if (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123; if (isFactoryBean(beanName)) &#123; // å¦‚æžœæ˜¯FactoryBeanï¼Œåˆ™ä½¿ç”¨getBeanæ—¶éœ€è¦åŠ ä¸Šå‰ç¼€ &amp; Object bean = getBean(FACTORY_BEAN_PREFIX + beanName); if (bean instanceof FactoryBean) &#123; final FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) bean; boolean isEagerInit; if (System.getSecurityManager() != null &amp;&amp; factory instanceof SmartFactoryBean) &#123; // å¦‚æžœç»§æ‰¿SmartFactoryBean isEagerInit = AccessController.doPrivileged((PrivilegedAction&lt;Boolean&gt;) ((SmartFactoryBean&lt;?&gt;) factory)::isEagerInit, getAccessControlContext()); &#125; else &#123; isEagerInit = (factory instanceof SmartFactoryBean &amp;&amp; ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit()); &#125; if (isEagerInit) &#123; // æ‰§è¡ŒgetBeanèŽ·å–Bean getBean(beanName); &#125; &#125; &#125; else &#123; // æ‰§è¡ŒgetBeanèŽ·å–Bean getBean(beanName); &#125; &#125; &#125; // è§¦å‘åˆå§‹åŒ–åŽçš„callback...&#125; åœ¨preInstantiateSingletons ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å®ƒä¼šéåŽ†æ‰€æœ‰çš„å·²ç»æ³¨å†Œåˆ°å®¹å™¨ä¸­çš„Beanï¼Œæœ€åŽä¼šé€šè¿‡ getBean() è¿›è¡Œå¯¹Beançš„åˆå§‹åŒ–æ“ä½œã€‚ å…¶ä¸­åˆ¤æ–­äº†å¦‚æžœæ˜¯ Factorybean çš„æƒ…å†µä¸‹åº”è¯¥å…ˆåŽ»æ·»åŠ ä¸€ä¸ªå‰ç¼€ â€˜&amp;â€™ ï¼Œæ‰èƒ½èŽ·å–çœŸæ­£çš„FactoryBeançš„å®žçŽ°ç±»çš„å¯¹è±¡Beanã€‚å¦‚æžœä¸æ·»åŠ å‰ç¼€ â€˜&amp;â€™ï¼Œåˆ™ä¼šè¿”å›žå®žçŽ°ç±»ä¸­çš„getObjectæ–¹æ³•è¿”å›žçš„å¯¹è±¡ã€‚ å› ä¸ºç»è¿‡åˆ†æžï¼Œæ˜¯ getBean æ–¹æ³•æ˜¯è¾¾åˆ°åˆå§‹åŒ–Beanå®žä¾‹çš„ç›®çš„ï¼Œæ‰€ä»¥æŽ¥ä¸‹æ¥çœ‹ getBean ä¸­æ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚ getBeangetBeanæ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä¾æ®è°ƒç”¨é¡ºåºæ‹†å‡ºæ¥å¤§è‡´5ä¸ªå°ç« èŠ‚æ¥å±•å¼€è®²ã€‚ 1.getBeané€šè¿‡è°ƒç”¨doGetBeanåˆ›å»ºå®žä¾‹123public Object getBean(String name) throws BeansException &#123; return doGetBean(name, null, null, false);&#125; 2. æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨è°ƒç”¨doGetBeanæ–¹æ³•åŽï¼Œé¦–å…ˆä¼šå…ˆä½¿ç”¨getSingletonæ–¹æ³•åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨å®žä¾‹ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹é€»è¾‘ï¼š åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ï¼Ÿ å¦‚æžœå­˜åœ¨ï¼Œå¦‚æžœå½“å‰å•ä¾‹æ­£åœ¨åˆ›å»ºä¸­ï¼Œåˆ™è¯´æ˜Žå‡ºçŽ°äº†å¾ªçŽ¯å¼•ç”¨ã€‚ å¦‚æžœå­˜åœ¨ï¼Œå®žä¾‹æ²¡æœ‰æ­£åœ¨åˆ›å»ºï¼Œæ²¡æœ‰å¾ªçŽ¯å¼•ç”¨ã€‚ åªè¦ç¼“å­˜ä¸­å­˜åœ¨ï¼Œéƒ½ç›´æŽ¥è¿”å›žç¼“å­˜ä¸­çš„BeanInstance 1234567891011121314151617181920protected &lt;T&gt; T doGetBean(final String name, @Nullable final Class&lt;T&gt; requiredType, @Nullable final Object[] args, boolean typeCheckOnly) throws BeansException &#123; // èŽ·å¾—Beannameå­—ç¬¦ä¸²ï¼Œå› ä¸ºæœ‰FactoryBeanéœ€è¦æ·»åŠ &amp;ç¬¦å· final String beanName = transformedBeanName(name); Object bean; Object sharedInstance = getSingleton(beanName); if (sharedInstance != null &amp;&amp; args == null) &#123; if (logger.isTraceEnabled()) &#123; if (isSingletonCurrentlyInCreation(beanName)) &#123; logger.trace("Returning eagerly cached instance of singleton bean '" + beanName + "' that is not fully initialized yet - a consequence of a circular reference"); &#125; else &#123; logger.trace("Returning cached instance of singleton bean '" + beanName + "'"); &#125; &#125; bean = getObjectForBeanInstance(sharedInstance, name, beanName, null); &#125; //... 3. å¦‚æžœtypeCheckOnlyä¸ºfalseï¼Œåˆ™æ ‡è®°å·²åˆ›å»ºä½œç”¨æ˜¯ï¼šå°†æŒ‡å®šçš„beanæ ‡è®°ä¸ºå·²åˆ›å»ºï¼Œå…è®¸beanå·¥åŽ‚ä¼˜åŒ–å…¶ç¼“å­˜ä»¥é‡å¤åˆ›å»ºæŒ‡å®šçš„beanã€‚ 4. èŽ·å–depend-onçš„Beanï¼Œå…ˆå¯¹å…¶è¿›è¡Œregisterå’Œå®žä¾‹åŒ–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ depend-on çš„å†…å®¹æ˜¯ä½¿ç”¨ @DependsOn æ³¨è§£æŒ‡å®šçš„BeanNameï¼ˆæ³¨è§£æ–¹å¼ï¼‰ 12345678910111213141516171819202122// èŽ·å¾—RootBeanDefinitionfinal RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);// æ£€æŸ¥mergeåŽçš„beanDefinitioncheckMergedBeanDefinition(mbd, beanName, args);// ç¡®ä¿å½“å‰beanä¾èµ–çš„beançš„åˆå§‹åŒ–ã€‚String[] dependsOn = mbd.getDependsOn();if (dependsOn != null) &#123; for (String dep : dependsOn) &#123; if (isDependent(beanName, dep)) &#123; // throw exception ... &#125; // å…ˆregistr ä¾èµ–çš„Bean registerDependentBean(dep, beanName); try &#123; // å¯¹æ¯ä¸€ä¸ªdepè¿›è¡Œå…ˆè¡Œçš„å®žä¾‹åŒ– getBean(dep); &#125; catch (NoSuchBeanDefinitionException ex) &#123; // throw exception ... &#125; &#125;&#125; 5.è°ƒç”¨createBeanåˆ›å»ºBeanå®žä¾‹åœ¨ä½¿ç”¨createBeanåˆ›å»ºBeanæ—¶ï¼Œä¼šé€šè¿‡ Object bean = resolveBeforeInstantiation(beanName, mbdToUse);æ¥å¤„ç†åˆå§‹åŒ–Beanå‰ç½®æ–¹æ³•è§¦å‘AOPçš„åŠŸèƒ½ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162protected Object resolveBeforeInstantiation(String beanName, RootBeanDefinition mbd) &#123; Object bean = null; if (!Boolean.FALSE.equals(mbd.beforeInstantiationResolved)) &#123; // Make sure bean class is actually resolved at this point. if (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) &#123; Class&lt;?&gt; targetType = determineTargetType(beanName, mbd); if (targetType != null) &#123; // æ‰§è¡Œå‰ç½®æ–¹æ³•ï¼ŒèŽ·å–ä»£ç†Bean bean = applyBeanPostProcessorsBeforeInstantiation(targetType, beanName); if (bean != null) &#123; bean = applyBeanPostProcessorsAfterInitialization(bean, beanName); &#125; &#125; &#125; mbd.beforeInstantiationResolved = (bean != null); &#125; return bean;&#125;protected Object applyBeanPostProcessorsBeforeInstantiation(Class&lt;?&gt; beanClass, String beanName) &#123; for (BeanPostProcessor bp : getBeanPostProcessors()) &#123; // ä½¿ç”¨ EnableAspectJAutoProxy æ³¨è§£ï¼Œå°†AbstractAutoProxyCreator import è¿›æ¥ï¼Œ // æ‰€ä»¥åœ¨è¿™é‡Œå¯ä»¥è°ƒç”¨ AbstractAutoProxyCreatoråŽç½®çš„å¤„ç†å™¨æ–¹æ³•ï¼Œæ¥å®žçŽ°AOPåŠŸèƒ½ if (bp instanceof InstantiationAwareBeanPostProcessor) &#123; InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp; Object result = ibp.postProcessBeforeInstantiation(beanClass, beanName); if (result != null) &#123; return result; &#125; &#125; &#125; return null;&#125;@Overridepublic Object postProcessBeforeInstantiation(Class&lt;?&gt; beanClass, String beanName) &#123; Object cacheKey = getCacheKey(beanClass, beanName); //èŽ·å¾—beanClass if (!StringUtils.hasLength(beanName) || !this.targetSourcedBeans.contains(beanName)) &#123; if (this.advisedBeans.containsKey(cacheKey)) &#123; return null; &#125; if (isInfrastructureClass(beanClass) || shouldSkip(beanClass, beanName)) &#123;// å¦‚æžœæ˜¯ä¸€ä¸ªåŸºç¡€è®¾æ–½çš„ç±» æˆ–è€…æ˜¯ä¸€ä¸ªoriginal instance this.advisedBeans.put(cacheKey, Boolean.FALSE); //æ·»åŠ åˆ°advisedBeansé‡Œé¢ return null; &#125; &#125; // å¦‚æžœæœ‰è‡ªå®šä¹‰çš„ TargetSource // æŠ‘åˆ¶ç›®æ ‡Beançš„ä¸å¿…è¦çš„é»˜è®¤å®žä¾‹åŒ– // TargetSourceå°†ä»¥è‡ªå®šä¹‰æ–¹å¼å¤„ç†ç›®æ ‡å®žä¾‹ã€‚ TargetSource targetSource = getCustomTargetSource(beanClass, beanName); //èŽ·å¾—targetSource if (targetSource != null) &#123; if (StringUtils.hasLength(beanName)) &#123; this.targetSourcedBeans.add(beanName); &#125; Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(beanClass, beanName, targetSource); // ç”Ÿæˆä»£ç† Object proxy = createProxy(beanClass, beanName, specificInterceptors, targetSource); //åˆ›å»ºä»£ç†ç±» this.proxyTypes.put(cacheKey, proxy.getClass()); // è¿”å›žç”Ÿæˆçš„ä»£ç†Bean return proxy; &#125; return null;&#125; å¦‚æžœå­˜åœ¨éœ€è¦åˆ›å»ºProxyä»£ç†Beanï¼Œåˆ™å…ˆåŽ»åˆ›å»ºä»£ç†Beanï¼Œåœ¨åˆ›å»ºå®ŒåŽï¼Œåˆ™ä¼šå¼€å§‹è°ƒç”¨ doCreateBean æ–¹æ³•åˆ›å»ºBeanå®žä¾‹ã€‚ æŽ¥ç€è°ƒç”¨ Object beanInstance = doCreateBean(beanName, mbdToUse, args); åˆ›å»ºå®žä¾‹ï¼Œå¹¶è¿”å›žä¸€ä¸ªObjectçš„ç±»åž‹çš„beanInstance doCreateBeanè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒé•¿ï¼Œå¤§è‡´èƒ½é€šè¿‡è¿™å‡ æ­¥å®Œæˆè¿™ä¸ªæ–¹æ³•ï¼› ä½¿ç”¨ createBeanInstance åˆ›å»ºä¸€ä¸ªåŒ…è£…Bean å…è®¸MergedBeanPostProcessorä½¿ç”¨åŽç½®æ–¹æ³•å¤„ç†åŒ…è£…åŽçš„Bean å¦‚æžœ allowCircularReferences å±žæ€§ä¸ºtrueï¼Œåˆ™å…ˆèŽ·å– è¾¾åˆ°è¿™ä¸ªBeançš„æ—©æœŸçš„ref ï¼Œç”¨æ¥ é˜²æ­¢Beanåœ¨ç”Ÿæˆæ—¶å¾ªçŽ¯å¼•ç”¨ çš„é—®é¢˜ï¼ŒåŽé¢ä¼šè¯¦ç»†è®²è¿™é‡Œæ˜¯å¦‚æžœèŽ·å–æ—©æœŸçš„refåº”ç”¨ï¼Œå’Œåˆæ˜¯å¦‚ä½•é˜²æ­¢Beançš„å¾ªçŽ¯åº”ç”¨çš„é—®é¢˜ã€‚ é€šè¿‡ populateBean æ–¹æ³•ä¸ºBeanè¿›è¡Œèµ‹å€¼ï¼ŒåŒ…æ‹¬ä¾èµ–ï¼ï¼ é€šè¿‡ initializeBean æ–¹æ³•ï¼Œæ‰§è¡Œå„ç§åˆå§‹åŒ–æ–¹æ³•å’Œå‰ã€åŽç½®æ–¹æ³•ã€‚ é€šè¿‡ä¸‰çº§ç¼“å­˜æœºåˆ¶ï¼Œç”¨æ¥é˜²æ­¢å‡ºçŽ°å¾ªçŽ¯å¼•ç”¨çš„é—®é¢˜ã€‚ æ³¨å†ŒBeanä¸ºä¸€æ¬¡æ€§çš„ createBeanInstance åˆ›å»ºä¸€ä¸ªåŒ…è£…Bean1234567891011121314151617181920212223242526272829303132333435363738394041424344protected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) &#123; //.....çœç•¥éƒ¨åˆ† // Shortcut when re-creating the same bean... /** * è¿™é‡ŒæŒ‡çš„ShortCutçš„å«ä¹‰æ˜¯å½“å¤šæ¬¡æž„å»ºåŒä¸€ä¸ª bean æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªShortcutï¼Œ * ä¹Ÿå°±æ˜¯è¯´ä¸åœ¨éœ€è¦æ¯æ¬¡æŽ¨æ–­åº”è¯¥ä½¿ç”¨å“ªç§æ–¹å¼æž„é€ bean * æ¯”å¦‚åœ¨å¤šæ¬¡æž„å»ºåŒä¸€ä¸ªprototypeç±»åž‹çš„ bean æ—¶ï¼Œå°±å¯ä»¥èµ°æ­¤å¤„çš„Shortcut * è¿™é‡Œçš„ resolved å’Œ autowireNecessary å°†ä¼šåœ¨ bean ç¬¬ä¸€æ¬¡å®žä¾‹åŒ–çš„è¿‡ç¨‹ä¸­è¢«è®¾ç½® */ boolean resolved = false; boolean autowireNecessary = false; if (args == null) &#123; synchronized (mbd.constructorArgumentLock) &#123; if (mbd.resolvedConstructorOrFactoryMethod != null) &#123; resolved = true; autowireNecessary = mbd.constructorArgumentsResolved; &#125; &#125; &#125; // å¦‚æžœå·²ç»åˆ›å»ºè¿‡äº† if (resolved) &#123; // å¦‚æžœä»¥è§£æžæž„é€ å‡½æ•° if (autowireNecessary) &#123; return autowireConstructor(beanName, mbd, null, null); &#125; else &#123; return instantiateBean(beanName, mbd); &#125; &#125; // Candidate constructors for autowiring? // å¦‚æžœæ˜¯é€šè¿‡æž„é€ å‡½æ•°æ¥è‡ªåŠ¨æ³¨å…¥çš„ Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName); if (ctors != null || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR || mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) &#123; return autowireConstructor(beanName, mbd, ctors, args); &#125; // Preferred constructors for default construction? ctors = mbd.getPreferredConstructors(); if (ctors != null) &#123; return autowireConstructor(beanName, mbd, ctors, null); &#125; // æ²¡æœ‰ç‰¹æ®Šå¤„ç†ï¼Œä½¿ç”¨æ— å‚æ•°æž„é€ å™¨ return instantiateBean(beanName, mbd);&#125; å¦‚æžœä½¿ç”¨é»˜è®¤çš„æ— å‚æ•°æž„é€ èµ·ï¼Œä¼šè°ƒç”¨beanInstance = getInstantiationStrategy().instantiate(mbd, beanName, parent); èŽ·å–ä½¿ç”¨åå°„ç”Ÿæˆçš„å®žä¾‹ã€‚ 1234567891011// æ£€æµ‹ bean é…ç½®ä¸­æ˜¯å¦é…ç½®äº† lookup-method æˆ– replace-method// å¦‚æžœæ²¡æœ‰ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„JDKä»£ç†ç”Ÿæˆå¯¹è±¡ï¼Œå¦åˆ™ä½¿ç”¨CGlibä»£ç†if (!bd.hasMethodOverrides()) &#123;// çœç•¥ä»£ç ã€‚ã€‚ã€‚ã€‚ // å®žä¾‹åŒ– return BeanUtils.instantiateClass(constructorToUse);&#125;else &#123; // å¿…é¡»ç”ŸæˆCGLIBå­ç±» return instantiateWithMethodInjection(bd, beanName, owner);&#125; çŸ¥é“æœ€åŽä½¿ç”¨Constructor.newInstanceåˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚ å…ˆç¼“å­˜æ—©æœŸçš„å®žä¾‹Springä¸­å­˜åœ¨ä¸‰å±‚ç¼“å­˜ï¼Œåˆ†åˆ«ä¸ºç¬¬ä¸€çº§çš„ singletonObjects ã€ç¬¬äºŒçº§çš„ earlySingletonObjects ã€ç¬¬ä¸‰çº§çš„singletonFactoriesã€‚ 12345678/** Cache of singleton objects: bean name to bean instance. */private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256);/** Cache of singleton factories: bean name to ObjectFactory. */private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;&gt;(16);/** Cache of early singleton objects: bean name to bean instance. */private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;&gt;(16); é‚£ä¹ˆï¼ŒSpringå¦‚ä½•ä¾é è¿™ä¸‰çº§ç¼“å­˜æ¥é˜²æ­¢å¾ªçŽ¯å¼•ç”¨ï¼ˆcircular referencesï¼‰çš„ä½œç”¨çš„å‘¢ï¼Ÿå…ˆé€šè¿‡ä¸‹é¢çš„å›¾ç‰‡æ¥ç®€å•äº†è§£ä¸‹ï¼Œå½“å‘ç”Ÿå¾ªçŽ¯å¼•ç”¨æ—¶ï¼ŒSpringå¦‚ä½•ä½¿ç”¨ä¸‰çº§ç¼“å­˜çš„ã€‚ å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå¯¹è±¡Aä¾èµ–äºŽå¯¹è±¡Bï¼Œè€Œå¯¹è±¡Bä¾èµ–å¯¹è±¡Açš„æƒ…å†µã€‚ä¸‹é¢æ ¹æ®å›¾ä¸­å„èŠ‚ç‚¹æƒ…å†µæ¥å…·ä½“åˆ†æžä»£ç çš„å®žçŽ°ï¼š 1. å®žä¾‹åŒ–Aï¼Œå‘çŽ°ä¾èµ–Båœ¨åˆå§‹åŒ–Açš„è¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨ populateBean æ–¹æ³•è¿›è¡Œå±žæ€§çš„èµ‹å€¼ï¼Œå…¶ä¸­ AutoWired çš„ç±»åž‹æ¥åˆ†åˆ«å¤„ç†ï¼ˆBy Name è¿˜æ˜¯ By Typeï¼‰,ä½†ä¸ç®¡æ˜¯å“ªä¸ªç±»åž‹ï¼Œæœ€åŽéƒ½ä¼šä½¿ç”¨ getBean æ¥å…ˆèŽ·å–ä¾èµ–ã€‚ 2. èŽ·å–Bï¼Œå°†Aæ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­å…¶å®žåœ¨è¿›è¡ŒAçš„å±žæ€§èµ‹å€¼å‰ï¼Œå°±å·²ç»é€šè¿‡ doCreateBean æ–¹æ³•ä¸­çš„ addSingletonFactory æ–¹æ³•å°†Aæ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­ï¼š 1234567891011121314151617181920boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp; isSingletonCurrentlyInCreation(beanName)); // å¦‚æžœ allowCircularReferences ä¸ºtrueif (earlySingletonExposure) &#123; // log..... // æ”¾åˆ°ç¬¬ä¸‰çº§çš„singletonFactoryé‡Œ addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));&#125;// ç¬¬ä¸‰çº§ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯SingleFactoryprotected void addSingletonFactory(String beanName, ObjectFactory&lt;?&gt; singletonFactory) &#123; synchronized (this.singletonObjects) &#123; // å¦‚æžœå¯¹è±¡æ²¡æœ‰ç”Ÿæˆè¿‡ if (!this.singletonObjects.containsKey(beanName)) &#123; // æ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­ï¼ŒåŒæ—¶å¦‚æžœäºŒçº§ç¼“å­˜ä¸­å­˜åœ¨ï¼Œç§»é™¤æŽ‰ this.singletonFactories.put(beanName, singletonFactory); this.earlySingletonObjects.remove(beanName); this.registeredSingletons.add(beanName); &#125; &#125;&#125; 3. å®žä¾‹åŒ–Bï¼Œå‘çŽ°ä¾èµ–Aåœ¨ä¸Šä¸€æ­¥ä¸­ï¼ŒAä¾èµ–Bï¼Œä¼šè°ƒç”¨getBeanå…ˆåŽ»èŽ·å–Bï¼Œä½†åŒæ ·åœ¨doCreateBean æ–¹æ³•ä¸­çš„ populateBean æ–¹æ³•ä¸­åŒæ ·ä¼šè°ƒç”¨ getBean å…ˆåŽ»èŽ·å–ä¾èµ–Aã€‚ 123456Object sharedInstance = getSingleton(beanName);if (sharedInstance != null &amp;&amp; args == null) &#123;// log....// é€šè¿‡getObjectForBeanInstanceèŽ·å–Beanï¼Œå®Œæˆå®žä¾‹åŒ– bean = getObjectForBeanInstance(sharedInstance, name, beanName, null);&#125; é€šè¿‡getSingletonæ–¹æ³•ä»Žä¸‰çº§ç¼“å­˜èŽ·å–beanï¼Œå¦‚æžœæˆåŠŸçš„åœ¨ç¬¬ä¸‰çº§ç¼“å­˜ä¸­æ‰¾åˆ°Beanï¼Œåˆ™ç§»é™¤ç¬¬ä¸‰çº§ç¼“å­˜ä¸­çš„Beanï¼Œå¹¶æ”¾åˆ°äºŒçº§ç¼“å­˜ä¸­ã€‚ 123456789101112131415161718protected Object getSingleton(String beanName, boolean allowEarlyReference) &#123; Object singletonObject = this.singletonObjects.get(beanName); if (singletonObject == null &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123; synchronized (this.singletonObjects) &#123; singletonObject = this.earlySingletonObjects.get(beanName); if (singletonObject == null &amp;&amp; allowEarlyReference) &#123; ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName); if (singletonFactory != null) &#123; singletonObject = singletonFactory.getObject(); // å¦‚æžœä¸‰çº§ç¼“å­˜ä¸­æœ‰beanï¼Œåˆ™æ”¾åˆ°äºŒçº§ç¼“å­˜ä¸­ this.earlySingletonObjects.put(beanName, singletonObject); this.singletonFactories.remove(beanName); &#125; &#125; &#125; &#125; return singletonObject;&#125; 4. å®žä¾‹åŒ–å®Œæˆï¼Œå°†Bæ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­åœ¨è°ƒç”¨doGetBeanæ–¹æ³•æ—¶ï¼Œä¼šé€šè¿‡ getSingletonæ–¹æ³•ä¸­çš„addSingletonå°†å®žä¾‹æ·»åŠ åˆ°ä¸€çº§ç¼“å­˜ä¸­ï¼š 12345678sharedInstance = getSingleton(beanName, () -&gt; &#123; try &#123; // å‡†å¤‡å¥½åŽï¼Œè¿›è¡Œåˆ›å»ºå½“å‰Beanå®žä¾‹ return createBean(beanName, mbd, args); &#125; catch (BeansException ex) &#123; &#125;&#125;); åœ¨getSingletonä¸­è°ƒç”¨äº†addSingleton(beanName, singletonObject),å°†å®Œæˆçš„å®žä¾‹æ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€‚ 12345678protected void addSingleton(String beanName, Object singletonObject) &#123; synchronized (this.singletonObjects) &#123; this.singletonObjects.put(beanName, singletonObject); this.singletonFactories.remove(beanName); this.earlySingletonObjects.remove(beanName); this.registeredSingletons.add(beanName); &#125;&#125; 5. è¿”å›žAçš„åˆ›å»ºè¿‡ç¨‹ï¼Œç»§ç»­åˆ›å»ºAæœ€åŽåˆ›å»ºå®ŒæˆAåŽï¼ŒåŒæ ·ä¼šå°†Aæ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€‚è‡³æ­¤å¯¹è±¡Aï¼Œå¯¹è±¡Bå…¨éƒ¨åˆ›å»ºå®Œæˆã€‚åˆ©ç”¨äº†ä¸‰çº§ç¼“å­˜æœºåˆ¶é¿å…äº†å¾ªçŽ¯å¼•ç”¨ã€‚ populateBean æ‰§è¡ŒBeançš„åˆå§‹åŒ–åœ¨ä¸Šä¸€èŠ‚ä¸­æåˆ°äº†ï¼Œåˆå§‹åŒ–å¯¹è±¡æ—¶ï¼Œéœ€è¦è°ƒç”¨populateBean(beanName, mbd, instanceWrapper)è¯¥æ–¹æ³•æ¥è¾¾åˆ°å±žæ€§å€¼çš„å¡«å……ã€‚ å¿½ç•¥ BeanPostProcessoråŽç½®å¤„ç†å™¨ï¼Œé‚£ä¹ˆå®žé™…ä¸Šæ­¥éª¤æ¯”è¾ƒç®€å•æ˜Žäº†ï¼š å¦‚æžœä¸å­˜åœ¨å±žæ€§å€¼ï¼Œåˆ™ç›´æŽ¥è¿”å›žï¼Œè·³è¿‡è¿™ä¸ªæ–¹æ³•ã€‚ å¦‚æžœå­˜åœ¨ï¼Œå…ˆèŽ·å¾—æ‰€æœ‰çš„å±žæ€§å€¼ï¼Œä¾æ®AutoWiredå±žæ€§ï¼Œå°†ä¾èµ–é¡¹æ³¨å…¥åˆ°å®¹å™¨ä¸­ æœ€åŽè¿›è¡ŒçœŸæ­£çš„å±žæ€§å¡«å…… 1. æ£€æŸ¥æ˜¯å¦å­˜åœ¨å±žæ€§12345678910if (bw == null) &#123; if (mbd.hasPropertyValues()) &#123; throw new BeanCreationException( mbd.getResourceDescription(), beanName, "Cannot apply property values to null instance"); &#125; else &#123; // å¦‚æžœæ²¡æœ‰ç›´æŽ¥è·³è¿‡ return; &#125;&#125; 2.ä¾æ®ByNameè¿˜æ˜¯ByTypeè¿›è¡Œå±žæ€§çš„æ³¨å…¥123456789101112131415161718// èŽ·å¾—å±žæ€§PropertyValues pvs = (mbd.hasPropertyValues() ? mbd.getPropertyValues() : null);// èŽ·å¾—autowiredç±»åž‹ï¼ˆby type è¿˜æ˜¯ by nameï¼‰æ ¸å¿ƒæ˜¯pvs.add(propertyName, bean); èŽ·å¾—é€‚å½“çš„beanå½“é“pvsä¸­int resolvedAutowireMode = mbd.getResolvedAutowireMode();if (resolvedAutowireMode == AUTOWIRE_BY_NAME || resolvedAutowireMode == AUTOWIRE_BY_TYPE) &#123; MutablePropertyValues newPvs = new MutablePropertyValues(pvs); // å¦‚æžœé€‚ç”¨ï¼ŒæŒ‰åç§°æ·»åŠ åŸºäºŽè‡ªåŠ¨è£…é…çš„å±žæ€§å€¼ã€‚ if (resolvedAutowireMode == AUTOWIRE_BY_NAME) &#123; autowireByName(beanName, mbd, bw, newPvs); &#125; // å¦‚æžœé€‚ç”¨ï¼ŒæŒ‰ç±»åž‹æ·»åŠ åŸºäºŽè‡ªåŠ¨è£…é…çš„å±žæ€§å€¼ã€‚. if (resolvedAutowireMode == AUTOWIRE_BY_TYPE) &#123; // å…¶ä¸­resolveDependencyåŒ…å«JSR330ä¸­çš„Injectæ–¹æ³• autowireByType(beanName, mbd, bw, newPvs); &#125; // ä½†æ˜¯ä¸ç®¡æ˜¯ByTypeè¿˜æ˜¯ByNameæœ€åŽéƒ½æ˜¯è°ƒç”¨getBeanæ–¹æ³•å…ˆèŽ·å–å±žæ€§ä¾èµ–Bean pvs = newPvs;&#125; æ ¹æ® resolvedAutowireMode çš„å€¼çš„ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„è£…é…æ–¹å¼ æŒ‰åç§°æ³¨å…¥ï¼Œä½¿ç”¨@Autowiredé»˜è®¤çš„æ–¹å¼ æŒ‰ç±»åž‹æ³¨å…¥ï¼Œä½¿ç”¨@Resourceæˆ–è€…ä½¿ç”¨JSR330æ ‡å‡†ä¸­çš„@Injectæ³¨è§£çš„é»˜è®¤æ–¹å¼ ä½†æ˜¯ï¼Œä¸ç®¡ä¾èµ–å“ªç§æ–¹å¼è¿›è¡Œè£…é…ï¼Œæœ€åŽéƒ½ä¼šä½¿ç”¨getBeanæ¥èŽ·å–å±žæ€§ä¾èµ–ï¼Œè£…é…åˆ°å®¹å™¨ä¸­ï¼Œå¹¶å°†å€¼æ”¾åˆ° newPvs ç­‰å¾…å¡«å……ã€‚ 3.å±žæ€§å¡«å……æœ€åŽé€šè¿‡ä½¿ç”¨ applyPropertyValues æ–¹æ³•å®žçŽ°å±žæ€§çš„å¡«å……ï¼š ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š å¦‚æžœpvsæ˜¯ç©ºçš„ï¼Œåˆ™ç›´æŽ¥è¿”å›ž å¦åˆ™åˆ›å»ºä¸€ä¸ªdeep copyï¼Œç”¨äºŽè§£å†³æ‰€æœ‰å¯¹å€¼çš„å¼•ç”¨ï¼Œå¯¹æœªè¢«è§£æžçš„å…ˆè§£æž&amp;&amp;å·²è§£æžçš„ç›´æŽ¥åŠ å…¥deepCopyä¸­ã€‚ èŽ·å–åˆ° deepCopy åŽï¼Œä½¿ç”¨ setPropertyValues æ·»åŠ åˆ°BeanWrapperä¸­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596protected void applyPropertyValues(String beanName, BeanDefinition mbd, BeanWrapper bw, PropertyValues pvs) &#123; // å¦‚æžœpvså†…å®¹æ˜¯ç©ºçš„ï¼Œåˆ™ç›´æŽ¥return if (pvs.isEmpty()) &#123; return; &#125; // è®¾ç½® SecurityContextProvider if (System.getSecurityManager() != null &amp;&amp; bw instanceof BeanWrapperImpl) &#123; ((BeanWrapperImpl) bw).setSecurityContext(getAccessControlContext()); &#125; MutablePropertyValues mpvs = null; List&lt;PropertyValue&gt; original; if (pvs instanceof MutablePropertyValues) &#123; mpvs = (MutablePropertyValues) pvs; // å·²ç»æ˜¯è½¬åŒ–è¿‡çš„ if (mpvs.isConverted()) &#123; // Shortcut: use the pre-converted values as-is. // ç…§åŽŸæ ·ä½¿ç”¨é¢„å…ˆè½¬æ¢çš„å€¼ try &#123; bw.setPropertyValues(mpvs); return; &#125; catch (BeansException ex) &#123; &#125; &#125; original = mpvs.getPropertyValueList(); // èŽ·å–ä¸€ä¸ªList&lt;PropertyValue&gt; å±žæ€§ç»„ &#125; else &#123; original = Arrays.asList(pvs.getPropertyValues()); &#125; // èŽ·å¾— BeanDefinitionValueResolver TypeConverter converter = getCustomTypeConverter(); if (converter == null) &#123; converter = bw; &#125; BeanDefinitionValueResolver valueResolver = new BeanDefinitionValueResolver(this, beanName, mbd, converter); // Create a deep copy, resolving any references for values. // åˆ›å»ºä¸€ä¸ªæ·±å±‚å‰¯æœ¬ï¼Œä»¥è§£å†³æ‰€æœ‰å¯¹å€¼çš„å¼•ç”¨ã€‚å¯¹æœªè¢«è§£æžçš„å…ˆè§£æž/å·²è§£æžçš„ç›´æŽ¥åŠ å…¥deepCopyä¸­ List&lt;PropertyValue&gt; deepCopy = new ArrayList&lt;&gt;(original.size()); boolean resolveNecessary = false; for (PropertyValue pv : original) &#123; if (pv.isConverted()) &#123; // å¦‚æžœå·²è½¬åŒ–ï¼Œç›´æŽ¥æ·»åŠ åˆ°deepCopyä¸­ deepCopy.add(pv); &#125; else &#123; // èŽ·å¾—å±žæ€§åå’Œå±žæ€§å€¼ String propertyName = pv.getName(); Object originalValue = pv.getValue(); // æ˜¯å¦æ˜¯AutowiredPropertyMarker if (originalValue == AutowiredPropertyMarker.INSTANCE) &#123; //èŽ·å–åº”ç”¨äºŽå†™å…¥å±žæ€§å€¼çš„æ–¹æ³• Method writeMethod = bw.getPropertyDescriptor(propertyName).getWriteMethod(); if (writeMethod == null) &#123; throw new IllegalArgumentException("Autowire marker for property without write method: " + pv); &#125; originalValue = new DependencyDescriptor(new MethodParameter(writeMethod, 0), true); &#125; // ä½¿ç”¨valueResolverè§£æžå±žæ€§å€¼,ç»™å®šä¸€ä¸ªPropertyValueï¼Œè¿”å›žä¸€ä¸ªå€¼ï¼Œå¦‚æœ‰å¿…è¦ï¼Œè§£æžå·¥åŽ‚ä¸­å¯¹å…¶ä»–beançš„ä»»ä½•å¼•ç”¨ Object resolvedValue = valueResolver.resolveValueIfNecessary(pv, originalValue); Object convertedValue = resolvedValue; boolean convertible = bw.isWritableProperty(propertyName) &amp;&amp; !PropertyAccessorUtils.isNestedOrIndexedProperty(propertyName); if (convertible) &#123; // å¦‚æžœå¯è½¬åŒ–ï¼Œè½¬åŒ–è¿™ä¸ªå±žæ€§ convertedValue = convertForProperty(resolvedValue, propertyName, bw, converter); &#125; // å¯èƒ½å°†è½¬æ¢åŽçš„å€¼å­˜å‚¨åœ¨åˆå¹¶çš„beanå®šä¹‰ä¸­ï¼Œé¿å…å¯¹æ¯ä¸ªåˆ›å»ºçš„beanå®žä¾‹è¿›è¡Œé‡æ–°è½¬æ¢ if (resolvedValue == originalValue) &#123; if (convertible) &#123; pv.setConvertedValue(convertedValue); &#125; deepCopy.add(pv); &#125; else if (convertible &amp;&amp; originalValue instanceof TypedStringValue &amp;&amp; !((TypedStringValue) originalValue).isDynamic() &amp;&amp; !(convertedValue instanceof Collection || ObjectUtils.isArray(convertedValue))) &#123; pv.setConvertedValue(convertedValue); deepCopy.add(pv); &#125; else &#123; resolveNecessary = true; deepCopy.add(new PropertyValue(pv, convertedValue)); &#125; &#125; &#125; if (mpvs != null &amp;&amp; !resolveNecessary) &#123; // è®¾ç½®å·²è½¬åŒ–å±žæ€§ mpvs.setConverted(); &#125; try &#123; // æ”¾åˆ°PropertyValuesé‡Œé¢ bw.setPropertyValues(new MutablePropertyValues(deepCopy)); &#125;&#125; initializeBean åˆå§‹åŒ–Beanåœ¨ä½¿ç”¨populateBeanåŽï¼Œè°ƒç”¨initializeBeanæ–¹æ³•è¿›è¡Œbeançš„initï¼Œåœ¨initæ–¹æ³•å†…éƒ¨ï¼Œå¯åˆ†ä¸ºä¸€ä¸‹å‡ éƒ¨åˆ†è°ƒç”¨ invokeAwareMethods æ–¹æ³•ï¼Œè®¾ç½®Awareå±žæ€§ applyBeanPostProcessorsBeforeInitialization æ–¹æ³•ï¼Œè°ƒç”¨ BeanProcessorä¸­çš„Beanåˆå§‹åŒ–å‰çš„åŽç½®æ–¹æ³• invokeInitMethods æ–¹æ³•ï¼Œæ¿€æ´»è‡ªå®šä¹‰çš„initæ–¹æ³• æ‰§è¡ŒBeanProcessorä¸­çš„åˆå§‹åŒ–åŽçš„åŽç½®æ–¹æ³• 1. invokeAwareMethodså¯»æ‰¾æ˜¯å¦æ»¡è¶³ç‰¹å®šçš„æ¡ä»¶ï¼Œå¦‚æžœæ»¡è¶³åˆ™è¿›è¡Œç›¸å…³å±žæ€§çš„å¡«å…… 123456789101112131415161718private void invokeAwareMethods(final String beanName, final Object bean) &#123; if (bean instanceof Aware) &#123; // å¦‚æžœæ˜¯ BeanNameAwareï¼Œè®¾ç½®BeanName if (bean instanceof BeanNameAware) &#123; ((BeanNameAware) bean).setBeanName(beanName); &#125; // å¦‚æžœæ˜¯ BeanClassLoaderAwareï¼Œè®¾ç½®classloader if (bean instanceof BeanClassLoaderAware) &#123; ClassLoader bcl = getBeanClassLoader(); if (bcl != null) &#123; ((BeanClassLoaderAware) bean).setBeanClassLoader(bcl); &#125; &#125; if (bean instanceof BeanFactoryAware) &#123; ((BeanFactoryAware) bean).setBeanFactory(AbstractAutowireCapableBeanFactory.this); &#125; &#125;&#125; 2. applyBeanPostProcessorsBeforeInitializationå¾ªçŽ¯å®¹å™¨ä¸­æ¯ä¸€ä¸ªBeanPostProcessorï¼Œæ‰§è¡ŒBeanPostProcessorçš„postProcessBeforeInitializationæ–¹æ³•ã€‚ 123456789101112public Object applyBeanPostProcessorsBeforeInitialization(Object existingBean, String beanName) throws BeansException &#123; Object result = existingBean; for (BeanPostProcessor processor : getBeanPostProcessors()) &#123; Object current = processor.postProcessBeforeInitialization(result, beanName); if (current == null) &#123; return result; &#125; result = current; &#125; return result;&#125; 3.invokeInitMethods æ‰§è¡Œinitæ–¹æ³•å¦‚æžœæ˜¯isInitializingBeanåˆ™å…ˆä¼šæ‰§è¡Œè‡ªå·±çš„å†…ç½®æ–¹æ³•afterPropertiesSetã€‚å¦‚æžœåˆ¶å®šäº†initMethodï¼Œé‚£ä¹ˆåŽç»­ä¼šé€šè¿‡åå°„æ‰§è¡Œè¿™ä¸ªæ–¹æ³• 123456789101112131415161718192021222324252627protected void invokeInitMethods(String beanName, final Object bean, @Nullable RootBeanDefinition mbd) throws Throwable &#123; boolean isInitializingBean = (bean instanceof InitializingBean); if (isInitializingBean &amp;&amp; (mbd == null || !mbd.isExternallyManagedInitMethod("afterPropertiesSet"))) &#123; if (System.getSecurityManager() != null) &#123; try &#123; AccessController.doPrivileged((PrivilegedExceptionAction&lt;Object&gt;) () -&gt; &#123; ((InitializingBean) bean).afterPropertiesSet(); return null; &#125;, getAccessControlContext()); &#125; &#125; else &#123; ((InitializingBean) bean).afterPropertiesSet(); &#125; &#125; if (mbd != null &amp;&amp; bean.getClass() != NullBean.class) &#123; String initMethodName = mbd.getInitMethodName(); if (StringUtils.hasLength(initMethodName) &amp;&amp; !(isInitializingBean &amp;&amp; "afterPropertiesSet".equals(initMethodName)) &amp;&amp; !mbd.isExternallyManagedInitMethod(initMethodName)) &#123; invokeCustomInitMethod(beanName, bean, mbd); &#125; &#125;&#125; 4.applyBeanPostProcessorsAfterInitializationå¾ªçŽ¯å®¹å™¨ä¸­æ¯ä¸€ä¸ªBeanPostProcessorï¼Œæ‰§è¡ŒBeanPostProcessorçš„ postProcessAfterInitialization æ–¹æ³•ã€‚ è‡³æ­¤Beançš„å®žä¾‹åŒ–è¿‡ç¨‹å°±å¤§è‡´å®Œæˆäº†ã€‚]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springçš„Beançš„æ³¨å†Œ]]></title>
    <url>%2F2019%2F12%2F20%2FSpring%E4%BB%8E%E9%9B%B6%E5%AD%A6%E8%B5%B7%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Beançš„æ³¨å†Œåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°äº†åœ¨ä½¿ç”¨invokeBeanFactoryPostProcessors(beanFactory) æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº† ConfigurationClassPostProcessor ä¸­çš„ postProcessBeanDefinitionRegistry æ–¹æ³•ï¼Œå®žçŽ°äº†å¯¹configurationé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å¾—åˆ°åŠ è½½å’Œè§£æžã€‚å®Œæˆå¯¹æ ‡æ³¨ä¸ºBeançš„æ–¹æ³•æ³¨å†Œã€Œregistã€åˆ°å®¹å™¨ä¸­ã€‚ ä¸‹é¢å°±é’ˆå¯¹è¿™ä¸€æ³¨å†Œé…ç½®æ–‡ä»¶å†…çš„Beançš„è¿‡ç¨‹è¿›è¡Œæºç çš„åˆ†æžï¼š ConfigurationClassPostProcessoråœ¨ invokeBeanFactoryPostProcessor æ–¹æ³•ä¸­ï¼Œå¾ªçŽ¯è°ƒç”¨ç±»ä¸­çš„åŽç½®æ–¹æ³• postProcessBeanDefinitionRegistry ,å…¶ä¸­åŒ…æ‹¬äº† ConfigurationClassPostProcessor ç±»ã€‚æ ¹æ®åå­—ä¹Ÿèƒ½çœ‹å‡ºè¿™ä¸ªç±»æ˜¯é…ç½®æ–‡ä»¶ç±»çš„åŽç½®å¤„ç†ç±»ã€‚é‚£ä¹ˆå°±ä¹‹é—´çœ‹ä»£ç ï¼Œäº†è§£é…ç½®æ–‡ä»¶çš„åŽç½®å¤„ç†å™¨éƒ½åšäº†äº›ä»€ä¹ˆã€‚ 12345678910111213public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) &#123; int registryId = System.identityHashCode(registry); if (this.registriesPostProcessed.contains(registryId)) &#123; throw new IllegalStateException( "postProcessBeanDefinitionRegistry already called on this post-processor against " + registry); &#125; if (this.factoriesPostProcessed.contains(registryId)) &#123; throw new IllegalStateException( "postProcessBeanFactory already called on this post-processor against " + registry); &#125; this.registriesPostProcessed.add(registryId); processConfigBeanDefinitions(registry);&#125; ä¸‹é¢å¯¹ processConfigBeanDefinitions ä¸­çš„æ–¹æ³•ä¸€æ­¥ä¸€æ­¥çœ‹ï¼š ä½¿ç”¨processConfigBeanDefinitionsè§£æžæ³¨å†ŒBean123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293public void processConfigBeanDefinitions(BeanDefinitionRegistry registry) &#123; List&lt;BeanDefinitionHolder&gt; configCandidates = new ArrayList&lt;&gt;(); // èŽ·å¾—æ‰€æœ‰çš„å·²ç»æ³¨å†Œçš„Beanï¼Œå…¶ä¸­åŒ…æ‹¬Springå†…ç½®çš„Processorï¼Œ // å½“ç„¶ä¹ŸåŒ…æ‹¬è‡ªå·±å†™çš„@Configurationç±» String[] candidateNames = registry.getBeanDefinitionNames(); // å¯¹æ¯ä¸ªå€™é€‰çš„Beanè¿›è¡Œç­›é€‰ for (String beanName : candidateNames) &#123; BeanDefinition beanDef = registry.getBeanDefinition(beanName); if (beanDef.getAttribute(ConfigurationClassUtils.CONFIGURATION_CLASS_ATTRIBUTE) != null) &#123; if (logger.isDebugEnabled()) &#123; logger.debug("Bean definition has already been processed as a configuration class: " + beanDef); &#125; &#125; else if (ConfigurationClassUtils.checkConfigurationClassCandidate(beanDef, this.metadataReaderFactory)) &#123; // å¦‚æžœæ˜¯ä½¿ç”¨AnnotatedBeanDefinitionå®šä¹‰ï¼ˆ@Configurationï¼‰,å¦‚æžœæ˜¯ // è®¾ç½®ä¸€äº›å±žæ€§å¦‚æ ¹æ®proxyBeanMethodsæŒ‡å®šç”¨æ¥é¿å…è¿è¡Œæ—¶åˆ›å»ºCGLIBçš„å­ç±»ç­‰ç­‰ã€‚ã€‚ configCandidates.add(new BeanDefinitionHolder(beanDef, beanName)); &#125; &#125; // Return immediately if no @Configuration classes were found if (configCandidates.isEmpty()) &#123; return; &#125; // å¯¹ç»™å®šçš„Orderï¼ˆ@Orderï¼‰è¿›è¡ŒæŽ’åº configCandidates.sort((bd1, bd2) -&gt; &#123; int i1 = ConfigurationClassUtils.getOrder(bd1.getBeanDefinition()); int i2 = ConfigurationClassUtils.getOrder(bd2.getBeanDefinition()); return Integer.compare(i1, i2); &#125;); //è®¾ç½®Beançš„åç§°çš„ç”Ÿæˆç­–ç•¥ SingletonBeanRegistry sbr = null; if (registry instanceof SingletonBeanRegistry) &#123; sbr = (SingletonBeanRegistry) registry; if (!this.localBeanNameGeneratorSet) &#123; // å¦‚æžœæ²¡æœ‰è®¾ç½®é»˜è®¤çš„åç§°ç”Ÿæˆç­–ç•¥ BeanNameGenerator generator = (BeanNameGenerator) sbr.getSingleton( AnnotationConfigUtils.CONFIGURATION_BEAN_NAME_GENERATOR); if (generator != null) &#123; this.componentScanBeanNameGenerator = generator; this.importBeanNameGenerator = generator; &#125; &#125; &#125; if (this.environment == null) &#123; this.environment = new StandardEnvironment(); &#125; // è§£æžæ‰€æœ‰çš„@Configurationç±»ï¼Œé¦–å…ˆå…ˆå£°æ˜Žå‡ºä¸€ä¸ªè§£æžå™¨ ConfigurationClassParser parser = new ConfigurationClassParser( this.metadataReaderFactory, this.problemReporter, this.environment, this.resourceLoader, this.componentScanBeanNameGenerator, registry); Set&lt;BeanDefinitionHolder&gt; candidates = new LinkedHashSet&lt;&gt;(configCandidates); Set&lt;ConfigurationClass&gt; alreadyParsed = new HashSet&lt;&gt;(configCandidates.size()); do &#123; // ä½¿ç”¨è§£æžå™¨å¯¹æ‰€æœ‰çš„é…ç½®ç±»è¿›è¡Œè§£æžï¼Œåœ¨è§£æžçš„è¿‡ç¨‹ä¸­ // å®Œæˆå¯¹Beançš„æ³¨å†Œ parser.parse(candidates); // è¿›è¡ŒéªŒè¯ parser.validate(); // é€šè¿‡parserå¤„ç†å¾—åˆ°äº†é…ç½®æ–‡ä»¶ä¸‹çš„Bean Set&lt;ConfigurationClass&gt; configClasses = new LinkedHashSet&lt;&gt;(parser.getConfigurationClasses()); // ç§»é™¤æ‰€æœ‰çš„å·²ç»è§£æžè¿‡çš„Bean' configClasses.removeAll(alreadyParsed); // Read the model and create bean definitions based on its content if (this.reader == null) &#123; this.reader = new ConfigurationClassBeanDefinitionReader( registry, this.sourceExtractor, this.resourceLoader, this.environment, this.importBeanNameGenerator, parser.getImportRegistry()); &#125; this.reader.loadBeanDefinitions(configClasses); // å¯¹æ‰€æœ‰å·²ç»è§£æžçš„Beanè¿›è¡Œæ ‡è®° alreadyParsed.addAll(configClasses); candidates.clear(); // å¦‚æžœregistryä¸­çš„Beanå®šä¹‰æ•°é‡ å¤§äºŽ candidateNames çš„æ•°é‡ï¼Œè¯´æ˜Žåœ¨Beanæ³¨å†Œè¿‡ç¨‹ä¸­ // äº§ç”Ÿäº†å…¶ä»–Beanï¼Œé‡å¤è¿‡ç¨‹æ³¨å†Œè¿™ä¸ªBean if (registry.getBeanDefinitionCount() &gt; candidateNames.length) &#123; // ã€‚ã€‚ã€‚ã€‚ã€‚çœç•¥ &#125; &#125; while (!candidates.isEmpty()); // å°†ImportRegistryæ³¨å†Œä¸ºBeanï¼Œä»¥æ”¯æŒImportAware @Configurationç±» if (sbr != null &amp;&amp; !sbr.containsSingleton(IMPORT_REGISTRY_BEAN_NAME)) &#123; sbr.registerSingleton(IMPORT_REGISTRY_BEAN_NAME, parser.getImportRegistry()); &#125;&#125; ä¸Šè¿°ä»£ç å®Œæˆäº†çš„è¿‡ç¨‹å¤§è‡´åˆ†ä¸ºè¿™å‡ æ­¥ æ‰¾å‡ºConfigé…ç½®ç±»ï¼ŒåŒ…æ‹¬ä½¿ç”¨@Configurationæ³¨è§£æ ‡æ³¨çš„é…ç½®ç±» æ ¹æ®@Orderè¿›è¡Œè¿›è¡Œé¡ºåºçš„è°ƒæ•´ è§£æžæ‰€æœ‰çš„@Configurationå†…çš„Beanï¼Œå®Œæˆå¯¹é…ç½®ç±»ä¸­æ‰€æœ‰ Beançš„æ³¨å†Œã€‚ éªŒè¯å¹¶è¿›è¡Œæ ‡è®°Beanå·²ç»è¢«è§£æžæ³¨å†Œ å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ç¬¬3æ­¥ï¼Œéœ€è¦æ‰¾å‡ºBeanï¼Œå¹¶è¿›è¡Œæ³¨å†Œ parseæ–¹æ³•è§£æžå¹¶å®Œæˆæ³¨å†ŒBeançš„ã€‚12345678910111213141516171819public void parse(Set&lt;BeanDefinitionHolder&gt; configCandidates) &#123; for (BeanDefinitionHolder holder : configCandidates) &#123; // èŽ·å¾—é…ç½®ç±»çš„å®šä¹‰ä¿¡æ¯ BeanDefinition bd = holder.getBeanDefinition(); try &#123; // å¦‚æžœæ˜¯ä½¿ç”¨æ³¨è§£æ–¹å¼é…ç½®ç±» if (bd instanceof AnnotatedBeanDefinition) &#123; parse(((AnnotatedBeanDefinition) bd).getMetadata(), holder.getBeanName()); &#125; // else if ... if .... etc &#125; // etc .... &#125; this.deferredImportSelectorHandler.process();&#125;protected final void parse(AnnotationMetadata metadata, String beanName) throws IOException &#123; processConfigurationClass(new ConfigurationClass(metadata, beanName));&#125; å¦‚æžœä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡Œé…ç½®ç±»çš„é…ç½®çš„æƒ…å†µï¼Œæœ€åŽä¼šè°ƒç”¨ processConfigurationClass æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ 1234567891011121314151617181920protected void processConfigurationClass(ConfigurationClass configClass) throws IOException &#123; // æ ¹æ®Contionalæ³¨è§£æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è·³è¿‡é…ç½®ç±»çš„å¤„ç† // å¦‚æžœéœ€è¦è·³è¿‡ï¼Œåˆ™ç›´æŽ¥è¿›è¡Œreturn if (this.conditionEvaluator.shouldSkip(configClass.getMetadata(), ConfigurationPhase.PARSE_CONFIGURATION)) &#123; return; &#125; ConfigurationClass existingClass = this.configurationClasses.get(configClass); if (existingClass != null) &#123; //å¦‚æžœå·²ç»å­˜åœ¨çš„æƒ…å†µ &#125; // é€’å½’å¤„ç†é…ç½®ç±»åŠå…¶è¶…ç±»å±‚æ¬¡ç»“æž„ SourceClass sourceClass = asSourceClass(configClass); do &#123; sourceClass = doProcessConfigurationClass(configClass, sourceClass); &#125; while (sourceClass != null); this.configurationClasses.put(configClass, configClass);&#125; æœ€åŽä¼šé€’å½’ä½¿ç”¨ doProcessConfigurationClass è¿›è¡Œå¤„ç†é…ç½®ç±»å’Œå…¶è¶…ç±». 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061protected final SourceClass doProcessConfigurationClass( ConfigurationClass configClass, SourceClass sourceClass) throws IOException &#123; //å¦‚æžœåœ¨é…ç½®æ–‡ä»¶ä¸Šæœ‰æ ‡æ³¨Componentæ³¨è§£ï¼Œåˆ™ä¼šé€’å½’å¤„ç†ä»»ä½•æˆå‘˜ç±» if (configClass.getMetadata().isAnnotated(Component.class.getName())) &#123; processMemberClasses(configClass, sourceClass); &#125; // å¤„ç† @PropertySource æ³¨è§£,ç”¨äºŽåŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ for (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable( sourceClass.getMetadata(), PropertySources.class, org.springframework.context.annotation.PropertySource.class)) &#123; // ... etc ... &#125; // å¤„ç†æ‰€æœ‰çš„ @ComponentScan æ³¨è§£ Set&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable( sourceClass.getMetadata(), ComponentScans.class, ComponentScan.class); if (!componentScans.isEmpty() &amp;&amp; !this.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) &#123; // èŽ·å–æ¯ä¸€ä¸ª componentScans çš„é…ç½®ä¿¡æ¯ for (AnnotationAttributes componentScan : componentScans) &#123; // å¦‚æžœæœ‰ scan ç±»ï¼Œåˆ™ç«‹å³æ‰§è¡Œè§£æžã€æ‰«æ Set&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions = this.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName()); //æ£€æŸ¥æ‰«æçš„å®šä¹‰é›†æ˜¯å¦æœ‰å…¶ä»–é…ç½®ç±»ï¼Œå¹¶åœ¨éœ€è¦æ—¶é€’å½’è§£æž for (BeanDefinitionHolder holder : scannedBeanDefinitions) &#123; BeanDefinition bdCand = holder.getBeanDefinition().getOriginatingBeanDefinition(); if (bdCand == null) &#123; bdCand = holder.getBeanDefinition(); &#125; if (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, this.metadataReaderFactory)) &#123; parse(bdCand.getBeanClassName(), holder.getBeanName()); &#125; &#125; &#125; &#125; // å¤„ç†æ‰€æœ‰çš„ @Import æ³¨è§£ processImports(configClass, sourceClass, getImports(sourceClass), true); // Process any @ImportResource annotations // å¤„ç†@Beanæ–¹æ³• Set&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass); for (MethodMetadata methodMetadata : beanMethods) &#123; configClass.addBeanMethod(new BeanMethod(methodMetadata, configClass)); &#125; //å¤„ç†æŽ¥å£ä¸Šçš„é»˜è®¤æ–¹æ³• processInterfaces(configClass, sourceClass); // å¤„ç†è¶…ç±» if (sourceClass.getMetadata().hasSuperClass()) &#123; String superclass = sourceClass.getMetadata().getSuperClassName(); if (superclass != null &amp;&amp; !superclass.startsWith("java") &amp;&amp; !this.knownSuperclasses.containsKey(superclass)) &#123; this.knownSuperclasses.put(superclass, configClass); // Superclass found, return its annotation metadata and recurse return sourceClass.getSuperClass(); &#125; &#125; // å¦‚æžœæ²¡æœ‰è¶…ç±»ï¼Œå¤„ç†å®Œæˆã€‚ return null; æ€»ç»“åœ¨ä½¿ç”¨ doProcessConfigurationClass æ–¹æ³•æ—¶ï¼Œå¤§è‡´ä¼šæœ‰è¿™æ ·å‡ æ­¥ï¼š å¦‚æžœæ ‡è®°æœ‰ @Component æ³¨è§£ï¼Œåˆ™ä¼šå…ˆåŽ»é€’å½’å¤„ç†æˆå‘˜ç±»,é‚£ä¹ˆä»–æ˜¯å¦‚ä½•è¿›è¡Œé€’å½’å¤„ç†çš„å‘¢ï¼Œçœ‹ä¸»è¦æ–¹æ³•çš„è°ƒç”¨å°±èƒ½å¤Ÿç†è§£ï¼šprocessMemberClasses -&gt; processConfigurationClass -&gt; doProcessConfigurationClass -&gt; processMemberClassesæ¯æ¬¡éƒ½ä¼šé€’å½’çš„å…ˆå¤„ç†æˆå‘˜ç±»ã€‚ å¤„ç† @PropertySource æ³¨è§£,ä½œç”¨ä¸ºåŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ å¤„ç†æ‰€æœ‰çš„ @ComponentScan æ³¨è§£ï¼Œå¦‚æžœé…ç½®æ–‡ä»¶ä¸­æ ‡è®°æœ‰ @ComponentSacn æˆ–è€… @ComponentScans æ³¨è§£çš„è¯ï¼Œä¼šå…ˆåŽ»è§£æžå¯¹åº”è·¯å¾„ä¸‹çš„Beanï¼ŒåŒ…è£…æˆ BeanDefinitionHolder å†æ¬¡è¿›è¡Œparseã€‚ å¤„ç†æ‰€æœ‰çš„ @Import æ³¨è§£,å¤„ç†æ‰€æœ‰ä½¿ç”¨Importæ³¨è§£å¼•å…¥çš„é…ç½®æ–‡ä»¶ å¤„ç†æ‰€æœ‰çš„ @ImportResource æ³¨è§£ å¤„ç†æ‰€æœ‰ @Bean æ–¹æ³•,æ·»åŠ ä¸º BeanMethodï¼Œè§£æžé…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸º@Beançš„æ–¹æ³•ï¼Œæ·»åŠ åˆ°configClassä¸­çš„BeanMethodä¸­ å¤„ç†æŽ¥å£çš„é»˜è®¤æ–¹æ³• æŒ‰ç…§ä»¥ä¸Šé€»è¾‘è¿›è¡Œé€’å½’çš„å¤„ç†è¶…ç±»ã€‚ åœ¨æ–¹æ³•ä¸­ï¼Œå¯ä»¥æ‰¾æ—¶é—´ç”»ä¸€å¼ å›¾æ¥è§£æžè¿™ä¸ªæ–¹æ³•çœŸæ­£åšäº†å†™ä»€ä¹ˆã€‚[todo] ã€‚ æ³¨å†Œçš„ç²¾ç®€è¿‡ç¨‹æœ€åŽçš„parseæ–¹æ³•æ˜¯å…³é”®ï¼Œç»è¿‡ä»¥ä¸Šæ­¥éª¤å¯ä»¥,åœ¨æœ¬ç« èŠ‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ @ComponentSacn å’Œ å¤„ç†æ‰€æœ‰çš„ @Bean è¿™ä¸¤æ­¥ï¼š åœ¨å¤„ç† @ComponentSacn ä¸­ï¼Œå°†ç›´æŽ¥å°†æ ¹æ®è·¯å¾„è§£æžå‡ºæ¥çš„Beanä½¿ç”¨ componentScanParser.parse æ–¹æ³•ï¼Œæœ€ç»ˆåœ¨ registerBeanDefinition() æ–¹æ³•ä¸­æ³¨å†Œè¿›åŽ»ã€‚ è€Œåœ¨å¤„ç†@Beanæ–¹æ³•çš„æ—¶å€™ï¼Œæ˜¯å°†Beanæ–¹æ³•åŒ…è£…æˆBeanMethod æ”¾åˆ° this.beanMethods ä¸­ï¼Œç­‰å¾…åœ¨ parse() åŽ this.reader.loadBeanDefinitions(configClasses); ä¸­è¿›è¡Œæ“ä½œ. è€Œåœ¨å‰é¢è¯´çš„loadBeanDefinitions ä¸­ä¼šå°†å‰é¢æåˆ°çš„ Importã€ImportReourceå’Œ BeanMethod ç»Ÿä¸€è¿›è¡Œæ³¨å†Œã€‚ 123456789if (configClass.isImported()) &#123; registerBeanDefinitionForImportedConfigurationClass(configClass);&#125;for (BeanMethod beanMethod : configClass.getBeanMethods()) &#123; loadBeanDefinitionsForBeanMethod(beanMethod);&#125;loadBeanDefinitionsFromImportedResources(configClass.getImportedResources());loadBeanDefinitionsFromRegistrars(configClass.getImportBeanDefinitionRegistrars()) åœ¨loadBeanDefinitionsForBeanMethodä¸­ï¼Œè¿›è¡Œäº†å¯¹è§£æžå‡ºæ¥çš„ä½¿ç”¨@Beanæ ‡æ³¨çš„æ–¹æ³•è¿›è¡Œæ³¨å†Œã€‚ä»Žè€Œå®Œæˆæ³¨å†ŒBeançš„ä¸»çº¿åŠŸèƒ½ã€‚ä¸å…·ä½“è¿›è¡Œæ¢³ç†è¿™ä¸ªæ–¹æ³•çš„è¿‡ç¨‹ï¼Œå¤§è‡´ä¸ºæž„å»ºä¸€ä¸ªBeanDefintionåŽï¼Œé€šè¿‡registerBeanDefinitionæ–¹æ³•è¿›è¡Œæ³¨å†Œ,æ”¾åˆ°beanDefinitionMapä¸­ã€‚]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springçš„æ ¸å¿ƒRefresh]]></title>
    <url>%2F2019%2F12%2F15%2FSpring%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[åœ¨æ³¨å†Œé…ç½®æ–‡ä»¶åŽçš„åˆ·æ–°ï¼ˆRefreshï¼‰åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦ç†æ¸…äº†Springæ˜¯å¦‚ä½•ï¼ˆé€šè¿‡ register(Class&lt;?&gt;... componentClasses) ï¼‰æ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªè¦å¤„ç†çš„ç»„ä»¶ç±»ï¼ˆé…ç½®ç±»ï¼‰ã€‚ ä½†æ˜¯å¦‚æžœä¸è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯åˆ·æ–°ï¼ˆrefreshï¼‰å®¹å™¨ï¼Œæ•´ä¸ªç±»æ˜¯å¾—ä¸åˆ°å®Œå…¨çš„å¤„ç†çš„ã€‚ä¸‹å›¾æ˜¯å¯¹ refresh æ–¹æ³•è¿›è¡Œçš„ä¸»è¦è¿‡ç¨‹æ€»ç»“ã€‚ä¼šé€šè¿‡å¯¹æ¯ä¸€æ¡çº¿ä¸Šçš„æ–¹æ³•è¿›è¡Œåˆ†æžå’Œæ€»ç»“æ–¹æ³•çš„ç”¨é€”ã€‚ 1. prepareRefresh å‡†å¤‡åˆ·æ–°æ˜¯ refresh çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥å‡†å¤‡ä¸Šä¸‹æ–‡çŽ¯å¢ƒä»¥ç”¨æ¥åˆ·æ–°ï¼ˆrefreshï¼‰ã€‚ è®¾ç½®startupDateå¯åŠ¨æ—¶é—´ã€è®¾ç½®closedä¸ºfalseï¼Œè®¾ç½®activeä¸ºtrue. initPropertySources()æ–¹æ³•ï¼Œç•™ç»™å­ç±»è‡ªè¡Œå®žçŽ°ï¼Œç”¨æ¥åœ¨ä¸Šä¸‹æ–‡çŽ¯å¢ƒä¸­åˆå§‹åŒ–ä»»ä½•å ä½ç¬¦å±žæ€§æº. validateRequiredProperties() ç”¨æ¥éªŒè¯æ‰€æœ‰çš„Propritieséƒ½æ˜¯å¯è§£æžçš„. æœ€åŽå­˜å‚¨é¢„åˆ·æ–°çš„ApplicationListenersã€‚ä¹Ÿå°±æ˜¯åˆå§‹åŒ–earlyApplicationEventsï¼› 1234567891011121314151617181920212223protected void prepareRefresh() &#123; this.startupDate = System.currentTimeMillis(); this.closed.set(false); this.active.set(**true**); // ...çœç•¥éƒ¨åˆ†ä»£ç . // åœ¨ä¸Šä¸‹æ–‡çŽ¯å¢ƒä¸­åˆå§‹åŒ–ä»»ä½•å ä½ç¬¦å±žæ€§æºï¼Œå­ç±»ç»§æ‰¿å®žçŽ° initPropertySources(); // éªŒè¯æ‰€æœ‰å¿…é¡»çš„Propertyéƒ½æ˜¯å¯è§£æžçš„ getEnvironment().validateRequiredProperties(); // Store pre-refresh ApplicationListeners... if (this.earlyApplicationListeners == null) &#123; this.earlyApplicationListeners = new LinkedHashSet&lt;&gt;(this.applicationListeners); &#125; else &#123; // Reset local application listeners to pre-refresh state. this.applicationListeners.clear(); this.applicationListeners.addAll(this.earlyApplicationListeners); &#125; this.earlyApplicationEvents = new LinkedHashSet&lt;&gt;();&#125; 2. obtainFreshBeanFactory èŽ·å–BeanFactoryåœ¨ obtainFreshBeanFactory æ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªå­æ–¹æ³•ã€‚åˆ†åˆ«ç”¨æ¥è®¾ç½®SerializationIdå’ŒèŽ·å–åœ¨registerè¿‡ç¨‹ä¸­å·²ç»äº§ç”Ÿçš„beanFactoryã€‚ 12345678protected final void refreshBeanFactory() throws IllegalStateException &#123; // ...çœç•¥éƒ¨åˆ†ä»£ç  // åœ¨registerçš„æ—¶å€™ï¼Œé€šè¿‡registerBeanDefinitionæ—¶ä¼šåˆ›å»ºä¸€ä¸ªbeanFactoryä¸ºDefaultListableBeanFactory this.beanFactory.setSerializationId(getId());&#125;public final ConfigurableListableBeanFactory getBeanFactory() &#123; return this.beanFactory;&#125; 3.prepareBeanFactory å‡†å¤‡BeanFactoryåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å®žçŽ°ç±»å¯¹BeanFactoryçš„åŸºæœ¬åˆå§‹åŒ–ã€‚è®¾ç½®äº† classLoadorã€ExpressionResolverã€BeanPostProcessorç­‰ç­‰å±žæ€§ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041protected void prepareBeanFactory(ConfigurableListableBeanFactory beanFactory) &#123; beanFactory.setBeanClassLoader(getClassLoader()); beanFactory.setBeanExpressionResolver(new StandardBeanExpressionResolver(beanFactory.getBeanClassLoader())); beanFactory.addPropertyEditorRegistrar(new ResourceEditorRegistrar(this, getEnvironment())); // è®¾ç½®PostProcessor å›žè°ƒæ–¹æ³• beanFactory.addBeanPostProcessor(new ApplicationContextAwareProcessor(this)); // å¿½ç•¥ç»™å®šçš„æŽ¥å£ç±»çš„è‡ªåŠ¨è£…é…ï¼ˆå°±æ˜¯ä¸è£…é…ç»™å®šçš„æŽ¥å£ç±»ï¼‰ beanFactory.ignoreDependencyInterface(EnvironmentAware.class); beanFactory.ignoreDependencyInterface(EmbeddedValueResolverAware.class); beanFactory.ignoreDependencyInterface(ResourceLoaderAware.class); beanFactory.ignoreDependencyInterface(ApplicationEventPublisherAware.class); beanFactory.ignoreDependencyInterface(MessageSourceAware.class); beanFactory.ignoreDependencyInterface(ApplicationContextAware.class); // registerResolvableDependencyçš„ä½œç”¨å°±æ˜¯å°† ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºä¾èµ–æ³¨å…¥åˆ°ç¬¬äºŒä¸ªå‚æ•°ä¸­ // è¿™é‡Œçš„thisæŒ‡çš„å°±æ˜¯AbstractApplicationContext beanFactory.registerResolvableDependency(BeanFactory.class, beanFactory); beanFactory.registerResolvableDependency(ResourceLoader.class, this); beanFactory.registerResolvableDependency(ApplicationEventPublisher.class, this); beanFactory.registerResolvableDependency(ApplicationContext.class, this); // Register early post-processor for detecting inner beans as ApplicationListeners. æ³¨å†Œä¸€ä¸ªapplicationListenersæ£€æµ‹å™¨ beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(this)); if (beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123; beanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory)); beanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader())); &#125; // æ³¨å†ŒçŽ¯å¢ƒç›¸å…³Bean if (!beanFactory.containsLocalBean(ENVIRONMENT_BEAN_NAME)) &#123; beanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment()); &#125; if (!beanFactory.containsLocalBean(SYSTEM_PROPERTIES_BEAN_NAME)) &#123; beanFactory.registerSingleton(SYSTEM_PROPERTIES_BEAN_NAME, getEnvironment().getSystemProperties()); &#125; if (!beanFactory.containsLocalBean(SYSTEM_ENVIRONMENT_BEAN_NAME)) &#123; beanFactory.registerSingleton(SYSTEM_ENVIRONMENT_BEAN_NAME, getEnvironment().getSystemEnvironment()); &#125;&#125; 3.postProcessBeanFactory å¯¹BeanFactoryçš„åŽç½®å¤„ç†è¿™ä¸ªæ–¹æ³•çš„å®žçŽ°æ˜¯ç©ºçš„ï¼Œå®žé™…å«ä¹‰å°±æ˜¯è®©å­ç±»åŽ»å®žçŽ°è¿™ä¸ªæ–¹æ³•ï¼Œç„¶åŽè°ƒç”¨çš„æ—¶å€™å¯ä»¥å¯¹BeanFactoryè¿›è¡Œè‡ªå®šä¹‰çš„åŽç½®å¤„ç†ã€‚ 4.invokeBeanFactoryPostProcessors è°ƒç”¨å·²æ³¨å†Œä¸ºBeançš„å·¥åŽ‚å¤„ç†å™¨æ–¹æ³•çš„ä½œç”¨å°±æ˜¯å®žä¾‹åŒ–å¹¶è°ƒç”¨æ‰€æœ‰å·²æ³¨å†Œçš„BeanFactoryPostProcessorï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™ä¸€æ­¥å®Œæˆå¯¹configurationé…ç½®ç±»ä¸­çš„Beançš„æ³¨å†Œè¿‡ç¨‹[todo]ã€‚ä¸»è¦çš„æ‰§è¡Œæ–¹æ³•æ˜¯ PostProcessorRegistrationDelegate ä¸­çš„ invokeBeanFactoryPostProcessors æ–¹æ³•ã€‚ åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°äº†åœ¨ register æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº† this.reader = new AnnotatedBeanDefinitionReader(this) åŽï¼Œä½¿ç”¨ registerAnnotationConfigProcessors æ³¨å†Œä¸€äº›æ³¨è§£ç›¸å…³beanï¼Œå¦‚ConfigurationClassPostProcessorç­‰ç­‰ã€‚ ä»£ç å¾ˆå¤šï¼Œæ²¡å¿…è¦éƒ½çœ‹ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œå…ˆæ€»ç»“ä¸‹è¿‡ç¨‹ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç¿»ç¿»æºç å†çœ‹çœ‹å…·ä½“å®žçŽ°ï¼š å¦‚æžœæœ‰BeanFactoryPostProcessor,åˆ™ä¼šå…ˆæ‰§è¡Œç±»ä¸­çš„ postProcessBeanDefinitionRegistry æ–¹æ³•1234567891011for (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors) &#123; if (postProcessor instanceof BeanDefinitionRegistryPostProcessor) &#123; BeanDefinitionRegistryPostProcessor registryProcessor = (BeanDefinitionRegistryPostProcessor) postProcessor; registryProcessor.postProcessBeanDefinitionRegistry(registry); registryProcessors.add(registryProcessor); &#125; else &#123; regularPostProcessors.add(postProcessor); &#125;&#125; ç¬¬ä¸€æ­¥ã€ä¼šå¤„ç†åœ¨beanFactoryä¸­å­˜åœ¨çš„ ç»§æ‰¿BeanDefinitionRegistryPostProcessor å¹¶ä¸”å®žçŽ°äº†PriorityOrdered æŽ¥å£çš„ç±»12345678910111213141516String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);for (String ppName : postProcessorNames) &#123; if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123; currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class)); processedBeans.add(ppName); &#125;&#125;// å¯¹ä¾èµ–æŽ’åºsortPostProcessors(currentRegistryProcessors, beanFactory);// æ·»åŠ åˆ°registryProcessorsä¸­registryProcessors.addAll(currentRegistryProcessors);// æ‰§è¡Œ&#123;ConfigurationClassPostProcessorçš„&#125;åŽç½®æ–¹æ³•invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);// æ¸…ç©ºå½“å‰æ³¨å†Œå¤„ç†å™¨currentRegistryProcessors.clear(); ç¬¬äºŒæ­¥ã€ä¼šå¤„ç†åœ¨beanFactoryä¸­å­˜åœ¨çš„ ç»§æ‰¿ BeanDefinitionRegistryPostProcessor å¹¶ä¸”å®žçŽ°äº†Ordered æŽ¥å£çš„ç±»ä¸­çš„12345// åªåˆ—å‡ºå·®å¼‚ç‚¹if (!processedBeans.contains(ppName) &amp;&amp; beanFactory.isTypeMatch(ppName, Ordered.class)) &#123; currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class)); processedBeans.add(ppName);&#125; å’Œç¬¬ä¸€æ­¥å‡ ä¹Žä¸€æ ·ï¼ŒåŒæ ·ä¼šå¯¹ä¾èµ–æŽ’åºã€æ·»åŠ åˆ°registryProcessorsä¸­åˆ°ã€å¤„ç†åŽç½®æ–¹æ³•ç­‰ã€‚ æœ€åŽã€å¤„ç†å‰©ä¸‹çš„BeanDefinitionRegistryPostProcessorç±»å’Œå‰ä¸¤æ­¥ç›¸ä¼¼çš„é‡å¤çš„æ“ä½œã€‚å°±ä¸å±•ç¤ºä»£ç äº†ã€‚ å¤„ç†å®Œæ‰€æœ‰çš„BeanFactoryPostProcessoråŽï¼Œå¤„ç†æ‰€æœ‰BeanPostProcessor1234567891011// åœ¨å‰é¢å¤„ç†è¿‡çš„ registryProcessors å¤„ç†å™¨invokeBeanFactoryPostProcessors(registryProcessors, beanFactory);invokeBeanFactoryPostProcessors(regularPostProcessors, beanFactory);private static void invokeBeanFactoryPostProcessors( Collection&lt;? extends BeanFactoryPostProcessor&gt; postProcessors, ConfigurableListableBeanFactory beanFactory) &#123; // æ‰§è¡ŒpostProcessBeanFactoryå›žè°ƒæ–¹æ³• for (BeanFactoryPostProcessor postProcessor : postProcessors) &#123; postProcessor.postProcessBeanFactory(beanFactory); &#125;&#125; ä¸Šé¢æ˜¯é’ˆå¯¹ beanFactory instanceof BeanDefinitionRegistry çš„æƒ…å†µï¼Œå¦‚æžœè¿”å›žfalseï¼Œå…·ä½“å†…å®¹å¯èƒ½ç¨æœ‰ä¸å®¹ã€‚ä½†å¤§è‡´ä¸Šæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå°±ä¸å†åˆ†æžä¸‹é¢çš„ä»£ç äº†ã€‚ 5.registerBeanPostProcessors æ³¨å†ŒBeançš„åŽç½®å¤„ç†å™¨å°±åƒåå­—ä¸€æ ·ï¼ŒregisterBeanPostProcessors çš„ä½œç”¨å°±æ˜¯æ³¨å†Œ BeanPostProcessorsã€‚ 123protected void registerBeanPostProcessors(ConfigurableListableBeanFactory beanFactory) &#123; PostProcessorRegistrationDelegate.registerBeanPostProcessors(beanFactory, this);&#125; è°ƒç”¨PostProcessorRegistrationDelegateçš„é™æ€æ–¹æ³• registerBeanPostProcessors 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465public static void registerBeanPostProcessors( ConfigurableListableBeanFactory beanFactory, AbstractApplicationContext applicationContext) &#123; // èŽ·å¾—æ‰€æœ‰çš„BeanPostProcessor String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanPostProcessor.class, true, false); int beanProcessorTargetCount = beanFactory.getBeanPostProcessorCount() + 1 + postProcessorNames.length; // æ³¨å†Œä¸€ä¸ªBeanPostProcessorCheckerç”¨æ¥åœ¨BeanPostProcessorå®žä¾‹åŒ–Beanæ—¶æ‰“å°ä¿¡æ¯ beanFactory.addBeanPostProcessor(new BeanPostProcessorChecker(beanFactory, beanProcessorTargetCount)); // Separate between BeanPostProcessors that implement PriorityOrdered, // Ordered, and the rest. List&lt;BeanPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList&lt;&gt;(); List&lt;BeanPostProcessor&gt; internalPostProcessors = new ArrayList&lt;&gt;(); List&lt;String&gt; orderedPostProcessorNames = new ArrayList&lt;&gt;(); List&lt;String&gt; nonOrderedPostProcessorNames = new ArrayList&lt;&gt;(); for (String ppName : postProcessorNames) &#123; if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123; BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class); priorityOrderedPostProcessors.add(pp); if (pp instanceof MergedBeanDefinitionPostProcessor) &#123; internalPostProcessors.add(pp); &#125; &#125; else if (beanFactory.isTypeMatch(ppName, Ordered.class)) &#123; orderedPostProcessorNames.add(ppName); &#125; else &#123; nonOrderedPostProcessorNames.add(ppName); &#125; &#125; // First, register the BeanPostProcessors that implement PriorityOrdered. sortPostProcessors(priorityOrderedPostProcessors, beanFactory); registerBeanPostProcessors(beanFactory, priorityOrderedPostProcessors); // Next, register the BeanPostProcessors that implement Ordered. List&lt;BeanPostProcessor&gt; orderedPostProcessors = new ArrayList&lt;&gt;(orderedPostProcessorNames.size()); for (String ppName : orderedPostProcessorNames) &#123; BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class); orderedPostProcessors.add(pp); if (pp instanceof MergedBeanDefinitionPostProcessor) &#123; internalPostProcessors.add(pp); &#125; &#125; sortPostProcessors(orderedPostProcessors, beanFactory); registerBeanPostProcessors(beanFactory, orderedPostProcessors); // Now, register all regular BeanPostProcessors. List&lt;BeanPostProcessor&gt; nonOrderedPostProcessors = new ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size()); for (String ppName : nonOrderedPostProcessorNames) &#123; BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class); nonOrderedPostProcessors.add(pp); if (pp instanceof MergedBeanDefinitionPostProcessor) &#123; internalPostProcessors.add(pp); &#125; &#125; registerBeanPostProcessors(beanFactory, nonOrderedPostProcessors); // Finally, re-register all internal BeanPostProcessors. sortPostProcessors(internalPostProcessors, beanFactory); registerBeanPostProcessors(beanFactory, internalPostProcessors); // Re-register post-processor for detecting inner beans as ApplicationListeners, // moving it to the end of the processor chain (for picking up proxies etc). beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(applicationContext));&#125; è¿‡ç¨‹ç±»ä¼¼ invokeBeanFactoryPostProcessors çš„è¿‡ç¨‹ï¼Œå®žé™…è¿‡ç¨‹åˆ†æ­¥å¯ä»¥æ•´ç†å¦‚ä¸‹ï¼š èŽ·å¾—æ‰€æœ‰çš„BeanPostProcessorï¼Œå¹¶æ³¨å†Œä¸€ä¸ªBeanPostProcessorCheckerï¼Œç”¨æ¥åœ¨BeanPostProcessorä¸­åˆ›å»ºBeanæ—¶æ‰“å°ä¿¡æ¯ã€‚ é¦–å…ˆæ³¨å†Œç»§æ‰¿äº†PriorityOrderedæŽ¥å£çš„BeanPostProcessor; ç„¶åŽæ³¨å†Œç»§æ‰¿äº†OrderedæŽ¥å£çš„ BeanPostProcessor;ç„¶åŽæ³¨å†Œæ‰€æœ‰çš„æ™®é€šçš„ BeanPostProcessorï¼› æœ€åŽæ³¨å†Œæ‰€æœ‰çš„å†…éƒ¨çš„BeanPostProcessor; 6.initMessageSource å¤„ç†åˆå§‹åŒ–æ¶ˆæ¯æ¥æºMessageSource123456789101112131415161718192021222324252627282930protected void initMessageSource() &#123; // èŽ·å¾—beanFactory ConfigurableListableBeanFactory beanFactory = getBeanFactory(); // å¦‚æžœåŒ…å«nameä¸º messageSource çš„bean if (beanFactory.containsLocalBean(MESSAGE_SOURCE_BEAN_NAME)) &#123; this.messageSource = beanFactory.getBean(MESSAGE_SOURCE_BEAN_NAME, MessageSource.class); // è®©å½“å‰ MessageSource çŸ¥é“çˆ¶MessageSource if (this.parent != null &amp;&amp; this.messageSource instanceof HierarchicalMessageSource) &#123; HierarchicalMessageSource hms = (HierarchicalMessageSource) this.messageSource; if (hms.getParentMessageSource() == null) &#123; // Only set parent context as parent MessageSource if no parent MessageSource // registered already. hms.setParentMessageSource(getInternalParentMessageSource()); &#125; &#125; if (logger.isTraceEnabled()) &#123; logger.trace("Using MessageSource [" + this.messageSource + "]"); &#125; &#125; else &#123; // å¦‚æžœä¸å­˜åœ¨MSï¼Œåˆ™æ–°å»ºä¸€ä¸ªç©ºçš„ MessageSource DelegatingMessageSource dms = new DelegatingMessageSource(); dms.setParentMessageSource(getInternalParentMessageSource()); this.messageSource = dms; beanFactory.registerSingleton(MESSAGE_SOURCE_BEAN_NAME, this.messageSource); if (logger.isTraceEnabled()) &#123; logger.trace("No '" + MESSAGE_SOURCE_BEAN_NAME + "' bean, using [" + this.messageSource + "]"); &#125; &#125;&#125; åœ¨ initMessageSource è¿‡ç¨‹ä¸­ï¼Œåšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œä¸»è¦åˆ†ä¸¤æ­¥ï¼š å¦‚æžœåŒ…å«messageSourceçš„Beanï¼Œåˆ™è®¾ç½®çˆ¶MessageSource å¦‚æžœä¸åŒ…å« messageSource çš„ Beanï¼Œåˆ™åˆ›å»ºä¸€ä¸ª DelegatingMessageSource å¹¶æ³¨å†Œåˆ° beanFactory ä¸­ã€‚ 7. initApplicationEventMulticaster åˆå§‹åŒ–åº”ç”¨äº‹ä»¶å¤šæ’­å™¨123456789101112131415161718protected void initApplicationEventMulticaster() &#123; ConfigurableListableBeanFactory beanFactory = getBeanFactory(); if (beanFactory.containsLocalBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME)) &#123; this.applicationEventMulticaster = beanFactory.getBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, ApplicationEventMulticaster.class); if (logger.isTraceEnabled()) &#123; logger.trace("Using ApplicationEventMulticaster [" + this.applicationEventMulticaster + "]"); &#125; &#125; else &#123; this.applicationEventMulticaster = new SimpleApplicationEventMulticaster(beanFactory); beanFactory.registerSingleton(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, this.applicationEventMulticaster); if (logger.isTraceEnabled()) &#123; logger.trace("No '" + APPLICATION_EVENT_MULTICASTER_BEAN_NAME + "' bean, using " + "[" + this.applicationEventMulticaster.getClass().getSimpleName() + "]"); &#125; &#125;&#125; å’Œåˆå§‹åŒ–MessageSourceè¿‡ç¨‹ç›¸ä¼¼,å¦‚æžœåŒ…å«applicationEventMulticasterï¼Œåˆ™è®¾ç½® this.applicationEventMulticaster ä¸ºå®¹å™¨ä¸­çš„å¤šæ’­å™¨ã€‚å¦‚æžœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºï¼Œå¹¶ä½¿ç”¨beanFactoryè¿›è¡Œæ³¨å†Œä¸ºå•ä¾‹çš„Beanã€‚ 8. onRefresh åœ¨ç‰¹å®šä¸Šä¸‹æ–‡å­ç±»ä¸­åˆå§‹åŒ–å…¶ä»–ç‰¹æ®Šbeanç‚¹è¿›æ–¹æ³•åŽæ˜¾ç¤ºæ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œæ˜¯ç•™ç»™å­ç±»è‡ªè¡ŒåŽ»å®žçŽ°çš„ï¼ŒåŽ»å¤„ç†ç‰¹æ®Šçš„beanã€‚ 9. registerListeners æ³¨å†ŒListeners12345678910111213141516171819protected void registerListeners() &#123; // é¦–å…ˆæ³¨å†Œé™æ€çš„listener for (ApplicationListener&lt;?&gt; listener : getApplicationListeners()) &#123; getApplicationEventMulticaster().addApplicationListener(listener); &#125; String[] listenerBeanNames = getBeanNamesForType(ApplicationListener.class, true, false); for (String listenerBeanName : listenerBeanNames) &#123; getApplicationEventMulticaster().addApplicationListenerBean(listenerBeanName); &#125; // å‘å¸ƒæ—©èµ·çš„åº”ç”¨äº‹ä»¶ Set&lt;ApplicationEvent&gt; earlyEventsToProcess = this.earlyApplicationEvents; this.earlyApplicationEvents = null; if (earlyEventsToProcess != null) &#123; for (ApplicationEvent earlyEvent : earlyEventsToProcess) &#123; getApplicationEventMulticaster().multicastEvent(earlyEvent); &#125; &#125;&#125; 10.finishBeanFactoryInitialization å®ŒæˆBeanFactoryçš„åˆå§‹åŒ–åœ¨è¿™ä¸€æ­¥å®Œæˆäº†æ‰€æœ‰çš„å‰©ä½™çš„å•å®žä¾‹Beançš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚ 123456789101112131415161718192021222324252627282930protected void finishBeanFactoryInitialization(ConfigurableListableBeanFactory beanFactory) &#123; //åˆå§‹åŒ– conversionService Bean if (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp; beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123; beanFactory.setConversionService( beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)); &#125; // Register a default embedded value resolver if no bean post-processor // (such as a PropertyPlaceholderConfigurer bean) registered any before: // at this point, primarily for resolution in annotation attribute values. if (!beanFactory.hasEmbeddedValueResolver()) &#123; beanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal)); &#125; // Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early. String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, false, false); for (String weaverAwareName : weaverAwareNames) &#123; getBean(weaverAwareName); &#125; // Stop using the temporary ClassLoader for type matching. beanFactory.setTempClassLoader(null); // Allow for caching all bean definition metadata, not expecting further changes. beanFactory.freezeConfiguration(); // Instantiate all remaining (non-lazy-init) singletons. beanFactory.preInstantiateSingletons();&#125; ä¸»è¦è¿‡ç¨‹åŒ…æ‹¬ï¼š åˆå§‹åŒ– conversionService ; å¦‚æžœæ²¡æœ‰å†…ç½®çš„Valueè§£æžå™¨ï¼Œåˆ™è®¾ç½®ä¸€ä¸ªStringValueResolverè§£æžå™¨åˆ°beanFactoryä¸­ã€‚ åˆå§‹åŒ–LoadTimeWeaverAwareï¼› åœæ­¢ä½¿ç”¨ä¸´æ—¶çš„ClassLoaderè¿›è¡Œç±»åž‹åŒ¹é…ã€‚ å…è®¸ç¼“å­˜æ‰€æœ‰beanå®šä¹‰å…ƒæ•°æ®ï¼Œè€Œä¸æœŸæœ›è¿›ä¸€æ­¥çš„æ›´æ”¹ã€‚ å®žä¾‹åŒ–æ‰€æœ‰çš„å‰©ä½™çš„ã€éžæ‡’åŠ è½½çš„å•å®žä¾‹Beanã€‚ è¿™é‡Œåªé’ˆå¯¹ç¬¬6æ¡çš„å®žä¾‹åŒ–å‰©ä½™çš„å•å®žä¾‹Beanè¿›è¡Œæºç åˆ†æžï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344beanFactory.preInstantiateSingletons();@Overridepublic void preInstantiateSingletons() throws BeansException &#123; // Iterate over a copy to allow for init methods which in turn register new bean definitions. // While this may not be part of the regular factory bootstrap, it does otherwise work fine. List&lt;String&gt; beanNames = new ArrayList&lt;&gt;(this.beanDefinitionNames); // Trigger initialization of all non-lazy singleton beans... for (String beanName : beanNames) &#123; // å¦‚æžœå¯¹åº”å­Beançš„å®šä¹‰ï¼Œåˆ™éåŽ†çˆ¶Beanå®šä¹‰å¾—åˆ°ä¸€ä¸ªåˆå¹¶çš„RootBeanDefinition RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName); //å¦‚æžœè¿™ä¸ªBeanä¸æ˜¯abstractã€æ˜¯å•ä¾‹çš„ã€éžæ‡’åŠ è½½çš„ if (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123; // å¦‚æžœæ˜¯FactoryBean if (isFactoryBean(beanName)) &#123; // æƒ³ä½¿ç”¨getBeanæ—¶éœ€è¦æ·»åŠ  &amp; å‰ç¼€ Object bean = getBean(FACTORY_BEAN_PREFIX + beanName); if (bean instanceof FactoryBean) &#123; final FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) bean; boolean isEagerInit; if (System.getSecurityManager() != null &amp;&amp; factory instanceof SmartFactoryBean) &#123; isEagerInit = AccessController.doPrivileged((PrivilegedAction&lt;Boolean&gt;) ((SmartFactoryBean&lt;?&gt;) factory)::isEagerInit, getAccessControlContext()); &#125; else &#123; isEagerInit = (factory instanceof SmartFactoryBean &amp;&amp; ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit()); &#125; if (isEagerInit) &#123; // è°ƒç”¨getBeanè¿›è¡Œåˆå§‹åŒ– getBean(beanName); &#125; &#125; &#125; else &#123; // è°ƒç”¨getBeanè¿›è¡Œåˆå§‹åŒ– getBean(beanName); &#125; &#125; &#125; // Trigger post-initialization callback for all applicable beans...&#125; ç»è¿‡ä¸Šé¢çš„åˆ†æžå¯ä»¥çœ‹å‡ºï¼šåœ¨preInstantiateSingletonsæ–¹æ³•ä¸­ï¼ŒçœŸæ­£åŽ»å®žä¾‹åŒ–çš„æ–¹å¼æ˜¯åŽ»è°ƒç”¨ getBean [todo]æ–¹æ³•ã€‚ æŽ¥ä¸‹æ¥åˆ†æžé…ç½®æ–‡ä»¶ä¸­çš„Beançš„æ³¨å†Œå’Œä½¿ç”¨ getBean è¿›è¡ŒçœŸæ­£çš„å®žä¾‹åŒ–è¿‡ç¨‹è¿›è¡Œåˆ†æžã€‚]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringAOPçš„ä½¿ç”¨å’Œæºç åˆ†æž]]></title>
    <url>%2F2019%2F12%2F11%2F%EF%BC%88%E5%9B%9B%EF%BC%89AOP%E5%88%87%E9%9D%A2%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[SpringAOPçš„ä½¿ç”¨å’Œæºç åˆ†æžå‰è¨€çŽ°åœ¨æ¥çœ‹ï¼ˆAspect-oriented Programmingï¼‰ é¢å‘åˆ‡é¢ç¼–ç¨‹aopï¼Œæ˜¯å’Œoopï¼ˆObject-oriented Programmingï¼‰æ˜¯å¯¹ç¼–ç¨‹ç»“æžœçš„ä¸åŒçš„æ€è€ƒçš„æ–¹å‘ã€‚åœ¨é¢å‘å¯¹è±¡ä¸­ï¼Œå½¢æˆç»„åˆçš„ç»„ä»¶æ˜¯ç±»ï¼ˆclassï¼‰ã€‚è€Œåœ¨é¢å‘åˆ‡é¢ï¼Œå½¢æˆç»„åˆçš„ç»„ä»¶æ˜¯åˆ‡é¢ï¼ˆAspectï¼‰,åˆ‡é¢èƒ½å¤Ÿå¯¹å…³æ³¨çš„åœ°æ–¹æ¨¡å—åŒ–ï¼Œæ¨ªåˆ‡å¤šç§ä¸åŒçš„ç±»åž‹å’Œå¯¹è±¡ï¼ˆæ¯”å¦‚äº‹åŠ¡ç®¡ç†ï¼‰ã€‚è€Œè¿™ä¸ªæ‰€è°“çš„â€œå…³æ³¨çš„åœ°æ–¹â€ï¼Œä¹Ÿå¯ä»¥åœ¨AOPä¸­ç§°ä¸ºè·¨é¢†åŸŸå…³æ³¨ç‚¹ã€‚ Springæä¾› é…ç½®æ–‡ä»¶ å’Œ @AspectJæ³¨è§£ æ–¹å¼ç¼–å†™AOPï¼Œä¸¤ç§æ–¹å¼éƒ½æ”¯æŒå„ç§çš„ Adviceï¼ˆé€šçŸ¥ï¼‰ï¼Œå¦‚æžœä½¿ç”¨@AspectJæ³¨è§£ï¼Œä»ç„¶ä¼šé€šè¿‡Springçš„è¿›è¡Œç»‡å…¥ã€‚ AOPä¸­å…³é”®å­—çš„æ¦‚å¿µ1.Aspectåˆ‡é¢ï¼š å¯¹å¤šç§ä¸åŒçš„ç±»çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¿™ä¸ªå…³æ³¨ç‚¹è¢«æ¨¡å—åŒ–ä¸ºä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»å°±å«åšåˆ‡é¢ï¼ˆåˆ‡é¢ç±»ï¼‰ï¼Œé€šè¿‡åœ¨æ™®é€šç±»ä¸Šæ ‡æ³¨ @Aspectæ³¨è§£æ¥å®žçŽ°ã€‚ 2.Join pointè¿žæŽ¥ç‚¹ï¼šç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ‰§è¡Œé€šçŸ¥ï¼ˆAdviceï¼‰çš„ç‚¹ã€‚ 3.Adviceé€šçŸ¥ï¼šé€šçŸ¥æŒ‡çš„æ˜¯åˆ‡é¢åœ¨æŒ‡å®šçš„è¿žæŽ¥ç‚¹å¤„æ‰§è¡Œçš„æ“ä½œï¼Œä¸åŒçš„é€šçŸ¥ç±»åž‹åŒ…æ‹¬ï¼šâ€œaroundâ€, â€œbeforeâ€ and â€œafterâ€ 4.Pointcutåˆ‡ç‚¹ï¼šåˆ‡ç‚¹ä¼šåŒ¹é…é€šçŸ¥æ‰€è¦ç»‡å…¥çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿žæŽ¥ç‚¹ï¼Œé€šçŸ¥æ˜¯ä¸Žåˆ‡ç‚¹å‘å…³è”çš„ï¼Œå¹¶ä¸”åœ¨ä»»ä½•åŒ¹é…åˆ°åˆ‡ç‚¹çš„åœ°æ–¹æ‰§è¡Œåœ¨è¿žæŽ¥ç‚¹ä¸Šçš„æ“ä½œã€‚ 5.Target objectç›®æ ‡å¯¹è±¡ï¼šä¸€ä¸ªã€è¢«ä¸€ä¸ªæˆ–å¤šä¸ªåˆ‡é¢è¿›è¡Œé€šçŸ¥ã€‘çš„å¯¹è±¡å«åšç›®æ ‡å¯¹è±¡ï¼Œä¹Ÿå«ä»£ç†å¯¹è±¡ã€‚ 6.AOP proxyAOPä»£ç†ï¼šåœ¨Springä¸­ï¼Œä¸€ä¸ªæ˜¯JDKåŠ¨æ€ä»£ç†ï¼Œä¸€ä¸ªæ˜¯ CGLIB ä»£ç†ã€‚ 7.Weavingç»‡å…¥ï¼šç»‡å…¥æ˜¯å°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºçš„ä»£ç†å¯¹è±¡è¿‡ç¨‹ ä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡ŒAOPçš„é…ç½®å’Œä½¿ç”¨1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071/** * 1. ä½¿ç”¨ @Aspect æ³¨è§£åˆ›å»ºåˆ‡é¢ç±» * 2. ä½¿ç”¨ @Pointcut æ³¨è§£æ³¨æ˜Žåˆ‡ç‚¹ï¼ˆä½¿ç”¨Aspectè¡¨è¾¾å¼ï¼‰ * 3. å£°æ˜Žé€šçŸ¥ï¼ˆBeforeï¼ŒAfterï¼ŒAroundï¼ŒAfterReturningï¼ŒAfterThrowingï¼‰å…·ä½“å«ä¹‰å¯ä»¥å‚è€ƒRefæ–‡æ¡£ 5.4.4. Declaring Advice * åªæ˜¯ä»¥ä¸Šä¸‰æ­¥æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæ²¡æœ‰å¼€å¯Springå¯¹æ³¨è§£ç‰ˆAOPçš„æ”¯æŒ * æ‰€ä»¥ï¼Œéœ€è¦ä½¿ç”¨ @EnableAspectJAutoProxy å¼€å¯å¯¹@Aspectæ³¨è§£çš„æ”¯æŒ **/@Aspect@Componentpublic class LogAspects &#123; @Pointcut(value="within(com.nanyin.service.*)")// @Pointcut("execution(public * (..))") public void pointCut()&#123; &#125; @Before("pointCut()") public void logBefore(JoinPoint jp)&#123; System.out.println(jp.getSignature().getName()); System.out.println("before..."); &#125; @After("pointCut()") public void logAfter()&#123; System.out.println("after..."); &#125; @AfterReturning("pointCut()") public void logAfterReturn()&#123; System.out.println("after return..."); &#125; @AfterThrowing(value = "pointCut()",throwing = "ex") public void logAfterThrowing(JoinPoint joinPoint,Exception ex)&#123; joinPoint.getSignature().getName(); System.out.println("after throwing..."); System.out.println(ex.getMessage()); &#125; // aroundåœ¨proceed ä¹‹å‰æ˜¯åœ¨ beforeä¹‹å‰æ‰§è¡Œ // aroundåœ¨proceed ä¹‹å‰æ˜¯åœ¨ afterä¹‹å‰æ‰§è¡Œ // å¯å…¼å®¹beforeå’Œafter @Around("pointCut()") public Object logAround(ProceedingJoinPoint joinPoint) throws Throwable &#123; // æ–¹æ³•å¼€å§‹ System.out.println("around methods begin ..."); Object object = joinPoint.proceed(); System.out.println("around methods end ..."); return object; &#125;&#125;/** * è¿›è¡Œæµ‹è¯• * **/@Testpublic void test1()&#123; AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BasicConfig.class); BasicService basicService = (BasicService) applicationContext.getBean("basicService"); // å› ä¸ºåˆ‡ç‚¹åŒ…æ‹¬è¿™ä¸ªbasicServiceï¼Œæ‰€ä»¥æ‰§è¡Œhelloå°±ä¼šè§¦å‘AOP basicService.hello();&#125;// ç»“æžœaround methods begin ...hellobefore...hello world!!around methods end ...after...after return... AOPä»£ç åŽŸç†åˆ†æžé€šè¿‡ä»¥ä¸Šå®žè·µï¼Œå¯ä»¥çœ‹åˆ°å¦‚æžœéœ€è¦ä½¿ç”¨Springçš„AOPåŠŸèƒ½ï¼Œéœ€è¦å…ˆä½¿ç”¨ @EnableAspectJAutoProxy æ³¨è§£æ ‡æ³¨åœ¨é…ç½®ç±»ä¸­ï¼Œä½¿ @Aspect ç”Ÿæ•ˆä¸ºä¸€ä¸ªåˆ‡é¢ç±»ã€‚ 1. @EnableAspectJAutoProxy å¼€å¯springAOPæ”¯æŒ1234567891011121314@Target(ElementType.TYPE) //æ ‡æ³¨åœ¨ç±»ä¸Š@Retention(RetentionPolicy.RUNTIME)@Documented@Import(AspectJAutoProxyRegistrar.class) //å¼•å…¥ AspectJAutoProxyRegistrarpublic @interface EnableAspectJAutoProxy &#123; /** * æ˜¯å¦ä½¿ç”¨CGLIBè¿›è¡Œä»£ç†ï¼Œé»˜è®¤æ˜¯falseï¼Œå³é»˜è®¤ä½¿ç”¨JDKåŠ¨æ€ä»£ç† **/ boolean proxyTargetClass() default false; /** * æ˜¯å¦éœ€è¦ ä»£ç†åº”ç”±AOPæ¡†æž¶å…¬å¼€ä¸º&#123;ThreadLocal&#125;ï¼Œä»¥ä¾¿é€šè¿‡&#123;AopContext&#125;ç±»è¿›è¡Œæ£€ç´¢ã€‚ **/ boolean exposeProxy() default false;&#125; é‡è¦çš„æ˜¯æ³¨è§£Importå†…å¼•ç”¨çš„AspectJAutoProxyRegistrarç±»ã€‚è¿™ä¸ªç±»é€šè¿‡ä½¿ç”¨ BeanDefinitionRegistry æ³¨å†Œä¸€ä¸ª AnnotationAwareAspectJAutoProxyCreator. 1234567891011121314151617181920212223242526@Overridepublic void registerBeanDefinitions( AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123; //å¦‚æžœéœ€è¦ æ³¨å†ŒAspectJæ³¨è§£è‡ªåŠ¨ä»£ç†åˆ›å»ºç±» internalAutoProxyCreator AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary(registry);// ...&#125;@Nullableprivate static BeanDefinition registerOrEscalateApcAsRequired( Class&lt;?&gt; cls, BeanDefinitionRegistry registry, @Nullable Object source) &#123;// cls=AnnotationAwareAspectJAutoProxyCreator Assert.notNull(registry, "BeanDefinitionRegistry must not be null"); // æ˜¯å¦å­˜åœ¨internalAutoProxyCreator if (registry.containsBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME)) &#123; // ... &#125; // èŽ·å¾—ä¸€ä¸ª AnnotationAwareAspectJAutoProxyCreator çš„ beanDefinition RootBeanDefinition beanDefinition = new RootBeanDefinition(cls); beanDefinition.setSource(source); beanDefinition.getPropertyValues().add("order", Ordered.HIGHEST_PRECEDENCE); beanDefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE); // æ³¨å†Œåä¸º org.springframework.aop.config.internalAutoProxyCreator çš„ç±» // å®žé™…å¯¹åº”çš„æ˜¯ AnnotationAwareAspectJAutoProxyCreator ç±»ï¼Œè€Œè¿™ä¸ªç±»æ˜¯ç”¨æ¥ä½¿@Aspectèµ·ä½œç”¨çš„ registry.registerBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME, beanDefinition); return beanDefinition;&#125; ä¸ºä»€ä¹ˆå¿…é¡»è¦ä½¿ç”¨ @EnableAspectJAutoProxy æ³¨è§£ æ‰èƒ½ä½¿ Spring AOP èµ·åˆ°ä½œç”¨ï¼Œç»è¿‡ä¸Šé¢çš„åˆ†æžå°±èƒ½å¤Ÿç»™å‡ºç­”æ¡ˆäº†ï¼Œå› ä¸ºåªæœ‰æ·»åŠ äº† @EnableAspectJAutoProxy è¿™ä¸ªæ³¨è§£ï¼Œæ‰èƒ½ä½¿è§£æž @Aspect æ³¨è§£çš„ AnnotationAwareAspectJAutoProxyCreator æ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚ é‚£ä¹ˆ AnnotationAwareAspectJAutoProxyCreator æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ã€‚ã€‚ 2. AnnotationAwareAspectJAutoProxyCreator å®žçŽ°AOPåŠŸèƒ½ç±»ç»“æž„åˆæ­¥åˆ†æž æ ¹æ®ä¸Šé¢çš„å›¾ç‰‡å¯ä»¥çœ‹å‡º AnnotationAwareAspectJAutoProxyCreator æœ‰ä¸¤ä¸ªé¡¶çº§æŽ¥å£ï¼Œåˆ†åˆ«æ˜¯ BeanPostProcesser å’Œ Aware æŽ¥å£ã€‚ Aware æŽ¥å£ä¸»è¦ç”¨äºŽæ ‡è®°è¶…çº§æŽ¥å£ï¼Œç”¨äºŽæŒ‡ç¤ºbeanæœ‰èµ„æ ¼é€šè¿‡å›žè°ƒæ ·å¼æ–¹æ³•ç”±Springå®¹å™¨é€šçŸ¥ç‰¹å®šæ¡†æž¶å¯¹è±¡ã€‚ BeanPostProcesser å¯ä»¥é€šè¿‡å®žçŽ° BeanPostProcesser å…è®¸è‡ªå®šä¹‰ä¿®æ”¹æ–°çš„beanå®žä¾‹ã€‚ å…¶ä¸­åŒ…æ‹¬ä¸¤ä¸ªåŽç½®å¤„ç†å™¨ï¼š1.postProcessBeforeInitialization(Object bean, String beanName) 2.postProcessAfterInitialization(Object bean, String beanName) åˆ†åˆ«é’ˆå¯¹åˆå§‹åŒ–å‰åŽçš„æ‹¦æˆªå¤„ç†ã€‚ a. AbstractAutoProxyCreatoråœ¨é€šè¿‡ä¸Šé¢å›¾ç‰‡ä¸­æ‰€çœ‹åˆ°çš„ AbstractAutoProxyCreator ç»§æ‰¿äº† ProxyProcessorSupport ç±» ç»§æ‰¿ç±»/æŽ¥å£ ä½œç”¨ éœ€è¦å®žçŽ°æ–¹æ³• ProxyConfigç±» ç”¨äºŽåˆ›å»ºä»£ç†çš„é…ç½®çš„ä¾¿åˆ©è¶…ç±»ï¼Œä¿è¯æ‰€æœ‰çš„ä»£ç†åˆ›å»ºç±»æœ‰ä¸€è‡´çš„å±žæ€§ OrderedæŽ¥å£ è¡¨ç¤ºç»§æ‰¿ç±»æ˜¯æœ‰åºçš„ BeanClassLoaderAwareæŽ¥å£ ä½¿ç”¨æŒ‡å®šçš„classLoaderæ¥åŠ è½½Bean setBeanClassLoader(ClassLoader classLoader) AopInfrastructureBeanæŽ¥å£ æ ‡ç¤ºè¯¥Beanæ˜¯ä½œä¸ºSpring AOPçš„åŸºç¡€ç»„ä»¶è¿›è¡Œä½¿ç”¨ï¼Œå› æ­¤ä¸ä¼šè¢«ä»£ç†ï¼Œå³ä½¿è¢«PointCutæŒ‡å®šåˆ°ä¹Ÿä¸ä¼šè¢«ä»£ç†åˆ° BeanFactoryAware ä½¿ç”¨æŒ‡å®šçš„ BeanFactory æ¥å®žä¾‹åŒ–Bean void setBeanFactory(BeanFactory beanFactory) b. SmartInstantiationAwareBeanPostProcessorAbstractAutoProxyCreator -&gt; å®žçŽ°è‡ª SmartInstantiationAwareBeanPostProcessor -&gt; ç»§æ‰¿è‡ª InstantiationAwareBeanPostProcessor -&gt; ç»§æ‰¿è‡ª BeanPostProcessor. InstantiationAwareBeanPostProcessor åœ¨è¿™ä¸ªæŽ¥å£ä¸­ï¼Œä¸ä»…ä»…æœ‰ç»§æ‰¿äºŽ BeanPostProcessor çš„ postProcessBeforeInitialization(Object bean, String beanName) å’Œ postProcessAfterInitialization(Object bean, String beanName) ä¸¤ä¸ªBeanåˆå§‹åŒ–å‰åŽçš„å¤„ç†æ–¹æ³•ï¼Œæœ¬èº«è¿˜å®šä¹‰äº† postProcessProperties å’Œ postProcessPropertyValuesæ–¹æ³•ã€‚ä½œç”¨æ˜¯åœ¨é’ˆå¯¹Beançš„åˆå§‹åŒ–åŽå¯¹å±žæ€§è¿›è¡ŒåŽç½®å¤„ç†ã€‚ SmartInstantiationAwareBeanPostProcessor åœ¨è¿™ä¸ªæŽ¥å£ä¸­å®šä¹‰ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ä¸º default Class&lt;?&gt; predictBeanType(Class&lt;?&gt; beanClass, String beanName) ç”¨æ¥é¢„æµ‹ä½¿ç”¨BeanPostProcessorçš„postProcessBeforeInstantiationæ–¹æ³•çš„è¿”å›žç±»åž‹ï¼Œé»˜è®¤ä¸ºnullã€‚default Constructor&lt;?&gt;[] determineCandidateConstructors(Class&lt;?&gt; beanClass, String beanName) ç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå€™é€‰çš„æž„é€ å™¨ã€‚ AbstractAutoProxyCreatorç±»æºç åˆ†æžåœ¨ AbstractAutoProxyCreator ä½œä¸º AnnotationAwareAspectJAutoProxyCreator çš„çˆ¶ç±»ï¼Œèµ·åˆ°äº†éžå¸¸é‡è¦çš„ä½œç”¨ã€‚ åœ¨ AbstractAutoProxyCreator ä¸­ï¼Œå®žçŽ°äº† BeanPostProcessor çš„åˆå§‹åŒ–å‰åŽå¤„ç†æ–¹æ³•ï¼Œç”¨æ¥é’ˆå¯¹æ¯æ¬¡åˆå§‹åŒ–Beanå‰åŽå¯¹åˆ‡é¢çš„è¯†åˆ«åˆ¤æ–­å’Œå¯¹ç¬¦åˆæ¡ä»¶çš„Beanè¿›è¡Œé€šçŸ¥çš„ä»£ç†ã€‚ 1234567891011121314151617181920212223242526272829// postProcessBeforeInitialization ,BeanPostProcessorçš„å®žçŽ°æ–¹æ³•ã€‚@Overridepublic Object postProcessBeforeInstantiation(Class&lt;?&gt; beanClass, String beanName) &#123; Object cacheKey = getCacheKey(beanClass, beanName); //èŽ·å¾—beanClass if (!StringUtils.hasLength(beanName) || !this.targetSourcedBeans.contains(beanName)) &#123; if (this.advisedBeans.containsKey(cacheKey)) &#123; return null; &#125; if (isInfrastructureClass(beanClass) || shouldSkip(beanClass, beanName)) &#123; // é€šè¿‡åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†@AspectJæ³¨è§£å®šä¹‰çš„åˆ‡é¢ç±»è¿˜æ˜¯ å®žçŽ°Adviceã€Pointcutã€Advisorã€AopInfrastructureBean this.advisedBeans.put(cacheKey, Boolean.FALSE); //æ·»åŠ åˆ°advisedBeansé‡Œé¢ï¼Œç­‰å¾…å¤„ç† return null; &#125; &#125; //å¦‚æžœä¸æ˜¯åŸºç¡€è®¾æ–½çš„ç±» TargetSource targetSource = getCustomTargetSource(beanClass, beanName); //èŽ·å¾—targetSource if (targetSource != null) &#123; if (StringUtils.hasLength(beanName)) &#123; this.targetSourcedBeans.add(beanName); &#125; Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(beanClass, beanName, targetSource); Object proxy = createProxy(beanClass, beanName, specificInterceptors, targetSource); //åˆ›å»ºä»£ç†ç±» this.proxyTypes.put(cacheKey, proxy.getClass()); return proxy; &#125; return null;&#125; åœ¨postProcessBeforeInstantiationå®žçŽ°ç±»ä¸­ï¼Œå…·ä½“æµç¨‹å¤§è‡´ä¸º å¦‚æžœæ˜¯Aspectåˆ‡é¢ç±»ï¼Œåˆ™å°†ç±»æ·»åŠ åˆ°advisedBeansä¸­ç­‰å¾…è¿›è¡ŒAdviceçš„ç»„è£…ï¼Œå¦‚æžœä¸æ˜¯åˆ‡é¢ç±»ï¼Œåˆ™ä¼šå…ˆåŽ»åˆ¤æ–­æ˜¯å¦è‡ªå®šä¹‰ä¸€ä¸ª customTargetSourceCreators æ•°ç»„ ï¼Œå¦‚æžœå®šä¹‰äº†ã€‚åˆ™ç»„è£…æˆè‡ªå®šä¹‰çš„ä»£ç†ç±»è¿›è¡Œè¿”å›žã€‚ 1. åˆ¤æ–­æ˜¯å¦æ˜¯ä¸ªåˆ‡é¢é‚£ä¹ˆæœ€ä¸»è¦çš„é—®é¢˜æ˜¯å¦‚ä½•è¿›è¡Œåˆ¤æ–­æ˜¯å¦æ˜¯Aspectåˆ‡é¢ç±»å‘¢ã€‚åªæœ‰ç³»ç»Ÿè®¤ä¸ºæ˜¯åˆ‡é¢ç±»ï¼Œæ‰èƒ½è¿›è¡ŒæŽ¥ä¸‹æ¥çš„ç»„è£…Adviceå‘é€šçŸ¥çš„åŽç»­æ“ä½œã€‚å¦åˆ™å°±ä¸èƒ½è¿›è¡Œé€šçŸ¥äº†ã€‚æ‰€ä»¥å…³é”®ç‚¹åœ¨äºŽ isInfrastructureClass æ–¹æ³•ã€‚ åœ¨ AnnotationAwareAspectJAutoProxyCreator ä¸­å­˜åœ¨ çš„isInfrastructureClass å®žçŽ°æ–¹æ³•ã€‚ 123456789101112131415161718192021222324@Overrideprotected boolean isInfrastructureClass(Class&lt;?&gt; beanClass) &#123; // åŠ ä¸Šçˆ¶ç±»ä¸­çš„isInfrastructureClassåˆ¤æ–­è§„åˆ™ return (super.isInfrastructureClass(beanClass) || (this.aspectJAdvisorFactory != null &amp;&amp; this.aspectJAdvisorFactory.isAspect(beanClass)));&#125;public boolean isAspect(Class&lt;?&gt; clazz) &#123; return (hasAspectAnnotation(clazz) &amp;&amp; !compiledByAjc(clazz));&#125;// åœ¨è¿™é‡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ Aspect æ³¨è§£private boolean hasAspectAnnotation(Class&lt;?&gt; clazz) &#123; return (AnnotationUtils.findAnnotation(clazz, Aspect.class) != null);&#125;// AbstractAutoProxyCreator ä¸­çš„æ–¹æ³•protected boolean isInfrastructureClass(Class&lt;?&gt; beanClass) &#123; boolean retVal = Advice.class.isAssignableFrom(beanClass) || //æ˜¯å¦å®žçŽ° Advice Pointcut.class.isAssignableFrom(beanClass) || //æ˜¯å¦å®žçŽ° Pointcut Advisor.class.isAssignableFrom(beanClass) || //æ˜¯å¦å®žçŽ° Advisor AopInfrastructureBean.class.isAssignableFrom(beanClass); //æ˜¯å¦å®žçŽ° AopInfrastructureBean if (retVal &amp;&amp; logger.isTraceEnabled()) &#123; logger.trace("Did not attempt to auto-proxy infrastructure class [" + beanClass.getName() + "]"); &#125; return retVal;&#125; 2.è¿›è¡Œä»£ç†çœŸæ­£çš„ä»£ç†æ˜¯å‘ç”Ÿåœ¨å®žçŽ°çš„ beanPostProcessor çš„ postProcessAfterInitialization åœ¨ AbstractAutoProxyCreator ä¸­æä¾›ç±»ä¸€ä¸ªåˆå§‹åŒ–åŽç½®å¤„ç†å™¨ postProcessAfterInitialization ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142public Object postProcessAfterInitialization(@Nullable Object bean, String beanName) &#123; if (bean != null) &#123; Object cacheKey = getCacheKey(bean.getClass(), beanName); if (this.earlyProxyReferences.remove(cacheKey) != bean) &#123; // å¦‚æžœä¸å­˜åœ¨ // å¦‚æžœéœ€è¦è¿›è¡Œä»£ç†çš„åŒ…è£… return wrapIfNecessary(bean, beanName, cacheKey); &#125; &#125; return bean;&#125;//å¦‚æœ‰å¿…è¦ï¼ŒåŒ…è£…ç»™å®šçš„beanï¼Œå³æ˜¯å¦æœ‰èµ„æ ¼è¢«ä»£ç†protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) &#123; if (StringUtils.hasLength(beanName) &amp;&amp; this.targetSourcedBeans.contains(beanName)) &#123; // å¦‚æžœåœ¨ postProcessBeforeInitialization ä¸­å®šä¹‰äº†targetSourcedBeans,åˆ™ç›´æŽ¥è¿”å›ž return bean; &#125; if (Boolean.FALSE.equals(this.advisedBeans.get(cacheKey))) &#123; // å¦‚æžœå·²ç»æ·»åŠ åˆ°advisedBeansä¸­ä¹Ÿç›´æŽ¥è¿”å›ž return bean; &#125; // å¦‚æžœæ˜¯ä¸€ä¸ªåŸºæœ¬é…ç½®Aspectç±»ï¼Œåˆ™æ”¾åˆ°advisedBeansä¸­ã€‚ if (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) &#123; this.advisedBeans.put(cacheKey, Boolean.FALSE); return bean; &#125; // åˆ›å»ºAdviceï¼Œåˆ›å»ºadviceçš„è¿‡ç¨‹å…ˆçœç•¥ Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null); // Adviceå­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºéœ€è¦ä»£ç† if (specificInterceptors != DO_NOT_PROXY) &#123; this.advisedBeans.put(cacheKey, Boolean.TRUE); // åˆ›å»ºä»£ç† Object proxy = createProxy( bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean)); this.proxyTypes.put(cacheKey, proxy.getClass()); // è¿”å›žä»£ç†å¯¹è±¡ã€‚ return proxy; &#125; this.advisedBeans.put(cacheKey, Boolean.FALSE); return bean;&#125; AOPå¯¹ç±»çš„åŠ è½½åŒ…è£…è¿‡ç¨‹æ¯æ¬¡åœ¨åˆ›å»ºBeanæ—¶ï¼Œä¼šé€šè¿‡createBean()æ–¹æ³•æ¥åˆ›å»ºBeanï¼Œå…¶ä¸­åœ¨çœŸæ­£çš„åˆ›å»ºBeanä¹‹å‰æ‰§è¡Œäº†resolveBeforeInstantiation åŽ»ç”Ÿæˆä»£ç†Beanã€‚ 123456789101112131415161718192021222324252627282930try &#123; Object bean = resolveBeforeInstantiation(beanName, mbdToUse); if (bean != null) &#123; return bean; &#125;&#125;try &#123; // åˆ›å»ºBean Object beanInstance = doCreateBean(beanName, mbdToUse, args); if (logger.isTraceEnabled()) &#123; logger.trace("Finished creating instance of bean '" + beanName + "'"); &#125; return beanInstance;&#125;// ç”Ÿæˆä»£ç†å¯¹è±¡æ–¹æ³•protected Object resolveBeforeInstantiation(String beanName, RootBeanDefinition mbd) &#123; Object bean = null; if (!Boolean.FALSE.equals(mbd.beforeInstantiationResolved)) &#123; // Make sure bean class is actually resolved at this point. if (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) &#123; Class&lt;?&gt; targetType = determineTargetType(beanName, mbd); if (targetType != null) &#123; bean = applyBeanPostProcessorsBeforeInstantiation(targetType, beanName); // ã€‚ã€‚ã€‚ &#125; &#125; mbd.beforeInstantiationResolved = (bean != null); &#125; return bean;&#125; åœ¨è¿™é‡ŒçœŸæ­£æ‰§è¡Œäº†åˆ›å»ºä»£ç†å¯¹è±¡ä¸­çš„beanåˆå§‹åŒ–å‰åŽæ–¹æ³•ã€‚å…ˆæ‰§è¡Œäº† applyBeanPostProcessorsBeforeInstantiation , è¿›è¡ŒAOPåˆ‡é¢ç±»çš„è¯†åˆ«ã€‚ 12345678910111213141516@Nullableprotected Object applyBeanPostProcessorsBeforeInstantiation(Class&lt;?&gt; beanClass, String beanName) &#123; for (BeanPostProcessor bp : getBeanPostProcessors()) &#123; if (bp instanceof InstantiationAwareBeanPostProcessor) &#123; // å¯¹æ¯ä¸€ä¸ªBeanåˆ›å»ºå‰éƒ½è¿›è¡Œä¸€æ¬¡å¤„ç†ï¼Œå‰ææ˜¯ è¿™ä¸ªç±»å®žçŽ° // InstantiationAwareBeanPostProcessor æŽ¥å£ã€‚ InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp; // å¦‚æžœå®žçŽ°è¿™ä¸ªæŽ¥å£ï¼Œåˆ™è¿›è¡Œå®žä¾‹åŒ–å‰çš„åŽç½®å¤„ç†ã€‚ Object result = ibp.postProcessBeforeInstantiation(beanClass, beanName); if (result != null) &#123; return result; &#125; &#125; &#125; return null;&#125; åœ¨createBeanæ–¹æ³•æ—¶ï¼š 12345678// Initialize the bean instance.Object exposedObject = bean;try &#123; // å¡«å……Bean populateBean(beanName, mbd, instanceWrapper); // åˆå§‹åŒ–Bean exposedObject = initializeBean(beanName, exposedObject, mbd);&#125; åœ¨ initializeBean ä¸­æ‰çœŸæ­£çš„æ‰§è¡Œç»§æ‰¿ BeanPostProcessor ç±»çš„Beanåˆå§‹åŒ–å‰åŽçš„CallBackæ–¹æ³•ã€‚ 123456789101112131415if (mbd == null || !mbd.isSynthetic()) &#123; wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);&#125;try &#123; invokeInitMethods(beanName, wrappedBean, mbd);&#125;catch (Throwable ex) &#123; throw new BeanCreationException( (mbd != null ? mbd.getResourceDescription() : null), beanName, "Invocation of init method failed", ex);&#125;if (mbd == null || !mbd.isSynthetic()) &#123; wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);&#125; æ‰€ä»¥ï¼Œç»¼ä¸Šï¼Œåœ¨ createbean æ–¹æ³•ä¹‹å‰ä¼šæ‰§è¡Œå¯¹åˆ‡é¢ç±»çš„è¯†åˆ«ï¼Œä¹Ÿå°±æ˜¯åˆ‡é¢ç±»çš„å‰ç½®å¤„ç†ã€‚ä½†çœŸæ­£åŽ»æ‰§è¡Œæ‰€æœ‰çš„Beançš„é€šçŸ¥ï¼Œéƒ½æ˜¯åœ¨ initializeBean ä¸­çš„ applyBeanPostProcessorsAfterInitialization æ–¹æ³•ä¸­æ‰§è¡Œçš„ã€‚ Springåˆ›å»ºä»£ç†çš„æ–¹å¼SpringAOPåˆ›å»ºä»£ç†æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§ï¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†ã€‚ç¬¬äºŒç§ï¼šä½¿ç”¨CGLIBä»£ç†ã€‚ä¸‹é¢æ¥é’ˆå¯¹ä»£ç†æ–¹å¼çš„é€‰æ‹©æ–¹å¼ï¼ŒæŸ¥çœ‹æºç ä¸€æŽ¢ç©¶ç«Ÿã€‚ åœ¨ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„åœ¨ AbstractAutoProxyCreator ä¸­çš„åœ¨åŽç½®å¤„ç†å™¨ä¸­ postProcessAfterInitialization çš„ wrapIfNecessaryä¸­è¿›è¡Œäº†å¯¹Beançš„ä»£ç†åŒ…è£…å¤„ç†. 12345678910// å¦‚æžœå­˜åœ¨å¯ç”¨çš„é€šçŸ¥ï¼Œåˆ™å¯¹Beanè¿›è¡Œä»£ç†Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null);if (specificInterceptors != DO_NOT_PROXY) &#123; this.advisedBeans.put(cacheKey, Boolean.TRUE); // åˆ›å»ºä»£ç†å¯¹è±¡ Object proxy = createProxy( bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean)); this.proxyTypes.put(cacheKey, proxy.getClass()); return proxy;&#125; åœ¨ createProxy ä¸­å†³å®šäº†ä½¿ç”¨å“ªç§æ–¹å¼ï¼ˆJDKåŠ¨æ€ä»£ç†ã€CGLIBä»£ç†ï¼‰è¿›è¡Œä»£ç†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344protected Object createProxy(Class&lt;?&gt; beanClass, @Nullable String beanName, @Nullable Object[] specificInterceptors, TargetSource targetSource) &#123; if (this.beanFactory instanceof ConfigurableListableBeanFactory) &#123; AutoProxyUtils.exposeTargetClass((ConfigurableListableBeanFactory) this.beanFactory, beanName, beanClass); &#125; ProxyFactory proxyFactory = new ProxyFactory(); proxyFactory.copyFrom(this);// å¤åˆ¶é…ç½® if (!proxyFactory.isProxyTargetClass()) &#123;//è¿”å›žæ˜¯å¦ç›´æŽ¥ä»£ç†ç›®æ ‡ç±»ä»¥åŠä»»ä½•æŽ¥å£ã€‚ if (shouldProxyTargetClass(beanClass, beanName)) &#123; // å¦‚æžœ proxy-target-class æ ‡ç­¾å±žæ€§è¿”å›žtrueï¼Œåˆ™è¡¨æ˜Žéœ€è¦åŸºäºŽç±»çš„ä»£ç†ï¼Œ // åä¹‹åˆ™éœ€è¦åŸºäºŽæŽ¥å£çš„ä»£ç† proxyFactory.setProxyTargetClass(true); //ä½¿ç”¨CGLIBä»£ç†ï¼ˆtrueï¼‰ &#125;else &#123; evaluateProxyInterfaces(beanClass, proxyFactory); //æ£€æŸ¥æ˜¯å¦å®žçŽ°äº†æŽ¥å£ // å¦‚æžœå®žçŽ°äº†æŽ¥å£ï¼Œåˆ™è®¾ç½®interfaceï¼Œå¦åˆ™è®¾ç½®proxyTargetClassä¸ºtrueï¼Œä½†å‰ææ˜¯ // ç”¨æˆ·æ²¡æœ‰è‡ªå·±è®¾ç½®proxyTargetClasså±žæ€§ /** * if (hasReasonableProxyInterface) &#123; * Must allow for introductions; can't just set interfaces to the target's interfaces only. * for (Class&lt;?&gt; ifc : targetInterfaces) &#123; * proxyFactory.addInterface(ifc); * &#125; *&#125;else &#123; * proxyFactory.setProxyTargetClass(true); *&#125; */ &#125; &#125; Advisor[] advisors = buildAdvisors(beanName, specificInterceptors); proxyFactory.addAdvisors(advisors); proxyFactory.setTargetSource(targetSource); customizeProxyFactory(proxyFactory); proxyFactory.setFrozen(this.freezeProxy); if (advisorsPreFiltered()) &#123; proxyFactory.setPreFiltered(true); &#125; return proxyFactory.getProxy(getProxyClassLoader());&#125; åœ¨è¿™é‡Œè®¾ç½®äº†æœ‰å…³äºŽproxyFactoryçš„ç›¸å…³å±žæ€§ï¼Œ å¦‚æ˜¯å¦ç»§æ‰¿æŽ¥å£çš„interfaceï¼Œå’Œ ProxyTargetClass ã€‚å¦‚æžœæ²¡æœ‰å®žçŽ°interfaceï¼Œåˆ™ä¼šè‡ªåŠ¨å°†ProxyTargeClassä¸ºtrueï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸¤ä¸ªå±žæ€§æ˜¯ç›¸å¯¹çš„ã€‚ åœ¨æœ€åŽçš„retrunçš„ getProxy() æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨ DefaultAopProxyFactory ç±»ä¸­çš„ createAopProxy æ–¹æ³•å†³å®šä½¿ç”¨å“ªä¸­ä»£ç†æ–¹å¼è¿›è¡Œä»£ç†ã€‚ 12345678910111213141516171819202122232425public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException &#123; /* * ä¸‹é¢çš„ä¸‰ä¸ªæ¡ä»¶ç®€å•åˆ†æžä¸€ä¸‹ï¼š * * æ¡ä»¶1ï¼šconfig.isOptimize() - æ˜¯å¦éœ€è¦ä¼˜åŒ– * æ¡ä»¶2ï¼šconfig.isProxyTargetClass() - æ£€æµ‹ proxyTargetClass çš„å€¼ï¼Œ * æ¡ä»¶3ï¼šhasNoUserSuppliedProxyInterfaces(config) - ç›®æ ‡ bean æ˜¯å¦å®žçŽ°äº†æŽ¥å£ * */ if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) &#123; // å¦‚æžœè®¾ç½®äº†optimize æˆ–è€… proxyTargetClass æˆ–è€…è®¾ç½®äº†è¿›è¡Œä»£ç†çš„æŽ¥å£ Class&lt;?&gt; targetClass = config.getTargetClass(); if (targetClass == null) &#123; throw new AopConfigException("TargetSource cannot determine target class: " + "Either an interface or a target is required for proxy creation."); &#125; if (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) &#123; return new JdkDynamicAopProxy(config); //å¦‚æžœä»£ç†çš„æ˜¯æŽ¥å£ï¼Œä½¿ç”¨JDKåŠ¨æ€ä»£ç† &#125; return new ObjenesisCglibAopProxy(config);//å¦åˆ™ä½¿ç”¨CGlibä»£ç† &#125; else &#123; //å¦åˆ™éƒ½ä½¿ç”¨JDKè¿›è¡Œä»£ç† return new JdkDynamicAopProxy(config); &#125;&#125; å‰é¢è¯´çš„å¦‚æžœè‡ªå·±è®¾ç½®ç±»proxyTargetClasså±žæ€§ä¸ºtrueï¼Œå°±ä¸ä¼šåˆ¤æ–­æ˜¯ç»§æ‰¿äº†interfaceã€‚å¦‚æžœæ²¡æœ‰å•ç‹¬è®¾ç½®ï¼Œåˆ™ä¼šå…ˆåˆ¤æ–­æ˜¯å¦ç»§æ‰¿äº†æŽ¥å£ï¼Œå¦‚æžœæ²¡æœ‰åˆ™ä¼šè‡ªåŠ¨è®¾ç½®proxyTargetClasså±žæ€§ä¸ºtrueã€‚ æ‰€ä»¥å¾—å‡ºç»“è®ºï¼š å¦‚æžœè®¾ç½®äº†proxyTargetClassä¸ºtrueï¼Œåˆ™ä½¿ç”¨CGLIBä»£ç†ã€‚ å¦‚æžœæ²¡æœ‰è®¾ç½®proxyTargetClassï¼Œå¦‚æžœæ˜¯æŽ¥å£ï¼Œåˆ™ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ã€‚å¦‚æžœæ²¡æœ‰å®žçŽ°æŽ¥å£ï¼Œåˆ™è¿˜æ˜¯ä¼šä½¿ç”¨CGLIBè¿›è¡Œä»£ç†ã€‚]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springä¸­çš„è‡ªåŠ¨è£…é…]]></title>
    <url>%2F2019%2F12%2F07%2F%EF%BC%88%E4%B8%89%EF%BC%89%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%2F</url>
    <content type="text"><![CDATA[Springä¸­çš„è‡ªåŠ¨è£…é…@Autowireã€ @Qualifierã€@Primary@Autowire æ³¨è§£æ ‡æ³¨åœ¨constructor, field, setter method ä¸Šï¼Œæ–¹ä¾¿åœ¨Springä¸­è¿›è¡Œä¾èµ–çš„æ³¨å…¥ï¼ˆdependency injectionï¼‰ã€‚å’ŒJSR-330æ ‡å‡†javax.inject.Injectè¾¾åˆ°ä¸€æ ·çš„æ•ˆæžœï¼Œä¸è¿‡autowiredæ—¶SpringæŒæœ‰çš„ã€‚ é»˜è®¤ä½¿ç”¨Autowireæ˜¯æŒ‰ç…§ç±»åž‹è¿›è¡Œæ³¨å…¥çš„ï¼Œä½†æ˜¯å¦‚æžœåœ¨å®¹å™¨ä¸­å­˜åœ¨å¤šä¸ªç±»åž‹ç›¸åŒçš„beanæ—¶ï¼Œ@Autowiredä¹Ÿä¼šæŒ‰ç…§åç§°è¿›è¡ŒåŒ¹é…ã€‚ ä½¿ç”¨@Qualifieræ³¨è§£ï¼Œåœ¨èŽ·å–Beanæ—¶ï¼ŒæŒ‡å®šè¦èŽ·å–çš„beançš„åç§°ã€‚ ä½¿ç”¨@Primaryæ³¨è§£ï¼Œåœ¨å£°æ˜ŽBeanæ—¶ï¼ŒæŒ‡å®šå¦‚æžœæ³¨å…¥ï¼Œåˆ™é¦–é€‰çš„beanã€‚ 1234567891011121314151617181920212223@Componentpublic class Person &#123; private String firstName; private String lastName; public Person(String firstName, String lastName) &#123; this.firstName = "w"; this.lastName = "y"; &#125; @Autowired @Qualifier("abc") private Pet pet;// çœç•¥getter setter&#125;// æˆ–è€…åœ¨å£°æ˜ŽBeanæ—¶ï¼Œä½¿ç”¨Primaryè¿›è¡ŒæŒ‡å®šã€‚@Bean("dotdot")@Primarypublic Pet pet2()&#123; return new Pet("dotdot");&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨åŒæ—¶æŒ‡å®šQualifierå’ŒPrimaryæ—¶ï¼Œä¼šä»¥Qualifierä¸ºä¸»ã€‚ @Injectã€@Named@Injectã€@Named éƒ½æ˜¯Javaxè§„èŒƒçš„æ³¨è§£ï¼Œå¹¶ä¸æ˜¯Springçš„æ³¨è§£ã€‚ ä½¿ç”¨ Inject æ³¨è§£åŒæ ·èƒ½å¤Ÿæ ‡æ³¨åœ¨constructor, field, setter method ä¸Šã€‚åŸºæœ¬èƒ½å¤Ÿä»£æ›¿ Autowired æ³¨è§£ï¼Œå¹¶ä¸”èƒ½å¤Ÿä½¿ç”¨ Named æ³¨è§£ï¼ŒæŒ‡å®šåç§°è¿›è¡Œå®žä¾‹çš„æ³¨å…¥ï¼Œå¯ä»¥ä»£æ›¿ Qualifier æ³¨è§£ã€‚ 123456789101112131415@Componentpublic class Person &#123; private String firstName; private String lastName; public Person(String firstName, String lastName) &#123; this.firstName = "w"; this.lastName = "y"; &#125; @Inject @Named("abc") private Pet pet; // çœç•¥getter setter&#125; åŒºåˆ«ç‚¹åœ¨äºŽ Autowired æ³¨è§£æ”¯æŒ required() å±žæ€§ã€‚è€Œ Inject æ³¨è§£å¹¶ä¸æ”¯æŒã€‚å¯ä»¥ä½¿ç”¨java.util.Optionalæˆ–è€…Spring Framework 5.0 åŽæä¾›çš„ @Nullable æ³¨è§£ï¼Œæ ‡å¿—åœ¨æž„é€ æ–¹æ³•ä¸Šã€‚ 1234public class SimpleMovieLister &#123;@Autowired public void setMovieFinder(@Nullable MovieFinder movieFinder) &#123; ...&#125;]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springçš„å¯åŠ¨å’Œæ³¨å†Œ]]></title>
    <url>%2F2019%2F12%2F05%2FSpring%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%B9%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[å¯åŠ¨Springåº”ç”¨åªéœ€ç®€å•çš„å‡ è¡Œä»£ç ä¾¿å¯å£°æ˜Žã€åˆ›å»ºä¸€ä¸ªSpringåº”ç”¨å®¹å™¨ã€‚ 1234567891011AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(BasicConfig.class);// å‰ææ˜¯éœ€è¦ä¼ å…¥ç»™å®šçš„classé…ç½®ç±»@Configuration // ä½¿ç”¨Configuration è¡¨æ˜Žæ˜¯ä¸ªé…ç½®ç±»@EnableAspectJAutoProxy// å¼€å§‹AOPæ”¯æŒ@ComponentScan("com.nanyin")//æ‰«æåŒ…public class BasicConfig &#123; @Bean("person") public Person person()&#123; return new Person("1","2"); &#125;&#125; åˆ›å»ºå®¹å™¨åœ¨è¿›å…¥åˆ° new AnnotationConfigApplicationContext() æ–¹æ³•åŽï¼Œè¿›è¡Œå¯¹å®¹å™¨çš„å£°æ˜Žå’Œåˆ›å»ºã€‚å…¶ä¸­ä¼šå…ˆå¯¹ç»™å®šçš„é…ç½®æ–‡ä»¶ç±»è¿›è¡Œæ ¡éªŒå’Œæ³¨å†Œã€‚è°ƒç”¨è¿‡ç¨‹è‰å›¾å¦‚ä¸‹æ‰€ç¤ºï¼ˆä»…å‚è€ƒï¼‰ï¼š å¯ä»¥çœ‹åˆ°åŸºæœ¬çš„è°ƒç”¨é¡ºåºï¼Œä¸‹é¢æ ¹æ®å›¾ä¸­æ‰€ç¤ºï¼Œé’ˆå¯¹è°ƒç”¨çš„æ–¹æ³•è¿›è¡Œæºç çš„åˆ†æžã€‚ åˆ›å»º AnnotationConfigApplicationContext å› ä¸ºåœ¨ä½¿ç”¨ new AnnotationConfigApplicationContext() æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„åŒæ—¶ä¼šå…ˆåŽ»è°ƒç”¨çˆ¶ç±»çš„ç©ºå‚æ•°çš„æž„é€ æ–¹æ³•ã€‚æ‰€ä»¥æ ¹æ®å›¾ä¸­çš„å…³ç³»ï¼Œéœ€è¦å…ˆçœ‹çˆ¶ç±»ä¸­é€šè¿‡è¿™äº›æž„é€ æ–¹æ³•åšäº†ä»€ä¹ˆï¼š 1234567891011121314public GenericApplicationContext() &#123; this.beanFactory = new DefaultListableBeanFactory();&#125;public AbstractApplicationContext() &#123; this.resourcePatternResolver = getResourcePatternResolver();&#125;protected ResourcePatternResolver getResourcePatternResolver() &#123; return new PathMatchingResourcePatternResolver(this);&#125;public DefaultResourceLoader() &#123; this.classLoader = ClassUtils.getDefaultClassLoader();&#125; é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥å‘çŽ°è°ƒç”¨ new AnnotationConfigApplicationContext() æ—¶ä¼šå‘ç”Ÿï¼š è®¾ç½® beanFactory ä¸º DefaultListableBeanFactory ç±»åž‹ è®¾ç½® resourcePatternResolver ä¸º PathMatchingResourcePatternResolver ç±»åž‹ è®¾ç½® classLoader ä¸ºé»˜è®¤çš„çº¿ç¨‹çŽ¯å¢ƒçš„ classLoader 12345678910public AnnotationConfigApplicationContext(Class&lt;?&gt;... componentClasses) &#123; this(); register(componentClasses); //æ³¨å†Œç»™å®šçš„é…ç½®ç±»Bean refresh(); //åˆ·æ–°æ–¹æ³•&#125;// thisè°ƒç”¨ç©ºçš„æž„é€ å‡½æ•°ï¼Œå…¶ä¸­åˆ¶å®šäº† AnnotatedBeanDefinitionReader å’Œ ClassPathBeanDefinitionScannerpublic AnnotationConfigApplicationContext() &#123; this.reader = new AnnotatedBeanDefinitionReader(this); this.scanner = new ClassPathBeanDefinitionScanner(this);&#125; åœ¨å‰ä¸€èŠ‚ä¸­ä½¿ç”¨äº† new AnnotationConfigApplicationContext(BasicConfig.class) æ¥åˆ›å»ºäº†ä¸€ä¸ª AnnotationConfigApplicationContext ã€‚è¿›å…¥åˆ°æºç ä¸­å¯ä»¥å‘çŽ°ä»–ä¼šå…ˆåˆå§‹åŒ–ä¸€ä¸ª reader å’Œä¸€ä¸ª sacnnerã€‚ åˆ†åˆ«çš„ä½œç”¨ä¸º ï¼š AnnotatedBeanDefinitionReader ç”¨äºŽä»¥ç¼–ç¨‹æ–¹å¼æ³¨å†ŒBeanç±»,è¿™äº›Beanä¸»è¦æŒ‡çš„æ—¶ä¸€äº›PostProcessor ClassPathBeanDefinitionScanner ä¸€ä¸ªå¯åœ¨ç±»è·¯å¾„ä¸Šæœç´¢å€™é€‰beançš„beanå®šä¹‰æ‰«æå™¨ã€‚ AnnotatedBeanDefinitionReaderç”¨äºŽä»¥ç¼–ç¨‹æ–¹å¼æ³¨å†ŒBeanç±»,è¿™äº›Beanä¸»è¦æŒ‡çš„æ—¶ä¸€äº›PostProcessor. 12345678910111213141516171819202122232425262728293031323334353637383940public AnnotatedBeanDefinitionReader(BeanDefinitionRegistry registry, Environment environment) &#123; Assert.notNull(registry, "BeanDefinitionRegistry must not be null"); Assert.notNull(environment, "Environment must not be null"); this.registry = registry; //ConditionEvaluator ç”¨äºŽå¯¹ @Condition æ³¨è§£çš„è¯„ä¼° this.conditionEvaluator = new ConditionEvaluator(registry, environment, null); AnnotationConfigUtils.registerAnnotationConfigProcessors(this.registry);&#125;/** * å¤„ç†ç›¸å…³æ³¨è§£çš„åŽç½®å¤„ç†å™¨å¦‚ ConfigurationClassPostProcessor ç­‰ */public static Set&lt;BeanDefinitionHolder&gt; registerAnnotationConfigProcessors( BeanDefinitionRegistry registry, @Nullable Object source) &#123; // èŽ·å– BeanFactory,å…¶å®žè¿™é‡Œè¿”å›žäº†ä¸€ä¸ªthis.beanFactory,ä¹Ÿå°±æ˜¯ DefaultListableBeanFactory DefaultListableBeanFactory beanFactory = unwrapDefaultListableBeanFactory(registry); if (beanFactory != null) &#123; if (!(beanFactory.getDependencyComparator() instanceof AnnotationAwareOrderComparator)) &#123; beanFactory.setDependencyComparator(AnnotationAwareOrderComparator.INSTANCE); &#125; if (!(beanFactory.getAutowireCandidateResolver() instanceof ContextAnnotationAutowireCandidateResolver)) &#123; beanFactory.setAutowireCandidateResolver(new ContextAnnotationAutowireCandidateResolver()); &#125; &#125; Set&lt;BeanDefinitionHolder&gt; beanDefs = new LinkedHashSet&lt;&gt;(8); // æ³¨å†ŒConfigurationClassPostProcessor ä¹Ÿå°±æ˜¯å¯¹åº”çš„@Configurationæ³¨è§£postprocessor if (!registry.containsBeanDefinition(CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123; RootBeanDefinition def = new RootBeanDefinition(ConfigurationClassPostProcessor.class); def.setSource(source); beanDefs.add(registerPostProcessor(registry, def, CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME)); &#125; // æ³¨å†ŒAutowiredAnnotationBeanPostProcessor,å¯¹åº”çš„æ—¶@Autowiredå¯¹åº”çš„postProcessor if (!registry.containsBeanDefinition(AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123; RootBeanDefinition def = new RootBeanDefinition(AutowiredAnnotationBeanPostProcessor.class); def.setSource(source); beanDefs.add(registerPostProcessor(registry, def, AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)); &#125;// ........ return beanDefs;&#125; ClassPathBeanDefinitionScannerä¸€ä¸ªå¯åœ¨ç±»è·¯å¾„ä¸Šæœç´¢å€™é€‰beançš„beanå®šä¹‰æ‰«æå™¨ã€‚ 12345678910111213public ClassPathBeanDefinitionScanner(BeanDefinitionRegistry registry, boolean useDefaultFilters, Environment environment, @Nullable ResourceLoader resourceLoader) &#123; Assert.notNull(registry, "BeanDefinitionRegistry must not be null"); this.registry = registry; if (useDefaultFilters) &#123; registerDefaultFilters(); &#125; // è¿™é‡Œçš„environmentæ—¶åœ¨çˆ¶ç±»ä¸­çš„æž„é€ å‡½æ•°ä¸­ç»™å‡ºçš„ new StandardEnvironment() setEnvironment(environment); setResourceLoader(resourceLoader);&#125; ä¸Šé¢çš„é€»è¾‘å¾ˆæ¸…æ™°ï¼š éœ€è¦æ³¨å†Œä¸€äº›é»˜è®¤çš„è¿‡æ»¤å™¨ï¼ˆFiltersï¼‰ è®¾ç½®çŽ¯å¢ƒå˜é‡environment è®¾ç½®resourceLoader åœ¨å®šä¹‰å®ŒæˆåŽè°ƒç”¨registeræ–¹æ³•è¿›è¡Œå¯¹æŒ‡å®šçš„é…ç½®æ–‡ä»¶è¿›è¡Œæ³¨å†Œã€‚ register æ³¨å†Œç»™å®šé…ç½®ç±»123456789101112@Overridepublic void register(Class&lt;?&gt;... componentClasses) &#123; Assert.notEmpty(componentClasses, "At least one component class must be specified"); this.reader.register(componentClasses); //è°ƒç”¨ AnnotatedBeanDefinitionReader çš„register æ–¹æ³•&#125;public void register(Class&lt;?&gt;... componentClasses) &#123; for (Class&lt;?&gt; componentClass : componentClasses) &#123; // å¯¹æ¯ä¸ªç»™å®šçš„classè¿›è¡Œ registerBean registerBean(componentClass); &#125;&#125; registerBean(Class&lt;?&gt; beanClass)åœ¨ä¸Šä¸€æ­¥çš„ registerBean ä¸­è°ƒç”¨äº†å·²ç»åˆ›å»ºå¥½çš„ AnnotatedBeanDefinitionReader çš„ registerBeanæ–¹æ³•ï¼š 12345678910public void register(Class&lt;?&gt;... componentClasses) &#123; for (Class&lt;?&gt; componentClass : componentClasses) &#123; // å¯¹æ¯ä¸ªç»™å®šçš„classè¿›è¡Œ registerBean registerBean(componentClass); &#125;&#125;public void registerBean(Class&lt;?&gt; beanClass) &#123; doRegisterBean(beanClass, null, null, null, null);&#125; åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œå¯¹æ¯ä¸€ä¸ª class å¾ªçŽ¯è°ƒç”¨ doRegisterBean æ–¹æ³•è¿›è¡Œ å¯¹ BeanClass çš„æ³¨å†Œæ“ä½œã€‚ doRegisterBeanè¿™ä¸€æ­¥æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€æ­¥ï¼š å£°æ˜Ž BeanDefinition ä¸º AnnotatedGenericBeanDefinition ã€‚ é€šè¿‡ conditionEvaluator.shouldSkip() æ–¹æ³•é€šè¿‡å¯¹ @Conditional æ³¨è§£æ¥åˆ¤æ–­æ˜¯å¦è·³è¿‡æ³¨å†Œ é€šè¿‡ scopeMetadataResolver.resolveScopeMetadata æ¥èŽ·å–ä½œç”¨åŸŸï¼Œç„¶åŽå†æ”¾åˆ° BeanDefinition ä¸­ã€‚ é€šè¿‡ beanNameGenerator.generateBeanName æ¥è®¾ç½®Beanåœ¨å®¹å™¨ä¸­çš„åç§°ã€‚ é€šè¿‡ processCommonDefinitionAnnotations è®¾ç½®Beançš„åŸºæœ¬å±žæ€§ æœ€åŽé€šè¿‡ è°ƒç”¨registerBeanDefinition å¯¹åŒ…è£…å¥½çš„ BeanDefinitionHolder è¿›è¡Œæœ€åŽçš„æ³¨å†Œæ“ä½œã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041private &lt;T&gt; void doRegisterBean(Class&lt;T&gt; beanClass, @Nullable String name, @Nullable Class&lt;? extends Annotation&gt;[] qualifiers, @Nullable Supplier&lt;T&gt; supplier, @Nullable BeanDefinitionCustomizer[] customizers) &#123; AnnotatedGenericBeanDefinition abd = new AnnotatedGenericBeanDefinition(beanClass); if (this.conditionEvaluator.shouldSkip(abd.getMetadata())) &#123; // é€šè¿‡åˆ¤æ–­Conditionalæ³¨è§£ï¼Œæ¥åˆ¤æ–­æ˜¯å¦è·³è¿‡ return; &#125; //å¤„ç†åˆ›å»ºçš„å›žè°ƒ abd.setInstanceSupplier(supplier); ScopeMetadata scopeMetadata = this.scopeMetadataResolver.resolveScopeMetadata(abd); // å¤„ç†ä½œç”¨åŸŸ æ”¾åˆ°scopeMetadataé‡Œé¢ abd.setScope(scopeMetadata.getScopeName());//å†æ”¾åˆ° BeanDefinition é‡Œ String beanName = (name != null ? name : this.beanNameGenerator.generateBeanName(abd, this.registry)); //è®¾ç½®BeanName AnnotationConfigUtils.processCommonDefinitionAnnotations(abd); // è®¾ç½®ä¸€äº›åŸºæœ¬å±žæ€§ å¦‚ Lazyï¼ŒPrimary ã€‚ã€‚ã€‚ if (qualifiers != null) &#123; for (Class&lt;? extends Annotation&gt; qualifier : qualifiers) &#123; if (Primary.class == qualifier) &#123; abd.setPrimary(true); &#125; else if (Lazy.class == qualifier) &#123; abd.setLazyInit(true); &#125; else &#123; abd.addQualifier(new AutowireCandidateQualifier(qualifier)); &#125; &#125; &#125; if (customizers != null) &#123; for (BeanDefinitionCustomizer customizer : customizers) &#123; customizer.customize(abd); &#125; &#125; BeanDefinitionHolder definitionHolder = new BeanDefinitionHolder(abd, beanName); // åˆ›å»ºä¸€ä¸ªdefinitionHolderï¼Œä½œç”¨æ˜¯ å…·æœ‰åç§°å’Œåˆ«åçš„BeanDefinitionçš„æŒæœ‰äºº definitionHolder = AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, this.registry); //è®¾ç½®ä½œç”¨åŸŸ BeanDefinitionReaderUtils.registerBeanDefinition(definitionHolder, this.registry);&#125; registerBeanDefinition123456789101112131415public static void registerBeanDefinition( BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry) throws BeanDefinitionStoreException &#123; String beanName = definitionHolder.getBeanName(); registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition()); // æ³¨å†Œåˆ«å String[] aliases = definitionHolder.getAliases(); if (aliases != null) &#123; for (String alias : aliases) &#123; registry.registerAlias(beanName, alias); &#125; &#125;&#125; ä¹‹åŽä¼šè°ƒç”¨ DefaultListableBeanFactory ä¸­çš„ registBeanDefinition æ–¹æ³•å¯¹Beanè¿›è¡Œæ³¨å†Œã€‚å®žé™…çš„æ³¨å†Œè¿‡ç¨‹å°±æ˜¯å°†Beançš„åç§°ä½œä¸ºkeyï¼ŒBeançš„BeanDefinitionä½œä¸ºvalueå­˜å‚¨åœ¨ä¸€ä¸ªå…¨å±€çš„beanDefinitionMapä¸­ã€‚ 12345678synchronized (this.beanDefinitionMap) &#123; this.beanDefinitionMap.put(beanName, beanDefinition); //å®žé™…ä¸Šå°±æ˜¯ä¸€ä¸ªConcurrentHashMap å­˜å‚¨ beanDefinition ä½¿ç”¨BeanNameä½œä¸ºKey List&lt;String&gt; updatedDefinitions = new ArrayList&lt;&gt;(this.beanDefinitionNames.size() + 1); // æ·»åŠ åˆ°updatedDefinitionsé‡Œé¢ updatedDefinitions.addAll(this.beanDefinitionNames); updatedDefinitions.add(beanName); this.beanDefinitionNames = updatedDefinitions; removeManualSingletonName(beanName);&#125; è‡³æ­¤ï¼ŒSpringå®¹å™¨çš„åˆ›å»ºï¼Œå’Œå¯¹é…ç½®æ–‡ä»¶çš„æ³¨å†Œå°±å®Œæˆäº†ã€‚]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Beançš„ç”Ÿå‘½å‘¨æœŸ]]></title>
    <url>%2F2019%2F12%2F05%2F%EF%BC%88%E4%BA%8C%EF%BC%89Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%2F</url>
    <content type="text"><![CDATA[Beançš„ç”Ÿå‘½å‘¨æœŸ Beançš„åˆå§‹åŒ–å’Œé”€æ¯ä¸€ã€ä½¿ç”¨@Beançš„åˆå§‹åŒ–å’Œé”€æ¯å±žæ€§12345678910111213141516171819202122232425262728293031323334353637// åœ¨dogå®žä¾‹ä¸­æŒ‡å®šinitå’Œdestroyæ–¹æ³•public class Dog &#123; public void init()&#123; System.out.println("instance dog execute init method....."); &#125; public void destroy()&#123; System.out.println("instance dog execute destroy method....."); &#125;&#125;// å£°æ˜Žbeançš„æ—¶å€™æŒ‡å®š initMethod = "init",destroyMethod = "destroy"@Configurablepublic class LifeCycleConfig &#123; @Bean(initMethod = "init",destroyMethod = "destroy") public Dog dog()&#123; System.out.println("begin create dog"); return new Dog(); &#125;&#125;// æ‰§è¡Œæµ‹è¯•@Testpublic void LifeCycleTest()&#123; ApplicationContext applicationContext = new AnnotationConfigApplicationContext(LifeCycleConfig.class); System.out.println("instance has created !!!");// Dog dog = (Dog) applicationContext.getBean("dog"); ((AnnotationConfigApplicationContext) applicationContext).close(); System.out.println("context has closed !!!");&#125;// æµ‹è¯•ç»“æžœ:// begin create dog// instance dog execute init method.....// instance has created !!!// instance dog execute destroy method.....// context has closed !!! ä»Žæµ‹è¯•ç»“æžœæ¥çœ‹å½“åˆ›å»ºå¯¹è±¡æ—¶,é€šè¿‡ initMethod,destroyMethodæŒ‡å®šåˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•æ—¶å¯è¡Œçš„.initæ–¹æ³•åœ¨å¯¹è±¡åˆ›å»ºåŽæ‰§è¡Œ.destroyåœ¨å®¹å™¨é”€æ¯å‰æ‰§è¡Œ. äºŒã€ä½¿ç”¨ InitializingBean å’Œ DisposableBean æŽ¥å£æŒ‡å®šæ–¹æ³•åŒä¸Š,ä¸è¿‡éœ€è¦å¯¹è±¡ç±»å®žçŽ°è¿™ä¸¤ä¸ªæŽ¥å£ 12345678910111213141516171819202122232425public class Cat implements InitializingBean, DisposableBean &#123;// æŽ¥å£ä¸­çš„destroy æ–¹æ³•,æ‰§è¡Œé”€æ¯bean public void destroy() throws Exception &#123; System.out.println("instance cat execute destroy method....."); &#125;// æŽ¥å£ä¸­çš„afterPropertiesSetæ–¹æ³•,ç”¨æ¥åˆ›å»ºbeanåŽçš„åˆå§‹åŒ– public void afterPropertiesSet() throws Exception &#123; System.out.println("instance cat execute init method....."); &#125;&#125;// ä¸éœ€è¦åœ¨beanæ³¨è§£ä¸­æŒ‡å®šç›¸å…³æ–¹æ³•@Beanpublic Cat cat()&#123; System.out.println("begin create cat"); return new Cat();&#125;//ç”¨åŒæ ·çš„æµ‹è¯•ç¨‹åºæµ‹è¯•å¾—åˆ°çš„ç»“æžœå¦‚ä¸‹:// begin create cat// instance dog execute init method.....// instance has created !!!// instance dog execute destroy method.....// context has closed !!! ä¸‰ã€ä½¿ç”¨JSRæ ‡å‡†çš„æ³¨è§£ @PostConstruce å’Œ @PreDestroy123456789101112public class Bug &#123; @PostConstruct public void init()&#123; System.out.println("instance Bug execute init method....."); &#125; @PreDestroy public void destroy()&#123; System.out.println("instance Bug execute destroy method....."); &#125;&#125; å››ã€BeanPostProcessorè‡ªå®šä¹‰åˆå§‹åŒ–å‰åŽæ–¹æ³•å…ˆè‡ªå®šä¹‰ä¸€ä¸ª MyBeanPostProcessor ï¼Œå¹¶å°†å®ƒæ”¾åˆ°å®¹å™¨ä¸­ï¼Œåœ¨å¯åŠ¨åŽï¼Œæ¯æ¬¡ç”Ÿæˆbeanæ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œä¸‹é¢çš„ postProcessBeforeInitialization å’Œ postProcessAfterInitializationã€‚ 1234567891011121314public class MyBeanPostProcessor implements BeanPostProcessor &#123; @Override public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException &#123; // æ ¹æ®BeanNameå’Œbeanå¯ä»¥èŽ·å–beançš„ç±»ä¿¡æ¯æŽ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œç­›é€‰ï¼Œåœ¨åˆå§‹åŒ–å‰è¿›è¡Œç›¸å…³æ“ä½œ System.out.println(beanName); return null; &#125; @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; System.out.println(beanName); // åŒç†åˆå§‹åŒ–åŽ return null; &#125;&#125;]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å°†ç±»æ·»åŠ è‡³å®¹å™¨ä¸­çš„å››ç§æ–¹æ³•]]></title>
    <url>%2F2019%2F12%2F01%2F%EF%BC%88%E4%B8%80%EF%BC%89%20%E5%B0%86%E7%B1%BB%E5%8A%A0%E5%85%A5%E5%88%B0%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84%E6%96%B9%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[å°†ç±»æ·»åŠ è‡³å®¹å™¨ä¸­çš„å››ç§æ–¹æ³•åœ¨Springä¸­,æœ‰å››ç§æ–¹æ³•å¯ä»¥å°†çŽ°æœ‰çš„ç±»çš„å®žä¾‹æ·»åŠ åˆ°å®¹å™¨ä¸­.åœ¨äº†è§£ä¹‹å‰éœ€è¦äº†è§£ä»¥ä¸‹ä¸¤ç§ä½œç”¨åŸŸ. Springåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å…±æœ‰å››ç§ä½œç”¨åŸŸå¯é€‰.åˆ†åˆ«ä¸ºå¸¸ç”¨çš„singletonã€prototype.å’Œåœ¨webåº”ç”¨å¼€å‘ä¸­çš„requestå’Œsession. ä¸‹é¢é’ˆå¯¹å¸¸ç”¨çš„singletonã€prototypeæ¥äº†è§£beançš„ä½œç”¨åŸŸ(SCOPE) Springçš„ä½œç”¨åŸŸ1. Singleton å•ä¾‹Singletonä¸ºSpringå¯¹è±¡çš„é»˜è®¤çš„åˆ›å»ºæ–¹å¼,ä¹Ÿå°±æ˜¯è¯´Springåœ¨åˆ›å»ºBeançš„æ—¶å€™é»˜è®¤æ˜¯å•ä¾‹çš„. 12345678910111213141516/å‡†å¤‡å¯¹è±¡Person@Configurablepublic class TestConfig &#123; @Bean public Person person() &#123; System.out.println("åˆ›å»ºBeanå®žä¾‹ï¼"); return new Person("li", "lei"); &#125;&#125;//æµ‹è¯•ApplicationContext applicationContext = new AnnotationConfigApplicationContext(TestConfig.class);// èŽ·å–ä¸¤æ¬¡å¯¹è±¡,å¹¶ä¸”åœ¨è¿™æ˜¯å°±ä¼šæ‰“å° ã€Œåˆ›å»ºBeanå®žä¾‹ã€Person person = (Person) applicationContext.getBean("person");Person person_copy = (Person) applicationContext.getBean("person");// è¿™é‡Œè¿”å›žtrue,è¯´æ˜Žä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸åŒçš„å¯¹è±¡System.out.println(person == person_copy); è¿è¡Œç»“æžœï¼š 123åˆ›å»ºBeanå®žä¾‹ï¼å®¹å™¨åˆ›å»ºæˆåŠŸã€‚ã€‚æŽ¥ä¸‹æ¥åˆ›å»ºå¯¹è±¡ï¼true å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ—¶,åœ¨Springåˆ›å»ºSingletonå¯¹è±¡çš„æ—¶å€™,æ˜¯åœ¨å®¹å™¨åˆ›å»ºåŽç«‹å³åˆ›å»ºçš„. 2. prototype åŽŸåž‹åŒæ ·ä¸Šè¿°çš„ä»£ç ,åœ¨@Beanä¸‹é¢å¢žåŠ @Scope(&quot;prototype&quot;)åŽ,ä¼šæ³¨æ„åˆ°ç»“æžœçš„ä¸åŒ.è¿è¡Œæ—¶åœ¨è¿›è¡Œç»“æžœçš„è§‚å¯Ÿ: 1234å®¹å™¨åˆ›å»ºæˆåŠŸã€‚ã€‚æŽ¥ä¸‹æ¥åˆ›å»ºå¯¹è±¡ï¼åˆ›å»ºBeanå®žä¾‹ï¼åˆ›å»ºBeanå®žä¾‹ï¼false ç±»åž‹ æ˜¯å¦å•ä¾‹ åˆ›å»ºæ—¶é—´ æ˜¯å¦é”€æ¯ Singleton å•ä¾‹ é»˜è®¤åœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ›å»º å®¹å™¨å…³é—­åŽé”€æ¯ prototype å¤šå®žä¾‹ åœ¨èŽ·å–å¯¹è±¡æ—¶åˆ›å»º ä¸ä¼šè°ƒç”¨é”€æ¯æ–¹æ³• ä¸€ã€Configurationæ³¨è§£å’ŒBeanæ³¨è§£ä»£æ›¿äº†åŽŸæ¥çš„Springé…ç½®æ–‡ä»¶,åœ¨ç±»ä¸Šæ ‡æ³¨Configurationæ³¨è§£è¯´æ˜Žè¿™ä¸ªç±»æ˜¯Springçš„é…ç½®ç±». åœ¨æ–¹æ³•ä¸Šä½¿ç”¨Beanæ³¨è§£,åˆ™ä¼šå°†è¿”å›žå€¼ä½œä¸ºå®žä¾‹æ·»åŠ åˆ°å®¹å™¨ä¸­,æ–¹æ³•åç§°ä½œä¸ºBeançš„ID. ä¸€èˆ¬ä½¿ç”¨è¿™ç§æ–¹æ³•å°†ç¬¬ä¸‰æ–¹çš„åŒ…ä¸­çš„ç±»åŠ å…¥åˆ°å®¹å™¨ä¸­,å¦‚Shiroçš„é…ç½®ç±». 12345678910111213/*ä½¿ç”¨@Confiurationæ³¨è§£å£°æ˜Žé…ç½®ç±» */@Configurable@ComponentScan("com.nanyin")public class TestConfig &#123; @Bean @Scope("prototype") //å£°æ˜Žå¤šå®žä¾‹ public Person person() &#123; System.out.println("åˆ›å»ºBeanå®žä¾‹ï¼"); return new Person("li", "lei"); &#125;&#125; äºŒã€componentScanåŒ…æ‰«ææ³¨è§£åœ¨é¢å¯¹è‡ªå·±å†™çš„@Component,@Service,@Controller,@Repositoryåˆ™ä¸éœ€è¦ä½¿ç”¨ç¬¬ä¸€ä¸ªä¸­çš„ä½¿ç”¨@Beanæ³¨è§£ä¸€ä¸ªä¸€ä¸ªçš„æ·»åŠ åˆ°é…ç½®ç±»ä¸­,åªéœ€è¦é…ç½®@ComponentSacnå°±è¡Œäº†.å®ƒä¼šè‡ªåŠ¨æ‰«æè·¯å¾„ä¸‹çš„æ‰€æœ‰è¿™äº›æ³¨è§£çš„ç±»åŠ å…¥åˆ°å®¹å™¨ä¸­. 12345@Configurable@ComponentScan("com.nanyin")public class TestConfig &#123; &#125; ä¸‰ã€importæ³¨è§£1. ç›´æŽ¥å¯¼å…¥@Configurationé…ç½®ç±»èƒ½å¤Ÿä½¿ç”¨@Import(value=xxx.class) å…¶ä¸­valueæ˜¯æ•°ç»„,å¯ä»¥ä¸€æ¬¡æ€§å¯¼å…¥å¤šä¸ªé…ç½®ç±».æ‰¹é‡çš„å¯¼å…¥é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰å£°æ˜Žçš„bean. 123456789101112131415161718192021222324252627282930313233343536373839404142// æ–°çš„å®žä½“public class Dog &#123;&#125;@Configurable// éœ€è¦å¯¼å…¥TestConfigä¸­é…ç½®çš„æ‰€æœ‰bean@Import(value=TestConfig.class)public class ImportConfig &#123; @Bean public Dog dog() &#123; System.out.println("åˆ›å»ºBeanå®žä¾‹ï¼"); return new Dog(); &#125;&#125;@Configurablepublic class TestConfig &#123; // è¿™é‡Œé…ç½®äº†ä¸€ä¸ªperson @Bean public Person person() &#123; System.out.println("åˆ›å»ºBeanå®žä¾‹ï¼"); return new Person("li", "lei"); &#125;&#125;// æµ‹è¯• @Testpublic void importTest()&#123; ApplicationContext applicationContext = new AnnotationConfigApplicationContext(ImportConfig.class); String[] names = applicationContext.getBeanDefinitionNames(); // æ‰“å°å‡ºæ‰€æœ‰æ·»åŠ åˆ°å®¹å™¨ä¸­çš„åç§° for (String temp : names) &#123; System.out.println(temp); &#125;&#125;ç»“æžœ:importConfigpersoncom.nanyin.config.TestConfigdog å¯¼å…¥äº†TestConfigé…ç½®ç±»å’Œå…¶ä¸­çš„personå®žä¾‹ 2. ä½¿ç”¨importSelectorè‡ªå®šä¹‰å¯¼å…¥é™¤äº†ä½¿ç”¨ @import ç›´æŽ¥å¯¼å…¥æŒ‡å®šçš„ç±»å¤–,è¿˜å¯ä»¥å¯¼å…¥ ç»§æ‰¿importSelectoræŽ¥å£çš„ç±»,å¹¶ä¸”åœ¨å®žçŽ°ç±»ä¸­è¿›è¡Œè‡ªå®šä¹‰æ“ä½œ. 123456789101112131415161718192021222324252627282930public class MyImportSelector implements ImportSelector &#123; public String[] selectImports(AnnotationMetadata importingClassMetadata) &#123; // å¯ä»¥é€šè¿‡importingClassMetadataèŽ·å–ç±»æ³¨è§£ä¸Šçš„æ‰€æœ‰ä¿¡æ¯ return new String[]&#123;Dog.class.getName()&#125;; &#125;&#125;@Configurable// @Import å¯ä»¥å¯¼å…¥æ•°ç»„(å¤šä¸ª) class,å¦‚ä¸Šé¢æåˆ°çš„ TestConfigé…ç½®ç±»,è¿™é‡ŒæŠŠMyImportSelectorä¹Ÿæ·»åŠ è¿›åŽ»@Import(value=&#123;TestConfig.class,MyImportSelector.class&#125;)public class ImportConfig &#123;&#125;public void importTest()&#123; ApplicationContext applicationContext = new AnnotationConfigApplicationContext(ImportConfig.class); String[] names = applicationContext.getBeanDefinitionNames(); for (String temp : names) &#123; System.out.println(temp); &#125; ((AnnotationConfigApplicationContext) applicationContext).close();;&#125;//æ‰§è¡Œæµ‹è¯•åŽ// importConfig// person// com.nanyin.config.TestConfig// com.nanyin.entity.Dog 3. ä½¿ç”¨ importBeanDefinitionRegisterå¯ä»¥ä½¿ç”¨ importBeanDefinitionRegister è‡ªå®šä¹‰æ³¨å†Œbean,å› ä¸ºåœ¨æŽ¥å£ä¸­æœ‰BeanRegiestä½œä¸ºå‚æ•°,é€šè¿‡å‚æ•°è°ƒç”¨Registeç›¸å…³æ–¹æ³•. 1234567891011121314151617181920public class MyimportBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar &#123; public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123; AnnotatedGenericBeanDefinition beanDefinition = new AnnotatedGenericBeanDefinition(Dog.class); // å‰é¢å­—ç¬¦ä¸²æ˜¯ID,åŽé¢æ˜¯BeanDefinition registry.registerBeanDefinition("dogx",beanDefinition); &#125;&#125;@Import(MyimportBeanDefinitionRegistrar.class)public class ImportConfig &#123; @Bean public Dog dog() &#123; System.out.println("åˆ›å»ºBeanå®žä¾‹ï¼"); return new Dog(); &#125;&#125;// ç»“æžœé€šè¿‡ registry æ³¨å†Œäº† dogx// importConfig// dog// dogx åŽé¢çš„ä¸¤ç§æ–¹æ³•åœ¨SpringBootæºç ä¸­ä¼šç»å¸¸çœ‹åˆ°,æ‰€ä»¥è¿˜æ˜¯æŒºé‡è¦çš„. å››ã€ä½¿ç”¨FactoryBeanæ³¨å†Œbeanç”¨äºŽåˆ›å»ºå¤æ‚çš„beanæ—¶,ä¼šç”¨åˆ°FactoryBean. å¦‚æžœç»§æ‰¿ FactoryBean æŽ¥å£å®žçŽ°,åˆ™è¿™ä¸ªå°±ä¸èƒ½å½“ä½œä¸€ä¸ªæ™®é€šçš„beanä½¿ç”¨äº†,ä»–æš´éœ²å‡ºæ¥çš„èŽ·å–çš„å¯¹è±¡æ˜¯ getObject()æ–¹æ³•èŽ·å–çš„å·¥åŽ‚ä¸­çš„å¯¹è±¡,è€Œä¸æ˜¯ä»–è‡ªèº«.é»˜è®¤åˆ›å»ºçš„æ—¶FactoryBeançš„å¯¹è±¡å®žä¾‹ï¼Œè€Œä¸æ˜¯å·¥åŽ‚å®žä¾‹ï¼Œå¦‚æžœæƒ³èŽ·å–å·¥åŽ‚çš„å®žä¾‹ï¼Œåœ¨getBeançš„æ—¶å€™åœ¨å¯¹è±¡IDå‰åŠ ä¸Š&amp;ç¬¦å·ã€‚ å…·ä½“å®žä¾‹: 12345678910111213141516public class MyFactoryBean implements FactoryBean&lt;Dog&gt; &#123; // è¿”å›žçš„å®žä¾‹å¯¹è±¡ public Dog getObject() throws Exception &#123; return new Dog(); &#125; // è¿”å›žçš„ç±»åž‹ public Class&lt;?&gt; getObjectType() &#123; return Dog.class; &#125; // é»˜è®¤ä¸ºtrue,å¦‚æžœæ—¶falseåˆ™ä¸ºå¤šå®žä¾‹ public boolean isSingleton() &#123; return true; &#125;&#125;]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springçš„ç¼“å­˜]]></title>
    <url>%2F2019%2F08%2F15%2F2019-08-15-Spring%E7%9A%84%E7%BC%93%E5%AD%98%2F</url>
    <content type="text"><![CDATA[Springçš„ç¼“å­˜Javaåœ¨ä½¿ç”¨Cacheçš„æ—¶å€™ï¼Œä¸ºäº†ç»Ÿä¸€ç¼“å­˜çš„ä½¿ç”¨ï¼ŒJ2EEå‘å¸ƒäº†JSR107ç¼“å­˜è§„èŒƒã€‚åŒ…æ‹¬äº†ä¸»è¦çš„5ä¸ªæ ¸å¿ƒæŽ¥å£ï¼ŒåŒ…æ‹¬cachingProviderã€cacheManagerç­‰ã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹JSR107ç¼“å­˜è§„ã€‚ Springçš„ç¼“å­˜æŠ½è±¡Springä¸ºäº†ç»Ÿä¸€ç¼“å­˜çš„æ“ä½œï¼Œä½¿ç”¨org.springframework.cacheåŒ…ä¸‹çš„çš„cacheManageræŽ¥å£è¿›è¡Œå¼€å‘ã€‚å¹¶æ”¯æŒä¸Šé¢æ‰€è¯´çš„JSR107ç¼“å­˜è§„èŒƒï¼Œç”¨æ¥ç®€åŒ–å¼€å‘ã€‚ Springæ”¯æŒé€æ˜Žçš„å‘åº”ç”¨ä¸­çš„æ–¹æ³•æ·»åŠ ç¼“å­˜ã€‚å°†æŸ¥è¯¢å‡ºçš„ä¿¡æ¯æ”¾åˆ°ç¼“å­˜é‡Œï¼Œå‡å°‘åº”ç”¨ä¸Žå®žé™…æ•°æ®åº“çš„æŸ¥è¯¢æ¬¡æ•°ã€‚æé«˜ç³»ç»Ÿç›¸åº”é€Ÿåº¦ã€‚ SpringBootå¼€å¯ç¼“å­˜æ³¨è§£SpringBootæ˜¯é»˜è®¤æ”¯æŒCacheç›¸å…³åŸºç¡€ç»„ä»¶çš„ã€‚éœ€è¦åœ¨å¯åŠ¨å™¨ç±»ä¸Šæ ‡æ³¨@EnableCachingæ³¨è§£ã€‚å¦‚ï¼š 1234567@SpringBootApplication@EnableCaching //å¼€å¯SpringBootçš„cacheæ”¯æŒpublic class WebProjectApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(WebProjectApplication.class); &#125;&#125; æ·»åŠ ç¼“å­˜ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ï¼ŒSpring cache å°±èƒ½å¤Ÿå¸®åŠ©åˆ›å»ºç¼“å­˜ã€‚å¦‚ï¼š 12345@Cacheable(value="user-status") //ä½¿ç”¨Cacheableæ³¨è§£æ ‡å¿—è¿™éœ€è¦å¯¹æ–¹æ³•è¿›è¡Œç¼“å­˜@Overridepublic List&lt;Status&gt; findNotDeletedUserStatus() throws Exception &#123; return statusRepository.findAllByIsDeletedOrderByOrd(DeletedStatusEnum.IS_NOT_DELETED.isJudge());&#125; SpringBootæ”¯æŒäº†å¤šç§çš„ç¼“å­˜å®žçŽ°ï¼Œå¦‚EhCache 2.xã€Redisã€Caffeineç­‰ç­‰ã€‚ä½†æ˜¯æŽ¥å£æ–¹æ³•æ˜¯ç›¸åŒçš„ï¼Œå°±å¦‚åŒä½¿ç”¨jdbcä¸€æ ·ã€‚è™½ç„¶å®žçŽ°ä¸åŒï¼Œä½†æ˜¯ä½¿ç”¨ä¸Šå¹¶æ— å·®å¼‚ã€‚ SpringBoot ä½¿ç”¨ç¼“å­˜æ³¨è§£ç¼“å­˜æŠ½è±¡çš„æ ¸å¿ƒæ˜¯å°†ç¼“å­˜åº”ç”¨äºŽJavaæ–¹æ³•ä¸Šã€‚è¿™æ ·ï¼Œå¦‚æžœæ–¹æ³•è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆåº”ç”¨äºŽæ–¹æ³•ä¸Šçš„ç¼“å­˜å°±å¼€å§‹æ£€æŸ¥æ˜¯å¦æŒ‰ç…§ç»™å®šè§„åˆ™è¿›è¡Œç¼“å­˜ã€‚ åŸºäºŽæ³¨è§£çš„ç¼“å­˜å¯¹äºŽç¼“å­˜å£°æ˜Žï¼ŒSpringçš„ç¼“å­˜æŠ½è±¡æä¾›äº†ä¸€ç»„Javaæ³¨è§£ ä¸€ã€@Cacheable è§¦å‘è¿›è¡Œç¼“å­˜ä½¿ç”¨@Cacheableæ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œæ ‡å¿—ç€è¿™ä¸ªæ–¹æ³•æ˜¯å¯ç¼“å­˜çš„ã€‚ä½¿ç”¨è¿™ä¸ªæ³¨è§£ï¼Œå¯å°†æ–¹æ³•çš„è¿”å›žç»“æž„å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå†æ¬¡æŸ¥è¯¢æ˜¯ï¼Œå°±å¯ä»¥ä»Žç¼“å­˜ä¸­å–ç»“æžœè€Œä¸æ˜¯å†æ¬¡æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š 12@Cacheable("books")public Book findBook(ISBN isbn) &#123;...&#125; å› ä¸ºç¼“å­˜æ˜¯key-valueå½¢å¼çš„ï¼Œæ¯æ¬¡è°ƒç”¨ç¼“å­˜æ—¶ï¼Œéƒ½éœ€è¦å…ˆæ‰¾åˆ°æ­£ç¡®çš„keyã€‚ç¼“å­˜æŠ½è±¡æ”¯æŒç®€å•çš„KeyGeneratorå‡ ç§ç”Ÿæˆçš„ç­–ç•¥ï¼šä½œä¸ºå‚è€ƒä¸Šé¢çš„æ–¹æ³•findBookçš„Cacheableçš„å‚æ•°æ˜¯booksã€‚ å¦‚æžœæ²¡æœ‰å‚æ•° ï¼Œåˆ™ä½¿ç”¨SimpleKey.EMPTY. å¦‚æžœæœ‰ä¸€ä¸ªå‚æ•°ï¼Œåˆ™ä½¿ç”¨è¿™ä¸ªå‚æ•°ä½œä¸ºkeyã€‚ å¦‚æžœæœ‰å¤šä¸ªå‚æ•°ï¼Œåˆ™è¿”å›ž SimpleKey ä¸­åŒ…å«è¿™å¤šä¸ªå‚æ•°ã€‚ è¿™ä¸‰ç§æ–¹å¼åŒ…å«äº†å¤§å¤šæ•°çš„ä½¿ç”¨åœºæ™¯ã€‚å¦‚æžœéœ€è¦è‡ªå®šä¹‰key ï¼Œ@Cacheable å…è®¸ä½¿ç”¨keyå…³é”®å­—è¿›è¡Œkeyçš„ç”Ÿæˆï¼Œkeyå…³é”®å­—çš„å€¼å¯ä»¥ä½¿ç”¨SPELè¡¨è¾¾å¼è¿›è¡Œè¡¨ç¤ºã€‚å¦‚Spring Docä¸­æ‰€ä¸¾å‡ºçš„ä¾‹å­ä¸€æ ·ã€‚æ ¹æ®å®žé™…çš„æƒ…å†µè¿›è¡Œæ–Ÿé…Œã€‚ 12345678@Cacheable(cacheNames="books", key="#isbn")public Book findBook(ISBN isbn, boolean checkWarehouse, boolean includeUsed)@Cacheable(cacheNames="books", key="#isbn.rawNumber")public Book findBook(ISBN isbn, boolean checkWarehouse, boolean includeUsed)@Cacheable(cacheNames="books", key="T(someType).hash(#isbn)")public Book findBook(ISBN isbn, boolean checkWarehouse, boolean includeUsed) è‡ªå®šä¹‰çš„ç¼“å­˜æ¡ä»¶ ï¼š å¯ä»¥é€šè¿‡conditionå…³é”®å­—åœ¨@Cacheableæ³¨è§£ä¸­è¿›è¡Œæ¡ä»¶çš„å®šåˆ¶ã€‚å¦‚ï¼š 12345@Cacheable(cacheNames="book", condition="#name.length() &lt; 32") public Book findBook(String name)//å¦‚æžœæƒ³æŽ’é™¤æŸäº›æ¡ä»¶ ä½¿ç”¨unless@Cacheable(cacheNames="book", condition="#name.length() &lt; 32", unless="#result.hardback") public Book findBook(String name) å…·ä½“çš„æ›´å¤šçš„spelæ³¨è§£å±žæ€§å¯ä»¥æŸ¥çœ‹Springæ–‡æ¡£ä¸­çš„å†…å®¹ åœ°å€ äºŒã€@CacheEvict è§¦å‘æ¸…ç©ºç¼“å­˜åœ¨Spring cacheä¸­ä¸ä»…å…è®¸æ”¾ç½®ç¼“å­˜ï¼Œè€Œä¸”å…è®¸ç§»é™¤ç¼“å­˜ã€‚ä½¿ç”¨ä¸ŽCacheableç›¸å¯¹çš„CacheEvictæ³¨è§£æ¥æ¸…ç©ºå¯¹åº” keyçš„ç¼“å­˜æ•°æ®ã€‚ 123// ä½¿ç”¨allEntriesç”¨æ¥è¡¨ç¤ºåˆ é™¤æ‰€æœ‰è¿™ä¸ªcacheä¸­çš„ç¼“å­˜@CacheEvict(cacheNames="books", allEntries=true) public void loadBooks(InputStream batch) ä¸‰ã€@CachePut è§¦å‘æ›´æ–°ç¼“å­˜å½“éœ€è¦æ›´æ–°ç¼“å­˜è€Œä¸å¹²æ‰°æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œå°±æ˜¯è¯´æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šæ›´æ–°ç¼“å­˜ã€‚ 12@CachePut(cacheNames="book", key="#isbn")public Book updateBook(ISBN isbn, BookDescriptor descriptor) å››ã€@Caching ç»„åˆä½¿ç”¨å¤šä¸ªcacheæ³¨è§£æ–¹æ³•å¦‚æžœæƒ³ä½¿ç”¨å¤šä¸ªcacheåŠ¨ä½œæ¥æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼Œå°±éœ€è¦ä½¿ç”¨Cachingæ³¨è§£å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­æ‰€è¡¨ç¤ºçš„ä¸€æ ·ï¼Œæƒ³è¦æ¸…ç©ºå¤šä¸ªkeyçš„ç¼“å­˜ 12@Caching(evict = &#123; @CacheEvict("primary"), @CacheEvict(cacheNames="secondary", key="#p0") &#125;)public Book importBooks(String deposit, Date date) äº”ã€@CacheConfig ç±»ä¸Šæ³¨è§£ç”¨æ¥æ³¨è§£å…¬å…±é…ç½®ä¸Šé¢çš„æ³¨è§£éƒ½æ˜¯åœ¨æ–¹æ³•çº§åˆ«ä¸Šçš„å¯¹æ–¹æ³•çš„è¿”å›žå€¼è¿›è¡Œè®¾ç½®ï¼Œè€ŒCacheConfigæ˜¯å¯¹ç±»çº§åˆ«ä¸Šçš„å…¬å…±è®¾ç½®ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ä¸­æ‰€å±•ç¤ºçš„ä¸€æ ·ï¼Œè®¾ç½®å…¬å…±çš„cache name. 123456@CacheConfig("books") public class BookRepositoryImpl implements BookRepository &#123; @Cacheable public Book findBook(ISBN isbn) &#123;...&#125;&#125; SpringBootä½¿ç”¨redisè¿›è¡Œç¼“å­˜ä¸€ã€æ·»åŠ Pomä¾èµ–1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt; äºŒã€é…ç½®redisç›¸å…³å±žæ€§åœ¨å¼•å…¥spring-boot-starter-data-redisåŽï¼Œå¯åŠ¨ä¸»ç¨‹åºåŽä¼šè‡ªåŠ¨çš„å¼€å¯redisç¼“å­˜ã€‚å¦‚æžœæƒ³é…ç½®redisï¼Œåˆ™å¯ä»¥åœ¨org.springframework.boot.autoconfigure.data.redis.RedisPropertiesè¿™ä¸ªå±žæ€§ç±»ä¸­æŸ¥æ‰¾,ç„¶åŽæ·»åŠ åˆ°application.ymlä¸­ã€‚å¦‚ï¼š 12345678910111213141516private int database = 0;/** * Connection URL. Overrides host, port, and password. User is ignored. Example: * redis://user:password@example.com:6379 */private String url;private String host = "localhost";private String password;private int port = 6379;private boolean ssl;private Duration timeout; ä¸‰ã€è‡ªå®šä¹‰redisTemplateå’ŒTtlCacheManageræ ¹æ®SpringBootè‡ªåŠ¨é…ç½®æºç ï¼ŒredisTemplateåªæœ‰åœ¨çŽ¯å¢ƒä¸­æ²¡æœ‰ä»¥redisTemplateåç§°å‘½åçš„beanæ—¶å€™ï¼Œæ‰è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚ 12345678@Bean@ConditionalOnMissingBean(name = "redisTemplate")public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) throws UnknownHostException &#123; RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setConnectionFactory(redisConnectionFactory); return template;&#125; æ‰€ä»¥ï¼Œå¦‚æžœæƒ³è‡ªè¡Œé…ç½®redisTemplateåˆ™å¯ç›´æŽ¥è£…è½½beanï¼Œå‘½åä¸ºredisTemplateã€‚å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637@Beanpublic RedisTemplate redisTemplate(RedisConnectionFactory redisConnectionFactory) &#123; RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setConnectionFactory(redisConnectionFactory); //Jackson2JsonRedisSerializer serializer = new Jackson2JsonRedisSerializer(Object.class); //ä½¿ç”¨Fastjson2JsonRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„valueå€¼ FastJson2JsonRedisSerializer serializer = new FastJson2JsonRedisSerializer(Object.class); ObjectMapper mapper = new ObjectMapper(); mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); serializer.setObjectMapper(mapper); template.setHashKeySerializer(serializer); template.setHashValueSerializer(serializer); template.setDefaultSerializer(serializer); //ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼,é˜²æ­¢ä¹±ç  template.setKeySerializer(new StringRedisSerializer()); template.setValueSerializer(new StringRedisSerializer()); template.afterPropertiesSet(); return template;&#125;// ä½¿ç”¨ @Cacheable(cacheManager="TtlCacheManager") æ¿€æ´»cacheManager@Bean(name = "TtlCacheManager")public CacheManager cacheManager(RedisConnectionFactory connectionFactory) &#123; //åˆå§‹åŒ–ä¸€ä¸ªRedisCacheWriter RedisCacheWriter redisCacheWriter = RedisCacheWriter.nonLockingRedisCacheWriter(connectionFactory); RedisCacheConfiguration defaultCacheConfig = RedisCacheConfiguration.defaultCacheConfig(); //è®¾ç½®é»˜è®¤è¶…è¿‡æœŸæ—¶é—´æ˜¯30ç§’ defaultCacheConfig.entryTtl(Duration.ofSeconds(30)); //åˆå§‹åŒ–RedisCacheManager RedisCacheManager cacheManager = new RedisCacheManager(redisCacheWriter, defaultCacheConfig); return cacheManager;&#125; è¿™é‡Œæ˜¯ç”¨æ¥FastJson2JsonRedisSerializeræ¥ä»£æ›¿é»˜è®¤çš„Jackson2JsonRedisSerializeråºåˆ—åŒ–ç­–ç•¥ã€‚æ˜¯åœ¨ç½‘ä¸ŠæŸ¥æ‰¾åˆ°çš„æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839public class FastJson2JsonRedisSerializer&lt;T&gt; implements RedisSerializer&lt;T&gt; &#123; private ObjectMapper objectMapper = new ObjectMapper(); public static final Charset DEFAULT_CHARSET = Charset.forName("UTF-8"); private Class&lt;T&gt; clazz; static &#123; ParserConfig.getGlobalInstance().setAutoTypeSupport(true); //å¦‚æžœé‡åˆ°ååºåˆ—åŒ–autoType is not supporté”™è¯¯ï¼Œè¯·æ·»åŠ å¹¶ä¿®æ”¹ä¸€ä¸‹åŒ…ååˆ°beanæ–‡ä»¶è·¯å¾„ // ParserConfig.getGlobalInstance().addAccept("com.xxxxx.xxx"); &#125; public FastJson2JsonRedisSerializer(Class&lt;T&gt; clazz) &#123; super(); this.clazz = clazz; &#125; // åºåˆ—åŒ– @Override public byte[] serialize(T t) throws SerializationException &#123; if (t == null) &#123; return new byte[0]; &#125; return JSON.toJSONString(t, SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET); &#125; // ååºåˆ—åŒ– @Override public T deserialize(byte[] bytes) throws SerializationException &#123; if (bytes == null || bytes.length &lt;= 0) &#123; return null; &#125; String str = new String(bytes, DEFAULT_CHARSET); return JSON.parseObject(str, clazz); &#125; public void setObjectMapper(ObjectMapper objectMapper) &#123; Assert.notNull(objectMapper, "'objectMapper' must not be null"); this.objectMapper = objectMapper; &#125; protected JavaType getJavaType(Class&lt;?&gt; clazz) &#123; return TypeFactory.defaultInstance().constructType(clazz); &#125;&#125;]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootçš„è‡ªå®šä¹‰starterå¼€å‘]]></title>
    <url>%2F2019%2F08%2F13%2F2019-08-13-SpringBoot%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89starter%E5%BC%80%E5%8F%91%2F</url>
    <content type="text"><![CDATA[SpringBootçš„è‡ªå®šä¹‰starterå¼€å‘SpringBootå®˜æ–¹é»˜è®¤æä¾›äº†å¾ˆå¤šçš„starterã€‚å‚è€ƒå®˜æ–¹çš„referenceã€‚starterä½œä¸ºåœ¨SpringBootä¸­é‡è¦çš„ç‰¹æ€§ï¼Œä½¿ç”¨æ—¶èƒ½å¤Ÿåœ¨POMæ–‡ä»¶ä¸­ç›´æŽ¥å¼•ç”¨è¿™äº›starterï¼Œå¯ä»¥ä¸€ç«™å¼çš„èŽ·å–ä¸ŽSpringç»“åˆçš„ç›¸å…³æœåŠ¡å’ŒåŠŸèƒ½ã€‚å¦‚æžœæƒ³å¼•å…¥redisç­‰åŠŸèƒ½ã€‚åˆ™ç›´æŽ¥æ·»åŠ ä½¿ç”¨spring-boot-starter-data-redisã€‚åªéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å°‘é‡å±žæ€§ï¼Œå°±å¯ä»¥åœ¨åº”ç”¨ä¸­ä½¿ç”¨ã€‚ SpringBootçš„è‡ªåŠ¨é…ç½®åŽŸç†SpringBooté€šè¿‡starterï¼Œå¼•ç”¨ç›¸å…³æœåŠ¡ï¼Œç„¶åŽé€šè¿‡autoConfigureæ¥è‡ªåŠ¨é…ç½®ç›¸å…³æœåŠ¡ã€‚æ›´å¤šå…·ä½“çš„å®žçŽ°å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œç®€è¦çš„åˆ†æžæ¥å¦‚ä½•å®žçŽ°è‡ªå®šä¹‰starterå’ŒåŸºæœ¬çš„è‡ªåŠ¨é…ç½®å®žçŽ°ã€‚ starterçš„åŸºæœ¬ç»“æž„ åŒ…åç§°ä»¥ spring-boot-starter-xxx å‘½åï¼Œå¦‚å¼•ç”¨spring-boot-starter-data-jpa.å…¶ä¸­çš„å†…å®¹åªåŒ…æ‹¬pomæ–‡ä»¶ï¼Œç”¨æ¥å¼•ç”¨ç›¸å…³æœåŠ¡çš„jaråŒ…ã€‚ åŒ…åç§°ä»¥xxx-spring-boot-autoconfigureå‘½åã€‚åŒ…å«ï¼š xxxAutoConfiguration è‡ªåŠ¨é…ç½®ç±»ï¼Œä½¿ç”¨Configurationæ³¨è§£æ ‡å¿—ä¸ºé…ç½®ç±»ã€‚ä½¿ç”¨Conditionalxxxxç›¸å…³æ³¨è§£è¡¨ç¤ºæ¡ä»¶ï¼Œä½¿ç”¨EnableConfigurationPropertiesæ³¨è§£ï¼Œæ¥æŒ‡å®šé…ç½®å±žæ€§ç±»ã€‚ xxxProperties é…ç½®å±žæ€§ç±»ã€‚ä½¿ç”¨ConfigurationPropertiesæ³¨è§£æ¥æ ‡å¿—ä¸ºé…ç½®å±žæ€§ç±»ï¼Œå¹¶ä¸”éœ€è¦æŒ‡å®šprefixï¼Œä»¥ä¾¿åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨prefix+å±žæ€§åæ¥è®¾ç½®ç›¸å…³å±žæ€§ã€‚ spring.factories æ–‡ä»¶ä¸­æ·»åŠ ç›¸å…³ä¿¡æ¯ï¼Œç”¨æ¥æŒ‡å®šéœ€è¦è¿›è¡Œè‡ªåŠ¨é…ç½®çš„ç±»çš„å…¨é™å®šåç§°ã€‚å¦‚ï¼š 12org.springframework.boot.autoconfigure.EnableAutoConfiguration=\org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration, å¼€å§‹è‡ªå®šä¹‰starteråœ¨æ­£å¼è¿›è¡Œä¹‹å‰ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„Projectï¼Œç”¨æ¥æ”¾spring-boot-starter-xxxå’Œxxx-spring-boot-autoconfigureã€‚ åˆ›å»ºspring-boot-starter-xxxå’Œxxx-spring-boot-autoconfigureåœ¨åˆ›å»ºå®Œç©ºé¡¹ç›®åŽï¼Œä¼šè¦æ±‚åˆ›å»ºmoduleã€‚é€‰æ‹©mavenæˆ–è€…Spring Initializerè¿›è¡Œspring-boot-starter-xxxçš„åˆ›å»ºã€‚ é…ç½®starteråœ¨å®žé™…æ“ä½œé…ç½®starterä¹‹å‰ï¼Œå…ˆæ¥åˆ†æžSpringBootå®˜æ–¹æä¾›çš„starterçš„åŸºæœ¬çš„ä¾èµ–ç»“æž„ï¼Œä¸ºæŽ¥ä¸‹æ¥çš„æž„å»ºèµ·åˆ°æ¨¡ç‰ˆçš„ä½œç”¨ã€‚ åœ¨å·¦è¾¹çš„ä¸ºspring-boot-starter-webçš„çš„ç®€å•çš„ä¾èµ–å…³ç³»ï¼Œå®ƒä¾èµ–spring-boot-starterã€‚è€Œspring-boot-starterè¿›ä¸€æ­¥ä¾èµ–äºŽspring-boot-autoconfigureç”¨æ¥è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚ å¦‚æžœè‡ªå·±è¿›è¡Œstarterçš„é…ç½®çš„è¯ï¼Œéœ€è¦å‚è€ƒå·¦è¾¹çš„ä¾èµ–ç»“æž„ï¼Œå®ŒæˆåŽï¼Œå‚è€ƒå³è¾¹çš„ä¾èµ–å…³ç³»ã€‚ æ³¨ï¼šå¹¶éžéœ€è¦å®Œå…¨æŒ‰ç…§è¿™æ ·çš„ä¾èµ–è¿›è¡Œç¨‹åºçš„æž„å»ºã€‚ä¸Šå›¾åªæ˜¯å‚è€ƒã€‚ é…ç½®autoconfigurationåŒ…pomé…ç½®åœ¨pom.xmlä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 12345678910111213&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot&lt;/artifactId&gt; &lt;version&gt;2.1.6.RELEASE&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ä¸»è¦éœ€è¦ä¾èµ–spring-bootã€‚å¦‚æžœåœ¨è‡ªåŠ¨é…ç½®ç±»éœ€è¦è¿›è¡Œå…¶ä»–ç‰¹æ®Šçš„Conditionalè®¾ç½®æ—¶ï¼Œè¿˜éœ€è¦å¼•å…¥spring-boot-autoconfigureã€‚ æ·»åŠ xxxAutoConfiurationå’ŒxxxPropertiesç±»è¿™ä¸¤ä¸ªç±»æ˜¯è‡ªåŠ¨é…ç½®ä¸­å¿…é¡»çš„ç±»ã€‚å†…å®¹å¯ä»¥å‚è€ƒWebMvcAutoConfigurationå’ŒWebMvcPropertiesè¿™ä¸¤ä¸ªç±»ã€‚ä¸‹é¢æ˜¯æˆ‘çš„å…·ä½“å®žçŽ°ç±»ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253// HelloAutoConfiguration è‡ªå®šä¹‰çš„AutoConfigurationç±»@Configuration@EnableConfigurationProperties(&#123;HelloProperties.class&#125;)public class HelloAutoConfiguration &#123; private final HelloProperties helloProperties; public HelloAutoConfiguration(HelloProperties helloProperties) &#123; this.helloProperties = helloProperties; &#125; @Bean public HelloService sayHello()&#123; HelloService helloService = new HelloService(); // è®¾ç½®é…ç½®å±žæ€§ helloService.setHelloProperties(helloProperties); return helloService; &#125;&#125;//ä½¿ç”¨serviceç±»æ¥æµ‹è¯•æ˜¯å¦é…ç½®æˆåŠŸï¼Œæ–¹æ³•è°ƒç”¨public class HelloService &#123; HelloProperties helloProperties; public HelloProperties getHelloProperties() &#123; return helloProperties; &#125; public void setHelloProperties(HelloProperties helloProperties) &#123; this.helloProperties = helloProperties; &#125; // æ–¹æ³•è°ƒç”¨éªŒè¯å±žæ€§æ˜¯å¦å…¶ä½œç”¨ã€‚ä¹Ÿå°±æ˜¯è‡ªåŠ¨é…ç½®æ˜¯å¦ç”Ÿæ•ˆ public String sayHello()&#123; return helloProperties.getPrefix() + " hello world !"; &#125;&#125;// è‡ªå®šä¹‰çš„Propertiesç±»@ConfigurationProperties(prefix = "spring.hello")public class HelloProperties &#123; private String prefix ; public String getPrefix() &#123; return prefix; &#125; public void setPrefix(String prefix) &#123; this.prefix = prefix; &#125;&#125; spring.factorieså¦‚æžœæƒ³è¦ä½¿ç”¨è‡ªåŠ¨é…ç½®ï¼Œå¿…é¡»æ·»åŠ spring.factoriesè¿™ä¸ªæ–‡ä»¶ã€‚æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 123# Auto Configureorg.springframework.boot.autoconfigure.EnableAutoConfiguration=\com.nanyin.hello.HelloAutoConfiguration é…ç½® starter-xxx åŒ…pomé…ç½®1234567891011121314&lt;dependencies&gt; &lt;!--æž„å»ºçš„starterä¾èµ–&gt;spring-boot-starter å’Œå…¶ä»–éœ€è¦çš„starter--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¾èµ–è‡ªåŠ¨é…ç½®åŒ…--&gt; &lt;dependency&gt; &lt;groupId&gt;com.nanyin&lt;/groupId&gt; &lt;artifactId&gt;hello-spring-boot-autoconfigure&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; é¡¹ç›®ç»“æž„éœ€è¦åˆ é™¤ä¸éœ€è¦çš„ç±»æˆ–ç›®å½•ï¼Œå¦‚SpringBootå¯åŠ¨ç±»ç­‰ã€‚å‚è€ƒç»“æž„å¦‚ä¸‹ï¼š æ‰“æˆjaråŒ…ä½¿ç”¨ideaä¸­çš„mavenå·¥å…·ï¼Œå¯¹ä¸Šä¸ªmoduleè¿›è¡Œåˆ†åˆ«æ‰“åŒ…ï¼Œå®‰è£…åˆ°æœ¬åœ°ã€‚æ‰“åŒ…çš„é¡ºåºæ˜¯å…ˆå®‰è£… autoconfiuration ï¼Œç„¶åŽå†å®‰è£… starter-xxxã€‚ ä½¿ç”¨starteræ–°å»ºä¸€ä¸ªwebçš„SpringBooté¡¹ç›®ï¼Œæ–°å»ºä¸€ä¸ªControllerï¼Œé‡Œé¢æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 1234@RequestMapping("/sayHello")public @ResponseBody String sayHello()&#123; return helloService.sayHello();&#125; å¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š 123spring: hello: prefix: PREFIX åœ¨pom.xmlä¸­æ·»åŠ è‡ªå®šä¹‰çš„starterï¼š 123456&lt;!-- æ·»åŠ è‡ªå®šä¹‰starter --&gt;&lt;dependency&gt; &lt;groupId&gt;com.nanyin&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-hello&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; è¿è¡Œç¨‹åºï¼Œåœ¨åœ°å€æ ä¸Šè¾“å…¥http://localhost:8081/sayHello,å‡ºçŽ°ä¸‹å›¾æ•ˆæžœï¼š è¯´æ˜Žè‡ªåŠ¨é…ç½®æˆåŠŸã€‚]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootå¯åŠ¨ä¹‹refreshContext]]></title>
    <url>%2F2019%2F08%2F05%2FSpringBoot%E5%90%AF%E5%8A%A8%E4%B9%8BrefreshContext%2F</url>
    <content type="text"><![CDATA[SpringBootå¯åŠ¨ä¹‹refreshContextè¿™ç¯‡ä¸»è¦è¦é€šè¿‡refreshContextæ–¹æ³•æ¥å°†SpringBootæ˜¯å¦‚ä½•åˆå§‹åŒ–iocå®¹å™¨çš„ã€‚ refreshContextåœ¨SpringBootä¸­çš„runæ–¹æ³•ä¸­ï¼Œè°ƒç”¨refreshContext()æ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨ AbstractApplicationContextç±»ä¸­çš„refresh()æ–¹æ³•ã€‚ç„¶åŽåˆ†æžæ¯ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œæ¥çœ‹è¿™äº›æ–¹æ³•çš„ä½œç”¨ã€‚ 12345678910111213141516171819202122232425262728293031323334@Overridepublic void refresh() throws BeansException, IllegalStateException &#123; synchronized (this.startupShutdownMonitor) &#123; // å‡†å¤‡æ­¤ä¸Šä¸‹æ–‡ä»¥è¿›è¡Œåˆ·æ–°ï¼Œè®¾ç½®å…¶å¯åŠ¨æ—¥æœŸ // å¹¶ä¸”è®¾ç½® active æ ‡å¿—ä»¥åŠæ‰§è¡Œå±žæ€§æºï¼ˆç³»ç»Ÿå±žæ€§ã€çŽ¯å¢ƒå˜é‡ï¼‰çš„ä»»ä½•åˆå§‹åŒ–ã€‚ prepareRefresh(); // å‘Šè¯‰å­ç±»åˆ·æ–° bean factory. ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); // ä¸ºä¸Šä¸‹æ–‡å‡†å¤‡ bean factory. prepareBeanFactory(beanFactory); // æŽ¥ä¸‹æ¥çš„æ–¹æ³•å°±æ˜¯è£…è½½ç»„ä»¶çš„æ–¹æ³• try &#123; // Allows post-processing of the bean factory in context subclasses. postProcessBeanFactory(beanFactory); // ä½¿ç”¨beanFactoryåœ¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œbean invokeBeanFactoryPostProcessors(beanFactory); // æ³¨å†Œbeançš„æ‹¦æˆªå™¨ registerBeanPostProcessors(beanFactory); // åŠ è½½å›½é™…åŒ– initMessageSource(); // åˆå§‹åŒ–ä¸Šä¸‹æ–‡çš„äº‹ä»¶å¹¿æ’­ initApplicationEventMulticaster(); // åŠ è½½ç‰¹æ®Šçš„bean onRefresh(); // åŠ è½½æ‰€æœ‰çš„listenerså¹¶å¯åŠ¨ registerListeners(); // å®Œæˆå¯¹æ‰€æœ‰çš„å‰©ä¸‹çš„éžæ‡’åŠ è½½çš„å•ä¾‹çš„åˆ›å»º finishBeanFactoryInitialization(beanFactory); // æœ€åŽå‘å¸ƒå¯¹åº”çš„äº‹ä»¶ã€‚ finishRefresh(); &#125; &#125;&#125; prepareRefresh å‡†å¤‡åˆ·æ–°æ–¹æ³•è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯ä¸ºäº†æŽ¥ä¸‹æ¥çš„refreshè¿›è¡Œçš„å‡†å¤‡ã€‚ä¸»è¦çš„æœ‰ä¸¤ä¸ªè¿‡ç¨‹ è°ƒç”¨initPropertySources()æ–¹æ³•è¿›è¡ŒpropertySourceçš„åˆå§‹åŒ–ã€‚ éªŒè¯æœ‰æ²¡æœ‰ç¼ºå¤±çš„å¿…è¦çš„Propertyå±žæ€§ã€‚ initPropertySources åˆå§‹åŒ–propertySourceè°ƒç”¨å®žçŽ°ç±»çš„initPropertySourcesï¼Œæ ¹æ®debugçš„ç»“æžœï¼Œè¿›å…¥åˆ°äº†å­ç±»GenericWebApplicationç±»ä¸­ï¼Œå¯¹servletContexè¿›è¡Œå±žæ€§è®¾ç½®ã€‚å¦‚ä¸‹å›¾ä¸­æ‰€å±•ç¤ºçš„ã€‚ obtainFreshBeanFactory èŽ·å¾—beanFactoryè¯¥æ–¹æ³•ä¾é refreshBeanFactory()æ¥åªæ˜¯beanå·¥åŽ‚çš„å®žé™…åˆ·æ–°ã€‚å› ä¸ºSpringBootåœ¨ApplicationContextå·²ç»æŒæœ‰ä¸€ä¸ªç±»åž‹ä¸ºDefaultListableBeanFactoryç±»åž‹çš„beanFactoryã€‚æ‰€ä»¥å¯ä»¥ç›´æŽ¥è¿”å›žã€‚ prepareBeanFactoryå‡†å¤‡BeanFactoryé…ç½®BeanFactoryçš„æ ‡å‡†ä¸Šä¸‹æ–‡ç‰¹å¾ã€‚ä¸»è¦ä½“çŽ°åœ¨ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š è®¾ç½®classLoaderå’Œbeanåç§°çš„è§£æžç­–ç•¥ç­‰ã€‚ è®¾ç½®ä»¥Awareç»“å°¾çš„callbackæŽ¥å£å‡½æ•°ã€‚é€šè¿‡å¯¹è¿™äº›æŽ¥å£çš„å®žçŽ°ã€‚æ¥è¾¾åˆ°å¯¹çŽ¯å¢ƒè®¾ç½®çš„ç›®çš„ã€‚å¦‚å¯ç»§æ‰¿ResourceLoaderAwareæŽ¥å£ï¼Œæ¥è®¾ç½®èµ„æºåŠ è½½å™¨ï¼Œæ¥å®žçŽ°è‡ªå®šä¹‰çš„èµ„æºåŠ è½½ã€‚ ä½¿ç”¨ç‰¹å®šçš„è‡ªåŠ¨è£…é…å€¼æ³¨å†Œç‰¹æ®Šä¾èµ–å…³ç³»ç±»åž‹ã€‚å¦‚beanFactory.registerResolvableDependency(ApplicationContext.class, this); è®¾ç½®çŽ¯å¢ƒç›¸å…³çš„bean.å¦‚beanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment()); postProcessBeanFactoryå…è®¸åœ¨ä¸Šä¸‹æ–‡å­ç±»ä¸­å¯¹beanè¿›è¡ŒåŽå¤„ç†ã€‚è°ƒç”¨ç›¸å…³æ–¹æ³•å®Œæˆå¯¹beanFactoryçš„åŽç½®å¤„ç†å…¶çš„åŠ è½½ã€‚åœ¨ä¹‹åŽçš„invokeBeanFactoryPostProcessorså®žä¾‹åŒ–å¹¶è°ƒç”¨æ‰€æœ‰å·²æ³¨å†Œçš„BeanFactoryPostProcessor beanã€‚åœ¨æ–¹æ³•registerBeanPostProcessorsä¸­å®žä¾‹åŒ–å¹¶æ³¨å†Œæ‰€æœ‰BeanPostProcessor beanã€‚ initMessageSource åˆå§‹åŒ–MessageSource1234567891011121314151617181920protected void initMessageSource() &#123; // å…ˆèŽ·å¾—beanå·¥åŽ‚ ConfigurableListableBeanFactory beanFactory = getBeanFactory(); // å¦‚æžœå­˜åœ¨beanåç§°ä¸ºmessageSourceçš„bean // ä¹Ÿå°±æ˜¯å›½é™…åŒ–çš„Message if (beanFactory.containsLocalBean(MESSAGE_SOURCE_BEAN_NAME)) &#123; // èŽ·å¾—messageSource this.messageSource = beanFactory.getBean(MESSAGE_SOURCE_BEAN_NAME, MessageSource.class); // Make MessageSource aware of parent MessageSource. if (this.parent != null &amp;&amp; this.messageSource instanceof HierarchicalMessageSource) &#123; HierarchicalMessageSource hms = (HierarchicalMessageSource) this.messageSource; if (hms.getParentMessageSource() == null) &#123; // Only set parent context as parent MessageSource if no parent MessageSource // registered already. hms.setParentMessageSource(getInternalParentMessageSource()); &#125; &#125; //ã€‚ã€‚ã€‚è¿™é‡Œçœç•¥ &#125;&#125; åœ¨debugæ—¶çš„ç»“æžœï¼Œå› ä¸ºSpringBooté»˜è®¤å®žçŽ°ç±»Messageï¼Œæ‰€ä»¥å®¹å™¨ä¼šåŠ è½½SpringBooté…ç½®å¥½çš„å›½é™…åŒ–é…ç½®æ–‡ä»¶ã€‚å¦‚å›¾ä¸­çš„basenameSet; onRefreshåœ¨è¿™ä¸€æ­¥ï¼ŒSpringBootä¼šæ ¹æ®åº”ç”¨ç±»åž‹æ¥åˆ¤æ–­ï¼Œå¦‚æžœæ˜¯webåº”ç”¨ï¼Œåˆ™ä¼šå¯åŠ¨é»˜è®¤çš„webå®¹å™¨ï¼Œå¦‚tomcatã€‚å®ƒå›žåŽ»æ‰¾æ‰€æœ‰çš„ç±»åž‹ä¸ºServletWebServerFactoryçš„ç±»ã€‚ç„¶åŽèŽ·å–ç¬¬ä¸€ä¸ªgetBeanFactory().getBean(beanNames[0], ServletWebServerFactory.class);è¿›è¡Œbeanæ³¨å…¥ã€‚è¿™æ ·é€šè¿‡æ³¨å…¥çš„beanå°±èƒ½å¤Ÿå¯åŠ¨webå®¹å™¨äº†ã€‚ SpringBootä¸­é»˜è®¤å®žçŽ°æœ‰ä»¥ä¸Šå‡ ç§ã€‚ registerListeners æ³¨å†Œlistenersåœ¨è¿™ä¸€æ­¥ï¼Œæ³¨å†Œç±»åž‹ä¸ºApplicationListenerçš„æ‰€æœ‰listeners; finishBeanFactoryInitialization å®Œæˆæ‰€æœ‰éžæ‡’åŠ è½½çš„beançš„åˆå§‹åŒ–finishRefresh å®Œæˆåˆ·æ–°è¿™æ­¥æœ‰ä»¥ä¸‹å‡ ä¸ªæ“ä½œã€‚ clearResourceCachesæ–¹æ³•ã€‚ æ¸…ç©ºcontext-levelçš„ç¼“å­˜ã€‚ initLifecycleProcessoræ–¹æ³•ï¼Œç”¨æ¥è®¾ç½®ç”Ÿå‘½å‘¨æœŸprocesser å‘å¸ƒæœ€åŽçš„äº‹ä»¶ï¼ˆContextRefreshedEventï¼‰ ä»¥ä¸Šå°±å®Œæˆäº†refreshæ–¹æ³•ä¸­çš„æ‰€æœ‰æ“ä½œã€‚]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootå¯åŠ¨åŽŸç†]]></title>
    <url>%2F2019%2F08%2F05%2FSpringBoot%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[SpringBootçš„å¯åŠ¨åŽŸç†åˆ›å»ºå¯åŠ¨å™¨SpringBooté€šè¿‡è°ƒç”¨ä¸»ç¨‹åºå¯åŠ¨åº”ç”¨çŽ¯å¢ƒã€‚ä¸‹é¢ä»£ç ä¸ºåº”ç”¨å¯åŠ¨å™¨çš„åŸºæœ¬ä»£ç ã€‚ å¯åŠ¨å™¨123456789101112// æ ‡æ³¨è¿™æ˜¯SpringBootåº”ç”¨@SpringBootApplication// å¼€å¯cache@EnableCachingpublic class WebProjectApplication &#123; public static void main(String[] args) &#123; // fastJsonä¸ä½¿ç”¨å¾ªçŽ¯å¼•ç”¨ ï¼ˆ$refï¼‰ JSON.DEFAULT_GENERATE_FEATURE |= SerializerFeature.DisableCircularReferenceDetect.getMask(); // ä½¿ç”¨SpringApplicationå¯åŠ¨åº”ç”¨ SpringApplication.run(WebProjectApplication.class); &#125;&#125; è¿›å…¥SpringApplication.runæ–¹æ³•ä¹‹åŽï¼Œå‘çŽ°ç¨‹åºä¼šè°ƒç”¨new SpringApplication æ¥åˆ›å»ºåº”ç”¨ã€‚ 123public static ConfigurableApplicationContext run(Class&lt;?&gt;[] primarySources, String[] args)&#123; return new SpringApplication(primarySources).run(args);&#125; åœ¨new SpringApplicationåˆ›å»ºå®žä¾‹çš„è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨å®¹å™¨ä¼šä»ŽåŠ è½½ä¸€äº›ä¸»ç±»ã€‚æ¯”å¦‚ä»£ç ä¸­æ‰€å†™çš„ï¼š åˆå§‹åŒ–SpringApplication123456789101112131415public SpringApplication(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources) &#123; // è¿™é‡Œçš„ primarySources å°±æ˜¯ ä¸Šé¢çš„ WebProjectApplication this.resourceLoader = resourceLoader; Assert.notNull(primarySources, "PrimarySources must not be null"); this.primarySources = new LinkedHashSet&lt;&gt;(Arrays.asList(primarySources)); // æ ¹æ®classpath æ¥åˆ¤æ–­åº”å½“å¯åŠ¨ä»€ä¹ˆæ ·çš„åº”ç”¨ç¨‹åºï¼Ÿ 1. éžweb 2.webå¹¶ä½¿ç”¨å†…å®¹selvletå®¹å™¨ // 3. web ä½†ä¸å®žç”¨å†…ç½®webå®¹å™¨ this.webApplicationType = WebApplicationType.deduceFromClasspath(); // è®¾ç½® Initializer setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class)); // è®¾ç½® Listener setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class)); //åˆ¤æ–­ä¸»è¿è¡Œç¨‹åºæ˜¯å“ªä¸ªï¼Œæ¯”å¦‚æœ‰å¤šä¸ªä¸»ç¨‹åºï¼Œåˆ°åº•ä½¿ç”¨å“ªä¸ªã€‚ this.mainApplicationClass = deduceMainApplicationClass();&#125; åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œåœ¨setInitializerså’ŒsetListenersçš„è¿‡ç¨‹æ˜¯ç±»ä¼¼çš„ã€‚ä¸»è¦æ–¹æ³•å°±æ˜¯ä»ŽMETA-INF/spring.factoriesä¸­åŠ è½½ç‰¹å®šçš„keyå€¼ä¸‹çš„valueã€‚ 12345678910private &lt;T&gt; Collection&lt;T&gt; getSpringFactoriesInstances(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, Object... args) &#123; ClassLoader classLoader = getClassLoader(); // ä½¿ç”¨setåŠ è½½æ‰€æœ‰çš„å…¨ç±»å Set&lt;String&gt; names = new LinkedHashSet&lt;&gt;(SpringFactoriesLoader.loadFactoryNames(type, classLoader)); // æ ¹æ®ç±»åé€šè¿‡åå°„åˆ›å»ºå®žä¾‹ List&lt;T&gt; instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names); AnnotationAwareOrderComparator.sort(instances); // è¿”å›žå®žä¾‹ return instances;&#125; ä¸Šé¢åˆ†æžäº†getSpringFactoriesInstancesè¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•èŽ·å–å®žä¾‹çš„ï¼Œå…¶ä¸­èŽ·å–çš„é€”å¾„å°±æ˜¯ä½¿ç”¨SpringFactoriesLoader.loadFactoryNamesèŽ·å–å…¨ç±»åï¼Œç„¶åŽé€šè¿‡åå°„è¿›è¡Œåˆ›å»ºå®žä¾‹ã€‚ 12345678910111213141516public static List&lt;String&gt; loadFactoryNames(Class&lt;?&gt; factoryClass, @Nullable ClassLoader classLoader) &#123; // èŽ·å–ä¼ é€’è¿›æ¥çš„ ç±»å String factoryClassName = factoryClass.getName(); // å¦‚æžœä¸å­˜åœ¨å°±è¿”å›žä¸€ä¸ªç©ºçš„listï¼Œå¦‚æžœä¸ä¸ºç©ºåˆ™è¿”å›žä¸€ä¸ªå…¨ç±»åçš„ä¸€ä¸ªlist // è¿™ä¸ªlistæ˜¯ä»Žä¸‹é¢æ˜¯æ–¹æ³•ä¸­çš„resultä¸­ç›´æŽ¥èŽ·å–value return loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());&#125;// èŠ‚é€‰ä¸€æ®µä»£ç æ¥çœ‹loadSpringFactories æ–¹æ³•æ˜¯å¦‚ä½•å®žçŽ°çš„private static Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(@Nullable ClassLoader classLoader) &#123; // ä»Žè·¯å¾„ä¸ŠèŽ·å–resource è¿™ä¸ªè·¯å¾„æ­£æ˜¯ META-INF/spring.factories åŠ è½½æ‰€æœ‰çš„ // è¿™ä¸ªè·¯å¾„ä¸‹çš„url ç»„æˆä¸€ä¸ªresult Enumeration&lt;URL&gt; urls = (classLoader != null ? classLoader.getResources(FACTORIES_RESOURCE_LOCATION) : ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION)); result = new LinkedMultiValueMap&lt;&gt;(); while (urls.hasMoreElements()) &#123; // å¾ªçŽ¯ ä¸Šé¢çš„ä¸€ç³»åˆ—æ–¹æ³•åªæ˜¯ä¸ºç»™SpringApplicationè¿›è¡Œåˆå§‹åŒ–çš„ç›¸å…³æ“ä½œï¼Œä¸‹ä¸€æ­¥ï¼Œè°ƒç”¨SpringApplication.runæ­£å¼è¿è¡Œå®¹å™¨. å¯åŠ¨å™¨å¯åŠ¨åœ¨æ–°å»ºå®ŒSpringApplicationåŽï¼Œä½¿ç”¨runæ–¹æ³•æ­£å¼å¯åŠ¨å®¹å™¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950new SpringApplication(primarySources).run(args); // è¿™ä¸ªrunæ–¹æ³•ç›´æŽ¥è°ƒç”¨çš„æ˜¯ä»¥ä¸‹ä»£ç public ConfigurableApplicationContext run(String... args) &#123; // åˆ›å»ºä¸€ä¸ªè·‘è¡¨ StopWatch stopWatch = new StopWatch(); stopWatch.start(); ConfigurableApplicationContext context = null; // arrayListç±»åž‹çš„Exception Reporters Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList&lt;&gt;(); // é…ç½®headless configureHeadlessProperty(); // èŽ·å–æ‰€æœ‰çš„listeners SpringApplicationRunListeners listeners = getRunListeners(args); // å¯åŠ¨listeners listeners.starting(); try &#123; // å°è£…å‘½ä»¤è¡Œargs ApplicationArguments applicationArguments = new DefaultApplicationArguments(args); //å‡†å¤‡çŽ¯å¢ƒ ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments); //é€šè¿‡è®¾ç½®spring.beaninfo.ignoreæ¥å¿½ç•¥beanè®¾ç½® configureIgnoreBeanInfo(environment); // æ‰“å°Springæ ‡è®° Banner printedBanner = printBanner(environment); // ç­–ç•¥åˆ›å»ºæŒ‡å®šçš„applicationContext context = createApplicationContext(); exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class, new Class[] &#123; ConfigurableApplicationContext.class &#125;, context); prepareContext(context, environment, listeners, applicationArguments, printedBanner); // åˆ·æ–°ä¸Šä¸‹æ–‡ï¼Œåˆ›å»ºioc refreshContext(context); // åœ¨ä¸Šä¸‹æ–‡åˆ·æ–°ä¹‹åŽè°ƒç”¨ afterRefresh(context, applicationArguments); stopWatch.stop(); if (this.logStartupInfo) &#123; new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch); &#125; // å®Œæˆç›‘å¬å™¨çš„å¯åŠ¨ listeners.started(context); // è°ƒç”¨callRunners callRunners(context, applicationArguments); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, listeners); throw new IllegalStateException(ex); &#125; try &#123; listeners.running(context); getRunListenersæ–¹æ³•ä¸Žå¯åŠ¨ListenersèŽ·å¾—æ‰€æœ‰çš„listenersï¼Œç„¶åŽè°ƒç”¨ listeners.starting();è¿è¡Œç›‘å¬å™¨ã€‚ åœ¨è¿™ä¸ªæ–¹æ³•ä¸­,ä½¿ç”¨åˆ°äº†getSpringFactoriesInstancesæ–¹æ³•ï¼Œä¸Šé¢è¯´åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•å®žé™…ä¸Šå°±æ˜¯ä»Žspring.factoryä¸­èŽ·å–æ‰€æœ‰çš„keyä¸ºç‰¹å®šå€¼çš„ç±»ã€‚åœ¨getRunListenersæ–¹æ³•é‡Œå°±æ˜¯èŽ·å–æ‰€æœ‰çš„keyä¸ºSpringApplicationRunListenerçš„æ‰€æœ‰valueã€‚å‚è€ƒä¸‹å›¾ä¸­å†…å®¹ï¼š 12345private SpringApplicationRunListeners getRunListeners(String[] args) &#123; Class&lt;?&gt;[] types = new Class&lt;?&gt;[] &#123; SpringApplication.class, String[].class &#125;; return new SpringApplicationRunListeners(logger, getSpringFactoriesInstances(SpringApplicationRunListener.class, types, this, args));&#125; ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå°±å¯ä»¥èŽ·å–åˆ°æ‰€æœ‰çš„RunListenersã€‚ä½¿ç”¨startingæ–¹æ³•æ¥æ‰¹é‡çš„å¼€å¯listenerã€‚å…¶å†…éƒ¨å®žçŽ°å¦‚ä¸‹é¢çš„ä»£ç ã€‚æ˜¯ä½¿ç”¨forå¾ªçŽ¯å°†æ‰€æœ‰åŠ è½½åˆ°çš„listenerså¯åŠ¨ã€‚ 12345public void starting() &#123; for (SpringApplicationRunListener listener : this.listeners) &#123; listener.starting(); &#125;&#125; prepareEnvironment å‡†å¤‡çŽ¯å¢ƒ12345678910111213141516171819private ConfigurableEnvironment prepareEnvironment(SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments) &#123; // èŽ·å¾—é…ç½®çŽ¯å¢ƒ ConfigurableEnvironment environment = getOrCreateEnvironment(); // é…ç½®çŽ¯å¢ƒ configureEnvironment(environment, applicationArguments.getSourceArgs()); // åœ¨çŽ¯å¢ƒå‡†å¤‡å¥½åŽç«‹å³è°ƒç”¨ç›‘å¬å™¨çš„environmentPreparedæ–¹æ³• // éœ€è¦åœ¨SpringApplicationåˆ›å»ºä¹‹å‰æ‰§è¡Œ listeners.environmentPrepared(environment); // ç»‘å®šåˆ°SpringApplication bindToSpringApplication(environment); if (!this.isCustomEnvironment) &#123; environment = new EnvironmentConverter(getClassLoader()).convertEnvironmentIfNecessary(environment, deduceEnvironmentClass()); &#125; //å°†ConfigurationPropertySourcesæ”¯æŒæŒ‡å®šçš„çŽ¯å¢ƒã€‚ ConfigurationPropertySources.attach(environment); return environment;&#125; åœ¨é…ç½®çŽ¯å¢ƒçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦é…ç½®propertieså±žæ€§å’Œprofileã€‚ 12345678910protected void configureEnvironment(ConfigurableEnvironment environment, String[] args) &#123; // å¦‚æžœéœ€è¦è¿›è¡Œåœ¨propertieså±žæ€§ä¸Šçš„ç±»åž‹è½¬æ¢ if (this.addConversionService) &#123; ConversionService conversionService = ApplicationConversionService.getSharedInstance(); environment.setConversionService((ConfigurableConversionService) conversionService); &#125; configurePropertySources(environment, args); // é…ç½®profileï¼ŒåŒ…æ‹¬æ¿€æ´»çš„é…ç½®æ–‡ä»¶ç­‰ã€‚ configureProfiles(environment, args);&#125; configureProfiles é…ç½®profile12345678protected void configureProfiles(ConfigurableEnvironment environment, String[] args) &#123; //è®¾ç½®æ¿€æ´»çš„profileï¼Œå¯ä»¥é€šè¿‡å±žæ€§ spring.profiles.activeæ¥è®¾ç½® environment.getActiveProfiles(); Set&lt;String&gt; profiles = new LinkedHashSet&lt;&gt;(this.additionalProfiles); profiles.addAll(Arrays.asList(environment.getActiveProfiles())); // åœ¨çŽ¯å¢ƒä¸­è®¾ç½®æ¿€æ´»çš„profiles environment.setActiveProfiles(StringUtils.toStringArray(profiles));&#125; printBanner æ‰“å°æ ‡å¿—printBanneræ–¹æ³•ç”¨æ¥æ‰“å°è¿è¡Œç¨‹åºæ—¶çš„æ ‡å¿—ï¼Œè§ä¸‹å›¾ è¿™ä¸ªæ–¹æ³•æœ€åŽé€šè¿‡printæ–¹æ³•æ¥è¾“å‡º 1234567891011121314public Banner print(Environment environment, Class&lt;?&gt; sourceClass, PrintStream out) &#123; // èŽ·å–banner Banner banner = getBanner(environment); banner.printBanner(environment, sourceClass, out); return new PrintedBanner(banner, sourceClass);&#125;// é»˜è®¤æ˜¯ DEFAULT_BANNERprivate static final String[] BANNER = &#123; "", " . ____ _ __ _ _", " /\\\\ / ___'_ __ _ _(_)_ __ __ _ \\ \\ \\ \\", "( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\", " \\\\/ ___)| |_)| | | | | || (_| | ) ) ) )", " ' |____| .__|_| |_|_| |_\\__, | / / / /", " =========|_|==============|___/=/_/_/_/" &#125;;private static final String SPRING_BOOT = " :: Spring Boot :: "; createApplicationContext åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡çŽ¯å¢ƒcreateApplicationContextæ–¹æ³•ç”¨æ¥ç­–ç•¥åˆ›å»ºæŒ‡å®šçš„applicationContext; 1234567891011121314151617181920212223242526272829protected ConfigurableApplicationContext createApplicationContext() &#123; Class&lt;?&gt; contextClass = this.applicationContextClass; if (contextClass == null) &#123; try &#123; switch (this.webApplicationType) &#123; // å¦‚æžœæ˜¯servletçŽ¯å¢ƒ case SERVLET: // åˆ›å»ºAnnotationConfigServletWebServerApplicationContext // é€‚ç”¨äºŽé»˜è®¤çš„webçŽ¯å¢ƒ contextClass = Class.forName(DEFAULT_SERVLET_WEB_CONTEXT_CLASS); break; case REACTIVE: // åˆ›å»ºAnnotationConfigReactiveWebServerApplicationContext // é€‚ç”¨äºŽreactive webçŽ¯å¢ƒ contextClass = Class.forName(DEFAULT_REACTIVE_WEB_CONTEXT_CLASS); break; default: // åˆ›å»ºAnnotationConfigApplicationContextï¼ŒéžwebçŽ¯å¢ƒ contextClass = Class.forName(DEFAULT_CONTEXT_CLASS); &#125; &#125; catch (ClassNotFoundException ex) &#123; throw new IllegalStateException( "Unable create a default ApplicationContext, " + "please specify an ApplicationContextClass", ex); &#125; &#125; return (ConfigurableApplicationContext) BeanUtils.instantiateClass(contextClass);&#125; prepareContext å‡†å¤‡ä¸Šä¸‹æ–‡12345678910111213141516171819202122private void prepareContext(ConfigurableApplicationContext context, ConfigurableEnvironment environment, SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner) &#123; context.setEnvironment(environment); /** * åŽç½®å¤„ç†context * 1. åˆ›å»ºä¸€ä¸ªå•ä¾‹çš„beanNameGenerator * 2. å¦‚æžœresourceLoaderä¸ä¸ºç©ºï¼Œåˆ™è®¾ç½®resourceLoaderå’ŒclassLoader\ * 3. è®¾ç½®ç”¨äºŽå±žæ€§å€¼è½¬æ¢çš„ConversionService */ postProcessApplicationContext(context); // é€šè¿‡åœ¨ åˆå§‹åŒ–SpringApplication è¿™é‡Œè®¾ç½®çš„Initializersæ¥å¯¹çŽ¯å¢ƒè¿›è¡Œè®¾ç½® applyInitializers(context); // å‘Šè¯‰ç›‘å¬å™¨ä¸Šä¸‹æ–‡å‡†å¤‡å¥½äº† listeners.contextPrepared(context); if (this.logStartupInfo) &#123; logStartupInfo(context.getParent() == null); logStartupProfileInfo(context); &#125; // ... ä¸­é—´çœç•¥ // å†æ¬¡è°ƒç”¨ç›‘å¬å™¨çš„äº‹ä»¶ï¼Œé€šçŸ¥ç›‘å¬å™¨ä¸Šä¸‹æ–‡å·²ç»åŠ è½½å®Œæˆ listeners.contextLoaded(context);&#125; refreshContext åˆ·æ–°ä¸Šä¸‹æ–‡ç”¨äºŽåˆ·æ–°ä¸Šä¸‹æ–‡ï¼Œåˆ·æ–°ä¸Šä¸‹æ–‡çš„è¿‡ç¨‹å…¶å®žå°±æ˜¯IOCå®¹å™¨åˆå§‹åŒ–çš„è¿‡ç¨‹(æ‰«æã€åŠ è½½ã€åˆ›å»ºæ‰€æœ‰çš„ç»„ä»¶)ã€‚å¦‚æžœæ˜¯webåº”ç”¨ï¼Œè¿˜ä¼šè‡ªåŠ¨å¯åŠ¨åµŒå…¥å¼çš„tomcat.å…·ä½“æ–¹æ³•ä¼šå•æ‹¿å‡ºæ¥ä¸€ç¯‡æ¥åˆ†æžrefreshçš„è¿‡ç¨‹ã€‚ 12345678910111213141516171819202122232425262728293031323334@Overridepublic void refresh() throws BeansException, IllegalStateException &#123; synchronized (this.startupShutdownMonitor) &#123; // å‡†å¤‡æ­¤ä¸Šä¸‹æ–‡ä»¥è¿›è¡Œåˆ·æ–°ï¼Œè®¾ç½®å…¶å¯åŠ¨æ—¥æœŸ // å¹¶ä¸”è®¾ç½® active æ ‡å¿—ä»¥åŠæ‰§è¡Œå±žæ€§æºï¼ˆç³»ç»Ÿå±žæ€§ã€çŽ¯å¢ƒå˜é‡ï¼‰çš„ä»»ä½•åˆå§‹åŒ–ã€‚ prepareRefresh(); // å‘Šè¯‰å­ç±»åˆ·æ–° bean factory. ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); // ä¸ºä¸Šä¸‹æ–‡å‡†å¤‡ bean factory. prepareBeanFactory(beanFactory); // æŽ¥ä¸‹æ¥çš„æ–¹æ³•å°±æ˜¯è£…è½½ç»„ä»¶çš„æ–¹æ³• try &#123; // Allows post-processing of the bean factory in context subclasses. postProcessBeanFactory(beanFactory); // ä½¿ç”¨beanFactoryåœ¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œbean invokeBeanFactoryPostProcessors(beanFactory); // æ³¨å†Œbeançš„æ‹¦æˆªå™¨ registerBeanPostProcessors(beanFactory); // åŠ è½½å›½é™…åŒ– initMessageSource(); // åˆå§‹åŒ–ä¸Šä¸‹æ–‡çš„äº‹ä»¶å¹¿æ’­ initApplicationEventMulticaster(); // åŠ è½½ç‰¹æ®Šçš„bean onRefresh(); // åŠ è½½æ‰€æœ‰çš„listenerså¹¶å¯åŠ¨ registerListeners(); // å®Œæˆå¯¹æ‰€æœ‰çš„å‰©ä¸‹çš„éžæ‡’åŠ è½½çš„å•ä¾‹çš„åˆ›å»º finishBeanFactoryInitialization(beanFactory); // æœ€åŽå‘å¸ƒå¯¹åº”çš„äº‹ä»¶ã€‚ finishRefresh(); &#125; &#125;&#125; è°ƒç”¨callRunnerså¯åŠ¨è¿‡ç¨‹å›¾è§£ä½¿ç”¨ä¸€å¼ ç®€å•çš„æµç¨‹å›¾å°†ä¸Šé¢æ‰€æœ‰çš„ä¸»è¦æ–¹æ³•ä¸²è”èµ·æ¥ï¼Œæ¥æŸ¥çœ‹SpringBootçš„å¯åŠ¨æµç¨‹ã€‚ åœ¨æ•´ä¸ªå¯åŠ¨æµç¨‹çš„è¿‡ç¨‹ä¸­åˆä¸€ä¸ªé‡è¦çš„ç»„ä»¶å°±æ˜¯listeners.å®ƒæ¥ç›‘å¬åº”ç”¨è¿è¡Œçš„è¿‡ç¨‹ã€‚åœ¨ç¨‹åºä¸­çš„ä½“çŽ°å°±æ˜¯ç‰¹å®šçš„èŠ‚ç‚¹è°ƒç”¨listenersçš„å›žè°ƒæ–¹æ³•ã€‚å…·ä½“çš„è°ƒç”¨listenersè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€å±•ç¤ºçš„ï¼š ç»“æŸè¿™ç¯‡æ–‡ç« æ ¹æ®ä»£ç æ¥åˆ†æžSpringBootçš„å¯åŠ¨è¿‡ç¨‹ã€‚åˆ†æžçš„æ¯”è¾ƒæ½¦è‰ï¼Œæœ‰äº›åœ°æ–¹åˆ†æžçš„ä¸æ¸…æ™°æˆ–è€…åˆ†æžå‡ºé”™çš„åœ°æ–¹ï¼Œæ¬¢è¿ŽæŒ‡æ­£ï¼Œå…±åŒè¿›æ­¥ï¼ã€‚]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootçš„é”™è¯¯å¤„ç†æœºåˆ¶]]></title>
    <url>%2F2019%2F07%2F17%2F2019-07-17-SpringBoot%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[åœ¨webå¼€å‘ä¸­çš„å¼‚å¸¸é”™è¯¯å¤„ç†SpringBooté»˜è®¤æœ‰ä¸€å¥—å¯¹webå¼€å‘é”™è¯¯å¤„ç†çš„æœºåˆ¶ï¼Œåœ¨autoConfigurationåŒ…ä¸‹é¢æ‰¾åˆ°äº†ErrorMvcAutoConfigurationã€‚ 12345678@Configuration// åªæœ‰åŸºäºŽservletçš„webç¨‹åº@ConditionalOnWebApplication(type = Type.SERVLET)@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class &#125;)// éœ€è¦å…ˆåŠ è½½WebMvcAutoConfiguration@AutoConfigureBefore(WebMvcAutoConfiguration.class)@EnableConfigurationProperties(&#123; ServerProperties.class, ResourceProperties.class, WebMvcProperties.class &#125;)public class ErrorMvcAutoConfiguration &#123; å¤„ç†æœºåˆ¶åœ¨è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­ï¼Œç”±ä¸‰ä¸ªæœ€åŸºæœ¬çš„beanç»„ä»¶ç»„æˆï¼Œä¸‹é¢æŒ¨ä¸ªçœ‹è¿™äº›æ³¨å…¥åˆ°å®¹å™¨ä¸­çš„beançš„å«ä¹‰ errorPageCustomizer å®šä¹‰é”™è¯¯é¡µé¢12345678910111213141516@Beanpublic ErrorPageCustomizer errorPageCustomizer() &#123; return new ErrorPageCustomizer(this.serverProperties, this.dispatcherServletPath);&#125;// åœ¨ErrorPageCustomizeræœ‰ä¸€ä¸ªregisterErrorPages æ³¨å†Œé¡µé¢çš„æ–¹æ³•public void registerErrorPages(ErrorPageRegistry errorPageRegistry) &#123; ErrorPage errorPage = new ErrorPage( // ç”¨äºŽèŽ·å–erroré¡µé¢çš„åœ°å€ this.dispatcherServletPath.getRelativePath(this.properties.getError().getPath())); errorPageRegistry.addErrorPages(errorPage); &#125;// åœ°å€åœ¨ this.properties.getError().getPath()å˜é‡ä¸­å…·ä½“çš„å€¼ï¼š @Value("$&#123;error.path:/error&#125;")// é…ç½®æ–‡ä»¶ä¸­error.pathä¸‹çš„/erroræˆ–è€…æ ¹ç›®å½•ä¸‹çš„/erroræ–‡ä»¶å¤¹ private String path = "/error"; æ‰€ä»¥errorPageCustomizerçš„ä¸»è¦åŠŸèƒ½å°±æ˜¯æ‰¾åˆ°åœ°å€ï¼Œæ‹¼è£…æˆErrorPage; WhitelabelErrorViewConfiguration ç©ºç™½é¡µçš„é…ç½®123456789protected static class WhitelabelErrorViewConfiguration &#123; // åœ¨StaticViewä¸­å®šä¹‰äº†é»˜è®¤çš„Whitelabelé¡µé¢æ ¼å¼ï¼Œ private final StaticView defaultErrorView = new StaticView(); @Bean(name = "error") @ConditionalOnMissingBean(name = "error") public View defaultErrorView() &#123; return this.defaultErrorView; &#125; basicErrorController æŽ§åˆ¶å™¨basicErrorControllerå°±æ˜¯ç®€å•çš„æŽ§åˆ¶å™¨ 12345@Controller //controllerå®žçŽ° æ³¨å†Œåˆ°å®¹å™¨ä¸­// é”™è¯¯æ˜ å°„åœ°å€ error.path æˆ–// server.error.path ä¸‹ /error@RequestMapping("$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;")public class BasicErrorController extends AbstractErrorController åœ¨è¿™ä¸ªControllerä¸­æ˜ å°„åˆ°äº†/erroråœ°å€ä¸Šï¼Œæœ‰å…·æœ‰ä¸¤ä¸ªRequestMappingè¿›è¡Œæ˜ å°„ã€‚ è¯·æ±‚çš„åª’ä½“ç±»åž‹ä¸ºtext/htmlæ—¶12345678910111213@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)// åª’ä½“ç±»åž‹ä¸º text/html æ—¶å€™ä½¿ç”¨è¿™ä¸ªå¯¹/errorçš„æŽ¥æ”¶public ModelAndView errorHtml(HttpServletRequest request, HttpServletResponse response) &#123; // èŽ·å¾—requestä¸­çš„çŠ¶æ€ç  // Integer statusCode = // (Integer) request.getAttribute("javax.servlet.error.status_code"); HttpStatus status = getStatus(request); Map&lt;String, Object&gt; model = Collections .unmodifiableMap(getErrorAttributes(request, isIncludeStackTrace(request, MediaType.TEXT_HTML))); response.setStatus(status.value()); ModelAndView modelAndView = resolveErrorView(request, response, status, model); return (modelAndView != null) ? modelAndView : new ModelAndView("error", model);&#125; å…¶ä¸­ä½¿ç”¨å¤«ç±»ä¸­çš„getErrorAttributesæ–¹æ³•æ¥èŽ·å–åŸºæœ¬å±žæ€§æ•°æ®ï¼Œé€šè¿‡return this.errorAttributes.getErrorAttributes(webRequest, includeStackTrace)ç›´æŽ¥è°ƒç”¨å·²ç»æ³¨å…¥åˆ°å®¹å™¨ä¸­çš„ErrorAttributesç±»åŠå…¶å­ç±»ã€‚å¦‚é»˜è®¤çš„DefaultErrorAttributesã€‚ 1234567891011121314@Overridepublic Map&lt;String, Object&gt; getErrorAttributes(WebRequest webRequest, boolean includeStackTrace) &#123; Map&lt;String, Object&gt; errorAttributes = new LinkedHashMap&lt;&gt;(); // è¿”å›žåˆ°é¡µé¢çš„å½“å‰ç³»ç»Ÿæ—¶é—´ errorAttributes.put("timestamp", new Date()); // ä¸‹é¢çš„ javax.xxxx éƒ½æ˜¯ä»Žrequesetä¸­å¾—åˆ°çš„ // è¿”å›žçŠ¶æ€ç  javax.servlet.error.status_code addStatus(errorAttributes, webRequest); //é”™è¯¯ä¿¡æ¯ avax.servlet.error.message addErrorDetails(errorAttributes, webRequest, includeStackTrace); // è¯·æ±‚è·¯å¾„ javax.servlet.error.request_uri addPath(errorAttributes, webRequest); return errorAttributes;&#125; åœ¨èŽ·å–å®Œéœ€è¦è¿”å›žçš„æ•°æ®ä¹‹åŽï¼Œè¿”å›žä¸€ä¸ªmodelAndViewå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¸¦æœ‰æ˜¾ç¤ºçš„ç•Œé¢ã€‚ é»˜è®¤ä½¿ç”¨DefaultErrorViewResolveræ¥è¿›è¡Œå¯¹ErrorViewçš„è§£æžã€‚ 12345678910@Overridepublic ModelAndView resolveErrorView(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model) &#123; // èŽ·å–modelandviewå¯¹è±¡ ModelAndView modelAndView = resolve(String.valueOf(status.value()), model); if (modelAndView == null &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123; // å¦‚æžœæ²¡æœ‰modelandview modelAndView = resolve(SERIES_VIEWS.get(status.series()), model); &#125; return modelAndView;&#125; å¦‚æžœæ²¡æœ‰é€šè¿‡resolveæ–¹æ³•æ‰¾åˆ°ä¸€ä¸ªmodelAndViewã€‚åˆ™ä¼šæœ‰ç±»ä¼¼é€šè¿‡ 5xx.html é¡µé¢æ¥å±•ç¤º5å¼€å¤´çš„é‚£äº›é”™è¯¯çš„é¡µé¢ã€‚å¯é€‰å€¼æœ‰ä¸‹é¢ä¸¤ç§ï¼š 123views.put(Series.CLIENT_ERROR, "4xx");views.put(Series.SERVER_ERROR, "5xx");SERIES_VIEWS = Collections.unmodifiableMap(views); 12345678910111213141516// ä½¿ç”¨resolveæ–¹æ³•æ¥èŽ·å–ModelAndViewprivate ModelAndView resolve(String viewName, Map&lt;String, Object&gt; model) &#123; //è¿™é‡Œçš„viewNameä¸ºçŠ¶æ€ç¼–ç ï¼Œè§†å›¾ä¸º error/ã€ŒçŠ¶æ€ç å€¼ã€ String errorViewName = "error/" + viewName; TemplateAvailabilityProvider provider = this.templateAvailabilityProviders.getProvider(errorViewName, this.applicationContext); if (provider != null) &#123; // å¦‚403é”™è¯¯ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›ž error/403.html å‰ææ˜¯æœ‰æ¨¡ç‰ˆå¼•æ“Ž return new ModelAndView(errorViewName, model); &#125; // æ²¡æœ‰å°±åŽ» &#123; "classpath:/META-INF/resources/", // "classpath:/resources/", "classpath:/static/", "classpath:/public/" &#125;; // è¿™å‡ ä¸ªè·¯å¾„ä¸Šæ‰¾ è·¯å¾„ä¸‹çš„error/xxx.htmlï¼Œè¿™äº›è·¯å¾„å°±æ˜¯é»˜è®¤çš„èµ„æºæ–‡ä»¶è·¯å¾„ return resolveResource(errorViewName, model);&#125; å¦‚æžœåˆ°ä¸Šä¸€æ­¥ä»ä¸å­˜åœ¨viewåˆ™è¯´æ˜Žï¼Œæ¨¡ç‰ˆå¼•æ“Ž/åŸºæœ¬èµ„æºæ–‡ä»¶å¤¹ä¸‹å‡ä¸å­˜åœ¨erroræ–‡ä»¶å¤¹ä¸‹çš„xxx.htmlæ–‡ä»¶ï¼Œåˆ™ä¼šè¿”å›žä¸€ä¸ªé»˜è®¤çš„view ã€‚(modelAndView != null) ? modelAndView : new ModelAndView(&quot;error&quot;, model);ï¼Œå°±æ˜¯åœ¨æ ‡é¢˜ã€WhitelabelErrorViewConfigurationã€‘ä¸­æåŠåˆ°çš„StaticViewã€‚ è¯·æ±‚ä¸ºå…¶ä»–åª’ä½“ç±»åž‹1234567@RequestMappingpublic ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123; Map&lt;String, Object&gt; body = getErrorAttributes(request, isIncludeStackTrace(request, MediaType.ALL)); HttpStatus status = getStatus(request); // ç›´æŽ¥è¿”å›žmap return new ResponseEntity&lt;&gt;(body, status);&#125; errorAttributes é”™è¯¯é¡µé¢å±žæ€§ä¿¡æ¯12345@Bean@ConditionalOnMissingBean(value = ErrorAttributes.class, search = SearchStrategy.CURRENT)public DefaultErrorAttributes errorAttributes() &#123; return new DefaultErrorAttributes(this.serverProperties.getError().isIncludeException());&#125; è¿™ä¸ªbeanä¸»è¦æ˜¯ä½¿ç”¨getErrorAttributesæä¾›ErrorControllerè¿”å›žå€¼çš„ä¿¡æ¯ï¼Œå¦‚æžœçŠ¶æ€ç ç­‰ã€‚ã€‚å¦‚æžœæƒ³æ›´æ”¹é”™è¯¯ä¿¡æ¯çš„è¿”å›žå€¼å†…å®¹ï¼Œå¯ä»¥ç»§æ‰¿DefaultErrorAttributes,ç„¶åŽåœ¨getErrorAttributesæ–¹æ³•é‡Œæ·»åŠ æƒ³è¦æ·»åŠ çš„å†…å®¹å³å¯ã€‚ æ·»åŠ é”™è¯¯é¡µé¢å’Œä¿®æ”¹è¿”å›žä¿¡æ¯ä¸‹é¢å…·ä½“æ¥æ ¹æ®SpringBootç‰¹æ€§æ¥æ·»åŠ é”™è¯¯é¡µé¢ï¼Œå¦‚404ï¼Œ500ç­‰ã€‚ â€‹ å› ä¸ºåœ¨å¤„ç†æœºåˆ¶è¿™ç« é‡Œè¯´æ˜Žäº†SpringBootå¦‚ä½•å¤„ç†é”™è¯¯ï¼Œä»–ä¼šé»˜è®¤çš„è®¿é—®/error/åœ°å€ï¼Œå¹¶ä¸”å¦‚æžœæ˜¯text/htmlçš„åª’ä½“ç±»åž‹ï¼Œä¹Ÿå°±æ˜¯ç½‘é¡µè®¿é—®çš„è¯ï¼Œå¦‚æžœæœ‰æ¨¡ç‰ˆå¼•æ“Žï¼Œä»–ä¼šåŽ»æ‰¾åœ¨/erroræ–‡ä»¶ä¸­å¯¹åº”ç¼–ç çš„xxx.htmlé¡µé¢è¿›è€ŒåŽ»æ¸²æŸ“è¿™ä¸ªé¡µé¢ã€‚ â€‹ æ¯”å¦‚è®¿é—®404ï¼Œä»–ä¼šåŽ»æ‰¾classpath:/error/404.htmlé¡µé¢åŽ»æ¸²æŸ“ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œä»–ä¼šåŽ»æ‰¾classpath:/error/4xx.htmlï¼Œå¦‚æžœè¿˜æ²¡æœ‰ï¼Œä»–ä¼šè¿”å›žä¸€ä¸ªé¡µé¢ã€‚ æ·»åŠ erroré¡µé¢â€‹ ä¸ºäº†æ¼”ç¤ºï¼Œåˆ›å»º404.htmlå’Œ4xx.htmlï¼Œæ¥è¾¾åˆ°è¿™æ ·çš„ç›®çš„:å¦‚æžœå‘ç”Ÿ404é”™è¯¯ï¼Œåˆ™è®¿é—®404.htmlé¡µé¢ï¼Œå¦‚æžœå‘ç”Ÿ402æˆ–è€…ä»¥4å¼€å¤´çš„é”™è¯¯ï¼Œåˆ™è®¿é—®4xx.htmlé¡µé¢ã€‚ ç›®å½•ç»“æž„å’Œç¤ºä¾‹å†…å®¹å‚è€ƒå¦‚ä¸‹ï¼š å®šä¹‰å¼‚å¸¸å’Œå¯¹åº”çš„å¼‚å¸¸å¤„ç†123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public class NoAuthException extends RuntimeException &#123; public NoAuthException() &#123; super("æ— æƒé™å¼‚å¸¸"); &#125;&#125;public class NoUserExcetion extends RuntimeException &#123; public NoUserExcetion() &#123; super("æ— ç”¨æˆ·å¼‚å¸¸"); &#125;&#125;// å¼‚å¸¸å¤„ç†ç±»@ControllerAdvicepublic class MyExecptionHandler &#123; // å¤„ç†NoAuthException å¼‚å¸¸ @ExceptionHandler(value = NoAuthException.class) public String handlerNoAuthException(HttpServletRequest request)&#123; // è¿™æ˜¯å¿…é¡»çš„ï¼›å®šä¹‰è¿”å›žçš„codeå€¼ï¼Œè¿”å›žæŒ‡å®šçš„é”™è¯¯é¡µé¢ request.setAttribute("javax.servlet.error.status_code",402); Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); map.put("code",402); map.put("message","this is my no auth message"); // å°†è‡ªå®šä¹‰ä¿¡æ¯æ”¾å…¥ requestä¸­ request.setAttribute("errData",map); return "forward:/error"; &#125; //å¤„ç†NoUserExcetion å¼‚å¸¸ @ExceptionHandler(value = NoUserExcetion.class) public String handlerNoUserException(HttpServletRequest request)&#123; request.setAttribute("javax.servlet.error.status_code",400); Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); map.put("code",404); map.put("message","this is my no auth message"); request.setAttribute("errData",map); return "forward:/error"; &#125;&#125;// controllerç±»@RequestMapping("/hello")@ResponseBodypublic String hello(String name)&#123; if("abc".equals(name))&#123; // å¦‚æžœæ˜¯ /hello?name=abcçš„æ—¶å€™æŠ›å‡ºNoAuthExceptionå¼‚å¸¸ è·³è½¬åˆ°4xxé¡µé¢ throw new NoAuthException(); &#125; if("123".equals(name))&#123; // å¦‚æžœæ˜¯ /hello?name=123çš„æ—¶å€™æŠ›å‡ºNoUserExcetionçš„å¼‚å¸¸ è·³è½¬åˆ°404é¡µé¢ throw new NoUserExcetion(); &#125; return "hello world";&#125; å®šä¹‰è‡ªå®šä¹‰å±žæ€§ç±»12345678910111213@Component// æ”¾åˆ°å®¹å™¨ä¸­ï¼Œé»˜è®¤ä¼šæ›¿æ¢åˆ°springbootçš„é»˜è®¤çš„DefaultErrorAttributespublic class MyErrorAttributes extends DefaultErrorAttributes &#123; @Override public Map&lt;String, Object&gt; getErrorAttributes(WebRequest webRequest, boolean includeStackTrace) &#123; // èŽ·å–DefaultErrorAttributesçš„åŸºæœ¬å±žæ€§ Map&lt;String,Object&gt; map = super.getErrorAttributes(webRequest,includeStackTrace); Map&lt;String,Object&gt; errData = (Map&lt;String, Object&gt;) webRequest.getAttribute("errData", 0); // ä»Žrequestä¸­èŽ·å–è‡ªå®šä¹‰çš„dataï¼Œæ·»åŠ åˆ°è¿”å›žçš„ä¿¡æ¯ä¸­ã€‚ map.put("errData",errData); return map; &#125;&#125; é€šè¿‡ä»¥ä¸Šçš„è®¾ç½®ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æžœï¼š å¦‚æžœæ˜¯ /hello?name=abcçš„æ—¶å€™æŠ›å‡ºNoAuthExceptionå¼‚å¸¸ è·³è½¬åˆ°4xxé¡µé¢ å¦‚æžœæ˜¯ /hello?name=123çš„æ—¶å€™æŠ›å‡ºNoUserExcetionçš„å¼‚å¸¸ è·³è½¬åˆ°404é¡µé¢ å¦‚æžœæ²¡æœ‰è®¿é—®åœ°å€ä¹Ÿä¼šåˆ°404é¡µé¢ æµ‹è¯•ç»“æžœ è®¿é—®/hello?name=abc è·³è½¬åˆ°4xxé¡µé¢ è®¿é—®/hello?name=123 è·³è½¬åˆ°404é¡µé¢ ç»“è®ºåœ¨è€ƒè™‘å¯¹webé”™è¯¯é¡µé¢å¤„ç†çš„è§’åº¦ï¼Œæ— éžå°±æ˜¯ä¸¤ä¸ªæ–¹é¢ï¼š ä¸€ã€ é¡µé¢æ ·å¼â€‹ åœ¨æœ‰æ¨¡ç‰ˆå¼•æ“Žçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡DefaultErrorControlleråœ¨/errorä¸Šçš„è®¿é—®å¤„ç†ï¼Œæ¥è‡ªåŠ¨æ¸²æŸ“åœ¨template/error/ç›®å½•ä¸‹çš„å¯¹åº”çš„é”™è¯¯code.htmlçš„çš„å±•ç¤º,å¦‚404.htmlã€‚å¹¶ä¸”æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œå¦‚åˆ›å»º4xx.htmlé¡µé¢ï¼Œé‚£ä¹ˆå¦‚æžœæ²¡æœ‰å‘çŽ°ç‰¹å®šçš„é”™è¯¯ä»£ç é¡µé¢ï¼Œåˆ™è‡ªåŠ¨çš„ä½¿ç”¨4xxé¡µé¢ã€‚ äºŒã€ é¡µé¢å†…å®¹é¡µé¢å†…å®¹å¯ä»¥é€šè¿‡ç»§æ‰¿DefaultErrorAttributesç±»æ¥è¿›è¡Œç®€å•çš„å®žçŽ°ï¼Œå¦‚æžœæƒ³å…¨éƒ¨æ›¿æ¢æŽ‰SpringBootçš„é»˜è®¤å…¨éƒ¨çš„è¿”å›žå†…å®¹ï¼Œåˆ™éœ€è¦å®žçŽ°ErrorAttributesè¿›è¡Œå®žçŽ°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»æ”¾åˆ°å®¹å™¨ä¸­æ‰èƒ½ç”Ÿæ•ˆã€‚]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootçš„WEBå¼€å‘ä¹‹å›½é™…åŒ–]]></title>
    <url>%2F2019%2F07%2F15%2FSpringBoot%E7%9A%84WEB%E5%BC%80%E5%8F%91%E4%B9%8B%E5%9B%BD%E9%99%85%E5%8C%96%2F</url>
    <content type="text"><![CDATA[å‡†å¤‡å·¥ä½œSpringBooté»˜è®¤æ˜¯æ”¯æŒThymeleafæ¨¡ç‰ˆå¼•æ“Žçš„ã€‚ç›¸åº”çš„å¦‚æžœä½¿ç”¨Thymeleafå°±å¯ä»¥ä½¿ç”¨thymeleafçš„è¯­æ³•åœ¨é¡µé¢æ˜¾ç¤ºè¿”å›žç»™é¡µé¢çš„æ•°æ®ã€‚ ä½¿ç”¨thymeleafå¯¼å…¥starter å¦‚å›¾ï¼ŒSpringBootè‡ªåŠ¨é…ç½®æ˜¯å¯¼å…¥æœ‰Thymeleafç›¸å…³è‡ªåŠ¨é…ç½®æ–‡ä»¶çš„ï¼Œä½†æ˜¯ï¼Œçº¢è‰²éƒ¨åˆ†æ˜¯ç¼ºå°‘çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´å°‘åŒ…ã€‚è‡ªç„¶SpringBootä¼šæä¾›è¿™äº›ç›¸å…³çš„åŒ…çš„starters. é‚£ä¹ˆåœ¨å®˜ç½‘ä¸Šçš„startersä¸­å¯ä»¥æ‰¾åˆ°spring-boot-starter-thymeleafï¼Œè¯´æ˜ŽSpringBootæä¾›Thymeleafçš„starteréœ€è¦å¯¼å…¥ï¼Œæ‰èƒ½ä½¿ç”¨Thymeleafã€‚ åœ¨SpringBootä¸­Thymeleafçš„è‡ªåŠ¨é…ç½®12345678910111213@ConfigurationProperties(prefix = "spring.thymeleaf")public class ThymeleafProperties &#123;// charset private static final Charset DEFAULT_ENCODING = StandardCharsets.UTF_8;// é»˜è®¤åŠ è½½æ¨¡ç‰ˆçš„è·¯å¾„ public static final String DEFAULT_PREFIX = "classpath:/templates/";// é»˜è®¤åŠ è½½çš„æ–‡ä»¶ç±»åž‹ æ˜¯html public static final String DEFAULT_SUFFIX = ".html";// å¯è‡ªå·±ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ å‰ç¼€å’ŒåŽç¼€ï¼Œå¦‚æžœ spring.thymeleaf.suffix=.htmlx private String prefix = DEFAULT_PREFIX; private String suffix = DEFAULT_SUFFIX; ä½¿ç”¨Thymeleafè¿›è¡Œé¡µé¢æ¸²æŸ“æ‰€ä»¥åœ¨SpringBootä¸­åœ¨Controllerä¸­ä½¿ç”¨å¦‚ä¸‹ï¼š 12345678@Controllerpublic class HelloController &#123; @RequestMapping("/home") public String home(Map&lt;String,String&gt; map)&#123; map.put("hello","Hello World~~~"); return "home"; &#125;&#125; è¿™æ ·æ˜ å°„å™¨å°±ä¼šè‡ªåŠ¨æ˜ å°„åˆ°classpath:/templates/home.htmlæ–‡ä»¶ä¸Šã€‚ åœ¨templatesä¸‹å»ºç«‹home.htmlæ–‡ä»¶ 1234567891011&lt;!DOCTYPE html&gt; &lt;!--å¼•å…¥ xmlns:th ç”¨äºŽthymeleafè¯­æ³•æç¤º--&gt;&lt;html lang="en" xmlns:th="http://www.thymeleaf.org"&gt;&lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1 th:text="$&#123;hello&#125;"&gt;hello world&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt; é‡å¯åŽæŸ¥çœ‹http://localhost:8080/homeå‘çŽ°å·²ç»å¯ä»¥è®© /home æ˜ å°„åˆ° home.html æ–‡ä»¶ä¸Šäº†ã€‚å¹¶ä¸”æ ¹æ®æˆ‘ä»¬ä¼ è¿‡æ¥çš„å€¼ Hello World~~~ æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šäº†ã€‚ Thymeleafè¯­æ³•å¯ç›´æŽ¥å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£; ä½¿ç”¨SpringMVC SpringMvcæ¡†æž¶æ˜¯ä¸€ç§ä¸°å¯Œmodel view controller çš„webæ¡†æž¶ã€‚SpringMVCé€šè¿‡ä½¿ç”¨ @Controller å’Œ @RestController å®Œæˆå¯¹ HTTP è¯·æ±‚çš„å¤„ç†ã€‚é€šè¿‡ä½¿ç”¨ @RequestMapping å®Œæˆå¯¹è¯·æ±‚å¯¹controllerçš„æ˜ å°„ã€‚ è‡ªåŠ¨é…ç½® SpringBoot å¯¹ SpringMVC åœ¨è‡ªåŠ¨é…ç½®çš„æ—¶å€™ï¼Œè¿›è¡Œäº†å¾ˆå¤šé»˜è®¤çš„è®¾ç½®ã€‚åŒ…æ‹¬å‰ä¸€ç¯‡æ–‡ç« ä¸­çš„å…³äºŽé™æ€èµ„æºåŠ è½½çš„ä¸¤ç§æ–¹å¼ï¼ˆ Webjars å’Œæœ¬åœ°åŠ è½½ä½ç½®ï¼‰ï¼Œä¹Ÿæ˜¯é€šè¿‡ SpringBoot è¿›è¡Œè‡ªåŠ¨é…ç½®çš„ã€‚æ›´å¤šçš„ SpringBoot å¯¹ SpringMVC åœ¨å“ªäº›åœ°æ–¹è¿›è¡Œäº†è‡ªåŠ¨é…ç½®ï¼Œå¯ä»¥å‚è€ƒæ–‡æ¡£ä¸­çš„SpringMVC ç‰¹æ€§ã€‚ è‡ªåŠ¨é…ç½®ä»£ç å‚è€ƒæ‹¿ ContentNegotiatingViewResolverè¿™ä¸ªbeanæ¥è¯´ï¼ŒSpringMVCçš„è‡ªåŠ¨é…ç½®ç±»æ˜¯å¦‚ä½•å¯¹æ‹“å±•çš„æ”¯æŒã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445@Bean@ConditionalOnBean(ViewResolver.class)// å¦‚æžœç±»è·¯å¾„ä¸­ä¸å­˜åœ¨ContentNegotiatingViewResolverè¿™ä¸ªç±»çš„æ—¶å€™@ConditionalOnMissingBean(name = "viewResolver", value = ContentNegotiatingViewResolver.class)public ContentNegotiatingViewResolver viewResolver(BeanFactory beanFactory) &#123;// è¿”å›žè¿™ä¸ªResolver ContentNegotiatingViewResolver resolver = new ContentNegotiatingViewResolver(); resolver.setContentNegotiationManager(beanFactory.getBean(ContentNegotiationManager.class)); // ContentNegotiatingViewResolver uses all the other view resolvers to locate // a view so it should have a high precedence resolver.setOrder(Ordered.HIGHEST_PRECEDENCE); return resolver;&#125;// ContentNegotiatingViewResolver ç±»ä¸­çš„åˆå§‹åŒ–servletå®¹å™¨æ–¹æ³•protected void initServletContext(ServletContext servletContext) &#123;// æ‰¾å‡ºæ‰€æœ‰çš„å®¹å™¨ä¸­çš„ViewResolver Collection&lt;ViewResolver&gt; matchingBeans = BeanFactoryUtils.beansOfTypeIncludingAncestors(obtainApplicationContext(), ViewResolver.class).values(); if (this.viewResolvers == null) &#123; this.viewResolvers = new ArrayList&lt;&gt;(matchingBeans.size()); // å¾ªçŽ¯æ·»åŠ åˆ°viewResolverä¸­ for (ViewResolver viewResolver : matchingBeans) &#123; if (this != viewResolver) &#123; this.viewResolvers.add(viewResolver); &#125; &#125; &#125;@Override@Nullable//å®žçŽ°ViewResolverçš„å®žçŽ°æ–¹æ³•public View resolveViewName(String viewName, Locale locale) throws Exception &#123; RequestAttributes attrs = RequestContextHolder.getRequestAttributes(); Assert.state(attrs instanceof ServletRequestAttributes, "No current ServletRequestAttributes"); List&lt;MediaType&gt; requestedMediaTypes = getMediaTypes(((ServletRequestAttributes) attrs).getRequest()); if (requestedMediaTypes != null) &#123; // èŽ·å–å€™é€‰çš„view // åœ¨getCandidateViewsè¿™ä¸ªæ–¹æ³•é‡Œå°±æ˜¯æŠŠå…¨å±€çš„viewResolverå¾ªçŽ¯ä¸€é List&lt;View&gt; candidateViews = getCandidateViews(viewName, locale, requestedMediaTypes); // å¯»æ‰¾æœ€å¥½çš„/æœ€åˆé€‚çš„view View bestView = getBestView(candidateViews, requestedMediaTypes, attrs); if (bestView != null) &#123; return bestView; &#125; é€šè¿‡ä¸Šè¿°ä»£ç çš„æè¿°ï¼Œå¯ä»¥å‘çŽ°å¦‚æžœè‡ªå·±å®žçŽ°ViewResolverï¼Œåªéœ€è¦å®žçŽ°ViewResolveråŽåŠ å…¥åˆ°å®¹å™¨ä¸­å³å¯ã€‚SpringBootä¼šè‡ªåŠ¨èŽ·å–å®¹å™¨ä¸­çš„ViewResoverã€‚ å®šåˆ¶å¼€å‘å¦‚æžœæƒ³ä¿ç•™ SpringBoot çš„MVCç‰¹æ€§ï¼Œå¹¶ä¸”æƒ³åŽ»æ·»åŠ MVCé…ç½®å¦‚æ‹¦æˆªå™¨ï¼Œè§†å›¾æŽ§åˆ¶å™¨ç­‰ï¼Œä½ å¯ä»¥æ·»åŠ è‡ªå·±çš„é…ç½®ç±»ï¼Œå¹¶ä¸”ç»§æ‰¿WebMvcConfigurer,ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½ä½¿ç”¨ @EnableWebMvc æ³¨è§£ã€‚å¦‚æžœä½¿ç”¨ @EnableWebMvc æ³¨è§£ï¼Œåˆ™è¡¨ç¤ºè¦ä½ å…¨é¢æŽ¥ç®¡SpringMvcé…ç½®åŠŸèƒ½ï¼Œä¸ä½¿ç”¨SpringBootè‡ªåŠ¨é…ç½®çš„åŠŸèƒ½ã€‚ ä½¿ç”¨beançš„æ–¹å¼ï¼Œè®© InnerViewResolver è‡ªåŠ¨å‘çŽ°å®¹å™¨ä¸­çš„ViewResolver 12345678910111213141516@Configuration//@EnableWebMvc // ä½¿ç”¨è¿™ä¸ªæ³¨è§£è¡¨ç¤ºå®Œå…¨ä¸å®žç”¨SpringBootå¯¹SpringMVCçš„è‡ªåŠ¨é…ç½®åŠŸèƒ½ã€‚public class MvcConfig implements WebMvcConfigurer &#123; @Bean public MyViewResolver myViewResolver()&#123; return new MyViewResolver(); &#125; class InnerViewResolver implements ViewResolver &#123; @Override public View resolveViewName(String viewName, Locale locale) throws Exception &#123; return null; &#125; &#125; è¿™æ ·å°†ä¸€ä¸ªViewResolveræ”¾åˆ°å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆå‰é¢è¯´åˆ°çš„ InnerViewResolver ä¼šè‡ªåŠ¨çš„å‘çŽ°è¿™ä¸ªbeanæ¥ä½¿ç”¨ã€‚ ä½¿ç”¨ WebMvcConfigurer å®žçŽ° 123456789101112131415161718192021222324@Configuration//@EnableWebMvcpublic class MvcConfig implements WebMvcConfigurer &#123; @Override public void configureViewResolvers(ViewResolverRegistry registry) &#123; registry.viewResolver(new InnerViewResolver()); &#125; @Override public void addViewControllers(ViewControllerRegistry registry) &#123; registry.addRedirectViewController("/index","/home"); &#125;// ViewResolverRegistry ç±»ä¸­çš„viewResolveræ–¹æ³•ï¼Œç›´æŽ¥æ·»åŠ åˆ°å…¨å±€å˜é‡ viewResolversä¸­ï¼Œä»£æ›¿å‰é¢çš„éåŽ†public void viewResolver(ViewResolver viewResolver) &#123; if (viewResolver instanceof ContentNegotiatingViewResolver) &#123; throw new BeanInitializationException( "addViewResolver cannot be used to configure a ContentNegotiatingViewResolver. " + "Please use the method enableContentNegotiation instead."); &#125; this.viewResolvers.add(viewResolver);&#125; ç»§æ‰¿WebMvcConfigurerä½¿ç”¨ç»§æ‰¿æ–¹æ³•ï¼Œå°†ç±»æ”¾åˆ°å®¹å™¨ä¸­ã€‚ å›½é™…åŒ–å¼€å‘ä¸‹é¢ä»Žè‡ªåŠ¨é…ç½®å…¥æ‰‹ï¼Œæ¥çœ‹SpringBootæ˜¯æ€Žä¹ˆé…ç½®å›½é™…åŒ–çš„ã€‚ è®©SpringBooté…ç½®æŒ‡å®šå›½é™…åŒ–æ–‡ä»¶1234567891011121314151617public class MessageSourceAutoConfiguration &#123; private static final Resource[] NO_RESOURCES = &#123;&#125;;// åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è¿›è¡Œé…ç½®çš„å†…å®¹ ä»¥spring.messageå¼€å¤´ @Bean @ConfigurationProperties(prefix = "spring.messages") public MessageSourceProperties messageSourceProperties() &#123; return new MessageSourceProperties(); &#125;/***********************MessageSourceProperties**********************/public class MessageSourceProperties &#123; /** * ä»¥é€—å·åˆ†éš”çš„åŸºæœ¬åç§°åˆ—è¡¨ æ¯ä¸€ä¸ªéƒ½æ˜¯åœ¨å®Œæ•´çš„è·¯å¾„ä¸‹åŠ è½½ï¼Œæ¯”å¦‚ i18n.home,i18n.helloè¿™æ · * å¦‚æžœåœ¨ç±»è·¯å¾„ä¸Šï¼Œå°±åŽ»æŽ‰i18n. */ private String basename = "messages"; å¦‚æžœå¯¹basenameçš„å€¼çš„è®¾ç½®ä»æœ‰ç–‘æƒ‘ï¼Œé‚£æ¥ç›´æŽ¥çœ‹è§£æžbasenameçš„ä»£ç ã€‚ 1234567891011121314151617181920212223242526272829public ConditionOutcome getMatchOutcome(ConditionContext context, AnnotatedTypeMetadata metadata) &#123; // èŽ·å¾—propertiesfä¸­çš„spring.messages.basenameå±žæ€§ï¼Œå¦‚æžœæ²¡æœ‰é»˜è®¤æ˜¯messages String basename = context.getEnvironment().getProperty("spring.messages.basename", "messages"); ConditionOutcome outcome = cache.get(basename); if (outcome == null) &#123; // è°ƒç”¨æ–¹æ³•è§£æžbasename outcome = getMatchOutcomeForBasename(context, basename); cache.put(basename, outcome); &#125; return outcome;&#125;private ConditionOutcome getMatchOutcomeForBasename(ConditionContext context, String basename) &#123; ConditionMessage.Builder message = ConditionMessage.forCondition("ResourceBundle"); for (String name : StringUtils.commaDelimitedListToStringArray(StringUtils.trimAllWhitespace(basename))) &#123; // å°†basenameä»¥é€—å·åˆ†éš”ï¼Œå¾ªçŽ¯è¿™ä¸ªæ•°ç»„ for (Resource resource : getResources(context.getClassLoader(), name)) &#123; // è¿™é‡Œçš„getResourceæ–¹æ³• æ˜¯åŠ è½½classpath + name + .propertiesä¸­çš„å†…å®¹ // æ‰€ä»¥å›½é™…åŒ–æ–‡ä»¶åªæ”¯æŒ propertiesæ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶ä¸æ”¯æŒ // return new PathMatchingResourcePatternResolver(classLoader) // .getResources("classpath*:" + target + ".properties"); if (resource.exists()) &#123; // å¯¹æ¯ä¸€ä¸ªèŽ·å–Resource æ–°å»ºä¸€ä¸ªmatchå®žä¾‹å¯¹è±¡ return ConditionOutcome.match(message.found("bundle").items(resource)); &#125; &#125; &#125; return ConditionOutcome.noMatch(message.didNotFind("bundle with basename " + basename).atAll());&#125; å›½é™…åŒ–æ­¥éª¤ä¸Šé¢é€šè¿‡å¯¹SpringBootå¯¹å›½é™…åŒ–çš„é…ç½®çš„åˆ†æžï¼ŒçŸ¥é“äº†åœ¨propertiesæ–‡ä»¶ä¸­æ€Žä¹ˆæ›´æ”¹å›½é™…åŒ–æ–‡ä»¶çš„é…ç½®ä¿¡æ¯ã€‚ä¸‹é¢æ¥å…·ä½“æ“ä½œï¼Œè¿›è¡Œå›½é™…åŒ–ã€‚ é»˜è®¤çš„å›½é™…åŒ–åˆ›å»ºå›½é™…åŒ–çš„propertiesåœ¨resourcesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹i18n ,åœ¨æ–‡ä»¶å¤¹ä¸‹å³é”®åˆ›å»ºResource Bundle æ–‡ä»¶ã€‚ å·¦è¾¹project localeä¸­æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼Œdefaultå’Œè‡ªå·±æ·»åŠ çš„zh_CNå’Œen_USåˆ†åˆ«è¡¨ç¤ºä¸­æ–‡å’Œè‹±æ–‡ã€‚ç‚¹å‡»add AllåŽç¡®è®¤ï¼Œåˆ›å»ºæ–‡ä»¶ã€‚å¦‚ä¸‹å›¾ï¼š åŒå‡»å…¶ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¯”å¦‚index.propertiesï¼Œä½¿ç”¨ideaå¯ä»¥å‘çŽ°ç¼–è¾‘åŒºçš„å·¦ä¸‹è§’æœ‰ä¸€ä¸ªResource Bundle tabé¡µï¼Œç‚¹å‡»ä¹‹åŽï¼Œæ¥åˆ°å¦‚ä¸‹å›¾çš„ç•Œé¢ï¼Œæ–°å»ºä¸€ä¸ªé€‰é¡¹ï¼Œè¾“å…¥å„é…ç½®æ–‡ä»¶ä¸­çš„å€¼ã€‚ åˆ›å»ºcontrollerå’Œhtmlé¡µé¢ åˆ›å»ºcontroller 1234@RequestMapping("/index")public String index()&#123; return "index";&#125; åˆ›å»ºhtmlé¡µé¢ 12345678910&lt;html lang="en" xmlns:th="http://www.thymeleaf.org"&gt;&lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;-- ä½¿ç”¨th:textä¼šæ›¿æ¢æ ‡ç­¾å†…çš„æ–‡æœ¬å†…å®¹ ä½¿ç”¨#&#123;&#125;æ¥è¡¨ç¤ºå›½é™…åŒ–å†…å®¹--&gt;&lt;h1 th:text="#&#123;index&#125;"&gt;è¿™é‡Œæ˜¯ä¸»é¡µ&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt; é‡å¯ç¨‹åºï¼Œå‘çŽ°indexé¡µé¢ä¸Šæ˜¾ç¤ºçš„æ˜¯ä¸»é¡µï¼Œè¿™ä¸ªå†…å®¹ï¼Œæ­£å¥½æ˜¯åœ¨index_zh_CN.propertiesä¸­å®šä¹‰çš„indexçš„å€¼ã€‚SpringBootä¼šæ ¹æ®è¯·æ±‚å¤´ä¸­çš„è¯­è¨€æ¥åˆ¤æ–­ä½¿ç”¨å“ªä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚ å¦‚ä½•åˆ‡æ¢é¡µé¢çš„ä¸­è‹±æ–‡ï¼Ÿåœ¨dispatcherServletä¸­åœ¨æ¸²æŸ“è§†å›¾çš„æ—¶å€™ï¼Œä¼šé€šè¿‡localeçš„å±žæ€§æ¥æ”¹å˜æ¸²æŸ“åŽçš„è¯­è¨€ã€‚ 12345protected void render(ModelAndView mv, HttpServletRequest request, HttpServletResponse response) throws Exception &#123; // å¯ä»¥é€šè¿‡è¯·æ±‚çš„localeæ¥å®šä¹‰è¿”å›žçš„locale Locale locale = (this.localeResolver != null ? this.localeResolver.resolveLocale(request) : request.getLocale()); response.setLocale(locale); é€šè¿‡debugå‘çŽ°this.localeResolverä¸­æ˜¯æœ‰å€¼çš„ï¼Œè¯´æ˜ŽSpringå®¹å™¨ä¸­æœ‰localeResolver,è¿›è€Œå¯ä»¥å¾—å‡ºç»“è®ºï¼šSpringBootä¸­è‡ªåŠ¨é…ç½®æ¥é»˜è®¤çš„localeResoverã€‚ åœ¨WebMvcAutoConfigurationä¸­çš„ç¡®é…ç½®äº†å…³äºŽlocaleçš„ä¿¡æ¯ã€‚ 123456789101112@Bean@ConditionalOnMissingBean@ConditionalOnProperty(prefix = "spring.mvc", name = "locale")public LocaleResolver localeResolver() &#123; if (this.mvcProperties.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123; return new FixedLocaleResolver(this.mvcProperties.getLocale()); &#125; // è®¾ç½®äº† å®¹å™¨ä¸­çš„localeResolver ä¸º AcceptHeaderLocaleResolver AcceptHeaderLocaleResolver localeResolver = new AcceptHeaderLocaleResolver(); localeResolver.setDefaultLocale(this.mvcProperties.getLocale()); return localeResolver;&#125; å› ä¸ºé…ç½®äº†é»˜è®¤çš„localeResolver ,æ‰€ä»¥åœ¨ä½¿ç”¨this.localeResolver.resolveLocale(request)å¤„ç†è¿™ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œå°±ä¼šä½¿ç”¨AcceptHeaderLocaleResolverç±»ä¸­çš„æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ­£æ˜¯æ‹¿çš„requestä¸­çš„Accept-Language 123456789101112@Override public Locale resolveLocale(HttpServletRequest request) &#123; Locale defaultLocale = getDefaultLocale(); if (defaultLocale != null &amp;&amp; request.getHeader("Accept-Language") == null) &#123; return defaultLocale; &#125; // ä»Žrequestä¸­æ‹¿Accept-Languageè¿™ä¸ªå€¼ã€‚ Locale requestLocale = request.getLocale(); List&lt;Locale&gt; supportedLocales = getSupportedLocales(); if (supportedLocales.isEmpty() || supportedLocales.contains(requestLocale)) &#123; return requestLocale; &#125; è¿™æ ·çš„è¯ç–‘æƒ‘å°±è§£å¼€äº†ï¼Œé»˜è®¤çš„SpringBootæž„ä»¶webåº”ç”¨ä¼šä½¿ç”¨å½“å‰æµè§ˆå™¨çš„åœ°åŒºè¯­è¨€æ¥è¿›è¡Œå›½é™…åŒ–ã€‚ æ”¹å˜å›½é™…åŒ–è¯­è¨€æ ‡å‡†çš„åˆ¤æ–­æ–¹å¼ä¸Šé¢è¯´äº†é»˜è®¤çš„SpringBootä¼šä»Žrequestä¸­èŽ·å–åœ°åŒºè¯­è¨€ä¿¡æ¯ï¼Œæ¥åˆ¤æ–­åŠ è½½å“ªä¸ªé…ç½®ã€‚ åœ¨è‡ªåŠ¨é…ç½®çš„æ–¹æ³•ä¸Šæ ‡æ³¨ç€è¿™æ ·ä¸€æ®µ@ConditionalOnMissingBean,è¯´æ˜Žå¦‚æžœæœ‰localeResolverè¿™ä¸ªç±»é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚æ‰€ä»¥æ”¹å˜çš„æ–¹æ³•å°±æ˜¯è‡ªå·±å®žçŽ°localeResolver. 12345678910111213141516171819202122232425262728293031323334353637383940414243public class MyLocalResolver implements LocaleResolver &#123; private Locale defaultLocale; @Override public Locale resolveLocale(HttpServletRequest request) &#123; Locale defaultLocale = getDefaultLocale(); String language = request.getParameter("language"); // èŽ·å–è¯·æ±‚ä¸­çš„ ?language=ã€Œxxxã€ String[] s = new String[2]; if(language != null &amp;&amp; !"".equals(language))&#123; s = getS(language); &#125;else&#123; //å¦‚æžœæ˜¯ç©ºåˆ™æ‰¾æµè§ˆå™¨ä¸­çš„å±žæ€§ String header = getFirstLangInRequest(request); if(header!=null &amp;&amp; !"".equals(header))&#123; s = getS(header); &#125;else&#123; //å¦åˆ™ç»™ä¸ªé»˜è®¤çš„local s = getS("zh-CN"); &#125; &#125; defaultLocale = new Locale(s[0],s[1]); return defaultLocale; &#125; private String getFirstLangInRequest(HttpServletRequest request) &#123; return request.getHeader("Accept-Language").split(",")[0]; &#125; private String[] getS(String language) &#123; return language.split("-"); &#125; public Locale getDefaultLocale() &#123; return this.defaultLocale; &#125;&#125;//æ·»åŠ åˆ°beanä¸­ æ–¹æ³•åç§°å¿…é¡»æ˜¯localeResolver æˆ–è€…æŒ‡å®šbeançš„åç§°ä¸ºlocaleResolver@Beanpublic LocaleResolver localeResolver()&#123; return new MyLocalResolver();&#125; ç¨å¾®ä¿®æ”¹ä¸€ä¸‹index.htmlä¸­çš„å†…å®¹ 123456&lt;body&gt;&lt;h1 th:text="#&#123;index&#125;"&gt;è¿™é‡Œæ˜¯ä¸»é¡µ&lt;/h1&gt; &lt;-- ç‚¹å‡»æŒ‰é’®æ—¶å˜æ¢ä¸­è‹±æ–‡ --&gt;&lt;a th:href="@&#123;/index(language='zh-CN')&#125;"&gt;&lt;button th:text="#&#123;but1&#125;" &gt;è¿™æ˜¯åˆ‡æ¢ä¸­æ–‡çš„æŒ‰é’®&lt;/button&gt;&lt;/a&gt;&lt;a th:href="@&#123;/index(language='en-US')&#125;"&gt;&lt;button th:text="#&#123;but2&#125;" &gt;è¿™æ˜¯åˆ‡æ¢è‹±æ–‡çš„æŒ‰é’®&lt;/button&gt; &lt;/a&gt;&lt;/body&gt; é‡å¯ç¨‹åºï¼Œè¿›è¡Œæµ‹è¯•ï¼š æ€»ç»“å¦‚ä½•åœ¨SpringBootä¸­ä½¿ç”¨å›½é™…åŒ– ç¼–å†™å›½é™…åŒ–ç›¸å…³çš„ ResourceBundleæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”çš„è¯­è¨€é…ç½®æ–‡ä»¶å¦‚ï¼šindex_en_US.properties,index_zh_CN.propertiesï¼Œæ³¨æ„è¿™ä¸ªæ–‡ä»¶æ ¼å¼æ˜¯å›ºå®šçš„xxx_è¯­è¨€ä»£ç _å¤§å†™çš„å›½å®¶ä»£ç ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯propertiesæ–‡ä»¶ã€‚ ç¼–å†™htmlæŽ¥æ”¶å›½é™…åŒ–å˜é‡ï¼Œä½¿ç”¨Thymeleafå¼•æ“Žå¯ä»¥ä½¿ç”¨è¯­æ³•#{}æ¥ä½¿ç”¨å›½é™…åŒ–å˜é‡ã€‚ å¦‚ä½•æ”¹é€ å› ä¸ºSpringBooté»˜è®¤å®žçŽ°äº†LocaleResolver,å¹¶ä¸”æ ‡æ³¨äº†ConditionalOnMissingBeanæ³¨è§£ï¼Œæ‰€ä»¥ï¼Œåªéœ€è¦è‡ªå·±å®žçŽ°LocaleResolverç±»ï¼Œé‡å†™ç›¸å…³æ–¹æ³•ï¼Œå°±å¯ä»¥è¾¾åˆ°æ”¹é€ çš„ç›®çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ³¨å†Œbeançš„æ—¶å€™ï¼Œæ–¹æ³•åå¿…é¡»localeResolver,æˆ–è€…æŒ‡å®šbeançš„åç§°ä¸ºlocaleResolverã€‚]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootçš„WEBå¼€å‘ä¹‹Hello-World]]></title>
    <url>%2F2019%2F07%2F13%2F2019-07-13-SpringBoot%E7%9A%84WEB%E5%BC%80%E5%8F%91%2F</url>
    <content type="text"><![CDATA[åˆ›å»ºåŸºæœ¬çš„webåº”ç”¨SpringBootå¯ä»¥å¿«é€Ÿçš„åˆ›å»ºä¸€ä¸ªrestfulçš„webåº”ç”¨ã€‚ä¸‹é¢å¼€å§‹ä»Žé›¶å¼€å§‹åˆ›å»ºä¸€å¥—åŸºæœ¬çš„webåº”ç”¨ã€‚ ä½¿ç”¨ideaåˆ›å»ºSpring initializræˆ‘è¿™é‡Œç›´æŽ¥ä½¿ç”¨ideaä¸­çš„Spring initializr æ¥åˆ›å»ºSpringBootåº”ç”¨ã€‚åŒç†å¯ä»¥ä½¿ç”¨start.spring.ioä¸­ã€‚åˆ›å»ºå®ŒæˆåŽç›´æŽ¥åœ¨IDEä¸­å¯¼å…¥å³å¯ã€‚ éœ€è¦åœ¨ideaä¸­æ–°å»ºé¡¹ç›® å¡«å†™é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ å‹¾é€‰éœ€è¦çš„ä¾èµ– æœ€åŽç‚¹å‡»finishå®Œæˆåˆ›å»ºã€‚ æ–‡æ¡£ç»“æž„è¯´æ˜Ž æ–°å»ºSpringBootåº”ç”¨åŽè‡ªåŠ¨åˆ›å»ºçš„ç›®å½•ç»“æž„å¦‚å¦‚ä¸Šå›¾ï¼Œå…¶ä¸­SpringBootå¯åŠ¨ç±»StartSpringBootApplicationæ”¾åœ¨java/com/example/startæ–‡ä»¶å¤¹ä¸­ï¼Œç”¨äºŽå¯åŠ¨æ•´ä¸ªé¡¹ç›®ã€‚ å¯¹äºŽèµ„æºæ–‡ä»¶ï¼ŒSpringBootç»™å‡ºæ¥ä¸€å¥—ç›®å½•æ ‡å‡†ã€‚ resourceæ–‡ä»¶å¤¹ä¸­çš„application.properteisä¸ºæ•´ä½“çš„SpringBooté…ç½®æ–‡ä»¶ã€‚å…¶ä¸­æœ‰staticå’Œtemplatesç›®å½•ã€‚ static æ–‡ä»¶å¤¹ç”¨äºŽå­˜æ”¾é™æ€èµ„æºï¼Œå¦‚jsï¼Œcss templates æ–‡ä»¶å¤¹ç”¨äºŽå­˜æ”¾æ¨¡ç‰ˆæ–‡ä»¶ï¼Œå¦‚jsp,html é‚£ä¹ˆSpringBootæ˜¯å¦‚ä½•å»ºç«‹è¿™äº›ç›®å½•æ–‡ä»¶æ ‡å‡†çš„å‘¢ï¼Ÿ webç›®å½•ç›¸å…³çš„è‡ªåŠ¨é…ç½®webç›®å½•ç›¸å…³çš„è‡ªåŠ¨é…ç½®æ˜¯åœ¨WebMvcAutoConfigurationè‡ªåŠ¨é…ç½®ç±»ä¸­è¿›è¡Œé…ç½®ã€‚è€Œå¯¹èµ„æºçš„åŠ è½½ä½¿ç”¨çš„æ˜¯addResourceHandler æ–¹æ³• 1234567891011121314151617181920212223242526272829@Overridepublic void addResourceHandlers(ResourceHandlerRegistry registry) &#123; // æ˜¯å¦å¯ç”¨é»˜è®¤èµ„æºå¤„ç† if (!this.resourceProperties.isAddMappings()) &#123; logger.debug("Default resource handling disabled"); return; &#125; // èŽ·å–èµ„æºå¤„ç†ç¨‹åºæ‰€æœåŠ¡èµ„æºçš„ç¼“å­˜å‘¨æœŸ Duration cachePeriod = this.resourceProperties.getCache().getPeriod(); CacheControl cacheControl = this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl(); // å¦‚æžœæ˜ å°„å™¨è¿˜æœªæ˜ å°„åˆ°/webjars/** åˆ™è¿›è¡Œå¦‚ä¸‹æ“ä½œ if (!registry.hasMappingForPattern("/webjars/**")) &#123; // æ·»åŠ å¯¹/webjars/** çš„èµ„æºæ˜ å°„ customizeResourceHandlerRegistration(registry.addResourceHandler("/webjars/**") .addResourceLocations("classpath:/META-INF/resources/webjars/") // åŠ è½½åŒ…ä¸‹çš„ /META-INF/resources/webjars/ ä¸‹çš„å†…å®¹ .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl)); &#125; // é™æ€è·¯å¾„pattern ä¸º "/**" String staticPathPattern = this.mvcProperties.getStaticPathPattern(); if (!registry.hasMappingForPattern(staticPathPattern)) &#123; //å¦‚æžœæ˜ å°„å™¨è¿˜æ²¡æœ‰æ˜ å°„ /** è·¯å¾„çš„èµ„æºæ—¶ customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern) // åŠ è½½æ‰€æœ‰çš„é»˜è®¤å®šä¹‰çš„ä½ç½®é‡Œçš„èµ„æºã€‚ .addResourceLocations(getResourceLocations(this.resourceProperties.getStaticLocations())) .setCachePeriod(getSeconds(cache Period)).setCacheControl(cacheControl)); &#125;&#125; webjarsWebJarsæ˜¯æ‰“åŒ…åˆ°JARï¼ˆJava Archiveï¼‰æ–‡ä»¶ä¸­çš„å®¢æˆ·ç«¯Webåº“ï¼ˆä¾‹å¦‚jQueryå’ŒBootstrapï¼‰ã€‚ from webjarså®˜ç½‘ æ ¹æ®ä»¥ä¸Šå†…å®¹ä¸¾ä¸ªä¾‹å­æ¥è®²è§£å¦‚ä½•ä½¿ç”¨webjarsè¿›è¡Œé™æ€èµ„æºçš„åŠ è½½ï¼š åŽ»å®˜ç½‘æ‰¾ç›¸å…³èµ„æºçš„ä¾èµ– æ·»åŠ åˆ°pom.xmlæ–‡ä»¶ä¸­ ä»¥ç²‰è‰²çš„ç«–çº¿ä¸ºåˆ†å‰²çº¿ï¼Œå·¦ä¾§ä¸ºä¸‹è½½å®Œçš„webjarsçš„jaråŒ…ï¼Œå³ä¾§ä¸ºåœ¨pom.xmlæ–‡ä»¶ä¸­çš„ä¾èµ–ä¿¡æ¯ã€‚ åŠ è½½webjarså¦‚æžœSpringBootå‘çŽ°æœ‰webjarçš„åº”ç”¨jaråŒ…ï¼Œåˆ™åŠ è½½è·¯å¾„classpath:/META-INF/resources/webjars/ä¸‹çš„æ–‡ä»¶ã€‚åœ¨å›¾ä¸­ä¾‹å­ä¸­å°±æ˜¯jqueryæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å†…å®¹ã€‚è¿™æ ·SpringBootå°±èƒ½å¤Ÿè¯†åˆ«jqueryåŒ…ä¸‹çš„æ‰€æœ‰é™æ€æ–‡ä»¶äº†ã€‚ æ˜ å°„webjarsSpringBootä¼šå°†æ‰€æœ‰å·²å°†åŠ è½½jarsæ˜ å°„åˆ° /webjars/** è¿™ä¸ªè·¯å¾„ä¸Šã€‚ æ¯”å¦‚ä¸Šé¢æˆ‘ä»¬æ·»åŠ äº†jquery.min.jsã€‚æˆ‘ä»¬å¯åŠ¨ç¨‹åºï¼Œå¯ä»¥åœ¨http://localhost:8080/webjars/jquery/3.4.1/jquery.min.jsè¿™ä¸ªåœ°å€ä¸Šè®¿é—®ï¼Œå‘çŽ°ç³»ç»Ÿå·²ç»é€šè¿‡webjarså°†èµ„æºåŠ è½½åˆ°äº†ã€‚åœ¨å®žé™…çš„ä½¿ç”¨ä¸­ï¼Œä½¿ç”¨scriptæ ‡ç­¾å¼•ç”¨webjarsä¹Ÿæ˜¯å¼•ç”¨è¿™ä¸ªåœ°å€çš„é™æ€æ–‡ä»¶ã€‚ é¡¹ç›®å†…é™æ€èµ„æºä½¿ç”¨webjarsç”¨æ¥åŠ è½½é™æ€èµ„æºéžå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯å¦‚æžœè‡ªå·±å†™çš„jså’Œcssç­‰é™æ€èµ„æºä¹Ÿéœ€è¦åŠ è½½æ—¶ï¼Œå°±éœ€è¦æ”¾åˆ°SpringBooté»˜è®¤åŠ è½½çš„ç›®å½•ä¸‹ã€‚ 123456789101112@ConfigurationProperties(prefix = "spring.resources", ignoreUnknownFields = false)public class ResourceProperties &#123; private static final String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; "classpath:/META-INF/resources/", "classpath:/resources/", "classpath:/static/", "classpath:/public/" &#125;; private String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS; private boolean addMappings = true; private final Chain chain = new Chain(); private final Cache cache = new Cache(); // èŽ·å–é™æ€èµ„æºç›®å½• public String[] getStaticLocations() &#123; return this.staticLocations; &#125; é€šè¿‡getStaticLocationsèŽ·å–é™æ€èµ„æºçš„ç›®å½•ï¼Œé»˜è®¤çš„SpringBootå®šä¹‰äº†classpathä¸‹çš„ä»¥ä¸‹çš„æ–‡ä»¶ï¼Œéƒ½å¯ä»¥æ”¾ç½®é™æ€æ–‡ä»¶ï¼Œéƒ½å¯ä»¥é€šè¿‡urlçš„æ–¹å¼è®¿é—®åˆ°è¿™ä¸ªé™æ€æ–‡ä»¶ã€‚ classpath:/META-INF/resources classpath:/resources/ classpath:/static/ classpath:/public/ éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªclasspathå°±æ˜¯ä¸€å¼€å§‹åˆ›å»ºSpringBootåº”ç”¨å¸®æˆ‘ä»¬åˆ›å»ºå¥½çš„resourceè·¯å¾„ è¿™ä¸ªç±»ä¹Ÿæ˜¯ä¸€ä¸ªxxxxPropertiesç±»ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ”¹å˜ç›¸åº”çš„é…ç½®æ–‡ä»¶ä¸­çš„å±žæ€§æ¥æ”¹å˜è¿™ä¸ªè·¯å¾„ã€‚è¿™é‡Œçš„è·¯å¾„ä½¿ç”¨çš„å˜é‡æ˜¯staticLocations,æ‰€ä»¥ç›¸åº”çš„åœ¨application.propertiesæ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨spring.resources.staticLocations=è·¯å¾„åç§°å°±è¡Œäº†ã€‚ ä¸»é¡µçš„è®¾ç½®SpringBooté»˜è®¤çš„ä½¿ç”¨é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹çš„index.htmlä½œä¸ºé¦–é¡µã€‚ 123456789private Optional&lt;Resource&gt; getWelcomePage() &#123; String[] locations = getResourceLocations(this.resourceProperties.getStaticLocations()); //éåŽ†æ¯ä¸ªlocationså¯»æ‰¾index.htmlé¡µé¢ä½œä¸ºé¦–é¡µ return Arrays.stream(locations).map(this::getIndexHtml).filter(this::isReadable).findFirst();&#125;private Resource getIndexHtml(String location) &#123; return this.resourceLoader.getResource(location + "index.html");&#125; å¦‚æžœæ‰¾åˆ°ä¸»é¡µçš„index.htmlåŽï¼Œå°±å¼€å§‹åšä¸»é¡µçš„æ˜ å°„æ“ä½œ 12345678910111213@Beanpublic WelcomePageHandlerMapping welcomePageHandlerMapping(ApplicationContext applicationContext) &#123; return new WelcomePageHandlerMapping(new TemplateAvailabilityProviders(applicationContext), applicationContext, getWelcomePage(), this.mvcProperties.getStaticPathPattern());&#125;WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders, ApplicationContext applicationContext, Optional&lt;Resource&gt; welcomePage, String staticPathPattern) &#123; // å¦‚æžœå­˜åœ¨ï¼Œè®¾ç½®é¦–é¡µä¸ºindex.html æ˜ å°„è·¯å¾„ä¸ºï¼š /** if (welcomePage.isPresent() &amp;&amp; "/**".equals(staticPathPattern)) &#123; logger.info("Adding welcome page: " + welcomePage.get()); setRootViewName("forward:index.html"); &#125; ä¸Šé¢æ˜¯ä¾æ®SpringBootåŠ è½½é™æ€èµ„æºçš„æ–¹å¼åšçš„ç®€å•æ€»ç»“ã€‚ æ·»åŠ controlleråœ¨ä¸Šä¸€æ­¥åˆ›å»ºå®Œé¡¹ç›®åŽï¼Œå¯ä»¥ç´§è·Ÿç€å†™ä¸€ä¸ªSpringMVCæµ‹è¯•çš„controllerï¼Œçœ‹çœ‹èƒ½å¦å¯åŠ¨é¡¹ç›®ã€‚ 12345678910// èµ·åˆ°äº†@Controllerå’Œ@Responsebodyä¸¤ç§ä½œç”¨ï¼Œå®žé™…ä¸Šå°±æ˜¯// ä¸¤ç§æ³¨è§£çš„æ•´åˆ@RestControllerpublic class HelloController &#123; @RequestMapping("/hello") public String hello()&#123; return "hello world"; &#125;&#125; å¦‚æžœä½ ä¹Ÿåƒæˆ‘å‹¾é€‰æ¥æ•°æ®åº“ç›¸å…³çš„starters,åœ¨å¯åŠ¨æ—¶ï¼ŒæŽ§åˆ¶å°ä¼šæç¤ºéœ€è¦é…ç½®æ•°æ®åº“çš„åŸºæœ¬é…ç½®ã€‚ é‚£ä¹ˆæ€Žä¹ˆæ‰¾è¿™äº›é…ç½®å‘¢ï¼Ÿ åŽ»å®˜ç½‘æ‰¾é…ç½® ç›´æŽ¥çœ‹ä»£ç  å¦‚æžœä½ æ²¡æœ‰ç¢°åˆ°ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆè¯·å¿½ç•¥ä»¥ä¸‹éƒ¨åˆ†ã€‚ å› ä¸ºå‰å‡ ç¯‡æ–‡ç« ä¸­å·²ç»åˆ†æžæ¥SpringBootæ˜¯å¦‚ä½•å®Œæˆè‡ªåŠ¨é…ç½®çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘æƒ³é€šè¿‡æ‰¾ä»£ç çš„æ–¹å¼ç›´æŽ¥çœ‹å®ƒèƒ½å¤Ÿé…ç½®å“ªäº›å±žæ€§ã€‚ é¦–å…ˆåœ¨autoconfigurationåŒ…ä¸‹é¢çš„spring.factoryä¸­æœç´¢jdbc ç‚¹å‡»å…³äºŽDataSourceçš„è‡ªåŠ¨é…ç½®ç±» 12345678910111213141516171819@EnableConfigurationProperties(DataSourceProperties.class)@Import(&#123; DataSourcePoolMetadataProvidersConfiguration.class, DataSourceInitializationConfiguration.class &#125;)public class DataSourceAutoConfiguration &#123;// ä½¿ç”¨DataSourcePropertiesç±»ä½œä¸ºå±žæ€§ç±»,ä»¥ä¸‹ä¸ºåŸºæœ¬å±žæ€§@ConfigurationProperties(prefix = "spring.datasource")public class DataSourceProperties implements BeanClassLoaderAware, InitializingBean &#123; private ClassLoader classLoader; private String name; private boolean generateUniqueName; private Class&lt;? extends DataSource&gt; type; private String driverClassName; private String url; private String username; private String password; æ ¹æ®DataSourcePropertiesç±»ï¼Œå¯ä»¥çŸ¥é“å¦‚æžœæˆ‘ä»¬åƒé…ç½®DataSourceï¼Œé‚£ä¹ˆæœ‰è¿™å‡ ä¸ªå±žæ€§å¯ä»¥è¿›è¡Œé…ç½®ã€‚ 12345# spring.datasource ä¸ºå‰ç¼€ï¼ŒåŽé¢ä¸ºå±žæ€§åï¼Œå’ŒPropertiesç±»ä¸­çš„å±žæ€§ç›¸å¯¹åº”ã€‚spring.datasource.url=jdbc:mysql://localhost:3306/springbootspring.datasource.driverClassName=com.mysql.jdbc.Driverspring.datasource.username=rootspring.datasource.password=123456 æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySqlä½¿ç”¨å¤–é”®ï¼ˆ8.0ï¼‰]]></title>
    <url>%2F2019%2F07%2F11%2F2019-07-11-%E4%BD%BF%E7%94%A8Mysql%E7%9A%84%E5%A4%96%E9%94%AE%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨å¤–é”®çº¦æŸMysqlé»˜è®¤ä½¿ç”¨çš„æ˜¯innoDBå¼•æ“Žï¼Œè¯¥å¼•æ“Žæ˜¯æ”¯æŒå¤–é”®çš„ï¼Œä¸‹é¢æ¥è¯´è¯´å¦‚ä½•åˆ›å»ºå¤–é”®åŠå„ç§å¤–é”®ä½¿ç”¨çš„æ•ˆæžœã€‚ åŸºæœ¬æ¦‚å¿µéœ€è¦æ³¨æ„çš„æ˜¯å¤–é”®ä¸æ”¯æŒè™šæ‹Ÿæž„é€ å‡ºçš„åˆ—ä¸Šã€‚ MySqlæ”¯æŒå¤–é”®ï¼Œå…è®¸è·¨è¡¨äº¤å‰å¼•ç”¨ç›¸å…³æ•°æ®ï¼Œæœ‰åŠ©äºŽå¸®åŠ©ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚åœ¨createå’Œalterè¡¨ä¸­çš„è¯­å¥å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930-- ä¸­æ‹¬å·å†…æ˜¯éžå¿…å†™çš„[CONSTRAINT [symbol]] FOREIGN KEY [index_name] (col_name, ...) REFERENCES tbl_name (col_name,...) [ON DELETE reference_option] [ON UPDATE reference_option]reference_option: RESTRICT | CASCADE | SET NULL | NO ACTION | SET DEFAULTCREATE TABLE child ( id INT, parent_id INT, -- å®šä¹‰ç´¢å¼• INDEX par_ind (parent_id), -- parent_idå…³è”parentè¡¨ä¸­çš„idå­—æ®µ -- å¦‚æžœçˆ¶è¡¨åˆ é™¤äº†ï¼Œåˆ™å­è¡¨ä¹Ÿéœ€è¦åˆ é™¤å­—æ®µå†…å®¹ FOREIGN KEY (parent_id) REFERENCES parent(id) ON DELETE CASCADE) ENGINE=INNODB;-- æ·»åŠ å¤–é”®ALTER TABLE tb1 ADD FOREIGN KEY (parent_id) REFERENCES parent(id) ON DELETE CASCADE-- åˆ é™¤å¤–é”®ALTER TABLE tbl_name DROP FOREIGN KEY fk_symbol; index_name æŒ‡çš„æ˜¯å¤–é”®çš„æ ‡è¯†ï¼Œå¦‚æžœå­è¡¨å·²ç»æ˜¾å¼çš„å®šä¹‰äº†å¯ä»¥æ”¯æŒå¤–é”®çš„ç´¢å¼•ï¼ˆä¸Šé¢ä¾‹å­ä¸­çš„par_indï¼‰ï¼Œåˆ™å¿½ç•¥ã€‚å¦åˆ™ï¼Œmysqlä¼šä¾ç…§ä»¥ä¸‹è§„åˆ™éšå¼çš„åˆ›å»ºä¸€ä¸ªå¤–é”®ç´¢å¼•ã€‚ å¦‚æžœå®šä¹‰CONSTRAINT symbol å€¼ï¼Œåˆ™ä½¿ç”¨è¿™ä¸ªå€¼ï¼Œå¦åˆ™ä½¿ç”¨å¤–é”®å index_name. å¦‚æžœä¸Šé¢ä¸¤ä¸ªéƒ½æ²¡æœ‰å®šä¹‰ï¼Œå¤–é”®åä½¿ç”¨å¼•ç”¨å¤–é”®åˆ—çš„åç§°ã€‚ æ›´æ–°/åˆ é™¤è¡Œä¸ºMysqlå¦‚ä½•ä½¿ç”¨å¤–é”®æ¥ä¿è¯å‚ç…§çš„å®Œæ•´æ€§ã€‚ å¯¹äºŽæ”¯æŒå¤–é”®çš„innoDBå­˜å‚¨å¼•æ“Žæ¥è¯´ï¼ŒMYSQLæ‹’ç»åœ¨å­è¡¨ä¸­æ’å…¥æˆ–åˆ é™¤åœ¨çˆ¶è¡¨ä¸­æ²¡æœ‰åŒ¹é…åˆ°çš„å¤–é”®å€™é€‰å€¼ã€‚ å½“çˆ¶è¡¨ä¸­çš„å¤–é”®å€™é€‰å€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ ¹æ®ä¸åŒçš„è¡Œä¸ºç­–ç•¥ï¼Œæ¥å½±å“å­è¡¨ä¸­å¯¹åº”çš„å¤–é”®çš„é”®å€¼ã€‚å…·ä½“çš„ç­–ç•¥å¦‚ä¸‹ï¼š CASCADE ã€çº§è”ã€‘å¦‚æžœåœ¨çˆ¶è¡¨ä¸­åˆ é™¤å’Œæ›´æ–°æ•°æ®ï¼Œä¼šè‡ªåŠ¨çš„åˆ é™¤å’Œæ›´æ–°å­è¡¨ä¸­çš„åŒ¹é…åˆ°çš„æ‰€æœ‰æ•°æ®ã€‚æ”¯æŒåˆ é™¤çº§è”ON DELETE CASCADEå’Œæ›´æ–°çº§è”ON UPDATE CASCADE,ä¸¤ä¸ªè¡¨ä¹‹é—´ï¼Œä¸è¦å®šä¹‰å‡ ä¸ªè¿™æ ·çš„å­å¥ï¼Œè¿™äº›å­å¥ä½œç”¨åŸŸçˆ¶è¡¨æˆ–å­è¡¨ä¸­çš„åŒä¸€åˆ—ã€‚ SET NULL ã€ç½®ç©ºã€‘å¦‚æžœåœ¨çˆ¶è¡¨ä¸­åˆ é™¤å’Œæ›´æ–°æ•°æ®ï¼Œåˆ™è‡ªåŠ¨çš„ç½®ç©ºNULLå­è¡¨ä¸­çš„å¤–é”®å¯¹åº”çš„å­—æ®µã€‚å¦‚æžœåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œä¸­æŒ‡å®šäº†ON DELETE SET NULLæˆ–è€…ON UPDATE SET NULL æ—¶ï¼Œå¿…é¡»ä¿éšœ*å­è¡¨å¤–é”®çš„é‚£ä¸ªå­—æ®µæ²¡æœ‰è®¾ç½®ä¸º NOT NULL * RESTRICT ã€é™åˆ¶ã€‘å¦‚æžœåœ¨ä¼ç¬”å•Šå“¦ä¸­åˆ é™¤å’Œæ›´æ–°æ•°æ®ï¼Œå­è¡¨æ‹’ç»åˆ é™¤æˆ–æ›´æ–°å¯¹åº”å­—æ®µå†…å®¹ã€‚ NO ACTIONã€æ— åŠ¨ä½œã€‘NO ACTION æ˜¯æ ‡å‡†SQLä¸­çš„å…³é”®å­—ï¼Œåœ¨mysqlä¸­NO ACTIONå’ŒRESTRICTçš„ä½œç”¨ç›¸åŒï¼Œéƒ½æ˜¯åœ¨åœ¨ä¿®æ”¹æˆ–è€…åˆ é™¤ä¹‹å‰åŽ»æ£€æŸ¥ä»Žè¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æ•°æ®ï¼Œå¦‚æžœæœ‰ï¼Œæ‹’ç»æ“ä½œã€‚ ä½†æ˜¯æœ‰äº›æ•°æ®åº“ç³»ç»Ÿä¼šæœ‰å»¶è¿Ÿæ£€æŸ¥åŠŸèƒ½ï¼Œä¼šå¯¼è‡´NO Action ä¼šå»¶è¿Ÿæ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”æ•°æ®ï¼Œä½†æ˜¯MYSQLå¤–é”®çš„æ£€æŸ¥æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œæ‰€ä»¥RESTRICTå’ŒNO ACTIONæ˜¯å®Œå…¨ç›¸åŒçš„ SET DEFAULTéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œset defaultåªæ˜¯MySQL è§£æžå™¨è®¤å¯ï¼Œä½†æ˜¯InnoDBå’ŒNDB æ‹’ç»åœ¨å®šä¹‰è¡¨æ—¶ï¼Œå‡ºçŽ°ON DELETE SET DEFAULT or ON UPDATE SET DEFAULT è¯­å¥ã€‚]]></content>
      <categories>
        <category>MYSQL</category>
      </categories>
      <tags>
        <tag>MYSQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootçš„æ—¥å¿—ä½¿ç”¨]]></title>
    <url>%2F2019%2F07%2F10%2F2019-07-10-SpringBoot%E7%9A%84%E6%97%A5%E5%BF%97%2F</url>
    <content type="text"><![CDATA[SpringBootçš„æ—¥å¿—ä½¿ç”¨SpringBootçš„æ—¥å¿—é€‰æ‹©SpringBooté»˜è®¤ä½¿ç”¨SLF4jå’Œlogbackç”¨ä½œæ—¥å¿—ã€‚ä¸ºä»€ä¹ˆæ˜¯ä¸¤ä¸ªï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™ä¸¤ä¸ªï¼Ÿ æ—¥å¿—æ¡†æž¶çš„å¤§è‡´åˆ†ç±»æ—¥å¿—æ¡†æž¶åˆ†ä¸ºæ—¥å¿—çš„é—¨é¢æ¡†æž¶å’Œå…·ä½“çš„å®žçŽ°æ¡†æž¶ï¼Œä¸ºä»€ä¹ˆéœ€è¦é—¨é¢æ¡†æž¶ï¼Œæ˜¯å› ä¸ºä¸åŒçš„ç³»ç»Ÿå¯¹æ—¥å¿—çš„éœ€æ±‚å¯èƒ½ä¸åŒï¼Œç³»ç»Ÿä¸€å¯èƒ½ä½¿ç”¨æ—¥å¿—æ¡†æž¶ä¸€ï¼Œç³»ç»ŸäºŒè¿˜éœ€è¦å®žçŽ°æ—¥å¿—åŠŸèƒ½ï¼Œå¦‚æžœè¿˜ç”¨æ—¥å¿—æ¡†æž¶ä¸€ï¼Œåˆ™éœ€è¦é€‚é…ç³»ç»ŸäºŒè¿›è¡Œapiçš„è°ƒæ•´ã€‚ é—¨é¢æ—¥å¿—æ¡†æž¶å°±ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ã€‚è®©è°ƒç”¨æ¡†æž¶çš„apiç»Ÿä¸€ï¼Œå…·ä½“çš„å®žçŽ°å¯ä»¥éšä¸åŒçš„ç³»ç»Ÿè¿›è¡Œè°ƒæ•´ã€‚ç±»ä¼¼jdbcï¼Œæ“ä½œæŽ¥å£éœ€è¦è¿›è¡Œç»Ÿä¸€ã€‚ æ‰€ä»¥SpringBootçš„æ—¥å¿—ä½¿ç”¨åˆ†åˆ«æ˜¯ç”¨æ¥æ—¥å¿—é—¨é¢æ¡†æž¶SLF4jå’Œæ—¥å¿—å…·ä½“å®žçŽ°æ¡†æž¶logbackä½œä¸ºæ—¥å¿—æœåŠ¡ã€‚ ä½¿ç”¨æ—¥å¿—ç®€æ˜“ä½¿ç”¨SLF4jå‚è€ƒSLF4jå®˜ç½‘ä¸­çš„hello worldç¨‹åºï¼š 12345678910// å¯¼å…¥slf4jçš„jaråŒ…import org.slf4j.Logger;import org.slf4j.LoggerFactory;public class HelloWorld &#123; public static void main(String[] args) &#123; Logger logger = LoggerFactory.getLogger(HelloWorld.class); logger.info("Hello World"); &#125;&#125; ä¸‹å›¾è¡¨ç¤ºäº†ä½¿ç”¨slf4jå’Œå„ä¸ªæ—¥å¿—å®žçŽ°æ¡†æž¶çš„åŒ¹é…ã€‚ç»¿è‰²çš„æ˜¯é€‚é…å±‚ï¼Œæ·±è“è‰²çš„æ˜¯å®žçŽ°æ¡†æž¶ã€‚æ¯”å¦‚ä½¿ç”¨logbackä½œä¸ºå®žçŽ°æ¡†æž¶ï¼Œåˆ™éœ€è¦å¯¼å…¥slf4jçš„jaråŒ…å’Œlogbackçš„ç›¸å…³jaråŒ…ã€‚ä½†æ˜¯å¦‚æžœä½¿ç”¨log4jä½œä¸ºå®žçŽ°æ¡†æž¶ï¼Œè¿˜éœ€å¯¼å…¥ä¸­é—´çš„é€‚é…å±‚jaråŒ…ï¼ˆä¸­é—´ç»¿è‰²çš„ï¼‰ã€‚ åœ¨Springboot-logging-startä¸­ä½¿ç”¨å¦‚ä¸‹çš„jaråŒ…ä¾èµ–ï¼š æ¯ä¸€ä¸ªå®žçŽ°æ¡†æž¶éƒ½æœ‰å„è‡ªçš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨slf4jåŽï¼Œé…ç½®æ–‡ä»¶è¿˜æ˜¯ä½¿ç”¨å…·ä½“å®žçŽ°çš„é…ç½®æ–‡ä»¶ã€‚ SpringBootä¸­çš„SLF4j SpringBootåº•å±‚è‡ªåŠ¨é…ç½®ä½¿ç”¨çš„æ˜¯SLF4jå’Œlogbackã€‚ SprintBootä½¿ç”¨ä¸­é—´åŒ…å°†å…¶ä»–æ—¥å¿—æ¡†æž¶è½¬åŒ–ä¸ºslf4jæ¡†æž¶ã€‚ å¼•å…¥å…¶ä»–æ—¥å¿—æ¡†æž¶æ—¶ï¼Œéœ€è¦æŠŠè¿™ä¸ªæ—¥å¿—çš„jaråŒ…æŽ’é™¤æŽ‰ã€‚å¦åˆ™ä¸Žslf4jçš„jaråŒ…ç›¸å†²çªï¼Œä¸Šä¸€æ¡å°±æ˜¯åŽŸå› ã€‚ åœ¨æµ‹è¯•æ–‡ä»¶ä¸­æµ‹è¯•SpringBootçš„æ—¥å¿—ä½¿ç”¨ 12345678910111213Logger logger = LoggerFactory.getLogger(this.getClass()); @Test public void testLogger()&#123; // ç”±ä½Žåˆ°é«˜ æ—¥å¿—çš„çº§åˆ«ï¼Œæ—¥å¿—æ¡†æž¶å¯ä»¥æ ¹æ®é…ç½®æ–‡ä»¶è°ƒæ•´è¾“å‡ºçš„æ—¥å¿—çº§åˆ«ï¼Œ // åªä¼šè¾“å‡ºç›¸åº”æ—¥å¿—çº§åˆ«åŠåŽé¢çš„é«˜çº§åˆ«æ—¥å¿—ä¿¡æ¯ logger.trace("è¿™æ˜¯traceæ—¥å¿—"); logger.debug("è¿™æ˜¯debugæ—¥å¿—"); // SpringBooté»˜è®¤ä½¿ç”¨çš„æ˜¯infoçº§åˆ«ï¼Œ // å¯ä»¥ä½¿ç”¨æ—¥å¿—çš„é…ç½®æ–‡ä»¶è°ƒæ•´çº§åˆ« logger.info("è¿™æ˜¯infoæ—¥å¿—"); logger.warn("è¿™æ˜¯warnæ—¥å¿—"); logger.error("è¿™æ˜¯erroræ—¥å¿—"); &#125; æ—¥å¿—çº§åˆ«æœ‰trace, debug,info,warn,erroräº”ç§æ—¥å¿—çº§åˆ«ã€‚å¹¶ä¸”ç”±ä½Žåˆ°é«˜æŽ’åºã€‚æŒ‡å®šæ—¥å¿—çº§åˆ«ï¼Œåˆ™ç³»ç»Ÿä¼šè¾“å‡ºå½“å‰æ—¥å¿—çº§åˆ«å’Œæ›´é«˜çš„æ—¥å¿—çº§åˆ«çš„æ—¥å¿—ã€‚ 12345678910111213141516# å…¨å±€çš„æ—¥å¿—è®°å½•çº§åˆ«#logging:# level: trace# æŒ‡å®šçš„åŒ…ä¸‹çš„æ—¥å¿—è®°å½•çº§åˆ«logging: level: com : nanyin : debug# pattern: è¾“å‡ºæ ¼å¼# file:# console:# file: -- è¿™é‡Œç”¨äºŽæŒ‡å®šæ—¥å¿—è®°å½•çš„æ–‡ä»¶åï¼Œå¯ä»¥æŒ‡å®šå…·ä½“çš„è·¯å¾„ï¼ŒæœªæŒ‡å®šåˆ™ç”Ÿæˆåœ¨å½“å‰é¡¹ç›®ä¸‹# path: -- è¿™é‡Œç”¨äºŽæŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ï¼Œspringbootä¼šé»˜è®¤ç”Ÿæˆè·¯å¾„ï¼Œé»˜è®¤æ–‡ä»¶å# è¿™ä¸¤ä¸ªæŒ‡å®šä¸€ä¸ªå°±å¥½äº†ï¼Œéƒ½æŒ‡å®šåˆ™ä¼šé»˜è®¤ä½¿ç”¨file ä½¿ç”¨è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶æ›´æ¢log4j2ä½œä¸ºæ—¥å¿—æ¡†æž¶]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootä¸­çš„é…ç½®æ–‡ä»¶ï¼ˆæ‹“å±•ï¼‰]]></title>
    <url>%2F2019%2F07%2F08%2F2019-07-08-SpringBoot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%88%E6%8B%93%E5%B1%95%EF%BC%89%2F</url>
    <content type="text"><![CDATA[SpringBootä¸­çš„é…ç½®æ–‡ä»¶(æ‹“å±•)å¦‚æžœæœ‰å¤šä¸ªçŽ¯å¢ƒï¼Œé…ç½®æ–‡ä»¶éœ€è¦æ ¹æ®çŽ¯å¢ƒæ¥å˜åŒ–ï¼Œåªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶å°±æ˜¾çš„é¸¡è‚‹äº†ï¼Œæ¯æ¬¡å˜æ›´çŽ¯å¢ƒçš„æ—¶å€™éƒ½éœ€è¦ä¿®æ”¹ä¸€éé…ç½®æ–‡ä»¶ï¼Œä¸¤ä¸ªè¿˜å¥½ï¼Œå¤šäº†å°±ç›¸å½“éº»çƒ¦äº†ã€‚ SpringBootæä¾›äº†å¤šé…ç½®æ–‡ä»¶çš„ç”¨æ³•ï¼Œè®©çŽ¯å¢ƒçš„å˜åŒ–å°½å¯èƒ½å°‘çš„å½±å“åˆ°é…ç½®æ–‡ä»¶çš„æ›´æ”¹ã€‚ å¤šé…ç½®æ–‡ä»¶åŠ è½½é¡ºåºSpringä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾åœ°å€ï¼Œå¦‚æžœæœ‰åˆ™ä¼˜å…ˆä½¿ç”¨å‰é¢çš„é…ç½®æ–‡ä»¶çš„å±žæ€§ï¼Œå¦‚æžœåŽé¢çš„æ–‡ä»¶æœ‰å‰é¢æ–‡ä»¶æ²¡æœ‰çš„å±žæ€§ï¼Œåˆ™ä¼šæ·»åŠ ï¼Œå¦åˆ™å¿½ç•¥ã€‚ file:./config/ file:./ classpath:/config/ classpath:/ æŒ‡å®š/æ·»åŠ é»˜è®¤åŠ è½½åœ°å€ä½¿ç”¨spring.config.locationæ¥æŒ‡å®šé»˜è®¤çš„åŠ è½½åœ°å€ã€‚ å¦‚æžœspring.config.location æŒ‡å®šçš„å€¼ä¸ºï¼š classpath:/custom-config/,file:./custom-config/ï¼Œåˆ™ç³»ç»Ÿä¼šä¼˜å…ˆæ‰¾è¿™ä¸ªæ–‡ä»¶ã€‚ å¦‚æžœä½¿ç”¨spring.config.additional-locationæ¥æ·»åŠ é…ç½®æ–‡ä»¶çš„åŠ è½½åœ°å€ã€‚ å‘½åæ ¼å¼å¯ä»¥ä½¿ç”¨ application-{profile}.propertiesæ¥å®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„é…ç½®æ–‡ä»¶ã€‚ç‰¹æ®Šçš„è¿™ä¸ªé…ç½®æ–‡ä»¶å¦‚æžœè°ƒç”¨ï¼Œé‚£ä¹ˆä»–æ€»ä¼šè¦†ç›–æŽ‰é»˜è®¤çš„application.propertiesæ–‡ä»¶ä¸­çš„å†…å®¹ã€‚ æ¯”å¦‚ä½¿ç”¨application-dev.propertiesä½œä¸ºå¼€å‘çŽ¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æŒ‡å®šäº†æœåŠ¡ç«¯å£8081.è€Œåœ¨é»˜è®¤çš„application.propertiesä¸­æŒ‡å®šçš„ç«¯å£å·ä¸º8080.é‚£ä¹ˆï¼Œç³»ç»Ÿä¼šä½¿ç”¨å“ªä¸ªç«¯å£å‘¢ï¼Ÿ ä¸‹é¢æˆ‘ä½¿ç”¨ymlæ–‡ä»¶ä½œä¸ºä¾‹å­ï¼ˆåŒpropertiesæ–‡ä»¶ï¼‰ 123456789101112# application.ymlæ–‡ä»¶ä¸­çš„å†…å®¹server: port: 8080# yamlæ–‡ä»¶æ ¼å¼æŒ‡å®šä½¿ç”¨å“ªä¸ªé…ç½®spring: profiles: active: dev# application-dev.propertiesæ–‡ä»¶ä¸­çš„å†…å®¹server: port: 8081 é€šè¿‡spring.profiles.active=dev(è¿™æ—¶propertiesæ ¼å¼)ã€‚æ¥ç‰¹æ®ŠæŒ‡å®šå¯ç”¨å“ªäº›é…ç½®æ–‡ä»¶ã€‚è¿™é‡Œå¯ç”¨çš„æ˜¯application-dev.propertiesæ–‡ä»¶ã€‚ ç”±æŽ§åˆ¶å°çš„è¾“å‡ºç»“æžœå¯ä»¥çœ‹å‡ºï¼ŒspringBootæ¿€æ´»äº†åä¸ºdevçš„é…ç½®æ–‡ä»¶åŠapplication-dev.propertiesæ–‡ä»¶ï¼Œå¹¶ä¸”æ›´æ”¹ç«¯å£ä¸ºdevä¸­æŒ‡å®šçš„8081ç«¯å£ã€‚ ä½¿ç”¨yamlæ–‡æ¡£å—yamlæ–‡ä»¶æä¾›ä¸€ç§ç‰¹æ€§å«åšæ–‡æ¡£å—ã€‚ä½¿ç”¨ä¸‰ä¸ª-æ¥éš”ç¦»é…ç½®ä¿¡æ¯ 1234567891011121314151617181920212223# é»˜è®¤çš„server: port: 8080spring: profiles: active: dev# æ–‡æ¡£å—1---spring: profiles: devserver: port: 8081# æ–‡æ¡£å—2---spring: profiles: prodserver: port: 8082 ä½¿ç”¨æ–‡æ¡£å—èƒ½å¤Ÿå‡å°‘å¤šä¸ªé…ç½®æ–‡ä»¶ã€‚ä¸Žå¤šä¸ªé…ç½®æ–‡ä»¶æ•ˆæžœæ˜¯ç­‰åŒçš„ã€‚ è‡ªåŠ¨é…ç½®å…¶å®žåœ¨å‰é¢çš„æ–‡ç« ä¸­å·²ç»å¤§æ¦‚äº†è§£äº†SpringBootå¦‚ä½•è¿›è¡Œè‡ªåŠ¨é…ç½®ï¼Œä½†æ˜¯ä»…ä»…åœç•™åœ¨äº†EnableAutoConfigurationæ³¨è§£çš„ä½¿ç”¨å’Œæµ…å±‚çš„è§£æžä¸Šï¼Œè¿™æ¬¡éœ€è¦æ›´åŠ æ·±å…¥çš„äº†è§£å¦‚ä½•è°ƒç”¨åˆ°è‡ªåŠ¨é…ç½®ç±»ã€æˆ‘ä»¬å¦‚æžœæƒ³è‡ªå·±åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å±žæ€§ï¼Œè¯¥æ€Žä¹ˆåŽ»é…ç½®ã€‚ å¦‚ä½•è¿›è¡Œçš„è‡ªåŠ¨é…ç½®é¦–å…ˆè¿˜æ˜¯è¿›å…¥åˆ°SpringBootApplicationæ³¨è§£ä¸­ 12345@SpringBootConfiguration@EnableAutoConfiguration@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;) public @interface SpringBootApplication &#123; å‘çŽ°è¿™é‡Œè°ƒç”¨äº†EnableAutoConfigurationæ³¨è§£ã€‚å†ç‚¹è¿›è¿™ä¸ªæ³¨è§£ä¸­ã€‚ 1234@AutoConfigurationPackage// å¼•ç”¨äº†AutoConfigurationImportSelectorè¿™ä¸ªç±»@Import(AutoConfigurationImportSelector.class)public @interface EnableAutoConfiguration &#123; è¿™é‡Œé€šè¿‡importæ³¨è§£ä½¿ç”¨äº†AutoConfigurationImportSelectorç±»ï¼Œè¿™ä¸ªç±»ç›´æŽ¥ç¿»è¯‘è¿‡æ¥å«åšè‡ªåŠ¨é…ç½®å¯¼å…¥é€‰æ‹©å™¨ã€‚è¿›å…¥è¿™ä¸ªç±»ä¸­çœ‹ã€‚ 12public class AutoConfigurationImportSelector implements DeferredImportSelector, BeanClassLoaderAware, ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered &#123; è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°AutoConfigurationImportSelectorç»§æ‰¿äº†DeferredImportSelectorè¿™ä¸ªç±»ã€‚è¿™ä¸ªç±»ä¸­éœ€è¦å®žçŽ°çš„æ–¹æ³•æ˜¯void process(AnnotationMetadata metadata, DeferredImportSelector selector);æ–¹æ³•ã€‚ æ‰€ä»¥éœ€è¦çœ‹AutoConfigurationImportSelectorä¸­æ˜¯å¦‚ä½•å®žçŽ°çˆ¶ç±»ä¸­å®šä¹‰çš„processæ–¹æ³•ã€‚ 1234567891011121314public void process(AnnotationMetadata annotationMetadata, DeferredImportSelector deferredImportSelector) &#123; Assert.state(deferredImportSelector instanceof AutoConfigurationImportSelector, () -&gt; String.format("Only %s implementations are supported, got %s", AutoConfigurationImportSelector.class.getSimpleName(), deferredImportSelector.getClass().getName())); // èŽ·å¾—è‡ªåŠ¨é…ç½®çš„entryï¼Œç‚¹è¿›è¿™ä¸ªæ–¹æ³•çœ‹å¦‚ä½•èŽ·å–è‡ªåŠ¨é…ç½®çš„é…ç½®ä¿¡æ¯çš„ AutoConfigurationEntry autoConfigurationEntry = ((AutoConfigurationImportSelector) deferredImportSelector) .getAutoConfigurationEntry(getAutoConfigurationMetadata(), annotationMetadata); this.autoConfigurationEntries.add(autoConfigurationEntry);// å¾ªçŽ¯æ‰€æœ‰configurationç„¶åŽæ”¾åˆ°entriesä¸­æ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚ for (String importClassName : autoConfigurationEntry.getConfigurations()) &#123; this.entries.putIfAbsent(importClassName, annotationMetadata); &#125;&#125; é€šè¿‡getAutoConfigurationEntryè¿™ä¸ªæ–¹æ³•èŽ·å–åˆ°æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®çš„ä¿¡æ¯ã€‚ç‚¹è¿›è¿™ä¸ªæ–¹æ³•çœ‹æ˜¯å¦‚ä½•èŽ·å–åˆ°çš„ 12345678910protected AutoConfigurationEntry getAutoConfigurationEntry(AutoConfigurationMetadata autoConfigurationMetadata, AnnotationMetadata annotationMetadata) &#123; if (!isEnabled(annotationMetadata)) &#123; return EMPTY_ENTRY; &#125; AnnotationAttributes attributes = getAttributes(annotationMetadata); // è¿”å›žè‡ªåŠ¨é…ç½®ç±»çš„å…¨ç±»å List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes); // åŽ»æŽ‰é‡å¤çš„ configurations = removeDuplicates(configurations); é€šè¿‡getCandidateConfigurationsæ¥èŽ·å–è‡ªåŠ¨é…ç½®çš„å…¨ç±»åã€‚ 1234protected List&lt;String&gt; getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) &#123;// ç¬¬ä¸€ä¸ªå‚æ•°è¿”å›žçš„æ˜¯ EnableAutoConfiguration.class List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(), getBeanClassLoader()); æŽ¥ç€è°ƒç”¨loadFactoryNamesèŽ·å–è‡ªåŠ¨é…ç½®ç±»çš„List 1234567public static List&lt;String&gt; loadFactoryNames(Class&lt;?&gt; factoryClass, @Nullable ClassLoader classLoader) &#123; // è¿™é‡Œçš„factoryClassNameæ˜¯EnableAutoConfiguration String factoryClassName = factoryClass.getName(); // ä¸‹é¢è¿™å¥è¯çš„æ„æ€æ˜¯éœ€è¦åœ¨loadSpringFactoriesè¿™ä¸ªmapä¸­èŽ·å–keyä¸ºEnableAutoConfigurationçš„value return loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());&#125; é‚£ä¹ˆè¿™ä¸ªmapçš„å€¼æ˜¯æ€Žä¹ˆå½¢æˆçš„å‘¢ï¼Ÿ 12345678910111213141516171819202122// åœ¨FACTORIES_RESOURCE_LOCATIONä¸­èŽ·å–èµ„æºEnumeration&lt;URL&gt; urls = (classLoader != null ? classLoader.getResources(FACTORIES_RESOURCE_LOCATION) : ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));//å®šä¹‰ä¸€ä¸ªMAPï¼Œå°†ç»“æžœéƒ½å­˜åˆ°è¿™ä¸ªmapä¸­result = new LinkedMultiValueMap&lt;&gt;();//å¯¹æ¯ä¸ªèµ„æºå¾ªçŽ¯while (urls.hasMoreElements()) &#123; URL url = urls.nextElement(); UrlResource resource = new UrlResource(url);// è½¬åŒ–ä¸ºproperties Properties properties = PropertiesLoaderUtils.loadProperties(resource); for (Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) &#123; String factoryClassName = ((String) entry.getKey()).trim(); for (String factoryName : StringUtils.commaDelimitedListToStringArray((String) entry.getValue())) &#123; // æœ€åŽæ·»åŠ åˆ°resultä¸­ result.add(factoryClassName, factoryName.trim()); &#125; &#125;&#125;cache.put(classLoader, result);return result; ä¸‹å›¾æ˜¯å¯¹resultçš„debugç»“æžœï¼Œæ¡†ä¸­æ˜¯æ‰€æœ‰çš„ç»“æžœï¼Œä½†æ¨ªçº¿å¤„æ˜¯æˆ‘ä»¬è‡ªåŠ¨é…ç½®éœ€è¦çš„ã€‚ ç»“æžœåœ¨FACTORIES_RESOURCE_LOCATIONï¼ˆMETA-INF/spring.factoriesï¼‰ä¸­å¯ä»¥æ‰¾åˆ°. è¿™é‡Œçš„æ‰€æœ‰ç±»éƒ½æ˜¯å¯ä»¥è‡ªåŠ¨é…ç½®åˆ°Springçš„å®¹å™¨ä¸­ã€‚ å¦‚ä½•æ ¹æ®è‡ªåŠ¨é…ç½®ç±»é…ç½®å±žæ€§è¿›å…¥åˆ°spring.factoriesä¸­è¿›è¡ŒæŸ¥çœ‹æ‰€æœ‰autoConfigureç±»ï¼Œç”¨CacheAutoConfigurationä¸¾ä¾‹ï¼Œæ¥åˆ†æžä»¥åŽæƒ³è¦é…ç½®å…³äºŽcacheçš„å±žæ€§ï¼Œæ€Žä¹ˆæŸ¥æ‰¾åˆ°è¿™ä¸ªé…ç½®å±žæ€§ï¼Œæ€Žä¹ˆé…ç½®åˆ°propertiesæ–‡ä»¶ä¸­ã€‚ ç›´æŽ¥ç‚¹è¿›ç±»ä¸­å‘çŽ°æœ‰å¾ˆå¤šæ³¨è§£ï¼Œä¸€ä¸ªä¸ªçœ‹ 123456789101112131415//è¡¨ç¤ºä¸€ä¸ªé…ç½®æ–‡ä»¶@Configuration// ä»…å½“classpathä¸­å­˜åœ¨ç‰¹å®šçš„CacheManagerç±»æ—¶åŒ¹é…@ConditionalOnClass(CacheManager.class)// å¦‚æžœSpring å®¹å™¨ä¸­å­˜åœ¨CacheAspectSupport@ConditionalOnBean(CacheAspectSupport.class)//å¦‚æžœSpringå®¹å™¨ä¸æ»¡è¶³beançš„nameä¸ºcacheResolverï¼Œvalueä¸ºCacheMaager@ConditionalOnMissingBean(value = CacheManager.class, name = "cacheResolver")// å¼€å¯è‡ªåŠ¨é…ç½®å±žæ€§ï¼ŒæŒ‡å‘ CachePropertiesç±»@EnableConfigurationProperties(CacheProperties.class)@AutoConfigureAfter(&#123; CouchbaseAutoConfiguration.class, HazelcastAutoConfiguration.class, HibernateJpaAutoConfiguration.class, RedisAutoConfiguration.class &#125;)// ç¼“å­˜é…ç½®çš„é€‰æ‹©å™¨@Import(CacheConfigurationImportSelector.class)public class CacheAutoConfiguration &#123; å…¶ä¸­EnableConfigtionPropertiesæ³¨è§£ç”¨æ¥å¼€å¯é…ç½®å±žæ€§ã€‚ 12345678910// spring.cacheå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨çš„å‰ç¼€@ConfigurationProperties(prefix = "spring.cache")public class CacheProperties &#123;// ä»¥ä¸‹å°±æ˜¯å„å±žæ€§å€¼ private CacheType type; private List&lt;String&gt; cacheNames = new ArrayList&lt;&gt;(); private final Caffeine caffeine = new Caffeine(); private final Couchbase couchbase = new Couchbase(); private final EhCache ehcache = new EhCache(); private final Redis redis = new Redis(); ç”¨cacheä¸­çš„rediså¯¹è±¡ä¸ºä¾‹å­ï¼Œå¦‚ä½•åŽ»é…ç½®redisç¼“å­˜ã€‚ å…¶ä¸­æŒ‡å®šäº†å‰ç¼€ï¼Œå’Œä¸­é—´çš„rediså¯¹è±¡ï¼Œæ‰€ä»¥redisçš„é…ç½®ä¸­çš„å±žæ€§å°±åº”è¯¥æ˜¯spring.cache.redis.xxx. 12345public static class Redis &#123; private Duration timeToLive; private boolean cacheNullValues = true; private String keyPrefix; private boolean useKeyPrefix = true; æ¯”å¦‚éœ€è¦é…ç½®ä¸å…è®¸redisç¼“å­˜ç©ºå€¼ï¼Œå°±éœ€è¦é…ç½®cacheNullValueså±žæ€§ï¼Œæ‰€ä»¥å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å†™ 1spring.cache.redis.chcheNullValues=false å…¶ä»–ç±»åž‹çš„è‡ªåŠ¨é…ç½®ç±»åŒç†ï¼Œæ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»éƒ½é…å¤‡ä¸€ä¸ªxxxProperties.classç±»è¿›è¡Œå±žæ€§çš„åŒ¹é…,æ‰€ä»¥å¦‚æžœéœ€è¦æŸä¸ªå±žæ€§ï¼Œåˆ™ç›´æŽ¥å‘å¯¹åº”çš„ç±»ä¸­æŸ¥æ‰¾ï¼Œæ‰¾å‡ºå‰ç¼€å’Œå±žæ€§åï¼Œåˆ™å¯ç›´æŽ¥æ‰¾å‡ºå®Œæˆçš„é…ç½®åç§°ã€‚ ç»è¿‡ä¸Šé¢çš„åˆ†æžï¼Œåœ¨ä¹Ÿä¸ç”¨æ‹…å¿ƒè¯¥å¦‚ä½•é…ç½®é…ç½®æ–‡ä»¶äº†ã€‚ è‡ªå®šä¹‰SpringBoot Starterå®žçŽ°è‡ªåŠ¨é…ç½®å¦‚æžœè‡ªè¡Œè¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚ä¸»è¦å®žçŽ°çš„æ–‡ä»¶æ˜¯ï¼š xxxxAutoConfigurationç±» xxxxPropertiesç±» resources/META-INF/ ä¸‹çš„ spring.factories æ–‡ä»¶ä¸­æ·»åŠ ï¼šorg.springframework.boot.autoconfigure.EnableAutoConfiguration=com.example.autocinfigure.xxxxAutoConfigure åœ¨åˆ›å»ºè‡ªåŠ¨é…ç½®åŒ…å‰éœ€è¦åœ¨pomæ–‡ä»¶ä¸­æ·»åŠ è‡ªåŠ¨é…ç½®çš„åŒ…ä¾èµ–ã€‚ 1234567&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt; &lt;version&gt;1.5.9.RELEASE&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; åŠ è½½çš„åŸºæœ¬è¿‡ç¨‹ï¼š Spring Bootåœ¨å¯åŠ¨æ—¶æ‰«æé¡¹ç›®æ‰€ä¾èµ–çš„JARåŒ…ï¼Œå¯»æ‰¾åŒ…å«spring.factoriesæ–‡ä»¶çš„JARåŒ… æ ¹æ®spring.factoriesé…ç½®åŠ è½½AutoConfigureç±» æ ¹æ® @Conditionalæ³¨è§£çš„æ¡ä»¶ï¼Œè¿›è¡Œè‡ªåŠ¨é…ç½®å¹¶å°†Beanæ³¨å…¥Spring Context]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootæ·±å…¥è‡ªåŠ¨é…ç½®]]></title>
    <url>%2F2019%2F07%2F07%2F2019-07-04-SpringBoot%E6%B7%B1%E5%85%A5%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[SpringBootæ·±å…¥è‡ªåŠ¨é…ç½®å¼•å…¥åœ¨ä¸Šä¸€ç¯‡Spring Bootä¸Žå¾®æœåŠ¡åŸºæœ¬ä»‹ç»ä¸­ï¼Œä»‹ç»äº†åˆ›å»ºmavené¡¹ç›®åˆ°è¿è¡Œspringbootçš„åŸºæœ¬è¿‡ç¨‹ã€‚ å…¶ä¸­ä½¿ç”¨ä¸»ç¨‹åºæ¥å¯åŠ¨SpringBoot 1234567@SpringBootApplicationpublic class DeepSpringBootApplication &#123; public static void main(String[] args) &#123; // ä½¿ç”¨SpringApplication.runæ–¹æ³•æ¥å¯åŠ¨spring bootåº”ç”¨ å…¶ä¸­å‚æ•°æœ‰ç±»å’Œargs SpringApplication.run(DeepSpringBootApplication.class,args); &#125;&#125; ä»…ä»…æ˜¯æ·»åŠ äº†ä¸€ä¸ª@SpringBootApplicationæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼ŒåŽŸç†æ˜¯ä»€ä¹ˆï¼ŒæŽ¥ä¸‹æ¥å°±é€šè¿‡æºç ç®€å•çœ‹ä¸€ä¸‹ã€‚ SpringBootApplicationå¯åŠ¨æ³¨è§£1234567891011121314151617181920//ç‚¹å¼€@SpringBootApplicationæºç @Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@SpringBootConfiguration@EnableAutoConfiguration@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)public @interface SpringBootApplication &#123; /** AliasForæ³¨è§£çš„ä½œç”¨æ˜¯ä¸ºäº†å£°æ˜Žåˆ«å * AliasForåœ¨ä¸‹é¢ä»£ç ä¸­çš„ä½œç”¨å°±æ˜¯é€šè¿‡åˆ«åå¼•ç”¨åœ¨annotatinæŒ‡å®šçš„ç±»çš„ç‰¹å®šæ–¹æ³• * å¦‚æžœæœ‰å…´è¶£å¯ä»¥å‚è€ƒAliasForçš„å®˜æ–¹æ–‡æ¡£ * https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/annotation/AliasFor.html * æ¯”å¦‚è¿™é‡Œå°±ä¼šæŒ‡å®š EnableAutoConfigurationçš„excludeæ–¹æ³• **/ @AliasFor(annotation = EnableAutoConfiguration.class) Class&lt;?&gt;[] exclude() default &#123;&#125;; // ã€‚ã€‚ã€‚å…¶ä»–çš„çœç•¥&#125; åœ¨ä¸Šé¢çš„@SpringBootApplicationæºç ä¸­ï¼Œå…¶ä¸­ä½¿ç”¨åˆ°äº†ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„åŸºæœ¬æ³¨è§£@SpringBootConfigurationã€@EnableAutoConfigurationå’Œ@ComponentScanã€‚ä¸‹é¢åˆ†åˆ«æ¥å¯¹è¿™ä¸‰ä¸ªæ³¨è§£è¿›è¡Œç®€å•åˆ†æžã€‚ SpringBootConfiguration1234567891011/** * æ ‡ç¤ºæ˜¯ä¸€ä¸ªspring bootåº”ç”¨çš„é…ç½®ç±»ï¼Œç”¨ä½œ @Configuratioçš„æ›¿ä»£å“ * ä»¥ä¾¿è‡ªåŠ¨æ‰¾åˆ°é…ç½® */@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Configurationpublic @interface SpringBootConfiguration &#123;&#125; å…¶å®žè¿™æ—¶SpringBootå¯¹Springçš„@Configurationçš„æ³¨è§£çš„åŒ…è£… Configuration12345678@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Componentpublic @interface Configuration &#123; @AliasFor(annotation = Component.class) String value() default "";&#125; ç®€å•ç†è§£ä¸ºï¼ŒConfiguration æ³¨è§£ä¸Šæ ‡æ³¨äº†@ComponentåŽŸæ³¨è§£ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯ä¸€ä¸ªspringç»„ä»¶ï¼Œä¼šé€šè¿‡æ‰«ææŠŠæ ‡å¿—è¿™ä¸ªæ³¨è§£çš„ç±»ä½œä¸ºspringçš„é…ç½®ç±»åŠ è½½åˆ°å®¹å™¨ä¸­ã€‚ å®žé™…ä¸ŠåŠ è½½Configurationçš„æ–¹æ³•æœ‰ä¸‰ç§ï¼Œè‡ªåŠ¨æ‰«æé…ç½®ç±»åªæ˜¯å…¶ä¸­çš„ä¸€ç§ï¼Œå…¶ä»–ä¸¤ç§æ˜¯ é€šè¿‡AnnotationConfigApplicationContextç±» 12345678910111213@Configuration public class AppConfig &#123; @Bean public MyBean myBean() &#123; // instantiate, configure and return bean ... &#125;&#125;AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();// æ³¨å†ŒBeanctx.register(AppConfig.class);ctx.refresh();MyBean myBean = ctx.getBean(MyBean.class); ä½¿ç”¨xmlé…ç½®æ–‡ä»¶,å°†æ ‡æ³¨ä¸º@Configurationçš„ç±»ä½œä¸ºä¸€ä¸ªbeanæ¥å£°æ˜Žåœ¨xmlæ–‡ä»¶ä¸­ã€‚ 1234&lt;beans&gt; &lt;context:annotation-config/&gt; &lt;bean class="com.acme.AppConfig"/&gt; &lt;/beans&gt; æ ‡è®°@Configurationæ³¨è§£çš„ç±»è¡¨ç¤ºè¿™ä¸ªç±»ä¸­å£°æ˜Žäº†ä¸€ä¸ªæˆ–å¤šä¸ª@Beanæ–¹æ³•ï¼Œå¯ä»¥äº¤ç”±springå®¹å™¨å¤„ç†ã€‚å¯ä»¥åœ¨è¿è¡Œæ—¶ç”Ÿæˆbeanå®šä¹‰å’Œbeanä¹‹é—´çš„æœåŠ¡è¯·æ±‚ã€‚ æ›´åŠ è¯¦ç»†çš„å‚è€ƒSpringå®˜ç½‘Configurationæ³¨è§£ EnableAutoConfigurationEnableAutoConfigurationæ˜¯spring bootä¸­çš„æ³¨è§£ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯çŒœæµ‹å¹¶è‡ªåŠ¨é…ç½®å¯èƒ½éœ€è¦çš„bean,ä¹Ÿå°±æ˜¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ã€‚ 1234567@AutoConfigurationPackage@Import(AutoConfigurationImportSelector.class)public @interface EnableAutoConfiguration &#123; String ENABLED_OVERRIDE_PROPERTY = "spring.boot.enableautoconfiguration"; Class&lt;?&gt;[] exclude() default &#123;&#125;; String[] excludeName() default &#123;&#125;;&#125; å…¶ä¸­é‡è¦çš„ä¸¤ä¸ªæ³¨è§£@AutoConfigurationPackageå’Œ@Importä¸­çš„å†…å®¹ AutoConfigurationPackage12345678910111213141516171819// æ ‡æ³¨@AutoConfigurationPackageçš„æ³¨è§£å¯ä»¥ä½¿ç”¨Registrarè¿›è¡Œæ³¨å†Œ// @Importçš„ä½œç”¨å°±æ˜¯å¼•ç”¨é…ç½®ç±»ï¼Œå°†å¤šä¸ªé…ç½®ç±»æ”¾åˆ°ä¸€ä¸ªä¸»é…ç½®ä¸­@Import(AutoConfigurationPackages.Registrar.class)public @interface AutoConfigurationPackage &#123;&#125;// æ³¨å†Œæ–¹æ³•static class Registrar implements ImportBeanDefinitionRegistrar, DeterminableImports &#123;// æ³¨å†Œbeanå®šä¹‰ä¿¡æ¯ @Override public void registerBeanDefinitions(AnnotationMetadata metadata, BeanDefinitionRegistry registry) &#123; // è¿™é‡Œçš„packageNameæ˜¯æ ‡æ³¨è¿™ä¸ªæ³¨è§£çš„ç±»çš„åŒ…çš„è·¯å¾„åç§°ï¼Œå¦‚ä¸‹å›¾ register(registry, new PackageImport(metadata).getPackageName()); &#125; @Override public Set&lt;Object&gt; determineImports(AnnotationMetadata metadata) &#123; return Collections.singleton(new PackageImport(metadata)); &#125;&#125; å°†ä¸»é…ç½®ç±»çš„æ‰€åœ¨çš„åŒ…åŠä¸‹é¢çš„æ‰€æœ‰å­åŒ…æ‰«æåˆ°Springå®¹å™¨ä¸­ã€‚ 123456789101112131415161718// ä»¥ç¼–ç¨‹æ–¹å¼æ³¨å†Œè‡ªåŠ¨é…ç½®åŒ…åç§°.å°†ç»™å®šçš„åŒ…ã€è¿™é‡Œçš„æ˜¯com.nanyin ã€‘æ³¨å†Œæ·»åŠ åˆ°å·²ç»æ³¨å†Œçš„åŒ…åç§°ä¸­public static void register(BeanDefinitionRegistry registry, String... packageNames) &#123;// private static final String BEAN = AutoConfigurationPackages.class.getName(); if (registry.containsBeanDefinition(BEAN)) &#123; BeanDefinition beanDefinition = registry.getBeanDefinition(BEAN); ConstructorArgumentValues constructorArguments = beanDefinition.getConstructorArgumentValues(); constructorArguments.addIndexedArgumentValue(0, addBasePackages(constructorArguments, packageNames)); &#125; else &#123; // ä½¿ç”¨æ ‡å‡†çš„ç±»å®šä¹‰ GenericBeanDefinition æ³¨å†Œbean GenericBeanDefinition beanDefinition = new GenericBeanDefinition(); beanDefinition.setBeanClass(BasePackages.class); beanDefinition.getConstructorArgumentValues().addIndexedArgumentValue(0, packageNames); beanDefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE); // æ³¨å†Œbean registry.registerBeanDefinition(BEAN, beanDefinition); &#125;&#125; @Import(AutoConfigurationImportSelector.class)è‡ªåŠ¨å¯¼å…¥ç»„ä»¶çš„é€‰æ‹©å™¨ã€‚å°†éœ€è¦å¯¼å…¥çš„ç»„ä»¶ä»¥å…¨ç±»åçš„æ–¹å¼è¿”å›žä¸€ä¸ªæ•°ç»„ã€‚ 12345678910111213@Overridepublic void process(AnnotationMetadata annotationMetadata, DeferredImportSelector deferredImportSelector) &#123; Assert.state(deferredImportSelector instanceof AutoConfigurationImportSelector, () -&gt; String.format("Only %s implementations are supported, got %s", AutoConfigurationImportSelector.class.getSimpleName(), deferredImportSelector.getClass().getName())); //èŽ·å–è‡ªåŠ¨å¯¼å…¥çš„å†…å®¹çš„å…¨ç±»åï¼Œåœ¨è¿™ä¸€æ­¥è¿›è¡Œdebugè§ä¸‹å›¾ AutoConfigurationEntry autoConfigurationEntry = ((AutoConfigurationImportSelector) deferredImportSelector) .getAutoConfigurationEntry(getAutoConfigurationMetadata(), annotationMetadata); this.autoConfigurationEntries.add(autoConfigurationEntry); for (String importClassName : autoConfigurationEntry.getConfigurations()) &#123; this.entries.putIfAbsent(importClassName, annotationMetadata); &#125;&#125; ä»£ç ä¸­æ–­ç‚¹å¾—å‡ºçš„è‡ªåŠ¨å¯¼å…¥çš„åŒ…åç§°ï¼š é€šè¿‡æ–¹æ³•getConstructorArgumentValueså¾—åˆ°è‡ªåŠ¨é…ç½®çš„åŒ…çš„åç§°ï¼Œè°ƒç”¨äº†SpringFactoriesLoaderçš„æ–¹æ³•ï¼Œå…¶ä¸­ 123456789101112protected List&lt;String&gt; getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) &#123; List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(), getBeanClassLoader()); Assert.notEmpty(configurations, "No auto configuration classes found in META-INF/spring.factories. If you " + "are using a custom packaging, make sure that file is correct."); return configurations;&#125;// è°ƒç”¨loadFactoryNamesèŽ·å¾—ä¸€ç»„åŒ…åç§°public static List&lt;String&gt; loadFactoryNames(Class&lt;?&gt; factoryClass, @Nullable ClassLoader classLoader) &#123; String factoryClassName = factoryClass.getName(); return loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());&#125; æœ€åŽé€šè¿‡æ–‡ä»¶ä¸­spring.factorysæ–‡ä»¶ä¸­çš„å†…å®¹æ¥èŽ·å–æœ€ç»ˆçš„è‡ªåŠ¨å¯¼å…¥è‡ªåŠ¨é…ç½®ç±»åŒ…èŒƒå›´ã€‚ ComponentScanç»„ä»¶æ‰«ææŒ‡ä»¤ï¼Œéœ€è¦ä¸Ž@Configurationä¸€èµ·ä½¿ç”¨ã€‚ä¸ŽSpringæä¾›çš„xmlé…ç½®&lt;context:component-scan&gt;ä½œç”¨ç›¸åŒã€‚ åœ¨SpringBootApplicationæ³¨è§£ä¸­æ˜¯è¿™æ ·å®šä¹‰ComponentScançš„ï¼š 1234@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class)&#125;) excludeFiltersçš„ä½œç”¨æ˜¯æŒ‡å®šå“ªäº›ç±»åž‹ä¸ç¬¦åˆç»„ä»¶æ‰«æçš„æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯æŽ’é™¤æŽ‰æŒ‡å®šçš„ç±»ã€‚]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootä¸­ä½¿ç”¨é…ç½®]]></title>
    <url>%2F2019%2F07%2F07%2F2019-07-06-SpringBoot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[SpringBootä¸­ä½¿ç”¨é…ç½®ä¸€ã€é…ç½®æ–‡ä»¶SpringBootä½¿ç”¨å…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„ application.properties application.yml ä½¿ç”¨é…ç½®æ–‡ä»¶å¯ä»¥æ›´æ”¹ç³»ç»Ÿè‡ªåŠ¨é…ç½®çš„é»˜è®¤å€¼ï¼Œæ¯”å¦‚ç«¯å£å·ç­‰ä¿¡æ¯ã€‚ YAMLyamlä»¥æ•°æ®ä¸ºä¸­å¿ƒï¼Œæ¯”xmlï¼Œjsonæ›´é€‚åˆåšé…ç½®æ–‡ä»¶ã€‚ YAMLä¸Žpropertieså¯¹æ¯”YAML: 12server: port: 8080 properties: 1server.port: 8080 YAMLè¯­æ³• åŸºæœ¬è¯­æ³• k : v è¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹ ã€Œä¸­é—´éœ€è¦æœ‰ç©ºæ ¼ã€ï¼Œä»¥ç©ºæ ¼çš„ç¼©ç´§æ¥è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œä½¿ç”¨å·¦å¯¹å…¶çš„æ•°æ®éƒ½æ˜¯ä¸€ä¸ªå±‚çº§çš„ã€‚ ä¾‹å¦‚ä¸‹é¢ä»£ç ä¸­çš„portå’Œpathæ˜¯ä¸€ä¸ªå±‚çº§çš„ã€‚ 123server: port: 8081 path: /hello å€¼çš„å†™æ³• å­—é¢é‡ key : value å­—é¢é‡ç›´æŽ¥å†™ï¼Œå¹¶ä¸”å­—ç¬¦ä¸²ä¸éœ€è¦æ·»åŠ å¼•å·ï¼Œç±»ä¼¼propertiesã€‚å¦‚æžœæ·»åŠ å¼•å·ä¼šæœ‰ç‰¹æ®Šçš„æ„ä¹‰ã€‚ åŒå¼•å·ï¼š ä¸ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦å•å¼•å·ï¼š ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œæœ€ç»ˆä¼šè½¬ä¹‰æˆæ™®é€šçš„å­—ç¬¦ä¸²è¾“å‡º å¯¹è±¡ éžè¡Œå†…å†™æ³• -&gt; key : value å¯¹è±¡ä¸€æ ·æŒ‰ç…§keyï¼Œvalueæ¥å†™ 123person: firstName: zhang lastName: san è¡Œå†…å†™æ³• 1person:&#123;firstName: zhang,lastName: san&#125; æ•°ç»„ï¼ˆlistï¼Œsetï¼‰ ä½¿ç”¨ - æ¥è¡¨ç¤ºæ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´  1234person - zhangsan - lisi - wangwu ä½¿ç”¨ymlé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ç¼–å†™beanå¯¹è±¡12345678910111213141516171819202122232425262728293031import lombok.Data;import org.springframework.boot.context.properties.ConfigurationProperties;import org.springframework.stereotype.Component;/*** * å¦‚æžœéœ€è¦ä½¿ç”¨ConfigurationProperties è¿™ä¸ªæ³¨è§£éœ€è¦æ·»åŠ  * * &lt;dependency&gt; * &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; * &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; * &lt;optional&gt;true&lt;/optional&gt; * &lt;/dependency&gt; * * @Author nanyin * @Date 16:29 2019-07-07 * * ä½¿ç”¨Lombokçš„dataæ³¨è§£å¯ä»¥è‡ªåŠ¨çš„é…ç½® setterï¼Œgetterï¼ŒtoStringå±žæ€§ï¼Œ * ä½†æ˜¯éœ€è¦IDEçš„Lombokæ’ä»¶ **/@Data@ConfigurationProperties(value = "person")@Componentpublic class Person &#123; private String name; private int age; private User user;&#125;@Datapublic class User &#123; private int id;&#125; ä½¿ç”¨configurationPropertisé…ç½®ç±»æ ¹æ®beanå¯¹è±¡åœ¨application.ymlæ–‡ä»¶ä¸­ç¼–å†™å¦‚ä¸‹ymlå†…å®¹ï¼š 12345person: name: zhangsan age: 12 user: id: 1 ä½¿ç”¨SpringBootçš„å•å…ƒæµ‹è¯•åœ¨æµ‹è¯•æ–‡ä»¶å¤¹ä¸‹å»ºç«‹DeepSpringBootApplicationTestæµ‹è¯•ç±»ã€‚ 123456789101112131415161718/*** * ä½¿ç”¨springçš„æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨springçš„æ³¨å…¥åŠŸèƒ½ * è¿™é‡Œçš„runWithæ³¨è§£è¯´æ˜Žçš„æ˜¯è®©junitä½¿ç”¨Springçš„è¿è¡Œæµ‹è¯•æ–¹å¼ * ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä½¿ç”¨springçš„æ³¨å…¥ç­‰ç‰¹æ€§ * @Author nanyin * @Date 16:27 2019-07-07 **/@RunWith(SpringRunner.class)@SpringBootTestpublic class DeepSpringBootApplicationTest &#123; @Autowired Person person; @Test public void testPerson()&#123; System.out.println(person.toString()); &#125;&#125; å¦‚æžœéœ€è¦ä½¿ç”¨ä¸Šé¢çš„ä»£ç è¿›è¡ŒSpringBootçš„å•å…ƒæµ‹è¯•ï¼Œéœ€è¦åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 123456789101112131415161718&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-test&lt;/artifactId&gt; &lt;version&gt;5.1.8.RELEASE&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-test&lt;/artifactId&gt; &lt;version&gt;2.1.6.RELEASE&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt; æœ€åŽè¿è¡Œåˆšæ‰çš„æµ‹è¯•ç±»ï¼Œå¾—åˆ°çš„ç»“æžœæ˜¯ï¼š é€šè¿‡è¿è¡Œç»“æžœå¯çŸ¥é“ï¼Œä½¿ç”¨application.ymlæ–‡ä»¶ç¼–å†™é…ç½®ä¿¡æ¯æˆåŠŸçš„æ”¾åˆ°Personè¿™ä¸ªç±»ä¸­ã€‚ PropertySourceä¸Šé¢ä½¿ç”¨ymlæ–‡ä»¶ï¼Œé€šè¿‡configurationPropertiså¯¹Personè¿›è¡Œäº†é…ç½®ã€‚ configurationPropertiså®ƒä¼šä»Žå…¨å±€é…ç½®æ–‡ä»¶application.ymlé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ã€‚ä½†å¦‚æžœæŒ‡å®šæŸä¸ªå…·ä½“é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯PropertySourceæ³¨è§£ ä½¿ç”¨propertiesæ–‡ä»¶ åœ¨classpathè·¯å¾„ä¸‹æ–°å»ºè¦ä¸ªperson.propertiesæ–‡ä»¶,æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼› 123person.age= 12person.id= 2person.name=zhangsan åœ¨åŽŸæ¥çš„åŸºç¡€ä¸Šæ·»åŠ PropertySourceæ³¨è§£ 12345678910@Data// æŒ‡å®šä½¿ç”¨åˆ°çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œçš„valueå¯ä»¥æ˜¯æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶@PropertySource(value="classpath:person.properties")@ConfigurationProperties(value = "person")@Componentpublic class Person &#123; private String name; private int age; private User user;&#125; è¿è¡Œç»“æžœå’Œä¸Šé¢æµ‹è¯•ç»“æžœçš„ç›¸åŒã€‚ ä½¿ç”¨ymlæ–‡ä»¶ ä½¿ç”¨ymlæ–‡ä»¶ä½œä¸ºé…ç½®æ–‡ä»¶æ—¶ï¼Œä¸Žpropertiesæ–‡ä»¶ç•¥æœ‰ä¸åŒï¼Œæ˜¯å› ä¸ºPropertySourceå®žé™…ä¸Šä¸Šé»˜è®¤æ˜¯ä¸æ”¯æŒyamlæ–‡ä»¶çš„ã€‚æ‰€ä»¥å¦‚æžœä½¿ç”¨ymlæ–‡ä»¶å°±éœ€è¦ç•¥åŠ æ”¹é€ ã€‚ç»è¿‡ä¸€ç•ªè°·æ­ŒåŽã€‚ PropertySourceFactoryæ˜¯spring 4.3ä¹‹åŽå‡ºçŽ°çš„ä¸ºPropertySourceçš„å·¥åŽ‚æŽ¥å£ï¼Œæ³¨è§£é»˜è®¤ä½¿ç”¨çš„æ˜¯DefaultPropertySourceFactoryæ¥åˆ›å»ºResourcePropertySourceå¯¹è±¡ã€‚ springé€šè¿‡YamlPropertiesFactoryBeanæ¥åŠ è½½yamlæ–‡ä»¶ã€‚è¿™ä¸ªç±»å¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åŠ è½½ä¸ºjava.util.Propertieså¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627282930313233343536package com.nanyin.config;import org.springframework.beans.factory.config.YamlPropertiesFactoryBean;import org.springframework.core.env.PropertiesPropertySource;import org.springframework.core.env.PropertySource;import org.springframework.core.io.support.EncodedResource;import org.springframework.core.io.support.PropertySourceFactory;import org.springframework.lang.Nullable;import java.io.FileNotFoundException;import java.io.IOException;import java.util.Properties;public class YamlPropertiesFactory implements PropertySourceFactory &#123; @Override public PropertySource&lt;?&gt; createPropertySource(@Nullable String name, EncodedResource resource) throws IOException &#123; Properties propertiesFromYaml = loadYamlIntoProperties(resource); String sourceName = name != null ? name : resource.getResource().getFilename(); return new PropertiesPropertySource(sourceName, propertiesFromYaml); &#125; private Properties loadYamlIntoProperties(EncodedResource resource) throws FileNotFoundException &#123; try &#123; YamlPropertiesFactoryBean factory = new YamlPropertiesFactoryBean(); factory.setResources(resource.getResource()); factory.afterPropertiesSet(); return factory.getObject(); &#125; catch (IllegalStateException e) &#123; // for ignoreResourceNotFound Throwable cause = e.getCause(); if (cause instanceof FileNotFoundException) throw (FileNotFoundException) e.getCause(); throw e; &#125; &#125;&#125; å®žçŽ°ä¸Šè¿°ä»£ç åŽï¼Œåœ¨é…ç½®ç±»ä¸­çš„PropertySourceä¸­æ·»åŠ factory 1234567891011@PropertySource(value=&#123;"classpath:person.yml"&#125;, factory = YamlPropertiesFactory.class)@ConfigurationProperties(prefix = "person")@Component@Datapublic class Person &#123; private int id; private String name; private int age; private User user;&#125; yamlæ–‡ä»¶æ–‡ä»¶ä¸­çš„å†…å®¹.å…¶ä¸­ä½¿ç”¨${xxx}çš„ç»“æž„å¯ä»¥è°ƒç”¨å…¶ä»–å±žæ€§çš„å€¼ï¼Œè¿™é‡Œuserçš„idå€¼å°±æ˜¯ç›´æŽ¥ä½¿ç”¨personçš„idå€¼ã€‚ 123456person: age: 12 id: 2 name: zhangsan user: id: $&#123;person.id&#125; äºŒã€é…ç½®ç±»åœ¨åŽŸæ¥ä½¿ç”¨Springæ—¶ï¼Œç¹å¤šçš„xmlè®©äººå¤´ç–¼ã€‚è€Œåœ¨SpringBootä¸­ï¼ŒæŽ¨èä½¿ç”¨ç±»çš„æ–¹å¼ä»£æ›¿xmlç­‰é…ç½®æ–‡ä»¶ï¼Œæ”¹ç”¨æ³¨è§£çš„æ–¹å¼ã€‚ åˆ›å»ºä¸€ä¸ªç±»ï¼Œç±»åä¸ºMyConfig ä¸ºç±»æ ‡æ³¨ä¸º@Configuration å°†éœ€è¦å¼•å…¥åˆ°å®¹å™¨ä¸­çš„beanä½œä¸ºè¿”å›žå€¼å†™åˆ°æ–¹æ³•ä¸­ï¼Œå…¶ä¸­æ–¹æ³•çš„åç§°å°±æ˜¯å®¹å™¨ä¸­beançš„åç§°ã€‚ è¿›è¡Œæµ‹è¯•ï¼Œå®¹å™¨ä¸­åŠ è½½åˆ°äº†è¿™ä¸ªé…ç½®ç±»ä¸­é…ç½®çš„bean 1234567891011121314151617181920212223242526272829303132// æ ‡æ³¨@Configurationæ³¨è§£ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯Springçš„é…ç½®ç±»ï¼Œç”¨æ¥ä»£æ›¿é…ç½®æ–‡ä»¶å¦‚ xxx.xml@Configurationpublic class MyConfig &#123; @Autowired Person person; /** * ä½¿ç”¨@beanæ³¨è§£å‘å®¹å™¨ä¸­æ·»åŠ beanï¼Œç”¨æ¥æ›¿ä»£åŽŸæ¥xmlé…ç½®æ–‡ä»¶ä¸­çš„ *&lt;beans&gt; * &lt;context:annotation-config/&gt; * &lt;bean class="com.acme.AppConfig"/&gt; *&lt;/beans&gt; * å…¶ä¸­æ–¹æ³•çš„è¿”å›žå€¼æ˜¯æ·»åŠ åˆ°å®¹å™¨ä¸­çš„å†…å®¹ */ @Bean public HelloService helloService()&#123; // å¯ä»¥ä½¿ç”¨personçš„é…ç½®å€¼ System.out.println("åŠ è½½MyConfigé…ç½®æ–‡ä»¶ï¼ï¼ï¼ å…¶ä¸­é…ç½®æ–‡ä»¶ä¸­çš„ name å±žæ€§ï¼š" + person.getName()); return new HelloService() ; &#125;&#125;// SpringBootæµ‹è¯•public class DeepSpringBootApplicationTest &#123; @Autowired ApplicationContext ctx; @Test public void testContainsBean()&#123; System.out.println(ctx.containsBean("helloService")); &#125;&#125; å°†HelloServiceæ‰‹åŠ¨é€šè¿‡é…ç½®ç±»çš„æ–¹å¼æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Œä½œç”¨å’Œä½¿ç”¨xmlçš„æ–¹å¼ä¸€æ ·ï¼Œä½†æ˜¯æ›´ç®€å•ï¼Œæ›´å®¹æ˜“çœ‹æ‡‚ã€‚]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootä¸Žå¾®æœåŠ¡ç®€ä»‹]]></title>
    <url>%2F2019%2F07%2F06%2F2019-07-03-SpringBoot%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AE%80%E4%BB%8B%2F</url>
    <content type="text"><![CDATA[SpringBootä¸Žå¾®æœåŠ¡ç®€ä»‹SpringBooté€šè¿‡æ•´åˆSpringçš„å„ä¸ªæŠ€æœ¯æ ˆç”¨æ¥ç®€åŒ–Springåº”ç”¨å¼€å‘ï¼Œä½¿ç”¨çº¦å®šå¤§äºŽé…ç½®çš„æ€æƒ³ã€‚ç®€å•å¿«é€Ÿçš„åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ï¼Œäº§å“çº§çš„åº”ç”¨ã€‚ SpringBootä¼˜ç‚¹ å¿«é€Ÿåˆ›å»ºç‹¬ç«‹è¿è¡Œçš„Springé¡¹ç›®ä¸Žå„å¤§ä¸»æµæ¡†æž¶çš„é›†æˆã€‚ è‡ªå¸¦åµŒå…¥å¼çš„servletå®¹å™¨ã€‚ springbootå¸¦æœ‰startersè‡ªåŠ¨ä¾èµ–ä¸Žç‰ˆæœ¬æŽ§åˆ¶ã€‚ å¤§é‡çš„è‡ªåŠ¨é…ç½®ï¼Œçº¦å®šå¤§äºŽé…ç½®ã€‚ æ— éœ€é…ç½®xmlï¼Œå‘Šåˆ«å¤§é‡çš„xmlæ–‡ä»¶ã€‚ springbootçš„hello worldåˆ›å»ºä¸€ä¸ªmavenåº”ç”¨ åˆ›å»ºä¸€ä¸ªæ™®é€šçš„mavené¡¹ç›® åˆ›å»ºåŽçš„mavenç»“æž„ï¼ŒåŒ…å«pom.xmlæ–‡ä»¶å†…å®¹ å¼€å¯ideaä¸­å¯¹mavençš„è‡ªåŠ¨å¯¼å…¥åŠŸèƒ½ åœ¨POMæ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–12345678910111213141516171819&lt;!-- org.springframework.boot ä½œç”¨ï¼š 1. é»˜è®¤ä½¿ç”¨javaç‰ˆæœ¬,é»˜è®¤ç¼–ç  2. å¼•ç”¨ç®¡ç†çš„åŠŸèƒ½ï¼Œæ¯”å¦‚versionä¼šä»Žè¿™é‡Œç»§æ‰¿å‡ºåŽ» 3. è¯†åˆ«æ’ä»¶é…ç½® 4. è¯†åˆ«.properties å’Œ.ymlé…ç½®æ–‡ä»¶ 5. æ•´ä½“çš„ç‰ˆæœ¬ä¾èµ–--&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.1.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; åˆ›å»ºåº”ç”¨ä¸»ç¨‹åº12345678910111213141516171819import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.EnableAutoConfiguration;import org.springframework.boot.autoconfigure.SpringBootApplication;/** * EnableAutoConfiguration è¡¨ç¤ºå‘Šè¯‰spring bootå¦‚ä½•åŽ»é…ç½®springï¼Œ * å…¶å¯ä»¥å¸®åŠ© SpringBoot åº”ç”¨å°†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ @Configuration é…ç½®éƒ½åŠ è½½åˆ°å½“å‰ IoC å®¹å™¨ä¹‹ä¸­ * è‡ªä»Žæ·»åŠ spring-boot-starter-webè¿™ä¸ªstarteræ·»åŠ äº†tomcatå’Œspring MVCåŽï¼Œä½¿ç”¨è¯¥æ³¨è§£ï¼Œå°±è¯´æ˜Žä½¿ç”¨springå¯åŠ¨ä¸€ä¸ªwebé¡¹ç›® * SpringBootApplication ç­‰åŒäºŽä½¿ç”¨@Configuration @EnableAutoConfiguration @ComponentScanè¿™ä¸‰ä¸ªæ³¨è§£ * @Author nanyin * @Date 21:46 2019-07-04 **/@SpringBootApplicationpublic class DeepSpringBootApplication &#123; public static void main(String[] args) &#123; // ä½¿ç”¨SpringApplication.runæ–¹æ³•æ¥å¯åŠ¨spring bootåº”ç”¨ å…¶ä¸­å‚æ•°æœ‰ç±»å’Œargs SpringApplication.run(DeepSpringBootApplication.class,args); &#125;&#125; ä½¿ç”¨SPringMvcç¼–å†™controllerå±‚12345678910111213import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;@Controllerpublic class HelloController &#123; @RequestMapping("/hello") public @ResponseBody String home() &#123; return "Hello World!"; &#125;&#125; è¿è¡Œä¸»ç¨‹åºè¿›è¡Œæµ‹è¯•æ‰“å¼€http://localhost:8080/hello æŸ¥çœ‹ç½‘é¡µä¸Šçš„å†…å®¹æ˜¾ç¤ºå‡ºhello worldå­—ç¬¦ã€‚æµ‹è¯•æˆåŠŸ å¯¼å…¥mavenæ’ä»¶æ‰“jaråŒ…åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ 12345678&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; ä¿å­˜ä¹‹åŽä½¿ç”¨mvn packageå‘½ä»¤æ‰“æˆjaråŒ…ï¼Œå¯ä»¥åœ¨è¾“å‡ºä¿¡æ¯ä¸­æ‰¾å‡ºæ‰“å®Œçš„jaråŒ…çš„ä½ç½®ã€‚ä½¿ç”¨java -jar xxxxxx.jarå‘½ä»¤è¿è¡Œç¨‹åºã€‚ å¾®æœåŠ¡å¾®æœåŠ¡å…¶å®žæ˜¯ä¸€ç§æž¶æž„é£Žæ ¼ï¼Œä¸€ä¸ªåº”ç”¨åº”è¯¥æ˜¯ä¸€ç»„å°åž‹æœåŠ¡ç»„æˆï¼Œå°åž‹æœåŠ¡é€šè¿‡http apiçš„æ–¹å¼è¿›è¡Œæ²Ÿé€šã€‚æ¯ä¸€ä¸ªå°åž‹æœåŠ¡éƒ½æ˜¯ä¸€ä¸ªåŠŸèƒ½å…ƒç´ ï¼Œèƒ½å¤Ÿç‹¬ç«‹æ›¿æ¢å’Œç‹¬ç«‹å‡çº§çš„åº”ç”¨å•å…ƒã€‚ è¯¦ç»†è¯·å‚è€ƒmartinfowler.com ä¸­çš„è¿™ç¯‡å¾®æœåŠ¡æ–‡ç« ï¼šå¾®æœåŠ¡]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å‘½ä»¤æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F28%2F2019-06-28-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å‘½ä»¤æ¨¡å¼å‘½ä»¤æ¨¡å¼æ˜¯å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ï¼Œå‘½ä»¤æ¨¡å¼å°†ä¸€ä¸ªè¯·æ±‚å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œä»Žè€Œè®©ä½ ä½¿ç”¨ä¸åŒçš„è¯·æ±‚æŠŠå®¢æˆ·ç«¯å‚æ•°åŒ–ï¼Œå¯¹è¯·æ±‚æŽ’é˜Ÿæˆ–è€…è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œå¯ä»¥æä¾›å‘½ä»¤çš„æ’¤é”€å’Œæ¢å¤åŠŸèƒ½ã€‚ åº”ç”¨åœºæ™¯ é€šè¿‡è¦æ‰§è¡Œçš„æ“ä½œæ¥å‚æ•°åŒ–å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨å›žè°ƒå‡½æ•°åœ¨è¿‡ç¨‹è¯­è¨€ä¸­è¡¨è¾¾æ­¤ç±»å‚æ•°åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸ªå‡½æ•°å·²æ³¨å†Œåˆ°ç¨åŽè¦è°ƒç”¨çš„æŸä¸ªä½ç½®ã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥è¯´æ˜¯é¢å‘å¯¹è±¡çš„å›žè°ƒå‡½æ•°ã€‚èµ·åˆ°åœ¨ç‰¹å®šä½ç½®è¢«è°ƒç”¨çš„ç›®çš„ã€‚ åœ¨ä¸åŒçš„æ—¶é—´ä¸‹è¿›è¡Œå‘å‡ºè¯·æ±‚å’Œæ‰§è¡Œè¯·æ±‚ï¼Œå‘½ä»¤å¯¹è±¡å¯ä»¥ç‹¬ç«‹äºŽè¯·æ±‚ï¼Œæ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸã€‚å‘½ä»¤å…è®¸è¯·æ±‚çš„ä¸€æ–¹å’ŒæŽ¥æ”¶è¯·æ±‚çš„ä¸€æ–¹èƒ½å¤Ÿç‹¬ç«‹æ¼”åŒ–ã€‚ æ’¤é”€æ“ä½œï¼Œå‘½ä»¤æ¨¡å¼å¯ä»¥åœ¨å‘½ä»¤æ‰§è¡Œçš„æ—¶å€™å¯ä»¥åœ¨å‘½ä»¤ç±»ä¸­å­˜è´®å½“å‰çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡éåŽ†æ­¤åˆ—è¡¨å¹¶åˆ†åˆ«è½¬å‘è°ƒç”¨unexecuteå’Œexecuteæ¥å®žçŽ°æ— é™çº§åˆ«çš„æ’¤é”€å’Œé‡åšã€‚ å¯ä»¥æ›´å®¹æ˜“çš„å°†å‘½ä»¤è®°å½•åˆ°æ—¥å¿—ä¸­ã€‚ å‘½ä»¤æ¨¡å¼ä½¿æ–°çš„å‘½ä»¤å¾ˆå®¹æ˜“åœ°è¢«åŠ å…¥åˆ°ç³»ç»Ÿé‡Œã€‚å…·æœ‰å¾ˆå¥½çš„æ‹“å±•æ€§ã€‚ æ¨¡å¼ç»“æž„ å‘½ä»¤æ¨¡å¼æ¶‰åŠåˆ°äº”ä¸ªè§’è‰²ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š å®¢æˆ·ç«¯(Client)è§’è‰²ï¼šåˆ›å»ºä¸€ä¸ªå…·ä½“å‘½ä»¤(ConcreteCommand)å¯¹è±¡å¹¶ç¡®å®šå…¶æŽ¥æ”¶è€…ã€‚ å‘½ä»¤(Command)è§’è‰²ï¼šå£°æ˜Žäº†ä¸€ä¸ªç»™æ‰€æœ‰å…·ä½“å‘½ä»¤ç±»çš„æŠ½è±¡æŽ¥å£ã€‚ å…·ä½“å‘½ä»¤(ConcreteCommand)è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæŽ¥æ”¶è€…å’Œè¡Œä¸ºä¹‹é—´çš„å¼±è€¦åˆï¼›å®žçŽ°execute()æ–¹æ³•ï¼Œè´Ÿè´£è°ƒç”¨æŽ¥æ”¶è€…çš„ç›¸åº”æ“ä½œã€‚execute()æ–¹æ³•é€šå¸¸å«åšæ‰§è¡Œæ–¹æ³•ã€‚ è¯·æ±‚è€…(Invoker)è§’è‰²ï¼šè´Ÿè´£è°ƒç”¨å‘½ä»¤å¯¹è±¡æ‰§è¡Œè¯·æ±‚ï¼Œç›¸å…³çš„æ–¹æ³•å«åšè¡ŒåŠ¨æ–¹æ³•ã€‚ æŽ¥æ”¶è€…(Receiver)è§’è‰²ï¼šè´Ÿè´£å…·ä½“å®žæ–½å’Œæ‰§è¡Œä¸€ä¸ªè¯·æ±‚ã€‚ä»»ä½•ä¸€ä¸ªç±»éƒ½å¯ä»¥æˆä¸ºæŽ¥æ”¶è€…ï¼Œå®žæ–½å’Œæ‰§è¡Œè¯·æ±‚çš„æ–¹æ³•å«åšè¡ŒåŠ¨æ–¹æ³• ä»£ç æŠ½è±¡å‘½ä»¤è§’è‰²123public interface Command &#123; void excute();&#125; è¯·æ±‚è€…è§’è‰²12345678910111213// è¯·æ±‚è€…ç”¨æ¥è¯·æ±‚å‘½ä»¤public class King &#123; private Command command; public Command invoke(Command command)&#123; this.command = command; return this.command; &#125; public void action()&#123; command.excute(); &#125;&#125; æŽ¥æ”¶è€…è§’è‰²123456789101112131415public class Soldier &#123; // è¡ŒåŠ¨æ–¹æ³• public void prepareWeapon()&#123; System.out.println("Soldier prepare Weapon !!!"); &#125; public void attack()&#123; System.out.println("Soldier Attack!!!"); &#125; public void retreat()&#123; System.out.println("Soldier Retreat!!"); &#125;&#125; å…·ä½“å‘½ä»¤è€…è§’è‰²123456789101112131415public class AttackCommand implements Command&#123; Soldier soldier ; public AttackCommand(Soldier soldier) &#123; this.soldier = soldier; &#125; @Override public void excute() &#123; // æ”¶åˆ°è¯·æ±‚ï¼Œæ‰§è¡Œæ“ä½œ soldier.prepareWeapon(); soldier.attack(); &#125;&#125; å®¢æˆ·ç«¯ä»£ç 12345678910111213public class App &#123; public static void main(String[] args) &#123; // æŽ¥å—è€…å’Œè¯·æ±‚è€… King king = new King(); Soldier soldier = new Soldier(); // è¯·æ±‚è€…è¯·æ±‚å‘½ä»¤ king.invoke(new AttackCommand(soldier)); // è¯·æ±‚è€…å‘èµ·å‘½ä»¤ king.action(); king.invoke(new RetreatCommand(soldier)); king.action(); &#125;&#125;]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è¿­ä»£å™¨æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F27%2F2019-06-27-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è¿­ä»£å™¨æ¨¡å¼è¿­ä»£å™¨æ˜¯ä¸€ç§è¡Œä¸ºæ¨¡å¼ï¼Œå®ƒæä¾›ä¸€ç§é¡ºåºè®¿é—®èšåˆå¯¹è±¡å…ƒç´ çš„æ–¹æ³•ï¼Œè€Œä¸ä¼šæš´éœ²å…¶åŸºç¡€è¡¨ç¤ºã€‚ åº”ç”¨åœºæ™¯ æŒ‡å‘è®¿é—®é›†åˆå¯¹è±¡å†…å®¹ï¼Œè€Œä¸æš´éœ²å…¶å†…éƒ¨å®žçŽ°ã€‚ å¯ä»¥å¯¹é›†åˆå¯¹è±¡å¤šæ¬¡éåŽ† ä¸ºä¸åŒé›†åˆå¯¹è±¡æä¾›ç»Ÿä¸€çš„éåŽ†æŽ¥å£ æ¨¡å¼ç»“æž„è¿­ä»£å™¨æ¨¡å¼å¤§è‡´åˆ†ä¸ºå››ä¸ªè§’è‰²ï¼šæŠ½è±¡å®¹å™¨ï¼Œå…·ä½“å®¹å™¨ï¼ŒæŠ½è±¡è¿­ä»£å™¨ï¼Œå…·ä½“è¿­ä»£å™¨ã€‚ç»“æž„å›¾å¦‚ä¸‹ï¼š å®¹å™¨ä¸€èˆ¬ä¸ºä¸€ç§æ•°æ®ç»“æž„çš„ç±»ï¼Œä¾‹å¦‚listã€mapã€‚ è¿­ä»£å™¨æ˜¯æä¾›éåŽ†è¿™ä¸ªæ•°æ®ç»“æž„çš„æ–¹æ³•çš„ç±»ã€‚ ä»£ç åœ¨javaä¸­æä¾›å¾ˆå¤šIteratorçš„æ¨¡å¼ã€‚ä¾‹å¦‚ 1234567891011public class example &#123; public static void main(String[] args) &#123; List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); list.add(1); list.add(2); Iterator iterator = (Iterator) list.iterator(); while (iterator.hasNext())&#123; System.out.println(iterator.next()); &#125; &#125;&#125; è¿™é‡Œçš„ArrayListç±»ä¸­å®žçŽ°ç±»IteratoræŽ¥å£çš„å†…éƒ¨ç±»ï¼Œå¹¶ä¸”ä½¿ç”¨iterator()æ–¹æ³•è°ƒç”¨new Itr();ï¼Œå…·ä½“å†…å®¹å¯ä»¥æŸ¥çœ‹ArrayListæºç ã€‚ ä¸‹é¢è‡ªå·±å®žçŽ°ä¸€ä¸ªç®€å•çš„Iterator. ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡è¿­ä»£å™¨1234public interface Iterator&lt;E&gt; &#123; boolean hasNext(); E next();&#125; ç¬¬äºŒéƒ¨åˆ†ï¼šæŠ½è±¡å®¹å™¨ç±»12345public interface Task &#123; void add(int mark); void removeLast(); Iterator&lt;Object&gt; iterator();&#125; ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®žçŽ°ç±»123456789101112131415161718192021222324252627282930313233343536373839404142public class MyTask implements Task &#123; private int size = 0 ; private Object[] taskTag = new Object[16]; @Override public void add(int mark) &#123; taskTag[size] = mark; size ++; &#125; @Override public void removeLast() &#123; taskTag[--size] = null; &#125; @Override public Iterator&lt;Object&gt; iterator() &#123; // è°ƒç”¨å†…éƒ¨ç±»å®žçŽ°è¿­ä»£å™¨ return new MyTaskItr(); &#125; // ä½¿ç”¨å†…éƒ¨ç±»å®žçŽ°è¿­ä»£å™¨ private class MyTaskItr implements Iterator&lt;Object&gt;&#123; private int curr; @Override public boolean hasNext() &#123; return size != curr; &#125; @Override public Object next() &#123; int i = curr; if(i &gt;= size)&#123; throw new NoSuchElementException("no element"); &#125; return taskTag[curr++]; &#125; &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨1234567891011121314151617public class App &#123; public static void main(String[] args) &#123; Task task = new MyTask(); task.add(1); task.add(3); task.add(4); task.add(2); task.removeLast(); task.removeLast(); task.add(5); Iterator taskIterator = task.iterator(); while(taskIterator.hasNext())&#123; System.out.println(taskIterator.next()); &#125; // ç»“æžœä¾æ¬¡æ‰“å°å‡º 1ï¼Œ3ï¼Œ5 &#125;&#125; ç®€å•è€Œå¼ºå¤§çš„è¿­ä»£å™¨æ¨¡å¼ã€‚]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PlantUMLç±»å›¾ä½¿ç”¨æ€»ç»“]]></title>
    <url>%2F2019%2F06%2F26%2F2019-06-26-PlantUML%E7%B1%BB%E5%9B%BE%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨PlantUMLç»˜åˆ¶ç±»å›¾æœ¬æ–‡åŸºäºŽPlantUMLå®˜ç½‘ç»˜åˆ¶ç±»å›¾å’Œç›¸å…³å¦‚ä½•æ­£ç¡®umlç±»å›¾ç›¸å…³æ–‡ç« ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨plantUmlåŽŸå› å¾ˆç®€å•ï¼Œä¸ç”¨è‡ªå·±è€ƒè™‘æž„å›¾ï¼Œåƒå†™ä»£ç ä¸€æ ·å†™å‡ºæ¥ï¼Œå›¾å‡ºæ¥æ—¢ç¾Žè§‚åˆèƒ½å¤Ÿç¬¦åˆé€»è¾‘ã€‚ åŸºæœ¬ç±»æž„æˆåŸºæœ¬ä½¿ç”¨ ä½¿ç”¨classå…³é”®å­—æž„ä»¶ç±»ï¼ŒåŒç†å…¶ä»–å…³é”®å­—ã€‚å¦‚interface,enumã€‚ åœ¨ç±»ä¸­ä½¿ç”¨ - # + åˆ†åˆ«å¯¹åº”è¡¨ç¤ºç±»ä¸­çš„private,protected,publicã€‚å¦‚æžœåœ¨ç±»ä¸­ä½¿ç”¨ staticã€abstractå…³é”®å­—ï¼Œéœ€è¦ä½¿ç”¨å¤§æ‹¬å·åŒ…è£¹èµ·æ¥ã€‚ å¤‡æ³¨ä½¿ç”¨noteæ¥å®žçŽ°ï¼Œå¯ä»¥ä½¿ç”¨jsä¼˜åŒ–å¤‡æ³¨çš„æ ·å¼,å…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç ã€‚ 123456789101112131415161718192021222324@startuml&apos; ç®€å•å®šä¹‰ç±»Aclass classA&apos;å®šä¹‰ç±»Bclass classB&#123; -&#123;static&#125; STATIC:Type -a:A #b:B +c:C +hello():void -word():void&#125;&apos;æŠ½è±¡ç±»Cabstract class classC &#123; + &#123;abstract&#125; method1:void&#125;&apos;å¤‡æ³¨note right: note on rightnote top of classA : note on top&apos; å¤æ‚å¤‡æ³¨note top of objectIn java, &lt;size:18&gt;every&lt;/size&gt; &lt;u&gt;class&lt;/u&gt;&lt;b&gt;extends&lt;/b&gt;&lt;i&gt;this&lt;/i&gt; one.end note@enduml ç±»æ›´å¤šä½¿ç”¨ æ›´å¤æ‚ä¸€äº›çš„ç±»çš„æž„ä»¶å‚è€ƒä¸Šå›¾ã€‚ ä½¿ç”¨__å†…å®¹__æ¥è¡¨ç¤ºåˆ†å‰²çº¿ï¼Œå¯¹ä¸åŒç±»åž‹çš„è¿›è¡Œåˆ†å‰²ã€‚åœ¨ç±»ååŽåŠ &lt;? extends xxx&gt; è¡¨ç¤ºèŒƒåž‹,å‚è€ƒä¸‹é¢ä»£ç ï¼š 123456789101112131415@startumlclass classC &lt;&lt;Serializable&gt;&gt; &#123;__variable__ -a:A #b:B +c:C__methods__ +hello():void -word():void&#125;class classD &lt;? extends List&gt;&#123;&#125;@enduml å…³ç³»è¡¨ç¤ºç»§æ‰¿ä¸Žå®žçŽ° ç»§æ‰¿æŒ‡çš„å°±æ˜¯æ³›åŒ–ï¼Œå¦‚å›¾ä¸­å·¦è¡¨ç¤ºä¸€æ ·ï¼Œç±»Aç»§æ‰¿äºŽBï¼Œç”±å­ç±»å®žçŽ°çˆ¶ç±»çš„è¡Œä¸ºã€‚æ³›åŒ–ä½¿ç”¨å¸¦å¤§ä¸‰è§’ç®­å¤´å’Œå®žçº¿æ¥è¡¨ç¤ºï¼Œè¡¨ç¤ºä¸€ç§ç»§æ‰¿å…³ç³»ã€‚ å®žçŽ°æŒ‡çš„æ˜¯ç‰¹å®šç±»å®žçŽ°æŽ¥å£ï¼Œå¦‚å›¾ä¸­å³è¡¨ç¤ºä¸€æ ·ï¼Œç±»implementå®žçŽ°interface,è¡¨ç¤ºå®žçŽ°ç±»å®žçŽ°æŽ¥å£ç±»çš„å…³ç³»ã€‚åŒæ ·ä¼šç”±å­ç±»å®žçŽ°æŽ¥å£ç±»ä¸­çš„è¡Œä¸ºã€‚å®žçŽ°ä½¿ç”¨å¸¦å¤§ä¸‰è§’çš„ç®­å¤´å’Œè™šçº¿æ¥å®žçŽ°ã€‚ æ— è®ºæ˜¯ç»§æ‰¿è¿˜æ˜¯å®žçŽ°ï¼Œç®­å¤´éƒ½æ‰§è¡Œå¤«ç±»ï¼Œä¹Ÿå°±æ˜¯è¢«å®žçŽ°ç±»ã€‚ ä¾èµ–ä¸Žå…³è” ä½¿ç”¨plantUMLä»£ç å®žçŽ°ï¼š 1234567891011121314151617181920212223242526@startuml&apos;ä¾èµ–ä¸Žå…³è”Class X&apos; ä¾èµ–å…³ç³»X ..&gt; Y :&quot;ä¾èµ–å…³ç³»&quot;class A&apos; å•å‘å…³è” Aå…³è”BA--&gt; B :&quot;å•å‘å…³è”&quot;&apos; åŒå‘å…³è”class CC -- D : &quot;åŒå‘å…³è”&quot;&apos; è‡ªå…³è”class FF --&gt; F:&quot;è‡ªå…³è”&quot;&apos; èšåˆå…³ç³»class G &#123;List&lt;H&gt; h&#125;G &quot;n&quot; o-- &quot;1&quot; H : &quot;ç»„åˆå…³ç³»&quot;&apos; ç»„åˆå…³ç³»class K &#123;List&lt;L&gt; l&#125;K &quot;n&quot;*--&quot;1&quot; L :&quot;èšåˆå…³ç³»&quot;@enduml ä¸€ã€ä¾èµ–å…³ç³»ä¾èµ–æ˜¯ä¸€ç§ä½¿ç”¨çš„å…³ç³»ï¼Œä»£ç ä¸­ä½“çŽ°åˆ°ä¾èµ–çš„å…³ç³»çš„æƒ…å†µ:å±€éƒ¨å˜é‡ã€æ–¹æ³•çš„å‚æ•°æˆ–è€…å¯¹é™æ€æ–¹æ³•çš„è°ƒç”¨,ä¾èµ–æ˜¯æœ€å¼±çš„ä¸€ç§å…³è”ã€‚ä¾èµ–å…³ç³»ä½¿ç”¨è™šçº¿å’Œæ™®é€šçš„å°ç®­å¤´æ¥å®žçŽ°ï¼Œç®­å¤´æŒ‡å‘è¢«ä¾èµ–çš„å¯¹è±¡ã€‚å¦‚å›¾ä¸­çš„xä¾èµ–yä¸€æ ·ï¼Œæ‰€ä»¥æŒ‡å‘y,è¿™ä¸ªè¢«xä¾èµ–çš„å¯¹è±¡ã€‚ äºŒã€å…³è”å…³ç³»å…³è”æ˜¯æ‹¥æœ‰çš„å…³ç³»ï¼Œå¦‚çŽ©å®¶ä¸Žæ¸¸æˆä¸­çš„è§’è‰²ä¸€æ ·ã€‚å…³è”å¯èƒ½æ˜¯å•å‘çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯åŒå‘çš„ï¼Œä¹ŸåŒæ ·èƒ½å¤Ÿè‡ªå·±å…³è”è‡ªå·±ã€‚ä»£ç ä¸­ä½“çŽ°åˆ°å…³è”çš„å…³ç³»çš„æƒ…å†µï¼šæˆå‘˜å˜é‡ã€‚å…³è”å…³ç³»ä½¿ç”¨å®žçº¿å’Œå°å°–å¤´æ¥å®žçŽ°ï¼Œç®­å¤´æŒ‡å‘è¢«å…³è”çš„å¯¹è±¡ã€‚ ä¸‰ã€ç»„åˆå…³ç³»ç»„åˆå…³ç³»æ˜¯æ•´ä½“ä¸Žéƒ¨åˆ†çš„å…³ç³»ï¼Œä½†æ˜¯å¦‚æžœæ•´ä½“ä¸å­˜åœ¨ï¼Œé‚£éƒ¨åˆ†ä¹Ÿä¸èƒ½å­˜åœ¨ã€‚å°±å¦‚åŒå…¬å¸ä¸Žéƒ¨é—¨ä¸€æ ·ï¼Œå…¬å¸è§£æ•£äº†ï¼Œéƒ¨é—¨ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚å’Œå…³è”å…³ç³»ç›¸åŒï¼Œåœ¨ä»£ç ä¸­çš„ä½“çŽ°ä¹Ÿæ˜¯æˆå‘˜å˜é‡ã€‚ç»„åˆå…³ç³»ä½¿ç”¨ç©ºå¿ƒçš„è±å½¢å’Œå®žçº¿æ¥è¡¨ç¤ºã€‚ å››ã€èšåˆå…³ç³»èšåˆå…³ç³»æ˜¯æ•´ä½“ä¸Žéƒ¨åˆ†çš„å…³ç³»ï¼Œä½†æ˜¯å’Œç»„åˆå…³ç³»ä¸åŒçš„æ˜¯ï¼Œèšåˆå…³ç³»ä¸­çš„éƒ¨åˆ†å¯ä»¥è„±ç¦»æ•´ä½“è€Œå­˜åœ¨ï¼Œå°±å¦‚åŒéº¦å½“åŠ³ä¸­çš„å¥—é¤ä¸Žæ±‰å ¡ä¸€æ ·ã€‚åœ¨ä»£ç ä¸­çš„ä½“çŽ°åŒæ ·æ˜¯æˆå‘˜å˜é‡ã€‚èšåˆå…³ç³»ä½¿ç”¨å®žå¿ƒçš„è±å½¢å’Œå®žçº¿æ¥è¡¨ç¤ºã€‚ æ‰€ä»¥å¯ä»¥è¯´èšåˆå…³ç³»å’Œç»„åˆå…³ç³»æ˜¯å…³ç³»æ›´åŠ ç¡®å®šï¼Œæ›´åŠ ç´§å¯†çš„å…³è”å…³ç³»ã€‚ å„å…³ç³»çš„å¼ºå¼±é¡ºåº æ³›åŒ–= å®žçŽ°&gt; ç»„åˆ&gt; èšåˆ&gt; å…³è”&gt; ä¾èµ– PlantUMLæ”¯æŒæ›´å¤šçš„æ›´å¤æ‚çš„æƒ…æ™¯ä¸‹çš„å›¾å½¢ç»˜åˆ¶ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹PlantUMLçš„ä¸­æ–‡ç½‘ç«™ã€‚]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>å·¥å…·</tag>
        <tag>UML</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å¤‡å¿˜å½•æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F25%2F2019-06-25-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å¤‡å¿˜å½•æ¨¡å¼ðŸ“•ä¸è¿åå°è£…çš„æƒ…å†µä¸‹ï¼Œæ•èŽ·å¹¶å¤–åŒ–å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»¥ä¾¿ç¨åŽå¯ä»¥å°†å¯¹è±¡æ¢å¤åˆ°æ­¤çŠ¶æ€ã€‚ åº”ç”¨åœºæ™¯å¿…é¡»ä¿å­˜å¯¹è±¡çŠ¶æ€çš„å¿«ç…§ï¼Œä»¥ä¾¿ä»¥åŽå¯ä»¥å°†å…¶æ¢å¤åˆ°è¯¥çŠ¶æ€ æ¨¡å¼ç»“æž„æ¨¡å¼ç»“æž„åˆ†ä¸ºä¸‰ç§ç»“æž„ï¼š å‘èµ·äºº (Originator)è´Ÿè´£åˆ›å»ºä¸€ä¸ªæœ‰å†…éƒ¨çŠ¶æ€çš„å¤‡å¿˜å½•å¯¹è±¡ã€‚ è´Ÿè´£äºº (Caretaker)è´Ÿè´£ä¿å­˜å¤‡å¿˜å½•å†…å®¹ï¼Œä½†æ˜¯ä¸æ£€æŸ¥å¤‡å¿˜å½•çš„å†…å®¹ã€‚ å¤‡å¿˜å½• (Memento)ä¿å­˜å‘èµ·äººçš„å†…éƒ¨çš„çŠ¶æ€ã€‚ ä¸Šå›¾ä¸­çš„ActionGameä¸ºè´Ÿè´£äººï¼Œè´Ÿè´£ä¿å­˜çŠ¶æ€ï¼ŒPlayerä¸ºå‘èµ·äººè´Ÿè´£ä¸»åŠ¨è®°å½•å¤‡å¿˜å½•ã€‚ å®žé™…åœºæ™¯åœ¨çŽ©å•æœºæ¸¸æˆçš„æ—¶å€™ï¼Œåœ¨é€šè¿‡ä¸€ä¸ªå…³å¡çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè®°å½•ä½ å½“æ—¶çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚æžœä¸‹ä¸€å…³æ²¡é€šè¿‡ï¼Œä¼šè‡ªåŠ¨è¿˜åŽŸåˆ°ä¸Šä¸€ä¸ªè®°å½•ç‚¹ä»Žæ–°å¼€å§‹ã€‚è¿™ç§æƒ…å†µä¸‹å°±å¯ä»¥ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼è®°å½•å­˜æ¡£çŠ¶æ€ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™è¿˜åŽŸçŠ¶æ€ã€‚é’ˆå¯¹æ­¤å¤„åœºæ™¯ï¼Œä½¿ç”¨ä¸‹é¢ä»£ç è¿˜åŽŸã€‚ ä»£ç ä½œä¸ºå‘èµ·è€…çš„Player12345678910111213141516171819202122232425262728public class Player &#123; // æ¸¸æˆçŠ¶æ€ private GameState gameState; Player(GameState gameState) &#123; this.gameState = gameState; &#125; // è®¾ç½®çŠ¶æ€ void setGameState(GameState gameState) &#123; this.gameState = gameState; &#125; //èŽ·å–çŠ¶æ€ GameState getGameState() &#123; return gameState; &#125; // åˆ›å»ºå­˜æ¡£è®°å½• Memento createMemento()&#123; return new Memento(gameState); &#125; // å›žé€€å­˜æ¡£è®°å½• void retrieveMemento(Memento memento)&#123; this.gameState = memento.getGameState(); &#125;&#125; ä½œä¸ºè´Ÿè´£äººçš„ActionGame123456789101112131415161718192021222324252627282930public interface Game &#123; void storeGamePoint(Memento memento); Memento retrieveGamePoint();&#125;public class ActionGame implements Game &#123; private Memento memento; /** * å­˜æ¡£è®°å½• * @Author nanyin * @Date 17:31 2019-06-26 * @param memento 1 * @return void **/ @Override public void storeGamePoint(Memento memento) &#123; this.memento = memento; &#125; /** * è¿˜åŽŸè®°å½•ç‚¹ * @Author nanyin * @Date 17:32 2019-06-26 * @return Memento **/ @Override public Memento retrieveGamePoint() &#123; return this.memento; &#125;&#125; ä½œä¸ºå¤‡å¿˜å½•çš„Memento1234567891011121314public class Memento &#123; private GameState gameState; Memento(GameState gameState) &#123; this.gameState = gameState; &#125; GameState getGameState() &#123; return gameState; &#125;&#125;public enum GameState &#123; DIE,SUCCESS&#125; å®¢æˆ·ç«¯ç¨‹åº1234567891011121314151617public class App &#123; public static void main(String[] args) &#123; //åˆ›å»ºä¸€ä¸ªåŠ¨ä½œç±»åž‹çš„æ¸¸æˆ Game actionGame = new ActionGame(); //çŽ©å®¶é€šå…³ Player player = new Player(GameState.SUCCESS); //å­˜æ¡£ Memento memento = player.createMemento(); actionGame.storeGamePoint(memento); //æ­¤æ—¶çŽ©å®¶é˜µäº¡ player.setGameState(GameState.DIE); System.out.println(player.getGameState()); //éœ€è¦ä»Žä¸Šä¸€æ¬¡æ¸¸æˆå­˜æ¡£ä¸­åŠ è½½åŽŸæ¥çš„çŽ©å®¶çŠ¶æ€ player.retrieveMemento(actionGame.retrieveGamePoint()); System.out.println(player.getGameState()); &#125;&#125; åœ¨æ¸¸æˆå­˜æ¡£åŽæ­»äº¡ï¼Œå†é‡å¤è¯»å­˜æ¡£ï¼Œå¾—åˆ°ä¹‹å‰å­˜æ¡£ä¹‹å‰çš„çŠ¶æ€ã€‚æ¸¸æˆä¸ä¼šä¸»åŠ¨å­˜æ¡£å’Œè¯»å–å­˜æ¡£ï¼Œåªä¼šè®°å½•å­˜æ¡£ä¸­çš„å†…å®¹ï¼Œè€ŒçŽ©å®¶ä¼šä¸»åŠ¨ä»Žæ¸¸æˆä¸­è¯»å–å­˜æ¡£ï¼Œç„¶åŽæ¢å¤åˆ°å­˜æ¡£çš„çŠ¶æ€ã€‚]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹çŠ¶æ€æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F19%2F2019-06-19-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹çŠ¶æ€æ¨¡å¼çŠ¶æ€æ¨¡å¼æ˜¯å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚çŠ¶æ€æ¨¡å¼å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜çš„æ—¶å€™æ”¹å˜å…¶è¡Œä¸ºã€‚è¿™ä¸ªå¯¹è±¡çœ‹ä¸ŠåŽ»å°±åƒæ˜¯æ”¹å˜äº†å®ƒçš„ç±»ä¸€æ ·ã€‚ åº”ç”¨åœºæ™¯ å¯¹è±¡çš„è¡Œä¸ºå–å†³äºŽå…¶çŠ¶æ€ï¼Œå¹¶ä¸”å¿…é¡»æ ¹æ®è¯¥çŠ¶æ€åœ¨è¿è¡Œæ—¶æ›´æ”¹å…¶è¡Œä¸ºã€‚ é€šå¸¸ï¼Œå‡ ä¸ªæ“ä½œå°†åŒ…å«ç›¸åŒçš„æ¡ä»¶ç»“æž„ã€‚Stateæ¨¡å¼å°†æ¡ä»¶çš„æ¯ä¸ªåˆ†æ”¯æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­ã€‚å¯ä»¥å°†å¯¹è±¡çš„çŠ¶æ€è§†ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥ç‹¬ç«‹äºŽå…¶ä»–å¯¹è±¡è€Œå˜åŒ– æ¦‚æ‹¬æ¥è¯´ï¼ŒçŠ¶æ€æ¨¡å¼å°†è¡Œä¸ºåŒ…è£…åˆ°å…·ä½“çš„çŠ¶æ€å¯¹è±¡ä¸­ã€‚æ¯ä¸ªçŠ¶æ€å¯¹è±¡æ˜¯æŠ½è±¡çŠ¶æ€çš„å­ç±»ã€‚çŠ¶æ€æ¨¡å¼æ„å›¾æ˜¯åœ¨æ”¹å˜å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€çš„æ—¶å€™ï¼Œè¡Œä¸ºéšä¹‹æ”¹å˜ã€‚ æ¨¡å¼ç»“æž„çŠ¶æ€æ¨¡å¼åˆ†ä¸ºä¸‰ç§ç»“æž„ï¼šçŽ¯å¢ƒè§’è‰²ã€æŠ½è±¡çŠ¶æ€è§’è‰²ã€å…·ä½“çŠ¶æ€è§’è‰² ä»£ç ç”µç¯æœ‰ä¸¤ç§åŸºæœ¬è¡Œä¸º å¼€å¯ã€å…³é—­ã€‚ä½†æ˜¯æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œæ­£å¸¸å’ŒåæŽ‰çš„çŠ¶æ€ã€‚å°†å…±åŒçš„è¡Œä¸ºå°è£…åˆ°ç»Ÿä¸€çš„çŠ¶æ€æŽ¥å£ä¸­ï¼Œå†æ ¹æ®ä¸åŒçš„çŠ¶æ€ï¼Œåˆ›å»ºå­ç±»å®Œæˆä¸åŒçŠ¶æ€å½¢æˆä¸åŒçš„è¡Œä¸ºã€‚ ç¯å†æ­£å¸¸çŠ¶æ€ä¸‹èƒ½å¤Ÿæ­£å¸¸å¼€å¯ï¼Œæ­£å¸¸å…³é—­ã€‚ç­‰åœ¨åæŽ‰çš„çŠ¶æ€ä¸‹ï¼Œä¸èƒ½å¼€å¯å’Œå…³é—­ã€‚çŠ¶æ€æ¨¡å¼å°±æ˜¯æ ¹æ®è¿™ä¸ªé€»è¾‘æŠ½ç¦»è¡Œä¸ºï¼Œå°†å…·ä½“è¡Œä¸ºåŒ…è£…åˆ°å…·ä½“çŠ¶æ€å¯¹è±¡ä¸­ã€‚ æŠ½è±¡çŠ¶æ€è§’è‰²1234public interface State &#123; void open(); void close();&#125; å…·ä½“çŠ¶æ€è§’è‰²1234567891011121314151617181920212223public class NormalState implements State&#123; @Override public void open() &#123; System.out.println("ç”µç¯å¼€äº†ï¼"); &#125; @Override public void close() &#123; System.out.println("ç”µç¯å…³äº†ï¼"); &#125;&#125;public class ErrorState implements State &#123; @Override public void open() &#123; System.out.println("ç”µç¯å¼€ä¸äº†ï¼"); &#125; @Override public void close() &#123; System.out.println("ç”µç¯å…³ä¸äº†ï¼"); &#125;&#125; çŽ¯å¢ƒè§’è‰²12345678910111213141516171819public class Context &#123; //çŠ¶æ€å‚æ•° State state; public Context(State state) &#123; this.state = state; &#125; public void requestToOpen() &#123; state.open(); &#125; public void requestToClose() &#123; state.close(); &#125; //çŠ¶æ€å˜åŒ– public void changeStageTo(State state)&#123; this.state = state; &#125;&#125; å®¢æˆ·ç«¯æµ‹è¯•1234567891011public class App &#123; public static void main(String[] args) &#123; Context context = new Context(new NormalState()); context.requestToOpen(); context.requestToClose(); //å°†çŠ¶æ€å˜æ›´ä¸ºåçš„çŠ¶æ€ context.changeStageTo(new ErrorState()); context.requestToOpen(); context.requestToClose(); &#125;&#125;]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F19%2F2019-06-24-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼è§‚å¯Ÿè€…æ¨¡å¼æ˜¯å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ï¼Œåˆå«â€œå‘å¸ƒ-è®¢é˜…æ¨¡å¼â€ã€‚ç”±åå­—å°±èƒ½å¤Ÿå¾—çŸ¥ï¼Œè§‚å¯Ÿè¿™æ¨¡å¼æž„é€ äº†ä¸€ä¸ªå‘å¸ƒè€…å’Œè®¢é˜…è€…ã€‚ è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œä»¥ä¾¿å½“ä¸€ä¸ªå¯¹è±¡æ›´æ”¹çŠ¶æ€æ—¶ï¼Œå°†è‡ªåŠ¨é€šçŸ¥å’Œæ›´æ–°å…¶æ‰€æœ‰ä¾èµ–é¡¹ã€‚åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œä¸»åŠ¨å‘ç”Ÿæ”¹å˜çš„æ˜¯å‘å¸ƒè€…ç§°ä¸ºä¸»é¢˜ï¼Œè€Œè¢«åŠ¨æ”¶åˆ°å‘å¸ƒè€…ä¿¡æ¯çš„è®¢é˜…è€…ç§°ä¸ºè§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ /å‡å°‘å…·ä½“ä¸»é¢˜çš„è§‚å¯Ÿè€…ï¼Œå®žçŽ°ä¸»é¢˜å’Œè§‚å¯Ÿè€…ä¹‹é—´çš„æ¾è€¦åˆã€‚ åº”ç”¨åœºæ™¯ å½“è®¾è®¡ä¸­æœ‰ä¸¤ç§ä¸åŒæ–¹é¢çš„æŠ½è±¡ï¼Œå¹¶ä¸”æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ï¼Œè¿™æ—¶å°†ä¸¤ä¸ªæŠ½è±¡åˆ†åˆ«å°è£…åˆ°å…·ä½“çš„ç±»ä¸­ï¼Œè¿™æ ·å°±èƒ½å¤Ÿç‹¬ç«‹çš„æ”¹å˜å’Œé‡ç”¨è¿™äº›å¯¹è±¡ã€‚åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ä¸¤ç§æŠ½è±¡æŒ‡çš„å°±æ˜¯æŠ½è±¡ä¸»é¢˜å’ŒæŠ½è±¡è§‚å¯Ÿè€…ã€‚ å½“ä¸€ä¸ªå¯¹è±¡éœ€è¦æ›´æ”¹æ—¶ï¼Œæ¶‰åŠåˆ°æ›´æ”¹å…¶ä»–ç±»åž‹çš„å…¶ä»–å¯¹è±¡ï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡çš„æ•°é‡å¤šä¸”ä¸ç¡®å®šçš„æ—¶å€™ã€‚ å½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜æ—¶ï¼Œå…¶ä»–å¯¹è±¡èƒ½å¤Ÿå¾—åˆ°è¿™ä¸ªå¯¹è±¡å·²ç»æ”¹å˜çš„é€šçŸ¥ï¼Œè€Œä¸å¿…çŸ¥é“è¿™äº›å¯¹è±¡å…·ä½“æ˜¯ä»€ä¹ˆã€‚ä¹Ÿå°±æ˜¯è¯´è¦è¾¾åˆ°è¿™ä¸ªæ”¹å˜çš„å¯¹è±¡å’Œé€šçŸ¥çš„å¯¹è±¡çš„æ¾è€¦åˆã€‚ æ‰€ä»¥ç»¼ä¸Š: å½“å¸Œæœ›ä¸€ä¸ªå¯¹è±¡æ”¹å˜çš„åŒæ—¶ï¼Œå¤šä¸ªå¯¹è±¡èƒ½å¤Ÿå¾—åˆ°é€šçŸ¥ï¼Œä¸€å—è¿›è¡Œå˜æ›´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼å¯¹ç³»ç»Ÿè®¾è®¡ æ¨¡å¼ç»“æž„ ä¸Šå›¾ä¸­ï¼š Weatherä¸ºæŠ½è±¡ä¸»é¢˜ç±»ï¼Œèƒ½å¤Ÿå°†è§‚å¯Ÿè€…Observeræž„æˆä¸€ä¸ªlistç»“æž„,ä»Žè€Œèƒ½å¤Ÿè¾¾åˆ°Weatheræ”¹å˜çš„æ—¶å€™å¯ä»¥å¾ªçŽ¯è¡¨ä¸­çš„è§‚å¯Ÿè€…ï¼Œå‘é€é€šçŸ¥ã€‚å¹¶ä¸”ä½œä¸ºæŠ½è±¡ç±»å®žçŽ°äº†æ·»åŠ ï¼Œç§»é™¤è§‚å¯Ÿè€…æ–¹æ³•ã€‚ BeijingWeatherä¸ºå…·ä½“ä¸»é¢˜ç±»ï¼Œå®žçŽ°äº†Weatherç±»ã€‚ Observerä½œä¸ºæŠ½è±¡è§‚å¯Ÿè€…ç±»ï¼Œä½œä¸ºæ‰€æœ‰è§‚å¯Ÿè€…çš„é€šç”¨æŽ¥å£ï¼Œå…¶ä¸­å®šä¹‰updateæ–¹æ³•ä½œä¸ºæ›´æ–°çŠ¶æ€çš„æŽ¥å£ã€‚é€šè¿‡è¿™ä¸ªæŽ¥å£å’ŒWeatherç±»äº¤äº’æ¥èŽ·å–çŠ¶æ€é€šçŸ¥ã€‚ WeatherObserverAä¸ŽWeatherObserverBä½œä¸ºå…·ä½“è§‚å¯Ÿè€…ç±»ï¼Œå®žçŽ°ç±»è§‚å¯Ÿè€…æŽ¥å£ã€‚ç»Ÿä¸€æŽ¥å—é€šçŸ¥å¹¶æ›´æ–°è‡ªèº«çŠ¶æ€ã€‚ ä»£ç ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡ä¸»é¢˜ç±»123456789101112131415161718192021222324252627282930// çŠ¶æ€æžšä¸¾ç±»public enum WeatherState &#123; SUNNY_DAY, CLOUDY_DAY, RAINY_DAY,&#125;// æŠ½è±¡ä¸»é¢˜ç±»public abstract class Weather &#123; protected WeatherState weatherState; // è§‚å¯Ÿè€…é›†åˆ private List&lt;Observer&gt; observerList = new ArrayList&lt;&gt;(); public Weather addObserver(Observer observer)&#123; observerList.add(observer); return this; &#125; public void removeObserver(Observer observer)&#123; observerList.remove(observer); &#125; // é€šè¿‡ä¸»é¢˜æ›´æ”¹ä»Žè€Œåœ¨è¯¥ä¸»é¢˜ä¸Šæ³¨å†Œçš„è§‚å¯Ÿè€…èƒ½å¤ŸåŒæ—¶èƒ½åˆ°é€šçŸ¥ public void notifyObserver()&#123; for (Observer o:observerList ) &#123; o.update(this.weatherState); &#125; &#125;&#125; ç¬¬äºŒéƒ¨åˆ†ï¼šå…·ä½“ä¸»é¢˜ç±»12345678910public class BeijingWeather extends Weather &#123; BeijingWeather(WeatherState weatherState) &#123; this.weatherState = weatherState; &#125; //ä½œä¸ºæ›´æ–°ä¸»é¢˜çš„æŽ¥å£ public void changeState(WeatherState we)&#123; this.weatherState = we; &#125;&#125; ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ½è±¡è§‚å¯Ÿè€…1234public interface Observer &#123; // æ›´æ–°æŽ¥å£ void update(WeatherState weatherState);&#125; ç¬¬å››éƒ¨åˆ†ï¼š å…·ä½“è§‚å¯Ÿè€…123456public class WeatherObserverA implements Observer &#123; @Override public void update(WeatherState weatherState) &#123; System.out.println("observer A get new weather message is " + weatherState.toString()); &#125;&#125; æœ€åŽè°ƒç”¨12345678910public class App &#123; public static void main(String[] args) &#123; // å®šä¹‰ä¸»é¢˜ Weather weather = new BeijingWeather(WeatherState.SUNNY_DAY); //æ·»åŠ è§‚å¯Ÿè€… weather.addObserver(new WeatherObserverA()).addObserver(new WeatherObserverB()); //é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€… weather.notifyObserver(); &#125;&#125; ç»“æžœï¼šæœ€åŽæ³¨å†Œåœ¨ä¸»é¢˜ä¸Šçš„æ‰€æœ‰è§‚å¯Ÿè€…éƒ½æ”¶åˆ°äº†é€šçŸ¥ã€‚ 12observer A get new weather message is SUNNY_DAYobserver B get new weather message is SUNNY_DAY]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Macä¸‹ä½¿ç”¨ideaæ—¶åœ¨dockæ ä¸€ç›´å­˜åœ¨javaå›¾æ ‡å’ŒæŽ§åˆ¶å°ä¹±ç é—®é¢˜]]></title>
    <url>%2F2019%2F06%2F18%2F2019-06-18-Mac%E4%B8%8Bidea%E5%9C%A8Dock%E6%A0%8F%E4%B8%80%E7%9B%B4%E5%AD%98%E5%9C%A8%E5%9B%BE%E6%A0%87%E5%92%8C%E6%8E%A7%E5%88%B6%E5%8F%B0%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[Macä¸‹ä½¿ç”¨Ideaç›¸å…³é—®é¢˜ä½¿ç”¨tomcatå¯åŠ¨IDEAé¡¹ç›®åŽï¼Œdockæ ä¸€ç›´å­˜åœ¨JAVAå›¾æ ‡é—®é¢˜åœ¨macä¸Šå¯åŠ¨ideaåŽï¼Œå­˜åœ¨dockæ ä¸€ç›´å­˜åœ¨JAVAå›¾æ ‡çš„é—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼š è§£å†³æ–¹å¼ï¼š æ‰“å¼€Run/Debug configurations,åœ¨vm optionsä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 1-Dapple.awt.UIElement=true å¯åŠ¨IDEAåŽï¼ŒæŽ§åˆ¶å°ä¹±ç  è§£å†³æ–¹å¼å’Œä¸Šä¸€ä¸ªé—®é¢˜ç›¸åŒï¼ŒåŒæ ·åœ¨vm optionsä¸­å¢žåŠ å‚æ•°ï¼Œå…·ä½“å‚æ•°å¦‚ä¸‹ï¼š 1-Dfile.encoding=UTF-8]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>idea</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹æ¨¡ç‰ˆæ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F17%2F2019-06-17-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼æ¨¡ç‰ˆæ¨¡å¼æ˜¯ç±»çš„è¡Œä¸ºæ¨¡å¼ï¼Œå°†éƒ¨åˆ†é€»è¾‘ä»¥å…·ä½“æ–¹æ³•æ¥å®žçŽ°ï¼Œå°†å…¶ä»–æ–¹æ³•å£°æ˜Žä¸ºæŠ½è±¡æ–¹æ³•æ¥è®©å­ç±»æ¥å®žçŽ°ã€‚ä¸åŒçš„å­ç±»å®žçŽ°çš„æ–¹æ³•é€»è¾‘ä¸åŒï¼Œä»Žè€Œæ•´ä½“çš„é€»è¾‘æœ‰æ‰€å·®å¼‚ã€‚ è¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªè§’è‰²ï¼š ä¸€ã€æŠ½è±¡æ¨¡æ¿(Abstract Template)è§’è‰²æœ‰å¦‚ä¸‹è´£ä»»ï¼š - å®šä¹‰äº†ä¸€ä¸ªæˆ–å¤šä¸ªæŠ½è±¡æ“ä½œï¼Œä»¥ä¾¿è®©å­ç±»å®žçŽ°ã€‚è¿™äº›æŠ½è±¡æ“ä½œå«åšåŸºæœ¬æ“ä½œï¼Œ å®ƒä»¬æ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ç»„æˆæ­¥éª¤ã€‚ - å®šä¹‰å¹¶å®žçŽ°äº†ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚è¿™ä¸ªæ¨¡æ¿æ–¹æ³•ä¸€èˆ¬æ˜¯ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œå®ƒç»™å‡ºäº†ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„éª¨æž¶ï¼Œ è€Œé€»è¾‘çš„ç»„æˆæ­¥éª¤åœ¨ç›¸åº”çš„æŠ½è±¡æ“ä½œä¸­ï¼ŒæŽ¨è¿Ÿåˆ°å­ç±»å®žçŽ°ã€‚é¡¶çº§é€»è¾‘ä¹Ÿæœ‰å¯èƒ½è°ƒç”¨ä¸€äº›å…·ä½“æ–¹æ³•ã€‚äºŒã€å…·ä½“æ¨¡æ¿(Concrete Template)è§’è‰²åˆå¦‚ä¸‹è´£ä»»ï¼š - å®žçŽ°çˆ¶ç±»æ‰€å®šä¹‰çš„ä¸€ä¸ªæˆ–å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ç»„æˆæ­¥éª¤ã€‚ - æ¯ä¸€ä¸ªæŠ½è±¡æ¨¡æ¿è§’è‰²éƒ½å¯ä»¥æœ‰ä»»æ„å¤šä¸ªå…·ä½“æ¨¡æ¿è§’è‰²ä¸Žä¹‹å¯¹åº”ï¼Œ è€Œæ¯ä¸€ä¸ªå…·ä½“æ¨¡æ¿è§’è‰²éƒ½å¯ä»¥ç»™å‡ºè¿™äº›æŠ½è±¡æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯é¡¶çº§é€»è¾‘çš„ç»„æˆæ­¥éª¤ï¼‰çš„ä¸åŒå®žçŽ°ï¼Œ ä»Žè€Œä½¿å¾—é¡¶çº§é€»è¾‘çš„å®žçŽ°å„ä¸ç›¸åŒã€‚åº”ç”¨åœºæ™¯ å®žçŽ°ä¸å˜çš„éƒ¨åˆ†ä¸€æ¬¡ï¼Œå¹¶å°†å…¶ä»–ç•™ç»™å­ç±»æ¥å®žçŽ°å¯èƒ½éœ€è¦å˜åŒ–çš„è¡Œä¸ºã€‚ éœ€è¦ç®€åŒ–ä»£ç ï¼Œåˆ†ç¦»å‡ºå…¬å…±çš„éƒ¨åˆ†ï¼ŒæŠ½ç¦»å‡ºä¸€ä¸ªå…¬å…±çš„æ¨¡æ¿æ–¹æ³•æ¥æ›¿æ¢æ‰€æœ‰çš„ä»£ç ã€‚ æŽ§åˆ¶å­ç±»æ‰©å±•ã€‚å®šä¹‰åœ¨ç‰¹å®šç‚¹è°ƒç”¨â€œé’©å­â€æ“ä½œçš„æ¨¡æ¿æ–¹æ³•ï¼Œä»Žè€Œä»…å…è®¸åœ¨é‚£äº›ç‚¹è¿›è¡Œæ‰©å±•ã€‚ æ¨¡å¼ç»“æž„è¿™é‡Œä½¿ç”¨åˆ°æ¨¡æ‹Ÿservletä¸­çš„httpServletæ–¹æ³•ï¼ˆç®€å•çš„æ¨¡æ‹Ÿæ–¹æ³•ä¸­ç”¨åˆ°çš„æ¨¡ç‰ˆæ–¹æ³•ï¼‰ã€‚å®šä¹‰ä¸€ä¸ªå…¬å…±çš„æ¨¡ç‰ˆæ–¹æ³•æŠ½è±¡ç±»HttpServletTemplateï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªé’©å­æ–¹æ³•doGetå’ŒdoPostï¼Œæ‰€è°“çš„é’©å­æ–¹æ³•å°±æ˜¯éœ€è¦ç”±å­ç±»å®žçŽ°çš„æ–¹æ³•ã€‚è¿˜æœ‰ä¸€ä¸ªå…·ä½“æ–¹æ³•serviceæ¥å®žçŽ°æ¨¡ç‰ˆè°ƒç”¨çš„ä½œç”¨ã€‚ æ¨¡æ‹Ÿä¸¤ä¸ªå­ç±»å®žçŽ°HttpServletTemplateå®žçŽ°ä¸¤ä¸ªé’©å­æ–¹æ³•ã€‚ å®¢æˆ·ç«¯Appåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œç›´æŽ¥è°ƒç”¨ä¸¤ä¸ªå­ç±»çš„çˆ¶ç±»ä¸­çš„å®žçŽ°æ–¹æ³•serviceå®žçŽ°è°ƒç”¨æ¨¡ç‰ˆã€‚ ä»£ç æŠ½è±¡æ¨¡ç‰ˆç±»1234567891011121314151617public abstract class HttpServletTemplate &#123; public void service(HttpRequestMethod method)&#123; if(method.equals(HttpRequestMethod.METHOD_GET))&#123; System.out.println("so something 1"); doGet(); System.out.println("so something 2"); &#125;else if(method.equals(HttpRequestMethod.METHOD_POST))&#123; doPost(); &#125;else &#123; System.out.println("do nothing!"); &#125; &#125; protected void doGet()&#123;&#125;; protected void doPost()&#123;&#125;;&#125; å…·ä½“æ¨¡ç‰ˆç±»123456789101112131415161718192021public class GetClient extends HttpServletTemplate &#123; @Override protected void doGet() &#123; System.out.println("this is my get methods!"); &#125;&#125;public class PostClient extends HttpServletTemplate &#123; @Override protected void doGet() &#123; this.doPost(); &#125; @Override protected void doPost() &#123; System.out.println("this is my post methods!"); &#125;&#125;// è¯·æ±‚ç±»åž‹æžšä¸¾ç±»public enum HttpRequestMethod &#123; METHOD_GET,METHOD_POST,METHOD_DELETE&#125; å®¢æˆ·ç«¯è°ƒç”¨1234567891011public class App &#123; public static void main(String[] args) &#123; //å£°æ˜Žpostå®¢æˆ·ç«¯ PostClient post = new PostClient(); //è°ƒç”¨æ¨¡ç‰ˆ post.service(HttpRequestMethod.METHOD_POST); GetClient get = new GetClient(); get.service(HttpRequestMethod.METHOD_GET); get.service(HttpRequestMethod.METHOD_POST); &#125;&#125; å…¶å®žæ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼æ˜¯åˆ›å»ºä¸€ä¸ªç®—æ³•çš„éª¨æž¶ï¼Œå…·ä½“çš„å†…å®¹ç”±å­ç±»åŽ»å¡«å……çš„è¿™ä¸ªè¿‡ç¨‹ã€‚]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è®¿é—®è€…æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F15%2F2019-06-15-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è®¿é—®è€…æ¨¡å¼è®¿é—®è€…æ¨¡å¼æ˜¯ä¸€ç§å¤æ‚çš„è¡Œä¸ºæ¨¡å¼ã€‚è¡¨ç¤ºè¦å¯¹å¯¹è±¡ç»“æž„çš„å…ƒç´ æ‰§è¡Œçš„æ“ä½œã€‚è®¿é—®è€…å…è®¸å¯¹å¯¹è±¡ç»“æž„ä¸­çš„èŠ‚ç‚¹å®šä¹‰æ–°æ“ä½œï¼Œè€Œæ— éœ€æ›´æ”¹å…¶æ“ä½œçš„å…ƒç´ çš„ç±»ã€‚ é€‚ç”¨äºŽæ•°æ®ç»“æž„ç›¸å¯¹æœªå®šçš„ç³»ç»Ÿï¼Œå®ƒæŠŠæ•°æ®ç»“æž„å’Œä½œç”¨äºŽç»“æž„ä¸Šçš„æ“ä½œä¹‹é—´çš„è€¦åˆè§£è„±å¼€ï¼Œä½¿å¾—æ“ä½œé›†åˆå¯ä»¥ç›¸å¯¹è‡ªç”±åœ°æ¼”åŒ–ã€‚ åº”ç”¨åœºæ™¯å½“é‡åˆ°å¦‚ä¸‹æƒ…å†µæ—¶ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è®¿é—®è€…æ¨¡å¼ï¼š å¯¹è±¡ç»“æž„ä¸­åŒ…å«è®¸å¤šå…·æœ‰ä¸åŒæŽ¥å£çš„å¯¹è±¡ç±»ï¼Œå¹¶ä¸”å¸Œæœ›å¯¹ä¾èµ–äºŽå…¶å…·ä½“ç±»çš„è¿™äº›å¯¹è±¡æ‰§è¡Œæ“ä½œã€‚ éœ€è¦å¯¹å¯¹è±¡ç»“æž„ä¸­çš„å¯¹è±¡æ‰§è¡Œè®¸å¤šä¸åŒä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œå¹¶ä¸”å¸Œæœ›é¿å…ä½¿ç”¨è¿™äº›æ“ä½œâ€œæ±¡æŸ“â€å®ƒä»¬çš„ç±»ã€‚è¿™æ—¶å°±å¯ä»¥å®šä¹‰å¤šä¸ªvisitorç±»æ¥å®Œæˆå¯¹å¤šä¸ªå¯¹è±¡èŠ‚ç‚¹çš„å¤„ç†ã€‚ å®šä¹‰å¯¹è±¡ç»“æž„çš„ç±»å¾ˆå°‘æ”¹å˜ï¼Œä½†æ˜¯ä½ ç»å¸¸æƒ³è¦åœ¨ç»“æž„ä¸Šå®šä¹‰æ–°çš„æ“ä½œã€‚ æ¨¡å¼ç»“æž„ä¸¾ä¸ªä¾‹å­ï¼šåœ¨å…¬å¸ä¸­ï¼Œéœ€è¦ç»Ÿè®¡æ‰“å¡è®°å½•å’Œç»©æ•ˆï¼Œåˆ†åˆ«æœ‰è¡Œæ”¿éƒ¨é—¨å’Œè´¢åŠ¡éƒ¨é—¨æ¥å®žçŽ°ã€‚å¹¶ä¸”å°†æ¥å¯èƒ½æœ‰è´¨é‡éƒ¨é—¨ç›‘æµ‹ç ”å‘å’Œå®žæ–½äººå‘˜çš„å·¥ä½œè´¨é‡ã€‚ä½†æ˜¯å¯¹ç ”å‘å’Œå®žæ–½äººå‘˜çš„è€ƒæ ¸æ ‡å‡†æœ‰æ‰€ä¸åŒã€‚ ä¸€ã€ç±»å›¾ OperateStructureä½œä¸ºå¯¹è±¡OperateNodeçš„æ•°æ®ç»“æž„,å¹¶ä¸”å®žçŽ°ç±»OperateNodeAå’ŒOperateNodeBè¡Œä¸ºæ–¹æ³•æœ‰å„è‡ªçš„å®žçŽ°ã€‚å¹¶ä¸”æƒ³åŸºäºŽè¿™ä¸ªç›¸å¯¹å›ºå®šçš„æ•°æ®ç»“æž„å®žçŽ°å¤šç§ä¸åŒçš„æ“ä½œï¼ˆvisitorï¼‰ã€‚è¿™æ ·åœ¨å¢žåŠ visitorçš„æ—¶å€™ä¸å¿…è€ƒè™‘æ•°æ®ç»“æž„ä¼šå‘ç”Ÿå˜æ›´ã€‚ äºŒã€æ—¶åºç”±äºŽè°ƒç”¨è¿‡ç¨‹æ¯”è¾ƒä¸å®¹æ˜“çœ‹é€ï¼Œè¿™é‡Œæˆ‘å…ˆä½¿ç”¨æ—¶åºå›¾æ¥è¯´æ˜Žè°ƒç”¨é¡ºåº ä»£ç å®žä¾‹æ ¹æ®ç±»å›¾å¯ä»¥çœ‹å‡ºï¼Œè®¿é—®è€…æ¨¡å¼åˆ†ä¸ºäº”éƒ¨åˆ†ï¼šæŠ½è±¡èŠ‚ç‚¹è§’è‰² ã€å…·ä½“èŠ‚ç‚¹è§’è‰² ã€æŠ½è±¡è®¿é—®è€…è§’è‰² ã€å…·ä½“è®¿é—®è€…è§’è‰² ã€ç»“æž„å¯¹è±¡è§’è‰² æŠ½è±¡èŠ‚ç‚¹è§’è‰²ï¼š 1234public abstract class OperateNode &#123;// å®šä¹‰èŠ‚ç‚¹å†…éƒ½éœ€è¦å®žçŽ°çš„æ–¹æ³• abstract void accept(Visitor visitor);&#125; å…·ä½“èŠ‚ç‚¹è§’è‰²ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// å…·ä½“èŠ‚ç‚¹A åœ¨å®žä¾‹ä¸­å¯¹åº”ç ”å‘äººå‘˜class OperateNodeA extends OperateNode &#123; //ç»©æ•ˆç³»æ•° private static final double COEFFICIENT = 1.2; private int workDate; OperateNodeA(int workDate) &#123; this.workDate = workDate; &#125; @Override void accept(Visitor visitor) &#123; visitor.visit(this); &#125; int attendance()&#123; return workDate; &#125; double performance()&#123; return workDate * COEFFICIENT; &#125;&#125;// å…·ä½“èŠ‚ç‚¹Bï¼Œåœ¨å®žä¾‹ä¸­å¯¹åº”è¿ç»´äººå‘˜class OperateNodeB extends OperateNode &#123; private static final int COEFFICIENT = 1; private int workDate; OperateNodeB(int workDate) &#123; this.workDate = workDate; &#125; @Override void accept(Visitor visitor) &#123; visitor.visit(this); &#125; int attendance()&#123; return workDate; &#125; double performance()&#123; return workDate * COEFFICIENT; &#125;&#125; æŠ½è±¡è®¿é—®è€…è§’è‰² 12345//é’ˆå¯¹ç»“æž„ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹åˆ†åˆ«è¿›è¡Œå„è‡ªçš„æ“ä½œpublic interface Visitor &#123; void visit(OperateNodeA operateNodeA); void visit(OperateNodeB operateNodeB);&#125; å…·ä½“è®¿é—®è€…è§’è‰² 1234567891011121314151617181920212223242526272829303132// è¡Œæ”¿äººå‘˜ç»“ç®—è€ƒå‹¤public class VisitorA implements Visitor &#123; // éœ€è¦å¯¹å®žæ–½äººå‘˜å¢žåŠ è·¯ä¸Šçš„è€ƒå‹¤æ—¶é—´ æ¨¡å¼ä¸º2 private static final int BASIC = 2; @Override public void visit(OperateNodeA operateNodeA) &#123; int att = operateNodeA.attendance(); System.out.println("æœ¬æœˆè¯¥ç ”å‘äººå‘˜è€ƒå‹¤ä¸º"+att + "å¤©"); &#125; @Override public void visit(OperateNodeB operateNodeB) &#123; int att =operateNodeB.attendance() + BASIC; System.out.println("æœ¬æœˆè¯¥å®žæ–½äººå‘˜è€ƒå‹¤ä¸º"+att + "å¤©"); &#125;&#125;//è´¢åŠ¡äººå‘˜ç»“ç®—ç»©æ•ˆpublic class VisitorB implements Visitor &#123; // ç ”å‘éœ€è¦æ·»åŠ é¢å¤–ç»©æ•ˆ private static final int EXTRA = 2; @Override public void visit(OperateNodeA operateNodeA) &#123; double att = operateNodeA.performance() + EXTRA; System.out.println("æœ¬æœˆè¯¥ç ”å‘äººå‘˜ç»©æ•ˆä¸º :"+att ); &#125; @Override public void visit(OperateNodeB operateNodeB) &#123; double att =operateNodeB.performance() ; System.out.println("æœ¬æœˆè¯¥ç ”å‘äººå‘˜ç»©æ•ˆä¸º :"+att ); &#125;&#125; ç»“æž„å¯¹è±¡ç»“æž„ 12345678910111213141516public class OperateStructure &#123; // å®šä¹‰ç»“æž„ä½“ private List&lt;OperateNode&gt; list = new ArrayList&lt;&gt;(); void add(OperateNode operateNode)&#123; list.add(operateNode); &#125; //å¯¹ç»“æž„ä½“ä¸­çš„å¯¹è±¡å®žçŽ°æŽ¥æ”¶è®¿é—®æ“ä½œ void action(Visitor visitor)&#123; for (OperateNode operateNode : list)&#123; // ç›®çš„å°±æ˜¯ä½¿ç”¨åŒé‡åˆ†æ´¾è°ƒç”¨æ¥å®žçŽ° // èŠ‚ç‚¹æŽ¥å—è®¿é—®è€…ä¸Žè®¿é—®è€…è®¿é—®èŠ‚ç‚¹çš„æ“ä½œ operateNode.accept(visitor); &#125; &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ 1234567891011public class App &#123; public static void main(String[] args) &#123; Visitor visitorA = new VisitorA(); Visitor visitorB = new VisitorB(); OperateStructure structure = new OperateStructure(); structure.add(new OperateNodeA(22)); structure.add(new OperateNodeB(22)); structure.action(visitorA); structure.action(visitorB); &#125;&#125; ç»“æžœ 1234æœ¬æœˆè¯¥ç ”å‘äººå‘˜è€ƒå‹¤ä¸º22å¤©æœ¬æœˆè¯¥å®žæ–½äººå‘˜è€ƒå‹¤ä¸º24å¤©æœ¬æœˆè¯¥ç ”å‘äººå‘˜ç»©æ•ˆä¸º :28.4æœ¬æœˆè¯¥ç ”å‘äººå‘˜ç»©æ•ˆä¸º :22.0]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ä»£ç†æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F14%2F2019-06-14-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ä»£ç†æ¨¡å¼ä»£ç†æ¨¡å¼æ˜¯å¯¹è±¡çš„ç»“æž„æ¨¡å¼ã€‚ä»£ç†æ¨¡å¼ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æŽ§åˆ¶å¯¹åŽŸå¯¹è±¡çš„å¼•ç”¨ã€‚ åº”ç”¨åœºæ™¯ è¿œç¨‹ä»£ç†ä¸åŒåœ°å€ç©ºé—´çš„å¯¹è±¡ï¼Œéƒ½å½“ä½œæœ¬åœ°åŒ–å¯¹è±¡æ¥å¤„ç† æŽ§åˆ¶å¯¹è±¡çš„è®¿é—®æƒé™ã€‚ å½“é‡åˆ°ä¸€ä¸‹æƒ…å†µæ˜¯å¯ä»¥ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼š æƒ³æŽ§åˆ¶å¯¹å¦ä¸€ä¸ªå¯¹è±¡çš„è®¿é—® æ‡’åŠ è½½ æŽ§åˆ¶æ—¥å¿—è¾“å‡º è®¡ç®—å¯¹è±¡å¼•ç”¨ æŽ§åˆ¶ç½‘ç»œé“¾æŽ¥é—®é¢˜ ä»£ç†æ¨¡å¼æ¨¡å¼ç»“æž„æµ´å®¤åˆ†ä¸ºç”·æµ´å®¤å’Œå¥³æµ´å®¤ï¼Œå…¶ä¸­å‰å°åˆ¤æ–­èƒ½å¤Ÿè¿›å…¥æµ´å®¤çš„å‰ææ˜¯æ²¡æœ‰çš®è‚¤ç—…ï¼Œå¦‚æœ‰æ²¡æœ‰ï¼Œæ‰è®©è¿›å…¥æµ´å®¤ã€‚è¿™é‡Œçš„å‰å°å°±æ˜¯ä¸€ä¸ªä»£ç†ï¼Œå®ƒä»£ç†æ¥æµ´å®¤ï¼Œç”¨æ¥åˆ¤æ–­èƒ½å¦è¿›å…¥æµ´å®¤çš„æƒé™ã€‚è¿™å°±æ˜¯ä»£ç†çš„ä½œç”¨ã€‚ ä»£ç†æ¨¡å¼å’Œè£…é¥°è€…æ¨¡å¼æ¯”è¾ƒå®¹æ˜“æ··æ·†ã€‚éœ€è¦è®°ä½çš„æ˜¯ï¼Œä¸¤è€…çš„åŠŸèƒ½åŒºåˆ«åœ¨äºŽï¼Œä»£ç†æ¨¡å¼æ”¹å˜çš„æ˜¯å¯¹è±¡çš„èŒèƒ½ï¼ŒæŽ§åˆ¶å¯¹è±¡çš„è¡Œä¸ºã€‚è€Œè£…é¥°è€…æ¨¡å¼æ˜¯å¯¹èŒèƒ½çš„å¢žåŠ å’Œå‡å°‘ã€‚ä½¿ç”¨åœºæ™¯ä¸Šæœ‰æ‰€ä¸åŒã€‚ ä»£ç ä»£ç†æ¨¡å¼å¤§è‡´èƒ½å¤Ÿåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæŠ½è±¡èŒèƒ½ç±»ï¼Œä»£ç†ç±»ï¼Œè¢«ä»£ç†ç±» ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡èŒèƒ½ç±» 123456789101112131415161718192021222324252627282930313233343536// Person åŸºæœ¬ä¿¡æ¯ç±» å’Œæ€§åˆ«æžšä¸¾ public class Person &#123; private String name ; private SexEnum sex; //æ˜¯å¦æœ‰çš®è‚¤ç—… private int hasSkinDisease; public Person(String name, SexEnum sex, int hasSkinDisease) &#123; this.name = name; this.sex = sex; this.hasSkinDisease = hasSkinDisease; &#125; public String getName() &#123; return name; &#125; public SexEnum getSex() &#123; return sex; &#125; public int getHasSkinDisease() &#123; return hasSkinDisease; &#125;&#125;public enum SexEnum &#123; MALE,FEMALE&#125;//æŠ½è±¡èŒèƒ½abstract class BathRoom &#123; // åŽ»æ¾¡å ‚æ³¡æ¾¡ abstract BathRoom enterBathroom(Person person);&#125; ç¬¬äºŒéƒ¨åˆ†ï¼šè¢«ä»£ç†ç±» 1234567891011public class MaleBathRoom extends BathRoom &#123; @Override public BathRoom enterBathroom(Person p) &#123; String sexName = ""; if(SexEnum.MALE.equals(p.getSex()))&#123; sexName = SexEnum.MALE.toString(); System.out.println("name : "+ p.getName() +" sex: "+ sexName +" go bath for male !"); &#125; return this; &#125;&#125; ç¬¬ä¸‰éƒ¨åˆ†ï¼šä»£ç†ç±» 12345678910111213141516171819public class BathRoomProxy extends BathRoom &#123; BathRoom bathRoom; public BathRoomProxy(BathRoom bathRoom) &#123; this.bathRoom = bathRoom; &#125; @Override public BathRoom enterBathroom(Person person) &#123; if (person.getHasSkinDisease() == 0) &#123; this.bathRoom.enterBathroom(person); &#125; else &#123; System.out.println(person.getName() + " has disease."); &#125; return this; &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ï¼š 123456789public class App &#123; public static void main(String[] args) &#123; Person p1 = new Person("1",SexEnum.MALE,0); Person p2 = new Person("2",SexEnum.MALE,1); BathRoomProxy bathRoomProxy = new BathRoomProxy(new MaleBathRoom()); bathRoomProxy.enterBathroom(p1).enterBathroom(p2); &#125;&#125; ç»“æžœï¼š 12name : 1 sex: MALE go bath for male !2 has disease.]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹äº«å…ƒæ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F13%2F2019-06-13-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹äº«å…ƒæ¨¡å¼äº«å…ƒæ¨¡å¼æ˜¯å¯¹è±¡çš„ç»“æž„æ¨¡å¼ã€‚äº«å…ƒæ¨¡å¼ä»¥å…±äº«çš„æ–¹å¼é«˜æ•ˆåœ°æ”¯æŒå¤§é‡çš„ç»†ç²’åº¦å¯¹è±¡ã€‚å®ƒç”¨äºŽé€šè¿‡å°½å¯èƒ½å¤šåœ°ä¸Žç±»ä¼¼å¯¹è±¡å…±äº«æ¥æœ€å°åŒ–å†…å­˜ä½¿ç”¨æˆ–è®¡ç®—å¼€é”€ã€‚ åº”ç”¨åœºæ™¯ åº”ç”¨ä¸­éœ€è¦å¤§é‡çš„å¯¹è±¡ï¼Œå¤§é‡çš„å¯¹è±¡å¯èƒ½é€ æˆå­˜å‚¨å¯¹è±¡çš„å¼€é”€ã€‚ å¯¹è±¡å˜åŒ–çš„çŠ¶æ€å¤§å¤šæ˜¯å¤–éƒ¨çŠ¶æ€ã€‚ä¸€æ—¦å¤–éƒ¨çŠ¶æ€è¢«ç§»é™¤ï¼Œè®¸å¤šå¯¹è±¡ç»„å¯è¢«ç›¸å¯¹è¾ƒå°‘çš„å…±äº«å¯¹è±¡æ›¿æ¢ã€‚è¿™ä¹Ÿå°±æ˜¯äº«å…ƒæ¨¡å¼åˆ©ç”¨çš„ç‚¹ã€‚ å› ä¸ºåœ¨äº«å…ƒæ¨¡å¼ä¸­å¯¹è±¡æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥åœ¨å«ä¹‰ä¸Šçš„ä¸åŒå¯¹è±¡ä½¿ç”¨equelså®žé™…è¿”å›žçš„æ˜¯trueã€‚ äº«å…ƒæ¨¡å¼ç»“æž„äº«å…ƒæ¨¡å¼é‡‡ç”¨ä¸€ä¸ªå…±äº«æ¥é¿å…å¤§é‡æ‹¥æœ‰ç›¸åŒå†…å®¹å¯¹è±¡çš„å¼€é”€ã€‚è¿™ç§å¼€é”€æœ€å¸¸è§ã€æœ€ç›´è§‚çš„å°±æ˜¯å†…å­˜çš„æŸè€—ã€‚äº«å…ƒå¯¹è±¡èƒ½åšåˆ°å…±äº«çš„å…³é”®æ˜¯åŒºåˆ†å†…è•´çŠ¶æ€(Internal State)å’Œå¤–è•´çŠ¶æ€(External State)ã€‚ å†…è•´çŠ¶æ€å†³å®šå¯¹è±¡æœ¬èº«çš„çŠ¶æ€ï¼Œä¸ä¼šéšç€çŽ¯å¢ƒçš„å˜åŒ–è€Œå˜åŒ–ï¼Œè€Œå¤–è•°çŠ¶æ€æ˜¯ç”±å®¢æˆ·ç«¯å°†çŠ¶æ€ä¼ é€’ç»™äº«å…ƒå¯¹è±¡çš„ï¼Œå¤–è•´çŠ¶æ€ç±»ä¼¼åŒä¸€ä¸ªå¯¹è±¡çš„ä¸åŒçš„è¡Œä¸ºï¼Œå†…è•´çŠ¶æ€å’Œå¤–è•°çŠ¶æ€æ˜¯ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å½±å“çš„ã€‚ äº«å…ƒæ¨¡å¼ä¸»è¦è¿™å‡ ä¸‰ä¸ªéƒ¨åˆ†ï¼šæŠ½è±¡äº«å…ƒç±»ï¼Œå…·ä½“äº«å…ƒç±»å’Œäº«å…ƒå·¥åŽ‚ç±»ã€‚å…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢ä»£ç ã€‚ ä»£ç åœ¨Javaä¸­ï¼ŒStringç±»å°±ç¬¦åˆäº«å…ƒæ¨¡å¼ï¼Œstring a = &quot;aa&quot; å’Œ string b =&quot;aa&quot; æ˜¯ç›¸ç­‰çš„ã€‚ åœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼Œæž„é€ æŠ½è±¡äº«å…ƒç±»â€œMyStringâ€ å’Œå®ƒçš„å…·ä½“å®žçŽ°ç±»ï¼Œä½¿ç”¨åˆ°ç›¸åŒçš„å¯¹è±¡ï¼Œå› ä¸ºäº«å…ƒæ¨¡å¼ï¼Œå¯ä»¥å¯¹è¿™äº›å¯¹è±¡è¿›è¡Œå…±äº«ä½¿ç”¨ã€‚ ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡äº«å…ƒç±» 1234567public interface MyString &#123; void create(String outerState);&#125;//æžšä¸¾ç±»public enum InstanceType &#123; INSTANCE1,INSTANCE2&#125; ç¬¬äºŒéƒ¨åˆ†ï¼šå…·ä½“äº«å…ƒç±» 12345678910111213141516171819202122232425262728293031public class StringIns1 implements MyString &#123; // å†…éƒ¨çŠ¶æ€ï¼Œä¸å¯éšæ—¶å˜åŒ–çš„ String innerState; public StringIns1(String innerState) &#123; this.innerState = innerState; &#125; @Override public void create(String outerState) &#123; System.out.println("create instance 1 -&gt; innerState:"+this.innerState); //å¤–éƒ¨çŠ¶æ€ï¼Œéœ€è¦å®¢æˆ·ç«¯ä¼ è¿›æ¥ï¼Œè¿™ä¸ªå€¼æ˜¯å¯å˜åŒ–çš„ System.out.println("create instance 1 -&gt; outerState:"+outerState); &#125;&#125;public class StringIns2 implements MyString &#123; String innerState; public StringIns2(String innerState) &#123; this.innerState = innerState; &#125; @Override public void create(String outerState) &#123; System.out.println("create instance 2 -&gt; innerState:"+this.innerState); System.out.println("create instance 2 -&gt; outerState:"+outerState); &#125;&#125; ç¬¬ä¸‰éƒ¨åˆ†ï¼šäº«å…ƒå·¥åŽ‚ç±» 12345678910111213141516171819202122public class FlyWeight &#123; Map&lt;InstanceType,MyString&gt; store; FlyWeight() &#123; store = new HashMap&lt;&gt;(); &#125; public MyString factory(InstanceType instanceType)&#123; MyString curr = store.get(instanceType); if(curr == null)&#123; // å¦‚æžœå¯¹è±¡ä¸å­˜åœ¨ï¼Œæ–°å»ºå¯¹åº”çš„å¯¹è±¡ if(instanceType.equals(InstanceType.INSTANCE1))&#123; // æ ¹æ®å†…éƒ¨çŠ¶æ€å†³å®šç”Ÿæˆå“ªä¸ªç±»åž‹çš„å­ç±» curr= new StringIns1(instanceType.toString()); &#125; else if(instanceType.equals(InstanceType.INSTANCE2))&#123; curr= new StringIns2(instanceType.toString()); &#125; &#125; store.put(instanceType,curr); return curr; &#125;&#125; ç¬¬å››éƒ¨åˆ†ï¼šå®¢æˆ·ç«¯è°ƒç”¨ 12345678910public class App &#123; public static void main(String[] args) &#123; FlyWeight flyWeight = new FlyWeight(); MyString ins1 = flyWeight.factory(InstanceType.INSTANCE1); MyString ins2 = flyWeight.factory(InstanceType.INSTANCE1); System.out.println(ins1.equals(ins2));//true æ˜¯åŒä¸€ä¸ªå¯¹è±¡ å†…éƒ¨çŠ¶æ€ç›¸åŒ ins1.create("*****"); //é’ˆå¯¹å¤–éƒ¨çŠ¶æ€æ‰“å°ä¸åŒå†…å®¹ ins2.create("-----"); &#125;&#125; ç»“æžœï¼š 12345truecreate instance 1 -&gt; innerState:INSTANCE1create instance 1 -&gt; outerState:*****create instance 1 -&gt; innerState:INSTANCE1create instance 1 -&gt; outerState:-----]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å¤–è§‚æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F12%2F2019-06-12-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å¤–è§‚æ¨¡å¼å¤–éƒ¨ä¸Žä¸€ä¸ªå­ç³»ç»Ÿçš„é€šä¿¡å¿…é¡»é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¤–è§‚å¯¹è±¡è¿›è¡Œï¼Œä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æŽ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼Œä½¿å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚ åº”ç”¨åœºæ™¯ å› ä¸ºå­ç³»ç»Ÿéšç€å‘å±•ä¼šå˜æ›´çš„æ›´å¤æ‚ï¼Œå®¢æˆ·ç«¯æƒ³æ›´ç®€å•ç»Ÿä¸€ç»™å­ç³»ç»Ÿå»ºç«‹ä¸€ä¸ªå…¬å…±çš„è°ƒç”¨æ–¹å¼ã€‚è¿™æ ·å³ä½¿å­ç³»ç»Ÿçš„å†å¢žåŠ å¯é‡ç”¨æ€§è€Œå˜å¾—æ›´åŠ å¤æ‚ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¸å¿…çŸ¥é“ï¼Œå› ä¸ºå®¢æˆ·ç«¯å¾€å¾€ä¸éœ€è¦é’ˆå¯¹æŸä¸€ä¸ªå­ç³»ç»Ÿè¿›è¡Œç‰¹å®šçš„å®šåˆ¶åŒ–ã€‚ å®žçŽ°äº†å­ç³»ç»Ÿä¸Žå®¢æˆ·ä¹‹é—´çš„æ¾è€¦åˆå…³ç³»ï¼Œè¿™ä½¿å¾—å­ç³»ç»Ÿçš„ç»„ä»¶å˜åŒ–ä¸ä¼šå½±å“åˆ°è°ƒç”¨å®ƒçš„å®¢æˆ·ç±»ï¼Œåªéœ€è¦è°ƒæ•´å¤–è§‚ç±»å³å¯ã€‚ æ¨¡å¼ç»“æž„å¤–è§‚æ¨¡å¼ä¸­å®¢æˆ·ç«¯ä¾é Facadeç±»æ¥è°ƒç”¨å¤šä¸ªå­ç³»ç»Ÿï¼Œæ¥è¾¾åˆ°ç®€åŒ–å®¢æˆ·ç«¯è°ƒç”¨çš„ç›®çš„ã€‚ ä¾‹å­ä¸­ï¼Œæ¯æ¬¡å¼€æœºçš„æ—¶å€™éƒ½è¦å¯åŠ¨mysql,apacheæœåŠ¡ï¼Œä¸¤ä¸ªè¿˜å¥½ï¼Œè¦æ˜¯æœ‰æ›´å¤šæœåŠ¡å²‚ä¸æ˜¯å¾ˆæ¼äººï¼Œæ¯æ¬¡éƒ½è¦æ•²ä¸€å¤§å †å‘½ä»¤æ¥å¼€å¯æœåŠ¡ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œå°†æ‰€æœ‰æœåŠ¡åŠ å…¥åˆ°å¤–è§‚ç±»ä¸­ï¼Œæ¯æ¬¡å¼€æœºåªç”¨è°ƒç”¨å¤–è§‚ç±»ä¸­çš„æŽ¥å£å°±è¡Œäº†ã€‚æ¥è¾¾åˆ°ç®€åŒ–å®¢æˆ·ç«¯ä½¿ç”¨çš„ç›®çš„ã€‚ ä»£ç ç¬¬ä¸€éƒ¨åˆ†ï¼šå­ç³»ç»ŸæŽ¥å£ 123456789101112131415161718192021222324252627282930313233343536373839public interface Services &#123; void start(); void stop(); void restart();&#125;// mysql æœåŠ¡public class MysqlService implements Services &#123; @Override public void start() &#123; System.out.println("mysql is started"); &#125; @Override public void stop() &#123; System.out.println("mysql is stopped"); &#125; @Override public void restart() &#123; System.out.println("mysql is restart"); &#125;&#125;// apache æœåŠ¡public class ApacheService implements Services &#123; @Override public void start() &#123; System.out.println("apache is started"); &#125; @Override public void stop() &#123; System.out.println("apache is stopped"); &#125; @Override public void restart() &#123; System.out.println("apache is restart"); &#125;&#125; ç¬¬äºŒéƒ¨åˆ†ï¼šå¤–è§‚ç±» 1234567891011121314151617181920212223242526272829public class Facade &#123; List&lt;Services&gt; services; public Facade() &#123; services = new ArrayList&lt;&gt;(); &#125; public void addService(Services services)&#123; this.services.add(services); &#125; public void start()&#123; for (Services services : this.services)&#123; services.start(); &#125; &#125; public void stop()&#123; for (Services services : this.services)&#123; services.stop(); &#125; &#125; public void restart()&#123; for (Services services : this.services)&#123; services.restart(); &#125; &#125;&#125; ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®¢æˆ·ç«¯è°ƒç”¨ 123456789public class App &#123; public static void main(String[] args) &#123; Facade facade = new Facade(); facade.addService(new MysqlService()); facade.addService(new ApacheService()); facade.start(); facade.stop(); &#125;&#125; ç»“æžœï¼š 1234mysql is startedapache is startedmysql is stoppedapache is stopped]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è£…é¥°è€…æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F10%2F2019-06-10-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è£…é¥°è€…æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°å°†é™„åŠ èŒè´£é™„åŠ ç»™å¯¹è±¡ã€‚è£…é¥°å™¨ä¸ºå­ç±»åŒ–çš„æ–¹å¼æä¾›äº†çµæ´»çš„æ›¿ä»£æ‰©å±•åŠŸèƒ½ã€‚æ¯”å¦‚åšæ¢¦æ¢¦åˆ°äº†äº¤ä¸ªå¥³æœ‹å‹ï¼Œå¥¹çš„å‘åž‹ï¼Œå‘è‰²ï¼Œç©¿ç€éƒ½æ˜¯æ ¹æ®åœºæ™¯åšæ¢¦æ¢¦åˆ°çš„æ—¶å€™é™„åŠ ä¸ŠåŽ»çš„ã€‚è¿™æ—¶ï¼Œå°±åº”è¯¥å¯¹â€œå¥³æœ‹å‹â€è¿™ä¸ªå¯¹è±¡å®žè¡Œè£…é¥°è€…æ¨¡å¼æ¥åŠ¨æ€çš„ã€çµæ´»çš„æ‹“å±•ã€‚ åº”ç”¨åœºæ™¯ åŠ¨æ€ä¸”é€æ˜Žåœ°å‘å„ä¸ªå¯¹è±¡æ·»åŠ èŒè´£çš„åŒæ—¶ä¸å½±å“å…¶ä»–å¯¹è±¡ã€‚ çµæ´»çš„å¯æ’¤å›žèŒè´£ã€‚ æœ‰æ—¶å€™éœ€è¦å¾ˆå¤šå­ç±»æ¥ç”¨äºŽæ”¯æŒæ¯ç§åŠŸèƒ½çš„ç»„åˆï¼Œè¿™æ ·æ¯æ¬¡å¢žåŠ ä¸€ç§åŠŸèƒ½æ‹“å±•å°±è¦å¢žåŠ å¾ˆå¤šå­ç±»çš„æƒ…å†µã€‚æ˜¾ç„¶è¿™æ ·æ˜¯ä¸ç¬¦åˆè¦æ±‚çš„ã€‚æ‰€ä»¥é‡åˆ°è¿™ç§å¤šåŠŸèƒ½æ‹“å±•æ—¶ï¼Œéœ€è¦ä½¿ç”¨è£…é¥°è€…æ¨¡å¼æ¥è§£å†³ã€‚ è£…é¥°è€…æ¨¡å¼ç»“æž„è£…é¥°è€…æ¨¡å¼å¯ä»¥å¤§è‡´åˆ†ä¸ºå››ç§ç»“æž„ï¼ˆæœ¬ä¾‹å­ä¸­çš„æŠ½è±¡æž„ä»¶å’ŒæŠ½è±¡è£…é¥°ç±»ä¸ºä¸€ä¸ªï¼‰æŠ½è±¡æž„ä»¶ï¼Œå…·ä½“æž„ä»¶ï¼ŒæŠ½è±¡è£…é¥°ç±»ï¼Œå®žé™…è£…é¥°ç±»ã€‚ ä»£ç ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡æž„ä»¶ä¸ŽæŠ½è±¡è£…é¥°ç±» 123456789101112// åˆ¶é€ ä¸€ä¸ªå‡æƒ³çš„â€œå¥³æœ‹å‹â€public abstract class AbstractGirl &#123; public void dyeHair() &#123; &#125; public abstract void wearClothes(); public void pack() &#123; &#125;&#125; ç¬¬äºŒéƒ¨åˆ†ï¼šå®žçŽ°ç»„ä»¶ 12345678910111213141516// åŸºæœ¬çš„åŠŸèƒ½å®žçŽ°public class NormalGirl extends AbstractGirl &#123; @Override public void dyeHair() &#123; System.out.println("normal hair"); &#125; @Override public void wearClothes() &#123; System.out.println("normal clothes"); &#125; @Override public void pack() &#123; &#125;&#125; ç¬¬ä¸‰éƒ¨åˆ†ï¼šé™„åŠ è£…é¥°ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// å·¥ä½œä¸­çš„å¥³å­© ç©¿æ­£è£…public class WorkGirl extends AbstractGirl &#123; AbstractGirl abstractGirl; public WorkGirl(AbstractGirl abstractGirl) &#123; this.abstractGirl = abstractGirl; &#125; @Override public void wearClothes() &#123; abstractGirl.wearClothes(); System.out.println("wearClothes after : "); System.out.println("wear formal clothes"); &#125;&#125;//å®žé™…å‡ºåŽ»é€›è¡—çš„å¥³å­©åº”è¯¥æ˜¯è¿™æ ·çš„public class FashionGirl extends AbstractGirl &#123; AbstractGirl abstractGirl; public FashionGirl(AbstractGirl abstractGirl) &#123; this.abstractGirl = abstractGirl; &#125; @Override public void dyeHair() &#123; abstractGirl.dyeHair(); System.out.println("dyeHair after : "); System.out.println("dye blue hair"); &#125; @Override public void wearClothes() &#123; abstractGirl.wearClothes(); System.out.println("wearClothes after : " ); System.out.println("wear rock type clothes"); &#125; @Override public void pack() &#123; abstractGirl.pack(); System.out.println("wearClothes after : " ); System.out.println("take fashion pack"); &#125;&#125; æœ€åŽå®¢æˆ·ç«¯çš„è°ƒç”¨ï¼š 1234567891011121314public class App &#123; public static void main(String[] args) &#123; //å…ˆåˆ¶é€ ä¸€ä¸ªæ•´ä½“ç»„ä»¶ AbstractGirl normalGirl = new NormalGirl(); normalGirl.dyeHair(); // ä¸ºç»„ä»¶æ·»åŠ è£…é¥°ï¼Œæ¯”å¦‚è¿™é‡ŒåŠ äº†ä¸ªæ—¶å°šçš„åŒ…åŒ… AbstractGirl fashionHair = new FashionGirl(normalGirl); fashionHair.pack(); //ç©¿ä¸€å¥—æ­£è£… AbstractGirl workClose = new WorkGirl(fashionHair); workClose.wearClothes(); &#125;&#125;]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹æ¡¥æŽ¥æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F03%2F2019-06-03-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹æ¡¥æŽ¥æ¨¡å¼ç›®çš„åœ¨äºŽå°†æŠ½è±¡ä¸Žå…¶å®žçŽ°åˆ†ç¦»ï¼Œä»¥ä¾¿ä¸¤è€…å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚ç‹¬ç«‹å˜åŒ–çš„åŒæ—¶èƒ½å¤Ÿæ ¹æ®æŠ½è±¡ç±»çš„å¯¹è±¡å…³è”ä»Žè€Œèƒ½å¤Ÿå°†ä¸¤ä¸ªç»§æ‰¿ç»“æž„è”åŠ¨èµ·æ¥ã€‚å°±åƒåœ¨ä¸¤ä¸ªç»“æž„ä¹‹é—´å»ºç«‹ä¸ªæ¡¥æ¢ä¸€æ ·è¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥å«æ¡¥æŽ¥æ¨¡å¼ã€‚ åº”ç”¨åœºæ™¯ å¦‚æžœæƒ³é¿å…æŠ½è±¡ç±»ä¸Žå®žçŽ°çš„æ°¸ä¹…ç»‘å®šï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é—´é€‰æ‹©å’Œåˆ‡æ¢å®žçŽ°ç±»ã€‚ æŠ½è±¡ç±»å’ŒæŽ¥å£éƒ½åº”è¯¥é€šè¿‡å­ç±»æ¥è¿›è¡Œæ‹“å±•ï¼Œåœ¨æ¡¥æŽ¥æ¨¡å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å­ç±»æ¥è¿›è¡Œç»„åˆçš„åŒæ—¶èƒ½å¤Ÿç‹¬ç«‹æ‹“å±•ä»–ä»¬ã€‚ æŽ¥å£çš„å®žçŽ°çš„å˜åŒ–å¯¹å®¢æˆ·ç«¯æ— å½±å“ã€‚ å¦‚æžœæƒ³è¦åœ¨å¤šä¸ªå¯¹è±¡ç±»ä¸­å…±äº«å®žçŽ°ï¼Œå¹¶ä¸”é¿å…è®©å®¢æˆ·ç«¯æ„ŸçŸ¥åˆ°ã€‚ æ¡¥æŽ¥æ¨¡å¼ç»“æž„å›¾ ä»£ç ä¸»è¦åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œ1.æŠ½è±¡ç±» 2.æŠ½è±¡å®žçŽ°ç±» 3.æŽ¥å£ç±» 4.æŽ¥å£å®žçŽ°ç±» 123456789101112131415161718192021222324252627282930313233343536373839// æŠ½è±¡ç±»ä¸ŽæŠ½è±¡å®žçŽ°ç±»public abstract class Shape &#123; Colors colors; Shape(Colors colors) &#123; this.colors = colors; &#125; public abstract void buildShape();&#125;// åœ†å½¢å®žçŽ°ç±»public class ShapeCircle extends Shape &#123; public ShapeCircle(Colors colors) &#123; super(colors); &#125; @Override public void buildShape() &#123; System.out.println("\n first step : build circle\n and second step:"); colors.paint(); &#125;&#125;//æ–¹å½¢å®žçŽ°ç±»public class ShapeSquare extends Shape &#123; public ShapeSquare (Colors colors) &#123; super(colors); &#125; @Override public void buildShape() &#123; System.out.println("\n first step : build Square\n and second step:"); colors.paint(); &#125;&#125; æŠ½è±¡æ–¹æ³•ä¸­å¼•ç”¨äº†Colorsç±»å˜é‡ï¼Œä½¿ç”¨å®žçŽ°ç±»ä¸­çš„buildShapeæ–¹æ³•å®žçŽ°å…·ä½“åŠŸèƒ½ã€‚ 1234567891011121314151617public interface Colors &#123; public void paint();&#125;public class ColorBlue implements Colors &#123; @Override public void paint() &#123; System.out.println(" print blue !!"); &#125;&#125;public class ColorRed implements Colors &#123; @Override public void paint() &#123; System.out.println(" paint inner with red !!"); &#125;&#125; é€šè¿‡ä½¿ç”¨ColoræŽ¥å£ï¼Œå®žçŽ°ç±»å®žçŽ°Colorsä¸­çš„paintæ–¹æ³•å®žçŽ°Color 12345678public class App &#123; public static void main(String[] args) &#123; Shape circle = new ShapeCircle(new ColorBlue()); circle.buildShape(); Shape square = new ShapeSquare(new ColorRed()); square.buildShape(); &#125;&#125; 123456789ç»“æžœï¼š first step : build circle and second step: print blue !! first step : build Square and second step: paint red !! ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé¢œè‰²å’Œå›¾å½¢æ˜¯ä¸¤ä¸ªç‹¬ç«‹ä¸åŒçš„ç»´åº¦ï¼Œä¸¤ä¸ªå¯ä»¥åˆ†åˆ«å˜åŒ–ã€‚å°†ä¸¤ä¸ªç»´åº¦è®¾è®¡ä¸ºä¸¤ä¸ªä¸åŒçš„ç»§æ‰¿çš„ç»“æž„ï¼Œåœ¨ä¸¤ä¸ªç»“æž„ä¹‹é—´ä½¿ç”¨åœ¨æŠ½è±¡ç±»ä¸­çš„å…³è”æ¥è¾¾åˆ°é“¾æŽ¥çš„ç›®çš„ï¼Œè¿™ä¸ªé“¾æŽ¥æˆä¸ºä¸¤ä¸ªç»§æ‰¿ç»“æž„é€šä¿¡çš„æ¡¥æ¢ã€‚æ‰€ä»¥ä¸ºæ¡¥æŽ¥æ¨¡å¼ã€‚]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹åŽŸåž‹æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F02%2F2019-06-02-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹åŽŸåž‹æ¨¡å¼ä½¿ç”¨åŽŸåž‹å®žä¾‹æŒ‡å®šè¦åˆ›å»ºçš„å¯¹è±¡ç±»åž‹ï¼Œå¹¶é€šè¿‡å¤åˆ¶æ­¤åŽŸåž‹æ¥åˆ›å»ºæ–°å¯¹è±¡.å®žçŽ°æ–¹æ³•:é€šè¿‡å…‹éš†æ–¹æ³•,å®žçŽ°å¯¹çŽ°æœ‰å¯¹è±¡çš„å¤åˆ¶å…‹éš†. åº”ç”¨åœºæ™¯ å½“è¦åœ¨è¿è¡Œæ—¶æŒ‡å®šè¦å®žä¾‹åŒ–çš„ç±»æ—¶ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡åŠ¨æ€åŠ è½½. é¿å…æž„å»ºä¸Žäº§å“ç±»å±‚æ¬¡ç»“æž„ç›¸ä¼¼çš„å·¥åŽ‚ç±»å±‚æ¬¡ç»“æž„ å½“ä¸€ä¸ªç±»çš„å®žä¾‹å¯ä»¥åªæœ‰å‡ ä¸ªä¸åŒçš„çŠ¶æ€çš„ç»„åˆä¹‹ä¸€æ—¶.ç»„è£…ç›¸åº”æ•°é‡çš„åŽŸåž‹å¹¶å…‹éš†å®ƒä»¬å¯èƒ½æ›´æ–¹ä¾¿ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨å®žä¾‹åŒ–ç±»ï¼Œæ¯æ¬¡éƒ½æœ‰é€‚å½“çš„çŠ¶æ€. ä¸Žå¯¹è±¡åˆ›å»ºç›¸æ¯”,ä½¿ç”¨å…‹éš†æˆæœ¬æ›´ä½Ž ä»£ç ç›´æŽ¥ç”±ä»£ç çœ‹ç»“æž„,å…¶å®žå…‹éš†çš„è¿‡ç¨‹å°±æ˜¯åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ 123456789101112131415161718192021222324252627282930/** * ä¸€ä¸ªç»†èƒž * @Author nanyin * @Date 23:49 2019-06-01 **/public class Cell implements Cloneable&#123; private String name; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public Cell()&#123; &#125; private Cell(String name) &#123; this.name = name; &#125; @Override protected Cell clone() throws CloneNotSupportedException &#123; super.clone(); return new Cell(name); &#125;&#125; å®¢æˆ·ç«¯ç¨‹åº: 1234567891011121314public class App &#123; @Test public void testPrototype()&#123; Cell cell = new Cell(); cell.setName("org"); try&#123; Cell cloneCell = cell.clone(); Assert.assertEquals("org",cloneCell.getName());//pass Assert.assertEquals(cell,cloneCell);//not pass &#125;catch (CloneNotSupportedException e)&#123; e.printStackTrace(); &#125; &#125;&#125;]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹é€‚é…å™¨æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F02%2F2019-06-02-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹é€‚é…å™¨æ¨¡å¼æˆ‘ä»¬å®žé™…ä¸­ä¼šç”¨åˆ°ä¸¤ä¸ªä¸åŒæŽ¥å£çš„ç±»çš„é€šä¿¡,åœ¨ä¸ä¿®æ”¹ä¸¤ä¸ªç±»çš„å‰æä¸‹,ä½¿ç”¨æ–°çš„ä¸­é—´ç±»æ¥å®Œæˆè¡”æŽ¥çš„è¿‡ç¨‹,è¿™ä¸ªä¸­é—´ä»¶å°±æ˜¯é€‚é…å™¨.å¯ä»¥è®©ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æŽ¥å£ç›¸äº’è½¬åŒ–. é€‚é…å™¨æ¨¡å¼å…è®¸åœ¨é€‚é…å™¨ä¸­åŒ…è£…å…¶ä»–ä¸å…¼å®¹çš„å¯¹è±¡ï¼Œä»¥ä½¿å…¶ä¸Žå¦ä¸€ä¸ªç±»å…¼å®¹ã€‚ å°±å¦‚åŒç”Ÿæ´»ä¸­ä¹°äº†æ¸¯ç‰ˆçš„æ‰‹æœº,ä½†æ˜¯é™„èµ çš„æ˜¯ä¸‰è„šæ’å¤´ï¼Œè€Œå¤§é™†ä¸Šç”¨çš„æ˜¯ä¸¤è„šçš„ï¼Œéœ€è¦ä¸€ä¸ªé€‚é…å™¨æ¥å°†ä¸‰è§’æ’å¤´è½¬æ¢ä¸ºä¸¤è„šçš„ã€‚å…¶ä¸­è¿™ä¸ªä¸­é—´ä»¶å°±æ˜¯é€‚é…å™¨ã€‚ åº”ç”¨åœºæ™¯ å½“ä½ æƒ³è¦è¿™ä¸ªç±»ï¼Œä½†æ˜¯ç±»ä¸­çš„æŽ¥å£ä¸Žæƒ³ç”¨çš„æŽ¥å£å¹¶ä¸åŒ¹é… å½“æƒ³è¦åŽ»åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨çš„ç±»ï¼Œè®©å®ƒä¸Žä¸ç›¸å…³æˆ–ä¸å¯é¢„è§çš„ç±»åˆä½œï¼Œè¿™ä¸ªç±»ä¸å¿…è¦æœ‰å…¼å®¹çš„æŽ¥å£ å½“ä½ éœ€è¦ä¸€ç³»åˆ—çš„å­ç±»çš„æ—¶å€™ï¼Œå¦‚æžœæƒ³è¦è°ƒæ•´è¿™äº›å­ç±»çš„æŽ¥å£æ–¹æ³•çš„æ—¶å€™ï¼Œå¯¹æ¯ä¸€ä¸ªæŽ¥å£å­ç±»åŒ–çš„è¿™ç§æ–¹æ³•æ˜¯ä¸å¯è¡Œçš„ã€‚è¿™æ—¶å°±å¯ä½¿ç”¨é€‚é…å™¨é€‚é…è¿™äº›å­ç±»çš„å¤«ç±»ã€‚ ç»“æž„å›¾ ä½¿ç”¨clientè°ƒç”¨é€‚é…å™¨ï¼Œé€‚é…å™¨ç»§æ‰¿ä¸Žä¸‰è„šæ’å¤´ï¼Œä¾èµ–äºŽäºŒè„šæ’å¤´ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸‰è„šæ’å¤´çš„æŽ¥å£è°ƒç”¨äºŒè„šæ’å¤´çš„æ–¹æ³•ã€‚ ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061/** * ä¸‰è§’æ’å¤´ * @Author nanyin * @Date 11:13 2019-06-02 **/public class ThreeLeggedPlug &#123; public void charge()&#123; System.out.println("use three legged plug"); &#125;&#125;/** * äºŒè„šæ’å¤´ * @Author nanyin * @Date 11:13 2019-06-02 **/public class TwoLeggedPlug &#123; public void fastCharge()&#123; System.out.println("use two legged plug for fast charge !"); &#125;&#125;//é€‚é…å™¨ ç»§æ‰¿ä¸‰è§’æ’å¤´public class TwoLeggedPlugAdapter extends ThreeLeggedPlug &#123; TwoLeggedPlug twoLeggedPlug; // ä¾èµ–äºŽäºŒè„šæ’å¤´ public TwoLeggedPlugAdapter() &#123; twoLeggedPlug = new TwoLeggedPlug(); &#125; //ä½¿ç”¨ä¸‰è§’æ’å¤´çš„chargeæ–¹æ³•ï¼Œè°ƒç”¨äºŒè„šæ’å¤´çš„fastChargeæ–¹æ³• @Override public void charge() &#123; twoLeggedPlug.fastCharge(); &#125;&#125;//æŸS9æ¸¯ç‰ˆæ‰‹æœºpublic class S9Plus extends ThreeLeggedPlug &#123; ThreeLeggedPlug threeLeggedPlug; public S9Plus(ThreeLeggedPlug threeLeggedPlug) &#123; this.threeLeggedPlug = threeLeggedPlug; &#125; @Override public void charge() &#123; threeLeggedPlug.charge(); &#125;&#125;//å®¢æˆ·ç«¯æ–¹æ³•public class App &#123; @Test public void testCharge() &#123; // ä¸ä½¿ç”¨é€‚é…å™¨ ä½¿ç”¨ç±»ä¸‰è§’æ’å¤´ ThreeLeggedPlug s9Plus = new S9Plus(new ThreeLeggedPlug()); s9Plus.charge(); // ä½¿ç”¨äºŒè„šæ’å¤´çš„é€‚é…å™¨ ThreeLeggedPlug s9PlusUseTwoLeggedPlug = new S9Plus(new TwoLeggedPlugAdapter()); s9PlusUseTwoLeggedPlug.charge(); &#125;&#125; 123456ç»“æžœï¼šuse three legged pluguse two legged plug for fast charge !Process finished with exit code 0]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F01%2F2019-06-01-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼å°†å¤æ‚å¯¹è±¡çš„æž„é€ ä¸Žå…¶è¡¨ç¤ºåˆ†å¼€ï¼Œä»¥ä¾¿ç›¸åŒçš„æž„é€ è¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚ æ¯”å¦‚åœ¨çŽ©æ¸¸æˆæ—¶çš„æäººç‰©çš„æ—¶å€™,åˆ›å»ºä¸€ä¸ªæ¸¸æˆä»»åŠ¡æœ€ç®€å•çš„æ–¹æ³•æ—¶è®¡ç®—æœºè‡ªå·±ç”Ÿæˆä¸€ä¸ªå›ºå®šçš„æ¸¸æˆä»»åŠ¡,ä½†æ˜¯æƒ³è‡ªå·±æž„å»ºè¿™ä¸ªäººç‰©ç»†èŠ‚çš„æ—¶å€™,è¿™ç§æƒ…å†µä¸‹,äººç‰©çš„ç”Ÿæˆæ—¶ä¸€æ­¥ä¸€æ­¥ç”Ÿæˆçš„.å†å½“æ‰€æœ‰ç±»åž‹éƒ½é€‰æ‹©å®ŒæˆåŽ,æ‰èƒ½å¤Ÿåˆ›å»ºè¿™ä¸ªäººç‰©. åº”ç”¨åœºæ™¯ å¯¹è±¡è¶³å¤Ÿå¤æ‚,åˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•åº”ä¸Žåˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„ç»„ä»¶å’Œç»„è£…æ–¹å¼åˆ†å¼€. å½“æž„é€ å¯¹è±¡æ—¶è¦æ±‚å¯¹è¿™ä¸ªå¯¹è±¡å…·æœ‰ä¸åŒçš„è¡Œä¸º. å»ºé€ è€…æ¨¡å¼ç»“æž„ ä¸Šå›¾ä¸ºå»ºé€ è€…æ¨¡å¼ç±»å›¾:å…¶ä¸­CharacterBuilder å’Œ Characters ä¸­çš„å±žæ€§ç›¸åŒ,CharacterBuilder å­˜åœ¨çš„ç›®çš„å°±æ˜¯å¤šç§æž„é€ ä¸åŒè¡Œä¸ºçš„Characters . å…·ä½“å¯ä»¥çœ‹ä¸‹é¢ä»£ç å®žä¾‹ ä»£ç è§’è‰²å®žä½“ 1234567891011121314151617181920public class Characters &#123; // è§’è‰²æž„é€ å™¨å†…æœ‰å¤šä¸ªè§’è‰²å±žæ€§ private String name; private int age; private String sex; private String skill; private String weapon; // ä½¿ç”¨æž„é€ å™¨æ¥æž„é€ å®žä½“ å…¶ä¸­å®žä½“å±žæ€§æœ‰builderä¸­æ¥ public Characters(CharacterBuilder builder) &#123; this.name = builder.getName(); this.age = builder.getAge(); this.sex = builder.getSex(); this.skill = builder.getSkill(); this.weapon = builder.getWeapon(); &#125; public void showCharacterBoard()&#123; System.out.println("äººç‰© ï¼š " + this.name + " å¹´é¾„ ï¼š" + this.age + " æ€§åˆ«ï¼š" + this.sex + " æŠ€èƒ½ï¼š" +this.skill + " æ­¦å™¨ï¼š" + this.weapon); &#125; &#125; è§’è‰²æž„å»ºå™¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public class CharacterBuilder &#123; // ä¸Žè§’è‰²å®žä½“ä¿æŒç›¸åŒçš„å±žæ€§ private String name; private int age; private String sex; private String skill; private String weapon; public String getName() &#123; return name; &#125; public int getAge() &#123; return age; &#125; public String getSex() &#123; return sex; &#125; public String getSkill() &#123; return skill; &#125; public String getWeapon() &#123; return weapon; &#125; //æž„é€ åŸºæœ¬å±žæ€§çš„æž„é€ å™¨ public CharacterBuilder buildBasicAttributes(String name , int age, String sex)&#123; //ä¿è¯å§“åä¸èƒ½ä¸ºç©º if(name == null || "".equals(name))&#123; throw new IllegalArgumentException("name can not be empty "); &#125;else &#123; this.name = name; this.age = age; this.sex = sex; &#125; return this; &#125; public CharacterBuilder buildSkill(String skill)&#123; this.skill = skill; return this; &#125; public CharacterBuilder billdWeapon(String weapon)&#123; this.weapon = weapon; return this; &#125; //ç”Ÿæˆè§’è‰²å®žä½“ public Characters build()&#123; return new Characters(this); &#125;&#125; å®¢æˆ·ç«¯ç±»: 12345678910111213public class App &#123; @Test public void testBuildCharacter()&#123; // é“¾å¼è°ƒç”¨,æœ€åŽä½¿ç”¨buildæ–¹æ³•æ–°å»ºä¸€ä¸ªè§’è‰²å®žä½“ Characters characters = new CharacterBuilder() .buildBasicAttributes("jack",18,"man") .buildSkill("Emission laser") .billdWeapon("Laser Cannon") .build(); //æ‰“å°è§’è‰²å±žæ€§é¢æ¿ characters.showCharacterBoard(); &#125;&#125; è¾“å‡ºç»“æžœ: 123Connected to the target VM, address: &apos;127.0.0.1:57347&apos;, transport: &apos;socket&apos;äººç‰© ï¼š jack å¹´é¾„ ï¼š18 æ€§åˆ«ï¼šman æŠ€èƒ½ï¼šEmission laser æ­¦å™¨ï¼šLaser CannonDisconnected from the target VM, address: &apos;127.0.0.1:57347&apos;, transport: &apos;socket&apos;]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ç»„åˆæ¨¡å¼]]></title>
    <url>%2F2019%2F06%2F01%2F2019-06-03-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ç»„åˆæ¨¡å¼å°†å¯¹è±¡ç»„åˆæˆæ ‘ç»“æž„ä»¥è¡¨ç¤ºéƒ¨åˆ†æ•´ä½“å±‚æ¬¡ç»“æž„ã€‚å½“ä½¿ç”¨æ ‘ç»“æž„çš„ä¸Šå±‚å’Œä¸‹å±‚ç»„ä»¶å±žæ€§å¯èƒ½å·®åˆ«å¾ˆå¤§ï¼Œæ‰€ä»¥è¯´ä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦å¯¹è¿™ä¸¤ç±»å¯¹è±¡è¿›è¡Œåˆ†åˆ«å¤„ç†ï¼Œ ä½†Compositeå…è®¸å®¢æˆ·ç«¯ç»Ÿä¸€å¤„ç†å•ä¸ªå¯¹è±¡å’Œå¯¹è±¡ç»„åˆã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥å°†å¶å­ç»„ä»¶ä¸Žæ•´ä½“è¿›è¡Œä¸€è‡´æ€§å¤„ç†ï¼Œå®žçŽ°çš„æ–¹æ³•æ˜¯ç»„ä»¶å’Œæ•´ä½“å®žçŽ°ç›¸åŒæŽ¥å£ã€‚ åº”ç”¨åœºæ™¯ æƒ³è¦è¡¨ç¤ºå¯¹è±¡çš„éƒ¨åˆ†ä¸Žæ•´ä½“ä¹‹é—´çš„å±‚æ¬¡ç»“æž„ æƒ³è¦å®¢æˆ·ç«¯å¿½ç•¥ç»„åˆå¯¹è±¡å’Œå•ä¸ªå¯¹è±¡çš„åŒºåˆ«ï¼Œä½¿ç”¨ç»„åˆæ¨¡å¼ä¼šç»Ÿä¸€å¤„ç†æœ€åŽçš„ç»„åˆå¯¹è±¡ã€‚ ç»„åˆæ¨¡å¼ç»“æž„ æœ€å…¸åž‹çš„æƒ…å†µå°±æ˜¯å¤šçº§æ ‘å½¢èœå•å’Œæ–‡ä»¶å¤¹ç»“æž„ã€‚ç›—ä¸ªå›¾ - - ä¸Šå›¾ï¼Œè™½ç„¶å›½å®¶ï¼Œåœ°åŒºï¼ŒåŸŽå¸‚å±žäºŽä¸åŒçš„å±‚çº§ï¼Œä½†æ˜¯éƒ½éœ€è¦ç»§æ‰¿åŒä¸€ä¸ªæŽ¥å£ï¼Œæ˜¯å®¢æˆ·ç«¯èƒ½å¤Ÿç»Ÿä¸€çš„è°ƒç”¨ä¸åŒå±‚çº§çš„å¯¹è±¡ã€‚ç±»ä¼¼å¤šçº§æ ‘å½¢èœå•çš„ç»“æž„ã€‚ ä»£ç ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ½è±¡ç»„ä»¶ 12345678910111213141516171819202122232425262728293031// è¿™ä¸ªæŠ½è±¡ç»„ä»¶å³å®Œæˆäº†æŠ½è±¡ç»„ä»¶çš„åŠŸèƒ½ï¼Œåˆå®Œæˆäº†â€œæ ‘æžâ€çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿé“¾æŽ¥å„ä¸ªå¶å­èŠ‚ç‚¹public abstract class Component &#123; String name; Integer areaLevel; List&lt;Component&gt; list = new LinkedList&lt;&gt;(); public Component(String name, Integer areaLevel) &#123; this.name = name; this.areaLevel = areaLevel; &#125; public void printName()&#123; System.out.println("Name : "+name); &#125;; public void printLevel()&#123; System.out.println("Area Level :" + areaLevel); &#125;; // è¿™é‡Œåœ¨æŠ½è±¡ç±»çš„æ–¹æ³•ä¸­ç›´æŽ¥æ‰“å°å­ç»„ä»¶ï¼ˆps:åº”ç»Ÿä¸€é€’å½’è¾“å‡ºå­ç»„ä»¶çš„å­ç»„ä»¶ï¼‰ public void printAll()&#123; for (Component p:list ) &#123; System.out.println("å­ç»„ä»¶ï¼š"+ p.name); p.printName(); p.printLevel(); &#125; &#125; public void add(Component component)&#123; list.add(component); &#125;;&#125; ç¬¬äºŒéƒ¨åˆ†ï¼šæ ‘å¶æž„ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081// å›½å®¶çº§åˆ«æ ‘å¶èŠ‚ç‚¹public class Country extends Component &#123; List&lt;Province&gt; provinceList = new LinkedList&lt;&gt;(); public Country(String name, Integer areaLevel) &#123; super(name, areaLevel); &#125; @Override public void printName() &#123; System.out.println("Country Name :" + this.name);; &#125; public void add(Province province)&#123; provinceList.add(province); &#125; public void printAll()&#123; System.out.println("å½“å‰ç»„ä»¶:"+name + "ç­‰çº§ï¼š"+ areaLevel); for (Province p:provinceList ) &#123; p.printAll(); &#125; &#125; @Override public void printLevel() &#123; System.out.println("Country Level :" + this.areaLevel); &#125;&#125;// çœçº§åˆ«æ ‘å¶èŠ‚ç‚¹public class Province extends Component&#123; List&lt;City&gt; cityList = new ArrayList&lt;&gt;(); public Province(String name, Integer areaLevel) &#123; super(name, areaLevel); &#125; @Override public void printName() &#123; System.out.println("Province Name :" +this.name); &#125; public void add(City city)&#123; cityList.add(city); &#125; public void printAll()&#123; System.out.println("å½“å‰ç»„ä»¶:"+name + "ç­‰çº§ï¼š"+ areaLevel); for (City p:cityList ) &#123; p.printAll(); &#125; &#125; @Override public void printLevel() &#123; System.out.println(""); &#125;&#125;// å¸‚çº§åˆ«æ ‘å¶èŠ‚ç‚¹public class City extends Component &#123; public City(String name, Integer areaLevel) &#123; super(name, areaLevel); &#125; @Override public void printName() &#123; System.out.println("City Name :" + this.name); &#125; @Override public void printLevel() &#123; System.out.println("City Level " + this.areaLevel); &#125; public void printAll()&#123; System.out.println("ç»„ä»¶ï¼š"+ this.name); &#125;&#125; ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®¢æˆ·ç«¯ 12345678910public class App &#123; public static void main(String[] args) &#123; Country zhongguo = new Country("china", 0); City langfang = new City("langfang", 2); Province hebei = new Province("hebei", 1); zhongguo.add(hebei); hebei.add(langfang); zhongguo.printAll(); &#125;&#125; 123å½“å‰ç»„ä»¶:china ç­‰çº§ï¼š0å½“å‰ç»„ä»¶:hebei ç­‰çº§ï¼š1ç»„ä»¶ï¼šlangfang]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å•ä¾‹æ¨¡å¼]]></title>
    <url>%2F2019%2F05%2F30%2F2019-05-30-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[å•ä¾‹æ¨¡å¼æ„åœ¨ä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®žä¾‹,å¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹. é€šè¿‡å°†ç±»çš„æž„é€ å™¨ç§æœ‰åŒ–,åªå‘å¤–æä¾›ä¸€ä¸ªå•ç‹¬çš„åˆ›å»ºå”¯ä¸€å¯¹è±¡çš„æ–¹æ³•æ¥å®žçŽ°ä¸€ä¸ªç±»åªåˆ›å»ºä¸€ä¸ªå¯¹è±¡.ä¸»è¦æœ‰ä¸‰ç§å®žçŽ° 1. é¥¿æ±‰æ¨¡å¼ 2. æ‡’æ±‰æ¨¡å¼ 3.ä½¿ç”¨æžšä¸¾å®žçŽ°å•ä¾‹.ä¸‹é¢é€šè¿‡å…·ä½“å®žä¾‹æ¥åˆ†æžå¦‚ä½•åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä»èƒ½æ»¡è¶³å•ä¾‹æ¨¡å¼åˆ›å»ºå¯¹è±¡. é¥¿æ±‰æ¨¡å¼12345678910111213public class Singleton &#123; private Singleton()&#123;&#125;; //1. ä½¿ç”¨é™æ€å˜é‡// private static Singleton singleton = new Singleton(); //2.ä½¿ç”¨é™æ€ä»£ç å— æœªä½¿ç”¨æ—¶é€ æˆå†…å­˜ç©ºé—´æµªè´¹ private static Singleton singleton; static &#123; singleton = new Singleton(); &#125; public Singleton newInstance()&#123; return singleton; &#125;&#125; è¿™ç§æ–¹å¼ä¸ä¼šå½±å“åˆ°å¤šçº¿ç¨‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºç±»çš„è£…è½½æœºåˆ¶åœ¨åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™æ˜¯ä¿è¯ä¸ä¼šæœ‰ç¬¬äºŒä¸ªçº¿ç¨‹è¿›å…¥çš„ã€‚ä½†æ˜¯æœ‰ä¸ªå¾ˆå¤§çš„å¼Šç«¯æ˜¯ä»–ä¸æ˜¯lazy-loadingçš„ï¼Œè¿™å›žäº§ç”Ÿèµ„æºçš„æµªè´¹ï¼Œæ¯”å¦‚åˆ›å»ºå®Œå¯¹è±¡åŽï¼Œè‡ªå§‹è‡³ç»ˆæ²¡ç”¨è¿‡ã€‚æ‰€ä»¥ä¸æŽ¨èä½¿ç”¨ æ‡’æ±‰æ¨¡å¼123456789101112131415161718192021public class Singleton &#123; private void Singleton()&#123;&#125; private static Singleton singleton; // æ™®é€šçš„çº¿ç¨‹ä¸å®‰å…¨çš„ public Singleton newInstance()&#123; if(singleton == null)&#123; singleton = new Singleton(); &#125; return singleton; &#125; //2.é™æ€å†…éƒ¨ç±» ä¸€æ–¹é¢èƒ½å¤Ÿè¾¾åˆ°lazy-loadingçš„æ•ˆæžœï¼Œå¦ä¸€æ–¹é¢èƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºjvmä¿è¯åˆå§‹åŒ–çš„æ—¶å€™åˆ«çš„çº¿ç¨‹æ˜¯ä¸èƒ½è¿›å…¥çš„ private static class newSingleton&#123; private static final Singleton INSTANCE = new Singleton(); &#125; public Singleton newInstanceInnerClass()&#123; return newSingleton.INSTANCE; &#125;&#125; ä¸Šé¢ä»£ç çš„ç¬¬ä¸€ç§æ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹ä¸‹ä¼šå¯¼è‡´å¤±æ•ˆã€‚è€Œç¬¬äºŒç§ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼å®žçŽ°èƒ½å¤Ÿå®žçŽ°çº¿ç¨‹å®‰å…¨å¾—å®œäºŽç±»çš„åŠ è½½æœºåˆ¶ï¼Œç±»ä¼¼é¥¿æ±‰æ¨¡å¼ã€‚ä½†åŒæ—¶å…·æœ‰lazy-Loadingçš„ç‰¹æ€§ã€‚æ˜¯å¸¸ç”¨çš„å•ä¾‹æ¨¡å¼ç”¨æ³•ã€‚ double-checkåŒé‡é”åŒé‡é”ç»“æž„åªæ˜¯ä¸ºäº†æ»¡è¶³å¤šçº¿ç¨‹å®‰å…¨è€Œå»ºç«‹çš„,æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ‡’æ±‰æ¨¡å¼,æ€æƒ³åŒæ‡’æ±‰æ¨¡å¼ç›¸åŒ. 1234567891011121314151617public class DoubleCheck &#123; private void DoubleCheck()&#123;&#125; private volatile DoubleCheck doubleCheck; //ä½¿ç”¨volatileä¿è¯åŽŸå­æ€§ï¼Œé˜²æ­¢é‡æŽ’åº public DoubleCheck newInstance()&#123; if(doubleCheck == null)&#123; // å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åˆ°è¿™æ­¥ aå…ˆè¿›åŒæ­¥å—ï¼Œåœ¨aè¿›å…¥åŽèŽ·å¾—instanceåŽï¼ŒbèŽ·å¾—é”ï¼Œè¿›å…¥åŒæ­¥å—ï¼Œ // è¿™æ—¶å€™ä¸‹ä¸€ä¸ªåˆ¤æ–­å°±èµ·åˆ°ä½œç”¨äº†ï¼Œè¿™æ—¶å€™çš„doubleCheckä¸ä¸ºç©ºï¼Œ // ç›´æŽ¥returnï¼Œå¦åˆ™åˆï¸æ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡ synchronized (DoubleCheck.class)&#123; if(doubleCheck == null)&#123; doubleCheck = new DoubleCheck(); &#125; &#125; &#125; return doubleCheck; &#125;&#125; å®žé™…ä¸Šdouble-checkä¹Ÿæ˜¯æ‡’æ±‰æ¨¡å¼çš„ä¸€ç§ï¼Œèƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å¾ˆå®Œç¾Žã€‚ã€‚ ä½¿ç”¨æžšä¸¾åˆ›å»ºå•ä¾‹åœ¨stackoverflowä¸­æœ‰ä¸€ä¸ªé—®é¢˜What is an efficient way to implement a singleton pattern in Java? è¿™é‡Œçš„å›žç­”å¼•ç”¨åˆ°äº†Effective Java ä½œè€… Joshua Blochå¯¹äºŽå•ä¾‹çš„å¤„ç†æ–¹å¼:ä½¿ç”¨æžšä¸¾ 12345678public enum SingletonEnum &#123; INSTANCE; private final String[] favoriteSongs = &#123; "Hound Dog", "Heartbreak Hotel" &#125;; public void printFavorites() &#123; System.out.println(Arrays.toString(favoriteSongs)); &#125;&#125; è¿™ç§æ–¹æ³•ç­‰åŒä¸Žä½¿ç”¨publicçš„æž„é€ æ–¹æ³•,å¹¶ä¸”æ¯”ä¸Šé¢çš„æ›´åŠ ç®€æ´,å¹¶ä¸”å³ä½¿é¢å¯¹å¤æ‚çš„åå°„ä¸Žåºåˆ—åŒ–ä¹Ÿèƒ½å¤Ÿä¿è¯å•ä¸€çš„å®žä¾‹.è™½ç„¶çŽ°å®žä»£ç ä¸­åº”ç”¨çš„è¾ƒå°‘,ä½†æ˜¯è¿™ç§ä½¿ç”¨æžšä¸¾ç±»åž‹æ˜¯åˆ›å»ºå•ä¾‹çš„æœ€ä½³æ–¹æ³•. 12345public void testEnum() &#123; SingletonEnum singletonEnum = SingletonEnum.INSTANCE; SingletonEnum singletonEnumCopy = SingletonEnum.INSTANCE; Assert.assertEquals(singletonEnum, singletonEnumCopy); //é€šè¿‡&#125;]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ideaå¯¹spring bootåº”ç”¨è¿›è¡Œçƒ­éƒ¨ç½²]]></title>
    <url>%2F2019%2F05%2F29%2F2019-02-17-%E4%BD%BF%E7%94%A8IDEA%E8%AE%BE%E7%BD%AEspringboot%E7%83%AD%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨ideaå¯¹spring bootåº”ç”¨è¿›è¡Œçƒ­éƒ¨ç½²POMåœ¨pom.xmlä¸­æ·»åŠ mavenä¾èµ–123456&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;!-- è¿™è¡Œå¿…å¡« --&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; å¹¶ä¸”åœ¨åŽé¢çš„æ’ä»¶é…ç½®ä¸­é…ç½®dev123456789101112&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;!--å¦‚æžœæ²¡æœ‰è¯¥é¡¹é…ç½®ï¼Œdevtoolsä¸ä¼šèµ·ä½œç”¨ï¼Œå³åº”ç”¨ä¸ä¼šrestart --&gt; &lt;fork&gt;true&lt;/fork&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; IDEAåœ¨IDEAä¸­æ·»åŠ é…ç½®å¦‚ä¸‹ æ‰“å¼€ setting ,æœç´¢ compiler åŽï¼ŒæŠŠ Build Project automaticial é€‰é¡¹å‹¾ä¸Š ä½¿ç”¨ ctrl+shift+A å¿«æ·é”®æ‰“å¼€çª—å£ï¼Œå¹¶æœç´¢ Registry... ã€‚å‹¾é€‰ compiler.automake.allow.when.app.running]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ©ç”¨springbootæž„å»ºjpa+springdata+reståº”ç”¨çš„åŸºæœ¬é…ç½®è¿‡ç¨‹]]></title>
    <url>%2F2019%2F05%2F29%2F2019-01-30-%E5%88%A9%E7%94%A8springboot%E6%9E%84%E5%BB%BASpringData%2BJAP%2BRestFul%E5%BA%94%E7%94%A8%2F</url>
    <content type="text"><![CDATA[åˆ©ç”¨springbootæž„å»ºjpa+springdata+reståº”ç”¨çš„åŸºæœ¬é…ç½®è¿‡ç¨‹å‰è¿°åˆ©ç”¨SpringBootæ•´åˆspringData+JPAåº”ç”¨éžå¸¸æ–¹ä¾¿ï¼Œæ‰€ä»¥æœ¬ç€å­¦ä¹ çš„ç›®çš„æ¥æž„å»ºä¸€ä¸ªåŸºæœ¬çš„webåº”ç”¨ï¼Œé…ç½®èµ·æ¥éžå¸¸ç®€å•ã€‚ä¸‹é¢æ¥è¯´è¯´é…ç½®è¿‡ç¨‹å’Œè¸©è¿‡çš„å‘ã€‚ è¿‡ç¨‹åŽç«¯é…ç½®å› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯IDEAçš„spring initalizerï¼Œå‹¾é€‰å¦‚ä¸‹ï¼š Rest Repositories Thymeleaf JPA H2 Lombok éœ€è¦ideä¸‹è½½æ’ä»¶ä½¿ç”¨ ä»¥å‰åœ¨é…ç½®spring MVCæŽ¥å£æ—¶ï¼Œå¾€å¾€ä¼šæµªè´¹å¾ˆé•¿æ—¶é—´é…ç½®reståœ°å€ï¼Œspringdataè§£å†³äº†è¿™ä¸ªä¸€éåˆä¸€ééº»çƒ¦çš„è¿‡ç¨‹ã€‚ é¦–å…ˆé…ç½®å®žä½“ç±»ä»»ä½•åŸºäºŽSpring Data RESTçš„åº”ç”¨ç¨‹åºçš„åŸºçŸ³éƒ½æ˜¯åŸŸå¯¹è±¡ã€‚å…¶ä¸­çš„@Idç­‰éƒ½æ˜¯JPAè¯­æ³•ï¼Œå…·ä½“ç”¨æ³•å¯ä»¥çœ‹ä¸Šä¸€ç¯‡æ–‡ç« ã€‚ 12345678910111213141516171819@Entity@Getter@Setter@Table(name = &quot;user&quot;)public class User &#123; @Id private Long id; @Column(name = &quot;username&quot;,nullable = true,length = 255) private String username; @Column(name = &quot;password&quot;,nullable = true,length = 255) private String password; @OneToOne() @JoinColumn(name = &quot;person_id&quot;,nullable = false) private Person person;&#125; å®šä¹‰ä¸€ä¸ªå­˜å‚¨åº“Spring Data RESTåº”ç”¨ç¨‹åºçš„å¦ä¸€ä¸ªå…³é”®éƒ¨åˆ†æ˜¯åˆ›å»ºç›¸åº”çš„å­˜å‚¨åº“å®šä¹‰ 12public interface UserRepository extends JpaRepository&lt;User,Long&gt; &#123;&#125; é…ç½®serviceå’Œcontroller123456789public class UserServiceImpl implements UserService &#123; @Autowired UserRepository userRepository; @Override public void save(User user) &#123; user.setPassword(...); //å®šä¹‰ä»£ç  userRepository.save(user); &#125;&#125; é…ç½®æ•°æ®åº“å’Œapplication.properties1234567891011121314151617# é©±åŠ¨é…ç½®ä¿¡æ¯spring.datasource.type=com.alibaba.druid.pool.DruidDataSourcespring.datasource.url = jdbc:mysql://127.0.0.1:3306/jreact?useUnicode=true&amp;characterEncoding=utf-8spring.datasource.username = rootspring.datasource.password = 123456spring.datasource.driverClassName = com.mysql.jdbc.Driver#éžä¸¥æ ¼çš„htmlè§£æžspring.thymeleaf.mode =LEGACYHTML5# å½©è‰²è¾“å‡ºspring.output.ansi.enabled=DETECT# è®¾ç½®é»˜è®¤å¼•æ“Žspring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect#é…ç½®è‡ªåŠ¨å»ºè¡¨ï¼šupdata:æ²¡æœ‰è¡¨æ–°å»ºï¼Œæœ‰è¡¨æ›´æ–°æ“ä½œ,æŽ§åˆ¶å°æ˜¾ç¤ºå»ºè¡¨è¯­å¥spring.jpa.hibernate.ddl-auto=updatespring.jpa.show-sql=true#é…ç½®spring data restçš„åŸºåœ°å€spring.data.rest.base-path=/api å¯åŠ¨åº”ç”¨è®¿é—® localhost:8080/api/users å¯ä»¥æŸ¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯,è¯´æ˜Žé…ç½®æˆåŠŸäº†ã€‚åªæ˜¯è¡¨ä¸­è¿˜æ²¡æœ‰æ•°æ®ï¼Œå¦å¤–è¡¨å·²ç»ç”±è‡ªåŠ¨å»ºå¥½ï¼Œä»¥åŽå¦‚æžœæ›´æ–°ï¼Œç›´æŽ¥æ›´æ–°ç¨‹åºå°±å¥½äº†ã€‚ 1234567891011121314151617181920&#123; &quot;_embedded&quot; : &#123; &quot;users&quot; : [ ] &#125;, &quot;_links&quot; : &#123; &quot;self&quot; : &#123; &quot;href&quot; : &quot;http://localhost:8080/api/users&#123;?page,size,sort&#125;&quot;, &quot;templated&quot; : true &#125;, &quot;profile&quot; : &#123; &quot;href&quot; : &quot;http://localhost:8080/api/profile/users&quot; &#125; &#125;, &quot;page&quot; : &#123; &quot;size&quot; : 20, &quot;totalElements&quot; : 0, &quot;totalPages&quot; : 0, &quot;number&quot; : 0 &#125;&#125; å‰ç«¯é…ç½®ä½¿ç”¨reactæ¡†æž¶ä½œä¸ºå‰ç«¯æ¡†æž¶ï¼Œé¦–å…ˆä¸‹è½½create-react-appä½œä¸ºå¼€å‘çš„è„šæ‰‹æž¶ã€‚è¿™é‡Œæˆ‘é€‰ç”¨çš„æ˜¯meterial-UIçš„create-react-appï¼ŒæŒ‰ç…§æ–‡æ¡£ä¸­çš„è¯´æ˜Žæ¥ä¸‹è½½å¹¶å®‰è£…ã€‚ é…ç½®proxyåœ¨srcç›®å½•ä¸‹æ–°å»ºåç§°ä¸ºsetupProxy.jsçš„æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š 123456const proxy = require(&apos;http-proxy-middleware&apos;);module.exports = function(app) &#123; app.use(proxy(&apos;/api/&apos;, &#123; target: &apos;http://localhost:8080/&apos; &#125; ));&#125; å…¶ä¸­/api/ä¸ºè®¿é—®åŽç«¯çš„åŸºåœ°å€ï¼Œtargetä¸ºè®¿é—®åŽç«¯çš„ä¸»æœºåœ°å€å’Œç«¯å£å· é…ç½®routerä½¿ç”¨npmä¸‹è½½ react-router-domåŽï¼Œåœ¨srcç›®å½•ä¸‹æ–°å»ºrouteræ–‡ä»¶å¤¹ï¼Œå¹¶åˆ›å»ºbaseRouter.jsæ–‡ä»¶ï¼Œå¼•å…¥åˆšä¸‹è½½çš„åŒ…ï¼ŒåŸºæœ¬çš„æ–‡ä»¶å†…å®¹å¦‚ï¼š 12345678910111213141516171819202122import React from &quot;react&quot;;import &#123; BrowserRouter as Router, Route, Link,Switch &#125; from &quot;react-router-dom&quot;;import Index from &quot;../pages/index&quot;import SignIn from &quot;../pages/login/signIn&quot;import Error404 from &quot;../pages/error/404&quot;const About = () =&gt; &lt;h2&gt;About&lt;/h2&gt;;const Users = () =&gt; &lt;h2&gt;Users&lt;/h2&gt;;const AppRouter = () =&gt; ( &lt;Router&gt; &lt;div&gt; &lt;Switch&gt; &lt;Route exact path=&quot;/&quot; component=&#123;Index&#125; /&gt; &lt;Route path=&quot;/SignIn&quot; component=&#123;SignIn&#125; /&gt; &lt;Route path=&quot;/About&quot; component=&#123;About&#125; /&gt; &#123;/* when none of the above match, &lt;NoMatch&gt; will be rendered */&#125; &lt;Route component=&#123;Error404&#125; /&gt; &lt;/Switch&gt; &lt;/div&gt; &lt;/Router&gt;);export default AppRouter; å¹¶æœ€åŽåœ¨index.jså…¥å£æ–‡ä»¶ä¸­å†™å…¥ 1ReactDOM.render(&lt;AppRouter /&gt;, document.getElementById(&apos;root&apos;)); è¿™æ ·å¯ä»¥è®¿é—®localhost:3000çš„æ—¶å€™å¯ä»¥è®¿é—®åˆ°Indexæ–‡ä»¶å†…å®¹ã€‚]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å·¥åŽ‚æ¨¡å¼]]></title>
    <url>%2F2019%2F05%2F29%2F2019-05-29-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å·¥åŽ‚æ¨¡å¼å·¥åŽ‚æ¨¡å¼åˆ†ä¸ºç®€å•å·¥åŽ‚æ¨¡å¼,å·¥åŽ‚æ–¹æ³•æ¨¡å¼,æŠ½è±¡å·¥åŽ‚æ–¹æ³•æ¨¡å¼ä¸‰ç§,ä½†æ˜¯å…¶ä¸­ç®€å•å·¥åŽ‚æ–¹æ³•å…¶å®žä¸åœ¨23ä¸­è®¾è®¡æ¨¡å¼ä¹‹ä¸­,éƒ½å±žäºŽåˆ›å»ºåž‹çš„è®¾è®¡æ¨¡å¼. ç®€å•å·¥åŽ‚æ¨¡å¼ç®€å•å·¥åŽ‚æ–¹æ³•å…¶å®žä¸å±žäºŽå·¥åŽ‚æ¨¡å¼çš„,ä»–åªæ˜¯ä¸€ç§è®¾è®¡æ€è·¯,æ˜¯ä¸€ç§å¯¹æŽ¥å£çš„ç¼–ç¨‹çš„ä¹ æƒ¯è€Œå·².ç®€å•å·¥åŽ‚æŠ½è±¡å‡ºä¸€ä¸ªå…¬å…±çš„æŽ¥å£,ä¸åŒçš„å¯¹è±¡å®žçŽ°è¿™ä¸ªå…¬å…±çš„æŽ¥å£.å®šä¹‰ä¸€ä¸ªå·¥åŽ‚ç±»,æ ¹æ®ä¸åŒçš„æ¡ä»¶æ¥è¿”å›žä¸åŒç±»åž‹çš„å®žä¾‹. ç®€å•å·¥åŽ‚ç»“æž„ç®€å•å·¥åŽ‚çš„ç®€å•ç±»å›¾å¦‚ä¸‹: ä»£ç æŽ¥å£ä¸Žå®žçŽ°ç±» 1234567891011121314151617public interface Shoes &#123; void getColor();&#125;public class RedShoes implements Shoes &#123; @Override public void getColor() &#123; System.out.println(" is red color shoes"); &#125;&#125; public class WhiteShoes implements Shoes &#123; @Override public void getColor() &#123; System.out.println("is white color shoes"); &#125;&#125; å·¥åŽ‚ç±» 123456789101112public class ShoesFactory &#123; public Shoes getShoes(String color)&#123; if("red".equals(color))&#123; return new RedShoes(); &#125;else if("white".equals(color))&#123; return new WhiteShoes(); &#125;else &#123; return new OtherShoes(); &#125; &#125;&#125; å·¥åŽ‚æ–¹æ³•æ¨¡å¼åˆ›å»ºä¸€ä¸ªå…¬å…±çš„å·¥åŽ‚æŽ¥å£ç±»,å…¶ä¸­åœ¨æŽ¥å£ç±»ä¸­å®šä¹‰å·¥åŽ‚æ–¹æ³•.ä½†æ˜¯é€šè¿‡å®žçŽ°ç±»åŽ»å®žçŽ°ç»“æž„,åœ¨è°ƒç”¨çš„æ—¶å€™é€šè¿‡ä½¿ç”¨å®žçŽ°ç±»æ¥å®žä¾‹åŒ–ç‰¹å®šçš„å·¥åŽ‚.ä¹Ÿå°±æ˜¯è¯´,å·¥åŽ‚æ–¹æ³•ç±»éœ€è¦é€šè¿‡å­ç±»åŽ»å®žä¾‹åŒ–å»ºé€ å¯¹è±¡. å·¥åŽ‚æ–¹æ³•ç»“æž„å·¥åŽ‚æ–¹æ³•çš„ç±»å›¾å¦‚ä¸‹: å’Œä¸Šé¢ç®€å•å·¥åŽ‚ç±»çš„ä¾‹å­ç±»ä¼¼,è¿™é‡ŒåŒæ ·é€šè¿‡å®žçŽ°éž‹å­è¿™ä¸ªæŽ¥å£æ¥åˆ›å»ºçº¢éž‹å­å’Œç™½éž‹å­,ç®€å•å·¥åŽ‚æ— è®ºç™½éž‹å­ã€çº¢éž‹å­è¿˜æ˜¯å…¶ä»–é¢œè‰²çš„éž‹å­éƒ½æ˜¯åŒä¸€ä¸ªå·¥åŽ‚æ¥åˆ›å»ºå‡ºæ¥çš„,è€Œ å·¥åŽ‚æ–¹æ³•æ˜¯é€šè¿‡å…·ä½“çš„ç™½éž‹å­å·¥åŽ‚å’Œçº¢éž‹å­å·¥åŽ‚æ¥åˆ†åˆ«ç”Ÿäº§å¯¹åº”çš„ç™½éž‹å­å’Œçº¢éž‹å­. æ‰€ä»¥å¦‚ç±»å›¾ä¸­æ‰€å±•ç¤ºçš„ä¸€æ ·,RedShoesFactoryå’ŒWhiteShoesFactroyéƒ½å®žçŽ°æ¥æŽ¥å£ShoesFactory,å¹¶ä¸”åœ¨getshoesæ–¹æ³•é‡Œåˆ†åˆ«åˆ›å»ºå¯¹åº”çš„RedShoeså’ŒWhiteShoes. å·¥åŽ‚æ–¹æ³•æ¨¡å¼ä½¿ç”¨åœºæ™¯: å®¢æˆ·ç«¯ä¸å¿…è¦çŸ¥é“å®ƒéœ€è¦åˆ›å»ºå¯¹è±¡çš„ç±»,åªéœ€è¦åˆ›å»ºå®Œå·¥åŽ‚åŽ,ä»Žå·¥åŽ‚ä¸­ç›´æŽ¥å–å¯¹åº”çš„å¯¹è±¡å³å¯. å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨æŒ‡å®šå®žçŽ°å­ç±»æ¥åˆ›å»ºå¯¹åº”å¯¹è±¡. ä»£ç 12345678910111213141516171819202122232425// éž‹å­æŽ¥å£ä¸Žå®žçŽ°åŒç®€å•å·¥åŽ‚ä¸­çš„ç›¸åŒ,æ‰€ä»¥è¿™é‡Œçœç•¥....public interface ShoesFactory &#123; Shoes getShoes();&#125;public class RedShoesFactory implements ShoesFactory&#123; public Shoes getShoes()&#123; return new RedShoes(); &#125;&#125;public class WhiteShoesFactory implements ShoesFactory&#123; public Shoes getShoes()&#123; return new WhiteShoes(); &#125;&#125;// å®¢æˆ·ç«¯è°ƒç”¨public class App &#123; public static void main(String[] args) &#123; ShoesFactory redFactory = new RedShoesFactory(); // åªéœ€è¦åˆ›å»ºä¸€ä¸ªå·¥åŽ‚,æ¯æ¬¡èŽ·å–çº¢éž‹å­,åªéœ€è°ƒç”¨å·¥åŽ‚çš„getShoesæ–¹æ³•å³å¯ Shoes redshoes = redFactory.getShoes(); redshoes.getColor(); ShoesFactory whiteFactory = new WhiteShoesFactory(); Shoes whiteshoes = whiteFactory.getShoes(); &#125;&#125; æŠ½è±¡å·¥åŽ‚æ¨¡å¼æä¾›ç”¨äºŽåˆ›å»ºç›¸å…³æˆ–ä»Žå±žçš„å¯¹è±¡æ—(å¤šä¸ªç»„ä»¶,å¹¶ä¸”ç»„ä»¶ä¹‹é—´æ˜¯ç”±å¿…è¦è”ç³»çš„)çš„æŽ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå…¶å…·ä½“ç±».æ˜¯å¯¹å·¥åŽ‚æ–¹æ³•çš„å†æ¬¡å»¶å±•. æŠ½è±¡æ–¹æ³•ç»“æž„ ä»£ç 12345678910111213141516// éž‹åº•public interface Sole &#123; // ææ–™ void getMaterial();&#125;// éž‹å¸¦public interface Shoelace &#123; // é•¿åº¦ void length();&#125;public interface ShoesFactory &#123; public Sole createSole(); public Shoelace createShoelace();&#125; Nikeå·¥åŽ‚éœ€è¦ç”Ÿäº§éž‹å¸¦å’Œéž‹åº• 123456789101112131415public class NikeBrandSole implements Sole&#123; @Override public void getMaterial() &#123; // æ©¡èƒ¶éž‹åº• System.out.println("rubber"); &#125;&#125;public class NikeBrandShoelace implements Shoelace&#123; @Override public void length() &#123; System.out.println("1 m "); &#125;&#125; åŒæ ·çš„LiNingå·¥åŽ‚éœ€è¦ç”Ÿäº§éž‹å¸¦å’Œéž‹åº• 1234567891011121314public class LiNingBrandSole implements Sole &#123; @Override public void getMaterial() &#123; System.out.println("air cushion"); &#125;&#125;public class LiNingBrandShoelace implements Shoelace &#123; @Override public void length() &#123; System.out.println("1.5 m"); &#125;&#125; LiNingå’ŒNikeå·¥åŽ‚éƒ½éœ€è¦ç”Ÿäº§å„è‡ªçš„éž‹å¸¦å’Œéž‹åº• 12345678910111213141516171819202122232425public class NikeShoeFactory implements ShoesFactory &#123; @Override public Sole createSole() &#123; return new NikeBrandSole(); &#125; @Override public Shoelace createShoelace() &#123; return createShoelace(); &#125;&#125;public class LiNingShoeFactory implements ShoesFactory &#123; @Override public Sole createSole() &#123; return new LiNingBrandSole(); &#125; @Override public Shoelace createShoelace() &#123; return new LiNingBrandShoelace(); &#125;&#125; å®¢æˆ·ç«¯ä»£ç ,åˆ›å»ºå·¥åŽ‚,ç”Ÿäº§å„è‡ªç»„ä»¶ 12345678910public class App &#123; public static void main(String[] args) &#123; ShoesFactory shoesFactory = new NikeShoeFactory(); Shoelace nikeLace = shoesFactory.createShoelace(); Sole nikeSole = shoesFactory.createSole(); nikeLace.length(); nikeSole.getMaterial(); &#125;&#125;]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ç­–ç•¥æ¨¡å¼]]></title>
    <url>%2F2019%2F05%2F27%2F2019-05-28-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[javaè®¾è®¡æ¨¡å¼ä¹‹ç­–ç•¥æ¨¡å¼å¦‚æžœå­˜åœ¨ä¸€ç§è¡Œä¸ºåœ¨å¤šç§æƒ…å†µä¸‹çš„å®žçŽ°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¯èƒ½ä¼šä½¿ç”¨if...else if...else..æ¥å®žçŽ°ã€‚ä½†æ˜¯æ¯å¢žåŠ ä¸€ç§æƒ…å†µå°±è¦å¢žåŠ ä¸€ç§ifåˆ¤æ–­ï¼Œè¿™æ ·ä¸ç¬¦åˆjavaè®¾è®¡çš„è§„èŒƒï¼Œè¿™æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥æ›¿æ¢è¿™ç§ç¹ççš„if..else ç­–ç•¥è®¾è®¡æ¨¡å¼æ˜¯è¡Œä¸ºè®¾è®¡æ¨¡å¼çš„ä¸€ç§.å½“ä½¿ç”¨å¤šç§ç®—æ³•è§£å†³ä¸€ä¸ªç‰¹æ®Šçš„ä»»åŠ¡çš„æ—¶å€™,å®¢æˆ·ç«¯å†³å®šä½¿ç”¨å“ªç§å…·ä½“ç®—æ³•è¿›è¡Œç‰¹å®šçš„å®žçŽ°. å“ªç§æƒ…å†µä¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼ä»¥ä¸‹æƒ…å†µå¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼: è®¸å¤šç›¸å…³ç±»åªæœ‰è¡Œä¸ºä¸Šæœ‰æ‰€ä¸åŒ,ç­–ç•¥æ¨¡å¼å¯ä»¥é€šè¿‡ç›¸åŒçš„è¡Œä¸ºæ–¹æ³•æ¥é…ç½®è¿™äº›ç±». å½“éœ€è¦ä½¿ç”¨åˆ°ç®—æ³•çš„å˜ç§çš„æ—¶å€™,å½“å®šä¹‰ä¸åŒçš„è¡Œä¸ºå‚æ•°,å¦‚æžœä½¿ç”¨ç±»çš„å±‚æ¬¡ç»“æž„å®žçŽ°çš„æ—¶å€™,å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼(å½“ä½¿ç”¨æ–¹æ³•å±‚æ¬¡ç»“æž„çš„æ—¶å€™å°±æ˜¯å¤šæ€) å®¢æˆ·ç«¯ä¸ç”¨æ¸…æ¥šç®—æ³•çš„ç»†èŠ‚å®žçŽ°,åªéœ€å…³æ³¨æŽ¥å£.é¿å…æš´éœ²å…·ä½“çš„ç±»çš„å®žçŽ°ã€ç‰¹æ®Šç®—æ³•çš„æ•°æ®ç»“æž„. ä¸€ä¸ªç±»å®šä¹‰äº†å¤šç§ä¸åŒçš„è¡Œä¸º,å¹¶ä¸”ä½¿ç”¨æ‚ä¹±çš„æ¡ä»¶è¿›è¡Œåˆ¤æ–­å…·ä½“ä½¿ç”¨å“ªä¸€ä¸ªæ¡ä»¶,è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥ä»£æ›¿,å¯¹ä¸åŒçš„ç­–ç•¥å½¢æˆä¸åŒçš„ç±».å¯ä»¥æ¸…æ™°çš„è¡¨è¾¾å‡ºç±»çš„ä½œç”¨ä¸Žå®žçŽ°çš„è¡Œä¸ºæ–¹å¼. ç­–ç•¥æ¨¡å¼ç»“æž„ å¦‚ä¸Šå›¾å®šä¹‰ä¸€ä¸ªæ€»çš„TrafficæŽ¥å£,é‡Œé¢æœ‰ä¸€ä¸ªgo()æ–¹æ³•.ä½¿ç”¨carå’Œwalkåˆ†åˆ«æ¥å®žçŽ°æŽ¥å£,å¹¶ä¸”å®žçŽ°æŽ¥å£ä¸­çš„goæ–¹æ³•. Contextç±»æ˜¯çŽ¯å¢ƒç±»,æŒæœ‰ä¸€ä¸ªTrafficStrategyçš„å¼•ç”¨,éšè—å…·ä½“çš„ç­–ç•¥æŽ¥å£çš„å®žçŽ°,è®©å®¢æˆ·ç«¯ä¸“æ³¨äºŽæ–¹æ³•çš„è°ƒç”¨. ä»£ç å®žçŽ°12345678910111213141516public interface TrafficStrategy &#123; void go();&#125;public class WalkStrategy implements TrafficStrategy&#123; @Override public void go() &#123; System.out.println("i am walking"); &#125;&#125;public class CarStrategy implements TrafficStrategy &#123; @Override public void go() &#123; System.out.println("i am driving"); &#125;&#125; contextç±» 12345678910111213141516171819public class Context &#123; private TrafficStrategy trafficStrategy; public Context(TrafficStrategy trafficStrategy) &#123; this.trafficStrategy = trafficStrategy; &#125; public TrafficStrategy getTrafficStrategy() &#123; return trafficStrategy; &#125; public void setTrafficStrategy(TrafficStrategy trafficStrategy) &#123; this.trafficStrategy = trafficStrategy; &#125; public void doStrategy()&#123; trafficStrategy.go(); &#125;&#125; Appå®¢æˆ·ç«¯ç±» 123456public class App &#123; public static void main(String[] args) &#123; Context context = new Context(new CarStrategy()); context.doStrategy(); &#125;&#125;]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è´£ä»»é“¾æ¨¡å¼]]></title>
    <url>%2F2019%2F05%2F27%2F2019-05-27-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è´£ä»»é“¾æ¨¡å¼è´£ä»»é“¾æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼.é€šè¿‡ä¸ºå¤šä¸ªå¯¹è±¡å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„æ–¹å¼,å®žçŽ°é™ä½Žå‘é€è€…ä¸ŽæŽ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆæ€§.å¯¹è±¡é“¾ç”±ä¸€ä¸ªå¯¹è±¡å¯¹ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ç»„æˆä¸€æ¡é“¾,è¯·æ±‚åœ¨è¿™ä¸ªé“¾ä¸Šä¼ é€’,çŸ¥é“è¿™ä¸ªé“¾ä¸Šçš„æŸä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒ.ä¸‹é¢å¼•ç”¨https://java-design-patterns.com/patterns/chain/ æ¥è¯´æ˜Ž Kingåªéœ€è¦ä¸‹è¾¾å‘½ä»¤,å…·ä½“è°æ¥åšå¹¶ä¸å…³å¿ƒ,ç„¶è€Œè¿™ä¸ªå‘½ä»¤ä¼šé€šè¿‡commander, officer,soldier,è¿™ä¸‰ç±»äººåªéœ€è¦æ¥æ‰§è¡Œå„è‡ªè´Ÿè´£çš„éƒ¨åˆ†,å®ŒæˆåŽä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŒè´£çš„äººå°±è¡Œäº†.è¿™å°±æ˜¯è´£ä»»é“¾æ¨¡å¼.ä¸‹é¢æ ¹æ®ä¾‹å­ç±»å›¾æ¥åˆ†æžè´£ä»»é“¾ä¸­çš„ç»“æž„å…³ç³». è´£ä»»é“¾çš„ç»“æž„ æŠ½è±¡å¤„ç†è€… RequestHandler,å®šä¹‰æŽ¥å£æ–¹æ³•,ä½¿ç”¨handlerRequestæ–¹æ³•è§„å®šå®žçŽ°ç±»é€šè¿‡è¯¥æ–¹æ³•æ¥è§„èŒƒå­ç±»çš„å®žçŽ°. å…·ä½“å¤„ç†è€… OrcCommanderå’ŒOrcOfficer,é€šè¿‡ç»§æ‰¿RequestHandlerå®žçŽ°å…¶ä¸­çš„handleRequestæ–¹æ³• è¯·æ±‚Request,Kingé€šè¿‡æ–¹æ³•å°†requestæ”¾å…¥å¤„ç†è€…é“¾ä¸­,å¤„ç†è€…ä¸€æ¬¡æ‰§è¡Œè¿™ä¸ªrequest. è´£ä»»é“¾æ¨¡å¼çš„ä½¿ç”¨çŽ¯å¢ƒ 1ã€æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œå…·ä½“å“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚ç”±è¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¡®å®šã€‚2ã€åœ¨ä¸æ˜Žç¡®æŒ‡å®šæŽ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚ã€‚3ã€å¯åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚ ç¤ºä¾‹ä»£ç :java-design-patterns RequestHandler 123456789101112131415161718192021public abstract class RequestHandler &#123; private RequestHandler next; public RequestHandler(RequestHandler next) &#123; this.next = next; &#125; public void handleRequest(Request req) &#123; if (next != null) &#123; next.handleRequest(req); &#125; &#125; protected void printHandling(Request req) &#123; System.out.println(&quot;1.&quot;+req.getRequestType() + &quot; 2.&quot;+req.getRequestDescription()); &#125; @Override public abstract String toString(); &#125; ` å…·ä½“å¤„ç†è€… 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public class OrcCommander extends RequestHandler &#123; public OrcCommander(RequestHandler handler) &#123; super(handler); &#125; @Override public void handleRequest(Request req) &#123; if (req.getRequestType().equals(RequestType.DEFEND_CASTLE)) &#123; printHandling(req); req.markHandled(); &#125; else &#123; super.handleRequest(req); &#125; &#125; @Override public String toString() &#123; return &quot;Orc commander&quot;; &#125;&#125;public class OrcOfficer extends RequestHandler &#123; public OrcOfficer(RequestHandler next) &#123; super(next); &#125; @Override public void handleRequest(Request req) &#123; if (req.getRequestType().equals(RequestType.TORTURE_PRISONER)) &#123; printHandling(req); req.markHandled(); &#125; else &#123; super.handleRequest(req); &#125; &#125; @Override public String toString() &#123; return &quot;Orc officer&quot;; &#125;&#125;```text- Requestè¯·æ±‚ public class Request { private final RequestType requestType; private final String requestDescription; private boolean handled; public Request(final RequestType requestType, final String requestDescription) { this.requestType = Objects.requireNonNull(requestType); this.requestDescription = Objects.requireNonNull(requestDescription); } public String getRequestDescription() { return requestDescription; } public RequestType getRequestType() { return requestType; } public void markHandled() { this.handled = true; } public boolean isHandled() { return this.handled; } @Override public String toString() { return getRequestDescription(); }} 12- å®¢æˆ·ç«¯å‘èµ·å‘½ä»¤è€… public class King { private static RequestHandler chain; private void buildChain() { chain = new OrcCommander(new OrcOfficer(null)); } private void makeRequest(Request req) { chain.handleRequest(req); } public static void main(String[] args) { King king = new King(); king.buildChain(); king.makeRequest(new Request(RequestType.DEFEND_CASTLE, â€œdefend castleâ€)); king.makeRequest(new Request(RequestType.TORTURE_PRISONER, â€œtorture prisonerâ€)); }} 12]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springé‡ç‚¹çŸ¥è¯†å­¦ä¹ ]]></title>
    <url>%2F2019%2F05%2F05%2F2019-05-05-Spring_Framework%E9%87%8D%E7%82%B9%E5%AD%A6%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[Spring Frameworkä½¿ç”¨springå¯ä»¥è½»æ˜“çš„åˆ›å»ºä¸€ä¸ªä¼ä¸šçº§åº”ç”¨,å®ƒä½¿ç”¨Javaè¯­è¨€æ‰€æœ‰çš„ä¼ä¸šçº§çŽ¯å¢ƒä¸­çš„æ‰€æœ‰ä¸œè¥¿,springæ˜¯å¼€æºçš„,æ‹¥æœ‰åºžå¤§è€Œæ´»è·ƒçš„ç¤¾åŒºæ¥æä¾›æŒç»­çš„æ”¯æŒ. Spring Corespringåˆ†ä¸ºå¤šä¸ªæ¨¡å—,å…¶ä¸­coreä¸ºå…¶ä¸­çš„ä¸€ä¸ª,é‡Œé¢åŒ…å«springçš„æ ¸å¿ƒæŠ€æœ¯ç‚¹ IOCå®¹å™¨(æŽ§åˆ¶åè½¬)IOCä¹Ÿè¢«æˆä¸ºä¾èµ–æ³¨å…¥,è¿™æ˜¯ç”±ä¸€ä¸ªå¯¹è±¡å®šä¹‰ä»–æ‰€ä¾èµ–çš„å…³ç³»çš„è¿‡ç¨‹.å½“åˆ›å»ºè¿™ä¸ªbeançš„æ—¶å€™ä¹ŸåŒæ—¶åˆ›å»ºè¿™äº›ä¾èµ–ä¾›å…¶ä½¿ç”¨.è¿™æ ·çš„æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯åè½¬æŽ§åˆ¶çš„è¿‡ç¨‹,æ¯”å¦‚è¯´å»ºæˆ¿å­,ä»¥å‰éœ€è¦ç –,ç“¦,æ°´æ³¥æ‰èƒ½å»ºé€ æˆ¿å­,å¦‚æžœä¸å®žç”¨iocæ—¶,å°±æ˜¯è‡ªå·±åŽ»é€ ç –,é€ ç“¦,ç„¶åŽä½¿ç”¨.çŽ°åœ¨ä½¿ç”¨iocå®¹å™¨,åªéœ€è¦æŠŠç –,ç“¦,æ°´æ³¥å†™åˆ°æ¸…å•ä¸Š,iocå®¹å™¨è‡ªåŠ¨æŠŠè¿™äº›å‡†å¤‡å¥½ä¾›ä½¿ç”¨,çœåŽ»æ¥è‡ªå·±åˆ¶é€ çš„è¿‡ç¨‹. org.springframework.beans å’Œ org.springframework.context æ˜¯springå®žçŽ°IOCå®¹å™¨çš„åŸºç¡€.BeanFactoryæŽ¥å£æ˜¯èƒ½å¤Ÿç®¡ç†ä»»ä½•å¯¹è±¡çš„é«˜çº§çš„é…ç½®æŽ¥å£,ApplicationContextæ˜¯BeanFactoryçš„å­æŽ¥å£.å› ä¸º: æ›´å®¹æ˜“å’ŒSpring çš„AOPç‰¹æ€§ç›¸ç»“åˆ æ¶ˆæ¯èµ„æºå¤„ç†,ç”¨äºŽå›½é™…åŒ–é—®é¢˜ äº‹ä»¶å‘å¸ƒ ç”¨äºŽç‰¹å®šçš„ä¸Šä¸‹æ–‡æ¯”å¦‚webåº”ç”¨ç¨‹åºçš„WebApplicationContext ç®€å•æ¥è¯´å°±æ˜¯BeanFactoryæä¾›äº†åŸºæœ¬çš„åŠŸèƒ½,è€ŒApplicationContextæä¾›äº†æ›´å¤šçš„ä¼ä¸šå®šåˆ¶åŒ–çš„åŠŸèƒ½. ApplicationContextä»£è¡¨äº†IOCå®¹å™¨,æä¾›äº†åˆå§‹åŒ–ã€é…ç½®ã€ç»„è£…beans.é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥èŽ·å–æœ‰å…³åˆå§‹åŒ–..ç­‰çš„æŒ‡ä»¤.è¿™é‡Œæ‰€æŒ‡çš„é…ç½®å…ƒæ•°æ®å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶,æ³¨è§£æˆ–è€…javaä»£ç æ¥å®žçŽ°.é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥ä½“çŽ°å¯¹è±¡å’Œå…¶ä¾èµ–. ä¸‹å›¾ä¸ºå®˜ç½‘æä¾›çš„springå·¥ä½œçš„ç®€åŒ–å›¾: SpringBeançš„ç”Ÿå‘½å‘¨æœŸç”Ÿå‘½å‘¨æœŸå¤§æ¦‚åŒ…å«è¿™å‡ ä¸ªé˜¶æ®µ: å®žä¾‹åŒ–Beanå¯¹è±¡,è¿™æ—¶è¿˜æœªè¿›è¡Œä¾èµ–æ³¨å…¥,æœ€åŽå°†beanåŠ å…¥åˆ°beanwapperä¸­. è®¾ç½®å¯¹è±¡å±žæ€§.Springæ ¹æ®BeanDefinitionä¸­çš„ä¿¡æ¯è¿›è¡Œä¾èµ–æ³¨å…¥.å¹¶ä¸”é€šè¿‡BeanWrapperæä¾›çš„è®¾ç½®å±žæ€§çš„æŽ¥å£å®Œæˆä¾èµ–æ³¨å…¥ã€‚ æ³¨å…¥AwareæŽ¥å£,æ£€æµ‹æ˜¯å¦æ˜¯æƒ³ç›¸å…³AwareæŽ¥å£,å¹¶è£…é…ç›¸å…³æŽ¥å£çš„æ–¹æ³•. BeanPostProcessor æ­¤æ—¶beanå·²ç»æˆåŠŸè¢«æž„é€ ,é€šè¿‡å®žçŽ°è¿™ä¸ªæŽ¥å£æ¥è‡ªå®šä¹‰å‰ç½®å’ŒåŽç½®çš„å¤„ç†è§„åˆ™. è°ƒç”¨initialzingBeanå’Œint-methods,è¿™æ—¶å¯¹è±¡æˆåŠŸè¢«åˆå§‹åŒ– æœ€åŽè°ƒç”¨disposableBeançš„afterpropertiesSetæ–¹æ³•å’Œdestroy-methodsæ¥å®žçŽ°æŒ‡å®šå¯¹è±¡é”€æ¯. Spring AOPAOPçš„æ„æ€æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹,åœ¨ç†è§£é¢å‘åˆ‡é¢å‰,ä¸å¾—ä¸è¯´é¢å‘å¯¹è±¡.ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡,é¢å‘å¯¹è±¡ç¼–ç¨‹å°±æ˜¯å°†äº‹åŠ¡å¯¹è±¡åŒ–,ä¾æ®å¯¹è±¡è¿›è¡Œå±‚çº§åŒ–,é¢å‘å¯¹è±¡é€šè¿‡å°è£…ç»§æ‰¿å¤šæ€çš„æ–¹å¼å®žçŽ°äº†å¯¹è±¡å±‚æ¬¡ç»“æž„,ä½†æ˜¯å®žé™…åº”ç”¨æ—¶å¯èƒ½ä¼šé‡åˆ°éœ€è¦æ¨ªå‘çš„è¿›è¡Œä¸šåŠ¡å¤„ç†,å…¸åž‹çš„å°±å¦‚æ—¥å¿—,å› ä¸ºåœ¨å®žé™…ä»£ç ç¼–å†™æ—¶,ä¸èƒ½æ¯æ¬¡åœ¨å†™æ–¹æ³•å‰åŽéƒ½åŠ å…¥ç›¸åŒçš„ä»£ç ,è¿™æ ·å³æµªè´¹æ—¶é—´,åˆå¯¼è‡´ä»£ç å†—ä½™.æ‰€ä»¥é¢å‘åˆ‡é¢ç¼–ç¨‹å¿…ä¸å¯å°‘. AOPå°†å¤šä¸ªç›¸åŒçš„ä¸šåŠ¡ä»£ç æ•´åˆ,å½¢æˆä¸€ä¸ªé€šç”¨çš„â€œåˆ‡é¢â€,é€šè¿‡åˆ‡é¢å¯ä»¥åˆ†å‰²å‡ºâ€œæ ¸å¿ƒå…³æ³¨ç‚¹â€å’Œâ€œæ¨ªåˆ‡å…³æ³¨ç‚¹â€,æ ¸å¿ƒå…³æ³¨ç‚¹å°±æ˜¯å®žé™…çš„æ ¸å¿ƒä¸šåŠ¡å…³æ³¨çš„ä»£ç é€»è¾‘éƒ¨åˆ†,æ¨ªåˆ‡å…³æ³¨ç‚¹å°±æ˜¯å…¬å…±çš„ä»£ç çš„å®žçŽ°. å…¶ä¸­AOPä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„æ¦‚å¿µ: æ¨ªåˆ‡å…³æ³¨ç‚¹:å¯¹å“ªäº›æ–¹æ³•è¿›è¡Œæ‹¦æˆª,æ‹¦æˆªåŽå¦‚ä½•å¤„ç†.è¿™äº›å…³æ³¨ç‚¹å«åšæ¨ªåˆ‡å…³æ³¨ç‚¹ åˆ‡é¢:åˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡,å°±å¦‚åŒç±»å¯¹äº‹ç‰©çš„æŠ½è±¡ç±»ä¼¼ è¿žæŽ¥ç‚¹(joinpoint):è¢«æ‹¦æˆªåˆ°çš„ç‚¹,å¯ä»¥é€šè¿‡è¿žæŽ¥ç‚¹èŽ·å–è¢«æ‹¦æˆªçš„å‚æ•°ç­‰ä¿¡æ¯ åˆ‡å…¥ç‚¹:è¿žæŽ¥ç‚¹è¿›è¡Œæ‹¦æˆªçš„å®šä¹‰ ç»‡å…¥:æ¨ªåˆ‡çš„è¿‡ç¨‹å«åšç»‡å…¥ ç®€å•çš„ä»£ç å®žçŽ°(æ³¨è§£)ä¸‹é¢ä»£ç ä½¿ç”¨æ³¨è§£çš„æ–¹å¼å®žçŽ°çš„Spring AOP,é…ç½®æ–‡ä»¶åŒç†,éœ€è¦é…ç½®åˆ‡é¢(ä¸»è¦æ˜¯åˆ‡ç‚¹å’Œé€šçŸ¥æ–¹æ³•) 1234567891011121314151617181920212223242526272829@Component// æ ‡å¿—ä¸ºAOP @Aspectpublic class ServiceLog &#123; private Logger logger = LoggerFactory.getLogger(ServiceLog.class); @Autowired HttpSession httpSession; // å‰ç½®é€šçŸ¥ åˆ‡å…¥ç‚¹å‰æ‰§è¡Œ @Before("execution(* com.nanyin.jreact.service.serviceImpl..*.*(..))") public void handelServiceMethodBefore(JoinPoint joinpoint)&#123; //JoinPoint ä¸ºè¿žæŽ¥ç‚¹,é€šè¿‡è¿žæŽ¥ç‚¹å¯èŽ·å–å‚æ•°ç­‰ try&#123; String username = (String) httpSession.getAttribute("user"); BaseUtil.setUser(Optional.ofNullable(username).orElse("ç©º ")); &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125; // åŽç½®é€šçŸ¥ åˆ‡å…¥ç‚¹åŽæ‰§è¡Œ @After("execution(* com.nanyin.jreact.service.serviceImpl..*.*(..))") public void handelServiceMethodAfter(JoinPoint joinpoint)&#123; try&#123; String username = (String) httpSession.getAttribute("user"); BaseUtil.setUser(Optional.ofNullable(username).orElse("ç©º ")); &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125;&#125; JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†ä¸¤è€…éƒ½å¯ä»¥å®žçŽ°AOPä»£ç†åŠŸèƒ½,ä½†æ˜¯jdkä»£ç†éœ€è¦ä»£ç†ç±»å’Œå§”æ‰˜ç±»éƒ½å®žçŽ°ç³»ç»Ÿçš„æŽ¥å£,ä½†æ˜¯å®žé™…åº”ç”¨çš„æ—¶å€™è¿™ç§æƒ…å†µéžå¸¸å°‘,è¿™æ—¶å€™ä¼šè‡ªåŠ¨ä½¿ç”¨CGLIBå®žçŽ°åŠ¨æ€ä»£ç† Springäº‹åŠ¡ç®¡ç†äº‹åŠ¡åŒ…å«å››ä¸ªåŸºæœ¬ç‰¹æ€§,ä¹Ÿå°±æ˜¯å¸¸è¯´çš„ACID,åˆ†åˆ«ä¸ºåŽŸå­æ€§,ä¸€è‡´æ€§,éš”ç¦»æ€§,æŒä¹…æ€§ äº‹åŠ¡çš„æŽ¥å£ PlatformTransactionManagerï¼š ï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨ spring ä¸ç›´æŽ¥ç®¡ç†äº‹åŠ¡,è€Œæ˜¯å®žçŽ°ä¸åŒçš„äº‹åŠ¡ç®¡ç†å™¨,å°†äº‹åŠ¡äº¤ç»™æ¡†æž¶å¤„ç†,å¦‚ä¸ºibaits å’Œ hibernate æœ‰ä¸åŒçš„å®žçŽ°. 123456&lt;!-- äº‹åŠ¡ç®¡ç†å™¨ xml é…ç½® --&gt;&lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt; &lt;!-- æ•°æ®æº --&gt; &lt;property name="dataSource" ref="dataSource" /&gt;&lt;/bean&gt; TransactionDefinitionï¼š äº‹åŠ¡å®šä¹‰ä¿¡æ¯(äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›žæ»šè§„åˆ™) 123456789101112public interface TransactionDefinition &#123; // è¿”å›žäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º int getPropagationBehavior(); // è¿”å›žäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡ç®¡ç†å™¨æ ¹æ®å®ƒæ¥æŽ§åˆ¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°æœ¬äº‹åŠ¡å†…çš„å“ªäº›æ•°æ® int getIsolationLevel(); //è¿”å›žäº‹åŠ¡çš„åå­— String getName()ï¼› // è¿”å›žäº‹åŠ¡å¿…é¡»åœ¨å¤šå°‘ç§’å†…å®Œæˆ int getTimeout(); // è¿”å›žæ˜¯å¦ä¼˜åŒ–ä¸ºåªè¯»äº‹åŠ¡ã€‚ boolean isReadOnly();&#125; TransactionStatusï¼š ç”¨æ¥è®°å½•äº‹åŠ¡è¿è¡ŒçŠ¶æ€ 1234567public interface TransactionStatus&#123; boolean isNewTransaction(); // æ˜¯å¦æ˜¯æ–°çš„äº‹ç‰© boolean hasSavepoint(); // æ˜¯å¦æœ‰æ¢å¤ç‚¹ void setRollbackOnly(); // è®¾ç½®ä¸ºåªå›žæ»š boolean isRollbackOnly(); // æ˜¯å¦ä¸ºåªå›žæ»š boolean isCompleted; // æ˜¯å¦å·²å®Œæˆ&#125; è‡ªå®šä¹‰æ³¨è§£æž„é€ æ³¨è§£æ³¨è§£ä½¿ç”¨@interfaceæ¥æ ‡è¯†ä¸ºä¸€ä¸ªæ³¨è§£,å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒå¦‚ä¸‹: 1234567891011// @TargetåŽŸæ³¨è§£çš„æ„ä¹‰æ˜¯è¡¨æ˜Žä½œç”¨åŸŸï¼Œæ¯”å¦‚typeå°±æ˜¯è¡¨ç¤ºè¦æ ‡æ³¨åˆ°ç±»æŽ¥å£ä¸Š@Target(&#123;ElementType.TYPE&#125;)// è¡¨ç¤ºä½œç”¨åŸŸ@Retention(RetentionPolicy.RUNTIME)// è¡¨æ˜Žå…¶ä»–æ³¨è§£èƒ½å¤Ÿç»§æ‰¿è¯¥æ³¨è§£@Inherited// javadocä¼šåŒ…å«@Documentedpublic @interface TableDescription &#123; String description();&#125; å…¶ä¸­è¯¥æ³¨è§£çš„ä½œç”¨å°±æ˜¯1.æ ‡æ³¨åœ¨ç±»æŽ¥å£ä¸Š2.ä½œç”¨åœ¨è¿è¡Œæ—¶,èƒ½å¤Ÿé€šè¿‡åå°„å¾—åˆ°æŽ¥å£ä¸­çš„å†…å®¹3.èƒ½å¤Ÿè®©å…¶ä»–æ³¨è§£ç»§æ‰¿è¯¥æ³¨è§£4.èƒ½å¤Ÿç”Ÿæˆjavaddocæ–‡æ¡£ ä¸‹é¢æ¥é‡ç‚¹å…³æ³¨ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå…ƒæ³¨è§£: @Targetæ˜¯è¿™ä¸ªæ³¨è§£çš„ä½œç”¨åŸŸï¼ŒElementType.METHODæ˜¯è¿™ä¸ªæ³¨è§£çš„ä½œç”¨åŸŸçš„åˆ—è¡¨ï¼ŒMETHODæ˜¯æ–¹æ³•å£°æ˜Žï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ï¼šCONSTRUCTORï¼ˆæž„é€ æ–¹æ³•å£°æ˜Žï¼‰,FIELDï¼ˆå­—æ®µå£°æ˜Žï¼‰,LOCAL VARIABLEï¼ˆå±€éƒ¨å˜é‡å£°æ˜Žï¼‰,METHODï¼ˆæ–¹æ³•å£°æ˜Žï¼‰,PACKAGEï¼ˆåŒ…å£°æ˜Žï¼‰,PARAMETERï¼ˆå‚æ•°å£°æ˜Žï¼‰,TYPEï¼ˆç±»æŽ¥å£ï¼‰ @Retentionæ˜¯å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå‰é¢ä¸æ˜¯è¯´æ³¨è§£æŒ‰ç…§è¿è¡Œæœºåˆ¶æœ‰ä¸€ä¸ªåˆ†ç±»å˜›ï¼ŒRUNTIMEå°±æ˜¯åœ¨è¿è¡Œæ—¶å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡åå°„è¯»å–ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰: SOURCEï¼ˆåªåœ¨æºç æ˜¾ç¤ºï¼Œç¼–è¯‘æ—¶ä¸¢å¼ƒï¼‰,CLASSï¼ˆç¼–è¯‘æ—¶è®°å½•åˆ°classä¸­ï¼Œè¿è¡Œæ—¶å¿½ç•¥ï¼‰,RUNTIMEï¼ˆè¿è¡Œæ—¶å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡åå°„è¯»å–ï¼‰ å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ æ·»åŠ æ³¨è§£ 1234567891011121314@Entity@Data@Table(name = "person")// è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸Šé¢çš„è‡ªå®šä¹‰æ³¨è§£TableDescription@TableDescription(description = "this is person table")public class Person &#123; @Id private long id; @Column(name = "name",length = 128) private String name; @Column(name = "age",length = 3) private short age;&#125; èŽ·å¾—æ³¨è§£å†…å®¹ 123456789101112131415public void testAnn()&#123; try&#123; // åå°„èŽ·å–ç±» Class clazz = Class.forName("com.nanyin.jreact.entry.Person"); Boolean exist = clazz.isAnnotationPresent(TableDescription.class); if(exist)&#123; //å¦‚æžœæ³¨è§£åœ¨ç±»ä¸­å­˜åœ¨ TableDescription tableDescription = (TableDescription) clazz.getAnnotation(TableDescription.class); // èŽ·å¾—æ³¨è§£å†…å®¹ System.out.println(tableDescription.description()); &#125; &#125;catch (ClassNotFoundException c)&#123; &#125;&#125; ä¸Šé¢åªæ˜¯ç®€å•çš„æŽ©é¥°æ³¨è§£çš„ç”¨æ³•,ä½†å®žé™…ä¸Šä¸šåŠ¡ä¼šæ¯”è¿™éš¾ä¸Šè®¸å¤š. springMVC å·¥ä½œæµç¨‹å…ˆä¸Šä¸€å¼ å›¾:æ¥è‡ªhttps://www.cnblogs.com/xiaoxi/p/6164383.html ç”±å›¾ä¸­å¯ä»¥çœ‹åˆ°SpringMvcä¸­æœ€é‡è¦çš„èµ·åˆ°ä¸­æž¢çš„æ˜¯DispatcherServlet(å‰ç«¯æŽ§åˆ¶å™¨). åœ¨DispatcherServletæŽ¥å—åˆ°å®¢æˆ·ç«¯è¯·æ±‚åŽ,ä½¿ç”¨ handlerMapping è¿›è¡Œæ˜ å°„å¤„ç†.åœ¨ç”Ÿæˆå¤„ç†å™¨æ˜ å°„å™¨ä¹‹åŽ, è¿”å›žä¸€ä¸ªhandler,å¦‚æžœæœ‰æ‹¦æˆªå™¨çš„åŒ–è¿˜ç”Ÿæˆæ‹¦æˆªå™¨.äº¤ç»™ DispatcherServlet è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†. ç¬¬äºŒæ­¥äº¤ç»™ handlerAdatper (å¤„ç†å™¨é€‚å™¨) HandlerAdapter ç»è¿‡é€‚é…è°ƒç”¨å…·ä½“çš„å¤„ç†å™¨( Controller ï¼Œä¹Ÿå«åŽç«¯æŽ§åˆ¶å™¨)ã€‚Controlleræ‰§è¡Œå®Œæˆè¿”å›žModelAndViewã€‚ ç¬¬ä¸‰æ­¥,DispatcherServletå°†æœ€ç»ˆçš„ç»“æžœäº¤ç»™ viewResolver è¯•å›¾è§£æžå™¨è¿›è¡Œè§†å›¾è§£æž DispatcherServlet æ ¹æ®è¿”å›žçš„viewè¿›è¡Œè§†å›¾æ¸²æŸ“,æœ€ç»ˆè¿”å›žç»™å®¢æˆ·ç«¯ç”¨æˆ·.]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Springé‡ç‚¹çŸ¥è¯†å­¦ä¹ ]]></title>
    <url>%2F2019%2F05%2F05%2F2019-05-05-Spring_Framework%E9%87%8D%E7%82%B9%E5%AD%A6%E4%B9%A0%202%2F</url>
    <content type="text"><![CDATA[Spring Frameworkä½¿ç”¨springå¯ä»¥è½»æ˜“çš„åˆ›å»ºä¸€ä¸ªä¼ä¸šçº§åº”ç”¨,å®ƒä½¿ç”¨Javaè¯­è¨€æ‰€æœ‰çš„ä¼ä¸šçº§çŽ¯å¢ƒä¸­çš„æ‰€æœ‰ä¸œè¥¿,springæ˜¯å¼€æºçš„,æ‹¥æœ‰åºžå¤§è€Œæ´»è·ƒçš„ç¤¾åŒºæ¥æä¾›æŒç»­çš„æ”¯æŒ. Spring Corespringåˆ†ä¸ºå¤šä¸ªæ¨¡å—,å…¶ä¸­coreä¸ºå…¶ä¸­çš„ä¸€ä¸ª,é‡Œé¢åŒ…å«springçš„æ ¸å¿ƒæŠ€æœ¯ç‚¹ IOCå®¹å™¨(æŽ§åˆ¶åè½¬)IOCä¹Ÿè¢«æˆä¸ºä¾èµ–æ³¨å…¥,è¿™æ˜¯ç”±ä¸€ä¸ªå¯¹è±¡å®šä¹‰ä»–æ‰€ä¾èµ–çš„å…³ç³»çš„è¿‡ç¨‹.å½“åˆ›å»ºè¿™ä¸ªbeançš„æ—¶å€™ä¹ŸåŒæ—¶åˆ›å»ºè¿™äº›ä¾èµ–ä¾›å…¶ä½¿ç”¨.è¿™æ ·çš„æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯åè½¬æŽ§åˆ¶çš„è¿‡ç¨‹,æ¯”å¦‚è¯´å»ºæˆ¿å­,ä»¥å‰éœ€è¦ç –,ç“¦,æ°´æ³¥æ‰èƒ½å»ºé€ æˆ¿å­,å¦‚æžœä¸å®žç”¨iocæ—¶,å°±æ˜¯è‡ªå·±åŽ»é€ ç –,é€ ç“¦,ç„¶åŽä½¿ç”¨.çŽ°åœ¨ä½¿ç”¨iocå®¹å™¨,åªéœ€è¦æŠŠç –,ç“¦,æ°´æ³¥å†™åˆ°æ¸…å•ä¸Š,iocå®¹å™¨è‡ªåŠ¨æŠŠè¿™äº›å‡†å¤‡å¥½ä¾›ä½¿ç”¨,çœåŽ»æ¥è‡ªå·±åˆ¶é€ çš„è¿‡ç¨‹. org.springframework.beans å’Œ org.springframework.context æ˜¯springå®žçŽ°IOCå®¹å™¨çš„åŸºç¡€.BeanFactoryæŽ¥å£æ˜¯èƒ½å¤Ÿç®¡ç†ä»»ä½•å¯¹è±¡çš„é«˜çº§çš„é…ç½®æŽ¥å£,ApplicationContextæ˜¯BeanFactoryçš„å­æŽ¥å£.å› ä¸º: æ›´å®¹æ˜“å’ŒSpring çš„AOPç‰¹æ€§ç›¸ç»“åˆ æ¶ˆæ¯èµ„æºå¤„ç†,ç”¨äºŽå›½é™…åŒ–é—®é¢˜ äº‹ä»¶å‘å¸ƒ ç”¨äºŽç‰¹å®šçš„ä¸Šä¸‹æ–‡æ¯”å¦‚webåº”ç”¨ç¨‹åºçš„WebApplicationContext ç®€å•æ¥è¯´å°±æ˜¯BeanFactoryæä¾›äº†åŸºæœ¬çš„åŠŸèƒ½,è€ŒApplicationContextæä¾›äº†æ›´å¤šçš„ä¼ä¸šå®šåˆ¶åŒ–çš„åŠŸèƒ½. ApplicationContextä»£è¡¨äº†IOCå®¹å™¨,æä¾›äº†åˆå§‹åŒ–ã€é…ç½®ã€ç»„è£…beans.é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥èŽ·å–æœ‰å…³åˆå§‹åŒ–..ç­‰çš„æŒ‡ä»¤.è¿™é‡Œæ‰€æŒ‡çš„é…ç½®å…ƒæ•°æ®å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶,æ³¨è§£æˆ–è€…javaä»£ç æ¥å®žçŽ°.é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥ä½“çŽ°å¯¹è±¡å’Œå…¶ä¾èµ–. ä¸‹å›¾ä¸ºå®˜ç½‘æä¾›çš„springå·¥ä½œçš„ç®€åŒ–å›¾: SpringBeançš„ç”Ÿå‘½å‘¨æœŸç”Ÿå‘½å‘¨æœŸå¤§æ¦‚åŒ…å«è¿™å‡ ä¸ªé˜¶æ®µ: å®žä¾‹åŒ–Beanå¯¹è±¡,è¿™æ—¶è¿˜æœªè¿›è¡Œä¾èµ–æ³¨å…¥,æœ€åŽå°†beanåŠ å…¥åˆ°beanwapperä¸­. è®¾ç½®å¯¹è±¡å±žæ€§.Springæ ¹æ®BeanDefinitionä¸­çš„ä¿¡æ¯è¿›è¡Œä¾èµ–æ³¨å…¥.å¹¶ä¸”é€šè¿‡BeanWrapperæä¾›çš„è®¾ç½®å±žæ€§çš„æŽ¥å£å®Œæˆä¾èµ–æ³¨å…¥ã€‚ æ³¨å…¥AwareæŽ¥å£,æ£€æµ‹æ˜¯å¦æ˜¯æƒ³ç›¸å…³AwareæŽ¥å£,å¹¶è£…é…ç›¸å…³æŽ¥å£çš„æ–¹æ³•. BeanPostProcessor æ­¤æ—¶beanå·²ç»æˆåŠŸè¢«æž„é€ ,é€šè¿‡å®žçŽ°è¿™ä¸ªæŽ¥å£æ¥è‡ªå®šä¹‰å‰ç½®å’ŒåŽç½®çš„å¤„ç†è§„åˆ™. è°ƒç”¨initialzingBeanå’Œint-methods,è¿™æ—¶å¯¹è±¡æˆåŠŸè¢«åˆå§‹åŒ– æœ€åŽè°ƒç”¨disposableBeançš„afterpropertiesSetæ–¹æ³•å’Œdestroy-methodsæ¥å®žçŽ°æŒ‡å®šå¯¹è±¡é”€æ¯. Spring AOPAOPçš„æ„æ€æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹,åœ¨ç†è§£é¢å‘åˆ‡é¢å‰,ä¸å¾—ä¸è¯´é¢å‘å¯¹è±¡.ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡,é¢å‘å¯¹è±¡ç¼–ç¨‹å°±æ˜¯å°†äº‹åŠ¡å¯¹è±¡åŒ–,ä¾æ®å¯¹è±¡è¿›è¡Œå±‚çº§åŒ–,é¢å‘å¯¹è±¡é€šè¿‡å°è£…ç»§æ‰¿å¤šæ€çš„æ–¹å¼å®žçŽ°äº†å¯¹è±¡å±‚æ¬¡ç»“æž„,ä½†æ˜¯å®žé™…åº”ç”¨æ—¶å¯èƒ½ä¼šé‡åˆ°éœ€è¦æ¨ªå‘çš„è¿›è¡Œä¸šåŠ¡å¤„ç†,å…¸åž‹çš„å°±å¦‚æ—¥å¿—,å› ä¸ºåœ¨å®žé™…ä»£ç ç¼–å†™æ—¶,ä¸èƒ½æ¯æ¬¡åœ¨å†™æ–¹æ³•å‰åŽéƒ½åŠ å…¥ç›¸åŒçš„ä»£ç ,è¿™æ ·å³æµªè´¹æ—¶é—´,åˆå¯¼è‡´ä»£ç å†—ä½™.æ‰€ä»¥é¢å‘åˆ‡é¢ç¼–ç¨‹å¿…ä¸å¯å°‘. AOPå°†å¤šä¸ªç›¸åŒçš„ä¸šåŠ¡ä»£ç æ•´åˆ,å½¢æˆä¸€ä¸ªé€šç”¨çš„â€œåˆ‡é¢â€,é€šè¿‡åˆ‡é¢å¯ä»¥åˆ†å‰²å‡ºâ€œæ ¸å¿ƒå…³æ³¨ç‚¹â€å’Œâ€œæ¨ªåˆ‡å…³æ³¨ç‚¹â€,æ ¸å¿ƒå…³æ³¨ç‚¹å°±æ˜¯å®žé™…çš„æ ¸å¿ƒä¸šåŠ¡å…³æ³¨çš„ä»£ç é€»è¾‘éƒ¨åˆ†,æ¨ªåˆ‡å…³æ³¨ç‚¹å°±æ˜¯å…¬å…±çš„ä»£ç çš„å®žçŽ°. å…¶ä¸­AOPä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„æ¦‚å¿µ: æ¨ªåˆ‡å…³æ³¨ç‚¹:å¯¹å“ªäº›æ–¹æ³•è¿›è¡Œæ‹¦æˆª,æ‹¦æˆªåŽå¦‚ä½•å¤„ç†.è¿™äº›å…³æ³¨ç‚¹å«åšæ¨ªåˆ‡å…³æ³¨ç‚¹ åˆ‡é¢:åˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡,å°±å¦‚åŒç±»å¯¹äº‹ç‰©çš„æŠ½è±¡ç±»ä¼¼ è¿žæŽ¥ç‚¹(joinpoint):è¢«æ‹¦æˆªåˆ°çš„ç‚¹,å¯ä»¥é€šè¿‡è¿žæŽ¥ç‚¹èŽ·å–è¢«æ‹¦æˆªçš„å‚æ•°ç­‰ä¿¡æ¯ åˆ‡å…¥ç‚¹:è¿žæŽ¥ç‚¹è¿›è¡Œæ‹¦æˆªçš„å®šä¹‰ ç»‡å…¥:æ¨ªåˆ‡çš„è¿‡ç¨‹å«åšç»‡å…¥ ç®€å•çš„ä»£ç å®žçŽ°(æ³¨è§£)ä¸‹é¢ä»£ç ä½¿ç”¨æ³¨è§£çš„æ–¹å¼å®žçŽ°çš„Spring AOP,é…ç½®æ–‡ä»¶åŒç†,éœ€è¦é…ç½®åˆ‡é¢(ä¸»è¦æ˜¯åˆ‡ç‚¹å’Œé€šçŸ¥æ–¹æ³•) 1234567891011121314151617181920212223242526272829@Component// æ ‡å¿—ä¸ºAOP @Aspectpublic class ServiceLog &#123; private Logger logger = LoggerFactory.getLogger(ServiceLog.class); @Autowired HttpSession httpSession; // å‰ç½®é€šçŸ¥ åˆ‡å…¥ç‚¹å‰æ‰§è¡Œ @Before("execution(* com.nanyin.jreact.service.serviceImpl..*.*(..))") public void handelServiceMethodBefore(JoinPoint joinpoint)&#123; //JoinPoint ä¸ºè¿žæŽ¥ç‚¹,é€šè¿‡è¿žæŽ¥ç‚¹å¯èŽ·å–å‚æ•°ç­‰ try&#123; String username = (String) httpSession.getAttribute("user"); BaseUtil.setUser(Optional.ofNullable(username).orElse("ç©º ")); &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125; // åŽç½®é€šçŸ¥ åˆ‡å…¥ç‚¹åŽæ‰§è¡Œ @After("execution(* com.nanyin.jreact.service.serviceImpl..*.*(..))") public void handelServiceMethodAfter(JoinPoint joinpoint)&#123; try&#123; String username = (String) httpSession.getAttribute("user"); BaseUtil.setUser(Optional.ofNullable(username).orElse("ç©º ")); &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125;&#125; JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†ä¸¤è€…éƒ½å¯ä»¥å®žçŽ°AOPä»£ç†åŠŸèƒ½,ä½†æ˜¯jdkä»£ç†éœ€è¦ä»£ç†ç±»å’Œå§”æ‰˜ç±»éƒ½å®žçŽ°ç³»ç»Ÿçš„æŽ¥å£,ä½†æ˜¯å®žé™…åº”ç”¨çš„æ—¶å€™è¿™ç§æƒ…å†µéžå¸¸å°‘,è¿™æ—¶å€™ä¼šè‡ªåŠ¨ä½¿ç”¨CGLIBå®žçŽ°åŠ¨æ€ä»£ç† Springäº‹åŠ¡ç®¡ç†äº‹åŠ¡åŒ…å«å››ä¸ªåŸºæœ¬ç‰¹æ€§,ä¹Ÿå°±æ˜¯å¸¸è¯´çš„ACID,åˆ†åˆ«ä¸ºåŽŸå­æ€§,ä¸€è‡´æ€§,éš”ç¦»æ€§,æŒä¹…æ€§ äº‹åŠ¡çš„æŽ¥å£ PlatformTransactionManagerï¼š ï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨ spring ä¸ç›´æŽ¥ç®¡ç†äº‹åŠ¡,è€Œæ˜¯å®žçŽ°ä¸åŒçš„äº‹åŠ¡ç®¡ç†å™¨,å°†äº‹åŠ¡äº¤ç»™æ¡†æž¶å¤„ç†,å¦‚ä¸ºibaits å’Œ hibernate æœ‰ä¸åŒçš„å®žçŽ°. 123456&lt;!-- äº‹åŠ¡ç®¡ç†å™¨ xml é…ç½® --&gt;&lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt; &lt;!-- æ•°æ®æº --&gt; &lt;property name="dataSource" ref="dataSource" /&gt;&lt;/bean&gt; TransactionDefinitionï¼š äº‹åŠ¡å®šä¹‰ä¿¡æ¯(äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›žæ»šè§„åˆ™) 123456789101112public interface TransactionDefinition &#123; // è¿”å›žäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º int getPropagationBehavior(); // è¿”å›žäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡ç®¡ç†å™¨æ ¹æ®å®ƒæ¥æŽ§åˆ¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°æœ¬äº‹åŠ¡å†…çš„å“ªäº›æ•°æ® int getIsolationLevel(); //è¿”å›žäº‹åŠ¡çš„åå­— String getName()ï¼› // è¿”å›žäº‹åŠ¡å¿…é¡»åœ¨å¤šå°‘ç§’å†…å®Œæˆ int getTimeout(); // è¿”å›žæ˜¯å¦ä¼˜åŒ–ä¸ºåªè¯»äº‹åŠ¡ã€‚ boolean isReadOnly();&#125; TransactionStatusï¼š ç”¨æ¥è®°å½•äº‹åŠ¡è¿è¡ŒçŠ¶æ€ 1234567public interface TransactionStatus&#123; boolean isNewTransaction(); // æ˜¯å¦æ˜¯æ–°çš„äº‹ç‰© boolean hasSavepoint(); // æ˜¯å¦æœ‰æ¢å¤ç‚¹ void setRollbackOnly(); // è®¾ç½®ä¸ºåªå›žæ»š boolean isRollbackOnly(); // æ˜¯å¦ä¸ºåªå›žæ»š boolean isCompleted; // æ˜¯å¦å·²å®Œæˆ&#125; è‡ªå®šä¹‰æ³¨è§£æž„é€ æ³¨è§£æ³¨è§£ä½¿ç”¨@interfaceæ¥æ ‡è¯†ä¸ºä¸€ä¸ªæ³¨è§£,å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒå¦‚ä¸‹: 1234567891011// @TargetåŽŸæ³¨è§£çš„æ„ä¹‰æ˜¯è¡¨æ˜Žä½œç”¨åŸŸï¼Œæ¯”å¦‚typeå°±æ˜¯è¡¨ç¤ºè¦æ ‡æ³¨åˆ°ç±»æŽ¥å£ä¸Š@Target(&#123;ElementType.TYPE&#125;)// è¡¨ç¤ºä½œç”¨åŸŸ@Retention(RetentionPolicy.RUNTIME)// è¡¨æ˜Žå…¶ä»–æ³¨è§£èƒ½å¤Ÿç»§æ‰¿è¯¥æ³¨è§£@Inherited// javadocä¼šåŒ…å«@Documentedpublic @interface TableDescription &#123; String description();&#125; å…¶ä¸­è¯¥æ³¨è§£çš„ä½œç”¨å°±æ˜¯1.æ ‡æ³¨åœ¨ç±»æŽ¥å£ä¸Š2.ä½œç”¨åœ¨è¿è¡Œæ—¶,èƒ½å¤Ÿé€šè¿‡åå°„å¾—åˆ°æŽ¥å£ä¸­çš„å†…å®¹3.èƒ½å¤Ÿè®©å…¶ä»–æ³¨è§£ç»§æ‰¿è¯¥æ³¨è§£4.èƒ½å¤Ÿç”Ÿæˆjavaddocæ–‡æ¡£ ä¸‹é¢æ¥é‡ç‚¹å…³æ³¨ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå…ƒæ³¨è§£: @Targetæ˜¯è¿™ä¸ªæ³¨è§£çš„ä½œç”¨åŸŸï¼ŒElementType.METHODæ˜¯è¿™ä¸ªæ³¨è§£çš„ä½œç”¨åŸŸçš„åˆ—è¡¨ï¼ŒMETHODæ˜¯æ–¹æ³•å£°æ˜Žï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ï¼šCONSTRUCTORï¼ˆæž„é€ æ–¹æ³•å£°æ˜Žï¼‰,FIELDï¼ˆå­—æ®µå£°æ˜Žï¼‰,LOCAL VARIABLEï¼ˆå±€éƒ¨å˜é‡å£°æ˜Žï¼‰,METHODï¼ˆæ–¹æ³•å£°æ˜Žï¼‰,PACKAGEï¼ˆåŒ…å£°æ˜Žï¼‰,PARAMETERï¼ˆå‚æ•°å£°æ˜Žï¼‰,TYPEï¼ˆç±»æŽ¥å£ï¼‰ @Retentionæ˜¯å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå‰é¢ä¸æ˜¯è¯´æ³¨è§£æŒ‰ç…§è¿è¡Œæœºåˆ¶æœ‰ä¸€ä¸ªåˆ†ç±»å˜›ï¼ŒRUNTIMEå°±æ˜¯åœ¨è¿è¡Œæ—¶å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡åå°„è¯»å–ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰: SOURCEï¼ˆåªåœ¨æºç æ˜¾ç¤ºï¼Œç¼–è¯‘æ—¶ä¸¢å¼ƒï¼‰,CLASSï¼ˆç¼–è¯‘æ—¶è®°å½•åˆ°classä¸­ï¼Œè¿è¡Œæ—¶å¿½ç•¥ï¼‰,RUNTIMEï¼ˆè¿è¡Œæ—¶å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡åå°„è¯»å–ï¼‰ å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ æ·»åŠ æ³¨è§£ 1234567891011121314@Entity@Data@Table(name = "person")// è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸Šé¢çš„è‡ªå®šä¹‰æ³¨è§£TableDescription@TableDescription(description = "this is person table")public class Person &#123; @Id private long id; @Column(name = "name",length = 128) private String name; @Column(name = "age",length = 3) private short age;&#125; èŽ·å¾—æ³¨è§£å†…å®¹ 123456789101112131415public void testAnn()&#123; try&#123; // åå°„èŽ·å–ç±» Class clazz = Class.forName("com.nanyin.jreact.entry.Person"); Boolean exist = clazz.isAnnotationPresent(TableDescription.class); if(exist)&#123; //å¦‚æžœæ³¨è§£åœ¨ç±»ä¸­å­˜åœ¨ TableDescription tableDescription = (TableDescription) clazz.getAnnotation(TableDescription.class); // èŽ·å¾—æ³¨è§£å†…å®¹ System.out.println(tableDescription.description()); &#125; &#125;catch (ClassNotFoundException c)&#123; &#125;&#125; ä¸Šé¢åªæ˜¯ç®€å•çš„æŽ©é¥°æ³¨è§£çš„ç”¨æ³•,ä½†å®žé™…ä¸Šä¸šåŠ¡ä¼šæ¯”è¿™éš¾ä¸Šè®¸å¤š. springMVC å·¥ä½œæµç¨‹å…ˆä¸Šä¸€å¼ å›¾:æ¥è‡ªhttps://www.cnblogs.com/xiaoxi/p/6164383.html ç”±å›¾ä¸­å¯ä»¥çœ‹åˆ°SpringMvcä¸­æœ€é‡è¦çš„èµ·åˆ°ä¸­æž¢çš„æ˜¯DispatcherServlet(å‰ç«¯æŽ§åˆ¶å™¨). åœ¨DispatcherServletæŽ¥å—åˆ°å®¢æˆ·ç«¯è¯·æ±‚åŽ,ä½¿ç”¨ handlerMapping è¿›è¡Œæ˜ å°„å¤„ç†.åœ¨ç”Ÿæˆå¤„ç†å™¨æ˜ å°„å™¨ä¹‹åŽ, è¿”å›žä¸€ä¸ªhandler,å¦‚æžœæœ‰æ‹¦æˆªå™¨çš„åŒ–è¿˜ç”Ÿæˆæ‹¦æˆªå™¨.äº¤ç»™ DispatcherServlet è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†. ç¬¬äºŒæ­¥äº¤ç»™ handlerAdatper (å¤„ç†å™¨é€‚å™¨) HandlerAdapter ç»è¿‡é€‚é…è°ƒç”¨å…·ä½“çš„å¤„ç†å™¨( Controller ï¼Œä¹Ÿå«åŽç«¯æŽ§åˆ¶å™¨)ã€‚Controlleræ‰§è¡Œå®Œæˆè¿”å›žModelAndViewã€‚ ç¬¬ä¸‰æ­¥,DispatcherServletå°†æœ€ç»ˆçš„ç»“æžœäº¤ç»™ viewResolver è¯•å›¾è§£æžå™¨è¿›è¡Œè§†å›¾è§£æž DispatcherServlet æ ¹æ®è¿”å›žçš„viewè¿›è¡Œè§†å›¾æ¸²æŸ“,æœ€ç»ˆè¿”å›žç»™å®¢æˆ·ç«¯ç”¨æˆ·.]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hibernateé‡ç‚¹çŸ¥è¯†æ€»ç»“]]></title>
    <url>%2F2019%2F04%2F29%2F2019-04-29-Hibernate%E9%87%8D%E7%82%B9%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[Hibernateé‡ç‚¹çŸ¥è¯†æ€»ç»“Hibernateçš„ä¸‰ç§çŠ¶æ€ çž¬æ—¶æ€(transient):å½“å®žä½“è¿˜æœªå’Œsessionå…³è”,å¦‚new Person(â€œ1â€); æŒä¹…æ€(persistent): é€šè¿‡getæˆ–è€…loadå¾—åˆ°çš„å®žä½“ç±»,è¿™æ—¶çš„çŠ¶æ€éƒ½æ˜¯æŒä¹…æ€. æ¸¸ç¦»æ€(detached): å½“é€šè¿‡getæˆ–è€…loadå¾—åˆ°æŒä¹…æ€çš„å¯¹è±¡åŽ,æ‰§è¡Œåˆ é™¤deleteæ—¶,è¿™æ—¶å·²ç»è„±ç¦»session.å› deleteè€Œå˜ä¸ºæ¸¸ç¦»æ€å¯æœ‰saveæˆ–è€…saveOrUpateè½¬åŒ–ä¸ºæŒä¹…æ€.æˆ–åˆ™å½“sessionå…³é—­åŽ,sessionä¸­çš„å¯¹è±¡å°±å˜ä¸ºæ¸¸ç¦»æ€. hibernateä¸­updateå’ŒsaveOrUpdateçš„åŒºåˆ«updateåªèƒ½æ˜¯å¯¹è±¡æœ‰ä¸»é”®æ—¶èµ·ä½œç”¨,è€ŒsaveOrUpdateåˆ™åœ¨å¯¹è±¡æ²¡æœ‰ä¸»é”®æ—¶æ‰§è¡Œæ’å…¥æ“ä½œ.å¯¹åº”çš„updateæ“ä½œåªèƒ½æ“ä½œæ¸¸ç¦»æ€çš„å¯¹è±¡,è€Œä¸èƒ½å¯¹çž¬æ—¶æ€çš„å¯¹è±¡æ“ä½œ.è€ŒsaveOrUpdateåˆ™ä¸¤ç§çŠ¶æ€çš„å¯¹è±¡éƒ½å¯ä»¥æ“ä½œ. hibernateä¸­çš„updateå’Œmergeæ–¹æ³•çš„åŒºåˆ«å½“æ‰§è¡Œupdateæ–¹æ³•çš„æ—¶å€™,ä¸€ä¸ªsessionä¸­å…·æœ‰ä¸Žå½“å‰updateç›¸åŒçš„æŒä¹…åŒ–æ ‡è¯†(identifier)çš„å®žä¾‹,ä½¿ç”¨upateæ“ä½œåŽä¼šæŠ¥é”™,è€Œä½¿ç”¨mergeåŽæŠŠå¤„ç†è‡ªç”±æ€çš„poå¯¹è±¡Açš„å±žæ€§copyåˆ°sessionå½“ä¸­å¤„äºŽæŒä¹…æ€çš„poçš„å±žæ€§ä¸­ï¼Œæ‰§è¡Œå®ŒæˆåŽåŽŸæ¥æ˜¯æŒä¹…çŠ¶æ€è¿˜æ˜¯æŒä¹…æ€ï¼Œè€Œæˆ‘ä»¬æä¾›çš„Aè¿˜æ˜¯è‡ªç”±æ€ã€‚ hibernateä¸­getå’Œloadçš„åŒºåˆ«ä¸€å¥è¯ï¼Œhibernateå¯¹äºŽloadæ–¹æ³•è®¤ä¸ºè¯¥æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¸€å®šå­˜åœ¨ï¼Œå¯ä»¥æ”¾å¿ƒçš„ä½¿ç”¨ä»£ç†æ¥å»¶è¿ŸåŠ è½½ï¼Œå¦‚æžœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘çŽ°äº†é—®é¢˜ï¼Œåªèƒ½æŠ›å¼‚å¸¸ï¼›è€Œå¯¹äºŽgetæ–¹æ³•ï¼Œhibernateä¸€å®šè¦èŽ·å–åˆ°çœŸå®žçš„æ•°æ®ï¼Œå¦åˆ™è¿”å›žnullã€‚ hibernateä¸­listå’Œiteratorçš„åŒºåˆ«(1)ã€Listæ–¹å¼æ˜¯1æ¬¡æ€§æŠŠæ‰€æœ‰çš„æ•°æ®å…¨éƒ¨å–åˆ°å†…å­˜ä¸­ï¼Œæž„é€ ä¸€ä¸ªè¶…å¤§çš„ç»“æžœé›†ï¼Œä¸»è¦çš„æ—¶é—´å¼€é”€æ˜¯è¿™ä¸€æ­¥ï¼Œè¿™ä¸€æ­¥çš„æ—¶é—´å¼€é”€è¦è¿œè¿œè¶…è¿‡JDBCå’Œ Iteratoræ–¹å¼ä¸‹æž„é€ ç»“æžœé›†çš„æ—¶é—´å¼€é”€ï¼Œå¹¶ä¸”å†…å­˜å¼€é”€ä¹Ÿå¾ˆæƒŠäººï¼›è€Œå¯¹ç»“æžœé›†çš„éåŽ†æ“ä½œï¼Œé€Ÿåº¦åˆ™æ˜¯éžå¸¸çš„æƒŠäººï¼ˆç»è¿‡æµ‹è¯•ï¼Œ30ä¸‡è®°å½•çš„å†… å­˜éåŽ†ä¸åˆ°100msï¼Œç”±äºŽè¿™ä¸€æ­¥ä¸å—JDBCå½±å“ï¼Œå› æ­¤ç»“æžœå¯ä¿¡ï¼‰ã€‚å› æ­¤ï¼ŒListæ–¹å¼é€‚åˆäºŽå¯¹ç»“æžœé›†è¿›è¡Œåå¤å¤šæ¬¡æ“ä½œçš„æƒ…å†µï¼Œä¾‹å¦‚åˆ†é¡µæ˜¾ç¤ºï¼Œå¾€åŽå¾€å‰ éåŽ†ï¼Œè·³åˆ°ç¬¬ä¸€è¡Œï¼Œè·³åˆ°æœ€åŽä¸€è¡Œç­‰ç­‰ã€‚ (2)ã€Iteratoræ–¹å¼åªå–è®°å½•idåˆ°å†…å­˜ä¸­ï¼Œå¹¶æ²¡æœ‰æŠŠæ‰€æœ‰æ•°æ®å–åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤æž„é€ ç»“æžœé›†çš„æ—¶é—´å¼€é”€å¾ˆå°ï¼Œæ¯”JDBCå’ŒListæ–¹å¼éƒ½è¦å°‘ï¼Œå¹¶ä¸”å†… å­˜å¼€é”€ä¹Ÿå°å¾ˆå¤šã€‚è€Œå¯¹ç»“æžœé›†çš„éåŽ†çš„æ“ä½œçš„æ—¶å€™ï¼ŒIteratorä»ç„¶è¦è®¿é—®æ•°æ®åº“ï¼Œæ‰€æœ‰ä¸»è¦çš„æ—¶é—´å¼€é”€éƒ½èŠ±åœ¨è¿™é‡Œã€‚å› æ­¤ï¼ŒIteratoræ–¹å¼é€‚åˆäºŽåª å¯¹ç»“æžœé›†è¿›è¡Œ1æ¬¡éåŽ†æ“ä½œçš„æƒ…å†µï¼Œå¹¶ä¸”Iteratoræ–¹å¼ç‰¹åˆ«é€‚åˆäºŽä»Žè¶…å¤§ç»“æžœé›†ä¸­å–å°‘é‡æ•°æ®ï¼Œè¿™ç§æƒ…å†µIteratoræ€§èƒ½éžå¸¸å¥½ã€‚ æ€»ç»“: listæŠŠæ•°æ®ä¸€æ¬¡åŠ è½½åˆ°å†…å­˜,å†è¿›è¡ŒéåŽ†æ“ä½œå°±éžå¸¸å¿«äº†.è€ŒIteratoræ–¹å¼åªä¼šæŠŠidæ”¾åˆ°å†…å­˜ä¸­,ä½†æ˜¯å†æ¬¡éåŽ†æ—¶ä»ç„¶è¦è®¿é—®æ•°æ®åº“æŸ¥è¯¢æ•°æ®,é€‚åˆä¸€æ¬¡éåŽ†çš„æƒ…å†µ. hibernateä¸­çš„inverseå±žæ€§è®¾ç½®inverse=â€œfalseâ€ä¸ºä¸»æŽ§æ–¹,ç”±ä¸»æŽ§æ–¹ç±»ç»´æŠ¤å¯¹è±¡é—´çš„å…³ç³».æ¯”å¦‚å†many-to-oneçš„å…³ç³»ä¸­,å†oneçš„ä¸€æ–¹è®¾ç½®inverse=&quot;true&quot;è¿™æ ·èƒ½å¤Ÿæé«˜æ•ˆçŽ‡,æ¯”å¦‚ç­çº§é‡Œä¸€ä¸ªè€å¸ˆå¤šä¸ªå­¦ç”Ÿ,è€å¸ˆè®°ä½å¤šä¸ªå­¦ç”Ÿæ¯”è¾ƒå›°éš¾,è€Œå­¦ç”Ÿè®°ä½ä¸€ä¸ªè€å¸ˆå¾ˆå®¹æ˜“.åŒç†one-to-many.å†å¤šå¯¹å¤šçš„å…³ç³»ä¸­,å†ä»»æ„ä¸€æ–¹è®¾ç½®inverse=&#39;true&#39;å³å¯. hibernateä¸­çš„cascadeå±žæ€§çº§è”æ“ä½œï¼šæŒ‡å½“ä¸»æŽ§æ–¹æ‰§è¡ŒæŸé¡¹æ“ä½œæ—¶ï¼Œæ˜¯å¦è¦å¯¹è¢«å…³è”æ–¹ä¹Ÿæ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ ä»€ä¹ˆæƒ…å†µä¸‹æ‡’åŠ è½½èƒ½å¤Ÿæœ‰æ•ˆçš„æé«˜æ•ˆçŽ‡æ‡’åŠ è½½æ˜¯å½“ç”¨åˆ°å¯¹è±¡çš„æ—¶å€™å†ä»Žæ•°æ®åº“åŠ è½½æ•°æ®,æŒä¹…åŒ–æ¥ä½¿ç”¨.ä»Žè¿™å¥è¯ä¸­å°±å¯ä»¥ç†è§£ä¸º,å› ä¸ºåŠè”çš„å…³ç³»,ä¸€ä¸ªè¡¨çš„æ•°æ®å¯èƒ½ä¼šå¸¦å‡ºå¤šå¼ è¡¨çš„æ•°æ®,è¿™æ—¶å€™ä½¿ç”¨æ‡’åŠ è½½å°±èƒ½å¤Ÿå®žçŽ°æ•ˆçŽ‡çš„æé«˜,æ²¡å¿…è¦ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®éƒ½åŠ è½½å‡ºæ¥,è€Œæ˜¯ç”¨æ—¶åŠ è½½.hibernateé»˜è®¤æ˜¯ä½¿ç”¨æ‡’åŠ è½½çš„,å½“ç„¶å¯ä»¥ä½¿ç”¨lazy=falseæ¥ç¦ç”¨æ‡’åŠ è½½. ä»€ä¹ˆæ˜¯hibernateçš„äºŒçº§ç¼“å­˜ç¼“å­˜å°±æ˜¯å°†ä»¥å‰çš„æ•°æ®å­˜æ”¾åˆ°å†…å­˜ä¸­,å½“æŸ¥è¯¢æ•°æ®çš„æ—¶å€™,çŽ°åœ¨å†…å­˜ä¸­æŸ¥è¯¢,æ˜¯å¦æœ‰è¿™ä¸ªå¯¹è±¡,å¦‚æžœæ²¡æœ‰å†ä»Žæ•°æ®åº“ä¸­æŸ¥è¯¢å¯¹è±¡,è¿™æ ·å¤§å¤§çš„æé«˜äº†æŸ¥è¯¢çš„æ•ˆçŽ‡. Hibenateçš„sessionå°±æ˜¯ä¸€çº§ç¼“å­˜,å½“æŸ¥è¯¢æ•°æ®çš„æ—¶å€™éƒ½ä¼šå…ˆä»Žsessionä¸­æŸ¥è¯¢å¯¹è±¡æ˜¯å¦å­˜åœ¨,ä¸å­˜åœ¨æ‰ä»Žæ•°æ®åº“æŸ¥è¯¢.ä½†æ˜¯sessionæ˜¯éžçº¿ç¨‹å®‰å…¨çš„,å¤šçº¿ç¨‹å…±äº«çš„æƒ…å†µä¸‹ä¼šå‡ºçŽ°é—®é¢˜.å¹¶ä¸”sessionæ˜¯è¡¨ç¤ºçš„æ˜¯ä¸€æ®µä¼šè¯,è¡¨ç¤ºçš„æ˜¯ä¸€æ¬¡äº‹åŠ¡,åŸºäºŽä»¥ä¸Šä¸¤ç‚¹,æ‰€ä»¥åœ¨ä¸€æ¬¡äº‹åŠ¡å®ŒæˆåŽ,sessionå°±åº”ç«‹å³å…³é—­.æ‰€ä»¥è¿™é‡Œè¯´çš„ä¸€çº§ç¼“å­˜æ„ä¹‰ä¸å¤§. Hibernateçš„äºŒçº§ç¼“å­˜å…¶å®žå°±æ˜¯ä½¿ç”¨å¤–éƒ¨ç¼“å­˜,å¦‚Echacheæˆ–è€…redisç­‰,ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®ç¼“å­˜ç­–ç•¥ç­‰. Hibernateä¸­ä½¿ç”¨hibernateTemplateçš„å¥½å¤„æœ‰å“ªäº›? HibernateTemplateç®€åŒ–äº†ä¸ŽHibernate Sessionçš„äº¤äº’ å¸¸è§çš„å‡½æ•°ç®€åŒ–ä¸ºå•ä¸ªæ–¹æ³•è°ƒç”¨ã€‚ å¼‚å¸¸ä¼šè‡ªåŠ¨æ•èŽ·å¹¶è½¬æ¢ä¸ºè¿è¡Œæ—¶å¼‚å¸¸ session è‡ªåŠ¨å…³é—­]]></content>
      <categories>
        <category>Hibernate</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaä¸­çš„å„ç§IOæ“ä½œ]]></title>
    <url>%2F2019%2F04%2F28%2F2019-04-28-Java_IO%E6%93%8D%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[Javaä¸­çš„IOæ“ä½œJavaæ€»çš„æ¥è¯´æœ‰ä¸‰ç±»IO,æ•ˆçŽ‡ä¸é«˜,æ“ä½œç®€å•çš„BIO(blocking IO),éžé˜»å¡žçš„NIO(New IO),å’Œå¼‚æ­¥éžé˜»å¡žIO,ä¹Ÿå°±æ˜¯å‡çº§ç‰ˆçš„NIO(Asynchronous I/O). åœ¨å­¦ä¹ è¿™ä¸‰ç±»IOå‰,éœ€è¦äº†è§£ä»€ä¹ˆæ˜¯é˜»å¡ž.ä»€ä¹ˆæ˜¯å¼‚æ­¥.ä¸¤ä¸ªçš„å«ä¹‰æœ‰ä»€ä¹ˆåŒºåˆ«. åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶ (synchronous communication/ asynchronous communication)æ‰€è°“åŒæ­¥ï¼Œå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ªè°ƒç”¨*æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æžœä¹‹å‰ï¼Œè¯¥ *è°ƒç”¨ å°±ä¸è¿”å›žã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›žï¼Œå°±å¾—åˆ°è¿”å›žå€¼äº†ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ç”±è°ƒç”¨è€…ä¸»åŠ¨ç­‰å¾…è¿™ä¸ªè°ƒç”¨çš„ç»“æžœã€‚è€Œå¼‚æ­¥åˆ™æ˜¯ç›¸åï¼Œè°ƒç”¨åœ¨å‘å‡ºä¹‹åŽï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æŽ¥è¿”å›žäº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›žç»“æžœã€‚æ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåŽï¼Œè°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æžœã€‚è€Œæ˜¯åœ¨è°ƒç”¨å‘å‡ºåŽï¼Œè¢«è°ƒç”¨è€…é€šè¿‡çŠ¶æ€ã€é€šçŸ¥æ¥é€šçŸ¥è°ƒç”¨è€…ï¼Œæˆ–é€šè¿‡å›žè°ƒå‡½æ•°å¤„ç†è¿™ä¸ªè°ƒç”¨ã€‚ é˜»å¡žå’Œéžé˜»å¡žå…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æžœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›žå€¼ï¼‰æ—¶çš„çŠ¶æ€.é˜»å¡žè°ƒç”¨æ˜¯æŒ‡è°ƒç”¨ç»“æžœè¿”å›žä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æžœä¹‹åŽæ‰ä¼šè¿”å›žã€‚éžé˜»å¡žè°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æžœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡žå½“å‰çº¿ç¨‹ã€‚ BIOBIOè¿‡ç¨‹å°±å¦‚åŒåå­—ä¸€æ ·,æ˜¯ä¸€ä¸ªé˜»å¡žçš„IO,æœåŠ¡ç«¯é€šå¸¸ä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥é€šè¿‡è°ƒç”¨accept()æ¥ç›‘å¬å®¢æˆ·ç«¯æ¶ˆæ¯.å¦‚æžœæƒ³å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚åˆ™æœåŠ¡ç«¯éœ€è¦å»ºç«‹ç­‰åŒæ•°é‡çš„çº¿ç¨‹æ¥å¤„ç†è¿™äº›æ¶ˆæ¯,è¿™å°±æ˜¯æ™®éçš„ä¸€è¯·æ±‚ä¸€åº”ç­”çš„æ¨¡åž‹.å¤„ç†å®ŒæˆåŽè¿”å›žåº”ç­”ç»™å®¢æˆ·ç«¯åŽé”€æ¯çº¿ç¨‹,å› ä¸ºçº¿ç¨‹æ˜¯ä¸€ä¸ªæ˜‚è´µçš„èµ„æº,è¿™æ ·é‡å¤çš„æ–°å»ºçº¿ç¨‹,é”€æ¯çº¿ç¨‹,å¾ˆæµªè´¹å¤„ç†å™¨èµ„æº,æ‰€ä»¥ä½¿ç”¨BIOåŒæ—¶èƒ½å¤Ÿå°½å¯èƒ½çš„å°‘åˆ›å»ºçº¿ç¨‹,å°±å¯ä»¥ç”¨åˆ°çº¿ç¨‹æ± çš„æ–¹å¼å®žçŽ°,æ¥è¾¾åˆ°æœåŠ¡ç«¯åˆ›å»ºçº¿ç¨‹æ•°è¿œè¿œå°äºŽå®¢æˆ·ç«¯æ•°çš„ç›®çš„,ä½†è¿™ç§æ–¹æ³•åªæ˜¯ä¼ªå¼‚æ­¥IO. åœ¨å¤„ç†é“¾æŽ¥æ•°é‡å°‘çš„æƒ…å†µä¸‹,BIOçš„æ•ˆçŽ‡è¿˜ä¸é”™,å¹¶ä¸”ä¸»è¦é€»è¾‘æ¨¡åž‹æ¸…æ™°æ˜Žäº†,ä»£ç ç®€å•.ä½†æ˜¯åœ¨ä¸Šä¸‡çš„é“¾æŽ¥çš„æƒ…å†µä¸‹,BIOå¤„ç†èµ·æ¥å°±éžå¸¸åƒç´§äº†. NIONIOæ˜¯ä¸€ç§åŒæ­¥éžé˜»å¡žçš„I/Oæ¨¡åž‹ï¼Œåœ¨Java 1.4 ä¸­å¼•å…¥äº†NIOæ¡†æž¶ï¼Œå¯¹åº” java.nio åŒ…ï¼Œæä¾›äº† Channel , Selectorï¼ŒBufferç­‰æŠ½è±¡ã€‚ NIOä¸­çš„Nå¯ä»¥ç†è§£ä¸ºNon-blockingï¼Œä¸å•çº¯æ˜¯Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºŽé€šé“çš„I/Oæ“ä½œæ–¹æ³•ã€‚ NIOæä¾›äº†ä¸Žä¼ ç»ŸBIOæ¨¡åž‹ä¸­çš„ Socket å’Œ ServerSocket ç›¸å¯¹åº”çš„ SocketChannel å’Œ ServerSocketChannel ä¸¤ç§ä¸åŒçš„å¥—æŽ¥å­—é€šé“å®žçŽ°,ä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡žå’Œéžé˜»å¡žä¸¤ç§æ¨¡å¼ã€‚é˜»å¡žæ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿä¸­çš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼›éžé˜»å¡žæ¨¡å¼æ­£å¥½ä¸Žä¹‹ç›¸åã€‚å¯¹äºŽä½Žè´Ÿè½½ã€ä½Žå¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡žI/Oæ¥æå‡å¼€å‘é€ŸçŽ‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºŽé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éžé˜»å¡žæ¨¡å¼æ¥å¼€å‘ã€‚ NIOç‰¹æ€§å’ŒNIOä¸Žä¼ ç»ŸIOçš„åŒºåˆ« ä¼ ç»ŸIO(BIO)æ˜¯ä¸€ç§é˜»å¡žIOæ¨¡åž‹,è€ŒNIOæ˜¯éžé˜»å¡žçš„IOæ¨¡åž‹,åŒºåˆ«ä¸ºå½“çº¿ç¨‹è¯»å–æ•°æ®çš„æ—¶å€™,éžé˜»å¡žIOå¯ä»¥ä¸ç”¨ç­‰,è€Œé˜»å¡žIOéœ€è¦ä¸€ç›´ç­‰å¾…IOå®ŒæˆåŽæ‰èƒ½ç»§ç»­. IOé¢å‘æµ,è€ŒNIOé¢å‘ç¼“å†²åŒº. é€šé“(channel) NIOé€šè¿‡é€šé“è¿›è¡Œæ•°æ®è¯»å†™.é€šé“æ˜¯åŒå‘çš„,è€Œä¼ ç»Ÿçš„IOæ˜¯å•å‘çš„.é€šé“é“¾æŽ¥çš„éƒ½æ˜¯Buffer,æ‰€ä»¥é€šé“å¯ä»¥å¼‚æ­¥çš„è¯»å†™. é€‰æ‹©å™¨(Selectors) NIOæ‹¥æœ‰é€‰æ‹©å™¨,è€ŒIOæ²¡æœ‰.é€‰æ‹©å™¨çš„ä½œç”¨å°±æ˜¯ç”¨æ¥ä½¿ç”¨å•ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªé€šé“(NIOé¢å‘buffer,é€šé“åªä¸Žbufferäº¤äº’).AIO AIO ä¹Ÿå°±æ˜¯ NIO 2ã€‚åœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éžé˜»å¡žçš„IOæ¨¡åž‹ã€‚å¼‚æ­¥ IO æ˜¯åŸºäºŽäº‹ä»¶å’Œå›žè°ƒæœºåˆ¶å®žçŽ°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åŽä¼šç›´æŽ¥è¿”å›žï¼Œä¸ä¼šå µå¡žåœ¨é‚£é‡Œï¼Œå½“åŽå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡ŒåŽç»­çš„æ“ä½œã€‚ AIO æ˜¯å¼‚æ­¥IOçš„ç¼©å†™ï¼Œè™½ç„¶ NIO åœ¨ç½‘ç»œæ“ä½œä¸­ï¼Œæä¾›äº†éžé˜»å¡žçš„æ–¹æ³•ï¼Œä½†æ˜¯ NIO çš„ IO è¡Œä¸ºè¿˜æ˜¯åŒæ­¥çš„ã€‚å¯¹äºŽ NIO æ¥è¯´ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡çº¿ç¨‹æ˜¯åœ¨ IO æ“ä½œå‡†å¤‡å¥½æ—¶ï¼Œå¾—åˆ°é€šçŸ¥ï¼ŒæŽ¥ç€å°±ç”±è¿™ä¸ªçº¿ç¨‹è‡ªè¡Œè¿›è¡Œ IO æ“ä½œï¼ŒIOæ“ä½œæœ¬èº«æ˜¯åŒæ­¥çš„ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVMåŸºæœ¬çŸ¥è¯†æ•´ç†]]></title>
    <url>%2F2019%2F04%2F24%2F2019-04-24-JVM%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86%2F</url>
    <content type="text"><![CDATA[javaå†…å­˜ç©ºé—´ å…¶ä¸­å¦‚å›¾ä¸­æ‰€å±•ç¤ºçš„ï¼ŒæŒ‰åŠŸèƒ½åˆ†äº†å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»ä¸ºçº¿ç¨‹å…±äº«çš„JAVAå †å’Œå…ƒæ•°æ®åŒºå’Œç›´æŽ¥å†…å­˜ï¼Œå¦ä¸€ç±»æ˜¯çº¿ç¨‹ç§æœ‰çš„è™šæ‹Ÿæœºæ ˆï¼Œæ–¹æ³•åŒºæ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚ ä¸‹é¢é’ˆå¯¹è¿™å‡ ç§åŒºåŸŸæ¥è¯¦ç»†å°†è¿™å‡ ä¸ªåŒºåŸŸåˆ†åˆ«çš„ä½œç”¨æ˜¯ä»€ä¹ˆã€‚ ç¨‹åºè®¡æ•°å™¨ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰§è¡Œç¨‹åºçš„å­—èŠ‚ç çš„çš„è¡Œå·çš„æŒ‡ç¤ºå™¨ã€‚å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨çš„å€¼æ¥æ”¹å˜å°†è¦é€‰å–çš„ä¸‹ä¸€ä¸ªæŒ‡ä»¤ã€‚å¹¶ä¸”ç”±äºŽæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„è¿è¡Œçš„æŒ‡ä»¤ä¸åŒï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰ä¸ªå­—çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå¹¶ä¸”äº’ä¸å¹²æ‰°ã€‚æ‰€ä»¥ç¨‹åºè®¡æ•°å™¨è¢«ç§°ä½œæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚è¿™ç§çº¿ç¨‹ç§æœ‰çš„åŒºåŸŸæœ‰ç€å¾ˆæ˜Žæ˜¾çš„ç‰¹å¾å°±æ˜¯ç”Ÿå‘½å‘¨æœŸå’Œå½“å‰çº¿ç¨‹çš„å‘¨æœŸä¿æŒä¸€è‡´ã€‚å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ç¨‹åºè®¡æ•°å™¨æ˜¯å†…å­˜ä¸­å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºçŽ°outOfMemoryçš„åŒºåŸŸã€‚ ç¨‹åºè®¡æ•°å™¨æœ‰ä¸¤ä¸ªä½œç”¨ï¼š A: å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡è¯»å–ç¨‹åºè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„è¯­å¥ã€‚ B:åœ¨å¤šçº¿ç¨‹åˆ‡æ¢çš„æƒ…å†µä¸‹ï¼Œè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œæ–¹ä¾¿äºŽåˆ‡æ¢å›žæ—¶è¿›ç¨‹è¿è¡Œçš„ä½ç½®ã€‚ è™šæ‹Ÿæœºæ ˆJavaå†…å­˜å¯ä»¥ç²—ç³™çš„åˆ†ä¸ºå †å†…å­˜å’Œæ ˆå†…å­˜ï¼Œæ‰€è°“çš„å †å°±æ˜¯å›¾ä¸­çš„javaå †ï¼ˆHeapï¼‰ï¼Œè€Œæ‰€è°“çš„æ ˆå°±æ˜¯æŒ‡çš„è™šæ‹Ÿæœºæ ˆï¼ˆVM Stackï¼‰çš„å±€éƒ¨å˜é‡è¡¨ã€‚è™šæ‹Ÿæœºæ ˆæ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆé’ˆæž„æˆçš„ï¼Œå¯ä»¥æƒ³ä¸ºä¸€ä¸ªæ–¹æ³•ä¸ºä¸€ä¸ªæ ˆé’ˆï¼Œéšç€æ–¹æ³•çš„è¢«è°ƒç”¨å®Œæˆï¼ˆå®Œæˆçš„æ¡ä»¶æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯returnï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å‘ç”Ÿå¼‚å¸¸ï¼‰ï¼Œå¯¹åº”ç€æ–¹æ³•çš„æ ˆé’ˆå‡ºæ ˆã€‚æ ˆé’ˆä¸­éƒ½åŒ…å«ï¼šå±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼ŒåŠ¨æ€é“¾æŽ¥å’Œæ–¹æ³•å‡ºå£ã€‚å±€éƒ¨å˜é‡è¡¨ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘å™¨å¯çŸ¥çš„å„ç§æ•°æ®ç±»åž‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceç±»åž‹ï¼Œå®ƒä¸åŒäºŽå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸Žæ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ æœ¬åœ°æ–¹æ³•æ ˆæœ¬åœ°æ–¹æ³•æ ˆåŒæ ·æ˜¯çº¿ç¨‹ç§æœ‰çš„,åŒºåˆ«æ˜¯javaè™šæ‹Ÿæœºæ ˆæ˜¯ç”¨äºŽjavaå­—èŠ‚ç çš„,è€Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ç”¨æ¥æ‰§è¡ŒNativeæ–¹æ³•çš„.ç»“æž„éƒ½å’Œè™šæ‹Ÿæœºæ ˆçš„ç»“æž„ç›¸åŒ. Javaå †Javaå †æ˜¯æ•´ä¸ªè™šæ‹Ÿæœºä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ,æ˜¯çº¿ç¨‹å…±äº«çš„åŒºåŸŸ,å†è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»º,è¯¥å—å­˜åœ¨çš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾ç±»çš„äº‹ä¾‹å’Œæ•°ç»„. æ–¹æ³•åŒºå’ŒJavaå †ä¸€æ ·éƒ½æ˜¯çº¿ç¨‹å…±äº«çš„åŒºåŸŸ,ä¸»è¦ç”¨äºŽå­˜æ”¾å·²ç»è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯,å¸¸é‡,é™æ€å˜é‡å’Œå·²ç»è¢«ç¼–è¯‘åŽçš„ä»£ç ç­‰æ•°æ®.æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³»å¾ˆåƒJavaä¸­æŽ¥å£å’Œç±»çš„å…³ç³»ï¼Œç±»å®žçŽ°äº†æŽ¥å£ï¼Œè€Œæ°¸ä¹…ä»£å°±æ˜¯HotSpotè™šæ‹Ÿæœºå¯¹è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„ä¸€ç§å®žçŽ°æ–¹å¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ°¸ä¹…ä»£æ˜¯HotSpotçš„æ¦‚å¿µï¼Œæ–¹æ³•åŒºæ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­çš„å®šä¹‰ï¼Œæ˜¯ä¸€ç§è§„èŒƒï¼Œè€Œæ°¸ä¹…ä»£æ˜¯ä¸€ç§å®žçŽ°ï¼Œä¸€ä¸ªæ˜¯æ ‡å‡†ä¸€ä¸ªæ˜¯å®žçŽ°ï¼Œå…¶ä»–çš„è™šæ‹Ÿæœºå®žçŽ°å¹¶æ²¡æœ‰æ°¸ä¹…å¸¦è¿™ä¸€è¯´æ³•ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± åŽŸæ¥çš„è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†,è€Œåœ¨1.7ä¹‹åŽ,è®²è¿è¡Œæ—¶å¸¸é‡æ± æ”¾åˆ°å †(Heap)ä¸­å¼€è¾Ÿäº†ä¸€ä¸ªåŒºåŸŸä¸“é—¨ç”¨æ¥æ”¾è¿è¡Œæ—¶å¸¸é‡æ± .è¿è¡Œæ—¶å¸¸é‡æ± ä¸­é¥é¥åŒ…æ‹¬ä¸¤éƒ¨åˆ†,ä¸€éƒ¨åˆ†æ˜¯å®žé™…å­˜åœ¨çš„å­—é¢é‡,æ‰€è°“å­—é¢é‡åŒ…æ‹¬[1.æ–‡æœ¬å­—ç¬¦ä¸²,2.è¢«å£°æ˜Žä¸ºfinalçš„å¸¸é‡,åŸºæœ¬æ•°æ®ç±»åž‹â€¦..],å¦ä¸€éƒ¨åˆ†æ˜¯ç¬¦å·å¼•ç”¨,åŒ…å«[ç±»å’Œç»“æž„çš„åç§°,å­—æ®µçš„åç§°,æ–¹æ³•çš„åç§°] å…ƒæ•°æ®åŒºæ›¿ä»£äº†æ°¸ä¹…ä»£,ä½¿ç”¨çš„æ˜¯ç›´æŽ¥å†…å­˜,ä»€ä¹ˆæ˜¯ç›´æŽ¥å†…å­˜,å®ƒæœ‰èƒ½å¤Ÿå¹²ä»€ä¹ˆ? é¦–å…ˆç›´æŽ¥å†…å­˜åŒºåŸŸä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†,ä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºå®šä¹‰çš„ä¸€éƒ¨åˆ†,ä½†æ˜¯ç»å¸¸ä¼šä½¿ç”¨åˆ°. JDK1.4 ä¸­æ–°åŠ å…¥çš„ NIO(New Input/Output) ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºŽé€šé“ï¼ˆChannelï¼‰ ä¸Žç¼“å­˜åŒºï¼ˆBufferï¼‰ çš„ I/O æ–¹å¼ï¼Œå®ƒå¯ä»¥ç›´æŽ¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æŽ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åŽé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †ä¸­çš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·å°±èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨ Java å †å’Œ Native å †ä¹‹é—´æ¥å›žå¤åˆ¶æ•°æ®ã€‚ æœ¬æœºç›´æŽ¥å†…å­˜çš„åˆ†é…ä¸ä¼šæ”¶åˆ° Java å †çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜å°±ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚ å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹åˆ†ä¸ºä¸Šå›¾ä¸­çš„5æ­¥ ç±»åŠ è½½æ£€æŸ¥:å½“è™šæ‹Ÿæœºé‡åˆ°newçš„æ—¶å€™,ä¼šæ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦å­˜åœ¨,æ˜¯å¦è¢«åŠ è½½,è§£é‡Šå’Œåˆå§‹åŒ–è¿‡,å¦‚æžœæ²¡æœ‰åˆ™è¿›è¡Œç±»çš„åˆå§‹åŒ–è¿‡ç¨‹. åˆ†é…å†…å­˜:å†è¿›è¡Œç±»åŠ è½½æ£€æŸ¥åŽ,ä¼šåœ¨å †å†…å­˜ä¸­ä¸ºæ–°çš„å¯¹è±¡åˆ†é…å†…å­˜,åˆ†é…çš„è§„åˆ™æœ‰ä¸¤ç§,ä¸€ç§æ˜¯æŒ‡é’ˆç¢°æ’ž,å¦ä¸€ç§æ˜¯ç©ºé—²åˆ—è¡¨,é’ˆå¯¹ä¸åŒçš„åžƒåœ¾å›žæ”¶å™¨ä¼šä½¿ç”¨ä¸åŒçš„æ–¹æ³•.ç¬¬ä¸€ç§æ–¹æ³•æŒ‡é’ˆç¢°æ’žçš„åŽŸç†å¤§è‡´ä¸ºå®ƒä¼šå°†åˆ†é…è¿‡çš„å†…å­˜å’Œæœªåˆ†é…çš„å†…å­˜é—´å»ºç«‹ä¸€ä¸ªæŒ‡é’ˆ,å½“åˆ†é…å†…å­˜çš„æ—¶å€™,å‘ä¸ºåˆ†é…å†…å­˜çš„åœ°æ–¹ç§»åŠ¨æ–°çš„å¯¹è±¡çš„å¤§å°çš„ä½ç½®,é€‚ç”¨äºŽæ¯”è¾ƒè§„æ•´çš„å†…å­˜ç©ºé—´.ç¬¬äºŒç§æ–¹æ³•æ˜¯ç»´æŠ¤ä¸€ä¸ªåˆ†é…å†…å­˜çš„åˆ—è¡¨,æ¯æ¬¡åˆ†é…å†…å­˜éƒ½æƒ³åˆ—è¡¨ä¸­æ·»åŠ ç›¸å…³è®°å½•,è¡¨æ˜Žè¿™äº›å¯¹è±¡åœ¨å“ª. åˆå§‹åŒ–é›¶å€¼:ä¿è¯åœ¨åˆ†é…å®Œå†…å­˜åŽ,ä¸ºåˆ†é…çš„å†…å­˜åŒºåŸŸåˆå§‹åŒ–ä¸ºé›¶å€¼ è®¾ç½®å¯¹è±¡å¤´:è™šæ‹Ÿæœºå¯¹å¯¹è±¡çš„å„ç§è®¾ç½®ä¿¡æ¯,ä¿å­˜åœ¨å¯¹è±¡å¤´ä¸­. æ‰§è¡Œinitæ–¹æ³•:åœ¨æ‰§è¡Œinitæ–¹æ³•å‰,ä»Žè™šæ‹Ÿæœºçš„è§’åº¦æ¥çœ‹å…¶å®žå¯¹è±¡å·²ç»ç”Ÿæˆäº†,ä½†æ˜¯åœ¨ç¨‹åºå‘˜çš„è§’åº¦å¯¹è±¡å¹¶æ²¡æœ‰ç”Ÿæˆ,åªæœ‰åœ¨initæ–¹æ³•æ‰§è¡Œè¿‡åŽ,å¯¹è±¡æ‰ç®—ç”Ÿæˆ. å¯¹è±¡çš„å®šä½æ–¹å¼Javaè™šæ‹Ÿæœºå®šä½å¯¹è±¡çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§,ä¸€æ˜¯ä½¿ç”¨å¥æŸ„,äºŒæ˜¯ç›´æŽ¥ä½¿ç”¨æŒ‡é’ˆ.]]></content>
      <categories>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ‚²è§‚é”å’Œä¹è§‚é”]]></title>
    <url>%2F2019%2F04%2F23%2F2019-04-08-%E6%82%B2%E8%A7%82%E9%94%81%E5%92%8C%E4%B9%90%E8%A7%82%E9%94%81%2F</url>
    <content type="text"><![CDATA[æ‚²è§‚é”å’Œä¹è§‚é”æ‚²è§‚é”æ‚²è§‚é”æ˜¯æ€»ä¼šå…ˆåŽ»æƒ³æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡çº¿ç¨‹æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šè®¤ä¸ºä»–ä¼šè¿›è¡Œä¿®æ”¹ï¼Œé€‚ç”¨äºŽçš„åœºæ™¯æ˜¯å¤šå†™å°‘è¯»ï¼Œè¿™æ—¶ä½¿ç”¨æ‚²è§‚é”æ•ˆçŽ‡ä¼šé«˜ã€‚ç¨‹åºä¸­å…¸åž‹çš„æ‚²è§‚é”æ—¶synchronizedå’ŒReentrantLock ä¹è§‚é”ä¹è§‚é”æ˜¯æ€»ä¼šå…ˆåŽ»æƒ³å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡çº¿ç¨‹æ‹¿æ•°æ®åªä¼šçœ‹ä¸€çœ¼ï¼Œå¹¶ä¸ä¼šåšä¿®æ”¹æ“ä½œï¼Œè¿™æ—¶æ²¡æœ‰å¿…è¦åŠ é”ï¼Œç¨‹åºä¸­çš„atomåŽŸå­ç±»ä½¿ç”¨cas+volatile+nativeæ–¹æ³•å®žçŽ°ä¹è§‚é”ã€‚ ä¸¤ç§é”çš„æœºåˆ¶ï¼Œæœ‰å„è‡ªçš„å¥½å¤„ï¼Œä¸èƒ½è¯´è°å¥½è°åï¼Œå„æœ‰ä¼˜ç‚¹ï¼š æ‚²è§‚é”é€‚ç”¨äºŽå¤šå†™å°‘è¯»çš„æƒ…å†µï¼Œè€Œä¹è§‚é”é€‚ç”¨äºŽå¤šè¯»å°‘å†™çš„æƒ…å†µï¼Œå¦‚æžœåœ¨å¤šå†™çš„æƒ…å†µä¸‹ä½¿ç”¨ä¹è§‚é”ï¼Œä¼šç»å¸¸äº§ç”Ÿå†²çªï¼Œåè€Œä¼šé™ä½Žæ€§èƒ½ã€‚ ä¹è§‚é”å¸¸ç”¨çš„ä¸¤ç§æ–¹å¼ç‰ˆæœ¬å·çš„æŽ§åˆ¶æ¯æ¬¡è¯»å–æ•°æ®çš„æ—¶å€™éƒ½ä¼šè¿žåŒç‰ˆæœ¬å·ä¸€åŒè¯»å–ï¼Œåœ¨å½“æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¼šæ¯”è¾ƒè¯»å–åˆ°çš„ç‰ˆæœ¬å·å’Œæ•°æ®åº“ä¸­çš„ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æžœä¸€è‡´åˆ™æ›´æ–°ï¼Œå¦‚æžœä¸ä¸€è‡´åˆ™ç»§ç»­è¯»å–ï¼Œæ›´æ–°æ•°æ®ã€‚ CASæ“ä½œï¼ˆcompareAndSwapï¼‰ä¸¾ä¸ªä¾‹å­,åœ¨atomIntegerç±»ä¸­æ¶‰åŠäº†CAS 1234567891011121314public final native boolean compareAndSwapInt(Object o, long offset, int expected, int x)//è¿™é‡Œæ˜¯nativeæ–¹æ³• offsetæ˜¯åç§»é‡å…ˆæš‚ä¸”ä¸æï¼Œoæ˜¯éœ€è¦æ¯”è¾ƒçš„å€¼ï¼Œexpectedæ˜¯é¢„æœŸå€¼ï¼Œxæ˜¯æ–°å€¼// å¦‚æžœä½¿ç”¨ç¨‹åºå†™å‡ºæ¥å°±æ˜¯å¤§æ¦‚è¿™æ ·ï¼š int value; public boolean fakeCAS(int expect,int newValue)&#123; if(value == expect)&#123; value = newValue; return true; &#125;else&#123; return false; &#125; &#125; æ¯”è¾ƒæ›¿æ¢(compareAndSwap)æ˜¯ä¸€ä¸ªåŽŸå­æ“ä½œï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè‡ªæ—‹æ“ä½œï¼Œç­‰å¾…ä¸€ä¸ªå‘¨æœŸå†æ¬¡å°è¯•ã€‚ CASæ“ä½œçš„ç¼ºç‚¹ ABAé—®é¢˜ï¼Œä½•è°“ABAï¼šå½“ä¸¤ä¸ªçº¿ç¨‹è¯»å–åˆ°å½“å‰å€¼ä¸ºAï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æŠŠå€¼æ”¹ä¸ºBåŽå†æŠŠBæ”¹ä¸ºAï¼Œè¿™æ˜¯å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨casæ“ä½œè¯»å–åˆ°çš„å€¼ä»ç„¶æ˜¯Aï¼ŒCASä¼šè®¤ä¸ºè¿™ä¸ªå€¼ä»Žæ¥æ²¡æœ‰å˜è¿‡ï¼Œè¿™å°±æ˜¯ABAé—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´é—å¤±æŽ‰ä¸­é—´çš„è¿‡ç¨‹ï¼Œåœ¨é“¾å¼çš„æ“ä½œæ€»æ›´èƒ½ä½“ä¼šåˆ°ABAé—®é¢˜çš„ä¸¥é‡æ€§ã€‚ è‡ªæ—‹æ—¶é—´è¿‡é•¿ï¼Œæ¶ˆè€—CPUèµ„æºã€‚ åªèƒ½å¯¹å•ä¸ªå…±äº«å˜é‡çš„åŽŸå­æ€§æ“ä½œ]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ç¨‹æ± å’ŒAQSçŸ¥è¯†æ•´ç†]]></title>
    <url>%2F2019%2F04%2F23%2F2019-04-23-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[çº¿ç¨‹æ± å’ŒAQSä»£ç è§£æžä½¿ç”¨çº¿ç¨‹æ± æ˜¯ä¸ºäº†å°†çº¿ç¨‹å¾—ä»¥å¤ç”¨,çº¿ç¨‹åˆ›å»ºåŽåœ¨çº¿ç¨‹æ± ä¸­è¢«å¾ªçŽ¯åˆ©ç”¨,é˜²æ­¢äº†çº¿ç¨‹å¾—å¤šæ¬¡åˆ›å»ºå’Œé”€æ¯.ä¸‹é¢å°±é€šè¿‡ä»£ç æ¥çœ‹çº¿ç¨‹æ± çš„å·¥ä½œåŽŸç†. çº¿ç¨‹æ± é…ç½®æ¯”è¾ƒç¹ç,æ‰€ä»¥javaæä¾›äº†ä¸€ä¸ªçº¿ç¨‹æ± çš„å·¥å…·ç±»Executors æ¥ä½¿ç”¨é™æ€çš„æ–¹æ³•æ¥åˆ›å»ºæ‹¥æœ‰ç‰¹å®šå±žæ€§çš„çº¿ç¨‹æ± .ä¸‹é¢å…ˆæ€»ä½“çš„çœ‹ä¸€ä¸‹éƒ½æœ‰å“ªäº›åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•,å’Œå„è‡ªçš„å®žçŽ°. newFixedThreadPool åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚æ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°çº¿ç¨‹è¾¾åˆ°çº¿ç¨‹æ± çš„æœ€å¤§å¤§å°ã€‚çº¿ç¨‹æ± çš„å¤§å°ä¸€æ—¦è¾¾åˆ°æœ€å¤§å€¼å°±ä¼šä¿æŒä¸å˜ï¼Œå¦‚æžœæŸä¸ªçº¿ç¨‹å› ä¸ºæ‰§è¡Œå¼‚å¸¸è€Œç»“æŸï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šè¡¥å……ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚ newCachedThreadPool åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ,æ­¤æ—¶çº¿ç¨‹æ± å¯¹çº¿ç¨‹å¾—å¤šå°‘æ²¡æœ‰é™åˆ¶,å¦‚æžœå¤šäº†å°±å®šæ—¶å›žæ”¶,å¦‚æžœå°‘äº†,å°±ä¼šåªèƒ½æ·»åŠ  newScheduledThreadPool åˆ›å»ºä¸€ä¸ªæ— é™å¤§å°çš„çº¿ç¨‹æ± ,æ­¤çº¿ç¨‹æ± å¯æ‰§è¡Œå®šæ—¶çš„ä»»åŠ¡ newSingleThreadExecutor çº¿ç¨‹æ± ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡,å¦‚æžœå› å¼‚å¸¸ç»“æŸ,åˆ™ä¼šç”Ÿæˆä¸€ä¸ªçº¿ç¨‹æ¥æ›¿æ¢åŽŸæ¥çš„çº¿ç¨‹.æ­¤ç§è¿žæŽ¥æ± ä¼šæŒ‰ç…§ä»»åŠ¡çš„æäº¤é¡ºåºä¾æ¬¡æ‰§è¡Œ.å› ä¸ºæ± ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å·¥ä½œ. åœ¨Excutorsä¸­æœ‰ä¸Šé¢å››ç§æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹æ± ,é‚£ä¹ˆè¿™å‡ ç§çº¿ç¨‹æ± å…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢?é€šè¿‡æºç æ¥ä¸€æŽ¢ç©¶ç«Ÿ. ThreadPoolExecutoré™¤äº†newScheduledThreadPoolè¿žæŽ¥æ± æ²¡æœ‰ä½¿ç”¨ThreadPoolExcutoræ¥å®žçŽ°,å…¶ä»–ä¸‰ç§éƒ½ä½¿ç”¨åˆ°äº†ThreadPoolExcutoræ¥è¿›è¡Œè¿žæŽ¥æ± çš„å®žçŽ°å’Œå®šåˆ¶.ä¸‹å›¾æ˜¯ThreadPoolExcutorçš„ç»“æž„å…³ç³».å®ƒæ˜¯ExecutorServiceçš„ç›´æŽ¥å®žçŽ°ç±». ThreadPoolExcutoræä¾›äº†ä¸‰ç§æž„é€ å‡½æ•°,ä¸åŒçš„æž„é€ å‡½æ•°å«æœ‰ä¸åŒçš„å‚æ•°.ä¸‹é¢å…ˆäº†è§£ä¸€ä¸‹å„å‚æ•°çš„å«ä¹‰ å‚æ•°åç§° å‚æ•°ç±»åž‹ å«ä¹‰ corePoolSize Int æ± ä¸­çš„çº¿ç¨‹æ•°é‡,å³ä½¿ä»–ä»¬æ˜¯ç©ºé—²çš„,é™¤éžè®¾ç½®allowCoreThreadTimeOutå‚æ•° maximumPoolSize int æ± ä¸­å…è®¸çš„æœ€å¤§çš„çº¿ç¨‹æ•°é‡ keepAliveTime long å¦‚æžœæ± ä¸­çš„çº¿ç¨‹è¶…è¿‡æ ¸å¿ƒæ•°,å¦‚æžœè¶…è¿‡è¿™ä¸ªæ—¶é—´çº¿ç¨‹ä»æ˜¯ç©ºé—²çš„åˆ™ç»“æŸè¿™ä¸ªçº¿ç¨‹ unit TimeUnit keepAilveTimeçš„æ—¶é—´çš„å•ä½ workQueue BlockingQueue ä¸€ä¸ªé˜»å¡žé˜Ÿåˆ—,ç”¨æ¥å­˜å‚¨æœªè¿›è¡Œçš„ä»»åŠ¡.æœªæ‰§è¡Œçš„ä»»åŠ¡ä¼šä¸€ç›´åœ¨é˜Ÿåˆ—é‡Œ,çŸ¥é“ä½¿ç”¨Excuteæ–¹æ³•æ‰§è¡Œ. threadFactory ThreadFactory çº¿ç¨‹å·¥åŽ‚,ç”¨äºŽç”Ÿäº§çº¿ç¨‹ handle RejectedExecutionHandler æ‰§è¡Œé˜»å¡žçš„å¤„ç†ç­–ç•¥,é€ æˆé˜»å¡žçš„åŽŸå› å¯èƒ½æ˜¯è¾¾åˆ°äº†çº¿ç¨‹è¾¹ç•Œæˆ–è€…é˜Ÿåˆ—å®¹é‡ å…¶ä¸­çº¿ç¨‹æ± ä½¿ç”¨ctlå˜é‡æŽ§åˆ¶çŠ¶æ€ä¿¡æ¯,ctlæ˜¯ä¸€ä¸ªAtomInteger,å…¶ä¸­é«˜28ä½è¡¨ç¤ºçº¿ç¨‹å¾—æ•°é‡,ä¹Ÿå°±æ˜¯workerCount,ä½Žä½çš„4ä½è¡¨ç¤ºçº¿ç¨‹æ± çš„çŠ¶æ€. åç§° æ‰¿æ‹…çš„ä»»åŠ¡ RUNNING æŽ¥å—æ–°çš„ä»»åŠ¡,å¹¶ä¸”å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ SHUTDOWN ä¸æŽ¥å—æ–°çš„ä»»åŠ¡,ä½†æ˜¯ä¼šå¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ STOP ä¸æŽ¥å—æ–°ä»»åŠ¡,ä¸å¤„ç†æŽ’é˜Ÿçš„äººç‰©,å¹¶ä¸”ç»ˆæ­¢æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡ TIDYING æ‰€æœ‰ä»»åŠ¡å·²ç»ç»ˆæ­¢,workerä¸ºç©º,é€šè¿‡terminateæ–¹æ³•æ¥è½¬æ¢ä¸ºTIDYING TERMINATED å½“terminateæ–¹æ³•æ‰§è¡Œè¿‡åŽçš„çŠ¶æ€ æ–¹æ³•æºç è§£æžæäº¤çš„æ–¹æ³•submitå®žåœ¨ExcutorServiceçš„å®žçŽ°ç±»AbstarctExecutorServiceä¸­æ‰€å®šä¹‰çš„,å¯ä»¥çœ‹å‡ºsubmitæ˜¯excuteæ–¹æ³•çš„å¤–å£³,å…¶å®žæ ¸å¿ƒè¿˜æ˜¯æ‰§è¡Œexcuteæ–¹æ³•,ä½†æ˜¯ä¼šè¿”å›žFutureç»“æžœ. 123456public Future&lt;?&gt; submit(Runnable task) &#123; if (task == null) throw new NullPointerException(); RunnableFuture&lt;Void&gt; ftask = newTaskFor(task, null); execute(ftask); return ftask;//è¿”å›žFutureç»“æžœ &#125; å› ä¸ºæ‰§è¡Œçš„æ ¸å¿ƒæ–¹æ³•æ˜¯excute,æ‰€ä»¥è¿›åˆ°ThreadPoolExecutorç±»ä¸­çœ‹excuteæ–¹æ³•æ˜¯å¦‚ä½•æ‰§è¡Œçš„.å…¶å®žæœ€é€šä¿—çš„è§£é‡Šexcuteçš„è¿‡ç¨‹å°±æ˜¯,å°†æ–°çš„workeråŠ å…¥åˆ°workerçš„é˜Ÿåˆ—ä¸­,å¹¶æ‰§è¡Œå½“å‰çš„commandçº¿ç¨‹.æ‰§è¡Œè¿‡ç¨‹å¯ä»¥å‚è€ƒå®˜æ–¹æ³¨é‡Š: 123456789101112131415161718192021222324252627282930public void execute(Runnable command) &#123; if (command == null) throw new NullPointerException(); /** * æ‰§è¡Œæ€»å…±åˆ†ä¸ºä¸‰æ­¥ * 1. å¦‚æžœå½“å‰çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æ•°å°äºŽæ ¸å¿ƒçº¿ç¨‹æ•°,åˆ™æ·»åŠ ä¸€ä¸ªworkeræ¥æ‰§è¡Œå½“å‰è¿™ä¸ªä»»åŠ¡ * 2. ä¸ºäº†é˜²æ­¢è¿›å…¥æ–¹æ³•åŽçº¿ç¨‹æ± å…³é—­æˆ–è€…çº¿ç¨‹æŒ‚æŽ‰éœ€è¦é‡æ–°èŽ·å–ctl,å¹¶ä¸”è¿›è¡Œåˆ¤æ–­,æ˜¯å¦è¿›è¡Œ * å›žé€€æˆ–è€…æ˜¯ç©ºæ± åŽæ·»åŠ ä¸€ä¸ªç©ºçº¿ç¨‹. * 3.å¦‚æžœä¸èƒ½å°†ä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ä¸­,åˆ™æ‰§è¡Œrollback,å›žé€€ä»»åŠ¡ */ int c = ctl.get();//èŽ·å¾—ctlå˜é‡,ä»Žè€ŒèŽ·å¾—workercountå’ŒçŠ¶æ€ä¿¡æ¯ if (workerCountOf(c) &lt; corePoolSize) &#123; //å¦‚æžœçº¿ç¨‹æ•°å°äºŽæ ¸å¿ƒçº¿ç¨‹æ•° if (addWorker(command, true)) //æ·»åŠ ä¸€ä¸ªæ–°çš„workeræ¥æ‰§è¡Œä»»åŠ¡ return; c = ctl.get(); &#125; if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; //å¦‚æžœå½“å‰æ± çš„çŠ¶æ€ä¸ºè¿è¡ŒçŠ¶æ€å¹¶ä¸”æŽ¥å—äº†è¿™ä¸ªä»»åŠ¡,ä¹Ÿå°±æ˜¯è¯´ä»»åŠ¡æˆåŠŸè¿›å…¥äº†æ‰§è¡Œé˜Ÿåˆ— int recheck = ctl.get(); //é‡æ–°èŽ·å–ctl,å› ä¸ºæœ‰å¯èƒ½åœ¨è¿›å…¥è¿™ä¸ªifè¯­å¥çš„æ—¶å€™ä¸€ä¸ªçº¿ç¨‹æŒ‚äº†,æˆ–è€…æ•´ä¸ªæ± è¢«å…³é—­äº† if (! isRunning(recheck) &amp;&amp; remove(command)) //å¦‚æžœçº¿ç¨‹æ± çš„çŠ¶æ€ä¸ºéžè¿è¡ŒçŠ¶æ€ // ä»Žé˜Ÿåˆ—ä¸­ç§»é™¤ä»»åŠ¡,å¹¶ä¸”rejectä»»åŠ¡ ç›¸å½“äºŽç¬¬ä¸€æ­¥æ“ä½œçš„rollback reject(command); else if (workerCountOf(recheck) == 0) //å¦‚æžœæ± æ˜¯ç©ºçš„ addWorker(null, false);//æ–°å»ºä¸€ä¸ªçº¿ç¨‹ &#125; else if (!addWorker(command, false)) //å¦‚æžœæ”¾åˆ°é˜Ÿåˆ—ä¸­å¤±è´¥,åˆ™å°†ä»»åŠ¡rollback reject(command); &#125; çº¿ç¨‹æ± ä¸­æ‹¥æœ‰çš„çŠ¶æ€æœ‰ä»¥ä¸‹å‡ ç§: 12345private static final int RUNNING = -1 &lt;&lt; COUNT_BITS;private static final int SHUTDOWN = 0 &lt;&lt; COUNT_BITS;private static final int STOP = 1 &lt;&lt; COUNT_BITS;private static final int TIDYING = 2 &lt;&lt; COUNT_BITS;private static final int TERMINATED = 3 &lt;&lt; COUNT_BITS; åœ¨excuteæ–¹æ³•ä¸­éœ€è¦ç”¨åˆ°addWorkeråœ¨å½“å‰çŠ¶æ€å’Œç»™å®šçš„è¾¹ç•Œæ¡ä»¶ä¸‹(æ ¸å¿ƒçº¿ç¨‹æ•°coreæˆ–è€…æœ€å¤§çº¿ç¨‹æ•°maximum)èƒ½å¦æ·»åŠ ä¸€ä¸ªworkerçº¿ç¨‹æ‰§è¡Œä»»åŠ¡.å¦‚æžœå½“å‰çº¿ç¨‹æ± ä¸ºç©ºæˆ–è€…æœ‰èµ„æ ¼å…³é—­çº¿ç¨‹æ± .è¿™æ˜¯è°ƒç”¨è¯¥æ–¹æ³•ä¼šè¿”å›žfalse.å¦‚æžœçº¿ç¨‹æ± å·¥åŽ‚the thread factoryä¸èƒ½å†äº§å‡ºæ›´å¤šçš„çº¿ç¨‹ä¹Ÿä¼šè¿”å›žfalse. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273private boolean addWorker(Runnable firstTask, boolean core) &#123; /** * firstTask ç†è§£ä¸ºåˆå§‹åŒ–æ—¶ç»™çš„ç¬¬ä¸€ä¸ªä»»åŠ¡,å¯ä»¥ç»•è¿‡æŽ’é˜Ÿçš„è¿‡ç¨‹,ç›´æŽ¥ä½¿ç”¨æ–°çš„çº¿ç¨‹æ‰§è¡Œ * core å¦‚æžœæ˜¯trueåˆ™ä½¿ç”¨corePoolSizeä½œä¸ºè¾¹ç•Œ,å¦åˆ™ä½¿ç”¨maximumPoolSizeä½œä¸ºè¾¹ç•Œ */ retry://flagæ ‡è®° for (;;) &#123; int c = ctl.get(); //èŽ·å–ctlå˜é‡ int rs = runStateOf(c);// èŽ·å–çŠ¶æ€å‚æ•° // Check if queue empty only if necessary. æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º if (rs &gt;= SHUTDOWN &amp;&amp; ! (rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; ! workQueue.isEmpty())) return false; for (;;) &#123; int wc = workerCountOf(c); if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize)) //å¦‚æžœå¤§äºŽæœ€å¤§çš„CAPACITYæˆ–è€…wcå¤§äºŽæ ¸å¿ƒçº¿ç¨‹æ•° return false; if (compareAndIncrementWorkerCount(c)) //ä½¿ç”¨CASæ·»åŠ workeråŽ,æ“ä½œæˆåŠŸåŽè·³å‡ºå¾ªçŽ¯ break retry; c = ctl.get(); // Re-read ctl if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop &#125; &#125; boolean workerStarted = false; boolean workerAdded = false; Worker w = null; try &#123; w = new Worker(firstTask);//ä»¥åŽå•è¯´è¿™ä¸ªworker final Thread t = w.thread; if (t != null) &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); // ä½¿ç”¨ReentrantLockä¸Šé”ä¿æŒåŽŸå­æ€§ try &#123; // Recheck while holding lock. // Back out on ThreadFactory failure or if // shut down before lock acquired. int rs = runStateOf(ctl.get()); if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123; if (t.isAlive()) // precheck that t is startable throw new IllegalThreadStateException(); workers.add(w); int s = workers.size(); if (s &gt; largestPoolSize)// å½“å‰workerçš„æ•°é‡å¤§äºŽlargestPoolSizeæ—¶ largestPoolSize = s; workerAdded = true; &#125; &#125; finally &#123; mainLock.unlock(); &#125; if (workerAdded) &#123; t.start();//çº¿ç¨‹å¼€å§‹æ‰§è¡Œ workerStarted = true; &#125; &#125; &#125; finally &#123; if (! workerStarted) //å¦‚æžœåˆ°è¿™é‡Œçº¿ç¨‹è¿˜æ˜¯æ²¡æœ‰å¼€å§‹,rollbackæ·»åŠ workerçš„è¿‡ç¨‹ addWorkerFailed(w); &#125; return workerStarted; &#125; å…¶ä¸­æ¶‰åŠåˆ°äº†wokerçº¿ç¨‹åˆ›å»ºçš„rollbackè¿‡ç¨‹,è°ƒç”¨äº†addWorkerFailedæ–¹æ³•: 123456789101112private void addWorkerFailed(Worker w) &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; if (w != null) workers.remove(w);//å¦‚æžœå­˜åœ¨åœ¨é˜Ÿåˆ—ä¸­ç§»é™¤w decrementWorkerCount();//å‡å°‘workerCountå˜é‡çš„å€¼ tryTerminate();//é‡æ–°æ£€æŸ¥ç»ˆæ­¢è¿‡ç¨‹,ä»¥é˜²æ­¢å› ä¸ºè¿™ä¸ªworkerçš„å­˜åœ¨å¯¼è‡´ç»ˆæ­¢å¤±è´¥ &#125; finally &#123; mainLock.unlock(); &#125; &#125; åœ¨å½“è¿è¡Œçš„çº¿ç¨‹æ•°åˆ°è¾¾æ ¸å¿ƒçº¿ç¨‹æ•°åŽ,å°±ä¼šå°†ä»»åŠ¡æ’å…¥åˆ°workQueueé‡Œé¢,è®©æ± ä¸­çš„å·¥ä½œçº¿ç¨‹å®Œæˆä»»åŠ¡,ä¸Šé¢çš„æºç ä¸­ä½¿ç”¨addWokeræ–¹æ³•æ¥æ‰§è¡Œå½“å‰æŒ‡å®šçš„ä»»åŠ¡,è€Œæœªæ¶‰åŠåˆ°åŠ å…¥åˆ°workQueueä¸­çš„ä»»åŠ¡æ˜¯å¦‚ä½•æ‰§è¡Œçš„,ä¸‹é¢é€šè¿‡æŸ¥çœ‹Wokerä¸­çš„runæ–¹æ³•æ¥æŸ¥çœ‹æ± ä¸­çš„çº¿ç¨‹å¦‚ä½•èŽ·å–ä»»åŠ¡æ¥æ‰§è¡Œçš„è¿‡ç¨‹. å› ä¸ºWorkerå®žçŽ°AQSã€ŒAbstractQueuedSynchronizerã€,å¹¶ç»§æ‰¿æ¥Runnable,æ‰€ä»¥Workerå…¶å®žæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªçº¿ç¨‹.åœ¨æ‰§è¡ŒstartåŽ,åŒæ ·ä¼šæ‰§è¡Œrunæ–¹æ³•. Workerä¸­çš„å…¨å±€å˜é‡: 123456/** Thread this worker is running in. Null if factory fails. æ‰§è¡Œå½“å‰å·¥ä½œçº¿ç¨‹*/final Thread thread;/** åˆå§‹åŒ–çš„ä»»åŠ¡,å¯èƒ½æ˜¯ç©º*/Runnable firstTask;/** æ¯ä¸ªçº¿ç¨‹çš„ä»»åŠ¡è®¡æ•°å™¨(ç»Ÿè®¡å®Œæˆçš„ä»»åŠ¡æ•°) */volatile long completedTasks; Workerçš„æž„é€ å™¨,é»˜è®¤æ˜¯éœ€è¦ä¼ å…¥Runnableçš„ä»»åŠ¡çš„. 12345Worker(Runnable firstTask) &#123; setState(-1); // inhibit interrupts until runWorker this.firstTask = firstTask; this.thread = getThreadFactory().newThread(this);//ä¿å­˜ä»ŽThreadFactoryä¸­èŽ·å–åˆ°çš„Thread&#125; workerä¸­çš„æ–¹æ³• 123456789101112131415161718192021222324252627282930313233//æŸ¥çœ‹æ˜¯å¦æ˜¯ç‹¬å çš„protected boolean isHeldExclusively() &#123; return getState() != 0; //AQSä¸­çš„stateä¿å­˜è¿™ä¸ªçŠ¶æ€&#125;//å°è¯•èŽ·å¾—é”protected boolean tryAcquire(int unused) &#123; if (compareAndSetState(0, 1)) &#123; //é€šè¿‡æ”¹å˜stateæ¥å®žçŽ° å¦‚æžœstate&gt;0è¯´æ˜ŽèŽ·å–åˆ°äº†é” setExclusiveOwnerThread(Thread.currentThread()); //è®¾ç½®ç‹¬å è®¿é—®çš„çº¿ç¨‹ return true; &#125; return false;&#125;//å°è¯•é‡Šæ”¾é”protected boolean tryRelease(int unused) &#123; setExclusiveOwnerThread(null);//æ¸…ç©ºç‹¬å è®¿é—®çš„çº¿ç¨‹ setState(0);//çŠ¶æ€ç½®ä¸ºã€Œé‡Šæ”¾é”ã€ return true;&#125;public void lock() &#123; acquire(1); &#125;public boolean tryLock() &#123; return tryAcquire(1); &#125;public void unlock() &#123; release(1); &#125;public boolean isLocked() &#123; return isHeldExclusively(); &#125;void interruptIfStarted() &#123; Thread t; if (getState() &gt;= 0 &amp;&amp; (t = thread) != null &amp;&amp; !t.isInterrupted()) &#123; try &#123; t.interrupt(); &#125; catch (SecurityException ignore) &#123; &#125; &#125;&#125; åœ¨addWorkeä¸­è°ƒç”¨runæ–¹æ³•æ‰§è¡Œä»»åŠ¡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** Delegates main run loop to outer runWorker */public void run() &#123; runWorker(this); //å§”æ‰˜runWorkeræ‰§è¡Œ&#125;final void runWorker(Worker w) &#123; Thread wt = Thread.currentThread();//èŽ·å¾—å½“å‰çº¿ç¨‹ Runnable task = w.firstTask;//èŽ·å¾—ä»»åŠ¡ w.firstTask = null; w.unlock(); // allow interrupts boolean completedAbruptly = true; try &#123; while (task != null || (task = getTask()) != null) &#123; //å¦‚æžœå­˜åœ¨ä»»åŠ¡ w.lock(); //å°†å½“å‰å·¥ä½œçº¿ç¨‹ä¸Šé” // If pool is stopping, ensure thread is interrupted; // if not, ensure thread is not interrupted. This // requires a recheck in second case to deal with // shutdownNow race while clearing interrupt //å¦‚æžœçº¿ç¨‹æ± æ­£åœ¨è¢«åœæ­¢,éœ€è¦ç¡®ä¿çº¿ç¨‹å·²ç»è¢«ä¸­æ–­ //å¦‚æžœçº¿ç¨‹æ± æ²¡æœ‰è¢«åœæ­¢,éœ€è¦ç¡®ä¿çº¿ç¨‹ä¸èƒ½è¢«ä¸­æ–­ if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted()) wt.interrupt(); try &#123; beforeExecute(wt, task); Throwable thrown = null; try &#123; task.run(); //æ‰§è¡Œä»»åŠ¡ &#125; catch (RuntimeException x) &#123; thrown = x; throw x; &#125; catch (Error x) &#123; thrown = x; throw x; &#125; catch (Throwable x) &#123; thrown = x; throw new Error(x); &#125; finally &#123; afterExecute(task, thrown); &#125; &#125; finally &#123; task = null; //æ¸…ç©ºä»»åŠ¡ w.completedTasks++; //å½“å‰çº¿ç¨‹å¤„ç†ä»»åŠ¡æ•°åŠ ä¸€ w.unlock();//è§£é” &#125; &#125; completedAbruptly = false; &#125; finally &#123; processWorkerExit(w, completedAbruptly); &#125;&#125; AQSã€ŒAbstractQueuedSynchronizerã€ é˜Ÿåˆ—åŒæ­¥å™¨AQSçš„ä½¿ç”¨æ–¹å¼æ˜¯ç»§æ‰¿,ä¹‹ç±»é€šè¿‡ç»§æ‰¿AQS,å®žçŽ°æŠ½è±¡æ–¹æ³•æ¥å®žçŽ°ç®¡ç†åŒæ­¥å™¨. å…¶ä¸­ä¸Šæ–‡ä¸­çš„ThreadPoolExcutorä¸­çš„Workerå°±æ˜¯ç»§æ‰¿AQSæ¥å®žçŽ°çš„. AQSä½¿ç”¨ä¸€ä¸ªå…¨å±€å˜é‡stateæ¥è¡¨ç¤ºå½“å‰çš„é”çš„çŠ¶æ€,å¦‚æžœstate&gt;0,è¯´æ˜Žå·²ç»èŽ·å–åˆ°äº†é”,å¦‚æžœstate=0,è¯´æ˜Žé‡Šæ”¾äº†é”. AQSä¾é CLHé˜Ÿåˆ—å®Œæˆå¯¹çŠ¶æ€çš„ç®¡ç†.å½“å‰çº¿ç¨‹å¦‚æžœèŽ·å–åŒæ­¥çŠ¶æ€å¤±è´¥æ—¶ï¼ŒAQSåˆ™ä¼šå°†å½“å‰çº¿ç¨‹å·²ç»ç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æž„é€ æˆä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰å¹¶å°†å…¶åŠ å…¥åˆ°CLHåŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¼šé˜»å¡žå½“å‰çº¿ç¨‹ï¼Œå½“åŒæ­¥çŠ¶æ€é‡Šæ”¾æ—¶ï¼Œä¼šæŠŠé¦–èŠ‚ç‚¹å”¤é†’ï¼ˆå…¬å¹³é”ï¼‰ï¼Œä½¿å…¶å†æ¬¡å°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ã€‚ å…¶ä¸­CLHçš„ä¸€ä¸ªèŠ‚ç‚¹åŒ…æ‹¬äº†:å½“å‰çš„çŠ¶æ€,å‰é©±,åŽç»§,å½“å‰èŠ‚ç‚¹ä¿å­˜çš„çº¿ç¨‹. å…·ä½“çš„AQSè¿‡ç¨‹å¯ä»¥å‚è€ƒQASåŽŸç† è¡¥å……çš„countDownLatchå’ŒcyclicBarrierçš„åŒºåˆ«]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaä¸­å¸¸ç”¨å…³é”®å­—æ€»ç»“]]></title>
    <url>%2F2019%2F04%2F22%2F2019-04-12-Java%E4%B8%AD%E5%B8%B8%E7%94%A8%E5%85%B3%E9%94%AE%E5%AD%97%2F</url>
    <content type="text"><![CDATA[Javaä¸­å…³é”®å­—æ€»ç»“finalå…³é”®å­—finalä¸»è¦ç”¨äºŽä¸‰ä¸ªåœ°æ–¹ï¼šå˜é‡ã€æ–¹æ³•ã€ç±» å˜é‡ï¼š å¦‚æžœfinalä¿®é¥°å˜é‡ï¼Œå¦‚æžœå˜é‡æ˜¯åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œåˆ™è¡¨ç¤ºå¦‚æžœè¯¥åŸºæœ¬æ•°æ®ç±»åž‹ä¸€æ—¦åˆå§‹åŒ–åˆ™ä¸èƒ½å†æ”¹å˜ï¼Œå¦‚æžœä¿®é¥°å¼•ç”¨å˜é‡ï¼Œåˆ™è¡¨ç¤ºåˆå§‹åŒ–ä¹‹åŽä¸èƒ½æ‰§è¡Œå¦å¤–ä¸€ä¸ªå˜é‡ã€‚ æ–¹æ³•ï¼š å¦‚æžœfinalä½œç”¨åŸŸæ–¹æ³•ä¸Šï¼Œè¯´æ˜Žè¯¥æ–¹æ³•æ˜¯ä¸èƒ½æ”¹å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç»§æ‰¿ç´¯æ— æ³•æ”¹å˜æ–¹æ³•ã€‚æ‰€æœ‰privateæ–¹æ³•é»˜è®¤æ˜¯finalçš„ ç±»ï¼šå¦‚æžœfinalä½œç”¨ä¸Žç±»ä¸Šï¼Œè¯´æ˜Žè¯¥ç±»æ˜¯æ— æ³•è¢«ç»§æ‰¿çš„ã€‚å¹¶ä¸”ä»–çš„ç±»ä¸­çš„æ–¹æ³•é»˜è®¤éƒ½æ˜¯privateçš„ã€‚ staticå…³é”®å­—staticå…³é”®å­—åœ¨ä»¥ä¸‹å››ç§æƒ…å†µä¸‹ç”¨åˆ°ã€‚ ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡æˆ–æ–¹æ³•ï¼Œé€šè¿‡staticä¿®é¥°çš„å˜é‡æˆ–è€…æ–¹æ³•è¢«ç§°ä½œä¸ºé™æ€å˜é‡å’Œé™æ€æ–¹æ³•ã€‚å¯ä»¥é€šè¿‡ç±»å.å˜é‡æˆ–æ–¹æ³•()è°ƒç”¨ï¼Œé™æ€å˜é‡å’Œæ–¹æ³•å±žäºŽæ•´ä¸ªç±»å¯¹è±¡ï¼Œè€Œä¸å±žäºŽå®žä¾‹å˜é‡ã€‚é™æ€å˜é‡å­˜æ”¾åœ¨javaå†…å­˜ä¸­çš„æ–¹æ³•åŒºã€‚ ç”¨æ¥ä¿®é¥°é™æ€ä»£ç å—ã€‚ä½¿ç”¨staticä¿®é¥°çš„é™æ€ä»£ç å—ï¼Œä¼šå…ˆäºŽä»£ç å—å’Œæž„é€ æ–¹æ³•ã€‚å¹¶ä¸”åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ ç”¨æ¥ä¿®é¥°é™æ€å†…éƒ¨ç±»ã€‚ä½¿ç”¨staticä¿®é¥°é™æ€å†…éƒ¨ç±»ï¼Œæœ‰ä¸¤ä¸ªç‰¹æ€§ï¼Œå…¶ä¸€æ˜¯ä»–çš„åˆ›å»ºä¸ä¾èµ–äºŽå¤–éƒ¨ç±»ï¼Œå…¶äºŒæ˜¯ä»–åªèƒ½è°ƒç”¨å¤–éƒ¨ç±»çš„é™æ€å˜é‡æˆ–æ–¹æ³•ã€‚ ç”¨æ¥é™æ€å¯¼å…¥åŒ…ï¼Œè¿™ä¸ªä¸å¤ªå¸¸ç”¨ã€‚ä½¿ç”¨ import staticå¯¼å…¥é™æ€èµ„æºã€‚ this å…³é”®å­—thisç”¨äºŽæ‰§è¡Œå½“å‰å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½åœ¨staticæ–¹æ³•æˆ–è€…ä»£ç å—ä¸­ä½¿ç”¨thisæ¥æŒ‡å‘å¯¹è±¡ã€‚ super å…³é”®å­—thiså…³é”®å­—æŒ‡å‘æœ¬èº«å¯¹è±¡ï¼Œè€Œsuperå…³é”®å­—åˆ™æŒ‡å‘çˆ¶ç±»å¯¹è±¡ã€‚ javaä¸­äºŒè¿›åˆ¶è¿ç®—æ“ä½œä¸Žè¿ç®— &amp;è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œéƒ½ä¸ºä¸€æ—¶åˆ™ä¸ºä¸€ æˆ–è¿ç®— |è½¬æ¢ä¸ºäºŒè¿›åˆ¶åŽï¼Œåªè¦æœ‰ä¸€ä¸ªä¸ºä¸€ï¼Œåˆ™ç»“æžœä¸ºä¸€ å¼‚æˆ–æ“ä½œ ^è½¬æ¢ä¸ºäºŒè¿›åˆ¶åŽï¼Œä¸åŒåˆ™ä¸ºä¸€ å–åæ“ä½œ ï½žæŒ‰ä½å–åçš„æ“ä½œï¼ˆç”±æ­£æ•°å˜ä¸ºè´Ÿæ•°ï¼‰ 1234567891011121314151617181920212223242526@Test public void testBitOperating()&#123; System.out.println(5&amp;6); // 0101 // 0110 // ----- // 0100 ç»“æžœæ˜¯4 System.out.println(5 | 6); // 0101 // 0110 // ----- // 0111 ç»“æžœæ˜¯7 System.out.println(5 ^ 6); // 0101 // 0110 // ----- // 0011 ç»“æžœæ˜¯ 3 System.out.println(~5); // 0.... 0101 //----------- // 0.... 0101 è¡¥ç  = æ­£æ•°çš„è¡¥ç å’Œæºç ç›¸åŒ è´Ÿæ•°çš„è¡¥ç ç­‰äºŽæºç å–ååŽ+1 // 1.... 0110 æºç  = å–å åŽåŠ ä¸€ -6 System.out.println(~-6); // 1.....0110 // 1.....1010 è¡¥ç ï¼šè´Ÿæ•°çš„è¡¥ç ä¸ºåç +1 // 0.....0101 æº]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•ç†è§£å’Œä½¿ç”¨synchronizedå…³é”®å­—]]></title>
    <url>%2F2019%2F04%2F22%2F2019-04-22-Synchronized%E5%85%B3%E9%94%AE%E5%AD%97%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[synchronizedä¸ºä»€ä¹ˆè¦ç”¨synchronizedå¤šçº¿ç¨‹æœ‰ä¸‰å¤§ç‰¹æ€§ï¼šåŽŸå­æ€§ï¼Œæœ‰åºæ€§ï¼ˆé‡æŽ’åºé—®é¢˜ï¼Ÿï¼‰å’Œå¯è§æ€§ï¼›å…¶ä¸­åŽŸå­æ€§åœ¨ç¨‹åºä¸Šçš„ä½“çŽ°å°±æ˜¯ä½¿ç”¨synchronized,ä¸ºäº†ä¿è¯å¯è§æ€§æ˜¯ä½¿ç”¨éœ€è¦ä½¿ç”¨volatile.ä½¿ç”¨synchronizedæ¥ä¿è¯ç¨‹åºçš„åŽŸå­æ€§ é¦–å…ˆåœ¨è®¨è®ºä¸‰å¤§ç‰¹æ€§å‰éœ€è¦çŸ¥é“javaçš„å†…å­˜æ¨¡åž‹å’Œhappen-beforeåŽŸåˆ™ã€‚å†…å­˜æ¨¡åž‹ä¸Žhappen-beforeåŽŸåˆ™ ç‰µæ‰¯å‡ºçš„é—®é¢˜ï¼š ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼šæˆ‘çš„ç†è§£å°±æ˜¯å¦‚æžœä¿è¯å¤šçº¿ç¨‹æ‰§è¡Œçš„ç»“æžœå’Œé¢„æœŸç»“æžœç›¸åŒï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦åˆ™å°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ ä»€ä¹ˆæ˜¯JAVAå†…å­˜æ¨¡åž‹ï¼Ÿ åœ¨javaå†…å®¹ä¸­ç¨‹åºè®¡æ•°å™¨ï¼Œè™šæ‹Ÿæœºæ ˆï¼Œæœ¬åœ°æ–¹æ³•æ ˆéƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„åŒºåŸŸï¼Œè€Œæ–¹æ³•åŒºå’Œjavaå †æ˜¯çº¿ç¨‹å…±äº«çš„åŒºåŸŸ å› ä¸ºcpuçš„å¤„ç†é€Ÿåº¦ä¸Žå†…å­˜çš„è¯»å†™é€Ÿåº¦ä¹‹é—´æœ‰ç€ç€å·¨å¤§çš„å·®è·ï¼Œæ‰€ä»¥åœ¨cpuå’Œå†…å­˜é—´æ·»åŠ ä¸€å±‚ç¼“å­˜ï¼Œæ¯æ¬¡çŽ°åœ¨cpuçš„ç¼“å­˜ä¸­ï¼Œè¿™ä¸ªç¼“å­˜åŒºåŸŸçš„è¯»å†™é€Ÿåº¦å¾€å¾€æ¯”å†…å­˜çš„è¯»å†™é€Ÿåº¦å¿«å¾ˆå¤šï¼Œè¿™æ ·å°±èƒ½å¤Ÿç¼“è§£cpuå’Œä¸»å­˜ä¹‹é—´çš„é€Ÿåº¦å·®è·ã€‚ æ‰€ä»¥æ¯æ¬¡cpuè¯»å†™æ•°æ®å‰ï¼Œä¼šå…ˆè¯»å–å…±äº«å˜é‡åˆ°æœ¬åœ°å†…å®¹ï¼Œcpuå†ä»Žæœ¬åœ°å†…å­˜ä¸­è¯»å–æ•°æ®ã€‚è¿™å°±æ˜¯javaçš„å†…å­˜æ¨¡åž‹ è¿™æ ·ä¹Ÿä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œè¿™æ˜¯å°±è¦éœ€è¦ä¿è¯å…±äº«å˜é‡çš„æ•°æ®å¯è§æ€§ï¼Œå³çº¿ç¨‹1ä¿®æ”¹äº†å˜é‡ï¼Œåˆ™çº¿ç¨‹2å†ä¿®æ”¹å˜é‡å‰å·²ç»å¾—çŸ¥å˜é‡å·²ç»è¢«ä¿®æ”¹äº†ã€‚ åº”ç”¨synchronized ä¸ºäº†ä¿è¯ç¨‹åºçš„åŽŸå­æ€§ï¼šæˆ‘ä»¬åœ¨ç¨‹åºä¸­ä½¿ç”¨synchronizedå…³é”®å­—å¯¹ç¨‹åºè¿›è¡Œé”å®šï¼Œè¡¨ç¤ºåœ¨é”ä½çš„åŒºåŸŸå†…åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚ å¦‚ä½•ä½¿ç”¨synchronized ä½¿ç”¨synchronizedä¿®é¥°é™æ€æ–¹æ³•ï¼Œé’ˆå¯¹ç±»å˜é‡è¿›è¡ŒåŠ é”ã€‚è¿›å…¥æ–¹æ³•çš„å‰ææ˜¯èŽ·å¾—ç±»çš„é”ã€‚ ä¿®é¥°å®žä¾‹æ–¹æ³•ï¼Œé’ˆå¯¹å®žä¾‹å¯¹è±¡ï¼Œåœ¨è¿›å…¥æ–¹æ³•å‰è¦èŽ·å¾—å®žä¾‹å˜é‡çš„é”ã€‚ ä¿®é¥°ä»£ç å—ã€‚æŒ‡å®šåŠ é”çš„å¯¹è±¡ï¼Œåœ¨è¿›å…¥ä»£ç å—é’±è¦å…ˆèŽ·å¾—æŒ‡å®šå¯¹è±¡çš„é”ã€‚ 123456789101112131415161718public class SynchronizedTest &#123; //synchronizedçš„ä¸‰ç§ç”¨æ³• //1.ä¿®é¥°å®žä¾‹æ–¹æ³• éœ€è¦æ‹¥æœ‰å®žä¾‹å¯¹è±¡çš„é” public synchronized void hello()&#123; System.out.println(&quot;hello&quot;); &#125; //2.ä¿®é¥°é™æ€æ–¹æ³• éœ€è¦æ‹¥æœ‰ç±»å¯¹è±¡çš„é” public synchronized static void staticHello()&#123; System.out.println(&quot;staticHello&quot;); &#125; public void blockHello()&#123; //3.ä¿®é¥°ä»£ç å— éœ€è¦æ‹¥æœ‰ã€thisã€‘çš„é” synchronized(this)&#123; System.out.println(&quot;code block hello&quot;); &#125; &#125;&#125; å…¸åž‹çš„ä½¿ç”¨synchronizedçš„åœºæ™¯â€“å•ä¾‹æ¨¡å¼çš„åŒé‡é”ç»“æž„åœ¨è®¨è®ºåŒé‡é”çš„å‰ï¼Œéœ€è¦èŠèŠå•ä¾‹æ¨¡å¼ï¼Œå•ä¾‹æ¨¡å¼é€šä¿—çš„æ¥è¯´ä¸€ä¸ªç±»åªèƒ½æž„é€ ä¸€ä¸ªå®žä¾‹ã€‚é’ˆå¯¹çš„å®žçŽ°åˆä¸¤ç§ï¼š1.é¥¿æ±‰æ¨¡å¼ï¼Œ2.æ‡’æ±‰æ¨¡å¼ é¥¿æ±‰æ¨¡å¼12345678910111213public class Singleton &#123; private Singleton()&#123;&#125;; //1. ä½¿ç”¨é™æ€å˜é‡// private static Singleton singleton = new Singleton(); //2.ä½¿ç”¨é™æ€ä»£ç å— æœªä½¿ç”¨æ—¶é€ æˆå†…å­˜ç©ºé—´æµªè´¹ private static Singleton singleton; static &#123; singleton = new Singleton(); &#125; public Singleton newInstance()&#123; return singleton; &#125;&#125; è¿™ç§æ–¹å¼ä¸ä¼šå½±å“åˆ°å¤šçº¿ç¨‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºç±»çš„è£…è½½æœºåˆ¶åœ¨åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™æ˜¯ä¿è¯ä¸ä¼šæœ‰ç¬¬äºŒä¸ªçº¿ç¨‹è¿›å…¥çš„ã€‚ä½†æ˜¯æœ‰ä¸ªå¾ˆå¤§çš„å¼Šç«¯æ˜¯ä»–ä¸æ˜¯lazy-loadingçš„ï¼Œè¿™å›žäº§ç”Ÿèµ„æºçš„æµªè´¹ï¼Œæ¯”å¦‚åˆ›å»ºå®Œå¯¹è±¡åŽï¼Œè‡ªå§‹è‡³ç»ˆæ²¡ç”¨è¿‡ã€‚æ‰€ä»¥ä¸æŽ¨èä½¿ç”¨ æ‡’æ±‰æ¨¡å¼123456789101112131415161718192021public class Singleton &#123; private void Singleton()&#123;&#125; private static Singleton singleton; // æ™®é€šçš„çº¿ç¨‹ä¸å®‰å…¨çš„ public Singleton newInstance()&#123; if(singleton == null)&#123; singleton = new Singleton(); &#125; return singleton; &#125; //2.é™æ€å†…éƒ¨ç±» ä¸€æ–¹é¢èƒ½å¤Ÿè¾¾åˆ°lazy-loadingçš„æ•ˆæžœï¼Œå¦ä¸€æ–¹é¢èƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºjvmä¿è¯åˆå§‹åŒ–çš„æ—¶å€™åˆ«çš„çº¿ç¨‹æ˜¯ä¸èƒ½è¿›å…¥çš„ private static class newSingleton&#123; private static final Singleton INSTANCE = new Singleton(); &#125; public Singleton newInstanceInnerClass()&#123; return newSingleton.INSTANCE; &#125;&#125; ä¸Šé¢ä»£ç çš„ç¬¬ä¸€ç§æ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹ä¸‹ä¼šå¯¼è‡´å¤±æ•ˆã€‚è€Œç¬¬äºŒç§ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼å®žçŽ°èƒ½å¤Ÿå®žçŽ°çº¿ç¨‹å®‰å…¨å¾—å®œäºŽç±»çš„åŠ è½½æœºåˆ¶ï¼Œç±»ä¼¼é¥¿æ±‰æ¨¡å¼ã€‚ä½†åŒæ—¶å…·æœ‰lazy-Loadingçš„ç‰¹æ€§ã€‚æ˜¯å¸¸ç”¨çš„å•ä¾‹æ¨¡å¼ç”¨æ³•ã€‚ double-check åŒé‡é”1234567891011121314151617public class DoubleCheck &#123; private void DoubleCheck()&#123;&#125; private volatile DoubleCheck doubleCheck; //ä½¿ç”¨volatileä¿è¯åŽŸå­æ€§ï¼Œé˜²æ­¢é‡æŽ’åº public DoubleCheck newInstance()&#123; if(doubleCheck == null)&#123; // å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åˆ°è¿™æ­¥ aå…ˆè¿›åŒæ­¥å—ï¼Œåœ¨aè¿›å…¥åŽèŽ·å¾—instanceåŽï¼ŒbèŽ·å¾—é”ï¼Œè¿›å…¥åŒæ­¥å—ï¼Œ // è¿™æ—¶å€™ä¸‹ä¸€ä¸ªåˆ¤æ–­å°±èµ·åˆ°ä½œç”¨äº†ï¼Œè¿™æ—¶å€™çš„doubleCheckä¸ä¸ºç©ºï¼Œ // ç›´æŽ¥returnï¼Œå¦åˆ™åˆï¸æ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡ synchronized (DoubleCheck.class)&#123; if(doubleCheck == null)&#123; doubleCheck = new DoubleCheck(); &#125; &#125; &#125; return doubleCheck; &#125;&#125; å®žé™…ä¸Šdouble-checkä¹Ÿæ˜¯æ‡’æ±‰æ¨¡å¼çš„ä¸€ç§ï¼Œèƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å¾ˆå®Œç¾Žã€‚ã€‚ synchronzied åº•å±‚å®žçŽ°synchronized åŒæ­¥è¯­å¥å—çš„å®žçŽ°ä½¿ç”¨çš„æ˜¯monitorenter å’Œmonitorexit æŒ‡ä»¤ï¼Œå…¶ä¸­ monitorenter æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œmonitorexit æŒ‡ä»¤åˆ™æŒ‡æ˜ŽåŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚ synchronized ä¿®é¥°çš„æ–¹æ³•å¹¶æ²¡æœ‰ monitorenter æŒ‡ä»¤å’Œ monitorexit æŒ‡ä»¤ï¼Œå–å¾—ä»£ä¹‹çš„ç¡®å®žæ˜¯ ACC_SYNCHRONIZED æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜Žäº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼ŒJVM é€šè¿‡è¯¥ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—æ¥è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜Žä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»Žè€Œæ‰§è¡Œç›¸åº”çš„åŒæ­¥è°ƒç”¨ã€‚ volatilevolatileæ˜¯javaæœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚ volatile ç‰¹æ€§ volatileä½œç”¨ä¸Žå˜é‡,ç”¨æ¥ä¿è¯å˜é‡çš„åœ¨å„çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§,ä½¿ç”¨volatileä¿®é¥°å˜é‡,è¡¨ç¤ºå˜é‡ä¸ç¨³å®š,æ¯æ¬¡éƒ½éœ€è¦å†™å…¥,å¹¶é‡æ–°èŽ·å–.æ‰€ä»¥æ¯æ¬¡éƒ½æ˜¯èŽ·å–çš„éƒ½æ˜¯ä¸»å­˜å†…æœ€æ–°çš„å˜é‡çš„å€¼. ç¦æ­¢æŒ‡ä»¤é‡æŽ’åˆ—ä¼˜åŒ– volatile åªèƒ½ä¿è¯å¯è§æ€§,ä¸èƒ½ä¿è¯åŽŸå­æ€§. volatileå’Œsynachronizedçš„åŒºåˆ« volatileæ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡çº§å®žçŽ°ï¼Œæ‰€ä»¥è¯´ä½¿ç”¨volatileçš„æ€§èƒ½è‚¯å®šè¦å¼ºäºŽsynchronizedã€‚ volatileä½œç”¨äºŽå˜é‡ï¼Œè€Œsynachronziedä½œç”¨äºŽæ–¹æ³•å’Œä»£ç å—ã€‚ å¤šçº¿ç¨‹é—´ä½¿ç”¨volatileä¸ä¼šå‘ç”Ÿé˜»å¡žï¼Œè€Œä½¿ç”¨synachronizedå¯èƒ½å‘ç”Ÿé˜»å¡ž volatileä¿è¯å˜é‡åœ¨å¤šçº¿ç¨‹é—´çš„å¯è§æ€§ï¼Œè€Œsynchronizedæ—¢èƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼Œåˆèƒ½ä¿è¯åŽŸå­æ€§ã€‚]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå¸¸ç”¨å‘½ä»¤æ•´ç†]]></title>
    <url>%2F2019%2F01%2F29%2F2019-01-29-%E5%9F%BA%E6%9C%ACLlinux%E5%91%BD%E4%BB%A4(%E5%BF%85%E9%A1%BB%E6%8E%8C%E6%8F%A1)%202%2F</url>
    <content type="text"><![CDATA[linuxä¸­å¿…é¡»æŽŒæ¡çš„åŸºæœ¬å‘½ä»¤åœ¨å¼€å§‹å‰ï¼Œæˆ‘æŽ¨èå®‰è£… trdrï¼ˆtoo long dont readï¼‰å·¥å…·ï¼Œç”¨æ¥ç®€åŒ–manå‘½ä»¤ï¼Œæ¥å®žçŽ°æŸ¥çœ‹å‘½ä»¤å«ä¹‰å’Œç”¨æ³•çš„ä½œç”¨ã€‚ ä¸€ ã€ç³»ç»Ÿå·¥ä½œå‘½ä»¤ echo echoå‘½ä»¤ä¸€èˆ¬ç”¨äºŽshellä¸­æ‰“å°å˜é‡æˆ–è€…å­—ç¬¦ä¸²çš„ä½œç”¨ï¼Œä¸»è¦ç”¨æ¥æ˜¾ç¤ºå’Œæé†’ã€‚ è¾“å‡ºä¸€æ®µä¿¡æ¯ å¦‚ï¼šecho &quot;hello world&quot; å…¶ä¸­&quot;ä¸æ˜¯å¿…é¡»çš„ è¾“å‡ºä¸€æ®µå¸¦çŽ¯å¢ƒå˜é‡çš„ä¿¡æ¯ å¦‚ï¼šecho &quot;My Path is $PATH&quot; è¾“å‡ºå¹¶ä¸å¸¦æ¢è¡Œç¬¦å· å¦‚ï¼šecho -n &quot;Hello World&quot; è¾“å‡ºä¸€æ®µæ¿€æ´»è½¬ä¾å­—ç¬¦ å¦‚ï¼š echo -e &quot;Column 1 \t Column 2&quot; date date å‘½ä»¤ä¸»è¦ç”¨æ¥è®¾ç½®å’Œæ‰“å°ç³»ç»Ÿæ—¶é—´ã€‚ è¾“å‡ºé»˜è®¤æ—¶åŒºæ ¼å¼çš„äº‹ä»¶ date +&quot;%c&quot; è¾“å‡ºå½“å‰äº‹ä»¶æŒ‰ç…§UTCå’Œisoæ ¼å¼è¾“å‡º date -u +&quot;%Y-%m-%dT%H:%M:%SZ&quot; è¾“å‡ºäº‹ä»¶æˆ³ date +&quot;%s&quot; reboot å‘½ä»¤ä¸»è¦ç”¨æ¥é‡å¯ç³»ç»Ÿ é‡å¯ç³»ç»Ÿ reboot å¼ºåˆ¶é‡å¯ reboot -f poweroff å‘½ä»¤ç”¨æˆ·å…³æœº wget å‘½ä»¤ ç”¨äºŽä»Žwebä¸­ä¸‹è½½æ–‡ä»¶ï¼Œæ”¯æŒ http,https,ftp èŽ·å–URLä¸­çš„å†…å®¹åˆ°fooä¸­ wget https://example.com/foo èŽ·å–URLä¸­çš„å†…å®¹åˆ°barä¸­ wget -O bar https://example.com/foo ç»§ç»­æœªå®Œæˆçš„ä¸‹è½½ wget -c https://example.com åŽå°ä¸‹è½½ wget -q https://example.com pså‘½ä»¤ä¸»è¦ç”¨äºŽæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„ä¿¡æ¯ æ‰“å°å…¨éƒ¨æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ ps aux æ‰“å°å…¨éƒ¨æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹å¹¶ä¸”ä¼´æœ‰å®Œæ•´çš„å‘½ä»¤ä¸² ps auxww é€šè¿‡ grep ç®¡é“è¿‡æ»¤ ps aux | grep &quot;tomcat&quot; å¾—åˆ°è¿›ç¨‹çš„çˆ¶è¿›ç¨‹pid :ps -o ppid= -p pid topå‘½ä»¤ ä¸»è¦ç”¨æˆ·åŠ¨æ€çš„å®žæ—¶çš„æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„ç¨‹åº top -i ä¸æ˜¾ç¤ºç©ºé—²æˆ–è€…æ˜¯åƒµå°¸è¿›ç¨‹ top -u $user æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·çš„è¿›ç¨‹ top -p PID åªæ˜¾ç¤ºæŒ‡å®šè¿›ç¨‹PID top -p $(pgrep -d &#39;,&#39; process_name) é€šè¿‡è¿›ç¨‹åæ¥æŸ¥è¯¢ pidof å‘½ä»¤ä¸»è¦ç”¨äºŽæŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹çš„idå· pidof -s è¿›è¿”å›žä¸€ä¸ªè¿›ç¨‹å· pidof -c ä»…æ˜¾ç¤ºå…·æœ‰ç›¸åŒrootç›®å½•ä¸‹çš„è¿›ç¨‹ äºŒã€ç³»ç»ŸçŠ¶æ€ ifconfig å‘½ä»¤ä¸»è¦ç”¨äºŽç½‘ç»œæŽ¥å£çš„æŸ¥çœ‹å’Œé…ç½® Ifconfig eth0 æŸ¥çœ‹etho0æŽ¥å£ç½‘ç»œè®¾ç½® ifconfig -a æŸ¥çœ‹æ‰€æœ‰æŽ¥å£çš„è¯¦ç»†ä¿¡æ¯ ifconfig eth0 down å…³é—­æŽ¥å£eth0 ifconfig eth0 ipaddr è®¾ç½®ç«¯å£ipåœ°å€ uname æ‰“å°å‡ºçŽ°å½“å‰æœºå™¨å’Œç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯ uname -n æ‰“å°å½“å‰çš„hostname uname -a æ‰“å°å½“å‰å¯ç”¨çš„ç³»ç»Ÿçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è½¯ä»¶ã€‚ who æ‰“å°å“ªäº›ç”¨æˆ·ç™»å½•å†è¿™å°æœºå™¨ä¸Š who æ˜¾ç¤ºusernameç­‰æ¯”è¾ƒå…¨çš„ä¿¡æ¯ who am i æ‰“å°å‡ºå½“å‰ç”¨æˆ· last ç”¨äºŽæŸ¥çœ‹å½“å‰ç”¨æˆ·æœ€è¿‘çš„ç™»å½•ä¿¡æ¯ ä¸‰ã€æ–‡ä»¶å’Œç›®å½• pwd ç”¨äºŽæ‰“å°å½“å‰ç›®å½• cd ç”¨äºŽåˆ‡æ¢ç›®å½• ls ç”¨äºŽç½—åˆ—ç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ ls -læŒ‰è¡Œç½—åˆ—æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ ls -a æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—çš„æ–‡ä»¶ã€‚ ls -lh æŒ‰ç…§å¤§å°æŽ’æ³„æŽ’åˆ— touch å‘½ä»¤ä¸»è¦ç”¨äºŽæ”¹å˜æ–‡ä»¶çš„è®¿é—®æ—¶é—´å’Œä¿®æ”¹æ—¶é—´ã€‚ touch filename ä»¥å½“å‰æ—¶é—´åˆ›å»ºæ–‡ä»¶ touch -t yyyy-mm-dd filename ä»¥æŸä¸€æ—¶é—´æ¥æ”¹å˜æ–‡ä»¶æ—¶é—´ mkdir å‘½ä»¤ä¸»è¦ç”¨äºŽåˆ›å»ºæ–‡ä»¶ mkdir dir åˆ›å»ºæ–‡ä»¶å¤¹ mkdir -p /path/dir åˆ›å»ºæŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ cp å‘½ä»¤ä¸»è¦ç”¨äºŽæ–‡ä»¶çš„å¤åˆ¶ cp path/to/file.ext path/to/copy.ext å¤åˆ¶æ–‡ä»¶åˆ°å¦ä¸€ä¸ªåœ°å€ cp path/to/file.ext path/to/target_parent_directory å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šåœ°å€ï¼Œå¹¶ä¸”ä¿æŒæ–‡ä»¶åä¸å˜ cp -r path/to/directory path/to/copy é€’å½’çš„å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶ä¸­çš„å†…å®¹åˆ°æŒ‡å®šç›®å½• cp -i *.txt path/to/target_directory ä»¥äº¤äº’çš„æ¨¡å¼å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸­ mv å‘½ä»¤ä¸»è¦ç”¨äºŽç§»åŠ¨æ–‡ä»¶ mv source target ç§»åŠ¨æ–‡ä»¶ mv -f å¼ºåˆ¶ç§»åŠ¨ï¼Œè¦†ç›–çŽ°æœ‰æ–‡ä»¶æ—¶ä¸è¦æç¤º rmå‘½ä»¤ä¸»è¦ç”¨äºŽåˆ é™¤æ–‡ä»¶ rm path/to/file path/to/another/file åˆ é™¤ç‰¹å®šæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ rm -r path/to/directory é€’å½’åˆ é™¤æ–‡ä»¶å¤¹åŠæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ rm -rf é€’å½’åˆ é™¤ï¼Œå¹¶ä¸”ä¸è¦æç¤ºä¿¡æ¯ dd å‘½ä»¤ä¸»è¦ç”¨äºŽè½¬åŒ–å’Œå¤åˆ¶æ–‡ä»¶,åˆ¶ä½œusbé•œåƒ Clone a drive to another drive with 4MB block and ignore error dd if=/dev/source_drive of=/dev/dest_drive bs=4m conv=noerror fileå‘½ä»¤ä¸»è¦ç”¨äºŽç¡®å®šæ–‡ä»¶ç±»åž‹ file filename è¾“å‡ºæ–‡ä»¶ç±»åž‹ file -s filename ç”¨äºŽç‰¹æ®Šçš„æ–‡ä»¶æˆ–è€…è®¾å¤‡æ–‡ä»¶ã€‚ å››ã€æ–‡æœ¬ç¼–è¾‘å‘½ä»¤ cat æ‰“å°å’Œä¸²è”æ–‡ä»¶ cat file æ‰“å°æ–‡ä»¶å†…å®¹åˆ°æ ‡å‡†è¾“å‡º cat file1 file2 &gt; targetFile å°†å¤šä¸ªæ–‡ä»¶å†…å®¹ä¸²è”åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ cat -n file æ‰“å°å‡ºè¡Œæ•°åˆ°æ ‡å‡†è¾“å‡º more ç”¨äºŽäº’åŠ¨çš„é˜…è¯»æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥ä¸Šä¸‹æ»šåŠ¨ more file æ‰“å¼€æ–‡ä»¶ï¼Œ&lt;space&gt;ç”¨äºŽç§»åŠ¨åˆ°ä¸‹ä¸€é¡µï¼Œ/ç”¨äºŽæœç´¢æ–‡ä»¶å†…å®¹ï¼Œ qç”¨äºŽé€€å‡ºå½“å‰ç•Œé¢ head è¾“å‡ºæ–‡ä»¶å¼€å§‹çš„éƒ¨åˆ† head -n count_of_line filename æŸ¥çœ‹æ–‡ä»¶çš„å‰nè¡Œ head -c number_of_byte filename æŸ¥çœ‹æ–‡ä»¶çš„å‰nä¸ªå­—èŠ‚ tail è¾“å‡ºæ–‡ä»¶æœ€åŽçš„éƒ¨åˆ† tail -n num fileæ‰“å°å‡ºæ–‡ä»¶æœ€åŽnumè¡Œ tail -n +num file æ‰“å°å‡ºæ–‡ä»¶ä»Žnumå¼€å§‹çš„å‡ è¡Œ tail -f file ä¿æŒé˜…è¯»çŠ¶æ€ç›´åˆ° Ctrl + c wcå‘½ä»¤ç”¨äºŽç»Ÿè®¡æ–‡ä»¶çš„å•è¯ï¼Œå­—èŠ‚ï¼Œè¡Œæ•° wc -l filename ç»Ÿè®¡æ–‡ä»¶çš„è¡Œæ•° wc -w filename ç»Ÿè®¡æ–‡ä»¶çš„å­—æ•° wc -c filename ç»Ÿè®¡æ–‡ä»¶çš„å­—èŠ‚æ•° æ˜¾ç¤ºæ–‡ä»¶çš„çŠ¶æ€ stat filename æ˜¾ç¤ºæ–‡ä»¶çš„å±žæ€§æ¯”å¦‚å¤§å°ï¼Œæƒé™ç­‰ã€‚ stat -x filenameæ ¼å¼åŒ–æ˜¾ç¤ºæ–‡ä»¶çš„è¯¦ç»†å±žæ€§ä¿¡æ¯ã€‚]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå¸¸ç”¨å‘½ä»¤æ•´ç†]]></title>
    <url>%2F2019%2F01%2F29%2F2019-01-29-%E5%9F%BA%E6%9C%ACLlinux%E5%91%BD%E4%BB%A4(%E5%BF%85%E9%A1%BB%E6%8E%8C%E6%8F%A1)%2F</url>
    <content type="text"><![CDATA[linuxä¸­å¿…é¡»æŽŒæ¡çš„åŸºæœ¬å‘½ä»¤åœ¨å¼€å§‹å‰ï¼Œæˆ‘æŽ¨èå®‰è£… trdrï¼ˆtoo long dont readï¼‰å·¥å…·ï¼Œç”¨æ¥ç®€åŒ–manå‘½ä»¤ï¼Œæ¥å®žçŽ°æŸ¥çœ‹å‘½ä»¤å«ä¹‰å’Œç”¨æ³•çš„ä½œç”¨ã€‚ ä¸€ ã€ç³»ç»Ÿå·¥ä½œå‘½ä»¤ echo echoå‘½ä»¤ä¸€èˆ¬ç”¨äºŽshellä¸­æ‰“å°å˜é‡æˆ–è€…å­—ç¬¦ä¸²çš„ä½œç”¨ï¼Œä¸»è¦ç”¨æ¥æ˜¾ç¤ºå’Œæé†’ã€‚ è¾“å‡ºä¸€æ®µä¿¡æ¯ å¦‚ï¼šecho &quot;hello world&quot; å…¶ä¸­&quot;ä¸æ˜¯å¿…é¡»çš„ è¾“å‡ºä¸€æ®µå¸¦çŽ¯å¢ƒå˜é‡çš„ä¿¡æ¯ å¦‚ï¼šecho &quot;My Path is $PATH&quot; è¾“å‡ºå¹¶ä¸å¸¦æ¢è¡Œç¬¦å· å¦‚ï¼šecho -n &quot;Hello World&quot; è¾“å‡ºä¸€æ®µæ¿€æ´»è½¬ä¾å­—ç¬¦ å¦‚ï¼š echo -e &quot;Column 1 \t Column 2&quot; date date å‘½ä»¤ä¸»è¦ç”¨æ¥è®¾ç½®å’Œæ‰“å°ç³»ç»Ÿæ—¶é—´ã€‚ è¾“å‡ºé»˜è®¤æ—¶åŒºæ ¼å¼çš„äº‹ä»¶ date +&quot;%c&quot; è¾“å‡ºå½“å‰äº‹ä»¶æŒ‰ç…§UTCå’Œisoæ ¼å¼è¾“å‡º date -u +&quot;%Y-%m-%dT%H:%M:%SZ&quot; è¾“å‡ºäº‹ä»¶æˆ³ date +&quot;%s&quot; reboot å‘½ä»¤ä¸»è¦ç”¨æ¥é‡å¯ç³»ç»Ÿ é‡å¯ç³»ç»Ÿ reboot å¼ºåˆ¶é‡å¯ reboot -f poweroff å‘½ä»¤ç”¨æˆ·å…³æœº wget å‘½ä»¤ ç”¨äºŽä»Žwebä¸­ä¸‹è½½æ–‡ä»¶ï¼Œæ”¯æŒ http,https,ftp èŽ·å–URLä¸­çš„å†…å®¹åˆ°fooä¸­ wget https://example.com/foo èŽ·å–URLä¸­çš„å†…å®¹åˆ°barä¸­ wget -O bar https://example.com/foo ç»§ç»­æœªå®Œæˆçš„ä¸‹è½½ wget -c https://example.com åŽå°ä¸‹è½½ wget -q https://example.com pså‘½ä»¤ä¸»è¦ç”¨äºŽæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„ä¿¡æ¯ æ‰“å°å…¨éƒ¨æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ ps aux æ‰“å°å…¨éƒ¨æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹å¹¶ä¸”ä¼´æœ‰å®Œæ•´çš„å‘½ä»¤ä¸² ps auxww é€šè¿‡ grep ç®¡é“è¿‡æ»¤ ps aux | grep &quot;tomcat&quot; å¾—åˆ°è¿›ç¨‹çš„çˆ¶è¿›ç¨‹pid :ps -o ppid= -p pid topå‘½ä»¤ ä¸»è¦ç”¨æˆ·åŠ¨æ€çš„å®žæ—¶çš„æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„ç¨‹åº top -i ä¸æ˜¾ç¤ºç©ºé—²æˆ–è€…æ˜¯åƒµå°¸è¿›ç¨‹ top -u $user æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·çš„è¿›ç¨‹ top -p PID åªæ˜¾ç¤ºæŒ‡å®šè¿›ç¨‹PID top -p $(pgrep -d &#39;,&#39; process_name) é€šè¿‡è¿›ç¨‹åæ¥æŸ¥è¯¢ pidof å‘½ä»¤ä¸»è¦ç”¨äºŽæŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹çš„idå· pidof -s è¿›è¿”å›žä¸€ä¸ªè¿›ç¨‹å· pidof -c ä»…æ˜¾ç¤ºå…·æœ‰ç›¸åŒrootç›®å½•ä¸‹çš„è¿›ç¨‹ äºŒã€ç³»ç»ŸçŠ¶æ€ ifconfig å‘½ä»¤ä¸»è¦ç”¨äºŽç½‘ç»œæŽ¥å£çš„æŸ¥çœ‹å’Œé…ç½® Ifconfig eth0 æŸ¥çœ‹etho0æŽ¥å£ç½‘ç»œè®¾ç½® ifconfig -a æŸ¥çœ‹æ‰€æœ‰æŽ¥å£çš„è¯¦ç»†ä¿¡æ¯ ifconfig eth0 down å…³é—­æŽ¥å£eth0 ifconfig eth0 ipaddr è®¾ç½®ç«¯å£ipåœ°å€ uname æ‰“å°å‡ºçŽ°å½“å‰æœºå™¨å’Œç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯ uname -n æ‰“å°å½“å‰çš„hostname uname -a æ‰“å°å½“å‰å¯ç”¨çš„ç³»ç»Ÿçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è½¯ä»¶ã€‚ who æ‰“å°å“ªäº›ç”¨æˆ·ç™»å½•å†è¿™å°æœºå™¨ä¸Š who æ˜¾ç¤ºusernameç­‰æ¯”è¾ƒå…¨çš„ä¿¡æ¯ who am i æ‰“å°å‡ºå½“å‰ç”¨æˆ· last ç”¨äºŽæŸ¥çœ‹å½“å‰ç”¨æˆ·æœ€è¿‘çš„ç™»å½•ä¿¡æ¯ ä¸‰ã€æ–‡ä»¶å’Œç›®å½• pwd ç”¨äºŽæ‰“å°å½“å‰ç›®å½• cd ç”¨äºŽåˆ‡æ¢ç›®å½• ls ç”¨äºŽç½—åˆ—ç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ ls -læŒ‰è¡Œç½—åˆ—æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ ls -a æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—çš„æ–‡ä»¶ã€‚ ls -lh æŒ‰ç…§å¤§å°æŽ’æ³„æŽ’åˆ— touch å‘½ä»¤ä¸»è¦ç”¨äºŽæ”¹å˜æ–‡ä»¶çš„è®¿é—®æ—¶é—´å’Œä¿®æ”¹æ—¶é—´ã€‚ touch filename ä»¥å½“å‰æ—¶é—´åˆ›å»ºæ–‡ä»¶ touch -t yyyy-mm-dd filename ä»¥æŸä¸€æ—¶é—´æ¥æ”¹å˜æ–‡ä»¶æ—¶é—´ mkdir å‘½ä»¤ä¸»è¦ç”¨äºŽåˆ›å»ºæ–‡ä»¶ mkdir dir åˆ›å»ºæ–‡ä»¶å¤¹ mkdir -p /path/dir åˆ›å»ºæŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ cp å‘½ä»¤ä¸»è¦ç”¨äºŽæ–‡ä»¶çš„å¤åˆ¶ cp path/to/file.ext path/to/copy.ext å¤åˆ¶æ–‡ä»¶åˆ°å¦ä¸€ä¸ªåœ°å€ cp path/to/file.ext path/to/target_parent_directory å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šåœ°å€ï¼Œå¹¶ä¸”ä¿æŒæ–‡ä»¶åä¸å˜ cp -r path/to/directory path/to/copy é€’å½’çš„å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶ä¸­çš„å†…å®¹åˆ°æŒ‡å®šç›®å½• cp -i *.txt path/to/target_directory ä»¥äº¤äº’çš„æ¨¡å¼å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸­ mv å‘½ä»¤ä¸»è¦ç”¨äºŽç§»åŠ¨æ–‡ä»¶ mv source target ç§»åŠ¨æ–‡ä»¶ mv -f å¼ºåˆ¶ç§»åŠ¨ï¼Œè¦†ç›–çŽ°æœ‰æ–‡ä»¶æ—¶ä¸è¦æç¤º rmå‘½ä»¤ä¸»è¦ç”¨äºŽåˆ é™¤æ–‡ä»¶ rm path/to/file path/to/another/file åˆ é™¤ç‰¹å®šæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ rm -r path/to/directory é€’å½’åˆ é™¤æ–‡ä»¶å¤¹åŠæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ rm -rf é€’å½’åˆ é™¤ï¼Œå¹¶ä¸”ä¸è¦æç¤ºä¿¡æ¯ dd å‘½ä»¤ä¸»è¦ç”¨äºŽè½¬åŒ–å’Œå¤åˆ¶æ–‡ä»¶,åˆ¶ä½œusbé•œåƒ Clone a drive to another drive with 4MB block and ignore error dd if=/dev/source_drive of=/dev/dest_drive bs=4m conv=noerror fileå‘½ä»¤ä¸»è¦ç”¨äºŽç¡®å®šæ–‡ä»¶ç±»åž‹ file filename è¾“å‡ºæ–‡ä»¶ç±»åž‹ file -s filename ç”¨äºŽç‰¹æ®Šçš„æ–‡ä»¶æˆ–è€…è®¾å¤‡æ–‡ä»¶ã€‚ å››ã€æ–‡æœ¬ç¼–è¾‘å‘½ä»¤ cat æ‰“å°å’Œä¸²è”æ–‡ä»¶ cat file æ‰“å°æ–‡ä»¶å†…å®¹åˆ°æ ‡å‡†è¾“å‡º cat file1 file2 &gt; targetFile å°†å¤šä¸ªæ–‡ä»¶å†…å®¹ä¸²è”åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ cat -n file æ‰“å°å‡ºè¡Œæ•°åˆ°æ ‡å‡†è¾“å‡º more ç”¨äºŽäº’åŠ¨çš„é˜…è¯»æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥ä¸Šä¸‹æ»šåŠ¨ more file æ‰“å¼€æ–‡ä»¶ï¼Œ&lt;space&gt;ç”¨äºŽç§»åŠ¨åˆ°ä¸‹ä¸€é¡µï¼Œ/ç”¨äºŽæœç´¢æ–‡ä»¶å†…å®¹ï¼Œ qç”¨äºŽé€€å‡ºå½“å‰ç•Œé¢ head è¾“å‡ºæ–‡ä»¶å¼€å§‹çš„éƒ¨åˆ† head -n count_of_line filename æŸ¥çœ‹æ–‡ä»¶çš„å‰nè¡Œ head -c number_of_byte filename æŸ¥çœ‹æ–‡ä»¶çš„å‰nä¸ªå­—èŠ‚ tail è¾“å‡ºæ–‡ä»¶æœ€åŽçš„éƒ¨åˆ† tail -n num fileæ‰“å°å‡ºæ–‡ä»¶æœ€åŽnumè¡Œ tail -n +num file æ‰“å°å‡ºæ–‡ä»¶ä»Žnumå¼€å§‹çš„å‡ è¡Œ tail -f file ä¿æŒé˜…è¯»çŠ¶æ€ç›´åˆ° Ctrl + c wcå‘½ä»¤ç”¨äºŽç»Ÿè®¡æ–‡ä»¶çš„å•è¯ï¼Œå­—èŠ‚ï¼Œè¡Œæ•° wc -l filename ç»Ÿè®¡æ–‡ä»¶çš„è¡Œæ•° wc -w filename ç»Ÿè®¡æ–‡ä»¶çš„å­—æ•° wc -c filename ç»Ÿè®¡æ–‡ä»¶çš„å­—èŠ‚æ•° æ˜¾ç¤ºæ–‡ä»¶çš„çŠ¶æ€ stat filename æ˜¾ç¤ºæ–‡ä»¶çš„å±žæ€§æ¯”å¦‚å¤§å°ï¼Œæƒé™ç­‰ã€‚ stat -x filenameæ ¼å¼åŒ–æ˜¾ç¤ºæ–‡ä»¶çš„è¯¦ç»†å±žæ€§ä¿¡æ¯ã€‚]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ubuntu18.04 é…ç½®å…¨è¿‡ç¨‹]]></title>
    <url>%2F2019%2F01%2F04%2F2019-01-04-Ubuntu%E9%85%8D%E7%BD%AE%E5%85%A8%E8%BF%87%E7%A8%8B%202%2F</url>
    <content type="text"><![CDATA[Ubuntu18.04 é…ç½®å…¨è¿‡ç¨‹å› ä¸ºæœ€è¿‘åœ¨å¼„win10åŒç³»ç»Ÿï¼Œåˆå› ä¸ºPopOsåœ¨è£…æœºçš„æ—¶å€™è®¾ç½®grubæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æ¢æˆæœ€æ–°çš„Ubuntuç¨³å®šç‰ˆæ¥åšæˆwin/ubunutåŒç³»ç»Ÿã€‚ å®‰è£…é—®é¢˜åœ¨è£…æœºçš„éœ€è¦ä½¿ç”¨grubåšå¯åŠ¨å¼•å¯¼ã€‚æ‰€ä»¥è®¾ç½®ä¿ç•™BIOSå¯åŠ¨åŒºåŸŸè€Œä¸æ˜¯æŒ‚è½½/bootã€‚äº²èº«ç»åŽ†ï¼ŒUEFIå¯åŠ¨æ¨¡å¼ä¸‹ï¼ŒUbuntuçš„å¼•å¯¼æŒ‚è½½åº”è¯¥æ˜¯biosgrubï¼Œå¦åˆ™å‡ºé”™ã€‚å¯¼è‡´æ— æ³•å®¶åœ¨grubã€‚ ç•Œé¢é…ç½®å®‰è£…gnome-tweak-tool1sudo apt install gnome-tweak-tool å¦‚æžœéœ€è¦æ›´æ”¹shellåˆ™éœ€è¦å®‰è£…ï¼š 1sudo apt install gnome-shell-extensions è¿™æ ·å°±èƒ½è½»æ¾æ„‰å¿«çš„ä½¿ç”¨gnome-tewak-tooläº†ã€‚ ä¸»é¢˜æ–¹æ¡ˆä¸»ç•Œé¢å› ä¸ºå‰ä¸€é˜µä½¿ç”¨Pop!_OSå‘çŽ°å®ƒé»˜è®¤çš„ä¸»é¢˜éžå¸¸å¥½çœ‹ï¼Œæ‰€ä»¥ä¸‹è½½Poposé»˜è®¤çš„ä¸»é¢˜ï¼Œç„¶åŽåœ¨gnome-tweak-toolä¸­è®¾ç½®å¥½å°±okäº†ï¼Œè¿™é‡Œæ˜¯PopOsçš„gtkä¸»é¢˜åœ°å€ã€‚ä½†æ˜¯å‘çŽ°PopOsé»˜è®¤çš„è¾“å…¥æ³•è¾“å…¥æ¡†æ˜¯é»˜è®¤ç±³é»„è‰²çš„ï¼Œæ‰“å­—çš„æ—¶å€™ä¸å¤ªæ˜¾çœ¼ï¼Œæ‰€ä»¥åœ¨åŸºç¡€ä¸Šæ·»åŠ äº†å¦‚ä¸‹ä»£ç ã€‚æ·»åŠ æ–¹æ³•ï¼š æ ¹æ®è¯´æ˜Žä¸‹è½½Pop-theme 123sudo add-apt-repository ppa:system76/popsudo apt updatesudo apt install pop-theme å®šä½åˆ° /usr/share/themes/Pop/gnome-shell/ çš„gnome-shell.csså’ŒPop.css å°†IBusçš„ç•Œé¢ä»£ç æ›¿æ¢æˆå¦‚ä¸‹ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566.candidate-popup-content &#123; padding: 8px; spacing: 0;&#125;.candidate-index &#123; padding: 0 4px 0 0; color: rgba(255, 255, 255, 0.5);&#125;.candidate-box:selected .candidate-index &#123; color: rgba(255, 255, 255, 0.5);&#125;.candidate-box &#123; transition-duration: 0ms; min-height: 28px; padding: 0 8px; border-radius: 8px;&#125;.candidate-box:hover &#123; background-color: rgba(255, 255, 255, 0.06); color: rgba(255, 255, 255, 0.9);&#125;.candidate-box:active &#123;background-color: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9);&#125;.candidate-box:selected &#123; background-color: #0046DB; color: rgba(255, 255, 255, 0.85);&#125;.candidate-page-button-box &#123; height: 28px;&#125;.vertical .candidate-page-button-box &#123; padding-top: 0;&#125;.horizontal .candidate-page-button-box &#123; padding-left: 0;&#125;.candidate-page-button &#123; min-width: 28px; min-height: 28px; padding: 0;&#125;.candidate-page-button-previous &#123; border-radius: 8px; border-right-width: 0;&#125;.candidate-page-button-next &#123; border-radius: 8px;&#125;.candidate-page-button-icon &#123; icon-size: 1.23077em;&#125; æœ€åŽæˆå“ï¼š åº”ç”¨ç¨‹åºçª—å£ç”¨çš„æ˜¯ macOS High Sierra ä¸»é¢˜ï¼Œä»¿ç…§MACçš„çª—å£ã€‚æ¯”è¾ƒæ¼‚äº®ã€‚macOS High Sierra ä¸»é¢˜ï¼Œä¸‹è½½ä¸‹æ¥åŽè§£åŽ‹åŽæ”¾åˆ° /usr/share/themes ä¸‹ï¼Œä¹‹åŽå°±èƒ½åœ¨gnome-tweak-toolä¸­çœ‹åˆ°äº†ï¼Œè®¾ç½®å®ŒæˆåŽå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæžœã€‚ gdmä¸»é¢˜gdmä¸»é¢˜é€‰ç”¨ç±»ä¼¼MACç™»é™†çš„ä¸»é¢˜ï¼Œç•Œé¢ç¾Žè§‚ï¼Œè€Œä¸”è¿˜æœ‰æ¯›çŽ»ç’ƒæ•ˆæžœã€‚High Ubunterraä¸‹è½½åŽè§£åŽ‹ä¹‹åŽï¼Œç›´æŽ¥å‘½ä»¤è¡Œæ‰§è¡Œ./install.shã€‚ä¹‹åŽç›´æŽ¥å³é”®è®¾ç½®åŽï¼Œç›´æŽ¥å°†é”å±ç•Œé¢ç›´æŽ¥è®¾ç½®å¥½ã€‚å…¶å®žä¸»è¦ç›®çš„çš„å°±æ˜¯å°† /usr/share/gnome-shell/theme ä¸­çš„ubuntu.cssæ›¿æ¢æŽ‰ã€‚ grubä¸»é¢˜grubçš„ä¸»é¢˜æ¯”è¾ƒå°‘ï¼ŒæŽ¨èçš„å°±æ˜¯Breeze GRUB2 theme æ˜¯ä¸€æ¬¾æ¯”è¾ƒæ¼‚äº®ç¾Žè§‚çš„ä¸»é¢˜ã€‚å…·ä½“æˆæžœç•Œé¢å¯ä»¥ç‚¹å‡»é“¾æŽ¥åœ°å€æŸ¥çœ‹ã€‚ æ™®é€šä¸»é¢˜éœ€è¦ä½œå¦‚ä¸‹é¡ºåºçš„æ“ä½œï¼Œä½†æ˜¯ Breeze Grub2 theme æœ‰è„šæœ¬ï¼Œç›´æŽ¥æ‰§è¡Œè§£åŽ‹åŽçš„è„šæœ¬ç¨‹åºï¼Œå°±okäº†ã€‚ åˆ›å»ºgrubçš„ä¸»é¢˜æ–‡ä»¶å¤¹ 1sudo mkdir /boot/grub/themes å°†ä¸»é¢˜åŒ…ç§»åŠ¨åˆ°è¿™ä¸ªç›®å½•ä¸‹ 1sudo cp ä¸»é¢˜åŒ…å /boot/grub/themes/ ä¿®æ”¹ä¸»é¢˜çš„é…ç½®æ–‡ä»¶ 1sudo vim /etc/grub.d/00_header åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  12GRUB_THEME=&quot;/boot/grub/themes/ä¸»é¢˜åŒ…å/theme.txt&quot;GRUB_GFXMODE=&quot;1920x1080x32&quot; æœ€åŽæ‰§è¡Œ update-grub å‘½ä»¤ gnomeæ‹“å±•æŽ¨èæˆ‘æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æ‹“å±•å®‰è£…ï¼Œåœ¨Ubuntuç³»ç»Ÿä¸‹ï¼Œä¸€èˆ¬å®‰è£…å¦‚ä¸‹æ‹“å±•ã€‚ User themes å¯ä»¥ä½¿ç”¨ç”¨æˆ·ç›®å½•ä¸‹çš„ä¸»é¢˜ removeable Drive Menu å½“æ’å…¥ç§»é™¤è®¾å¤‡çš„æ—¶å€™åœ¨ä¸Šæ–¹æœ‰çŠ¶æ€å›¾æ ‡æé†’ã€‚ Caffeine å¯ä»¥å…³é—­å±ä¿å’Œè‡ªåŠ¨æŒ‚èµ·ï¼Œå¾ˆå¥½ç”¨ã€‚ Dash To Dock å¦‚æžœä½ ä¸å–œæ¬¢ubuntuçš„ä¾§è¾¹dockå¯ä»¥å°è¯•è¿™ä¸ªdockï¼Œæ¯”è¾ƒç¾Žè§‚çš„dockï¼Œå¯ä»¥è®¾ç½®åœ¨ä¾§è¾¹æˆ–è€…åœ¨åº•ä¸‹ã€‚ openWeather å¯ä»¥åœ¨é¡¶éƒ¨æ ä¸­æŸ¥çœ‹å¤©æ°”ï¼Œç‚¹å‡»å¯ä»¥æŸ¥çœ‹æœ€è¿‘å¤©æ°”ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ åœ°å€ã€‚ ClipBord Indicator æ˜¯å¯ä»¥è®°å½•ç²˜è´´æ¿çš„å†…å®¹ï¼Œæœ‰æ—¶å¯ä»¥é¿å…é‡å¤å¤åˆ¶çš„æ“ä½œã€‚ æŽ¨èçš„æœ‰è¿™å‡ ä¸ªï¼Œä½†æ˜¯gnome-shellæ‹“å±•å¯è°“éžå¸¸çš„å¤šï¼Œå¹¶ä¸”å¤§å¤šæ•°éƒ½éžå¸¸å¥½ç”¨ï¼Œå¯ä»¥åŽ» gnome extensions å®˜ç½‘ çœ‹ä¸€çœ‹ï¼Œçœ‹æœ‰æ²¡æœ‰æ›´é€‚åˆè‡ªå·±çš„ã€‚ é…ç½®Vimå’Œç»ˆç«¯é…ç½®vimæˆ‘vimä½¿ç”¨çš„æ˜¯vundleæ’ä»¶ç®¡ç†å™¨ï¼Œé¦–å…ˆè¦å®‰è£…vundle. é¦–å…ˆè¦ä¸‹è½½git 1sudo apt-get install git ç„¶åŽå®‰è£…vundle 1git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vi å°†å¦‚ä¸‹é…ç½®æ›¿æ¢åˆ°.vimrc ä¸­ï¼Œé¦–å…ˆè¦è¿›è¡Œå¤‡ä»½å“¦ï¼ï¼ï¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768set nocompatible &quot; be iMproved, requiredfiletype off &quot; requiredset numberlet mapleader=&quot;,&quot;set rtp+=~/.vim/bundle/Vundle.vimcall vundle#begin()Plugin &apos;VundleVim/Vundle.vim&apos;Plugin &apos;scrooloose/nerdtree&apos;Plugin &apos;kien/ctrlp.vim&apos;Plugin &apos;junegunn/fzf&apos;Plugin &apos;Shougo/neocomplete.vim&apos;Plugin &apos;vim-airline/vim-airline&apos;Plugin &apos;vim-airline/vim-airline-themes&apos;Plugin &apos;terryma/vim-smooth-scroll&apos;Plugin &apos;terryma/vim-expand-region&apos;Plugin &apos;tpope/vim-commentary&apos;Plugin &apos;tpope/vim-surround&apos;Plugin &apos;godlygeek/tabular&apos;Plugin &apos;plasticboy/vim-markdown&apos;Plugin &apos;tpope/vim-fugitive&apos;Plugin &apos;airblade/vim-gitgutter&apos;Plugin &apos;justinmk/vim-sneak&apos;Plugin &apos;powerline/fonts&apos;Plugin &apos;scrooloose/nerdcommenter&apos; Plugin &apos;suan/vim-instant-markdown&apos;Plugin &apos;mzlogin/vim-markdown-toc&apos;call vundle#end() &quot; requiredfiletype plugin indent on&quot; let g:airline_powerline_fonts = 1map &lt;C-n&gt; :NERDTreeToggle&lt;CR&gt;&quot; smooth-scrollfunction SmoothScroll(up) if a:up let scrollaction=&quot;^Y&quot; else let scrollaction=&quot;^E&quot; endif exec &quot;normal &quot; . scrollaction redraw let counter=1 while counter&lt;&amp;scroll let counter+=1 sleep 10m redraw exec &quot;normal &quot; . scrollaction endwhileendfunctionnoremap &lt;silent&gt; &lt;c-u&gt; :call smooth_scroll#up(&amp;scroll, 15, 2)&lt;CR&gt;noremap &lt;silent&gt; &lt;c-d&gt; :call smooth_scroll#down(&amp;scroll, 15, 2)&lt;CR&gt;noremap &lt;silent&gt; &lt;c-b&gt; :call smooth_scroll#up(&amp;scroll*2, 10, 4)&lt;CR&gt;noremap &lt;silent&gt; &lt;c-f&gt; :call smooth_scroll#down(&amp;scroll*2, 10, 4)&lt;CR&gt;set mouse= map &lt;ScrollWheelUp&gt; &lt;C-Y&gt;map &lt;ScrollWheelDown&gt; &lt;C-E&gt;&quot;é«˜äº®é”™è¯¯&quot; let g:syntastic_enable_highlighting=1&quot; å¿«é€Ÿé€‰ä¸­&quot; let g:expand_region_use_select_mode = 1&quot; map w &lt;Plug&gt;(expand_region_expand)&quot; map W &lt;Plug&gt;(expand_region_shrink)&quot; markdown settinglet g:vim_markdown_toc_autofit = 1let g:vim_markdown_autowrite = 1let g:vim_markdown_folding_disabled = 1set updatetime=100let g:gitgutter_grep=&apos;&apos;let g:gitgutter_terminal_reports_focus=0 æœ€åŽåœ¨vimä¸­ä½¿ç”¨:PluginInstall å®‰è£…æ’ä»¶ã€‚å…·ä½“çš„æ’ä»¶çš„ä½œç”¨ä»¥åŽä¼šä¸“é—¨å†™ä¸€ç¯‡æ¥ä»‹ç»ã€‚ä¹Ÿå¯è‡ªè¡Œç™¾åº¦ã€‚ é…ç½®ç»ˆç«¯æˆ‘ä½¿ç”¨çš„æ˜¯zshï¼Œé¦–å…ˆå®‰è£…zsh 1sudo apt-get install zsh ç„¶åŽé…ç½®å°†zshä¸ºé»˜è®¤ 1sudo chsh -s /bin/zsh æœ€åŽä½¿ç”¨è‘—åçš„oh-my-zsh æ¥è£…ç‚¹Bå§ã€‚ 1sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; é…ç½®gitçŽ¯å¢ƒå’Œgithubè¿žæŽ¥å®‰è£…å¥½gitåŽï¼Œé…ç½®git 12git config --global user.name &quot;ä½ çš„githubç”¨æˆ·å&quot;git config --global user.email &quot;ä½ çš„githubé‚®ç®±åœ°å€&quot; ç”Ÿæˆå¯†é’¥ï¼Œä¸€è·¯enterå°±å¯ä»¥ 1ssh-keygen -t rsa -C &quot;ä½ è‡ªå·±çš„githubå¯¹åº”çš„é‚®ç®±åœ°å€&quot; å°†æ–‡ä»¶ä¸­ç”Ÿæˆçš„å¯†é’¥å¤åˆ¶åˆ°githubä¸Šçš„é…ç½®ä¸­åŽ» 1vim ~/.ssh/id_rsa.pub æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ 1ssh -T git@github.com é…ç½®Javaå¼€å‘çŽ¯å¢ƒJDK åœ¨å®˜ç½‘ä¸‹è½½jdkæºç ,å¹¶åœ¨è§£åŽ‹å‰åˆ›å»º /usr/local/java æ–‡ä»¶å¤¹ 1mkdir /usr/local/java å°†æ–‡ä»¶è§£åŽ‹åˆ°åˆšåˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸­ï¼Œä¹Ÿå¯ä»¥è§£åŽ‹åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åŽç§»åŠ¨åˆ°åˆšæ‰åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸‹ã€‚ 123tar -xzvf jdk1.8.0_191.tar.gz mv jdk1.8.0_191 /usr/local/java/ ä½¿ç”¨vimç¼–è¾‘/etc/profile æ–‡ä»¶,åœ¨ç»“å°¾å¤„æ·»åŠ å¦‚ä¸‹å†…å®¹ 123export JAVA_HOME=/usr/local/java/jdk1.8.0_191 export PATH=$JAVA_HOME/bin:$PATH export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar æ‰§è¡Œ source /etc/profile åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œç„¶åŽä½¿ç”¨ java -versionæ¥æŸ¥çœ‹æ˜¯å¦æˆåŠŸã€‚ Maven åœ¨å®˜ç½‘ ä¸‹è½½æºç åŒ…ï¼ŒåŒæ ·è§£åŽ‹å‰åˆ›å»º /usr/local/mavenæ–‡ä»¶å¤¹ å°†æ–‡ä»¶è§£åŽ‹åˆ°/usr/local/mavenä¸­ã€‚ ä½¿ç”¨vimç¼–è¾‘ /etc/profileæ–‡ä»¶ï¼Œåœ¨æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹ 12export MAVEN_HOME=/usr/local/maven/apache-maven-3.6.0export PATH=$MAVEN_HOME/bin:$PATH åŒæ ·ä½¿ç”¨source /etc/profile å‘½ä»¤åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨mvn -v å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚ é…ç½®é˜¿é‡Œmavené•œåƒ ç¼–è¾‘ /usr/local/maven/apache-maven-3.6.0/conf/setting.xmlï¼Œåœ¨&lt;mirrors&gt;&lt;/mirrors&gt;æ ‡ç­¾å†…æ·»åŠ å¦‚ä¸‹å†…å®¹ 123456&lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt; Mysqlå®‰è£…å’Œæ•°æ®åº“ç®¡ç†è½¯ä»¶æŽ¨è è¿›å…¥å®˜ç½‘ä¸‹è½½ubuntuçš„debåŒ…ï¼Œç›´æŽ¥ä½¿ç”¨å‘½ä»¤å®‰è£… 1sudo dpkg -i mysql-apt-config_0.8.11-1_all.deb åˆ·æ–°æºåˆ—è¡¨ 1sudo apt-get update å®‰è£…mysql 1sudo apt-get install mysql-server mysql-client å…¶ä¸­ä¼šè®©ä½ è¾“å…¥å¯†ç ï¼Œè¾“å…¥å°±è¡Œäº†ã€‚]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ubuntu18.04 é…ç½®å…¨è¿‡ç¨‹]]></title>
    <url>%2F2019%2F01%2F04%2F2019-01-04-Ubuntu%E9%85%8D%E7%BD%AE%E5%85%A8%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[Ubuntu18.04 é…ç½®å…¨è¿‡ç¨‹å› ä¸ºæœ€è¿‘åœ¨å¼„win10åŒç³»ç»Ÿï¼Œåˆå› ä¸ºPopOsåœ¨è£…æœºçš„æ—¶å€™è®¾ç½®grubæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æ¢æˆæœ€æ–°çš„Ubuntuç¨³å®šç‰ˆæ¥åšæˆwin/ubunutåŒç³»ç»Ÿã€‚ å®‰è£…é—®é¢˜åœ¨è£…æœºçš„éœ€è¦ä½¿ç”¨grubåšå¯åŠ¨å¼•å¯¼ã€‚æ‰€ä»¥è®¾ç½®ä¿ç•™BIOSå¯åŠ¨åŒºåŸŸè€Œä¸æ˜¯æŒ‚è½½/bootã€‚äº²èº«ç»åŽ†ï¼ŒUEFIå¯åŠ¨æ¨¡å¼ä¸‹ï¼ŒUbuntuçš„å¼•å¯¼æŒ‚è½½åº”è¯¥æ˜¯biosgrubï¼Œå¦åˆ™å‡ºé”™ã€‚å¯¼è‡´æ— æ³•å®¶åœ¨grubã€‚ ç•Œé¢é…ç½®å®‰è£…gnome-tweak-tool1sudo apt install gnome-tweak-tool å¦‚æžœéœ€è¦æ›´æ”¹shellåˆ™éœ€è¦å®‰è£…ï¼š 1sudo apt install gnome-shell-extensions è¿™æ ·å°±èƒ½è½»æ¾æ„‰å¿«çš„ä½¿ç”¨gnome-tewak-tooläº†ã€‚ ä¸»é¢˜æ–¹æ¡ˆä¸»ç•Œé¢å› ä¸ºå‰ä¸€é˜µä½¿ç”¨Pop!_OSå‘çŽ°å®ƒé»˜è®¤çš„ä¸»é¢˜éžå¸¸å¥½çœ‹ï¼Œæ‰€ä»¥ä¸‹è½½Poposé»˜è®¤çš„ä¸»é¢˜ï¼Œç„¶åŽåœ¨gnome-tweak-toolä¸­è®¾ç½®å¥½å°±okäº†ï¼Œè¿™é‡Œæ˜¯PopOsçš„gtkä¸»é¢˜åœ°å€ã€‚ä½†æ˜¯å‘çŽ°PopOsé»˜è®¤çš„è¾“å…¥æ³•è¾“å…¥æ¡†æ˜¯é»˜è®¤ç±³é»„è‰²çš„ï¼Œæ‰“å­—çš„æ—¶å€™ä¸å¤ªæ˜¾çœ¼ï¼Œæ‰€ä»¥åœ¨åŸºç¡€ä¸Šæ·»åŠ äº†å¦‚ä¸‹ä»£ç ã€‚æ·»åŠ æ–¹æ³•ï¼š æ ¹æ®è¯´æ˜Žä¸‹è½½Pop-theme 123sudo add-apt-repository ppa:system76/popsudo apt updatesudo apt install pop-theme å®šä½åˆ° /usr/share/themes/Pop/gnome-shell/ çš„gnome-shell.csså’ŒPop.css å°†IBusçš„ç•Œé¢ä»£ç æ›¿æ¢æˆå¦‚ä¸‹ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566.candidate-popup-content &#123; padding: 8px; spacing: 0;&#125;.candidate-index &#123; padding: 0 4px 0 0; color: rgba(255, 255, 255, 0.5);&#125;.candidate-box:selected .candidate-index &#123; color: rgba(255, 255, 255, 0.5);&#125;.candidate-box &#123; transition-duration: 0ms; min-height: 28px; padding: 0 8px; border-radius: 8px;&#125;.candidate-box:hover &#123; background-color: rgba(255, 255, 255, 0.06); color: rgba(255, 255, 255, 0.9);&#125;.candidate-box:active &#123;background-color: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9);&#125;.candidate-box:selected &#123; background-color: #0046DB; color: rgba(255, 255, 255, 0.85);&#125;.candidate-page-button-box &#123; height: 28px;&#125;.vertical .candidate-page-button-box &#123; padding-top: 0;&#125;.horizontal .candidate-page-button-box &#123; padding-left: 0;&#125;.candidate-page-button &#123; min-width: 28px; min-height: 28px; padding: 0;&#125;.candidate-page-button-previous &#123; border-radius: 8px; border-right-width: 0;&#125;.candidate-page-button-next &#123; border-radius: 8px;&#125;.candidate-page-button-icon &#123; icon-size: 1.23077em;&#125; æœ€åŽæˆå“ï¼š åº”ç”¨ç¨‹åºçª—å£ç”¨çš„æ˜¯ macOS High Sierra ä¸»é¢˜ï¼Œä»¿ç…§MACçš„çª—å£ã€‚æ¯”è¾ƒæ¼‚äº®ã€‚macOS High Sierra ä¸»é¢˜ï¼Œä¸‹è½½ä¸‹æ¥åŽè§£åŽ‹åŽæ”¾åˆ° /usr/share/themes ä¸‹ï¼Œä¹‹åŽå°±èƒ½åœ¨gnome-tweak-toolä¸­çœ‹åˆ°äº†ï¼Œè®¾ç½®å®ŒæˆåŽå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæžœã€‚ gdmä¸»é¢˜gdmä¸»é¢˜é€‰ç”¨ç±»ä¼¼MACç™»é™†çš„ä¸»é¢˜ï¼Œç•Œé¢ç¾Žè§‚ï¼Œè€Œä¸”è¿˜æœ‰æ¯›çŽ»ç’ƒæ•ˆæžœã€‚High Ubunterraä¸‹è½½åŽè§£åŽ‹ä¹‹åŽï¼Œç›´æŽ¥å‘½ä»¤è¡Œæ‰§è¡Œ./install.shã€‚ä¹‹åŽç›´æŽ¥å³é”®è®¾ç½®åŽï¼Œç›´æŽ¥å°†é”å±ç•Œé¢ç›´æŽ¥è®¾ç½®å¥½ã€‚å…¶å®žä¸»è¦ç›®çš„çš„å°±æ˜¯å°† /usr/share/gnome-shell/theme ä¸­çš„ubuntu.cssæ›¿æ¢æŽ‰ã€‚ grubä¸»é¢˜grubçš„ä¸»é¢˜æ¯”è¾ƒå°‘ï¼ŒæŽ¨èçš„å°±æ˜¯Breeze GRUB2 theme æ˜¯ä¸€æ¬¾æ¯”è¾ƒæ¼‚äº®ç¾Žè§‚çš„ä¸»é¢˜ã€‚å…·ä½“æˆæžœç•Œé¢å¯ä»¥ç‚¹å‡»é“¾æŽ¥åœ°å€æŸ¥çœ‹ã€‚ æ™®é€šä¸»é¢˜éœ€è¦ä½œå¦‚ä¸‹é¡ºåºçš„æ“ä½œï¼Œä½†æ˜¯ Breeze Grub2 theme æœ‰è„šæœ¬ï¼Œç›´æŽ¥æ‰§è¡Œè§£åŽ‹åŽçš„è„šæœ¬ç¨‹åºï¼Œå°±okäº†ã€‚ åˆ›å»ºgrubçš„ä¸»é¢˜æ–‡ä»¶å¤¹ 1sudo mkdir /boot/grub/themes å°†ä¸»é¢˜åŒ…ç§»åŠ¨åˆ°è¿™ä¸ªç›®å½•ä¸‹ 1sudo cp ä¸»é¢˜åŒ…å /boot/grub/themes/ ä¿®æ”¹ä¸»é¢˜çš„é…ç½®æ–‡ä»¶ 1sudo vim /etc/grub.d/00_header åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  12GRUB_THEME=&quot;/boot/grub/themes/ä¸»é¢˜åŒ…å/theme.txt&quot;GRUB_GFXMODE=&quot;1920x1080x32&quot; æœ€åŽæ‰§è¡Œ update-grub å‘½ä»¤ gnomeæ‹“å±•æŽ¨èæˆ‘æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æ‹“å±•å®‰è£…ï¼Œåœ¨Ubuntuç³»ç»Ÿä¸‹ï¼Œä¸€èˆ¬å®‰è£…å¦‚ä¸‹æ‹“å±•ã€‚ User themes å¯ä»¥ä½¿ç”¨ç”¨æˆ·ç›®å½•ä¸‹çš„ä¸»é¢˜ removeable Drive Menu å½“æ’å…¥ç§»é™¤è®¾å¤‡çš„æ—¶å€™åœ¨ä¸Šæ–¹æœ‰çŠ¶æ€å›¾æ ‡æé†’ã€‚ Caffeine å¯ä»¥å…³é—­å±ä¿å’Œè‡ªåŠ¨æŒ‚èµ·ï¼Œå¾ˆå¥½ç”¨ã€‚ Dash To Dock å¦‚æžœä½ ä¸å–œæ¬¢ubuntuçš„ä¾§è¾¹dockå¯ä»¥å°è¯•è¿™ä¸ªdockï¼Œæ¯”è¾ƒç¾Žè§‚çš„dockï¼Œå¯ä»¥è®¾ç½®åœ¨ä¾§è¾¹æˆ–è€…åœ¨åº•ä¸‹ã€‚ openWeather å¯ä»¥åœ¨é¡¶éƒ¨æ ä¸­æŸ¥çœ‹å¤©æ°”ï¼Œç‚¹å‡»å¯ä»¥æŸ¥çœ‹æœ€è¿‘å¤©æ°”ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ åœ°å€ã€‚ ClipBord Indicator æ˜¯å¯ä»¥è®°å½•ç²˜è´´æ¿çš„å†…å®¹ï¼Œæœ‰æ—¶å¯ä»¥é¿å…é‡å¤å¤åˆ¶çš„æ“ä½œã€‚ æŽ¨èçš„æœ‰è¿™å‡ ä¸ªï¼Œä½†æ˜¯gnome-shellæ‹“å±•å¯è°“éžå¸¸çš„å¤šï¼Œå¹¶ä¸”å¤§å¤šæ•°éƒ½éžå¸¸å¥½ç”¨ï¼Œå¯ä»¥åŽ» gnome extensions å®˜ç½‘ çœ‹ä¸€çœ‹ï¼Œçœ‹æœ‰æ²¡æœ‰æ›´é€‚åˆè‡ªå·±çš„ã€‚ é…ç½®Vimå’Œç»ˆç«¯é…ç½®vimæˆ‘vimä½¿ç”¨çš„æ˜¯vundleæ’ä»¶ç®¡ç†å™¨ï¼Œé¦–å…ˆè¦å®‰è£…vundle. é¦–å…ˆè¦ä¸‹è½½git 1sudo apt-get install git ç„¶åŽå®‰è£…vundle 1git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vi å°†å¦‚ä¸‹é…ç½®æ›¿æ¢åˆ°.vimrc ä¸­ï¼Œé¦–å…ˆè¦è¿›è¡Œå¤‡ä»½å“¦ï¼ï¼ï¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768set nocompatible &quot; be iMproved, requiredfiletype off &quot; requiredset numberlet mapleader=&quot;,&quot;set rtp+=~/.vim/bundle/Vundle.vimcall vundle#begin()Plugin &apos;VundleVim/Vundle.vim&apos;Plugin &apos;scrooloose/nerdtree&apos;Plugin &apos;kien/ctrlp.vim&apos;Plugin &apos;junegunn/fzf&apos;Plugin &apos;Shougo/neocomplete.vim&apos;Plugin &apos;vim-airline/vim-airline&apos;Plugin &apos;vim-airline/vim-airline-themes&apos;Plugin &apos;terryma/vim-smooth-scroll&apos;Plugin &apos;terryma/vim-expand-region&apos;Plugin &apos;tpope/vim-commentary&apos;Plugin &apos;tpope/vim-surround&apos;Plugin &apos;godlygeek/tabular&apos;Plugin &apos;plasticboy/vim-markdown&apos;Plugin &apos;tpope/vim-fugitive&apos;Plugin &apos;airblade/vim-gitgutter&apos;Plugin &apos;justinmk/vim-sneak&apos;Plugin &apos;powerline/fonts&apos;Plugin &apos;scrooloose/nerdcommenter&apos; Plugin &apos;suan/vim-instant-markdown&apos;Plugin &apos;mzlogin/vim-markdown-toc&apos;call vundle#end() &quot; requiredfiletype plugin indent on&quot; let g:airline_powerline_fonts = 1map &lt;C-n&gt; :NERDTreeToggle&lt;CR&gt;&quot; smooth-scrollfunction SmoothScroll(up) if a:up let scrollaction=&quot;^Y&quot; else let scrollaction=&quot;^E&quot; endif exec &quot;normal &quot; . scrollaction redraw let counter=1 while counter&lt;&amp;scroll let counter+=1 sleep 10m redraw exec &quot;normal &quot; . scrollaction endwhileendfunctionnoremap &lt;silent&gt; &lt;c-u&gt; :call smooth_scroll#up(&amp;scroll, 15, 2)&lt;CR&gt;noremap &lt;silent&gt; &lt;c-d&gt; :call smooth_scroll#down(&amp;scroll, 15, 2)&lt;CR&gt;noremap &lt;silent&gt; &lt;c-b&gt; :call smooth_scroll#up(&amp;scroll*2, 10, 4)&lt;CR&gt;noremap &lt;silent&gt; &lt;c-f&gt; :call smooth_scroll#down(&amp;scroll*2, 10, 4)&lt;CR&gt;set mouse= map &lt;ScrollWheelUp&gt; &lt;C-Y&gt;map &lt;ScrollWheelDown&gt; &lt;C-E&gt;&quot;é«˜äº®é”™è¯¯&quot; let g:syntastic_enable_highlighting=1&quot; å¿«é€Ÿé€‰ä¸­&quot; let g:expand_region_use_select_mode = 1&quot; map w &lt;Plug&gt;(expand_region_expand)&quot; map W &lt;Plug&gt;(expand_region_shrink)&quot; markdown settinglet g:vim_markdown_toc_autofit = 1let g:vim_markdown_autowrite = 1let g:vim_markdown_folding_disabled = 1set updatetime=100let g:gitgutter_grep=&apos;&apos;let g:gitgutter_terminal_reports_focus=0 æœ€åŽåœ¨vimä¸­ä½¿ç”¨:PluginInstall å®‰è£…æ’ä»¶ã€‚å…·ä½“çš„æ’ä»¶çš„ä½œç”¨ä»¥åŽä¼šä¸“é—¨å†™ä¸€ç¯‡æ¥ä»‹ç»ã€‚ä¹Ÿå¯è‡ªè¡Œç™¾åº¦ã€‚ é…ç½®ç»ˆç«¯æˆ‘ä½¿ç”¨çš„æ˜¯zshï¼Œé¦–å…ˆå®‰è£…zsh 1sudo apt-get install zsh ç„¶åŽé…ç½®å°†zshä¸ºé»˜è®¤ 1sudo chsh -s /bin/zsh æœ€åŽä½¿ç”¨è‘—åçš„oh-my-zsh æ¥è£…ç‚¹Bå§ã€‚ 1sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; é…ç½®gitçŽ¯å¢ƒå’Œgithubè¿žæŽ¥å®‰è£…å¥½gitåŽï¼Œé…ç½®git 12git config --global user.name &quot;ä½ çš„githubç”¨æˆ·å&quot;git config --global user.email &quot;ä½ çš„githubé‚®ç®±åœ°å€&quot; ç”Ÿæˆå¯†é’¥ï¼Œä¸€è·¯enterå°±å¯ä»¥ 1ssh-keygen -t rsa -C &quot;ä½ è‡ªå·±çš„githubå¯¹åº”çš„é‚®ç®±åœ°å€&quot; å°†æ–‡ä»¶ä¸­ç”Ÿæˆçš„å¯†é’¥å¤åˆ¶åˆ°githubä¸Šçš„é…ç½®ä¸­åŽ» 1vim ~/.ssh/id_rsa.pub æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ 1ssh -T git@github.com é…ç½®Javaå¼€å‘çŽ¯å¢ƒJDK åœ¨å®˜ç½‘ä¸‹è½½jdkæºç ,å¹¶åœ¨è§£åŽ‹å‰åˆ›å»º /usr/local/java æ–‡ä»¶å¤¹ 1mkdir /usr/local/java å°†æ–‡ä»¶è§£åŽ‹åˆ°åˆšåˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸­ï¼Œä¹Ÿå¯ä»¥è§£åŽ‹åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åŽç§»åŠ¨åˆ°åˆšæ‰åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸‹ã€‚ 123tar -xzvf jdk1.8.0_191.tar.gz mv jdk1.8.0_191 /usr/local/java/ ä½¿ç”¨vimç¼–è¾‘/etc/profile æ–‡ä»¶,åœ¨ç»“å°¾å¤„æ·»åŠ å¦‚ä¸‹å†…å®¹ 123export JAVA_HOME=/usr/local/java/jdk1.8.0_191 export PATH=$JAVA_HOME/bin:$PATH export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar æ‰§è¡Œ source /etc/profile åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œç„¶åŽä½¿ç”¨ java -versionæ¥æŸ¥çœ‹æ˜¯å¦æˆåŠŸã€‚ Maven åœ¨å®˜ç½‘ ä¸‹è½½æºç åŒ…ï¼ŒåŒæ ·è§£åŽ‹å‰åˆ›å»º /usr/local/mavenæ–‡ä»¶å¤¹ å°†æ–‡ä»¶è§£åŽ‹åˆ°/usr/local/mavenä¸­ã€‚ ä½¿ç”¨vimç¼–è¾‘ /etc/profileæ–‡ä»¶ï¼Œåœ¨æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹ 12export MAVEN_HOME=/usr/local/maven/apache-maven-3.6.0export PATH=$MAVEN_HOME/bin:$PATH åŒæ ·ä½¿ç”¨source /etc/profile å‘½ä»¤åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨mvn -v å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚ é…ç½®é˜¿é‡Œmavené•œåƒ ç¼–è¾‘ /usr/local/maven/apache-maven-3.6.0/conf/setting.xmlï¼Œåœ¨&lt;mirrors&gt;&lt;/mirrors&gt;æ ‡ç­¾å†…æ·»åŠ å¦‚ä¸‹å†…å®¹ 123456&lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt; Mysqlå®‰è£…å’Œæ•°æ®åº“ç®¡ç†è½¯ä»¶æŽ¨è è¿›å…¥å®˜ç½‘ä¸‹è½½ubuntuçš„debåŒ…ï¼Œç›´æŽ¥ä½¿ç”¨å‘½ä»¤å®‰è£… 1sudo dpkg -i mysql-apt-config_0.8.11-1_all.deb åˆ·æ–°æºåˆ—è¡¨ 1sudo apt-get update å®‰è£…mysql 1sudo apt-get install mysql-server mysql-client å…¶ä¸­ä¼šè®©ä½ è¾“å…¥å¯†ç ï¼Œè¾“å…¥å°±è¡Œäº†ã€‚]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootè¿‡ç¨‹é—®é¢˜]]></title>
    <url>%2F2019%2F01%2F04%2F2019-01-25-%E8%BF%87%E7%A8%8B%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[SpringBootè¿‡ç¨‹é—®é¢˜springæ³¨è§£ç›¸å…³@RestControllerâ€‹ @RestController æ˜¯spring 4.0æ¥å¼•å…¥çš„ç®€åŒ–çš„RESTful WEBåº”ç”¨çš„åˆ›å»ºï¼Œæ˜¯ä¸€ä¸ªç»“åˆ@Constrollerå’Œ@ResponseBodyçš„æ³¨è§£ï¼Œä¸ç”¨æ¯ä¸ªç±»éƒ½ä½¿ç”¨ResponseBodyæ³¨è§£æ¥è¾¾åˆ°å¤„ç†è¯·æ±‚çš„ç›®çš„ã€‚ â€‹ æŽ§åˆ¶å™¨ä½¿ç”¨@RestControlleræ³¨é‡Šè¿›è¡Œæ³¨é‡Šï¼Œå› æ­¤ä¸éœ€è¦@ResponseBodyã€‚ @RequestMapping@RequestMappingçš„æ³¨è§£ä¸­çš„å‚æ•°ï¼š name ï¼š åœ¨4.0åŽå¼•å…¥çš„ï¼Œå¼€å§‹æˆ‘é”™æŠŠnameå½“valueç”¨ï¼Œç»“æžœå‡ºçŽ° [java.lang.IllegalStateException: Ambiguous mapping found. Cannot map &#39;appController&#39; bean method] ç±»ä¼¼è¿™ç§é”™è¯¯ã€‚å…¶å®žnameå°±æ˜¯ä¸€ä¸ªåå­—è€Œå·²,æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šå«ä¹‰ï¼Œä½†æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­æŒ‡å‡º åœ¨ç±»åž‹çº§åˆ«å’Œæ–¹æ³•çº§åˆ«æ”¯æŒï¼åœ¨ä¸¤ä¸ªçº§åˆ«ä¸Šä½¿ç”¨æ—¶ï¼Œç»„åˆåç§°é€šè¿‡ä¸²è”ä»¥â€œï¼ƒâ€ä½œä¸ºåˆ†éš”ç¬¦æ´¾ç”Ÿ ã€‚ä½¿ç”¨ä¸Šï¼Œå®˜æ–¹è¯´æ˜Žæ˜¯ä¸»è¦å¯ä»¥é€šè¿‡ä½¿ç”¨Spring jsp tagåŒ…é‡Œé¢çš„mvcUrlï¼Œæ¥ç”Ÿæˆjspåˆ°controllerçš„é“¾æŽ¥ã€‚ 1234567@RequestMapping(&quot;/people&quot;) class PersonController &#123; @RequestMapping(&quot;/&#123;id&#125;&quot;) public HttpEntity getPerson(@PathVariable String id) &#123; ... &#125; &#125; 123&lt;%@ taglib uri=&quot;http://www.springframework.org/tags&quot; prefix=&quot;s&quot; %&gt; &lt;a href=&quot;$&#123;s:mvcUrl(&apos;PC#getPerson&apos;).arg(0,&quot;123&quot;).build()&#125;&quot;&gt;Get Person&lt;/a&gt; value:ç”¨æ¥è¡¨ç¤ºä¸»è¦æ˜ å°„,æ˜¯å¸¸ç”¨çš„ 12345@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.GET,produces = &quot;application/json&quot;) public @ResponseBody List&lt;User&gt; findUsers() &#123; return userService.findUsers(); &#125; path: æŒ‡å®šè®¿é—®çš„uriåœ°å€ 12345@RequestMapping(path = &quot;/user&quot;,method = RequestMethod.POST,name = &quot;this is user`s post methods&quot;) public String insertUser()&#123; userService.saveUser(); return null; &#125; method:æ˜ å°„çš„HTTPçš„è®¿é—®æ–¹æ³•ï¼Œæœ‰GET, POST, HEAD, OPTIONS, PUT, PATCH, DELETE, TRACE consumesï¼š æŒ‡å®šå¤„ç†è¯·æ±‚çš„æäº¤å†…å®¹ç±»åž‹ï¼ˆContent-Typeï¼‰ï¼Œä¾‹å¦‚application/json, text/html; produces: æŒ‡å®šè¿”å›žçš„å†…å®¹ç±»åž‹ï¼Œä»…å½“requestè¯·æ±‚å¤´ä¸­çš„(Accept)ç±»åž‹ä¸­åŒ…å«è¯¥æŒ‡å®šç±»åž‹æ‰è¿”å›žï¼› paramsï¼š æŒ‡å®šrequestä¸­å¿…é¡»åŒ…å«æŸäº›å‚æ•°å€¼æ—¶ï¼Œæ‰è®©è¯¥æ–¹æ³•å¤„ç†ã€‚ headersï¼š æŒ‡å®šrequestä¸­å¿…é¡»åŒ…å«æŸäº›æŒ‡å®šçš„headerå€¼ï¼Œæ‰èƒ½è®©è¯¥æ–¹æ³•å¤„ç†è¯·æ±‚ã€‚ Jpaå¸¸ç”¨æ³¨è§£@Entityæ ‡æ³¨åœ¨ç±»å¤–ä¾§ï¼Œæ ‡æ³¨ç€è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªå®žä½“ç±»ã€‚ @Tableâ€‹ æ ‡æ³¨åœ¨ç±»å¤–ä¾§ï¼Œæ ‡æ³¨å®žä½“çš„ä¸»è¡¨ï¼Œå…¶ä¸­æœ‰ catalog,indexes, name, schemaï¼Œåˆ†åˆ«æ³¨æ˜Žä¸ºï¼šæŒ‡å®šdatabaseçš„ç›®å½•ï¼Œç´¢å¼•ï¼Œåç§°ï¼Œå’Œè¡¨çš„ç»“æž„æè¿° â€‹ æ³¨æ„ï¼šschemaå®šä¹‰äº†è¡¨ã€æ¯ä¸ªè¡¨çš„å­—æ®µï¼Œè¿˜æœ‰è¡¨å’Œå­—æ®µä¹‹é—´çš„å…³ç³»ã€‚ @Idè¡¨ç¤ºæ˜¯å®žä½“ç±»çš„ä¸»é”® @GeneratedValueâ€‹ æä¾›ä¸»é”®çš„å€¼å¾—ç”Ÿæˆç­–ç•¥è§„èŒƒã€‚GeneratedValueæ³¨é‡Šå¯ä»¥ä¸ŽIdæ³¨é‡Šä¸€èµ·åº”ç”¨äºŽå®žä½“æˆ–æ˜ å°„è¶…ç±»çš„ä¸»é”®å±žæ€§æˆ–å­—æ®µï¼Œæ´¾ç”Ÿä¸»é”®ä¸æ”¯æŒè¯¥æ³¨è§£ã€‚æä¾›ä¸¤ä¸ªå¯é€‰å€¼ï¼š1. generator ï¼šè¦åœ¨SequenceGeneratoræˆ–TableGeneratoræ³¨è§£ä¸­æŒ‡å®šçš„ä¸»é”®ç”Ÿæˆå™¨çš„åç§°ã€‚2. strategy ç”Ÿæˆç­–ç•¥ï¼Œæœ‰å››ä¸ªå¯é€‰å€¼AUTO,INDENTITY,SEQUENCE å’Œ TABLE ï¼Œé»˜è®¤ä¸ºAUTO @ColumnæŒ‡å®šæŒä¹…å±žæ€§æˆ–å­—æ®µçš„æ˜ å°„åˆ—ã€‚å¦‚æžœæœªæŒ‡å®šColumnæ³¨é‡Šï¼Œåˆ™åº”ç”¨é»˜è®¤å€¼ã€‚ updatableï¼šæ˜¯å¦åŒ…å«åœ¨æ¡†æž¶è‡ªåŠ¨ç”Ÿæˆçš„updateè¯­å¥ä¸­ã€‚ å…¶ä»–å¯ä»¥é€šè¿‡ä¾‹å­ä¸€çœ‹ä¾¿çŸ¥ï¼š 12@Column(name=&quot;description&quot;, nullable=false, length=512)public String getDescription() &#123; return description; &#125; @Transient@Transientè¡¨ç¤ºè¯¥å±žæ€§å¹¶éžä¸€ä¸ªåˆ°æ•°æ®åº“è¡¨çš„å­—æ®µçš„æ˜ å°„,ORMæ¡†æž¶å°†å¿½ç•¥è¯¥å±žæ€§.å¦‚æžœä¸€ä¸ªå±žæ€§å¹¶éžæ•°æ®åº“è¡¨çš„å­—æ®µæ˜ å°„,å°±åŠ¡å¿…å°†å…¶æ ‡ç¤ºä¸º@Transient,å¦åˆ™,ORMæ¡†æž¶é»˜è®¤å…¶æ³¨è§£ä¸º@Basic. @ManyToOneè¡¨ç¤ºä¸€ä¸ªå¤šå¯¹ä¸€çš„æ˜ å°„,è¯¥æ³¨è§£æ ‡æ³¨çš„å±žæ€§é€šå¸¸æ˜¯æ•°æ®åº“è¡¨çš„å¤–é”® 1234567//è®¢å•Orderå’Œç”¨æˆ·Useræ˜¯ä¸€ä¸ªManyToOneçš„å…³ç³»//åœ¨Orderç±»ä¸­å®šä¹‰@ManyToOne()@JoinColumn(name=â€USERâ€)public User getUser() &#123; return user;&#125; @JoinColumnâ€‹ æŒ‡å®šç”¨äºŽè¿žæŽ¥å®žä½“å…³è”æˆ–å…ƒç´ é›†åˆçš„åˆ—ã€‚å¦‚æžœJoinColumnæ³¨è§£æœ¬èº«æ˜¯é»˜è®¤çš„ï¼Œåˆ™å‡å®šä½¿ç”¨å•ä¸ªè¿žæŽ¥åˆ—å¹¶åº”ç”¨é»˜è®¤å€¼ã€‚å…¶é»˜è®¤çš„åç§°ä¸ºå®žä½“Userçš„åç§°+ä¸‹åˆ’çº¿+å®žä½“Userçš„ä¸»é”®åç§°ã€‚ä¹Ÿå°±æ˜¯USER_ID. @OneToMany@OneToManyæè¿°ä¸€ä¸ªä¸€å¯¹å¤šçš„å…³è”,è¯¥å±žæ€§åº”è¯¥ä¸ºé›†ä½“ç±»åž‹,åœ¨æ•°æ®åº“ä¸­å¹¶æ²¡æœ‰å®žé™…å­—æ®µ.ä¾‹å¦‚:å®žä½“Userå’ŒOrderæ˜¯OneToManyçš„å…³ç³»,åˆ™å®žä½“Userè¢«åˆ é™¤æ—¶,å…¶å…³è”çš„å®žä½“Orderä¹Ÿåº”è¯¥è¢«å…¨éƒ¨åˆ é™¤ 1234@OneTyMany(cascade=ALL)public List getOrders() &#123; return orders;&#125; @OneToOneæè¿°ä¸€å¯¹ä¸€çš„å…³ç³» å¦‚Userè¡¨å’Œpersonè¡¨ï¼Œä¸€ä¸ªæ˜¯åŸºæœ¬ä¿¡æ¯ä¸€ä¸ªæ˜¯è¯¦ç»†ä¿¡æ¯ 1234@OneToOne(fetch=FetchType.LAZY) // Fetchæ˜¯æŠ“å–ç­–ç•¥ï¼Œå¦‚æžœä¸å†™ï¼Œè‡ªåŠ¨çš„ç­–ç•¥æ˜¯LAZYpublic Person getPerson() &#123; return person;&#125; @ManyToMany@ManyToMany æè¿°ä¸€ä¸ªå¤šå¯¹å¤šçš„å…³è”.å¤šå¯¹å¤šå…³è”ä¸Šæ˜¯ä¸¤ä¸ªä¸€å¯¹å¤šå…³è”,ä½†æ˜¯åœ¨ManyToManyæè¿°ä¸­,ä¸­é—´è¡¨æ˜¯ç”±ORMæ¡†æž¶è‡ªåŠ¨å¤„ç† @Embedded@Embeddedå°†å‡ ä¸ªå­—æ®µç»„åˆæˆä¸€ä¸ªç±»,å¹¶ä½œä¸ºæ•´ä¸ªEntityçš„ä¸€ä¸ªå±žæ€§. 123456789@Embeddablepublic class Address &#123;city,street,zip&#125; @Entitypublic class User &#123; @Embedded public Address getAddress() &#123; &#125;&#125; æ³¨è§£ è¯´æ˜Ž @Null è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º null @NotNull è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º null @AssertTrue è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º true @Min(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºŽç­‰äºŽæŒ‡å®šçš„æœ€å°å€¼,åŒç†@Max(value) @DecimalMin(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºŽç­‰äºŽæŒ‡å®šçš„æœ€å°å€¼ï¼ŒåŒç†@DecimalMax(value) @Size(max=, min=) è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†… @Past è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡åŽ»çš„æ—¥æœŸï¼ŒåŒç†@Future @Pattern(regex=,flag=) ç¬¦åˆæ­£åˆ™ Hibernate Validator é™„åŠ çš„ constraint @NotBlank(message =) éªŒè¯å­—ç¬¦ä¸²éžnullï¼Œä¸”é•¿åº¦å¿…é¡»å¤§äºŽ0ï¼Œmessageè¡¨ç¤ºæç¤ºä¿¡æ¯ @Email é‚®ç®±éªŒè¯ @Range(min=,max=,message=) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†… spring boot é…ç½®é—®é¢˜spring2.0åŽé™æ€èµ„æºè®¿é—®ä¸åˆ°çš„é—®é¢˜éœ€è¦æ‰‹åŠ¨å†™é…ç½®ç±»è¿›è¡Œé™æ€èµ„æºé…ç½® 123456789101112@Configurationpublic class WebMvcConfig implements WebMvcConfigurer &#123; /** * æ·»åŠ é™æ€èµ„æºæ–‡ä»¶ï¼Œå¤–éƒ¨å¯ä»¥ç›´æŽ¥è®¿é—®åœ°å€ * @param registry */ @Override public void addResourceHandlers(ResourceHandlerRegistry registry) &#123; registry.addResourceHandler(&quot;/static/**&quot;).addResourceLocations(&quot;classpath:/static/&quot;); registry.addResourceHandler(&quot;/templates/**&quot;).addResourceLocations(&quot;classpath:/templates/&quot;); &#125;&#125; é…ç½®SpringBoot Jpaé»˜è®¤mysqlç”Ÿæˆè¡¨å¼•æ“Žä¸ºInnoDBåœ¨é…ç½®æ–‡ä»¶appliction.propertiesä¸­åŠ å…¥ 1spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ubuntuç³»çš„IBUSè¾“å…¥æ³•ä¸Šæ–¹panelçš„è¾“å…¥æ³•å›¾æ ‡æ¶ˆå¤±é—®é¢˜]]></title>
    <url>%2F2018%2F12%2F29%2F2018-12-18-Pop!_Os%E7%9A%84Ibus%E8%BE%93%E5%85%A5%E6%B3%95%E4%B8%8A%E6%96%B9panel%E5%9B%BE%E6%A0%87%E6%B6%88%E5%A4%B1%E7%9A%84%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[Ubuntuç³»çš„IBUSè¾“å…¥æ³•ä¸Šæ–¹panelçš„è¾“å…¥æ³•å›¾æ ‡æ¶ˆå¤±é—®é¢˜æœ€è¿‘è¿·ä¸Šäº†Pop!_Osï¼ŒåŸºäºŽUbuntuçš„å‘è¡Œç‰ˆï¼Œéžå¸¸ç®€æ´ï¼Œå¼€ç®±å³ç”¨ã€‚å’Œubuntuç›¸åŒï¼Œibusçš„è¾“å…¥æ³•å›¾æ ‡æœ‰æ—¶æ¶ˆå¤±ï¼Œåœ¨è¿™é‡Œæ€»ç»“ä»¥ä¸‹ï¼Œæ–¹ä¾¿åŽé¢å†å‡ºçŽ°é—®é¢˜çš„æ—¶å€™æŸ¥é˜…ã€‚ æ‰“å¼€ç»ˆç«¯è¾“å…¥ï¼š 1ibus-daemon -drx è§£å†³ï¼ï¼]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽSpringMvcå®žçŽ°restFulæ—¶DELETEå’ŒPUTå‡ºçŽ°é”™è¯¯]]></title>
    <url>%2F2018%2F11%2F09%2F2018-12-18-%E5%85%B3%E4%BA%8ESpringMvc%E4%BD%BF%E7%94%A8DELETE%E5%92%8CPUT%E8%AF%B7%E6%B1%82%E6%97%B6405%E9%94%99%E8%AF%AF%2F</url>
    <content type="text"><![CDATA[å…³äºŽRESTfulæˆ‘ç†è§£çš„restfulæ˜¯ä¸€ç§é£Žæ ¼ï¼Œæ¯ä¸€ä¸ªurlè¡¨ç¤ºä¸€ä¸ªèµ„æºï¼Œä¸€ä¸ªèµ„æºä¸åŒçš„æ“ä½œäº«ç”¨åŒä¸€ä¸ªæŽ¥å£ï¼Œä½†æ˜¯ä¼ è¾“çš„çŠ¶æ€æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚httpä¸­çš„POST,DELETE,PUT,GETã€‚ å†springMVCä¸­å®žçŽ°RESTful web.xmlä¸­é…ç½® 1234567891011121314151617&lt;filter&gt; &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-class&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter&gt; &lt;filter-name&gt;HttpMethodFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.HttpPutFormContentFilter&lt;/filter-class&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;HttpMethodFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt; springmvc controlå±‚ä½¿ç”¨ç›¸åº”çŠ¶æ€ç æ¥æ ‡è¯†ã€‚ 1@RequestMapping(value = &quot;/navbarCategory/&#123;id&#125;&quot;, method = RequestMethod.DELETE)]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«å’Œå…³ç³»]]></title>
    <url>%2F2018%2F11%2F09%2F2018-11-08-String%E5%92%8CStringBuffer%E5%92%8CStringBuilder%E7%9A%84%E8%81%94%E7%B3%BB%E5%92%8C%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«å’Œå…³ç³»Stringå£°æ˜ŽåŽæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œè€ŒStringbufferå’ŒStringBuilderæ˜¯æ•°æ®ç»“æž„æ˜¯å˜é‡ï¼Œæ‰€ä»¥æ¯”Stringåœ¨è¿žæŽ¥å­—ç¬¦æ—¶æ•ˆçŽ‡é«˜ã€‚ å¹¶ä¸”StringBufferå’ŒStringBuilderçš„åŒºåˆ«æ˜¯StringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„(synchronized) ï¼Œè€ŒStringBuilderæ˜¯éžçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥é€Ÿåº¦å¤§è‡´æŽ’è¡Œä¸ºï¼šStringBuilder&gt;StringBuffer&gt;String ä»¥ä¸Šåªæ˜¯åŸºäºŽå°è±¡æˆ–è€…è¯´æ˜¯æ­»è®°ç¡¬èƒŒçš„ä¸œè¥¿ï¼Œæ²¡æœ‰çœ‹æºç æ˜¯å¦çœŸçš„æ˜¯è¿™æ ·çš„ã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹String,StringBuilder,StringBufferçš„æºç æ¥çœŸæ­£çš„è®°ä½ã€‚ StringStringä¸­çš„concatæ–¹æ³•å®žçŽ°äº†å­—ç¬¦ä¸²çš„æ‹¼æŽ¥ã€‚ å®žä¾‹å˜é‡Stringç±»ä¸­æœ‰ä¸¤ä¸ªå®žä¾‹å˜é‡ï¼Œåˆ†åˆ«ä¸ºvalueå’Œhash 12345/** The value is used for character storage. */private final char value[];/** Cache the hash code for the string */private int hash; // Default to 0 æž„é€ æ–¹æ³•Stringçš„æž„é€ æ–¹æ³•å¾ˆå¤šï¼Œä½†æ˜¯éƒ½æ¯”è¾ƒç®€å•ï¼Œä¸‹é¢æ¥è¯´æ¯”è¾ƒå¸¸ç”¨çš„å‡ ç§ã€‚ 12345678910111213// å½“æ–°å»ºä¸€ä¸ªStringå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šé»˜è®¤ä»˜ä¸€ä¸ªç©ºçš„å­—ç¬¦åºåˆ—,è¯·æ³¨æ„ï¼Œç”±äºŽå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤ä¸å¿…ä½¿ç”¨æ­¤æž„é€ å‡½æ•°public String() &#123; this.value = "".value; &#125;// è¿™ä¸ªæž„é€ æ–¹æ³•,ä¼šé»˜è®¤æ–°å»ºä¸€ä¸ªå€¼ä¸ºoriginalçš„å­—ç¬¦ä¸²ã€‚åŒä¸Šï¼Œå¦‚æžœå­—ç¬¦ä¸²ä¸å¯å˜çš„ï¼Œå°±æ²¡å¿…è¦è¿™æ ·å£°æ˜Žã€‚public String(String original) &#123; this.value = original.value; this.hash = original.hash; &#125;// ä½¿ç”¨copyofæ–¹æ³•ç”¨æ¥å¤åˆ¶ä¸€ä¸ªæ–°çš„å­—ç¬¦æ•°ç»„ï¼ŒåŽç»­ä¿®æ”¹å­—ç¬¦æ•°ç»„ï¼Œä¸ä¼šå½±å“åˆ°æ–°å»ºçš„å­—ç¬¦ä¸²public String(char value[]) &#123; this.value = Arrays.copyOf(value, value.length);&#125; concatæ–¹æ³•ä¸ºä»€ä¹ˆè¯´Stringçš„æ•ˆçŽ‡ä½Žï¼Œå°±ä½“çŽ°åœ¨concatæ‹¼æŽ¥å­—ç¬¦ä¸²çš„æ—¶å€™æ¯æ¬¡éƒ½è¦è¿”å›žä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ã€‚ 1234567891011 public String concat(String str) &#123; int otherLen = str.length(); if (otherLen == 0) &#123; return this; &#125; int len = value.length; char buf[] = Arrays.copyOf(value, len + otherLen); str.getChars(buf, len);// è¿”å›žä¸€ä¸ªæ–°å»ºçš„Stringå¯¹è±¡ return new String(buf, true); &#125; StringBuilderStringBuilderç»§æ‰¿äº†AbstractStringBuilderï¼Œå…¶ä¸­çš„å®žä¾‹å˜é‡å’ŒStringä¸­çš„åŸºæœ¬ç›¸åŒï¼Œ æž„é€ æ–¹æ³•1234567public StringBuilder(int capacity) &#123; super(capacity); &#125;// è°ƒç”¨çˆ¶ç±»çš„æž„é€ æ–¹æ³•AbstractStringBuilder(int capacity) &#123; value = new char[capacity]; &#125; appendæ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œå¹¶æ²¡æœ‰æ–°å»ºå¯¹è±¡ï¼Œåªæ˜¯åœ¨æ”¹å˜å¯¹è±¡ä¸­çš„å†…å®¹ã€‚ 123456789101112131415public StringBuilder append(String str) &#123; super.append(str); return this; &#125;// appendè°ƒç”¨çš„è¿˜æ˜¯çˆ¶ç±»çš„appendæ–¹æ³•public AbstractStringBuilder append(String str) &#123; if (str == null) return appendNull(); int len = str.length(); ensureCapacityInternal(count + len); str.getChars(0, len, value, count);// æŠŠvalueæ‰©å®¹åŽå†æŠŠstråŠ è¿›åŽ» count += len; return this; &#125; StringBufferå’ŒStringBuilderä¸€æ ·ï¼Œä¹Ÿæ˜¯ç»§æ‰¿äº†AbstractStringBuilderç±»ï¼Œä½†æ˜¯çœ‹ä¸€ä¸ªappendè¿™ä¸ªæ–¹æ³•çš„æºç å°±èƒ½å¤ŸçŸ¥é“æœ‰ä»€ä¹ˆåŒºåˆ«äº† appendæ–¹æ³•æ·»åŠ äº†synchronizedå…³é”®å­—ï¼Œä½¿å¾—å˜ä¸ºçº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯ä»£ä»·å°±æ˜¯æ•ˆçŽ‡ä¸å¦‚StringBuilderé«˜ã€‚ 123456@Overridepublic synchronized StringBuffer append(String str) &#123; toStringCache = null; super.append(str); return this;&#125;]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒRPCæ¡†æž¶ï¼Œæ•°æ®åº“ä¸­é—´ä»¶çš„æ¦‚å¿µè®¤çŸ¥]]></title>
    <url>%2F2018%2F10%2F30%2F2018-10-29-%E4%BB%80%E4%B9%88%E6%98%AF%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%8CRPC%E6%A1%86%E6%9E%B6%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒRPCæ¡†æž¶ï¼Œæ•°æ®åº“ä¸­é—´ä»¶çš„æ¦‚å¿µè®¤çŸ¥æ¶ˆæ¯ä¸­é—´ä»¶ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶å¯¹ä¸­é—´ä»¶çš„ç†è§£å¤§æ¦‚å°±æ˜¯å…·ä½“ä¸šåŠ¡å’Œåº•å±‚é€»è¾‘è§£è€¦çš„ç»„ä»¶ã€‚ç›¸å½“äºŽå‰ç«¯ä¸šåŠ¡å’Œåº•å±‚é€»è¾‘çš„ä¸­é—´æ¡¥æ¢ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€å’ŒæŽ¥å—æ¶ˆæ¯çš„åŸºç¡€æœåŠ¡è®¾æ–½ã€‚ èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ ä¸šåŠ¡è§£è€¦ï¼šäº¤æ˜“ç³»ç»Ÿä¸éœ€è¦çŸ¥é“çŸ­ä¿¡é€šçŸ¥æœåŠ¡çš„å­˜åœ¨ï¼Œåªéœ€è¦å‘å¸ƒæ¶ˆæ¯ å‰Šå³°å¡«è°·ï¼šæ¯”å¦‚ä¸Šæ¸¸ç³»ç»Ÿçš„åžåèƒ½åŠ›é«˜äºŽä¸‹æ¸¸ç³»ç»Ÿï¼Œåœ¨æµé‡æ´ªå³°æ—¶å¯èƒ½ä¼šå†²åž®ä¸‹æ¸¸ç³»ç»Ÿï¼Œæ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥åœ¨å³°å€¼æ—¶å †ç§¯æ¶ˆæ¯ï¼Œè€Œåœ¨å³°å€¼è¿‡åŽ»åŽä¸‹æ¸¸ç³»ç»Ÿæ…¢æ…¢æ¶ˆè´¹æ¶ˆæ¯è§£å†³æµé‡æ´ªå³°çš„é—®é¢˜ äº‹ä»¶é©±åŠ¨ï¼šç³»ç»Ÿä¸Žç³»ç»Ÿä¹‹é—´å¯ä»¥é€šè¿‡æ¶ˆæ¯ä¼ é€’çš„å½¢å¼é©±åŠ¨ä¸šåŠ¡ï¼Œä»¥æµå¼çš„æ¨¡åž‹å¤„ç† RPCæ¡†æž¶ä»€ä¹ˆæ˜¯RPCæ¡†æž¶è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®RPCï¼ˆRemote Procedure Call Protocol) ä¸¤å°æœåŠ¡å™¨Aï¼ŒBï¼Œä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨AæœåŠ¡å™¨ä¸Šï¼Œæƒ³è¦è°ƒç”¨BæœåŠ¡å™¨ä¸Šåº”ç”¨æä¾›çš„å‡½æ•°/æ–¹æ³•ï¼Œç”±äºŽä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æŽ¥è°ƒç”¨ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰å’Œä¼ è¾¾è°ƒç”¨çš„æ•°æ®ã€‚ èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ å»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„TCPé“¾æŽ¥ï¼Œä¸åŒçš„RPCåè®®ï¼Œæœ‰ä¸åŒçš„è¿žæŽ¥å¯»å€æ–¹å¼ã€‚ åœ¨å‘èµ·è¿œç¨‹è°ƒç”¨æ—¶ï¼Œç”±äºŽç½‘ç»œåè®®æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæ‰€ä»¥åœ¨ä¼ è¾“å‰è¦è¿›è¡Œå¯¹ä¼ è¾“å®žä½“è¿›è¡Œè½¬æ¢äºŒè¿›åˆ¶çš„è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯å°±åºåˆ—åŒ–è¿‡ç¨‹ï¼ˆSerializeï¼‰ï¼Œé€šè¿‡å¯»å€å’ŒäºŒè¿›åˆ¶çš„æ•°æ®ä¼ è¾“åˆ°æœåŠ¡å™¨ç«¯ åœ¨æŽ¥å—åˆ°æ•°æ®åŽï¼Œéœ€è¦è¿›è¡Œååºåˆ—åŒ–è¿‡ç¨‹è§£æžäºŒè¿›åˆ¶æ•°æ®ã€‚ å…¶å®žå°±æ˜¯è§£å†³åœ¨åˆ†å¸ƒå¼ä¸‹ï¼Œæ¨ªå‘æ‹“å±•çš„å‰æä¸‹ï¼Œä¸åŒæœåŠ¡å™¨ç›¸äº’è°ƒç”¨æ–¹æ³•çš„é—®é¢˜ã€‚ æ•°æ®åº“ä¸­é—´ä»¶ä»€ä¹ˆæ˜¯æ•°æ®åº“ä¸­é—´ä»¶åŒæ ·åœ¨åˆ†å¸ƒå¼çš„æž¶æž„ä¸­ï¼Œæ•°æ®åº“ä¹Ÿæ”¾åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œéœ€è¦é€šè¿‡ä¸­é—´çš„è·¯ç”±è¿›è¡Œè°ƒç”¨ã€‚è¿™ä¸ªè·¯ç”±å®žé™…ä¸Šå°±æ˜¯æ•°æ®åº“ä¸­é—´ä»¶ã€‚ èƒ½å¤Ÿåšä»€ä¹ˆï¼Ÿ å®žçŽ°è¯»å†™åˆ†ç¦»ï¼Œä½†æ˜¯æ¯ä¸ªæœåŠ¡å™¨ä¸Šéƒ½éœ€è¦æœ‰ä¸€ä»½å®Œæ•´çš„æ•°æ®åº“ å®žçŽ°åˆ†åº“åˆ†è¡¨ï¼Œé€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡ŒæŸ¥è¯¢åˆ†æ´¾åˆ°æŸä¸€ä¸ªç‰¹å®šçš„æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡è¿™ä¸ªæœåŠ¡å™¨æŸ¥è¯¢å‡ºå†…å®¹è¿”å›žåˆ°æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå†é€šè¿‡ä¸­é—´ä»¶è¿”å›žåˆ°å®¢æˆ·ç«¯ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Junitçš„ä½¿ç”¨å’Œæºç åˆ†æž]]></title>
    <url>%2F2018%2F10%2F29%2F2018-10-28-Junit4%202%2F</url>
    <content type="text"><![CDATA[Junitçš„ä½¿ç”¨å’Œæºç åˆ†æžJunitæ˜¯ä¸€ä¸ªç¼–å†™å¯é‡å¤æµ‹è¯•çš„Javaæµ‹è¯•æ¡†æž¶ï¼Œä»£ç ç¼–å†™éžå¸¸æœ‰æŠ€å·§æ€§ï¼Œå€¼å¾—åå¤é˜…è¯»ã€‚ è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ Junitå®˜æ–¹æ–‡æ¡£å¾€å¾€æ˜¯å­¦ä¹ æœ€å¥½çš„èµ„æ–™ã€‚ ç®€å•æµ‹è¯•ä¾‹å­1234567891011121314151617181920212223public class FirstTest &#123; public int add(int a, int b) &#123; return a + b; &#125; @Test public void testAdd()&#123; FirstTest firstTest = new FirstTest(); int result = firstTest.add(1,2); // assertEquals(4,result); assertEquals(3,result); &#125; &lt;!-- - å¦‚æžœåˆ¤æ–­ä¸ç›¸ç­‰çš„æ—¶å€™ï¼ŒåŽå°æŠ¥é”™ä¿¡æ¯ - java.lang.AssertionError: - Expected :4 - Actual :3 - &lt;Click to see difference&gt; --&gt;&#125; è¿™åªæ˜¯ç®€å•çš„ä¾‹å­ï¼Œå®žé™…ä¸Šçš„å•å…ƒæµ‹è¯•è¦æ¯”è¿™ä¸ªå¤æ‚çš„å¤šï¼Œåœ¨å®žé™…åº”ç”¨ä¸Šå•å…ƒæµ‹è¯•ååˆ†æœ‰å¿…è¦ï¼Œç¼–å†™åŽå°ä»£ç æ—¶èƒ½å¤Ÿå°½å¿«æ£€éªŒä»£ç çš„æ­£ç¡®æ€§ã€‚ Assertions æ–­è¨€Junitæä¾›äº†æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»åž‹ï¼ŒObjectç±»å’Œæ•°ç»„çš„æ–­è¨€ï¼Œå‚æ•°æ˜¯ é¢„æœŸå€¼åŽé¢æ˜¯å®žé™…å€¼ï¼Œå¯é€‰é¡¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯æ–­è¨€å¤±è´¥æ—¶è¾“å‡ºçš„å†…å®¹ï¼Œä¸Žå…¶ä»–æ–­è¨€ç¨æœ‰ä¸åŒçš„æ˜¯ï¼ŒAssertThatçš„å‚æ•°æ˜¯ å¤±è´¥è¾“å‡ºçš„å†…å®¹ï¼Œå®žé™…å€¼å’Œä¸€ä¸ªMatcherObjectã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public class AssertTests &#123; @Test public void testAssertArrayEquals() &#123; byte[] expected = "trial".getBytes(); byte[] actual = "trial".getBytes(); assertArrayEquals("failure - byte arrays not same", expected, actual); &#125; @Test public void testAssertEquals() &#123; assertEquals("failure - strings are not equal", "text", "text"); &#125; @Test public void testAssertFalse() &#123; assertFalse("failure - should be false", false); &#125; @Test public void testAssertNotNull() &#123; assertNotNull("should not be null", new Object()); &#125; @Test public void testAssertNotSame() &#123; assertNotSame("should not be same Object", new Object(), new Object()); &#125; @Test public void testAssertNull() &#123; assertNull("should be null", null); &#125; @Test public void testAssertSame() &#123; Integer aNumber = Integer.valueOf(768); assertSame("should be same", aNumber, aNumber); &#125; // JUnit Matchers assertThat @Test public void testAssertThatBothContainsString() &#123; assertThat("albumen", both(containsString("a")).and(containsString("b"))); &#125; @Test public void testAssertThatHasItems() &#123; assertThat(Arrays.asList("one", "two", "three"), hasItems("one", "three")); &#125; @Test public void testAssertThatEveryItemContainsString() &#123; assertThat(Arrays.asList(new String[] &#123; "fun", "ban", "net" &#125;), everyItem(containsString("n"))); &#125; // Core Hamcrest Matchers with assertThat @Test public void testAssertThatHamcrestCoreMatchers() &#123; assertThat("good", allOf(equalTo("good"), startsWith("good"))); assertThat("good", not(allOf(equalTo("bad"), equalTo("good")))); assertThat("good", anyOf(equalTo("bad"), equalTo("good"))); assertThat(7, not(CombinableMatcher.&lt;Integer&gt; either(equalTo(3)).or(equalTo(4)))); assertThat(new Object(), not(sameInstance(new Object()))); &#125; @Test public void testAssertTrue() &#123; assertTrue("failure - should be true", true); &#125;&#125; å¼‚å¸¸æµ‹è¯•ä¸‹é¢åˆ†ä¸ºä¸¤ç§æ–¹å¼æ¥å®Œæˆå¯¹å¼‚å¸¸çš„æµ‹è¯• æœŸå¾…çš„å¼‚å¸¸å¦‚ä½•æ£€æµ‹ç¨‹åºæ˜¯å¦å¦‚æœŸçš„æŠ›å‡ºå¼‚å¸¸ï¼Œjunitå¯ä»¥ä½¿ç”¨æ³¨è§£çš„å‚æ•°æ¥å®žçŽ°ã€‚ 1234@Test(expected = IndexOutOfBoundsException.class)public void testException()&#123; new ArrayList&lt;Integer&gt;().get(0);&#125; æ·±å…¥çš„å¼‚å¸¸ä¸Šè¿°æ–¹æ³•å¯¹äºŽç®€å•çš„æƒ…å†µå¾ˆæœ‰ç”¨ï¼Œä½†å®ƒæœ‰å…¶å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œæ‚¨æ— æ³•åœ¨å¼‚å¸¸ä¸­æµ‹è¯•æ¶ˆæ¯çš„å€¼ï¼Œä¹Ÿæ— æ³•åœ¨æŠ›å‡ºå¼‚å¸¸åŽæµ‹è¯•åŸŸå¯¹è±¡çš„çŠ¶æ€ try/catch è¯­å¥ 123456789@Testpublic void testTryCatch()&#123; try &#123; new ArrayList&lt;Integer&gt;().get(0); fail("å¤±è´¥ä¿¡æ¯"); &#125;catch (IndexOutOfBoundsException indexOutOfBoundsExecption)&#123; assertThat(indexOutOfBoundsExecption.getMessage(), is("Index: 0, Size: 0")); &#125;&#125; rule è§„åˆ™ 12345678910@Rulepublic ExpectedException thrown = ExpectedException.none();@Testpublic void testExpectException()&#123; List&lt;Object&gt; list = new ArrayList&lt;Object&gt;(); thrown.expect(IndexOutOfBoundsException.class); thrown.expectMessage("Index: 0, Size: 0"); list.get(0); // execution will never get past this line&#125; Matchers and assertThat [ åŒ¹é…å™¨å’ŒassertThat ]æ–°åŠ å…¥äº†assertThatæ–­è¨€æœºåˆ¶ assertThat([value], [matcher statement]); 1234assertThat(x, is(3));assertThat(x, is(not(4)));assertThat(responseString, either(containsString("color")).or(containsString("colour")));assertThat(myList, hasItem("3")); assertThat æ›´å…·æœ‰å¯è¯»æ€§å’Œå¯è¾“å…¥æ€§ï¼Œå¹¶ä¸”æœ‰ç»„åˆæ€§ï¼Œå°±åƒ is(not(4)) ä»»ä½•Macherséƒ½å¯ä»¥ç»„åˆèµ·æ¥ä½¿ç”¨ ä»¥å‰çš„assertEqualsç­‰ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ï¼ŒassertThat åœ¨ä½¿ç”¨Matchersçš„æ—¶å€™éœ€è¦ä½¿ç”¨ import static org.hamcrest.CoreMatchers.*;æ¥å¼•ç”¨ã€‚é‡Œé¢çš„æ–¹æ³•éžå¸¸å¤šã€‚ã€‚ junitæºç è·Ÿè¯»ä½¿ç”¨junitæµç¨‹ä½¿ç”¨ç»§æ‰¿è‡ªTestCaseç±»ä¸‹é¢é€šè¿‡è¿è¡Œjunitçš„è‡ªå¸¦çš„testï¼Œæºç¨‹åºä¸ºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566/** * Some simple tests. */public class SimpleTest extends TestCase &#123; protected int fValue1; protected int fValue2; @Override protected void setUp() &#123; fValue1 = 2; fValue2 = 3; &#125; public static Test suite() &#123; /* * the type safe way * TestSuite suite= new TestSuite(); suite.addTest( new SimpleTest("add") &#123; protected void runTest() &#123; testAdd(); &#125; &#125; ); suite.addTest( new SimpleTest("testDivideByZero") &#123; protected void runTest() &#123; testDivideByZero(); &#125; &#125; ); return suite; */ /* * the dynamic way */ return new TestSuite(SimpleTest.class); &#125; public void testAdd() &#123; double result = fValue1 + fValue2; // forced failure result == 5 assertTrue(result == 6); &#125; public int unused; public void testDivideByZero() &#123; int zero = 0; int result = 8 / zero; unused = result; // avoid warning for not using result &#125; public void testEquals() &#123; assertEquals(12, 12); assertEquals(12L, 12L); assertEquals(new Long(12), new Long(12)); assertEquals("Size", 12, 13); assertEquals("Capacity", 12.0, 11.99, 0.0); &#125; public static void main(String[] args) &#123; junit.textui.TestRunner.run(suite()); &#125;&#125; æ¥çœ‹mainæ–¹æ³•ï¼Œä½¿ç”¨ junit.textui.TestRunner.run(suite()); ä½¿ç”¨TestRunnerè¿è¡Œtestã€‚é¦–å…ˆå…ˆæ¥çœ‹suiteæ–¹æ³•ï¼Œæœ‰ä¸¤ç§æ–¹æ³• é™æ€çš„,éœ€è¦æ‰‹åŠ¨åœ¨testSuiteä¸­æ·»åŠ testã€‚ åŠ¨æ€çš„ï¼Œé™æ€éœ€è¦å®žçŽ°TestCaseçš„runTestæ–¹æ³•ã€‚è€ŒåŠ¨æ€çš„åªéœ€è¦è¿”å›ž TestSuite(SimpleTest.class);ï¼Œä¸‹é¢æ¥çœ‹è¿™ä¸ªTestSuiteç±» testSuiteå®žé™…ä¸Šå°±æ˜¯è¿è¡Œtestçš„é›†åˆï¼Œä½¿ç”¨vectoræ¥å­˜å‚¨test,å…¶ä¸­è¿™é‡Œä½¿ç”¨åˆ°çš„TestSuiteæž„é€ æ–¹æ³•æ˜¯ï¼š 123456789101112131415161718192021222324252627282930313233public TestSuite(final Class&lt;?&gt; theClass) &#123; addTestsFromTestCase(theClass); &#125;private void addTestsFromTestCase(final Class&lt;?&gt; theClass) &#123; fName = theClass.getName(); try &#123; getTestConstructor(theClass); // Avoid generating multiple error messages &#125; catch (NoSuchMethodException e) &#123; addTest(warning("Class " + theClass.getName() + " has no public constructor TestCase(String name) or TestCase()")); return; &#125;// è¿™ä¸ªç±»æ˜¯å¦æ˜¯publicçš„ å¦‚æžœä¸æ˜¯ å‘å‡ºwarning ï¼Œå¹¶ä¸”fail(message) if (!Modifier.isPublic(theClass.getModifiers())) &#123; addTest(warning("Class " + theClass.getName() + " is not public")); return; &#125; Class&lt;?&gt; superClass = theClass; List&lt;String&gt; names = new ArrayList&lt;String&gt;();// è¿™å¥è¯è¯´æ˜Žçš„æ˜¯å¦‚æžœè¿™ä¸ªç±»æ˜¯superClassçš„è¶…ç±»ï¼Œæˆ–è€…æŽ¥å£å°±è¿”å›žtrueï¼Œå¦åˆ™è¿”å›žfalse while (Test.class.isAssignableFrom(superClass)) &#123;// å¦‚æžœæ˜¯true æœ‰é¡ºåºçš„è¿”å›žå£°æ˜Žçš„æ–¹æ³• for (Method each : MethodSorter.getDeclaredMethods(superClass)) &#123; addTestMethod(each, names, theClass); &#125;// èŽ·å¾—superclassç±»ï¼Œé€’å½’çš„æŸ¥æ‰¾testæ–¹æ³• superClass = superClass.getSuperclass(); &#125; if (fTests.size() == 0) &#123; addTest(warning("No tests found in " + theClass.getName())); &#125; &#125; æœ€åŽæåˆ°çš„ fTests.size() == 0 è¿™é‡Œä¼šå‘ç”Ÿwarning ç„¶åŽfailã€‚è¿™ä¸ªfTests å·²ç»å†å‰é¢å£°æ˜Žäº†ï¼Œå£°æ˜Žæ–¹æ³•æ˜¯ï¼šprivate Vector&lt;Test&gt; fTests = new Vector&lt;Test&gt;(10); åœ¨å¯¹æ¯ä¸ªå£°æ˜Žçš„æ–¹æ³•å¾ªçŽ¯çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ° addTestMethod æ–¹æ³•ï¼Œæ¥å¯¹æ¯ä¸ªæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ 1234567891011121314151617181920private void addTestMethod(Method m, List&lt;String&gt; names, Class&lt;?&gt; theClass) &#123;// èŽ·å¾—æ–¹æ³•åå¦‚æžœlistæ•°ç»„ä¸­å·²ç»åŒ…å«è¿™ä¸ªæ–¹æ³•åï¼Œå°±ç›´æŽ¥é€€å‡º String name = m.getName(); if (names.contains(name)) &#123; return; &#125; if (!isPublicTestMethod(m)) &#123; if (isTestMethod(m)) &#123; addTest(warning("Test method isn't public: " + m.getName() + "(" + theClass.getCanonicalName() + ")")); &#125; return; &#125;// æŠŠè¿™ä¸ªæ–¹æ³•ååŠ å…¥åˆ°names Listä¸­ names.add(name); addTest(createTest(theClass, name)); &#125;//å†æ¥çœ‹å¤–å±‚çš„addTestæ–¹æ³• æŠŠæ‹¥æœ‰çš„testæ–¹æ³•æ”¾åˆ°fTestsä¸­ã€‚public void addTest(Test test) &#123; fTests.add(test); &#125; ä½¿ç”¨createTestæ¥é’ˆå¯¹testæ–¹æ³•åˆ›å»ºä¸€ä¸ªTestç±» 123456789101112131415161718192021222324252627static public Test createTest(Class&lt;?&gt; theClass, String name) &#123; Constructor&lt;?&gt; constructor; try &#123; constructor = getTestConstructor(theClass); &#125; catch (NoSuchMethodException e) &#123; return warning("Class " + theClass.getName() + " has no public constructor TestCase(String name) or TestCase()"); &#125; Object test; // é€šè¿‡åå°„æ–¹å¼èŽ·å¾—æ–¹æ³•çš„testå®žä¾‹ try &#123; if (constructor.getParameterTypes().length == 0) &#123; test = constructor.newInstance(new Object[0]); if (test instanceof TestCase) &#123; ((TestCase) test).setName(name);//å¦‚æžœç»§æ‰¿TestCase &#125; &#125; else &#123; test = constructor.newInstance(new Object[]&#123;name&#125;); &#125; &#125; catch (InstantiationException e) &#123; return (warning("Cannot instantiate test case: " + name + " (" + Throwables.getStacktrace(e) + ")")); &#125; catch (InvocationTargetException e) &#123; return (warning("Exception in constructor: " + name + " (" + Throwables.getStacktrace(e.getTargetException()) + ")")); &#125; catch (IllegalAccessException e) &#123; return (warning("Cannot access test case: " + name + " (" + Throwables.getStacktrace(e) + ")")); &#125; return (Test) test; &#125; ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤èŽ·å¾—äº†è¿™ä¸ªç±»ä¸­åŠå…¶çˆ¶ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•çš„Testã€‚ ä½¿ç”¨testRunner.runè¿è¡Œtest 1234567891011121314151617181920212223242526public static void main(String[] args) &#123; junit.textui.TestRunner.run(suite()); &#125;// ä½¿ç”¨TestRunnerçš„runçš„é™æ€æ–¹æ³• è¿”å›žä¸€ä¸ªTestResultç”¨æ¥è¿”å›žç»“æžœã€‚ static public TestResult run(Test test) &#123; TestRunner runner = new TestRunner(); return runner.doRun(test); &#125;// è°ƒç”¨runnerçš„doRunæ–¹æ³•public TestResult doRun(Test test) &#123; return doRun(test, false); &#125;public TestResult doRun(Test suite, boolean wait) &#123;// ç”¨æ¥è¿”å›žç»“æžœçš„TestResult TestResult result = createTestResult(); // æ³¨å†Œä¸€ä¸ªTestListener result.addListener(fPrinter); long startTime = System.currentTimeMillis();// test.runæ–¹æ³• suite.run(result); long endTime = System.currentTimeMillis(); long runTime = endTime - startTime; fPrinter.print(result, runTime); pause(wait); return result; &#125; è¿è¡ŒTestçš„æ ¸å¿ƒæ–¹æ³• è¿”å›žTestResultè¿”å›žç»“æžœã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * Creates the TestResult to be used for the test run. */protected TestResult createTestResult() &#123; return new TestResult();&#125;public synchronized void addListener(TestListener listener) &#123; // protected List&lt;TestListener&gt; fListeners; fListeners.add(listener); &#125;// suite.run() fTestsä¸­çš„æ¯ä¸€ä¸ªtest public void run(TestResult result) &#123; for (Test each : fTests) &#123; if (result.shouldStop()) &#123; break; &#125; runTest(each, result); &#125; &#125;/** * Runs the test case and collects the results in TestResult. * è°ƒç”¨testResultçš„runæ–¹æ³• */public void run(TestResult result) &#123; result.run(this);&#125;// è¿è¡Œtestprotected void run(final TestCase test) &#123; startTest(test); Protectable p = new Protectable() &#123; public void protect() throws Throwable &#123; test.runBare();//æ‰§è¡ŒrunBareæ–¹æ³•æ‰§è¡Œtestç”¨ä¾‹ &#125; &#125;; runProtected(test, p); endTest(test); &#125;public void startTest(Test test) &#123; final int count = test.countTestCases(); synchronized (this) &#123; fRunTests += count; &#125; for (TestListener each : cloneListeners()) &#123; each.startTest(test); &#125; &#125; åœ¨resultPriterä¸­ä½¿ç”¨ç»§æ‰¿TestListenerä¸­çš„startTestæ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public void startTest(Test test) &#123; getWriter().print(".");//è¿è¡Œä¸€ä¸ªåˆ™åŠ ä¸€ä¸ªç‚¹ if (fColumn++ &gt;= 40) &#123; getWriter().println(); fColumn = 0; &#125; &#125;// è¿è¡Œä¸€ä¸ªç©ºçš„æµ‹è¯•åºåˆ—public void runBare() throws Throwable &#123; Throwable exception = null; // è®¾ç½®è£…ç½®ã€‚æ¯”å¦‚æ‰“å¼€ç½‘ç»œè¿žæŽ¥ç­‰ï¼Œåœ¨æ‰§è¡Œæµ‹è¯•ä¹‹å‰è°ƒç”¨æ–¹æ³•ã€‚ setUp(); try &#123; // çœ‹ä¸‹é¢çš„runTestæ–¹æ³• runTest();//æ‰§è¡Œtest &#125; catch (Throwable running) &#123; exception = running; &#125; finally &#123; try &#123; tearDown(); &#125; catch (Throwable tearingDown) &#123; if (exception == null) exception = tearingDown; &#125; &#125; if (exception != null) throw exception; &#125;protected void runTest() throws Throwable &#123; assertNotNull("TestCase.fName cannot be null", fName); // Some VMs crash when calling getMethod(null,null); Method runMethod = null; try &#123; runMethod = getClass().getMethod(fName, (Class[]) null); &#125; catch (NoSuchMethodException e) &#123; fail("Method \"" + fName + "\" not found"); &#125; // .......... runMethod.invoke(this); æ‰§è¡Œæ–¹æ³• try &#123; runMethod.invoke(this); &#125; catch (InvocationTargetException e) &#123; // å¦‚æžœæ–¹æ³•æ‰§è¡Œé”™è¯¯ï¼Œä¼šè§¦å‘è¿™ä¸ªå¼‚å¸¸ ä¼šè¿žç»­è¢«ä¸Šå±‚æ•æ‰åˆ° e.fillInStackTrace(); throw e.getTargetException(); &#125; catch (IllegalAccessException e) &#123; e.fillInStackTrace(); throw e; &#125; &#125; å¦‚æžœæµ‹è¯•å¤±è´¥ï¼Œåˆ™æœ€ç»ˆå°†è¢«runProtectedä¸­çš„try/catchæ•æ‰åˆ°åŽè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ 123456789101112public void runProtected(final Test test, Protectable p) &#123; try &#123; p.protect(); &#125; catch (AssertionFailedError e) &#123; // éªŒè¯å¤±è´¥ï¼Œæ·»åŠ ä¸€æ¡å¤±è´¥ä¿¡æ¯ addFailure(test, e); &#125; catch (ThreadDeath e) &#123; // don't catch ThreadDeath by accident throw e; &#125; catch (Throwable e) &#123; addError(test, e); &#125;&#125; ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤æ‰§è¡Œå®Œä¸€ä¸ªtestã€‚]]></content>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Junitçš„ä½¿ç”¨å’Œæºç åˆ†æž]]></title>
    <url>%2F2018%2F10%2F29%2F2018-10-28-Junit4%2F</url>
    <content type="text"><![CDATA[Junitçš„ä½¿ç”¨å’Œæºç åˆ†æžJunitæ˜¯ä¸€ä¸ªç¼–å†™å¯é‡å¤æµ‹è¯•çš„Javaæµ‹è¯•æ¡†æž¶ï¼Œä»£ç ç¼–å†™éžå¸¸æœ‰æŠ€å·§æ€§ï¼Œå€¼å¾—åå¤é˜…è¯»ã€‚ è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ Junitå®˜æ–¹æ–‡æ¡£å¾€å¾€æ˜¯å­¦ä¹ æœ€å¥½çš„èµ„æ–™ã€‚ ç®€å•æµ‹è¯•ä¾‹å­1234567891011121314151617181920212223public class FirstTest &#123; public int add(int a, int b) &#123; return a + b; &#125; @Test public void testAdd()&#123; FirstTest firstTest = new FirstTest(); int result = firstTest.add(1,2); // assertEquals(4,result); assertEquals(3,result); &#125; &lt;!-- - å¦‚æžœåˆ¤æ–­ä¸ç›¸ç­‰çš„æ—¶å€™ï¼ŒåŽå°æŠ¥é”™ä¿¡æ¯ - java.lang.AssertionError: - Expected :4 - Actual :3 - &lt;Click to see difference&gt; --&gt;&#125; è¿™åªæ˜¯ç®€å•çš„ä¾‹å­ï¼Œå®žé™…ä¸Šçš„å•å…ƒæµ‹è¯•è¦æ¯”è¿™ä¸ªå¤æ‚çš„å¤šï¼Œåœ¨å®žé™…åº”ç”¨ä¸Šå•å…ƒæµ‹è¯•ååˆ†æœ‰å¿…è¦ï¼Œç¼–å†™åŽå°ä»£ç æ—¶èƒ½å¤Ÿå°½å¿«æ£€éªŒä»£ç çš„æ­£ç¡®æ€§ã€‚ Assertions æ–­è¨€Junitæä¾›äº†æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»åž‹ï¼ŒObjectç±»å’Œæ•°ç»„çš„æ–­è¨€ï¼Œå‚æ•°æ˜¯ é¢„æœŸå€¼åŽé¢æ˜¯å®žé™…å€¼ï¼Œå¯é€‰é¡¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯æ–­è¨€å¤±è´¥æ—¶è¾“å‡ºçš„å†…å®¹ï¼Œä¸Žå…¶ä»–æ–­è¨€ç¨æœ‰ä¸åŒçš„æ˜¯ï¼ŒAssertThatçš„å‚æ•°æ˜¯ å¤±è´¥è¾“å‡ºçš„å†…å®¹ï¼Œå®žé™…å€¼å’Œä¸€ä¸ªMatcherObjectã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public class AssertTests &#123; @Test public void testAssertArrayEquals() &#123; byte[] expected = "trial".getBytes(); byte[] actual = "trial".getBytes(); assertArrayEquals("failure - byte arrays not same", expected, actual); &#125; @Test public void testAssertEquals() &#123; assertEquals("failure - strings are not equal", "text", "text"); &#125; @Test public void testAssertFalse() &#123; assertFalse("failure - should be false", false); &#125; @Test public void testAssertNotNull() &#123; assertNotNull("should not be null", new Object()); &#125; @Test public void testAssertNotSame() &#123; assertNotSame("should not be same Object", new Object(), new Object()); &#125; @Test public void testAssertNull() &#123; assertNull("should be null", null); &#125; @Test public void testAssertSame() &#123; Integer aNumber = Integer.valueOf(768); assertSame("should be same", aNumber, aNumber); &#125; // JUnit Matchers assertThat @Test public void testAssertThatBothContainsString() &#123; assertThat("albumen", both(containsString("a")).and(containsString("b"))); &#125; @Test public void testAssertThatHasItems() &#123; assertThat(Arrays.asList("one", "two", "three"), hasItems("one", "three")); &#125; @Test public void testAssertThatEveryItemContainsString() &#123; assertThat(Arrays.asList(new String[] &#123; "fun", "ban", "net" &#125;), everyItem(containsString("n"))); &#125; // Core Hamcrest Matchers with assertThat @Test public void testAssertThatHamcrestCoreMatchers() &#123; assertThat("good", allOf(equalTo("good"), startsWith("good"))); assertThat("good", not(allOf(equalTo("bad"), equalTo("good")))); assertThat("good", anyOf(equalTo("bad"), equalTo("good"))); assertThat(7, not(CombinableMatcher.&lt;Integer&gt; either(equalTo(3)).or(equalTo(4)))); assertThat(new Object(), not(sameInstance(new Object()))); &#125; @Test public void testAssertTrue() &#123; assertTrue("failure - should be true", true); &#125;&#125; å¼‚å¸¸æµ‹è¯•ä¸‹é¢åˆ†ä¸ºä¸¤ç§æ–¹å¼æ¥å®Œæˆå¯¹å¼‚å¸¸çš„æµ‹è¯• æœŸå¾…çš„å¼‚å¸¸å¦‚ä½•æ£€æµ‹ç¨‹åºæ˜¯å¦å¦‚æœŸçš„æŠ›å‡ºå¼‚å¸¸ï¼Œjunitå¯ä»¥ä½¿ç”¨æ³¨è§£çš„å‚æ•°æ¥å®žçŽ°ã€‚ 1234@Test(expected = IndexOutOfBoundsException.class)public void testException()&#123; new ArrayList&lt;Integer&gt;().get(0);&#125; æ·±å…¥çš„å¼‚å¸¸ä¸Šè¿°æ–¹æ³•å¯¹äºŽç®€å•çš„æƒ…å†µå¾ˆæœ‰ç”¨ï¼Œä½†å®ƒæœ‰å…¶å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œæ‚¨æ— æ³•åœ¨å¼‚å¸¸ä¸­æµ‹è¯•æ¶ˆæ¯çš„å€¼ï¼Œä¹Ÿæ— æ³•åœ¨æŠ›å‡ºå¼‚å¸¸åŽæµ‹è¯•åŸŸå¯¹è±¡çš„çŠ¶æ€ try/catch è¯­å¥ 123456789@Testpublic void testTryCatch()&#123; try &#123; new ArrayList&lt;Integer&gt;().get(0); fail("å¤±è´¥ä¿¡æ¯"); &#125;catch (IndexOutOfBoundsException indexOutOfBoundsExecption)&#123; assertThat(indexOutOfBoundsExecption.getMessage(), is("Index: 0, Size: 0")); &#125;&#125; rule è§„åˆ™ 12345678910@Rulepublic ExpectedException thrown = ExpectedException.none();@Testpublic void testExpectException()&#123; List&lt;Object&gt; list = new ArrayList&lt;Object&gt;(); thrown.expect(IndexOutOfBoundsException.class); thrown.expectMessage("Index: 0, Size: 0"); list.get(0); // execution will never get past this line&#125; Matchers and assertThat [ åŒ¹é…å™¨å’ŒassertThat ]æ–°åŠ å…¥äº†assertThatæ–­è¨€æœºåˆ¶ assertThat([value], [matcher statement]); 1234assertThat(x, is(3));assertThat(x, is(not(4)));assertThat(responseString, either(containsString("color")).or(containsString("colour")));assertThat(myList, hasItem("3")); assertThat æ›´å…·æœ‰å¯è¯»æ€§å’Œå¯è¾“å…¥æ€§ï¼Œå¹¶ä¸”æœ‰ç»„åˆæ€§ï¼Œå°±åƒ is(not(4)) ä»»ä½•Macherséƒ½å¯ä»¥ç»„åˆèµ·æ¥ä½¿ç”¨ ä»¥å‰çš„assertEqualsç­‰ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ï¼ŒassertThat åœ¨ä½¿ç”¨Matchersçš„æ—¶å€™éœ€è¦ä½¿ç”¨ import static org.hamcrest.CoreMatchers.*;æ¥å¼•ç”¨ã€‚é‡Œé¢çš„æ–¹æ³•éžå¸¸å¤šã€‚ã€‚ junitæºç è·Ÿè¯»ä½¿ç”¨junitæµç¨‹ä½¿ç”¨ç»§æ‰¿è‡ªTestCaseç±»ä¸‹é¢é€šè¿‡è¿è¡Œjunitçš„è‡ªå¸¦çš„testï¼Œæºç¨‹åºä¸ºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566/** * Some simple tests. */public class SimpleTest extends TestCase &#123; protected int fValue1; protected int fValue2; @Override protected void setUp() &#123; fValue1 = 2; fValue2 = 3; &#125; public static Test suite() &#123; /* * the type safe way * TestSuite suite= new TestSuite(); suite.addTest( new SimpleTest("add") &#123; protected void runTest() &#123; testAdd(); &#125; &#125; ); suite.addTest( new SimpleTest("testDivideByZero") &#123; protected void runTest() &#123; testDivideByZero(); &#125; &#125; ); return suite; */ /* * the dynamic way */ return new TestSuite(SimpleTest.class); &#125; public void testAdd() &#123; double result = fValue1 + fValue2; // forced failure result == 5 assertTrue(result == 6); &#125; public int unused; public void testDivideByZero() &#123; int zero = 0; int result = 8 / zero; unused = result; // avoid warning for not using result &#125; public void testEquals() &#123; assertEquals(12, 12); assertEquals(12L, 12L); assertEquals(new Long(12), new Long(12)); assertEquals("Size", 12, 13); assertEquals("Capacity", 12.0, 11.99, 0.0); &#125; public static void main(String[] args) &#123; junit.textui.TestRunner.run(suite()); &#125;&#125; æ¥çœ‹mainæ–¹æ³•ï¼Œä½¿ç”¨ junit.textui.TestRunner.run(suite()); ä½¿ç”¨TestRunnerè¿è¡Œtestã€‚é¦–å…ˆå…ˆæ¥çœ‹suiteæ–¹æ³•ï¼Œæœ‰ä¸¤ç§æ–¹æ³• é™æ€çš„,éœ€è¦æ‰‹åŠ¨åœ¨testSuiteä¸­æ·»åŠ testã€‚ åŠ¨æ€çš„ï¼Œé™æ€éœ€è¦å®žçŽ°TestCaseçš„runTestæ–¹æ³•ã€‚è€ŒåŠ¨æ€çš„åªéœ€è¦è¿”å›ž TestSuite(SimpleTest.class);ï¼Œä¸‹é¢æ¥çœ‹è¿™ä¸ªTestSuiteç±» testSuiteå®žé™…ä¸Šå°±æ˜¯è¿è¡Œtestçš„é›†åˆï¼Œä½¿ç”¨vectoræ¥å­˜å‚¨test,å…¶ä¸­è¿™é‡Œä½¿ç”¨åˆ°çš„TestSuiteæž„é€ æ–¹æ³•æ˜¯ï¼š 123456789101112131415161718192021222324252627282930313233public TestSuite(final Class&lt;?&gt; theClass) &#123; addTestsFromTestCase(theClass); &#125;private void addTestsFromTestCase(final Class&lt;?&gt; theClass) &#123; fName = theClass.getName(); try &#123; getTestConstructor(theClass); // Avoid generating multiple error messages &#125; catch (NoSuchMethodException e) &#123; addTest(warning("Class " + theClass.getName() + " has no public constructor TestCase(String name) or TestCase()")); return; &#125;// è¿™ä¸ªç±»æ˜¯å¦æ˜¯publicçš„ å¦‚æžœä¸æ˜¯ å‘å‡ºwarning ï¼Œå¹¶ä¸”fail(message) if (!Modifier.isPublic(theClass.getModifiers())) &#123; addTest(warning("Class " + theClass.getName() + " is not public")); return; &#125; Class&lt;?&gt; superClass = theClass; List&lt;String&gt; names = new ArrayList&lt;String&gt;();// è¿™å¥è¯è¯´æ˜Žçš„æ˜¯å¦‚æžœè¿™ä¸ªç±»æ˜¯superClassçš„è¶…ç±»ï¼Œæˆ–è€…æŽ¥å£å°±è¿”å›žtrueï¼Œå¦åˆ™è¿”å›žfalse while (Test.class.isAssignableFrom(superClass)) &#123;// å¦‚æžœæ˜¯true æœ‰é¡ºåºçš„è¿”å›žå£°æ˜Žçš„æ–¹æ³• for (Method each : MethodSorter.getDeclaredMethods(superClass)) &#123; addTestMethod(each, names, theClass); &#125;// èŽ·å¾—superclassç±»ï¼Œé€’å½’çš„æŸ¥æ‰¾testæ–¹æ³• superClass = superClass.getSuperclass(); &#125; if (fTests.size() == 0) &#123; addTest(warning("No tests found in " + theClass.getName())); &#125; &#125; æœ€åŽæåˆ°çš„ fTests.size() == 0 è¿™é‡Œä¼šå‘ç”Ÿwarning ç„¶åŽfailã€‚è¿™ä¸ªfTests å·²ç»å†å‰é¢å£°æ˜Žäº†ï¼Œå£°æ˜Žæ–¹æ³•æ˜¯ï¼šprivate Vector&lt;Test&gt; fTests = new Vector&lt;Test&gt;(10); åœ¨å¯¹æ¯ä¸ªå£°æ˜Žçš„æ–¹æ³•å¾ªçŽ¯çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ° addTestMethod æ–¹æ³•ï¼Œæ¥å¯¹æ¯ä¸ªæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ 1234567891011121314151617181920private void addTestMethod(Method m, List&lt;String&gt; names, Class&lt;?&gt; theClass) &#123;// èŽ·å¾—æ–¹æ³•åå¦‚æžœlistæ•°ç»„ä¸­å·²ç»åŒ…å«è¿™ä¸ªæ–¹æ³•åï¼Œå°±ç›´æŽ¥é€€å‡º String name = m.getName(); if (names.contains(name)) &#123; return; &#125; if (!isPublicTestMethod(m)) &#123; if (isTestMethod(m)) &#123; addTest(warning("Test method isn't public: " + m.getName() + "(" + theClass.getCanonicalName() + ")")); &#125; return; &#125;// æŠŠè¿™ä¸ªæ–¹æ³•ååŠ å…¥åˆ°names Listä¸­ names.add(name); addTest(createTest(theClass, name)); &#125;//å†æ¥çœ‹å¤–å±‚çš„addTestæ–¹æ³• æŠŠæ‹¥æœ‰çš„testæ–¹æ³•æ”¾åˆ°fTestsä¸­ã€‚public void addTest(Test test) &#123; fTests.add(test); &#125; ä½¿ç”¨createTestæ¥é’ˆå¯¹testæ–¹æ³•åˆ›å»ºä¸€ä¸ªTestç±» 123456789101112131415161718192021222324252627static public Test createTest(Class&lt;?&gt; theClass, String name) &#123; Constructor&lt;?&gt; constructor; try &#123; constructor = getTestConstructor(theClass); &#125; catch (NoSuchMethodException e) &#123; return warning("Class " + theClass.getName() + " has no public constructor TestCase(String name) or TestCase()"); &#125; Object test; // é€šè¿‡åå°„æ–¹å¼èŽ·å¾—æ–¹æ³•çš„testå®žä¾‹ try &#123; if (constructor.getParameterTypes().length == 0) &#123; test = constructor.newInstance(new Object[0]); if (test instanceof TestCase) &#123; ((TestCase) test).setName(name);//å¦‚æžœç»§æ‰¿TestCase &#125; &#125; else &#123; test = constructor.newInstance(new Object[]&#123;name&#125;); &#125; &#125; catch (InstantiationException e) &#123; return (warning("Cannot instantiate test case: " + name + " (" + Throwables.getStacktrace(e) + ")")); &#125; catch (InvocationTargetException e) &#123; return (warning("Exception in constructor: " + name + " (" + Throwables.getStacktrace(e.getTargetException()) + ")")); &#125; catch (IllegalAccessException e) &#123; return (warning("Cannot access test case: " + name + " (" + Throwables.getStacktrace(e) + ")")); &#125; return (Test) test; &#125; ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤èŽ·å¾—äº†è¿™ä¸ªç±»ä¸­åŠå…¶çˆ¶ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•çš„Testã€‚ ä½¿ç”¨testRunner.runè¿è¡Œtest 1234567891011121314151617181920212223242526public static void main(String[] args) &#123; junit.textui.TestRunner.run(suite()); &#125;// ä½¿ç”¨TestRunnerçš„runçš„é™æ€æ–¹æ³• è¿”å›žä¸€ä¸ªTestResultç”¨æ¥è¿”å›žç»“æžœã€‚ static public TestResult run(Test test) &#123; TestRunner runner = new TestRunner(); return runner.doRun(test); &#125;// è°ƒç”¨runnerçš„doRunæ–¹æ³•public TestResult doRun(Test test) &#123; return doRun(test, false); &#125;public TestResult doRun(Test suite, boolean wait) &#123;// ç”¨æ¥è¿”å›žç»“æžœçš„TestResult TestResult result = createTestResult(); // æ³¨å†Œä¸€ä¸ªTestListener result.addListener(fPrinter); long startTime = System.currentTimeMillis();// test.runæ–¹æ³• suite.run(result); long endTime = System.currentTimeMillis(); long runTime = endTime - startTime; fPrinter.print(result, runTime); pause(wait); return result; &#125; è¿è¡ŒTestçš„æ ¸å¿ƒæ–¹æ³• è¿”å›žTestResultè¿”å›žç»“æžœã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * Creates the TestResult to be used for the test run. */protected TestResult createTestResult() &#123; return new TestResult();&#125;public synchronized void addListener(TestListener listener) &#123; // protected List&lt;TestListener&gt; fListeners; fListeners.add(listener); &#125;// suite.run() fTestsä¸­çš„æ¯ä¸€ä¸ªtest public void run(TestResult result) &#123; for (Test each : fTests) &#123; if (result.shouldStop()) &#123; break; &#125; runTest(each, result); &#125; &#125;/** * Runs the test case and collects the results in TestResult. * è°ƒç”¨testResultçš„runæ–¹æ³• */public void run(TestResult result) &#123; result.run(this);&#125;// è¿è¡Œtestprotected void run(final TestCase test) &#123; startTest(test); Protectable p = new Protectable() &#123; public void protect() throws Throwable &#123; test.runBare();//æ‰§è¡ŒrunBareæ–¹æ³•æ‰§è¡Œtestç”¨ä¾‹ &#125; &#125;; runProtected(test, p); endTest(test); &#125;public void startTest(Test test) &#123; final int count = test.countTestCases(); synchronized (this) &#123; fRunTests += count; &#125; for (TestListener each : cloneListeners()) &#123; each.startTest(test); &#125; &#125; åœ¨resultPriterä¸­ä½¿ç”¨ç»§æ‰¿TestListenerä¸­çš„startTestæ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public void startTest(Test test) &#123; getWriter().print(".");//è¿è¡Œä¸€ä¸ªåˆ™åŠ ä¸€ä¸ªç‚¹ if (fColumn++ &gt;= 40) &#123; getWriter().println(); fColumn = 0; &#125; &#125;// è¿è¡Œä¸€ä¸ªç©ºçš„æµ‹è¯•åºåˆ—public void runBare() throws Throwable &#123; Throwable exception = null; // è®¾ç½®è£…ç½®ã€‚æ¯”å¦‚æ‰“å¼€ç½‘ç»œè¿žæŽ¥ç­‰ï¼Œåœ¨æ‰§è¡Œæµ‹è¯•ä¹‹å‰è°ƒç”¨æ–¹æ³•ã€‚ setUp(); try &#123; // çœ‹ä¸‹é¢çš„runTestæ–¹æ³• runTest();//æ‰§è¡Œtest &#125; catch (Throwable running) &#123; exception = running; &#125; finally &#123; try &#123; tearDown(); &#125; catch (Throwable tearingDown) &#123; if (exception == null) exception = tearingDown; &#125; &#125; if (exception != null) throw exception; &#125;protected void runTest() throws Throwable &#123; assertNotNull("TestCase.fName cannot be null", fName); // Some VMs crash when calling getMethod(null,null); Method runMethod = null; try &#123; runMethod = getClass().getMethod(fName, (Class[]) null); &#125; catch (NoSuchMethodException e) &#123; fail("Method \"" + fName + "\" not found"); &#125; // .......... runMethod.invoke(this); æ‰§è¡Œæ–¹æ³• try &#123; runMethod.invoke(this); &#125; catch (InvocationTargetException e) &#123; // å¦‚æžœæ–¹æ³•æ‰§è¡Œé”™è¯¯ï¼Œä¼šè§¦å‘è¿™ä¸ªå¼‚å¸¸ ä¼šè¿žç»­è¢«ä¸Šå±‚æ•æ‰åˆ° e.fillInStackTrace(); throw e.getTargetException(); &#125; catch (IllegalAccessException e) &#123; e.fillInStackTrace(); throw e; &#125; &#125; å¦‚æžœæµ‹è¯•å¤±è´¥ï¼Œåˆ™æœ€ç»ˆå°†è¢«runProtectedä¸­çš„try/catchæ•æ‰åˆ°åŽè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ 123456789101112public void runProtected(final Test test, Protectable p) &#123; try &#123; p.protect(); &#125; catch (AssertionFailedError e) &#123; // éªŒè¯å¤±è´¥ï¼Œæ·»åŠ ä¸€æ¡å¤±è´¥ä¿¡æ¯ addFailure(test, e); &#125; catch (ThreadDeath e) &#123; // don't catch ThreadDeath by accident throw e; &#125; catch (Throwable e) &#123; addError(test, e); &#125;&#125; ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤æ‰§è¡Œå®Œä¸€ä¸ªtestã€‚]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaä¸­Dequeå’ŒArrayDeque]]></title>
    <url>%2F2018%2F10%2F26%2F2018-10-24-Java%E4%B8%ADDeque%E5%8F%8A%E5%85%B6%E5%AD%90%E7%B1%BB%2F</url>
    <content type="text"><![CDATA[Javaä¸­Dequeå’ŒArrayDequeDequeç±»ä¸€ä¸ªçº¿æ€§çš„å¯åœ¨åŒç«¯æ’å…¥ã€åˆ é™¤èŠ‚ç‚¹çš„ç»“æž„ã€‚ä»–åå­—æ—¶Dequeï¼Œå®žé™…ä¸Šæ—¶â€œdouble ended queueâ€çš„ç®€å†™ï¼› ArrayDequeç±»å¯¹äºŽArrayDequeä¸­çš„æ•°ç»„ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„å¾ªçŽ¯æ•°ç»„ï¼Œæ‰€è°“å¾ªçŽ¯æ˜¯æŒ‡å…ƒç´ åˆ°æ•°ç»„å°¾ä¹‹åŽå¯ä»¥æŽ¥ç€ä»Žæ•°ç»„å¤´å¼€å§‹ï¼Œæ•°ç»„çš„é•¿åº¦ã€ç¬¬ä¸€ä¸ªå’Œæœ€åŽä¸€ä¸ªå…ƒç´ éƒ½ä¸Žheadå’Œtailè¿™ä¸¤ä¸ªå˜é‡æœ‰å…³ æž„é€ æ–¹æ³•ArrayDequeå°±åƒä»–çš„åå­—ä¸€æ ·ï¼Œä½¿ç”¨Arrayæ•°ç»„æ¥å®žçŽ°Dequeç»“æž„ã€‚æž„é€ æ–¹æ³•å’Œä»¥å‰æåˆ°çš„ArrayListç›¸ä¼¼ã€‚ 1234567891011121314public ArrayDeque() &#123;// åˆå§‹åŒ–çš„æ•°ç»„å¤§å°æ˜¯16 elements = new Object[16]; &#125;public ArrayDeque(int numElements) &#123; allocateElements(numElements); &#125;public ArrayDeque(Collection&lt;? extends E&gt; c) &#123; allocateElements(c.size()); // addAllæ–¹æ³•å°±æ˜¯ä¸ºc è¿›è¡Œforå¾ªçŽ¯æ·»åŠ  addAll(c); &#125; æ·»åŠ å’Œç§»é™¤æ–¹æ³• addæ–¹æ³• 1234567891011121314151617181920212223// åœ¨å‰é¢æ·»åŠ å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ä¸ŠåŠ å…ƒç´ public void addFirst(E e) &#123; if (e == null) throw new NullPointerException(); // åœ¨å‰é¢æ·»åŠ çš„æ—¶å€™ï¼Œhead-1 çš„ä½ç½®ä¸Šæ’å…¥ e elements[head = (head - 1) &amp; (elements.length - 1)] = e; if (head == tail) doubleCapacity(); &#125;public void addLast(E e) &#123; if (e == null) throw new NullPointerException(); æ·»åŠ åˆ°ä¸‹ä¸€ä¸ªä½ç½® elements[tail] = e; /* * å¦‚æžœå½“å‰æ·»åŠ ä½ç½®çš„ä¸‹ä¸€ä¸ªä½ç½® ä¸Žä¸Š é•¿åº¦-1 *ï¼ˆå› ä¸ºé•¿åº¦éƒ½æ˜¯2çš„å€æ•°ï¼Œæ‰€ä»¥-1ä¹‹åŽï¼Œ2è¿›åˆ¶åŽå‡ ä½éƒ½æ˜¯1ï¼Œä¿è¯è´Ÿæ•°çš„æ—¶å€™ä¹Ÿèƒ½å¤Ÿæ‰¾åˆ°æ­£ç¡®çš„ç´¢å¼•ï¼‰ * å¦‚æžœtailå’Œheadç›¸ç­‰è¯´æ˜Žæ•°ç»„æ»¡äº†ï¼Œéœ€è¦æ‰©å®¹ */ if ( (tail = (tail + 1) &amp; (elements.length - 1)) == head) doubleCapacity(); &#125; æœ‰äº†è¿™ä¸¤ç§æ–¹æ³•ï¼Œé˜Ÿåˆ—æˆ–è€…æ ˆçš„æ–¹æ³•éƒ½å¯ä»¥è½»æ¾å®žçŽ°äº†ã€‚ åœ¨è¿›è¡Œå¢žåŠ å…ƒç´ çš„æ—¶å€™æ¶‰åŠåˆ° doubleCapacity è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥æ‰©å……æ•°ç»„çš„å®¹é‡ã€‚ 123456789101112131415private void doubleCapacity() &#123; assert head == tail; int p = head; int n = elements.length; int r = n - p; // headå³è¾¹å…ƒç´ çš„ä¸ªæ•° int newCapacity = n &lt;&lt; 1; // æ‰©å……ä¸ºåŽŸæ¥çš„2å€ if (newCapacity &lt; 0) throw new IllegalStateException("Sorry, deque too big"); Object[] a = new Object[newCapacity]; //åˆ›å»ºæ–°æ•°ç»„ Systkkem.arraycopy(elements, p, a, 0, r); System.arraycopy(elements, 0, a, r, p);// ä¸¤éƒ¨copyæ•°ç»„ç›¸å½“äºŽä»Ž head -&gt; tail é‡æ–°æŽ’åºäº† elements = a; head = 0; tail = n; &#125; removeæ–¹æ³• 1234567891011121314151617181920212223public E remove() &#123; return removeFirst(); &#125;public E removeFirst() &#123; E x = pollFirst(); if (x == null) throw new NoSuchElementException(); return x; &#125;public E pollFirst() &#123; int h = head; @SuppressWarnings("unchecked") E result = (E) elements[h]; // Element is null if deque empty if (result == null) return null; elements[h] = null; // Must null out slot // æŠŠelementçš„å¤´éƒ¨ä½ç½®ç½®ç©ºåŽï¼Œå°†headå‘å‰ç§» head = (h + 1) &amp; (elements.length - 1); return result; &#125; toArrayæ–¹æ³• toArrayæ–¹æ³•ä¸»è¦æ˜¯æ–¹ä¾¿è¾“å‡ºã€‚ç”¨æ¥çœŸæ­£çš„æŒ‰ç…§é€»è¾‘é¡ºåºï¼Œè¿›è¡Œç‰©ç†é‡æŽ’ï¼Œå®žçŽ°æ–¹æ³•å’ŒdoubleCapacityå®žçŽ°ç›¸åŒã€‚ 12345678910111213141516public Object[] toArray() &#123; return copyElements(new Object[size()]); &#125;private &lt;T&gt; T[] copyElements(T[] a) &#123; if (head &lt; tail) &#123; // å¦‚æžœé¡ºåºæ­£å¸¸ System.arraycopy(elements, head, a, 0, size()); &#125; else if (head &gt; tail) &#123; // å¦åˆ™å°†headå³ä¾§çš„å…ˆcopyåˆ°æ•°ç»„ä¸­ï¼Œåœ¨copyå‰©ä¸‹çš„ int headPortionLen = elements.length - head; System.arraycopy(elements, head, a, 0, headPortionLen); System.arraycopy(elements, 0, a, headPortionLen, tail); &#125; return a; &#125; sizeæ–¹æ³• å’Œå¾ˆå¤šæ•°æ®ç»“æž„ç±»ä¸åŒçš„æ˜¯ï¼Œä»–çš„sizeå¹¶ä¸æ˜¯ä¾é æœ¬èº«çš„å˜é‡å­—æ®µè¿›è¡Œç»´æŠ¤ï¼Œè€Œæ˜¯é€šè¿‡sizeæ–¹æ³•è®¡ç®—è€Œæ¥ã€‚ 123public int size() &#123; return (tail - head) &amp; (elements.length - 1); &#125; æ€»ç»“ä¸€ä¸‹ï¼ŒArrayDequeå®žçŽ°äº†åŒç«¯é˜Ÿåˆ—çš„ç‰¹ç‚¹ï¼Œèƒ½å¤Ÿå®Œæˆæ ˆå’Œé˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œæ•ˆçŽ‡æ¯”åŒæ ·ç»§æ‰¿Dequeçš„LinkedListæ•ˆçŽ‡é«˜ï¼Œå› ä¸ºåœ¨ArrayDequeä¸­çš„è®¡ç®—å¤§éƒ¨åˆ†ä¸ºä½è¿ç®—ã€‚ArrayDequeé€»è¾‘ä¸Šå¾ªçŽ¯çš„æ•°ç»„ï¼Œä½†å®žé™…ä¸Šå¹¶ä¸æ˜¯ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaä¸­çš„æ ˆå’Œé˜Ÿåˆ—]]></title>
    <url>%2F2018%2F10%2F18%2F2018-10-17-Java%E4%B8%AD%E7%9A%84%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97%2F</url>
    <content type="text"><![CDATA[javaä¸­çš„æ ˆå’Œé˜Ÿåˆ— Stack æ ˆ pushæ–¹æ³•å’Œpopæ–¹æ³• peekæ–¹æ³• Queue é˜Ÿåˆ— offer æ–¹æ³•å’Œ pullæ–¹æ³• addæ–¹æ³•å’Œremoveæ–¹æ³• javaä¸­çš„æ ˆå’Œé˜Ÿåˆ—Stack æ ˆæ ˆæ˜¯ä¸€ä¸ªåŽè¿›å…ˆå‡ºçš„æ•°æ®ç»“æž„ï¼Œæœ‰è¿™æ ·çš„æ•°æ®ç»“æž„åŠŸèƒ½çš„è¿˜æœ‰Dequç±»ï¼ŒæŽ¨èä½¿ç”¨Dequ pushæ–¹æ³•å’Œpopæ–¹æ³•pushæ–¹æ³•æ˜¯å‘æ ˆé¡¶æ”¾å€¼ 123456789101112public E push(E item) &#123;// è¿™é‡Œè°ƒç”¨çˆ¶ç±»Vectorçš„addElementæ–¹æ³• addElement(item); return item; &#125;// addElementæ–¹æ³•æ˜¯åŠ é”çš„æ–¹æ³• è°ƒç”¨elementå®žé™…ä¸Šå°±æ˜¯æ•°ç»„é•¿åº¦åŠ ä¸€å¹¶ä¸”åœ¨è¯¥é—®ä¹‹ä¸Šä»˜å€¼public synchronized void addElement(E obj) &#123; modCount++; ensureCapacityHelper(elementCount + 1); elementData[elementCount++] = obj; &#125; popæ–¹æ³•æ˜¯åœ¨å°†æ ˆé¡¶çš„å€¼å‡ºæ ˆ 12345678910// åŒæ ·åŠ é”çš„æ–¹æ³• è°ƒç”¨æ–¹æ³• ç§»é™¤åœ¨æ•°ç»„æœ€åŽä½ç½®çš„å…ƒç´ public synchronized E pop() &#123; E obj; int len = size(); obj = peek(); removeElementAt(len - 1); return obj; &#125; peekæ–¹æ³•peekæ–¹æ³•æ˜¯çœ‹ä¸€ä¸‹æ ˆé¡¶å…ƒç´ çš„å€¼ï¼Œä½†ä¸åšä»»ä½•æ“ä½œ 1234567public synchronized E peek() &#123; int len = size(); if (len == 0) throw new EmptyStackException(); return elementAt(len - 1); &#125; è¿™å‡ ä¸ªæ–¹æ³•å’ŒlinkedListç±»ä¸­çš„å¯¹åº”çš„æ–¹æ³•éžå¸¸åƒï¼Œæ‰€ä»¥å…¶å®žLindedListä¹Ÿå¯ä»¥å½“ä½œæ ˆç”¨ã€‚ Queue é˜Ÿåˆ—é˜Ÿåˆ—å’Œæ ˆç›¸åï¼Œæ˜¯ä¸€ä¸ªå…ˆè¿›åŽå‡ºçš„æ•°æ®ç»“æž„ï¼Œæƒ³æˆçŽ°å®žä¸­çš„æŽ’é˜Ÿå†æ˜Žç™½ä¸è¿‡äº†ã€‚ offer æ–¹æ³•å’Œ pullæ–¹æ³•offeræ–¹æ³•å¯ä»¥å°†å…ƒç´ æ”¾å…¥é˜Ÿåˆ—å½“ä¸­ï¼Œpullå¯ä»¥å°†å…ƒç´ ä»Žå¤´éƒ¨ç§»é™¤ã€‚ addæ–¹æ³•å’Œremoveæ–¹æ³•addå’Œremoveæ–¹æ³•åˆ†åˆ«è°ƒç”¨offerå’Œpullæ–¹æ³•ï¼Œä¸åŒçš„æ˜¯ï¼Œå¦‚æžœé˜Ÿåˆ—æ»¡äº†ï¼Œaddæ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œofferæ–¹æ³•ä¼šè¿”å›žnullã€‚å¦‚æžœé˜Ÿåˆ—ç©ºäº†ï¼Œremoveæ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œpullæ–¹æ³•ä¼šè¿”å›žnullã€‚ ä»¥åŽä¼šæåŠé˜Ÿåˆ—çš„å®žçŽ°ç±»ä»¥åŠDequç›¸å…³ç±»ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashSetå’ŒHashTableçš„çš„æºç åˆ†æž]]></title>
    <url>%2F2018%2F10%2F16%2F2018-10-15-HashSet%E5%92%8CHashTable%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[HashSetå’ŒHashTableçš„çš„æºç åˆ†æž HashSet HashSetç»“æž„æºç  HashSetçš„åŸºæœ¬æ–¹æ³• HashSetçš„Iteratorå’Œcontainsæ–¹æ³• HashTable HashSetå’ŒHashTableçš„çš„æºç åˆ†æžHashSetHashSetå…¶å®žå°±æ˜¯ä½¿ç”¨HashMapæ¥å®žçŽ°çš„ï¼Œæ–¹æ³•éƒ½æ˜¯ä¾é Hash Mapçš„æ–¹æ³•ã€‚å¦‚hashSetæž„é€ ï¼ŒhashSetçš„æ·»åŠ ç­‰æ“ä½œã€‚è¿™æ ·èƒ½å¤Ÿå®žçŽ°hashsetåŽ»é‡ã€‚å› ä¸ºhashMapçš„keyä¸èƒ½é‡å¤ã€‚è¿™æ ·å°±èƒ½çœ‹ä¸Šç¯‡ï¼Œå½“hashMapé‡åˆ°keyå€¼é‡å¤çš„å¤„ç†ã€‚ HashSetç»“æž„æºç HashSetçš„ç»“æž„å°±ç›¸å½“äºŽHashMapåªå°†keyå€¼putè¿›åŽ»ï¼Œä½†æ˜¯Valueå€¼å´ä¸ºç©ºçš„new Objectã€‚å¯ä»¥çœ‹ä½œä¸ºåªæœ‰keyçš„HashMap. 12345678910111213141516171819202122/* å¯ä»¥çœ‹åˆ°hashSetçš„è¿™å‡ ä¸ªæž„é€ æ–¹æ³•å’ŒHashMapæ¯æ¯ç›¸å…³ */private transient HashMap&lt;E,Object&gt; map;public HashSet() &#123; map = new HashMap&lt;&gt;();&#125;public HashSet(Collection&lt;? extends E&gt; c) &#123; map = new HashMap&lt;&gt;(Math.max((int) (c.size()/.75f) + 1, 16)); addAll(c);&#125;public HashSet(int initialCapacity, float loadFactor) &#123; map = new HashMap&lt;&gt;(initialCapacity, loadFactor);&#125;public HashSet(int initialCapacity) &#123; map = new HashMap&lt;&gt;(initialCapacity);&#125;HashSet(int initialCapacity, float loadFactor, boolean dummy) &#123; map = new LinkedHashMap&lt;&gt;(initialCapacity, loadFactor);&#125; HashSetçš„åŸºæœ¬æ–¹æ³•addå’Œremoveå’Œsizeç­‰åŸºæœ¬æ–¹æ³•éƒ½æ˜¯è°ƒç”¨HashMapçš„ å¦‚addæ–¹æ³•: 1234public boolean add(E e) &#123; /* è¿™é‡Œçš„PRESENTç­‰äºŽnew Object() */ return map.put(e, PRESENT)==null; &#125; HashSetçš„Iteratorå’Œcontainsæ–¹æ³•åŒæ ·çš„ä¹Ÿæ˜¯è°ƒç”¨çš„HashMapçš„åŸºæœ¬æ–¹æ³•ï¼Œä½†æ˜¯éœ€è¦å…ˆå¾—åˆ°Mapçš„keySeté›†åˆ 1234567public Iterator&lt;E&gt; iterator() &#123; return map.keySet().iterator();&#125;public boolean contains(Object o) &#123; return map.containsKey(o);&#125; HashTableé¦–å…ˆHashTableå’ŒHashMapçš„ç»“æž„ç±»ä¼¼ã€‚ä½†æ˜¯æœ‰æœ€é‡è¦çš„åŒºåˆ«å°±æ˜¯HashTableæ˜¯synchronizedçš„ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨ä»–çš„åŸºæœ¬æ–¹æ³•å‰éƒ½æœ‰synchronizedé”æ‰€é™åˆ¶ã€‚ ç»“æž„å°±ä¸çœ‹äº†ï¼Œåªçœ‹ä¸€ä¸ªPutæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647/* å…¶å®žå¤§è‡´å’ŒHashMapæ˜¯ç±»ä¼¼çš„ä¹Ÿæ˜¯ä½¿ç”¨Entryä½œä¸ºåŸºæœ¬ç»“æž„ */public synchronized V put(K key, V value) &#123; // Make sure the value is not null if (value == null) &#123; throw new NullPointerException(); &#125; // Makes sure the key is not already in the hashtable. Entry&lt;?,?&gt; tab[] = table; int hash = key.hashCode(); /* è¿™é‡Œçš„0x7FFFFFFF æ˜¯32-bitçš„intçš„æœ€å¤§å€¼ */ int index = (hash &amp; 0x7FFFFFFF) % tab.length; @SuppressWarnings("unchecked") Entry&lt;K,V&gt; entry = (Entry&lt;K,V&gt;)tab[index]; /* å¦‚æžœè¿™ä¸ªentryå­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯é”®å€¼é‡å¤ */ for(; entry != null ; entry = entry.next) &#123; if ((entry.hash == hash) &amp;&amp; entry.key.equals(key)) &#123; V old = entry.value; entry.value = value; return old; &#125; &#125; /* å¦åˆ™æ·»åŠ EntryèŠ‚ç‚¹ */ addEntry(hash, key, value, index); return null; &#125; private void addEntry(int hash, K key, V value, int index) &#123; modCount++; Entry&lt;?,?&gt; tab[] = table; if (count &gt;= threshold) &#123; /* å¦‚æžœå½“å‰countå¤§äºŽé˜ˆå€¼çš„å¤§å° é‡æ–°ç”Ÿæˆtable sizeå’Œhashå€¼ */ // Rehash the table if the threshold is exceeded rehash(); tab = table; hash = key.hashCode(); index = (hash &amp; 0x7FFFFFFF) % tab.length; &#125; // Creates the new entry. @SuppressWarnings("unchecked") Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;) tab[index]; tab[index] = new Entry&lt;&gt;(hash, key, value, e); count++;&#125; é€šè¿‡ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºHashTableå’ŒHashMapçš„ç»“æž„è¿˜æ˜¯æœ‰å·®å¼‚çš„ï¼ŒHashMapæ˜¯çºµå‘çš„åˆ—è¡¨å½“å‡ºçŽ°ç›¸åŒçš„hashå€¼çš„æ—¶å€™ï¼Œæ‰©å±•å‡ºæ¨ªå‘åˆ—è¡¨ï¼Œå½“æ¨ªå‘çš„åˆ—è¡¨åˆ°è¾¾ä¸€å®šçš„é•¿åº¦çš„æ—¶å€™ï¼Œè¿™ä¸ªæ¨ªå‘çš„é“¾è¡¨å°±ä¼šè‡ªåŠ¨æ•´ç†æˆçº¢é»‘æ ‘çš„å½¢å¼ï¼Œè€ŒhashTableä¸å­˜åœ¨æ¨ªå‘çš„è¿™ç§ç»“æž„çš„ï¼Œå½“count&gt;=é˜ˆå€¼çš„æ—¶å€™å°±ä¼šæŠŠHashé‡ç½®ï¼Œä½¿ä¹‹ä¸ä¼šå‡ºçŽ°hashå€¼é‡å¤çš„æƒ…å†µã€‚å¯ä»¥è¯´hashTableæ¯”è¾ƒhashMapçš„ç»“æž„æ›´ç®€å•ï¼Œä½†æ˜¯æ•ˆçŽ‡ä¼šæ¯”HashMapçš„ä½Žã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Enumæžšä¸¾ç±»åˆ†æžå’Œç›¸å…³æ‹“å±•]]></title>
    <url>%2F2018%2F10%2F16%2F2018-10-15-Enum%E7%B1%BB%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8B%93%E5%B1%95%2F</url>
    <content type="text"><![CDATA[Enumæžšä¸¾ç±»åˆ†æžå’Œç›¸å…³æ‹“å±•å…¶å®žæˆ‘è®¤ä¸ºä½¿ç”¨æžšä¸¾ç±»å°±æ˜¯å¯¹ä½¿ç”¨å¸¸é‡çš„æ‰©å……ï¼Œä¾‹å¦‚ç±»ä¸­ä½¿ç”¨ç±»åž‹ï¼Œåˆ†ç±»ç›¸åŒçš„ç±»å˜é‡çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æžšä¸¾ç±»æ¥æ›¿æ¢æŽ‰ã€‚ å‚è€ƒäº†ç½‘ä¸Šçš„æ–‡ç« ï¼Œå¤§è‡´æœ‰ä¸¤ä¸ªå¥½å¤„ï¼Œç¬¬ä¸€æ˜¯ç¡®å®šä¼ å…¥çš„å‚æ•°ç±»åž‹ã€‚è€Œä¸æ˜¯å½¢å‚æ˜¯intç±»åž‹ï¼Œéšä¾¿ä¸€ä¸ªintç±»åž‹å°±èƒ½å¤Ÿæ»¡è¶³ã€‚ç¬¬äºŒæ˜¯å¯¹æ¯”staticé™æ€å˜é‡æ›´èƒ½å¤Ÿç¡®å®šå˜é‡çš„æ„ä¹‰ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­æ¥çœ‹ã€‚ Enumç±»å®žä¾‹123456789101112131415161718192021/* åˆ—ä¸¾ç®€å•çš„è¡Œé©¶å·¥å…· */public enum trafficTool &#123; BIKE,CAR,BUS,TRAIN,AIRPLANE&#125;public class TrafficToolTest &#123; public void chooseTool(TrafficTool trafficTool)&#123; switch (trafficTool)&#123; case BIKE: System.out.println("è‡ªè¡Œè½¦");break; case CAR: System.out.println("æ±½è½¦");break; &#125; &#125; public static void main(String[] args) &#123; TrafficToolTest trafficToolTest = new TrafficToolTest(); trafficToolTest.chooseTool(TrafficTool.BIKE); &#125;&#125; å’Œæ™®é€šçš„ç±»ä¸€æ ·ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥æ·»åŠ æž„é€ æ–¹æ³• 12345678910SPRING("æ˜¥å¤©"),SUMMER("å¤å¤©"),FALL("ç§‹å¤©"),WINTER("å†¬å¤©");private final String name;SeasonEnum(String name)&#123; this.name = name;&#125;String getName()&#123; return name;&#125; ä¹Ÿå¯ä»¥ç»§æ‰¿ 123456789101112131415161718192021222324252627282930313233public enum SeasonEnum &#123; SPRING("æ˜¥å¤©") &#123; @Override public String comm() &#123; return "è¿™æ˜¯æ˜¥å¤©"; &#125; &#125;,SUMMER("å¤å¤©") &#123; @Override public String comm() &#123; return "è¿™æ˜¯å¤å¤©"; &#125; &#125;,FALL("ç§‹å¤©") &#123; @Override public String comm() &#123; return "è¿™æ˜¯å†¬å¤©"; &#125; &#125;,WINTER("å†¬å¤©") &#123; @Override public String comm() &#123; return "è¿™æ˜¯å†¬å¤©"; &#125; &#125;; private final String name; SeasonEnum(String name)&#123; this.name = name; &#125; String getName()&#123; return name; &#125; public abstract String comm();&#125; ä»¥ä¸Šæ˜¯æžšä¸¾ç±»çš„åŸºæœ¬ä½¿ç”¨ã€‚ EnumMap å’Œ EnumSetpublic class EnumMap&lt;K extends Enum&lt;K&gt;, V&gt; extends AbstractMap&lt;K, V&gt; è¿™æ˜¯å…³äºŽEnumMapçš„ç»§æ‰¿å…³ç³»ã€‚å¯ä»¥å‘çŽ°è¿™æ˜¯keyä¸ºæžšä¸¾ç±»çš„ä¸€ä¸ªMapã€‚ 12345/* ç®€å•åˆ›å»ºï¼Œä»¥åŽå°±å¯ä»¥å®žçŽ°æžšä¸¾ç±»çš„å¤šç§å¤ç”¨ */EnumMap&lt;SeasonEnum,Integer&gt; enumIntegerEnumMap = new EnumMap&lt;SeasonEnum, Integer&gt;(SeasonEnum.class);Set&lt;SeasonEnum&gt; set = enumIntegerEnumMap.keySet();enumIntegerEnumMap.put(SeasonEnum.SPRING,1);System.out.println(enumIntegerEnumMap.get(SeasonEnum.SPRING)); EnumSet ç›¸å¯¹äºŽ EnumMap ç­‰åŒäºŽ hashSet ç›¸å¯¹äºŽ HashMap çš„å­˜åœ¨ï¼Œå¾ˆå¥½ç†è§£ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMapçš„æºç æŸ¥çœ‹]]></title>
    <url>%2F2018%2F10%2F11%2F2018-10-10-hashmap%E7%9A%84%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B%2F</url>
    <content type="text"><![CDATA[HashMapçš„æºç æŸ¥çœ‹HashMapæ˜¯å¸¸è§çš„,ä»¥K-Vå­˜å‚¨çš„æ•°æ®ç»“æž„. åœ¨çœ‹æºç ä¹‹å‰ï¼Œå…ˆéœ€è¦äº†è§£HashMapçš„ç»“æž„æƒ…å†µï¼Œå‰é¢çš„ä»£ç ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ä¸»ä½“æ•°æ®æ˜¯ç”±Node&lt;K,V&gt;ç»„æˆçš„æ•°ç»„æž„æˆï¼Œè€ŒNodeè¿˜æœ‰æŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå‚è€ƒä¸‹å›¾ï¼š NodeèŠ‚ç‚¹é¦–å…ˆçœ‹åˆ°hashmapä¸­çš„nodeç±»ç»§æ‰¿äº†map.Entry&lt;k,v&gt;ç»“æž„ï¼Œæœ‰ç±»åž‹ä¸ºKçš„keyå’Œç±»åž‹ä¸ºVçš„valueï¼›å…¶æ¬¡nodeæ˜¯ä¸€ä¸ªå•é“¾è¡¨ç»“æž„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; final K key; V value; // æŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹çš„æŒ‡é’ˆ Node&lt;K,V&gt; next; Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125; public final K getKey() &#123; return key; &#125; public final V getValue() &#123; return value; &#125; public final String toString() &#123; return key + "=" + value; &#125; public final int hashCode() &#123; return Objects.hashCode(key) ^ Objects.hashCode(value); &#125; public final V setValue(V newValue) &#123; V oldValue = value; value = newValue; return oldValue; &#125; public final boolean equals(Object o) &#123; if (o == this) return true; if (o instanceof Map.Entry) &#123; Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o; if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true; &#125; return false; &#125;&#125; HashMapæºç åŸºæœ¬å±žæ€§123456789101112131415161718192021222324/* å®žé™…ä¸Šç»“æž„å°±æ˜¯ä¸€ä¸ªç±»åž‹ä¸ºNodeçš„æ•°ç»„,ä½¿ç”¨transient é˜²æ­¢å¯¹æ•´ä¸ªtableå…¨éƒ¨åºåˆ—åŒ– */transient Node&lt;K,V&gt;[] table;/** * Holds cached entrySet(). Note that AbstractMap fields are used * for keySet() and values(). * å¾—åˆ°entryset */transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;/** * The number of key-value mappings contained in this map. mapçš„å¤§å° */transient int size;/* æ“ä½œæ¬¡æ•° */transient int modCount;/* é˜ˆå€¼ï¼Œå¦‚æžœè¶…è¿‡ä¸´ç•Œå€¼å°±ä¼šè‡ªåŠ¨æ‰©å……æ•°ç»„ */int threshold;/* åŠ è½½å› å­ */final float loadFactor; hashMapçš„ä¸‰ä¸ªæž„é€ æ–¹æ³•12345678910111213141516171819202122232425262728/* ç¬¬ä¸€ä¸ªå‚æ•° æ˜¯é»˜è®¤çš„åˆå§‹åŒ–é˜ˆå€¼å¤§å°ï¼Œç¬¬äºŒä¸ªæ˜¯åŠ è½½å› å­å¤§å° */public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) /* å¦‚æžœåˆ¶å®šçš„åˆå§‹åŒ–é˜ˆå€¼å°äºŽ0 */ throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); this.loadFactor = loadFactor; this.threshold = tableSizeFor(initialCapacity);&#125;/* ä½¿ç”¨thisè°ƒç”¨ä¸Šé¢çš„æ–¹æ³• */public HashMap(int initialCapacity) &#123; this(initialCapacity, DEFAULT_LOAD_FACTOR);&#125;/** * ä½¿ç”¨é»˜è®¤çš„é˜ˆå€¼å’Œå› å­ï¼Œå¤§å°åˆ†åˆ«ä¸º16å’Œ0.75 * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the default initial capacity * (16) and the default load factor (0.75). */public HashMap() &#123; this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted&#125; hashMapçš„æ–¹æ³•æºç åœ¨å¤§è‡´äº†è§£å®ŒHashMapçš„ç»“æž„åŽï¼Œé€šè¿‡æŸ¥çœ‹putæ–¹æ³•ï¼Œæ¥åˆ†æžå…ƒç´ æ˜¯å¦‚ä½•æ”¾åˆ°è¿™ç§ç»“æž„ä¸­çš„ã€‚å¤§è‡´æ­¥éª¤å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š putæ–¹æ³•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768public V put(K key, V value) &#123; /* è°ƒç”¨putValæ–¹æ³• */ return putVal(hash(key), key, value, false, true);&#125;/** * Implements Map.put and related methods * * @param hash hash for key keyçš„hashç  * @param key the key keyå€¼ * @param value the value to put valueå€¼ * @param onlyIfAbsent if true, don't change existing value å¦‚æžœæ˜¯true ä¸æ”¹å˜å½“å‰å€¼ * @param evict if false, the table is in creation mode. å¦‚æžœæ˜¯falseï¼Œé‚£ä¹ˆtableå°±å±žäºŽåˆ›å»ºæ¨¡å¼ ï¼ˆï¼Ÿï¼‰ * @return previous value, or null if none */final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; /* å½“Mapä¸ºç©ºçš„æ—¶å€™ è¿™æ—¶å€™tabä¸º16ä¹Ÿå°±æ˜¯nä¸º16*/ /* è¿™æ˜¯å½“mapä¸­çš„å†…å®¹ä¸ºç©ºçš„æ—¶å€™ * newCap = DEFAULT_INITIAL_CAPACITY; * newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); */ if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; /* å¦‚æžœå½“å‰tabçš„length&amp;hashå€¼å†tabåˆ—è¡¨ä¸­ä¸é‡å¤ */ if ((p = tab[i = (n - 1) &amp; hash]) == null) /* æ–°å»ºä¸€ä¸ªnoede å†tab[i]çš„ä½ç½®ä¸Š */ tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; /* å½“æ·»åŠ é‡å¤çš„keyçš„æ—¶å€™ è¿™æ—¶å€™hashå’Œkeyçš„å€¼éƒ½ç›¸ç­‰ï¼Œå°±ç›¸å½“äºŽä¸æ·»åŠ  */ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; else if (p instanceof TreeNode) /* å¦‚æžœeæ˜¯treeNodeçš„æ—¶å€™ */ e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123; for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; // å°†æ–°å€¼æ·»åŠ åˆ°pçš„åŽé¢ p.next = newNode(hash, key, value, null); if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st /* å¦‚æžœå½“å‰åˆ—è¡¨ä¸­çš„é•¿åº¦å¤§äºŽç­‰äºŽ 8-1 çš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸ªåˆ—è¡¨æ•´ç†æˆæ ‘å½¢ç»“æž„ */ treeifyBin(tab, hash); break; &#125; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; /* å¦‚æžœå½“å‰sizeå¤§äºŽthresholdçš„æ—¶å€™æ‰©å……table */ if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null;&#125; åœ¨çœ‹getæ–¹æ³•ä¹‹å‰å…ˆçœ‹å’Œputæ–¹æ³•æ¯æ¯ç›¸å…³çš„resizeæ–¹æ³•å¦‚æžœ hash&amp;length-1 çš„å€¼é‡å¤çš„è¯ï¼Œè¯´æ˜Žä½ç½®å†²çªï¼Œé¦–å…ˆä¼šæ·»åŠ åœ¨è¿™ä¸ªä½ç½®å…ƒç´ åŽé¢ï¼Œå¦‚æžœå¤§å°è¶…è¿‡ TREEIFY_THRESHOLD - 1 çš„æ—¶å€™è‡ªåŠ¨ä¸ºè¿™åˆ—æ•´ç†æˆæ ‘å½¢çŠ¶ã€‚è¿™æ ·å°±ä¼šå˜ä¸ºæ•°ç»„å’Œæ¨ªå‘åˆ—è¡¨æˆ–æ ‘çš„ç»„åˆç»“æž„ã€‚ åœ¨æœªé‡å¤hashçš„å‰æä¸‹ï¼Œå¦‚æžœtableçš„å¤§å°è¶…è¿‡è®¾ç½®çš„ threshold çš„å¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘ resize æ–¹æ³•ã€‚åœ¨resizeæ—¶ä¼šå°†HashMapä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œé‡æ–°æŽ’åˆ—ï¼Œä»¥ä¾¿ä¸Žé˜²æ²»åˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µå‘ç”Ÿã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹resizeæ–¹æ³•çš„ä»£ç ç»“æž„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374final Node&lt;K,V&gt;[] resize() &#123; Node&lt;K,V&gt;[] oldTab = table; int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; if (oldCap &gt; 0) &#123; if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return oldTab; &#125; //newcapæ˜¯oldcapçš„2å€ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // double threshold &#125; else if (oldThr &gt; 0) // initial capacity was placed in threshold newCap = oldThr; else &#123; // zero initial threshold signifies using defaults newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; if (newThr == 0) &#123; float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; threshold = newThr; @SuppressWarnings(&#123;"rawtypes","unchecked"&#125;) Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; table = newTab; if (oldTab != null) &#123; //å¾ªçŽ¯åŽŸtableæ•°ç»„ ï¼Ÿå› ä¸ºåœ¨æ‰©å®¹åŽ hash &amp; (size-1) çš„ä½ç½®å‘ç”Ÿäº†å˜åŒ– ï¼Œæ‰€ä»¥åº”å½“è¿›è¡Œé‡æŽ’ for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123; oldTab[j] = null; if (e.next == null)//è¯´æ˜Žeä¸å­˜åœ¨hashå†²çª newTab[e.hash &amp; (newCap - 1)] = e; else if (e instanceof TreeNode) ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else &#123; // preserve order Node&lt;K,V&gt; loHead = null, loTail = null; Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; do &#123; //å†åŽ»å¾ªçŽ¯bin next = e.next; if ((e.hash &amp; oldCap) == 0) &#123; //å¦‚æžœåœ¨ä½Žä½ ï¼ˆè€ï¼‰æ•°ç»„ä¸­ä¹Ÿå°±æ˜¯å…ƒç´ hastå’Œå°±æ•°ç»„å–æ¨¡ä¸º0æ—¶ï¼Œè¯´æ˜Žé‡æŽ’åŽä»åœ¨è€æ•°ç»„å†… if (loTail == null) loHead = e; else loTail.next = e; loTail = e;//é€’å½’å‘ä¸‹ç»§ç»­æŽ’ &#125; else &#123;//å¦åˆ™åœ¨é«˜ä½æ•°ç»„ä¸­ ï¼Œä¹Ÿå°±æ˜¯åœ¨æ‰©å®¹å‡ºæ¥çš„æ•°ç»„ä¸­ if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; //ä½Žä½æ•°ç»„è¿˜æ˜¯åœ¨åŽŸæ¥çš„ä½ç½®ä¸Š &#125; if (hiTail != null) &#123; hiTail.next = null; newTab[j + oldCap] = hiHead; //é«˜ä½æ•°ç»„åœ¨æ—§æ•°ç»„+jçš„ä½ç½®ä¸Š &#125; &#125; &#125; &#125; &#125; return newTab; &#125; getæ–¹æ³•getæ–¹æ³•æ˜¯æ ¹æ®hashå’Œkeyå€¼è¿›è¡ŒæŸ¥æ‰¾,åŒç†containKeyæ–¹æ³•ä¹Ÿæ˜¯è°ƒç”¨getNodeæ–¹æ³•è¿›è¡Œåˆ¤æ–­ã€‚ 12345678910111213141516171819202122232425public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; if (first.hash == hash &amp;&amp; // å…ˆå›žæ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; if ((e = first.next) != null) &#123; if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); do &#123; /* ä»Žç¬¬äºŒä¸ªèŠ‚ç‚¹å¼€å§‹å¾ªçŽ¯ æŸ¥æ‰¾hashå’Œkeyåˆ†åˆ«ç›¸åŒ */ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null;&#125; removeæ–¹æ³•ä½¿ç”¨removeæ–¹æ³•æ ¹æ®keyç§»é™¤èŠ‚ç‚¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public V remove(Object key) &#123; Node&lt;K,V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value;&#125;/** * Implements Map.remove and related methods * * @param hash keyçš„hashå€¼ * @param key é”®å€¼ * @param value å¦‚æžœæƒ³åŒ¹é…çš„è¯å°±æ˜¯valueï¼Œå¦åˆ™ç©º * @param matchValue å¦‚æžœæ˜¯tureé‚£ä¹ˆå°±ç§»é™¤å’Œvalue equalçš„ * @param movable å¦‚æžœæ˜¯falseçš„è¯ï¼Œç§»é™¤è¿™ä¸ªèŠ‚ç‚¹ä¸è¦ç§»åŠ¨å…¶ä»–èŠ‚ç‚¹ * @return the node, or null if none */final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; /* ç¡®å®šèŠ‚ç‚¹ */ if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) &#123; Node&lt;K,V&gt; node = null, e; K k; V v; /* å¦‚æžœhashå€¼ç›¸åŒ keyå€¼ä¹Ÿç›¸åŒ è¯´æ˜Žå°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹ */ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) &#123; /* å¦åˆ™æ¨ªå‘æŸ¥æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ */ if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); else &#123; do &#123; /* çœç•¥-------- */ &#125; while ((e = e.next) != null); &#125; &#125; if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) &#123; if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); /* æŽ¥ä¸‹æ¥æŠŠtabä¸­å¯¹åº”çš„index removeæŽ‰ */ else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; afterNodeRemoval(node); return node; &#125; &#125; return null;&#125; keySetæ–¹æ³•ketSetæ–¹æ³•ä¹Ÿæ˜¯ç»å¸¸ç”¨åˆ°çš„æ–¹æ³•ï¼ŒkeySetæ–¹æ³•å®žé™…ä¸Šå°±æ˜¯è¿”å›žæ–°å»ºçš„keysetç»“æž„ã€‚å…·ä½“ç»“æž„å¯ä»¥çœ‹å¦‚ä¸‹ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰ä½¿ç”¨forEachå’ŒIteratoræ–¹æ³•çš„æ—¶å€™æ‰ä¼šå¾ªçŽ¯tabæ¥æ‰¾keyçš„setæ•°æ®ã€‚æ•°æ®ç»“æž„ä¸­éƒ½æ˜¯è°ƒç”¨å¤–éƒ¨æ–¹æ³•çš„æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627final class KeySet extends AbstractSet&lt;K&gt; &#123; public final int size() &#123; return size; &#125; //è¿”å›žå½“å‰size public final void clear() &#123; HashMap.this.clear(); &#125; //ç›´æŽ¥è°ƒç”¨hashMapçš„clearæ–¹æ³• public final Iterator&lt;K&gt; iterator() &#123; return new KeyIterator(); &#125; public final boolean contains(Object o) &#123; return containsKey(o); &#125; public final boolean remove(Object key) &#123; return removeNode(hash(key), key, null, false, true) != null; &#125; public final Spliterator&lt;K&gt; spliterator() &#123; return new KeySpliterator&lt;&gt;(HashMap.this, 0, -1, 0, 0); &#125; public final void forEach(Consumer&lt;? super K&gt; action) &#123; Node&lt;K,V&gt;[] tab; if (action == null) throw new NullPointerException(); if (size &gt; 0 &amp;&amp; (tab = table) != null) &#123; int mc = modCount; /* æŠŠå½“å‰æ“ä½œæ•°è®°ä¸‹æ¥ */ for (int i = 0; i &lt; tab.length; ++i) &#123; for (Node&lt;K,V&gt; e = tab[i]; e != null; e = e.next) action.accept(e.key); &#125; if (modCount != mc) throw new ConcurrentModificationException(); &#125; &#125;&#125; è¿™æ˜¯å‡ ä¸ªéžå¸¸å¸¸ç”¨çš„hashMapçš„æ–¹æ³•å’ŒåŸºæœ¬çš„æ•°æ®ç»“æž„æºç çš„åˆ†æžæŸ¥çœ‹ã€‚å°±å½“åšç¬”è®°è®°å½•ä¸€ä¸‹ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedListçš„æºç æŸ¥çœ‹]]></title>
    <url>%2F2018%2F10%2F08%2F2018-10-08-LinkedList%E7%9A%84%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B%2F</url>
    <content type="text"><![CDATA[LinkedListçš„æºç æŸ¥çœ‹ç»“æž„æºç LinkedListæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå› ä¸ºå®ƒå…·æœ‰nextå’Œprevçš„å‰åŽå¼•ç”¨ã€‚æ‰€ä»¥æ¯æ¬¡æ·»åŠ å…ƒç´ ï¼Œç§»é™¤å…ƒç´ æ—¶ï¼Œéœ€è¦è€ƒè™‘ä¸¤ä¸ªæŒ‡é’ˆçš„å¼•ç”¨æƒ…å†µï¼Œä¿è¯å¯¹å‰ä¸€ä¸ªå…ƒç´ çš„å®Œå…¨æ–­å¼€å’Œæ–°å…ƒç´ çš„å®Œå…¨å¼•ç”¨ï¼Œå¦‚æžœåœ¨æŒ‡å®šä½ç½®ä¸Šè¿žæŽ¥å…ƒç´ çš„è¿‡ç¨‹å’Œç»“æž„å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š ä¾èµ–ç»“æž„12345678910111213141516171819202122232425262728/* LinkedListçš„å†…éƒ¨å˜é‡ å¯ä»¥çœ‹å‡ºLinkedListå…¶å®žå°±æ˜¯ä¸€ä¸ªé“¾è¡¨ */transient int size = 0;/** * æŒ‡å‘é¦–èŠ‚ç‚¹ * Invariant: (first == null &amp;&amp; last == null) || * (first.prev == null &amp;&amp; first.item != null) */transient Node&lt;E&gt; first;/** * æŒ‡å‘å°¾èŠ‚ç‚¹ * Invariant: (first == null &amp;&amp; last == null) || * (last.next == null &amp;&amp; last.item != null) */transient Node&lt;E&gt; last;/* å†…éƒ¨nodeå®žçŽ° */ E item; Node&lt;E&gt; next; Node&lt;E&gt; prev;/* åŒå‘é“¾è¡¨ */ Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123; this.item = element; this.next = next; this.prev = prev; &#125;&#125; LinkedListæž„é€ å‡½æ•°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/* ç©ºæž„é€ å‡½æ•° æ¯”è¾ƒå¸¸ç”¨ */public LinkedList() &#123; &#125;/* æœ‰collectionå‚æ•°çš„æž„é€ å‡½æ•° */public LinkedList(Collection&lt;? extends E&gt; c) &#123; this(); addAll(c);&#125;public boolean addAll(Collection&lt;? extends E&gt; c) &#123; return addAll(size, c);&#125;/* å‚æ•°ï¼šå½“å‰æ•°é‡ä¹Ÿå°±æ˜¯è¦å¾—åˆ°å½“å‰é“¾è¡¨çš„ä½ç½® */public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123; checkPositionIndex(index); Object[] a = c.toArray(); int numNew = a.length; if (numNew == 0) return false; Node&lt;E&gt; pred, succ; // å¯¹æ’å…¥å‰æƒ…å†µçš„åˆ¤æ–­ if (index == size) &#123;// å¦‚æžœåœ¨å°¾éƒ¨æ’å…¥ pred=æœ€åŽä¸€ä¸ªèŠ‚ç‚¹ succ = null; pred = last; &#125; else &#123;// å¦åˆ™åœ¨ä¸­éƒ¨æ’å…¥ succ=å½“å‰èŠ‚ç‚¹ pred=å‰ä¸€èŠ‚ç‚¹/* - - - - - - - - - *//* ^ ^ *//* 1 2 å¦‚æžœæƒ³åœ¨2ä½ç½®æ’å…¥å…ƒç´ ï¼Œå‰ä¸€ä¸ªå…ƒç´ ä¸åŠ¨ï¼Œå°†åŽé¢çš„å…ƒç´ åŽç§»*/ succ = node(index); pred = succ.prev; &#125; for (Object o : a) &#123; @SuppressWarnings("unchecked") E e = (E) o;// æž„é€ æ–¹æ³• å‰èŠ‚ç‚¹/å†…å®¹/åŽèŠ‚ç‚¹ å§‹ç»ˆpredæ˜¯å‰ç½®èŠ‚ç‚¹ Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, null); if (pred == null)// å¦‚æžœpred==null è¯´æ˜Ž æœ¬èº«åˆ—è¡¨å¼€å§‹å°±æ˜¯ç©ºçš„æˆ–è€…åœ¨å¼€å¤´æ’å…¥å…ƒç´  first = newNode; else// å¦åˆ™åœ¨åŽé¢æ’å…¥newNode pred.next = newNode;// å‘åŽå¾ªçŽ¯èŠ‚ç‚¹ pred = newNode; &#125;// å¦‚æžœsucc==null è¯´æ˜Žåˆ°æœ€åŽä¸€ä¸ªèŠ‚ç‚¹åŽä½ç½® // å°†æœ€åŽçš„æ–°æ’å…¥çš„å…ƒç´ predèµ‹å€¼ç»™last if (succ == null) &#123; last = pred; &#125; else &#123; /* å¦åˆ™æ’å…¥åœ¨succå‰ */ pred.next = succ; succ.prev = pred; &#125; size += numNew; modCount++; return true;&#125; åŸºæœ¬æ–¹æ³•æ·»åŠ 12345678910/* addæ–¹æ³•é»˜è®¤è°ƒç”¨linklastæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å‘åŽæ·»åŠ å…ƒç´  */public boolean add(E e) &#123; linkLast(e); return true;&#125;/* åŒæ ·æœ‰addLast è¾¾åˆ°ç›¸åŒçš„ç›®çš„ï¼Œå°±æ˜¯ä¸è¿”å›žä»»ä½•ä¸œè¥¿ */public void addLast(E e) &#123; linkLast(e); &#125; ä½¿ç”¨addæ–¹æ³•åŽä¼šé»˜è®¤çš„è°ƒç”¨ linkLast åŽå°†å…ƒç´ æ·»åŠ è‡³Listçš„æœ«å°¾ã€‚ 1234567891011121314void linkLast(E e) &#123; final Node&lt;E&gt; l = last; /* èŽ·å¾—æœ€åŽä¸€ä¸ªå…ƒç´ å½“ä½œæ–°èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ */ final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null); /* æŠŠå½“å‰èŠ‚ç‚¹ä»˜ç»™last */ last = newNode; if (l == null) first = newNode; else // å°†lastçš„nextæŒ‡å‘æ–°èŠ‚ç‚¹,å®ŒæˆåŒæ–¹ç›¸äº’é“¾æŽ¥ l.next = newNode; size++; modCount++;&#125; å½“ç„¶ä¹Ÿå¯ä»¥è°ƒç”¨æ–¹æ³•åœ¨æœ€å‰é¢æ·»åŠ å…ƒç´  12345678910111213141516171819public void addFirst(E e) &#123; linkFirst(e);&#125;private void linkFirst(E e) &#123; // èŽ·å–é¦–èŠ‚ç‚¹ final Node&lt;E&gt; f = first; // è®¾ç½®æ–°èŠ‚ç‚¹ final Node&lt;E&gt; newNode = new Node&lt;&gt;(null, e, f); //è®¾ç½®æ–°èŠ‚ç‚¹ä¸ºé¦–èŠ‚ç‚¹ first = newNode; if (f == null) last = newNode; else // å°†æ–°èŠ‚ç‚¹ä¸ŽåŽŸé¦–èŠ‚ç‚¹è¿žæŽ¥ f.prev = newNode; size++; modCount++;&#125; ç§»é™¤removeæ–¹æ³•12345678910111213141516171819202122232425262728293031323334public E remove(int index) &#123; /* å…ˆåˆ¤æ–­æ˜¯å¦è¶Šç•Œ */ checkElementIndex(index); return unlink(node(index)); &#125;E unlink(Node&lt;E&gt; x) &#123; // assert x != null; final E element = x.item; final Node&lt;E&gt; next = x.next; final Node&lt;E&gt; prev = x.prev;/* å¦‚æžœprevæ˜¯ç©º è¯´æ˜Žå½“å‰å…ƒç´ æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´  å¦‚ A B C ç§»é™¤Aï¼Œç›´æŽ¥å°†BæŒ‡å‘é¦–èŠ‚ç‚¹å³å¯ */ if (prev == null) &#123; first = next; &#125; else &#123; /* å½“å‰èŠ‚ç‚¹ä¸Žå‰åŽèŠ‚ç‚¹æ–­ç»é“¾æŽ¥ å¦‚ABCç§»é™¤Bï¼Œåˆ™éœ€è¦å°†A.nextæŒ‡å‘Cï¼ŒB.preæŒ‡å‘ç©º */ prev.next = next; x.prev = null; &#125; // å› ä¸ºLinkedListä¸ºåŒå‘é“¾è¡¨ï¼Œéœ€è¦å–æ¶ˆnextå’Œprev/* å¦‚æžœæ˜¯æœ€åŽä¸€ä¸ªå…ƒç´  */ if (next == null) &#123; last = prev; &#125; else &#123; /* å½“å‰èŠ‚ç‚¹ä¸Žå‰åŽèŠ‚ç‚¹æ–­ç»é“¾æŽ¥ å› ä¸ºLinkedListæ˜¯åŒå‘é“¾è¡¨ */ next.prev = prev; x.next = null; &#125;/* ç½®ç©º */ x.item = null; size--; modCount++; return element;&#125; removeFirst12345678910111213141516171819202122public E removeFirst() &#123; final Node&lt;E&gt; f = first; if (f == null) throw new NoSuchElementException(); return unlinkFirst(f);&#125;private E unlinkFirst(Node&lt;E&gt; f) &#123; // assert f == first &amp;&amp; f != null; final E element = f.item; final Node&lt;E&gt; next = f.next; f.item = null; f.next = null; // help GC first = next; if (next == null) last = null; else next.prev = null; size--; modCount++; return element;&#125; removeLast å’ŒremoveFirståŒç†èµ‹å€¼å–å€¼æ“ä½œgetæ–¹æ³•1234567891011121314151617181920212223242526public E get(int index) &#123; checkElementIndex(index); /* å¾—åˆ°indexå¤„èŠ‚ç‚¹çš„itemä¿¡æ¯ */ return node(index).item;&#125;Node&lt;E&gt; node(int index) &#123; // assert isElementIndex(index); // åˆ†ä¸¤ä¸ªæ–¹å‘æŸ¥æ‰¾ï¼Œ1.å¦‚æžœç»™å®šçš„indexå°äºŽsizeçš„ä¸€åŠ if (index &lt; (size &gt;&gt; 1)) &#123; Node&lt;E&gt; x = first; //ä»Žå¤´å¼€å§‹ for (int i = 0; i &lt; index; i++) x = x.next; // è¿”å›žæœ€åŽä¸€ä¸ª return x; &#125; else &#123; // 2.å¦‚æžœç»™å®šçš„indexå¤§äºŽsizeçš„ä¸€åŠ Node&lt;E&gt; x = last; // ä»Žå°¾éƒ¨å¼€å§‹æ‰¾ for (int i = size - 1; i &gt; index; i--) x = x.prev; //è¿”å›žæœ€åŽçš„é‚£ä¸ª return x; &#125;&#125; setæ–¹æ³•12345678public E set(int index, E element) &#123; checkElementIndex(index); Node&lt;E&gt; x = node(index); E oldVal = x.item; x.item = element; /* setæ–¹æ³•ä¼šè¿”å›žåŽŸæ¥çš„å€¼ */ return oldVal;&#125; LinkedListä¸­çš„æ ˆæ“ä½œpeekæ–¹æ³•12345678910/** * Retrieves, but does not remove, the head (first element) of this list. * åªæ˜¯æ£€ç´¢æ ˆé¦–å…ƒç´ ï¼Œä½†å¹¶ä¸å¼¹å‡º * @return the head of this list, or &#123;@code null&#125; if this list is empty * @since 1.5 */public E peek() &#123; final Node&lt;E&gt; f = first; return (f == null) ? null : f.item;&#125; åŒç† peekFirst å’Œ peekLast pollæ–¹æ³•12345678910/** * Retrieves and removes the head (first element) of this list. * æ£€ç´¢å¹¶ä¸”ç§»é™¤æ ˆé¦–å…ƒç´  unlinkFirstæ˜¯å¯ä»¥è¿”å›žç§»é™¤å…ƒç´ çš„ * @return the head of this list, or &#123;@code null&#125; if this list is empty * @since 1.5 */public E poll() &#123; final Node&lt;E&gt; f = first; return (f == null) ? null : unlinkFirst(f);&#125; åŒç† pollFirst å’Œ pollLast pushæ–¹æ³•123456789101112/** * Pushes an element onto the stack represented by this list. In other * words, inserts the element at the front of this list. * åœ¨æ ˆé¦–å †ä¸€ä¸ªå…ƒç´  * &lt;p&gt;This method is equivalent to &#123;@link #addFirst&#125;. * * @param e the element to push * @since 1.6 */public void push(E e) &#123; addFirst(e);&#125; popæ–¹æ³•1234567891011121314/** * Pops an element from the stack represented by this list. In other * words, removes and returns the first element of this list. * å‡ºæ ˆ * &lt;p&gt;This method is equivalent to &#123;@link #removeFirst()&#125;. * * @return the element at the front of this list (which is the top * of the stack represented by this list) * @throws NoSuchElementException if this list is empty * @since 1.6 */public E pop() &#123; return removeFirst();&#125; offeræ–¹æ³•å®žé™…ä¸Š offer æ˜¯è°ƒç”¨çš„ add æ–¹æ³•ï¼Œä½†æ˜¯åŒºåˆ«å°±åœ¨ linkedlist ç»§æ‰¿äº† Dequ å’Œ List çˆ¶ç±»ã€‚ä¸€èˆ¬å½“ queue ç”¨çš„æ—¶å€™è¦ç”¨ offer/push/pop è€Œå½“ä½¿ç”¨ list çš„æ—¶å€™ç”¨ add/remove ã€‚ æ€»ç»“é€šè¿‡æŸ¥çœ‹LinkedListçš„æºç å¯ä»¥å‘çŽ°ï¼š é¦–å…ˆå¯ä»¥ç¡®å®šLinkedLIstæ˜¯ä¸€ä¸ªé€šè¿‡Nodeç»“æž„å®žçŽ°çš„åŒå‘é“¾è¡¨ å…¶æ¬¡é€šè¿‡addå’Œremoveæ–¹æ³•å¯ä»¥çœ‹å‡ºå®ƒä¸å‘ArrayListä¸€æ ·ï¼Œéœ€è¦å¯¹å®¹é‡è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œè€Œæ˜¯é€šè¿‡â€˜æŒ‡é’ˆâ€™æŒ‡å‘å‰åŽèŠ‚ç‚¹å®žçŽ°çš„â€˜è¿žæŽ¥â€™ã€‚ ç„¶åŽé€šè¿‡getæ–¹æ³•å¯ä»¥çœ‹å‡ºæŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šä½ç½®ä¸Šçš„éžå¸¸éº»çƒ¦ï¼Œéœ€è¦éåŽ†Listï¼Œå°½ç®¡ä½¿ç”¨äº†äºŒåˆ†çš„æ–¹å¼è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½†æ˜¯æŸ¥æ‰¾æ€§èƒ½ä¾æ—§ä¸èƒ½å’ŒArrayListç›¸æ¯”ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArrayListçš„æºç æŸ¥çœ‹]]></title>
    <url>%2F2018%2F10%2F04%2F2018-10-04-ArrayList%E7%9A%84%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B%2F</url>
    <content type="text"><![CDATA[ArrayListçš„æºç  å˜é‡ å«ä¹‰ é»˜è®¤å€¼ DEFAULT_CAPACITY é»˜è®¤çš„Liståˆå§‹åŒ–å®¹é‡ 10 EMPTY_ELEMENTDATA ç©ºå®žä¾‹çš„ç©ºæ•°ç»„å†…å®¹ {} DEFAULTCAPACITY_EMPTY_ELEMENTDATA å…±äº«çš„ç©ºæ•°ç»„å®žä¾‹ï¼Œç”¨äºŽé»˜è®¤å¤§å°çš„ç©ºå®žä¾‹ã€‚ {} elementData å­˜å‚¨ArrayListå†…å®¹çš„æ•°ç»„ç¼“å†²åŒº,é»˜è®¤æ—¶ elementData == DEL [] size elementDataæ•°ç»„å¤§å° å…¶ä¸­ elementDataæ•°ç»„æ˜¯ArrayListçš„å­˜å‚¨ç»“æž„,ä¹Ÿå°±æ˜¯è¯´ArrayListä½¿ç”¨æ•°ç»„å­˜å‚¨å…ƒç´ , ä½†åŒæ—¶æ˜¯ä½¿ç”¨transientè¿›è¡Œä¿®é¥°çš„,ä¹Ÿå°±æ˜¯ä¸èƒ½åºåˆ—åŒ–çš„,ä½†å®žé™…ä¸ŠArrayListå®žçŽ°äº†SerializableæŽ¥å£,é‚£ä¹ˆè¿™ä¹ˆåšçš„åŽŸå› æ—¶ä»€ä¹ˆ? å› ä¸ºArrayListå…·æœ‰è‡ªåŠ¨æ‰©å®¹æœºåˆ¶,å…ƒç´ åˆ°ä¸€å®šçš„å¤§å°å°±ä¼šè‡ªåŠ¨æ‰©å®¹,è¿™å°±ä¼šå¯¼è‡´ArrayListä¸­çš„å…ƒç´ ä¸€å®šä¸æ˜¯æ»¡çš„,ä¹Ÿå°±æ˜¯è¯´å¦‚æžœå½“å‰ArrayListçš„å¤§å°æ—¶50,å®žé™…å…ƒç´ å¯èƒ½è¿œè¿œå°äºŽ50,æ­¤æ—¶å°±æ²¡æœ‰å°†å…¨éƒ¨elementDataéƒ½åºåˆ—åŒ–çš„å¿…è¦äº†. æ‰€ä»¥,ArrayListæä¾›äº†ä¸€ä¸ªwriteObjectæ–¹æ³•,ä¸“é—¨å¯¹elementDataè¿›è¡Œåºåˆ—åŒ–.é‡Œé¢ä½¿ç”¨å¯¹å°äºŽsizeçš„æ‰€æœ‰å…ƒç´ è¿›è¡Œåºåˆ—åŒ–,å°±é¿å…äº†ä¸Šé¢é˜è¿°çš„é—®é¢˜. 123for (int i=0; i&lt;size; i++) &#123; s.writeObject(elementData[i]);&#125; æž„é€ å‡½æ•°æºç 123456789101112131415161718192021222324252627282930313233343536/* æ²¡æœ‰å‚æ•°çš„æƒ…å†µä¸‹ */public ArrayList() &#123; // è®¾ç½®é»˜è®¤çš„å†…å®¹ä¸º&#123;&#125; this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;&#125;/* é»˜è®¤æ˜¯æ‹¥æœ‰é»˜è®¤å®¹é‡ï¼ˆ10ï¼‰çš„ç©ºçš„ array list */private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;/* è¿™ä¸ªé»˜è®¤çš„å®¹é‡æ˜¯å®šä¹‰å¥½çš„10 */ private static final int DEFAULT_CAPACITY = 10;/* å½“å‚æ•°æ˜¯å®¹é‡çš„å¤§å°çš„æ—¶å€™ */ public ArrayList(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; /* å¦‚æžœè‡ªå®šä¹‰åˆå§‹å®¹é‡å¤§å°*/ this.elementData = new Object[initialCapacity]; &#125; else if (initialCapacity == 0) &#123; this.elementData = EMPTY_ELEMENTDATA; &#125; else &#123; /* å¦‚æžœå‚æ•°å°äºŽ0 æŠ¥å‚æ•°å¼‚å¸¸çš„é”™è¯¯ï¼ˆIllegalArgumentExceptionï¼‰ */ throw new IllegalArgumentException("Illegal Capacity: "+ initialCapacity); &#125;&#125;/* å½“å‚æ•°æ˜¯ä¸€ä¸ªCollectionç»“æž„çš„æ—¶å€™ */public ArrayList(Collection&lt;? extends E&gt; c) &#123; elementData = c.toArray(); if ((size = elementData.length) != 0) &#123; // c.toArray might (incorrectly) not return Object[] (see 6260652) if (elementData.getClass() != Object[].class) /* å¦‚æžœä¸æ˜¯objectç±»åž‹çš„è¯ è½¬æ¢æˆobjectç±»åž‹ */ elementData = Arrays.copyOf(elementData, size, Object[].class); &#125; else &#123; // replace with empty array. this.elementData = EMPTY_ELEMENTDATA; &#125; &#125; å¸¸ç”¨æ–¹æ³•æºç åœ¨çœ‹æºç ä¹‹å‰å…ˆé€šè¿‡ä¸‹é¢è¿™å¼ å›¾ç‰‡äº†è§£ä»¥ä¸‹å¦‚æžœæ–°å»ºä¸€ä¸ªArrayListåŽæ·»åŠ ä¸€ä¸ªå…ƒç´ çš„å¤§è‡´è¿‡ç¨‹ï¼š add æ·»åŠ æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344/* åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ·»åŠ  */public boolean add(E e) &#123; /* æ‰©å……å®¹é‡ */ ensureCapacityInternal(size + 1); // Increments modCount!! /* ArrayListå…¶å®žå°±æ˜¯ä¸ªæ•°ç»„ å°†æ–°addçš„å€¼æ”¾åˆ°æ•°ç»„çš„æœ€åŽé¢ */ elementData[size++] = e; return true;&#125;private void ensureCapacityInternal(int minCapacity) &#123; ensureExplicitCapacity(calculateCapacity(elementData, minCapacity)); &#125;private static int calculateCapacity(Object[] elementData, int minCapacity) &#123; /* å¦‚æžœæ˜¯ç©ºçš„è¯è¿”å›ž é»˜è®¤æˆ–å½“å‰ */ if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; // å¦‚æžœelementData == &#123;&#125;æ—¶ï¼Œè¿”å›žç»™å‡ºçš„å€¼å’Œé»˜è®¤çš„DEFAULT_CAPACITYå…¶ä¸­å¤§çš„é‚£ä¸ª return Math.max(DEFAULT_CAPACITY, minCapacity); &#125; return minCapacity; &#125;private void ensureExplicitCapacity(int minCapacity) &#123; /* The number of times this list has been &lt;i&gt;structurally modified&lt;/i&gt;. */ // è¿™ä¸ªmodCount æŒ‡çš„æ˜¯æ•°æ®ç»“æž„æ”¹å˜çš„æ¬¡æ•°ï¼ˆæ¯”å¦‚æ·»åŠ ã€ç§»é™¤å…ƒç´ ï¼‰ modCount++; // overflow-conscious code if (minCapacity - elementData.length &gt; 0) /* å¦‚æžœå½“å‰çš„å®¹é‡å¤§äºŽç»™å®šçš„é•¿åº¦çš„æ—¶å€™ éœ€è¦æ‰©å…… */ grow(minCapacity); &#125;private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; // åŽŸé•¿åº¦ int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); //æ–°é•¿åº¦ å³ç§»è¿ç®—ã€‚é•¿åº¦ä¸º1.5å€çš„åŽŸé•¿åº¦ if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: // ä½¿ç”¨Arrays.copyofæ–¹æ³•è¿›è¡Œæœ€ç»ˆæ‰©å®¹ï¼Œæ‰€ä»¥ArrayListæ·»åŠ å…ƒç´ æ—¶æ¯”è¾ƒè€—è´¹æ€§èƒ½ã€‚ elementData = Arrays.copyOf(elementData, newCapacity);&#125; remove ç§»é™¤å…ƒç´ æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435public E remove(int index) &#123; //å¦‚æžœè¶…å‡º åˆ™æŠ›å‡ºIndexOutOfBoundsExceptionå¼‚å¸¸ rangeCheck(index); modCount++; E oldValue = elementData(index); /* æƒ³è¦ç§»é™¤å…ƒç´ åŽé¢å…ƒç´ çš„ä¸ªæ•°*/ int numMoved = size - index - 1; if (numMoved &gt; 0) /* arraycopyæ˜¯ä¸ªnativeæ–¹æ³• ç›¸å½“äºŽæŠŠindex+1ä½ç½®ä¸Šçš„å…ƒç´ æŒªåˆ°indexä½ç½®ä¸Š */ System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; //æ¸…ç©ºå…ƒç´ ï¼Œåˆ©äºŽGC return oldValue;&#125;/* åªä¼šç§»é™¤ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ¡ç›® */public boolean remove(Object o) &#123; if (o == null) &#123; for (int index = 0; index &lt; size; index++) if (elementData[index] == null) &#123; /* è¿™ä¸ªfastRemoveæ–¹æ³•å’Œä¸Šé¢çš„æ–¹æ³•å¤§ç›¸å¾„åº­ */ fastRemove(index); return true; &#125; &#125; else &#123; for (int index = 0; index &lt; size; index++) if (o.equals(elementData[index])) &#123; fastRemove(index); return true; &#125; &#125; return false; &#125; contain æ˜¯å¦åŒ…å« 1234567891011121314151617public boolean contains(Object o) &#123; return indexOf(o) &gt;= 0; &#125;public int indexOf(Object o) &#123; if (o == null) &#123; for (int i = 0; i &lt; size; i++) if (elementData[i]==null) return i; &#125; else &#123; /* å†…éƒ¨å°±æ˜¯forå¾ªçŽ¯ä¸€ä¸ªä¸€ä¸ªåˆ¤æ–­çš„ */ for (int i = 0; i &lt; size; i++) if (o.equals(elementData[i])) return i; &#125; return -1; &#125; get æ–¹æ³• 123456789public E get(int index) &#123; rangeCheck(index); return elementData(index);&#125;/* æœ¬è´¨å°±æ˜¯è¿”å›žæ•°ç»„ä½ç½®çš„å…ƒç´  */E elementData(int index) &#123; return (E) elementData[index]; &#125; æ€»ç»“ æœ‰åºæ€§,å¯é‡å¤æ€§ â€”&gt; å› ä¸ºå†…éƒ¨ä½¿ç”¨æ•°ç»„å®žçŽ°,æ‰€ä»¥å…ƒç´ èƒ½å¤Ÿä¿è¯æœ‰åºæ€§ä¸”èƒ½å¤Ÿæ·»åŠ é‡å¤çš„å…ƒç´  è®¿é—®å¿« â€”&gt; ArrayListå®žçŽ°äº† RandomAccess æŽ¥å£,èƒ½å¤Ÿé€šè¿‡getå®žçŽ°å¿«é€Ÿçš„éšæœºè®¿é—®.å› ä¸ºArrayListå…¶ä¸­å†…éƒ¨å­˜å‚¨æ˜¯ä½¿ç”¨æ•°ç»„å®žçŽ°çš„,å…ƒç´ æ˜¯è¿žç»­çš„,é€šè¿‡ä¸‹æ ‡å°±èƒ½å¤Ÿå¾—åˆ°å¯¹åº”å…ƒç´ ,æ‰€ä»¥æ£€ç´¢ä¼šæ¯”è¾ƒå¿«. æ’å…¥åˆ é™¤æ…¢ â€”&gt; æ’å…¥å’Œç§»é™¤å…ƒç´ æ—¶ï¼Œåœ¨æ‰©å®¹æ—¶,ä½¿ç”¨çš„æ˜¯copyOfæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å°†åŽŸæ•°ç»„å…ƒç´ æ‹·è´åˆ°ç›®æ ‡æ•°ç»„çš„æ–¹å¼,æ•ˆçŽ‡ä½Žä¸‹. éžçº¿ç¨‹å®‰å…¨ â€”&gt; ArrayListæ˜¯éžçº¿ç¨‹å®‰å…¨çš„,Vectoræ˜¯ArrayListçš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬.åœ¨å¤šçº¿ç¨‹æ—¶,å¯ä½¿ç”¨Vectorä»£æ›¿ArrayList. RandomAccess åªæ˜¯ä¸€ä¸ªæ ‡è®°æŽ¥å£,å…¶ä¸­å¹¶æ²¡æœ‰å®žçŽ°æ–¹æ³•,ä»–çš„ä½œç”¨åªæ˜¯ç”¨æ¥æ ‡è®°è¯¥ç»“æž„æ”¯æŒéšæœºè®¿é—®.ä¹Ÿå°±æ˜¯è¯´å®žçŽ°äº†è¿™ä¸ªæŽ¥å£çš„é›†åˆæ˜¯æ”¯æŒ å¿«é€Ÿéšæœºè®¿é—® ç­–ç•¥çš„.ä¸¾ä¾‹æ¥è®²å°±æ˜¯ ArrayList çš„è®¿é—®æ˜¯éšæœºè®¿é—®,è€Œ LinkedListçš„è®¿é—®åˆ™æ˜¯é¡ºåºè®¿é—®çš„.éšæœºè®¿é—®åœ¨ä½¿ç”¨foriå¾ªçŽ¯æ—¶è¦æ¯”ä½¿ç”¨è¿­ä»£å™¨è®¿é—®å…ƒç´ æ—¶æ•ˆçŽ‡é«˜.]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•´ç†å¹¶å­¦ä¹ stackOverFlowä¸Šçš„çƒ­é—¨å›žç­”]]></title>
    <url>%2F2018%2F07%2F25%2F2018-07-25-stackOverFlow%E4%B8%8A%E7%9A%84%E7%83%AD%E9%97%A8%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[åŸºç¡€JavaçŸ¥è¯†å¹³å¸¸æ²¡äº‹çš„æ—¶å€™ä¼šé€›é€›stackOverFlow,ä¸Šé¢æœ‰å¾ˆå¤šéžå¸¸åŸºç¡€çš„é—®é¢˜ï¼Œå¹¶ä¸”å›žç­”è€…è®²è§£çš„éžå¸¸çš„é€å½»ï¼Œæˆ‘æƒ³é€šè¿‡æ•´ç†ä¸Šé¢çš„çƒ­é—¨å›žç­”æ¥æ¢³ç†ä¸€ä¸‹è‡ªå·±çš„JavaåŸºç¡€çŸ¥è¯†ã€‚ çƒ­é—¨ä»€ä¹ˆæ˜¯NullPointerExpection,å¦‚ä½•åŽ»å°½å¯èƒ½çš„é¿å…å½“ä½ å£°æ˜Žä¸€ä¸ªå¼•ç”¨å˜é‡(å¯¹è±¡)çš„æ—¶å€™ï¼Œå®žé™…ä¸Šæ˜¯åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆã€‚å‚è€ƒå¦‚ä¸‹ä»£ç  12int x ;x = 10 ; åœ¨ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å£°æ˜Žäº†å˜é‡ x ã€‚å› ä¸ºæ˜¯åŽŸå§‹ç±»åž‹ï¼Œç³»ç»Ÿä¼šé»˜è®¤ä»˜ç»™å˜é‡xåˆå§‹å€¼æ˜¯0ã€‚ä½†æ˜¯ç¬¬äºŒè¡Œä½¿ç”¨x=10ï¼Œå°†æ•°å€¼10ä»˜ç»™å˜é‡xï¼Œå®žé™…è¿‡ç¨‹æ˜¯å°†10å†™å…¥å˜é‡xæ‰€æŒ‡å‘çš„å†…å­˜ä½ç½®ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬å£°æ˜Žä¸€ä¸ªå¼•ç”¨ç±»åž‹ï¼Œå¯¹äºŽintæ¥è¯´ä¹Ÿå°±æ˜¯å…¶åŒ…è£…ç±»åž‹ã€‚ä¼šå‡ºçŽ°ä¸ä¸€æ ·çš„æƒ…å½¢ã€‚ 12Integer num;num = new Integer(10); å½“ä½ åˆ›å»ºnumçš„æ—¶å€™ï¼Œç³»ç»Ÿä¸ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªé»˜è®¤å€¼ï¼Œå› ä¸ºä»–å¼•ç”¨å¯¹è±¡ï¼Œç„¶è€Œï¼Œä»–ä¼šåŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆè™½ç„¶å­˜åœ¨ï¼Œä½†æ˜¯ä»–æ²¡æœ‰åˆå§‹å€¼ï¼Œæ‰€ä»¥javaä¼šå°†å˜é‡çš„æŒ‡é’ˆæŒ‡å‘ç©º(null)ã€‚åœ¨ç¬¬äºŒè¡Œä½¿ç”¨newå…³é”®å­—å®žä¾‹åŒ–äº†numï¼Œè¿™æ—¶ï¼Œä¼šå°†å˜é‡numæŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå®žä¾‹å¯¹è±¡ã€‚ åœ¨å½“ç”¨åˆ°è¿™ä¸ªå˜é‡ä¹‹å‰æœªç»™å˜é‡åšå®žä¾‹åŒ–æ—¶ï¼Œä¹Ÿå°±æ˜¯å˜é‡çš„æŒ‡é’ˆè¿˜æŒ‡å‘ç©ºæ—¶ï¼Œè¿è¡ŒåŽä¼šå‡ºçŽ°NullPointerExpection è¿™ä¸ªé—®é¢˜ã€‚ å¯èƒ½è§‰å¾—åœ¨å®žé™…codeingçš„æ—¶å€™ä¸ä¼šå‡ºçŽ°ä¸Šé¢çš„é—®é¢˜ï¼Œä½†æ˜¯å®žé™…ä¸Šï¼Œæ¯ä¸ªæ–¹æ³•çš„å¼•ç”¨å¯¹è±¡å¦‚æžœä¸åˆ¤æ–­ä¼ è¿›æ¥çš„å€¼æ˜¯å¦éžç©ºï¼Œéƒ½å¯èƒ½ä¼šå‡ºçŽ°è¿™ä¸ªé—®é¢˜ é”™è¯¯çš„ç¤ºèŒƒï¼š 12345public void doSomething(SomeObject obj) &#123; //do something to obj&#125;// è°ƒç”¨çš„æ—¶å€™ ä¼ é€’nullå€¼æ—¶,ä¼šå‡ºçŽ°ç©ºæŒ‡é’ˆå¼‚å¸¸doSomething(null); æ­£ç¡®çš„ç¤ºèŒƒï¼š 1234567public void doSomething(SomeObject obj) &#123; if(obj != null) &#123; //do something &#125; else &#123; //do something else &#125;&#125; å°½é‡åœ¨æ¯æ¬¡å¼€å‘çš„è¿‡ç¨‹å½“ä¸­ï¼Œä»”ç»†æ–Ÿé…Œå˜é‡æ˜¯å¦å¯èƒ½ä¸ºç©ºï¼Œå½“å¯èƒ½ä¸ºç©ºæ—¶ä¸€å®šè¦åšè¿™ç§åˆ¤æ–­æ¥é¢„é˜²ç©ºæŒ‡é’ˆã€‚ä¿è¯ä»£ç çš„å¥å£®æ€§ã€‚ å¦‚ä½•æ¯”è¾ƒå­—ç¬¦ä¸²åœ¨å½“ä½¿ç”¨ == æ¯”è¾ƒå­—ç¬¦ä¸²æ˜¯å¯èƒ½ä¼šå‡ºçŽ°bugï¼Œè¿™æ—¶å¯ä»¥ç”¨equalsè§£å†³ã€‚æ‰€ä»¥å¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨ == ä»€ä¹ˆæ—¶å€™ä½¿ç”¨equals ä¸»è¦æœ‰ä¸¤æ–¹é¢çš„å·®å¼‚ï¼š == æ˜¯æ¯”è¾ƒå¯¹è±¡å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£çš„æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æˆ–è€…å˜é‡çš„åœ°å€æ˜¯å¦æ˜¯ç›¸åŒçš„ã€‚è€Œequalsæ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸ç­‰ã€‚ == æ²¡æœ‰éžç©ºçš„åˆ¤æ–­ï¼Œè€Œequalså¦‚æžœæ¯”è¾ƒçš„å¯¹è±¡å¦‚æžœæ˜¯ç©ºåˆ™ä¼šå‡ºçŽ°å¼‚å¸¸ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨equalsçš„æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨å·²çŸ¥çš„éžç©ºå¯¹è±¡.equals(Object) å¦‚ &quot;hello&quot;.equals(x) equalsæ˜¯Objectçš„æ–¹æ³•ï¼Œå¤§éƒ¨åˆ†ç±»ä¸­ä¹Ÿé‡å†™äº†equalsæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨æ¯”è¾ƒå¯¹è±¡çš„æ—¶å€™åº”è¯¥ä½¿ç”¨equals,è€Œå½“æ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»åž‹å¦‚intçš„æ—¶å€™å¯ä»¥ä½¿ç”¨ == Javaæ˜¯ä¼ å€¼è¿˜æ˜¯ä¼ å¼•ç”¨Javaæ˜¯ä¼ å€¼çš„ ã€‚ä½†æ˜¯ï¼Œé€šå¸¸æˆ‘ä»¬å®šä½å€¼çš„æ—¶å€™ç§°ä»–ä¸º â€œå¼•ç”¨â€ ã€‚å…·ä¸€ä¸ªéžå¸¸å…¸åž‹çš„ä¾‹å­ 123456789101112131415public static void main(String[] args) &#123; Dog aDog = new Dog("Max"); // we pass the object to foo foo(aDog); // aDog variable is still pointing to the "Max" dog when foo(...) returns aDog.getName().equals("Max"); // true aDog.getName().equals("Fifi"); // false&#125;public static void foo(Dog d) &#123; d.getName().equals("Max"); // true // change d inside of foo() to point to a new Dog instance "Fifi" d = new Dog("Fifi"); d.getName().equals("Fifi"); // true&#125; è™½ç„¶fooæ–¹æ³•å†…æ”¹å˜äº†ä¼ è¿›æ¥çš„aDogçš„å€¼ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ å€¼ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨å®Œfooæ–¹æ³•ä¹‹åŽå†åŽ»åˆ¤æ–­å˜é‡aDogçš„æ—¶å€™ä»–çš„å¼•ç”¨åˆ°çš„å€¼æ²¡æœ‰å˜ï¼Œå˜çš„åªæ˜¯å½“æ—¶ä¼ è¿›åŽ»çš„å€¼è€Œä¸æ˜¯å˜é‡çš„åº”ç”¨ï¼Œæ‰€ä»¥å¯ä»¥è¯´ï¼Œå¯¹è±¡çš„å¼•ç”¨æ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚å¦‚æžœè¿™æ ·è¿˜æ˜¯è¿·ç³Šçš„è¯ï¼Œè¿˜å¯ä»¥é€†å‘æ¥æƒ³ï¼Œå¦‚æžœæ˜¯ä¼ å¼•ç”¨çš„è¯ï¼Œåœ¨å½“fooæ–¹æ³•æ”¹å˜äº†aDogçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜Žæ”¹å˜äº†aDogæ‰€å¼•ç”¨åˆ°çš„çœŸæ­£çš„è¿™ä¸ªå€¼ã€‚è¿™æ ·æ˜¯ä¸èƒ½æˆç«‹ã€‚ æ‰€ä»¥ä¸ç®¡æ€Žä¹ˆæƒ³ï¼šJavaæ˜¯ä¼ å€¼çš„ï¼ï¼ æ€Žæ ·å¿«é€Ÿæ‰“å°å‡ºarrayæ•°ç»„å†…çš„å€¼å› ä¸ºarrayå¹¶æ²¡æœ‰å®žçŽ°toString()æ–¹æ³•ï¼Œæ‰€ä»¥å½“ä½¿ç”¨array.toString()çš„æ—¶å€™ä¼šæ‰“å°å‡ºç±»ä¼¼ [I@17f052a3 çš„åœ°å€ä¿¡æ¯ï¼Œåœ¨jdk1.5ä¹‹åŽå¯ä»¥ä½¿ç”¨ 1234int[] x = new int[]&#123;1,2,3,4,5&#125;;String arrayString = Arrays.toString(x);System.out.println(arrayString);//ç»“æžœï¼š [1, 2, 3, 4, 5] è¿™æ ·çš„æ–¹å¼å¯ä»¥éžå¸¸æ–¹ä¾¿çš„æ‰“å°å‡ºæ•°ç»„å†…æ‰€æœ‰å…ƒç´ ,åµŒå¥—æ•°ç»„å¯ä»¥ä½¿ç”¨deepToStringæ–¹æ³•ã€‚ 1234System.out.println(Arrays.toString(deepArray));//output: [[Ljava.lang.String;@106d69c, [Ljava.lang.String;@52e922]System.out.println(Arrays.deepToString(deepArray));ç»“æžœï¼š[[John, Mary], [Alice, Bob]]]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashç›¸å…³é—®é¢˜æ€»ç»“]]></title>
    <url>%2F2018%2F07%2F13%2F2018-07-12-bash%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[bashç›¸å…³é—®é¢˜æ€»ç»“ä¸ƒæœˆä¸“é¢˜ - -å…³äºŽbashä¸­çš„ &lt;&lt;&lt; çš„å«ä¹‰åœ¨StackOverflowä¸­æœ‰ä¸ªä¾‹å­éžå¸¸çš„è¯¦ç»†ã€‚ã€‚å…ˆè´´è¿žæŽ¥ What does &lt;&lt;&lt; mean? ä»¥ä¸‹æ˜¯æˆ‘çš„æ¸£ç¿»è¯‘ï¼Œå¯èƒ½ä¼šç¿»è¯‘é”™ã€‚ã€‚ æˆ‘ä»¬å¯ä»¥è¿™æ ·å¯¹å­—ç¬¦ä¸²è¿›è¡Œå¤„ç† 1echo &quot;$string&quot; | command ç„¶è€Œåœ¨bashä¸­ï¼Œè¿™æ ·å†™ï¼ˆä½¿ç”¨ç®¡é“ï¼‰å°±ç›¸å½“äºŽæŠŠå‘½ä»¤åˆ†åˆ°å­shellä¸­è¿›è¡Œå¤„ç†ï¼Œè€ƒè™‘è¿™ç§æƒ…å†µ 12echo &quot;hello world&quot; | read first secondecho $second $first å®ƒä¼šè¾“å‡ºä¸€ä¸ªç©ºè¡Œï¼Œå­shellæˆåŠŸçš„è¯»åˆ°äº†ä¸¤ä¸ªå˜é‡ï¼Œä½†æ˜¯éšåŽå­shellé€€å‡ºï¼Œä¸¤ä¸ªå˜é‡å°±æ¶ˆå¤±æŽ‰äº†ã€‚æ‰€ä»¥è¾“å‡ºæ˜¯æ²¡æœ‰ç»“æžœçš„ã€‚åº”å½“è¿™æ ·å†™ 1234echo &quot;hello world&quot; | &#123; read first second echo $second $first&#125; ä½†æ˜¯è¿™æ ·è¿˜æ˜¯æ²¡æœ‰è§£å†³è¿™ç§åˆ†æˆå­shellåŽ»æ‰§è¡Œçš„å°´å°¬ã€‚è¿™æ—¶å€™å°±èƒ½å¤Ÿä½¿ç”¨ &lt;&lt;&lt; äº† 1read first second &lt;&lt;&lt; echo &quot;hello world&quot; å…³äºŽ${!var} varæ˜¯å˜é‡åä½¿ç”¨${!var}çš„ä½œç”¨æ˜¯å½“verä¸å­˜åœ¨çš„æ—¶å€™ä¼šåŽŸæ ·è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯æ˜¾ç¤º${var} å…³äºŽbashä¸­çš„trapå‘½ä»¤çš„ä½¿ç”¨trapå¯ä»¥å¼ºåŒ–bashè„šæœ¬ï¼Œè®©è„šæœ¬æ›´åŠ ç¨³å®šã€‚ trapçš„ä½¿ç”¨æ–¹å¼trapæœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼Œå¯¹åº”è¿™ä¸åŒçš„å¯¹ä¿¡å·çš„å›žåº”æ–¹å¼ã€‚ trap â€somethingâ€œ signal å…¶ä¸­â€somethingâ€œ æ˜¯åœ¨æŽ¥å—signalä¿¡å·ä¹‹åŽä½œå‡ºçš„å‘½ä»¤ trap signal trapä¸æŒ‡å®šä»»ä½•å‘½ä»¤ï¼ŒæŽ¥å—ä¿¡å·çš„é»˜è®¤æ“ä½œï¼Œé»˜è®¤æ“ä½œæ˜¯ç»“æŸè¿›ç¨‹çš„è¿è¡Œ trap â€œâ€ signal trapå‘½ä»¤æŒ‡å®šä¸€ä¸ªç©ºå‘½ä»¤ä¸²ï¼Œå…è®¸å¿½è§†ä¿¡å· å¸¸ç”¨ä¿¡å· HUB(1) æŒ‚èµ·ï¼Œé€šå¸¸å› ç»ˆç«¯æŽ‰çº¿æˆ–ç”¨æˆ·é€€å‡ºè€Œå¼•å‘ INT(2) ä¸­æ–­ï¼Œé€šå¸¸å› æŒ‰ä¸‹Ctrl+Cç»„åˆé”®è€Œå¼•å‘ QUIT(3) é€€å‡ºï¼Œé€šå¸¸å› æŒ‰ä¸‹Ctrl+/ç»„åˆé”®è€Œå¼•å‘ ABRT(6) ä¸­æ­¢ï¼Œé€šå¸¸å› æŸäº›ä¸¥é‡çš„æ‰§è¡Œé”™è¯¯è€Œå¼•å‘ ALRM(14) æŠ¥è­¦ï¼Œé€šå¸¸ç”¨æ¥å¤„ç†è¶…æ—¶ TERM(15) ç»ˆæ­¢ï¼Œé€šå¸¸åœ¨ç³»ç»Ÿå…³æœºæ—¶å‘é€ KILL(9) æ€æ­»è¿›ç¨‹ STOP åœæ­¢è¿›ç¨‹æ‰§è¡Œ æ›´è¿‡çš„ä¿¡å· å¯ä»¥ä½¿ç”¨ trap -l å‘½ä»¤æ¥æŸ¥çœ‹]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IDEA ä¸­çš„å¿«æ·é”®]]></title>
    <url>%2F2018%2F07%2F13%2F2018-07-15-idea%E5%BF%AB%E6%8D%B7%E9%94%AE%2F</url>
    <content type="text"><![CDATA[IDEA ä¸­çš„å¿«æ·é”®ä»¥å‰ç»å¸¸ç”¨ideaå¼€å‘ï¼Œä½†æ˜¯ç«Ÿç„¶æ²¡æœ‰æ€Žä¹ˆä½¿ç”¨åˆ°ideaçš„å¿«æ·é”®ã€‚ã€‚æ²¡æœ‰çœŸæ­£çš„ä½¿ç”¨åˆ°ideaä¸­éžå¸¸é‡è¦çš„ç‰¹æ€§ã€‚ä»Šå¤©æ­£å¥½çœ‹åˆ°äº†æœ‰ä¸€ç¯‡å¾®ä¿¡å…¬ä¼—å·é‡Œæ–‡ç« æ€»ç»“äº†å…³äºŽå¸¸ç”¨çš„ideaå¿«æ·é”®ã€‚é‚è€Œä¹Ÿæƒ³å°å°æ€»ç»“ä¸€ä¸‹ï¼Œå¸Œæœ›åœ¨ä»¥åŽçš„å¼€å‘ä¸­å¤šç”¨å¿«æ·é”®ï¼Œæé«˜å¼€å‘æ•ˆçŽ‡ã€‚ ä»£ç  ctrl+alt+o = ä¼˜åŒ–å¯¼å…¥çš„åŒ… alt+insert = åŠ å…¥ä»£ç  ctrl+alt+T = ç”Ÿæˆtryâ€“catchç»“æž„ alt+å›žè½¦ = å¯¼å…¥åŒ… ctrl+alt+l = æ ¼å¼åŒ–ä»£ç  ctrl+e = æœ€è¿‘æ›´æ”¹çš„ä»£ç  Shift+F6 = é‡æž„-é‡å‘½å åŒ…ã€ç±»ã€æ–¹æ³•ã€å˜é‡ã€ç”šè‡³æ³¨é‡Šç­‰ æœç´¢ ctrl+Shift+backspace =å›žåˆ°ä¸Šæ¬¡ç¼–è¾‘çš„åœ°æ–¹ ctrl+alt+left/right = å›žåˆ°å‰åŽç¼–è¾‘çš„åœ°æ–¹ Shift+Shift åœ¨ç›®å½•ä¸­æŸ¥æ‰¾ç±» ctrl+n æŸ¥æ‰¾ç±» ctrl+Shift+n æŸ¥æ‰¾æ–‡ä»¶ ctrl+e æ‰“å¼€æœ€è¿‘æ–‡ä»¶ ctrl+f æ–‡ä»¶å†…å®¹æŸ¥æ‰¾ ctrl+shift+f å…¨å±€å†…å®¹æŸ¥æ‰¾ ctrl+w å¿«é€Ÿé€‰ä¸­ ctrl+b/ctrl+alt+b å¯¹åº”è¿™å›žæº¯åˆ°çˆ¶ç±»å’Œåˆ°å­ç±»çš„å¿«æ·é”® å¯¹è¡Œçš„åˆ é™¤ï¼Œå¤åˆ¶ï¼Œç²˜è´´æ“ä½œå¯ä»¥ä½¿ç”¨vimæ’ä»¶æ¥å®žçŽ°æœ€åŽvimçš„åå¤§å¿«æ·é”®ï¼ˆcopyçš„ï¼‰Ã˜ Top #10åˆ‡æ¥åˆ‡åŽ»ï¼šCtrl+Tab Ã˜ Top #9é€‰ä½ æ‰€æƒ³ï¼šCtrl+W Ã˜ Top #8ä»£ç ç”Ÿæˆï¼šTemplate/Postfix +Tab Ã˜ Top #7å‘å·æ–½ä»¤ï¼šCtrl+Shift+A Ã˜ Top #6æ— å¤„è—èº«ï¼šShift+Shift Ã˜ Top #5è‡ªåŠ¨å®Œæˆï¼šCtrl+Shift+Enter Ã˜ Top #4åˆ›é€ ä¸‡ç‰©ï¼šAlt+Insert å¤ªéš¾å‰²èˆï¼Œå‰ä¸‰åå¹¶åˆ—å§ï¼ Ã˜ Top #1æ™ºèƒ½è¡¥å…¨ï¼šCtrl+Shift+Space Ã˜ Top #1è‡ªæˆ‘ä¿®å¤ï¼šAlt+Enter Ã˜ Top #1é‡æž„ä¸€åˆ‡ï¼šCtrl+Shift+Alt+T å¦å¤–è¡¥å…… alt+1 projectè§†å›¾ alt+7 ç±»æ–¹æ³•ç»“æž„ alt+home æ˜¾ç¤ºå¯¼èˆªæ  shift+f6 é‡å‘½å ctrl+shift+åŠ å· æŠ˜å ä»£ç  å…³é—­tabé¡µå…¶å®žæ˜¯æœ‰å¿…è¦çš„]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>idea</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆåå…­ï¼‰ bashå­¦ä¹ ç»ˆç« ]]></title>
    <url>%2F2018%2F07%2F08%2F2018-07-06-bash_15_%E7%BB%88%E7%AB%A0%2F</url>
    <content type="text"><![CDATA[bashå­¦ä¹ ç»ˆç« å­¦ä¹ bashæœ‰å¾ˆé•¿æ—¶é—´äº†ï¼Œå¾ˆå¤šæ—¶é—´èŠ±è´¹åœ¨å­¦ä¹ åŸºç¡€è¯­æ³•ä¸Šï¼Œæ²¡æœ‰çœŸæ­£çš„ä¸Šæ‰‹å®žè·µç¼–å†™ä¸€äº›ä½¿ç”¨çš„bashè„šæœ¬ï¼ŒæŽ¥ä¸‹æ¥æˆ‘æŠŠå‰©ä½™çš„æ¯”è¾ƒå¸¸è§çš„bashè¯­æ³•å­¦ä¹ å®Œï¼Œæ‰¾ä¸€äº›githubä¸Šçš„çš„å¤§ç‰›å†™è¿‡çš„bashè„šæœ¬åŽ»å…ˆåˆ†æžï¼Œç„¶åŽè‡ªå·±è¾¹ç†è§£è¾¹å®žè·µå§ï¼Œæˆ‘çš„ç›®æ ‡å°±æ˜¯èƒ½å¤ŸåŸºæœ¬ç†Ÿç»ƒçš„ä½¿ç”¨bashè„šæœ¬ã€‚ bashçš„listç»“æž„è¿™é‡Œæ‰€è¯´åˆ°çš„listç»“æž„ä¸æ˜¯Javaè¯­è¨€ä¸­çš„listç»“æž„ï¼Œè€Œæ˜¯åœ¨åšæ¡ä»¶çš„æ—¶å€™çš„ä¸€ç§é“¾å¼æœºæž„ï¼Œå¯ä»¥ä½¿ç”¨ &amp;&amp; æˆ–è€… || æ¥å¤„ç†å¤šä¸ªå‘½ä»¤çš„æ–¹æ³•ã€‚ å…¶ä¸­åˆ†ä¸ºä¸¤ç§ç®€å•çš„ç»“æž„ å’Œç»“æž„ ï¼ˆand listï¼‰ è¿™ç§ç»“æž„ä¼šåŒæ—¶æ¯”è¾ƒå¤šä¸ªå‘½ä»¤ï¼Œå¦‚æžœå‰ä¸€ä¸ªå‘½ä»¤è¿”å›žtrueï¼Œåˆ™ä¸‹ä¸€ä¸ªå‘½ä»¤ä¸€æ¬¡åŽ»æ‰§è¡Œã€‚ä½†æ˜¯å¦‚æžœå‰ä¸€ä¸ªå‘½ä»¤è¿”å›žfalseï¼Œé‚£ä¹ˆåŽé¢éƒ½ä¸åŽ»æ‰§è¡Œï¼ˆå‘½ä»¤é“¾ç»ˆæ­¢ï¼‰ã€‚ 12# command-1 &amp;&amp; command-2 &amp;&amp; command-3 &amp;&amp; ... command-nif [ ! -z &quot;$1&quot; ] &amp;&amp; echo &quot;Argument #1 = $1&quot; &amp;&amp; [ ! -z &quot;$2&quot; ] &amp;&amp; ä¸Žç»“æž„ ï¼ˆor listï¼‰ è¿™ä¸ªç»“æž„å’Œ and listæ­£å¥½ç›¸åï¼Œå¦‚æžœå‰ä¸€ä¸ªå‘½ä»¤è¿”å›žfalseï¼Œåˆ™ä¸‹ä¸€ä¸ªå‘½ä»¤ä¾æ¬¡åŽ»æ‰§è¡Œã€‚å¦‚æžœå‰ä¸€ä¸ªå‘½ä»¤æ—¶tureï¼Œé‚£ä¹ˆç»ˆæ­¢å‘½ä»¤é“¾ã€‚ 12# command-1 || command-2 || command-3 || ... command-n[ ! -f &quot;$file&quot; ] || (rm -f $file; echo &quot;File \&quot;$file\&quot; deleted.&quot;) bashä¸­çš„æ•°ç»„æ•°ç»„ä¹Ÿæ˜¯éžå¸¸å¸¸è§çš„ä¸€ç§æ•°æ®ç»“æž„ï¼Œé‚£ä¹ˆåœ¨bashä¸­å¦‚ä½•åˆå§‹åŒ–å’Œä½¿ç”¨æ•°ç»„å‘¢ 12345678# ç¬¬ä¸€ç§æ–¹å¼ä¸ºæ•°ç»„èµ‹å€¼area[11]=23area[13]=37area[51]=UFOs# ç¬¬äºŒç§æ–¹å¼area2=( zero one two three four )# ç¬¬ä¸‰ç§æ–¹å¼area3=([17]=seventeen [24]=twenty-four) å¯ä»¥çœ‹åˆ°å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨å°æ‹¬å·è¿›è¡Œæ•°ç»„çš„åˆå§‹åŒ–ï¼Œä»¥åŽä¼šæŽ¥è§¦åˆ°æ›´å¤šå…³äºŽbashæ•°ç»„çš„å®žä¾‹ï¼Œæ¯”å¦‚å†™ä¸€ä¸ªä½¿ç”¨bashçš„å†’æ³¡æŽ’åºã€‚ Linuxä¸­çš„ /devå’Œ /proc /dev æ˜¯è®¾å¤‡æ–‡ä»¶çš„ç›®å½•ï¼Œå¯ä»¥çœ‹å‡ºæ¥devæ—¶deviceè®¾å¤‡çš„ç¼©å†™ã€‚å¦‚æžœæƒ³æŸ¥çœ‹æŸäº›ç‰¹å®šè®¾å¤‡çš„æ–‡ä»¶ï¼Œå¯ä»¥ç›´æŽ¥åŽ»å¯¹åº”çš„ /dev/*çš„ç›®å½•ä¸‹é¢åŽ»æ‰¾å¯¹åº”çš„ç›®å½•å°±è¡Œäº†ã€‚ ä½œä¸ºå‚è€ƒ /dev/hd[a-t]ï¼šIDEè®¾å¤‡ /dev/sd[a-z]ï¼šSCSIè®¾å¤‡ /dev/fd[0-7]ï¼šæ ‡å‡†è½¯é©± /dev/md[0-31]ï¼šè½¯raidè®¾å¤‡ /dev/loop[0-7]ï¼šæœ¬åœ°å›žçŽ¯è®¾å¤‡ /dev/ram[0-15]ï¼šå†…å­˜ /dev/nullï¼šæ— é™æ•°æ®æŽ¥æ”¶è®¾å¤‡ ,ç›¸å½“äºŽå›žæ”¶ç«™ /dev/zeroï¼šæ— é™é›¶èµ„æº /dev/tty[0-63]ï¼šè™šæ‹Ÿç»ˆç«¯ /dev/ttyS[0-3]ï¼šä¸²å£ /dev/lp[0-3]ï¼šå¹¶å£ /dev/consoleï¼šæŽ§åˆ¶å° /dev/fb[0-31]ï¼šframebuffer /dev/cdrom =&gt; /dev/hdc /dev/modem =&gt; /dev/ttyS[0-9] /dev/pilot =&gt; /dev/ttyS[0-9] /proc å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯æ˜¯ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºä»–ä¹‹å­˜å‚¨ä¸€äº›å½“å‰å†…æ ¸çŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ã€‚ä»¥ä¸‹å°±ä¸è¯¦ç»†ä¸¾ä¾‹äº†ï¼Œå¯ä»¥çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ã€‚ä½¿ç”¨ catå‘½ä»¤æˆ–è€…lessä¹‹ç±»çš„æŸ¥çœ‹ã€‚ bashä¸­çš„nullå’Œ0bashä¸­çš„nullå’Œzeroæ˜¯é€šè¿‡è®¾å¤‡èµ„æºæ–‡ä»¶ /dev/null , /dev/zero æ¥å®žçŽ°çš„ null ä½¿ç”¨ dev/null è¿™ä¸ªè®¾å¤‡æ–‡ä»¶æ˜¯ä¸€ä¸ªâ€é»‘æ´žâ€ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåªèƒ½å¤Ÿå†™æ–‡ä»¶ã€‚å†™è¿›åŽ»çš„ä¸œè¥¿éƒ½ä¼šè¢«æ¸…ç©ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ä»Ž /dev/null å†™å…¥åˆ°æ–‡ä»¶æ¥å®žçŽ°æ¸…ç©ºæ–‡ä»¶å†…å®¹çš„ç›®çš„ã€‚ 12cat newfile1 &gt; /dev/null #ä¼šä»€ä¹ˆä¹Ÿä¸è¾“å‡ºcat /dev/null &gt; /var/log/wtmp # æ¸…ç©ºè¯¥æ–‡ä»¶å†…å®¹ zero ä¸ºæŒ‡å®šç›®çš„çš„æ–‡ä»¶æ¥æ¸…é›¶ï¼ˆæŒ‡å®šå¤§å°çš„æ–‡ä»¶ï¼‰ ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨bashå­¦ä¹ ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œå½“ç„¶ä¼šåœ¨ä»¥åŽå†™ä¸€äº›å®žé™…çš„bashè„šæœ¬ã€‚è¿™ä¸ªbashå­¦ä¹ ç³»åˆ—å°±å†™åˆ°è¿™ã€‚]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆåäº”ï¼‰bashä¸­çš„å‡½æ•°å®šä¹‰ä¸Žä½¿ç”¨]]></title>
    <url>%2F2018%2F07%2F03%2F2018-07-03-bash_14_bash%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%2F</url>
    <content type="text"><![CDATA[bashä¸­çš„å‡½æ•°å…¶å®žbashå‡½æ•°å’Œbashè„šæœ¬æ—¶ä¸€æ ·çš„ï¼Œå‡½æ•°çš„ä½¿ç”¨å¦‚åŒä½¿ç”¨ä¸€æ®µbashè„šæœ¬å—ä¸€æ ·ã€‚ä½†æ˜¯å®šä¹‰ä¸ºbashå‡½æ•°æ‰§è¡Œæ›´å¿«ã€‚ å‡½æ•°å®šä¹‰ä¸Žè°ƒç”¨ä¸Žå¾ˆå¤šè„šæœ¬è¯­è¨€ä¸€æ ·ï¼Œä½¿ç”¨ function ä½œä¸ºå…³é”®è¯æ¥å£°æ˜Žå‡½æ•°ã€‚ä¸‹é¢æ¥ä½¿ç”¨ä¸€æ®µä¾‹å­ä»£ç æ¥è¯´æ˜Žå‡½æ•°çš„å®šä¹‰çš„æ ¼å¼ã€‚ä¹ä¸€çœ‹æ˜¯ä¸æ˜¯å’Œjsæœ‰ç‚¹åƒå‘¢ã€‚ã€‚ 12345function hello()&#123;echo &quot;ä½¿ç”¨å‡½æ•°ä¼šè¾“å‡ºè¿™å¥è¯&quot;return 1&#125;hello #ä½¿ç”¨å‡½æ•° å‡½æ•°çš„å‚æ•°ä¼ é€’ä¸Žç¼–å†™bashç›¸ä¼¼ï¼Œå‚æ•°ä½¿ç”¨ $+ä½ç½®çš„å½¢å¼èŽ·å– å¦‚$1èŽ·å–ç´§è·Ÿåœ¨è°ƒç”¨å‡½æ•°åŽçš„ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚ 1234567function hello()&#123;echo &quot;ä½¿ç”¨å‡½æ•°ä¼šè¾“å‡ºè¿™å¥è¯&quot;echo &quot;è¾“å‡ºç¬¬ä¸€ä¸ªå‚æ•° $1&quot;return 1&#125;hello world# è¾“å‡ºç»“æžœ â€˜ è¾“å‡ºç¬¬ä¸€ä¸ªå‚æ•° world â€™ å‡½æ•°çš„è¿”å›žå€¼ä½¿ç”¨returnæ¥è¿”å›žç‰¹å®šå€¼ å¦‚ä¸Šé¢çš„å‡½æ•°ä¸­ä½¿ç”¨åˆ°äº† return 1 ,åœ¨returnåŽå‘ç”Ÿçš„è¯­å¥éƒ½ä¸èƒ½è¢«æ‰§è¡Œã€‚å¹¶ä¸”returnçš„çš„å€¼åªèƒ½åœ¨1~256ä¹‹é—´çš„æ•°ã€‚ä½¿ç”¨$?æ¥èŽ·å–è¿”å›žåˆ°å€¼ã€‚ å‡½æ•°çš„åµŒå¥—å¦‚åŒåœ¨Java jsä¸­ä½¿ç”¨å‡½æ•°ç±»ä¼¼ï¼Œbashä¸­çš„å‡½æ•°ä¹Ÿå…è®¸ä½¿ç”¨åµŒå¥—ç»“æž„ã€‚ä½†æ˜¯éœ€è¦åœ¨å¤–å±‚å‡½æ•°è°ƒç”¨å†…å®¹å‡½æ•°ã€‚è¿™æ˜¯å½“ç„¶çš„äº†ï¼Œå› ä¸ºåœ¨å†…éƒ¨å£°æ˜Žå‡½æ•°ï¼Œå´æ²¡æœ‰è°ƒç”¨ï¼Œè¿™å½“ç„¶æ—¶ä¸èµ·ä½œç”¨çš„äº†ã€‚ 1234567891011function x1()&#123; echo &quot;åœ¨å‡½æ•°x1ä¸­ï¼&quot; function x2()&#123; echo &quot;åœ¨å‡½æ•°x2ä¸­ï¼&quot; &#125; x2 # è¿™é‡Œéœ€è¦è°ƒç”¨å†…å±‚å‡½æ•°&#125;x1#ç»“æžœï¼š#åœ¨å‡½æ•°x1ä¸­ï¼#åœ¨å‡½æ•°x2ä¸­ï¼]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆåå››ï¼‰linuxä¸­çš„IO]]></title>
    <url>%2F2018%2F07%2F01%2F2018-07-01-bash_13_bash%E4%B8%AD%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%2F</url>
    <content type="text"><![CDATA[linuxä¸­çš„IOåˆ†ç±»linuxä¸­æ€»æœ‰ä¸‰ç§æ–‡ä»¶ï¼Œä¸€ç§æ—¶stdinï¼ˆæ ‡å‡†è¾“å…¥ï¼‰ï¼Œstdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ï¼Œstderrï¼ˆæ ‡å‡†é”™è¯¯ï¼‰ï¼Œå¯ä»¥é‡å®šå‘è¿™äº›å’Œå…¶ä»–ä»»æ„æ–‡ä»¶ï¼Œé‡å®šå‘çš„ç›®çš„å°±æ˜¯å¯ä»¥å°†æ–‡ä»¶ä¸­çš„ä»»æ„å†…å®¹ä½œä¸ºè¾“å‡ºæˆ–è€…è¾“å‡ºæºã€‚ æ­£æ–‡ç³»ç»Ÿä¸ºæ¯ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶åˆ†é…ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆFDï¼‰ï¼Œä¸ºæ ‡å‡†è¾“å…¥stdinï¼Œæ ‡å‡†è¾“å‡ºstdout,æ ‡å‡†é”™è¯¯stderråˆ†åˆ«åˆ†é…ç»™0ï¼Œ1ï¼Œ2 ç®€å•è¾“å…¥è¾“å‡ºï¼š 12345echo &quot;helloworld&quot; &gt; newfile1echo &quot;helloworld&quot; 1 &gt; newfile1 #ç­‰åŒäºŽç¬¬ä¸€å¥echo &quot;helloworld&quot; 1 &gt;&gt; newfile1 #è¿½åŠ å†…å®¹command &lt; newfile1 #æ ‡å‡†è¾“å…¥ åŒç†ç­‰åŒäºŽcat 0 &lt; newfile1 ä½¿ç”¨æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡º 123ls 2&gt; newfile #å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°newfileä¸­ls &gt; newfile 2&gt;1&amp; #å°†æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡ºä¸€èµ·è¾“å‡ºåˆ°newfileä¸­# å…¶ä¸­&amp;è¡¨ç¤ºå’Œçš„å…³ç³» ç»‘å®šé‡å®šå‘ 12345ls &gt;&amp; m #æŠŠæ ‡å‡†è¾“å‡ºåˆ°æ–‡ä»¶æè¿°ç¬¦mä¸­ls &lt; &amp;- #å…³é—­æ ‡å‡†è¾“å…¥n &lt; &amp;- #å…³é—­è¾“å…¥æ–‡ä»¶æè¿°ç¬¦nn &gt; &amp;- #å…³é—­è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦n1&gt;&amp;-, &gt;&amp;- # å…³é—­æ ‡å‡†è¾“å‡º å…¶å®žåœ¨linux ä¸‹ä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ã€‚æŠŠæ‰€æœ‰éƒ½æƒ³æˆæ–‡ä»¶å°±å¥½ç†è§£çš„å¤šäº†ã€‚]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆåä¸€ï¼‰å‘½ä»¤ç¯‡ï¼ˆ2ï¼‰]]></title>
    <url>%2F2018%2F06%2F24%2F2018-06-24-bash_10_bash%E5%91%BD%E4%BB%A4%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[bashå‘½ä»¤ä»¤ç¯‡ï¼ˆäºŒï¼‰åŸºæœ¬å‘½ä»¤åŸºæœ¬å‘½ä»¤å°±æ˜¯éžå¸¸éœ€è¦åˆå­¦è€…æŽŒæ¡çš„é‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œåªæœ‰æŽŒæ¡è¿™ç§åŸºæœ¬çš„å‘½ä»¤æ‰èƒ½ç¨å¾®ç†Ÿç»ƒçš„æ“ä½œlinuxã€‚å…·ä½“çš„åŸºæœ¬å‘½ä»¤ä¹Ÿä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œå¯¹äºŽè¿™ç§åŸºæœ¬å‘½ä»¤ç”¨å‡ éå°±èƒ½å¤ŸæŽŒæ¡äº†ã€‚è€Œä¸”ç½‘ä¸Šçš„æ•™ç¨‹ä¸€å¤§å †ã€‚ æ—¶é—´æ—¥æœŸå‘½ä»¤ date: æ‰“å°æˆ–è€…æ˜¯è®¾ç½®æœ¬åœ°æ—¶é—´ã€‚ä¸»è¦è¯­æ³•å¯ä»¥ man date ä¸»è¦æœ‰date -u æ‰“å° UTCæ—¶é—´ã€‚åœ¨åŽé¢å¯ä»¥ä½¿ç”¨ +å‚æ•°çš„å½¢å¼æ ¼å¼åŒ–ä¸ºå…·ä½“çš„æ—¶é—´æ ¼å¼ã€‚ zdump: è¾“å‡ºç‰¹æ®Šæ—¶åŒºçš„æ—¶é—´ã€‚å¦‚ zdump EMP timeï¼š è¾“å‡ºè¯¦ç»†çš„æ—¶é—´ä¿¡æ¯æ¯”å¦‚ time ls -l at: atå‘½ä»¤ä¸€èˆ¬ä½¿ç”¨åœ¨ç‰¹å®šæ—¶é—´æ‰§è¡Œçš„æ—¶å€™ã€‚ batchï¼šbatchå‘½ä»¤å’Œatå‘½ä»¤ç›¸ä¼¼ã€‚ä¸åŒåœ¨äºŽbatchå‘½ä»¤èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šæ¡å‘½ä»¤ã€‚ calï¼šcalå‘½ä»¤å¯ä»¥æ•´æ´çš„æ‰“å°å‡ºæ¥æ—¥åŽ† sleepï¼šsleepå¯ä»¥ä½¿shellæš‚åœå›ºå®šæ—¶é—´é•¿åº¦ hwclockï¼šè®¿é—®ç¡¬ä»¶ç³»ç»Ÿæ—¶é—´ã€‚éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚ æ–‡æœ¬å’Œæ–‡ä»¶å¤„ç†å‘½ä»¤ sortï¼šæ–‡ä»¶æŽ’åºçš„å®žç”¨æ€§å·¥å…·ï¼ŒåŒæ—¶å‡ºçŽ°åœ¨ç®¡é“å½“ä¸­ï¼Œå¯ä»¥ä½¿ç”¨-mé€‰é¡¹åˆå¹¶é¢„åˆ†ç±»çš„è¾“å…¥æ–‡ä»¶ã€‚ uniqï¼šä½¿ç”¨uniqå‘½ä»¤èƒ½å¤ŸåŽ»é™¤é‡å¤çš„è¡Œï¼Œé€šå¸¸å’Œsortä½¿ç”¨åœ¨ç®¡é“å½“ä¸­ã€‚ 1234$ cat list_1.txt|uniq -c|sort -nr 5 this is the second line 3 this is the first line 1 this is the third line expand:å¯ä»¥å°†tabè½¬æ¢æˆæ™®é€šç©ºæ ¼ï¼Œunexpandå¯ä»¥å°†ç©ºæ ¼è½¬æ¢æˆtabï¼ŒåŒæ ·æ¯”è¾ƒå¸¸è§åœ¨ç®¡é“å‘½ä»¤å½“ä¸­ã€‚ cutï¼šä»Žæ–‡ä»¶ä¸­æå–å­—æ®µçš„å·¥å…· 1$ cut -d &apos; &apos; -f 1,2 list_1.txt paste:åˆå¹¶ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæ˜¯æ¯è¡Œéƒ½å¯¹åº”åˆå¹¶ã€‚è€Œä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶åˆå¹¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶çš„ä¸‹é¢ã€‚ joinï¼šå’Œpasteå‘½ä»¤ç›¸ä¼¼ï¼Œä½†æ˜¯joinå‘½ä»¤åªç²˜è´´ä¸¤æ–‡ä»¶æœ‰å…±åŒæ ‡è®°çš„è¡Œï¼Œä¸€èˆ¬è¿™ä¸ªæ ‡è®°æ˜¯æ•°å­—ã€‚ headï¼šè¾“å‡ºæ–‡ä»¶çš„å‰10è¡Œï¼Œä¹Ÿå¯ä»¥æ›´æ”¹è¾“å‡ºçš„è¡Œæ•°ã€‚ tailï¼šè¾“å‡ºæ–‡ä»¶çš„æœ«å°¾10è¡Œï¼ŒåŒæ ·çš„å¯ä»¥æ›´æ”¹è¾“å‡ºçš„è¡Œæ•°ã€‚ grepï¼šæ­£åˆ™åŒ¹é…å‡ºæ–‡ä»¶çš„å†…å®¹ï¼Œä¸€èˆ¬ä½¿ç”¨åœ¨ç®¡é“ä¸­ï¼Œç”¨æ¥åŒ¹é…ä¸Šä¸€ä¸ªè¾“å…¥æˆ–è€…æ–‡ä»¶çš„åŒ¹é…åˆ°çš„å†…å®¹ 123$ cat list_1.txt| grep &quot;third&quot; this is the third line ^ è¿™é‡Œçš„thirdæ˜¯çº¢è‰²çš„è¡¨ç¤ºåŒ¹é…åˆ°çš„å†…å®¹ wcï¼šè¾“å‡ºæ–‡ä»¶çš„è¡Œæ•°å­—æ•°ç­‰ä¿¡æ¯ 123$ wc /usr/share/doc/sed-4.1.2/README13 70 447 README[13 lines 70 words 447 characters] tr å­—ç¬¦ç¿»è¯‘çš„è¿‡æ»¤å™¨ï¼Œå°†ç‰¹å®šå­—ç¬¦æ›¿æ¢æˆå…¶ä»–å­—ç¬¦ 1234$ tr &quot;is&quot; &quot;*&quot; &lt; list_1.txt th** ** the f*r*t l*neth** ** the *econd l*neth** ** the th*rd l*ne nl nlå’Œcat -bæœ‰ç€ç›¸ä¼¼çš„æ„ä¹‰ï¼Œéƒ½èƒ½å¤Ÿè¿žåŒè¡Œå·æ‰“å°å‡ºæ¥ï¼Œä¸åŒçš„æ˜¯ï¼Œnlå¯ä»¥å°†ç©ºè¡ŒåŽ»é™¤æŽ‰ã€‚ iconv è¿™ä¸ªå‘½ä»¤èƒ½å¤Ÿå°†æ–‡ä»¶è½¬æ¢ç¼–ç ï¼Œå¦‚utf-8è½¬æ¢æˆutf-16è¿™ç±»çš„è½¬åŒ–ã€‚ è¿™ç±»å‘½ä»¤çœŸçš„å¾ˆå¤šï¼Œéœ€è¦ç§¯ç´¯çš„ä¸œè¥¿ä¹Ÿå¾ˆå¤šï¼Œæˆ‘åœ¨è¿™é‡Œå°±åšä¸ªç®€å•çš„è¯´æ˜Žï¼Œå…·ä½“çš„ä½¿ç”¨å¯ä»¥ man å‘½ä»¤ æŸ¥çœ‹å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ã€‚ä¹Ÿæ˜¯å­¦ä¹ çš„ä¸€ç§æ–¹å¼ï¼ï¼]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆåäºŒï¼‰å‘½ä»¤ç¯‡ï¼ˆ3ï¼‰]]></title>
    <url>%2F2018%2F06%2F24%2F2018-06-27-bash_11_bash%E5%91%BD%E4%BB%A4%E7%AF%87%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[bashå‘½ä»¤ç¯‡ï¼ˆä¸‰ï¼‰bashä¸­çš„å…³äºŽé€šä¿¡çš„å‘½ä»¤ host é€šè¿‡ipæˆ–è€…åŸŸåæœç´¢äº’è”ç½‘çš„ä¸»æœºåœ°å€ï¼ˆä½¿ç”¨DNSï¼‰ 12345$ host www.baidu.comwww.baidu.com has address 61.135.169.125www.baidu.com has address 61.135.169.121www.baidu.com is an alias for www.a.shifen.com.www.baidu.com is an alias for www.a.shifen.com. nslookup å‘ä¸Šå¯»æ‰¾name server 123456789101112$ nslookup -sil 66.97.104.180 Server: 127.0.1.1Address: 127.0.1.1#53Non-authoritative answer:180.104.97.66.in-addr.arpa name = 66-97-104-180.dynamic.bugtusselwireless.com.Authoritative answers can be found from:104.97.66.in-addr.arpa nameserver = ns2.bugnet.net.104.97.66.in-addr.arpa nameserver = ns1.bugnet.net.ns1.bugnet.net internet address = 204.11.133.241ns2.bugnet.net internet address = 204.11.133.244 ping ç†ŸçŸ¥çš„pingå‘½ä»¤ï¼Œå¸¸ç”¨æ¥æŽ¢æµ‹ä¸Žå¦ä¸€ä¸ªä¸»æœºæ˜¯å¦æœ‰ç½‘ç»œé“¾æŽ¥ ftp ä»Žè¿œç¨‹ä¸»æœºä¸‹è½½æˆ–è€…ä¸Šä¼ ç»™è¿œç¨‹ä¸»æœºçš„åè®®ã€‚ telnt é“¾æŽ¥è¿œç¨‹ä¸»æœºçš„åè®® wget ä½¿ç”¨éžäº¤äº’å¼çš„ä»Žç½‘ç«™webæˆ–è€…ftpç«™ç‚¹ä¸‹è½½æ–‡ä»¶ã€‚ rcp è¿œç¨‹æ‹·è´ï¼Œåœ¨ä¸¤å°ä¸åŒçš„æœºå™¨é—´æ‹·è´ã€‚ ssh secure shell ä»–ä»£æ›¿äº†telnt rcpç­‰å‘½ä»¤ã€‚ scp secure cp ä»–ç”¨æ¥ä»£æ›¿rcpå‘½ä»¤ï¼Œéœ€è¦ç™»å½•æŽˆæƒçš„è¿œç¨‹æ‹·è´æ–‡ä»¶çš„å‘½ä»¤ã€‚ è¿™é‡Œåªæ˜¯ç®€ç•¥çš„è°ˆè°ˆå¸¸è§çš„å…³äºŽæœºå™¨äº¤äº’çš„å‘½ä»¤ï¼Œè¿™äº›éƒ½æ˜¯ç†Ÿèƒ½ç”Ÿå·§çš„ä¸œè¥¿ï¼Œæœ€é‡è¦çš„æ˜¯è¦ä¸Šæ‰‹ç»ƒä¹ ã€‚ æ•°å­¦è¿ç®—ç¬¦ dcï¼šdcæ˜¯ä½¿ç”¨é€†æ³¢å…°è¡¨ç¤ºæ³•è¿›è¡Œè®¡ç®—ï¼Œå¦‚ 11 + ï¼Œ3 6 * bcï¼šbcæ˜¯çŽ°ä»£linuxä¸‹æ¯”è¾ƒå¸¸è§å¤„ç†å¤æ‚è¿ç®—çš„å‘½ä»¤é‚£ä¸ªï¼Œå¯ä»¥è®¡ç®—æµ®ç‚¹æ•°ã€‚ 1234567891011$bc -l -q4/3 /*æœªæŒ‡å®šç²¾åº¦é»˜è®¤ä¿ç•™æ•´æ•°*/scale=5 /*æŒ‡å®šç²¾åº¦ä¸º5*/4/31.33333ibase=2 /*æŒ‡å®šè¿›åˆ¶è½¬æ¢çš„è¾“å…¥æœºåˆ¶ä¸ºäºŒè¿›åˆ¶ï¼Œè¾“å‡ºé»˜è®¤ä¸ºæ˜¯åè¿›åˆ¶*/104^2 /*æŒ‡æ•°è¿ç®—ï¼Œæ³¨ï¼šæŒ‡æ•°ä¸èƒ½ä¸ºæµ®ç‚¹æ•°*/4*a(1) /*è®¡ç®—Ï€å€¼ï¼Œa()æ˜¯ä¸ªå‡½æ•°ï¼šarctan()ï¼Œå¥½å§ï¼Œè€å¸ˆæ•™çš„éƒ½è¢«ç‹—åƒäº†ï¼ŒÏ€å€¼æ˜¯ç­‰äºŽå››å€çš„arctan(1)ä¹ˆï¼Ÿ*/3.14159265358979323844quit /*é€€å‡º*/ let: è¡¨è¾¾å¼å¯ä»¥åº”ç”¨åœ¨letå‘½ä»¤å½“ä¸­ã€‚ å…¶å®žåœ¨æˆ‘ä½¿ç”¨linuxç³»ç»Ÿçš„å‡ å¹´é‡Œï¼Œæ„Ÿè§‰å‘½ä»¤ä¸èƒ½æ­»è®°ç¡¬èƒŒï¼Œå¤šç”¨è‡ªç„¶å°±ä¼šæŽŒæ¡äº†ã€‚ä½†æ˜¯æœ‰äº›æ¯”è¾ƒå†·é—¨çš„å‘½ä»¤è¿˜æ˜¯èƒŒä¸‹æ¥æ¯”è¾ƒå¥½ - -ã€‚]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆåä¸‰ï¼‰å‘½ä»¤ç¯‡ï¼ˆ4ï¼‰]]></title>
    <url>%2F2018%2F06%2F24%2F2018-06-28-bash_12_bash%E7%AE%A1%E7%90%86%E5%91%98%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[ç³»ç»Ÿå‘½ä»¤linuxä¸Šæä¾›éžå¸¸å¤šçš„æœ‰å…³äºŽç³»ç»Ÿçš„å‘½ä»¤ï¼Œæˆ‘åªèƒ½æŒ‘å‡ºæˆ‘æ¯”è¾ƒå¸¸è§çš„å‘½ä»¤æ¥è®°å½•ä¸‹æ¥ã€‚ ç”¨æˆ·ä¸Žç”¨æˆ·ç»„ users æ˜¾ç¤ºæ‰€æœ‰ç™»å½•ç”¨æˆ· groups åˆ—å‡ºå½“å‰ç”¨æˆ·å’Œä»–æ‰€åœ¨çš„ç”¨æˆ·ç»„ 12$ groupsnanyin adm cdrom sudo dip plugdev input lpadmin sambashare chown å‘½ä»¤å¯ä»¥æ”¹å˜æ–‡ä»¶æ‰€å±žçš„ç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„ã€‚ä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ç»™ç”¨æˆ·æŸäº›æ–‡ä»¶çš„æƒé™ã€‚ chgrp å‘½ä»¤å¯ä»¥æ”¹å˜ç”¨æˆ·æ‰€å±žç»„ã€‚ useradd å¯ä»¥ä¸ºç³»ç»Ÿæ·»åŠ ä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºè¯¥ç”¨æˆ·çš„homeæ–‡ä»¶å¤¹ã€‚åˆ é™¤ç”¨æˆ·å¯ä»¥ä½¿ç”¨userdelå‘½ä»¤è¿›è¡Œåˆ é™¤ã€‚ usermod å‘½ä»¤å¯ä»¥æ”¹å˜ç”¨æˆ·å±žæ€§ï¼Œå¯ä»¥æ˜¯å¯†ç ä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·ç»„ä¹‹ç±»çš„ id å‘½ä»¤å¯ä»¥æ‰“å°å‡ºç”¨æˆ·åŠæ‰€åœ¨ç”¨æˆ·ç»„çš„ç”¨æˆ·åå’Œç»„åä»¥åŠå¯¹åº”çš„idå€¼ whoami æ‰“å°å‡ºå½“å‰ç”¨æˆ·çš„ç”¨æˆ·åç§° passwd è®¾ç½®ï¼Œæ›´æ”¹å’Œç®¡ç†ç”¨æˆ·çš„å¯†ç  åŸºæœ¬ä¿¡æ¯å’ŒçŠ¶æ€ uname å¯ä»¥è¾“å‡ºç³»ç»Ÿçš„å…·ä½“å‚æ•°å¦‚å†…æ ¸ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ arch å¯ä»¥è¾“å‡ºç³»ç»ŸåŸºäºŽå¤šå°‘ä½ nc ï¼ˆnetcatï¼‰æ˜¯ç”¨äºŽè¿žæŽ¥å’Œä¾¦å¬TCPå’ŒUDPç«¯å£çš„å®Œæ•´å·¥å…·åŒ…ã€‚ lsdev è¾“å‡ºè®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯ç¡¬ä»¶ä¿¡æ¯ df æ ¼å¼åŒ–è¾“å‡ºæ–‡ä»¶ç³»ç»Ÿå ç”¨æ¯” ä¸€èˆ¬ä½¿ç”¨df -h stat è¾“å‡ºæ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ã€‚ ç³»ç»Ÿå·¥ä½œæµ ps æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ é€šå¸¸åŽé¢åŠ  ax æˆ–è€… aux ä½¿ç”¨ã€‚ pstree ä»¥æ ‘å½¢ç»“æž„å±•ç¤ºè¿›ç¨‹ä¿¡æ¯ã€‚ top è¾“å‡ºcpuçš„ä¿¡æ¯ä½¿ç”¨ -bå‚æ•°ä»¥textçš„å½¢å¼è¾“å‡ºã€‚èƒ½å¤Ÿä»¥é™æ€çš„æ–¹å¼æŸ¥çœ‹ã€‚ niceç”¨äºŽæŒ‡å®šè¿›ç¨‹è°ƒèŠ‚ä¼˜å…ˆçº§çš„å‘½ä»¤ã€‚ pidof å¯ä»¥è¾“å‡ºå…·ä½“è¿›ç¨‹çš„id å¦‚ï¼špidof xclock ä¼šè¾“å‡º xclockçš„è¿›ç¨‹idå·ã€‚ ç½‘ç»œ nmap ç½‘ç»œæ˜ å°„å’Œç«¯å£æ‰«æï¼ˆçŽ°åœ¨åªè®°å¾—å¤§å­¦æ—¶ç½‘ç»œæ”»é˜²é‡Œç”¨è¿‡windowsé‡Œæœ‰ä¸ªå·¥å…·å«nmapä»€ä¹ˆçš„ã€‚ã€‚ï¼‰å‚æ•°æœ‰å¾ˆå¤šã€‚ã€‚ ifconfig æœ€ç†Ÿçš„æŸ¥çœ‹ç½‘ç»œæŽ¥å£è®¾ç½®ã€‚ netstat è¾“å‡ºç½‘ç»œçŠ¶æ€å’Œä¿¡æ¯ï¼Œå¦‚è·¯ç”±è¡¨å’Œè¿žæŽ¥çŠ¶æ€ç­‰ã€‚ ip å¯ä»¥æŸ¥è¯¢å’Œè®¾ç½®ipå’Œè®¿é—®ç½‘å¡è®¾åˆ«ä¿¡æ¯ æ–‡ä»¶ç³»ç»Ÿ mount æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ umount å¸è½½è®¾å¤‡ sync å¼ºåˆ¶ç«‹å³ä»Žç¼“å†²åŒºå†™å…¥æ•°æ®ä»¥æ¥è¾¾åˆ°ç«‹å³æ›´æ–°æ•°æ®çš„ç›®çš„ã€‚ mkswap swapon swapoff åˆ†åˆ«å¯¹åº”æ ¼å¼åŒ–ä¸ºäº¤æ¢åˆ†åŒºï¼Œå¯åŠ¨äº¤æ¢åˆ†åŒºï¼Œå…³é—­äº¤æ¢åˆ†åŒºã€‚ fdisk åˆ›å»ºæˆ–æ›´æ”¹åˆ†åŒºè¡¨ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥åˆ†åŒºçš„å·¥å…·ã€‚éžå¸¸å¸¸è§ã€‚å½“æ—¶æˆ‘è¿˜æ˜¯é€‰æ‹©cfdisk lspci è¾“å‡ºæ€»çº¿ä¿¡æ¯ï¼Œå’Œè¿žæŽ¥æ€»çº¿çš„è®¾å¤‡ä¿¡æ¯ã€‚ å…¶å®žè¿˜æœ‰å¾ˆå¤šå‘½ä»¤æ²¡æœ‰æ¶‰åŠåˆ°ï¼Œå¦‚æžœæƒ³ç»ƒä¹ è¿™äº›åŸºæœ¬çš„ç³»ç»Ÿå‘½ä»¤çš„è¯ï¼Œå¯ä»¥è·Ÿç€arch wiki è£…ä¸€éarchï¼Œè£…å®ŒåŽè¿™é‡Œçš„å‘½ä»¤å°±éƒ½èƒ½è®°ä½äº†ã€‚]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽElementryOSå›¾å½¢ç•Œé¢æŒ‚èµ·ä¹‹åŽå”¤é†’åŽå‡ºçŽ°é»‘å±é—®é¢˜]]></title>
    <url>%2F2018%2F06%2F23%2F2018-06-23-%E5%85%B3%E4%BA%8EelementryOS%E6%8C%82%E8%B5%B7%E4%B9%8B%E5%90%8E%E5%94%A4%E9%86%92%E6%97%B6%E9%BB%91%E5%B1%8F%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[å…³äºŽElementryOSå›¾å½¢ç•Œé¢æŒ‚èµ·ä¹‹åŽå”¤é†’åŽå‡ºçŽ°é»‘å±é—®é¢˜è¿™ä¸¤å¤©åœ¨ElementryOsä¸Šè¸©åˆ°äº†å‘ï¼Œä¸ºäº†ä»¥åŽå°‘è¸©ç‚¹è¿™ç§å‘ï¼Œæ‰“ç®—ä»¥åŽå°†è¿™ç§å°é—®é¢˜ä¹Ÿå†™ä¸‹æ¥ã€‚ å¦‚ä½•è§£å†³ï¼šå®‰è£… xserver-xorg åœ¨ElementryOSçš„ç»ˆç«¯ä¸­ä½¿ç”¨ $ sudo apt-get install xserver-xorg æˆ‘ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥è§£å†³é—®é¢˜ è§£å†³æ—¶é—´ï¼š2018-6-23 ç‰ˆæœ¬ï¼šElementryOS Loki 0.4]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆåï¼‰å‘½ä»¤ç¯‡ï¼ˆ1ï¼‰]]></title>
    <url>%2F2018%2F06%2F19%2F2018-06-19-bash_09-bash%E5%91%BD%E4%BB%A4%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Bashä¸­çš„å‘½ä»¤å†…å»ºå‘½ä»¤å†…å»ºå‘½ä»¤æ˜¯bashå·¥å…·é›†ä¸­è‡ªå¸¦çš„å‘½ä»¤ï¼Œå¥½å¤„æ˜¯æ‰§è¡Œé€Ÿåº¦æ¯”å¤–éƒ¨å‘½ä»¤è¦å¿«ï¼Œå› ä¸ºå†…å»ºå‘½ä»¤ä¸€èˆ¬ç›´æŽ¥æ‰§è¡Œå‘½ä»¤ï¼Œè€Œå¤–éƒ¨å‘½ä»¤ä¸€èˆ¬è¦åˆ†æ”¯å‡ºä¸€ä¸ªå­è¿›ç¨‹ã€‚ I/Oæ“ä½œ echo å½“ç„¶æ˜¯æœ€ç†Ÿæ‚‰çš„echoå‘½ä»¤è¿›è¡Œè¾“å‡ºäº†ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ä½¿ç”¨ echo `command ` çš„æ—¶å€™echoä¼šé»˜è®¤å°†å–æ¶ˆè¾“å‡ºçš„æ‰€æœ‰æ¢è¡Œã€‚ å†å½“ä½¿ç”¨ echo â€œ`command`â€œçš„æ—¶å€™å¯ä»¥é¿å…æ¢è¡Œç¬¦çš„ç¼ºå¤±ã€‚ 12345echo &quot;`ll`&quot;total 12Kdrwxr-xr-x 2 nanyin nanyin 4.0K Jun 19 21:18 bashdrwxr-xr-x 3 nanyin nanyin 4.0K Jun 18 21:16 git-rw-r--r-- 1 nanyin nanyin 1.1K Jun 19 21:31 æ€»ç»“.txt printf åœ¨Cä¸­ä½¿ç”¨çš„printf èƒ½å¤Ÿæ ¼å¼åŒ–è¾“å‡ºå†…å®¹ã€‚ 12345# åŸºæœ¬ä½¿ç”¨printf format-string... parameter...# ä¾‹å­declare -r PI=3.1415926535printf &quot;pi to 2 decimal is %1.2f&quot; $PI # pi to 2 decimal is 3.14% read è¯»å–å‚æ•°çš„å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤è¯»å–è¾“å…¥å‚æ•°ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨è¾“å…¥readæ•°æ®æœŸé—´è¾“å…¥\ä¼šæŠ‘åˆ¶æ¢è¡Œç¬¦ã€‚ -ré€‰é¡¹ä¼šå¯¼è‡´è¾“å…¥çš„\è¢«å­—é¢è§£é‡Šã€‚åŒæ ·readå‘½ä»¤æœ‰å¾ˆå¤šå‚æ•°å¯ä»¥ä½¿ç”¨ 123echo &quot;please input a value:&quot;read var1echo &quot;input var1 is $var1&quot; å½“read åŽé¢ä¸è·Ÿä»»ä½•å€¼çš„è¯ä»–é»˜è®¤ç»™ $REPLY èµ‹å€¼ï¼Œä¹‹åŽå¯ä»¥å–è¿™ä¸ªå€¼ä½œä¸ºreadè¿›æ¥çš„å€¼ã€‚ åœ¨å½“è¾“å…¥å†…å®¹åŽé¢åŠ ä¸Š / çš„è¯ä¼šèµ·åˆ°è¾“å…¥æ—¶å€™çš„æ¢è¡Œçš„ä½œç”¨ï¼Œè€Œä½¿ç”¨ -r å‚æ•°ä¼šå°† /æŒ‰ç…§åŽŸæ ·è¾“å‡ºå‡ºæ¥ 123456echo &quot;input var1 is $var1&quot;echo &quot;Enter a string terminated by a \\, then press &lt;ENTER&gt;.&quot;echo &quot;Then, enter a second string (no \\ this time), and again press &lt;ENTER&gt;.&quot;readecho &quot;the default value is $REPLY&quot;# å½“readåŽé¢ä¸å†™å…·ä½“å€¼çš„æ—¶å€™ä¼šæŠŠå€¼ä»˜ç»™ REPLY readæœ‰å¾ˆå¤šæœ‰ç”¨çš„å‚æ•°å¯ä»¥è°ƒç”¨ï¼Œå®žçŽ°å¤æ‚çš„è¾“å…¥åŠŸèƒ½ã€‚ 12345read -s -n1 -p &quot;Hit a key &quot; keypress# read æœ‰å¾ˆå¤šéžå¸¸æœ‰æ„æ€çš„å‚æ•°ï¼Œæ¯”å¦‚ -sçš„æ„æ€å°±æ˜¯ä¸è¦å›žæ˜¾è¾“å…¥# -n1 çš„æ„æ€æ˜¯è¾“å…¥æŒ‡å®šæ•°é‡çš„å­—ç¬¦# -p æ˜¯å…ˆè¾“å‡ºå‰é¢çš„æç¤ºã€‚echo; echo &quot;Keypress was &quot;\&quot;$keypress\&quot;&quot;.&quot; readä¹Ÿå¯ä»¥ä½¿ç”¨æ–‡ä»¶ä½œä¸ºè¾“å…¥çš„æº 12345678910111213echo &quot;æ–‡ä»¶temp_fileä¸­å†…å®¹æœ‰ä¸¤è¡Œ ä¸€è¡Œæ˜¯hello world ç¬¬äºŒè¡Œæ˜¯ Hello World&quot;read var1 var2 &lt; temp_fileecho &quot;var1 is $var1 var2 is $var2&quot;echo &quot;è¿™é‡Œæ˜¾ç„¶è¾“å‡ºçš„ç¬¬ä¸€è¡Œçš„å†…å®¹&quot;echo &quot;---------------------------&quot;echo &quot;å…¶å®žè¿˜èƒ½è‡ªå®šä¹‰IFSåˆ†å‰²ç¬¦ç„¶åŽæ ¹æ®è§„åˆ™è‡ªå®šä¹‰æ–‡ä»¶è¾“å…¥&quot;echo &quot;all users in the list:&quot;OIFS=$IFS ; IFS=:while read name passwd uid gid fullname ignoredo echo &quot;$name ($fullname)&quot;done &lt; /etc/passwdIFS=$OIFS æ–‡ä»¶ç³»ç»Ÿæ“ä½œæ“ä½œæ–‡ä»¶ç³»ç»Ÿçš„å‘½ä»¤æœ‰å¾ˆå¤šä½†æ˜¯éƒ½éžå¸¸çš„å¸¸ç”¨ä¹Ÿéžå¸¸çš„ç®€å•ã€‚è¿™é‡Œä¸åšå…·ä½“çš„è¯´æ˜Žå…¶ä¸­ä¸¾ä¸€ä¸¤ä¸ªéžå¸¸å¸¸è§çš„ã€‚ cd : åˆ‡æ¢ç›®å½• pwd ï¼š æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½• å˜é‡æ“ä½œlet æ˜¯èƒ½å¤Ÿè¿›è¡Œç®€å•å˜é‡è¿ç®—çš„å‘½ä»¤ æ¯”å¦‚ 1234let a=1+2echo $alet b=&quot;2+3&quot;echo $b eval å‘½ä»¤æ˜¯èƒ½å¤Ÿå°†å­—ç¬¦ä¸²è½¬æ¢æˆæˆå‘½ä»¤ã€‚å¹¶ä¸”å¯ä»¥å¤šæ¬¡è°ƒç”¨ä»¥åŽ»è¯„ä¼°æ˜¯å¦æ˜¯å‘½ä»¤åŽ»æ‰§è¡Œ 12345678910111213141516 command_string=&quot;ps ax&quot; process=&quot;ps ax&quot; eval &quot;$command_string&quot; | grep &quot;$process&quot;# 26973 pts/3 R+ 0:00 grep --color ps ax# 26974 pts/3 R+ 0:00 ps axa=&apos;$b&apos;b=&apos;$c&apos;c=decho $a # $b # First level.eval echo $a # $c # Second level.eval eval echo $a # d # Third level. setå’Œunsetå‘½ä»¤ï¼Œä¸€çœ‹å°±çŸ¥é“æ˜¯è®¾ç½®å’Œå–æ¶ˆå˜é‡çš„æ„æ€ã€‚ export å‘½ä»¤ä¸€èˆ¬ä½¿ç”¨åœ¨è®¾ç½®çŽ¯å¢ƒå˜é‡ä¸Šï¼Œå¦‚åœ¨/etc/profileæ–‡ä»¶ä¸­è®¾ç½®JAVA_HOME declareå’Œtypesetå‘½ä»¤æŒ‡å®šå’Œ/æˆ–é™åˆ¶å˜é‡çš„å±žæ€§ã€‚ getopts æ˜¯èƒ½å¤Ÿå®šä¹‰å±žæ€§çš„ æ¯”å¦‚ åœ¨è§£åŽ‹taråŒ…çš„æ—¶å€™ä½¿ç”¨-xvfä¹‹ç±»çš„å‘½ä»¤çš„æ—¶å€™å°±æ˜¯ä½¿ç”¨getoptsæ¥è¾¾åˆ°ä¸åŒçš„ -a -b ä¹‹ç±»çš„å®žçŽ°ã€‚è¿™ä¸ªå‘½ä»¤ä¸€èˆ¬å‡ºçŽ°åœ¨case æˆ–è€…whileå¾ªçŽ¯ä¸­ 123456789101112131415161718while getopts &quot;:abcde:fg&quot; Option# Initial declaration.# a, b, c, d, e, f, and g are the options (flags) expected.# The : after option &apos;e&apos; shows it will have an argument passed with it.# eå‚æ•°åŽé¢çš„çš„è¡¨ç¤ºä¼šæœ‰å‚æ•°ä¼ é€’ç»™ä»–do case $Option in a ) # Do something with variable &apos;a&apos;. b ) # Do something with variable &apos;b&apos;. ... e) # Do something with &apos;e&apos;, and also with $OPTARG, # which is the associated argument passed with option &apos;e&apos;. ... g ) # Do something with variable &apos;g&apos;. esacdoneshift $(($OPTIND - 1))# Move argument pointer to next.]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆä¸ƒï¼‰å¾ªçŽ¯å’Œåˆ†æ”¯ï¼ˆ1ï¼‰]]></title>
    <url>%2F2018%2F06%2F12%2F2018-06-11-bash_07_bash%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%92%8C%E5%88%86%E6%94%AF%2F</url>
    <content type="text"><![CDATA[å¾ªçŽ¯å’Œåˆ†æ”¯å¾ªçŽ¯å¾ªçŽ¯å°±æ˜¯ä¸€å—å½“æ¡ä»¶ä¸ºçœŸçš„è¿­ä»£çš„ä»£ç å—ã€‚ forå¾ªçŽ¯for arg in [list] è¿™æ˜¯æœ€åŸºç¡€çš„å¾ªçŽ¯å½¢å¼ã€‚å¦‚æžœdoå’Œforåœ¨ä¸€è¡Œé‡Œï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨doå‰é¢åŠ åˆ†å·å¦‚ï¼šfor arg in list ;do 1234for arg in listdo.. commend(s)done forå¾ªçŽ¯æœ‰å¾ˆå¤šç”¨æ³•ï¼Œä¸¾å‡ ä¸ªä¾‹å­æ¥äº†è§£ä¸€ä¸‹forå¾ªçŽ¯éƒ½èƒ½å¤Ÿå¹²äº›ä»€ä¹ˆå§ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455# for i in &quot;hello world !&quot; # è¿™æ ·å½“ä½œæ•´ä¸ªå­—ç¬¦ä¸²for i in hello world !do echo $idone# ä¸Žå‘½ä»¤ç»“åˆif [ -e &quot;/bin/bash&quot; ]then echo &quot;is exist&quot;fi# è¾“å‡ºå½“å‰ç›®å½•ä¸‹åŒ¹é…æ–‡ä»¶çš„å†…å®¹ ç±»ä¼¼ä½¿ç”¨findå‘½ä»¤FILE=&quot;*txt&quot;for file in $FILEdo echo &quot;Contents of $file&quot; echo &quot;------------------&quot; cat &quot;$file&quot; echodone# å¦‚æžœin listå†…å®¹ç¼ºå¤±å°±è¡¨ç¤ºä½¿ç”¨ in $@ ä¹Ÿå°±æ˜¯æ‰€æœ‰ä¼ è¿›æ¥çš„å‚æ•°for ado echo &quot;$a&quot;done#é€šè¿‡ä½¿ç”¨å‘½ä»¤æ¥æž„é€ forå¾ªçŽ¯çš„listfor b in `ls`do echo $bdone# ä½¿ç”¨forå¾ªçŽ¯è¾“å‡ºç”¨æˆ·çš„ä¿¡æ¯PASSWORD_FILE=/etc/passwdn=1for name in $(awk &apos;BEGIN&#123;FS=&quot;:&quot;;&#125;&#123;print $1&#125;&apos;&lt; &quot;$PASSWORD_FILE&quot;)do echo &quot;USER #$n=$name&quot; let &quot;n+=1&quot;done#ä½¿ç”¨å‡½æ•°ç»™forå¾ªçŽ¯ä½œå€¼give_parm()&#123; echo &quot;1 2 3 5 6&quot;&#125;for c in $(give_parm)do echo $cdone# ç±»Cè¯­è¨€çš„forå¾ªçŽ¯for (( ai=1;ai&lt;5;ai++))do echo $aidone whileå¾ªçŽ¯whileå¾ªçŽ¯ç”¨æ¥æµ‹è¯•ä¸€ä¸ªæ¡ä»¶,å¹¶ä¸”ä¸€ç›´å¾ªçŽ¯ç›´åˆ°æ¡ä»¶ä¸ºtrueä¹Ÿå°±æ˜¯é€€å‡ºç ä¸º0çš„æ—¶å€™é€€å‡ºå¾ªçŽ¯ã€‚ä¸€èˆ¬whileå¾ªçŽ¯ç”¨åœ¨æå‰ä¸çŸ¥é“å¾ªçŽ¯æ¬¡æ•°çš„æ—¶å€™ã€‚whileå¾ªçŽ¯ä½¿ç”¨ä¸­æ‹¬å·æŠŠæ¡ä»¶æ‹¬èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒä¸­æ‹¬å·ã€‚ 1234while [condition]doÂ·Â·Â·Â·commendsdone å½“whileæœ‰å¤šä¸ªæ¡ä»¶çš„æ—¶å€™ï¼Œåªæœ‰æœ€åŽä¸€ä¸ªå‚æ•°ä¼šå†³å®šå¾ªçŽ¯æ¬¡æ•° 1234567891011while echo &quot;previous-variable = $previous&quot; echo previous=$var1 [ &quot;$var1&quot; != end ] # Keeps track of what $var1 was previously. # Four conditions on *while*, but only the final one controls loop. # The *last* exit status is the one that counts.doecho &quot;Input variable #1 (end to exit) &quot; read var1 echo &quot;variable #1 = $var1&quot;done ä¹Ÿæœ‰ç±»ä¼¼Cè¯­è¨€çš„whileæ¡ä»¶ã€‚ 12345678while (( a &lt;= LIMIT )) # Double parentheses,do # + and no &quot;$&quot; preceding variables. echo -n &quot;$a &quot; ((a += 1)) # let &quot;a+=1&quot; ç®—æ•°è¿ç®— # Yes, indeed. # Double parentheses permit incrementing a variable with C-like syntax. # åŒå°æ‹¬å·å…è®¸é€’å¢žä¸€ä¸ªå˜é‡ä½¿ç”¨ç±»Cçš„è¿ç®—æ–¹å¼done åŒæ ·çš„whileåŽçš„æ¡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•° 12345678910111213141516condition ()&#123; ((t++)) if [ $t -lt 5 ] then return 0 # true else return 1 # false fi&#125;while condition# ^^^^^^^^^# Function call -- four loop iterations.do echo &quot;Still going: t = $t&quot;done whileå¯ä»¥å’Œreadå‘½ä»¤è¿›è¡Œç»“åˆï¼Œå½¢æˆ while read ç»“æž„ä½“ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„è¯»å’Œå¤„ç†æ–‡ä»¶ã€‚ 1234while read linedo echo $line #è¯»å–1.txtä¸­çš„æ¯ä¸€è¡Œdone &lt; 1.txt untilå¾ªçŽ¯untilå¾ªçŽ¯æ˜¯å’Œwhileå¾ªçŽ¯æ­£å¥½ç›¸åï¼Œuntilä¼šä¸€ç›´è¿›è¡Œå¾ªçŽ¯ï¼Œç›´åˆ°æ¡ä»¶å˜ä¸ºfalseï¼› 1234until [ condition-is-true ]do command(s)...done]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆå…«ï¼‰å¾ªçŽ¯å’Œåˆ†æ”¯ï¼ˆ2ï¼‰]]></title>
    <url>%2F2018%2F06%2F12%2F2018-06-12-bash_08_bash%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%92%8C%E5%88%86%E6%94%AF%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[å¾ªçŽ¯å’Œåˆ†æ”¯(äºŒ)å¤šé‡å¾ªçŽ¯å°±åƒCï¼ŒJavaä¸€æ ·ï¼ŒbashåŒæ ·å¯ä»¥å®žçŽ°å¤šé‡å¾ªçŽ¯,ä¸‹é¢çš„ä¾‹å­ç®€å•çš„å®žçŽ°åŒé‡å¾ªçŽ¯ï¼Œå¦‚æžœåŠ ä¸Šå¾ªçŽ¯æŽ§åˆ¶å¯èƒ½å°±æ›´éš¾ä¸€äº›äº†ã€‚ 12345678for ((i=0;i&lt;5;i++))do for bin in 1 2 4 do echo $bin doneecho $idone å¾ªçŽ¯æŽ§åˆ¶å½±å“å¾ªçŽ¯è¡Œä¸ºçš„è¯­å¥ã€‚æœ‰ break å’Œ continue ä¸¤ä¸ªå¾ªçŽ¯æŽ§åˆ¶å‘½ä»¤,break å‘½ä»¤å¯ä»¥ç»ˆæ­¢å¾ªçŽ¯ï¼Œè€Œcontinueå¯ä»¥è·³è¿‡å½“å‰å¾ªçŽ¯æå‰è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªçŽ¯ï¼Œè¿™é‡Œå’ŒCè¯­è¨€å®šä¹‰çš„ç±»ä¼¼ã€‚ ä¸‹é¢ä¸¾ä¸€ä¸ªç®€å•çš„breakå’Œcontinueçš„ä¾‹å­ï¼› 123456789101112131415161718192021LIMIT=9a=0#while [[ $a -le $LIMIT ]]#do#let &quot;a=a+1&quot;#if [ $a -eq 3 ] || [ $a -eq 11 ]#then# continue#fi#echo $a# donewhile [[ $a -le $LIMIT ]]do let &quot;a=a+1&quot; if [ $a -gt 2 ] then break fi echo $adone ç®€å•çš„breakå¾ªçŽ¯åªèƒ½è·³å‡ºæœ€å†…å®¹çš„å¾ªçŽ¯ï¼Œè€Œä¸èƒ½è·³å‡ºå¤šå±‚çš„å¾ªçŽ¯ï¼Œå¯ä»¥ä½¿ç”¨ break N æ¥è·³å‡ºå¤šå±‚å¾ªçŽ¯ã€‚nä¸ºæƒ³è¦è·³å‡ºå¾ªçŽ¯çš„å±‚æ•°ã€‚ å’Œbreakåƒä¼¼çš„continueï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ continue N æ¥å®žçŽ°ã€‚è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸€ä¸ªéžå¸¸ç®€å•æ˜Žäº†çš„ä¾‹å­ 123456789101112131415161718192021#!/bin/bashfor outer in I II III IV V # outer loopdo echo; echo -n &quot;Group $outer: &quot; # -------------------------------------------------------------------- for inner in 1 2 3 4 5 6 7 8 9 10 # inner loop do if [[ &quot;$inner&quot; -eq 7 &amp;&amp; &quot;$outer&quot; = &quot;III&quot; ]] then continue 2 # Continue at loop on 2nd level, that is &quot;outer loop&quot;. # Replace above line with a simple &quot;continue&quot; # to see normal loop behavior. fi echo -n &quot;$inner &quot; # 7 8 9 10 will not echo on &quot;Group III.&quot; done # --------------------------------------------------------------------doneecho; echoexit 0 æµ‹è¯•å’Œåˆ†æ”¯ä½¿ç”¨ case å’Œ select ç»“æž„ä½“ï¼Œä¸åƒä¸€ä¸ªå¾ªçŽ¯ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä¸€ä¸ªè¿­ä»£çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯å®ƒä»¬èƒ½å¤Ÿé€šè¿‡æ¡ä»¶æŒ‡å¯¼ç¨‹åºçš„æµå‘ã€‚ é€šè¿‡ç¨‹åºå—æŽ§åˆ¶ç¨‹åºæµå‘Case (in) /esacåœ¨bashä¸­çš„caseç»“æž„ç±»ä¼¼Cä¸­çš„switchç»“æž„ï¼Œæ˜¯åœ¨æ‹¥æœ‰å¤šç§æ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨åˆ°çš„ä»£ç å—ã€‚caseç»“æž„å¯ä»¥å‚è§ä¸‹é¢ä»£ç ã€‚ (å…¶å®žæ˜¯å¯ä»¥æœ‰conditionçš„å·¦è¾¹çš„æ‹¬å·çš„ï¼Œå—¯ï¼Œå¯ä»¥åŠ ä¸Šçš„) 123456789case &quot;$variable&quot; in &quot;$condition1&quot; ) command... ;; &quot;$condition2&quot; ) command... ;; ä¸‹é¢ä»¥åŽä¼šéžå¸¸æœ‰ç”¨å¤„çš„ä¾‹å­ 1234567891011121314151617#! /bin/bashcase &quot;$1&quot; in &quot;&quot;) echo &quot;Usage: $&#123;0##*/&#125; &lt;filename&gt;&quot;; exit $E_PARAM;; # No command-line parameters, # or first parameter empty.# Note that $&#123;0##*/&#125; is $&#123;var##pattern&#125; param substitution. # å¯ä»¥é€šè¿‡ä½¿ç”¨##parternæŠŠå‰é¢çš„./åŽ»æŽ‰ -*) FILENAME=./$1;; # If filename passed as argument ($1) #+ starts with a dash, #+ replace it with ./$1 #+ so further commands don&apos;t interpret it #+ as an option. * ) FILENAME=$1;; # Otherwise, $1.esac selectselectæ˜¯å’Œcaseç»“æž„æ„ä¹‰ç›¸åŒçš„ç»“æž„ä½“ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„PS3ä¹Ÿå°±æ˜¯é€‰æ‹©æç¤ºç¬¦ã€‚æ ¼å¼å¦‚ä¸‹ï¼š 12345select variable [in list]do command... breakdone ç®€å•å®žä¾‹ï¼Œè¿™ä¸ªä¾‹å­ä¸å®Œæ•´éœ€è¦å†åŽ»è€ƒè™‘å¾ˆå¤šä¸œè¥¿ã€‚ 12345678910111213141516PS3=&quot;Choose your favorite vegetable:&quot;select vegetable in &quot;beans&quot; &quot;carrots&quot; &quot;potatoes&quot;do if [[ $vegetable = &quot;beans&quot; ]] || [[ $vegetable = &quot;carrots&quot; ]] || [[$vegetable = &quot;potatoes&quot; ]] then echo echo &quot;your favorite veggie is $vegetable&quot; echo continue else echo &quot;your vegetable not on this list&quot; break fidone]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆä¹ï¼‰å‘½ä»¤ç½®æ¢å’Œç®—æ•°æ‰©å±•]]></title>
    <url>%2F2018%2F06%2F12%2F2018-06-16-bash_09_%E5%91%BD%E4%BB%A4%E7%BD%AE%E6%8D%A2%2F</url>
    <content type="text"><![CDATA[å‘½ä»¤ç½®æ¢å‘½ä»¤ç½®æ¢å¯ä»¥è¾“å‡ºä¸€æ¡æˆ–è€…å¤šæ¡å‘½ä»¤çš„è¾“å‡ºã€‚å¯ä»¥è®©å‘½ä»¤åœ¨ä¸åŒè¯­å¢ƒä¸‹èµ·ä½œç”¨ï¼Œæœ€å¸¸è§çš„æ˜¯ä½¿ç”¨ \`` ç¬¦å·è¿›è¡Œå¯¹å‘½ä»¤çš„åŒ…è£¹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè¾“å‡ºä½¿ç”¨å‘½ä»¤å¾—å‡ºçš„ç»“æžœã€‚å¯ä»¥æˆä¸ºå¦å¤–ä¸€ä¸ªå‘½ä»¤çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥æˆä¸ºå¾ªçŽ¯çš„å‚æ•°ã€‚ 123echo `hostname`echo $(&quot;hostname&quot;)# ä¸¤ç§ä½¿ç”¨éƒ½å¯ä»¥ï¼Œéƒ½èƒ½å¤Ÿè¾¾åˆ°å‘½ä»¤ç½®æ¢çš„ç›®çš„ ç®—æ•°è¿ç®—ä½¿ç”¨åå¼•å·ï¼ŒåŒæ‹¬å·ï¼Œå’Œletè¿›è¡Œç›¸å¯¹æ¥è¯´ç®€å• ä½¿ç”¨åå¼•å·ä½¿ç”¨åå¼•å·å†…ç”¨exprå‘½ä»¤è¿›è¡Œæ•´åž‹æ•°çš„è¿ç®—ã€‚ 1z=`expr $z+1` ä½¿ç”¨åŒæ‹¬å·å’Œletè¿›è¡Œè¿ç®—1234z=$((z+3))let z=z+3let &quot;z += 3&quot; # Quotes permit the use of spaces in variable assignment. ä»Šå¤©çš„å†…å®¹æœ‰ç‚¹å°‘ã€‚ã€‚ã€‚]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­£åˆ™è¡¨è¾¾å¼çš„å…¥é—¨]]></title>
    <url>%2F2018%2F06%2F07%2F2018-06-06-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[æ­£åˆ™è¡¨è¾¾å¼æœ€è¿‘ä¼šæ—¶å¸¸é‡åˆ°ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ‰€ä»¥çŽ°åœ¨å†™ä¸€ç¯‡æ­£åˆ™è¡¨è¾¾å¼çš„æ–‡ç« æ¥ç®€å•è®°å½•ä¸€ä¸‹å­¦ä¹ æ­£åˆ™çš„è¿‡ç¨‹ã€‚ åœ¨è¿™ä¸ªç½‘ç«™æœ‰æ­£åˆ™è¡¨è¾¾å¼çš„ä¸­æ–‡æ–‡æ¡£ -ã€‹ æ­£åˆ™è¡¨è¾¾å¼æ‰‹å†Œ ç‰¹æ®Šå­—ç¬¦ä¸€èˆ¬ä½¿ç”¨åæ–œæ  \ æ¥è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ å¦‚åœ¨æ­£åˆ™ä¸­æœ‰ç‰¹æ®Šæ„ä¹‰çš„* æˆ–è€…. å¦‚æžœè¦ä½¿ç”¨åŽŸæ„åˆ™éœ€è¦ä½¿ç”¨\æ¥è¿›è¡Œè½¬ä¹‰ å¦‚ \*ã€‚ä¸‹é¢ä»‹ç»å‡ ä¸ªå…·ä½“çš„å®žä¾‹ã€‚ ^ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½® $ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸä½ç½® . åŒ¹é…é™¤åŽ»æ¢è¡Œç¬¦ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦ * åŒ¹é…å‰é¢å­—ç¬¦0æ¬¡æˆ–è€…å¤šæ¬¡ ? åŒ¹é…å‰é¢å¤§çš„å­—ç¬¦0æ¬¡æˆ–è€…1æ¬¡ + åŒ¹é…å‰é¢å­—ç¬¦ä¸€æ¬¡æˆ–å¤šæ¬¡ \w åŒ¹é…å­—æ¯æˆ–è€…æ•°å­— \s åŒ¹é…ä»»æ„ç©ºç™½ \d åŒ¹é…æ•°å­— \b åŒ¹é…å•è¯çš„å¼€å§‹æˆ–è€…ç»“æŸ ä¸€èˆ¬ä½¿ç”¨ ^ å¼€å¤´å¹¶ä¸”ä»¥ $ ç»“æŸï¼Œå¦‚éªŒè¯5-12ä½æ•°å­—çš„æ—¶å€™å¯ä»¥è¿™æ ·å†™ ^\d{5,12}$ å½“å­—ç¬¦ä¸²ä¸º &quot;hello world æ˜¯ï¼Œä½¿ç”¨$æ—¶åŒ¹é…åˆ°ä¸€å¤„ï¼Œè€Œä½¿ç”¨\bæ—¶ä¼šåŒ¹é…åˆ°å››å¤„ï¼Œåˆ†åˆ«ä¸ºæ¯ä¸ªå•è¯çš„å¼€å¤´å’Œç»“å°¾ã€‚ ç‰¹æ®Šå­—ç¬¦éžå¸¸é‡è¦ï¼Œæ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„åŸºæœ¬ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨åˆ°äº†é‡å¤ï¼Œä¹Ÿå°±æ˜¯{m,n} må’Œnæ˜¯é‡å¤çš„æ¬¡æ•°ï¼Œå¦‚æžœnå­˜åœ¨ï¼Œé‚£ä¹ˆå°±é‡å¤måˆ°næ¬¡å¦‚æžœä¸å­˜åœ¨ï¼Œå°±é‡å¤mæ¬¡ã€‚ å­—ç¬¦åŒ¹é…å½“ä½¿ç”¨åˆ°éžç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ä¸­æ‹¬å·ï¼Œå¦‚ [aeiou]ç”¨æ¥è¡¨ç¤ºå…¶ä¸­çš„å­—ç¬¦éƒ½å¯ä»¥åŒ¹é…åˆ°ã€‚æ¯”å¦‚ å­—ç¬¦ä¸² â€˜how helloâ€™ ä½¿ç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼ h[oe] è¿™æ ·å¯ä»¥æç¤ºåŒ¹é…åˆ°ä¸¤å¤„ å½“éœ€è¦ä½¿ç”¨ä¸Žç‰¹æ®Šå­—ç¬¦ç›¸åçš„å«ä¹‰çš„æ—¶å€™ ä½¿ç”¨åæ–œæ +å¤§å†™å­—ç¬¦çš„æ ¼å¼æ¥è¿›è¡ŒåŒ¹é…ã€‚æ¯”å¦‚åŒ¹é…éžå­—æ¯å’Œæ•°å­—çš„å­—ç¬¦å°±åº”è¯¥ä½¿ç”¨\W(å› ä¸ºä½¿ç”¨åŒ¹é…å­—æ¯å’Œæ•°å­—çš„ç‰¹æ®Šå­—ç¬¦æ˜¯\w)ã€‚éžç‰¹æ®Šå­—ç¬¦çš„åä¹‰ä½¿ç”¨^å·ã€‚å¦‚[^aeiou]è¡¨ç¤ºåŽŸå› å­—ç¬¦æ„å¤–çš„ä»»æ„å­—ç¬¦ã€‚ å½“æƒ³åŒ¹é…å¤šç§æƒ…å†µçš„æ—¶å€™ï¼Œæ¯”å¦‚æˆ‘æƒ³åŒ¹é…xæˆ–è€…yå­—ç¬¦ä¸²é‚£ä¹ˆå°±ä½¿ç”¨ x|y æ¥è¡¨ç¤ºåŒ¹é…xæˆ–è€…yã€‚è¿™æ ·å¯ä»¥è§£å†³å¾ˆå¤šäºŒä¹‰æ€§çš„åŒ¹é…ä¸²ã€‚ åˆ†ç»„çš„åŒ¹é…å½“æƒ³å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œé‡å¤ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨åˆ†ç»„çš„åŠŸèƒ½ã€‚ä½¿ç”¨å°æ‹¬å·æ¥å®žçŽ°ã€‚å…¸åž‹çš„ipåœ°å€çš„åŒ¹é…å°±å¯ä»¥è¿™æ ·ä½¿ç”¨(\d{1,3}.){3}\d{1,3} ä½¿ç”¨ \\+æ•°å­— çš„å½¢å¼ æ¥å®žçŽ°é‡å¤é‚£ä¸ªåˆ†ç»„çš„æ“ä½œå¦‚ \b(\w+)\b\s+\1\b å°±å¯ä»¥åŒ¹é…ç›¸åŒçš„å­—ç¬¦ä¸²ã€‚ è´ªå©ªæ¨¡å¼å½“ä½¿ç”¨?ç´§è·Ÿå…¶ä»–ä»»ä½•ä¸€ä¸ªå…¶ä»–é™åˆ¶ç¬¦ä¹‹åŽæ¯”å¦‚. * ä¹‹åŽï¼ŒåŒ¹é…æ¨¡å¼æ˜¯éžè´ªå©ªçš„ï¼Œå°½å¯èƒ½å°‘çš„åŒ¹é…æœç´ çš„æ‰€æœ‰å­—ç¬¦ä¸²ã€‚æ¯”å¦‚æœå¤špppppppå­—ç¬¦ä¸²ï¼Œä½¿ç”¨â€˜o+?â€™ä¼šåŒ¹é…åˆ°å•ä¸ªo å…³äºŽ çš„åŽç»­ (?:pattern) åŒ¹é…patternä½†ä¸èŽ·å–ç»“æžœã€‚è¿™åœ¨ä½¿ç”¨|æ¥ç»„åˆä¸€ä¸ªæ¨¡å¼çš„å„ä¸ªéƒ¨åˆ†éžå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚å¸¸è§„åŒ¹é…ä¸¤ç§å­—ç¬¦ä¸²â€œusername|userMannerâ€å¯ä»¥ä½¿ç”¨user(?:name|Manner)æ¥ç®€å†™ã€‚ (?=pattern) æ­£å‘è‚¯å®šé¢„æŸ¥ã€‚æ¯”å¦‚windows(?=95|03|NT)èƒ½å¤ŸåŒ¹é…åˆ°windows95ä¸­çš„windowsè€Œä¸èƒ½åŒ¹é…åˆ°windowsxpä¸­çš„windows (?!pattern) æ­£å‘å¦å®šé¢„æŸ¥ã€‚ä¸Žä¸Šé¢çš„æ„æ€ç›¸ä¼¼ï¼Œå°±æ˜¯èƒ½å¤ŸåŒ¹é…åˆ°éžçš„æŒ‡å®šæ¡ä»¶ã€‚æ¯”å¦‚windows(?!95|03|NT`èƒ½å¤ŸåŒ¹é…åˆ°windowsxpä¸­çš„windowsè€Œä¸èƒ½åŒ¹é…åˆ°windows95ä¸­çš„windows (?&lt;=pattern) åå‘è‚¯å®šé¢„æŸ¥ã€‚å’Œç¬¬ä¸€ä¸ªå¾ˆç›¸è¿‘ï¼Œåªä¸è¿‡æ–¹å‘ä¸åŒã€‚ (?&lt;!) åå‘å¦å®šé¢„æŸ¥ ã€‚ è¿™æ¬¡çš„æ­£åˆ™è¡¨è¾¾å¼å°±å…ˆæ€»ç»“åˆ°è¿™é‡Œï¼Œä»¥åŽè‚¯å®šä¼šé‡åˆ°æ›´å¤šçš„å…³äºŽæ­£åˆ™çš„é—®é¢˜ã€‚æœ‰æ—¶é—´ä¸€å®šè¿˜è¦è¯»è¯»è‹±æ–‡çš„æ­£åˆ™æ•™ç¨‹]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>æ­£åˆ™è¡¨è¾¾å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆäº”ï¼‰ bashä¸­å…³äºŽå˜é‡çš„æ›´å¤šçš„çŸ¥è¯†]]></title>
    <url>%2F2018%2F05%2F02%2F2018-05-05-bash_05_%E6%93%8D%E4%BD%9C%E5%8F%98%E9%87%8F%202%2F</url>
    <content type="text"><![CDATA[å­—ç¬¦ä¸²æ“ä½œbashæ”¯æŒå¾ˆå¤šå…³äºŽå­—ç¬¦ä¸²çš„æ“ä½œï¼Œä¸è¿‡å¯æƒœçš„æ˜¯ï¼Œè¿™äº›æ“ä½œç¼ºä¹ç»Ÿä¸€æ€§ï¼Œæœ‰ä¸€äº›æ˜¯ä½¿ç”¨å‚æ•°ç­‰ï¼Œå¦å¤–ä¸€äº›æ˜¯é€šè¿‡å†…å»ºå‘½ä»¤exprå‘½ä»¤æ¥å®žçŽ°ï¼Œè¿™ä¼šå¯¼è‡´ä¸åŒçš„è¯­æ³•åŠŸèƒ½çš„é‡å ï¼Œä¼šæ¯”è¾ƒæ··ä¹±ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹ä½¿ç”¨å‚æ•°å’Œå‘½ä»¤çš„å®žçŽ°å­—ç¬¦ä¸²çš„æ“ä½œã€‚ å­—ç¬¦ä¸²é•¿åº¦ï¼ˆString Lengthï¼‰ $(#string) è¿™é‡Œæ˜¯å’ŒCè¯­è¨€ä¸­çš„strlen()æ˜¯ç›¸åŒçš„ã€‚ expr length $string åŒæ ·è¡¨ç¤ºstringä¸²çš„é•¿åº¦ã€‚ 1234567#! /bin/bashstring=abcdefgHIGKL#ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•$(#string)echo "stringçš„é•¿åº¦æ˜¯ï¼š$&#123;#string&#125;"#ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ä½¿ç”¨exprå†…å»ºå‘½ä»¤ ä¼˜ç‚¹ç®€å•æ˜“æ‡‚echo "stringçš„é•¿åº¦æ˜¯ï¼š`expr length $string`"` å­—ç¬¦ä¸²ä»Žå¼€å¤´åŒ¹é…å­å­—ä¸²çš„é•¿åº¦ æ–¹æ³•å¦‚ä¸‹ï¼š 123stringZ=abcABC123ABCab echo `expr match "$stringZ" 'abc[A-Z]*.2'`echo `expr $stringZ : 'abc[A-Z]*.2'` åŒ¹é…åˆ°å­ä¸²çš„ä½ç½® (index) 1echo `expr index $stringZ 'abc[A-Z]*.2'` å­å­—ç¬¦ä¸²çš„æˆªå– ${string:position} ä»Žpositonä½ç½®æˆªå–å­—ç¬¦ä¸²stringã€‚ ${string:positong:length} ä»Žpositonä½ç½®æˆªå–å­—ç¬¦ä¸²stringï¼Œå¹¶ä¸”é™å®šæˆªå–é•¿åº¦ä¸ºlengthã€‚ expr substr $string $positon $length æ„æ€åŒä¸Šã€‚ expr match $string â€˜\(substring \)â€™ è¿™é‡Œçš„substringæ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚ 12345#æˆªå–å­—ç¬¦ä¸²echo $&#123;stringZ:5&#125;echo $&#123;stringZ:5:4&#125;echo `expr substr $stringZ 5 4`echo `expr match $stringZ '\(abc[A-Z]*.2\)'` ä»Žå­—ç¬¦ä¸²ä¸­ç§»é™¤å­å­—ç¬¦ä¸² ${string#substring} substringæ˜¯å­å­—ç¬¦ä¸²ã€‚å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯å‘åŽç§»é™¤è¯¥å­å­—ç¬¦ä¸²æœ€çŸ­åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚ ${string##substring} ä¸Žä¸Šé¢çš„æ­£å¥½ç›¸åã€‚è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯å‘åŽç§»é™¤è¯¥å­—ç¬¦ä¸²æœ€é•¿åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚ ${string%substring} è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯ç”±åŽå‘å‰ç§»é™¤è¯¥å­å­—ç¬¦ä¸²æœ€çŸ­åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚ ${string%%substring} è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯ç”±åŽå‘å‰ç§»é™¤è¯¥å­—ç¬¦ä¸²æœ€é•¿åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚ 12345678910echo "ç§»é™¤å­—ç¬¦ä¸²"echo $&#123;stringZ#a*b&#125; echo $&#123;stringZ##a*b&#125;echo $&#123;stringZ%a*c&#125;echo $&#123;stringZ%%a*c&#125;#ç»“æžœï¼š#ABC123ABCabc#c#abcABC123ABC# å­å­—ç¬¦ä¸²æ›¿æ¢ ${string/substring/replacement} æ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°substringçš„å­—ç¬¦ä¸²ï¼Œæ›¿æ¢ä¸ºreplacementã€‚ ${string//substring/replacement} æ›¿æ¢æ‰€æœ‰åŒ¹é…åˆ°çš„å­—ç¬¦ã€‚ ${string/#substring/replacement} æ›¿æ¢ç”±å‰å‘åŽåŒ¹é…åˆ°çš„å­—ç¬¦ã€‚ ${string/%substring/replacement} æ›¿æ¢ç”±åŽå‘å‰åŒ¹é…åˆ°çš„å­—ç¬¦ã€‚ 12345678910echo "---------å­—ç¬¦ä¸²æ›¿æ¢---------"echo $&#123;stringZ/abc/xyz&#125;echo $&#123;stringZ//abc/xyz&#125;echo $&#123;stringZ/#abc/xyz&#125;echo $&#123;stringZ/%abc/xyz&#125;#ç»“æžœï¼š#xyzABC123ABCabc#xyzABC123ABCxyz#xyzABC123ABCabc#abcABC123ABCxyz ä½¿ç”¨awkæ“ä½œå­—ç¬¦ä¸²çŽ°å­¦å…ˆå–ï¼Œä¸‰ååˆ†é’Ÿå­¦ä¼šAWK,å¿«é€Ÿäº†è§£å’Œåº”ç”¨awkã€‚ åŸºäºŽä»¥ä¸Šï¼Œä½¿ç”¨awkç»ƒä¹ ã€‚ å·¥ä½œæµåˆ†ä¸ºå¤§è‡´ä¸‰éƒ¨åˆ†ï¼Œ read-&gt;excute-&gt;repeat,å®žçŽ°å¯¹æ–‡æœ¬çš„å¤„ç†ã€‚ ç¨‹åºæœºæž„ BEGIN è¯­æ³•ï¼šBEGIN {awk-commands} æ˜¯å¯ä»¥çœç•¥çš„éƒ¨åˆ†å—ï¼Œä¸»è¦ä½œç”¨æ˜¯å£°æ˜Žå˜é‡ï¼Œåˆå§‹åŒ–å˜é‡ï¼Œ BODYå— ï¼š{commonds}ï¼Œæ˜¯å¿…é¡»å¡«å†™çš„éƒ¨åˆ†ï¼Œä¸»è¦ä½œç”¨æ˜¯å¤„ç†æ–‡æœ¬ï¼Œä¼šå¯¹è¾“å…¥çš„æ¯ä¸€è¡Œéƒ½æ‰§è¡Œbodyå—ä¸­çš„å‘½ä»¤ï¼Œå¹¶ä¸”bodyæ˜¯æ²¡æœ‰å…³é”®å­—çš„ã€‚ -END ï¼šEND {commands},åŒBEGINï¼Œæ˜¯å¯ä»¥çœç•¥çš„éƒ¨åˆ† åŸºç¡€è¯­æ³• awkå‘½ä»¤è¡Œï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œawk [-option] filesæ¥å®žçŽ°å¯¹filesæ–‡ä»¶çš„å¤„ç†ã€‚ å¦‚ awk {print} mark.txt è¿™é‡Œå°±ä¸å…·ä½“ä¸¾ä¾‹äº†ï¼Œå¼€å¤´çš„é“¾æŽ¥é‡Œè®²çš„éžå¸¸è¯¦ç»†ï¼Œè¿™é‡Œåªåšç®€å•çš„è®°å½•å’ŒæŸ¥çœ‹ã€‚ ä½¿ç”¨å‘½ä»¤æ–‡ä»¶æ–¹å¼ awk -f command.awk marks.txt ä½¿ç”¨-få‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚ awkåŸºæœ¬é€‰é¡¹ ï¼š è¿™é‡Œä¸å…·ä½“æ€»ç»“ï¼ŒlinuxçŽ¯å¢ƒä¸‹ç»ˆç«¯ man awkå¯ä»¥çœ‹åˆ°éžå¸¸å¤šçš„é€‰é¡¹ã€‚ åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹ åŸºæœ¬æ‰“å°æ–‡ä»¶å†…å®¹ 123456$ awk '&#123;print&#125;' mark.txt 1) Amit Physics 802) Rahul Maths 903) Shyam Biology 874) Kedar English 855) Hari History 89 æ‰“å°å…·ä½“é¡¹å†…å®¹ 123456$ awk '&#123;print $1 "\t" $2 &#125;' mark.txt1) Amit2) Rahul3) Shyam4) Kedar5) Hari æ·»åŠ é™å®šæ¡ä»¶çš„æ‰“å°å†…å®¹ 12345$ awk '/a/ &#123;print $1 "\t" $2 &#125;' mark.txt2) Rahul3) Shyam4) Kedar5) Hari ç»“æžœåªæ˜¾ç¤ºåŒ¹é…åˆ°açš„è¡Œ æ‰“å°åŒ¹é…åˆ°çš„è¡Œæ•° 12$ awk 'BEGIN&#123;count=0&#125; /a/ &#123; count++&#125; END&#123;print count&#125;' mark.txt4 æ‰“å°å­—ç¬¦æ•°é‡è¶…è¿‡16çš„è¡Œ 123$ awk 'length($0) &gt; 18' marks.txt3) Shyam Biology 874) Kedar English 85 NOTE:åœ¨è¿™é‡Œçš„å‚æ•°å’Œbashä¸­çš„å‚æ•°ç±»ä¼¼ã€‚$0å½“å‰è¡Œï¼Œ$1ä¹‹åŽè¡¨ç¤ºå¯¹åº”æ–‡ä»¶çš„è¡Œçš„åˆ—ã€‚ å†…å»ºå˜é‡AWKæä¾›äº†å¾ˆå¤šå†…å»ºå˜é‡æä¾›ä½¿ç”¨ï¼Œèƒ½å¤Ÿèµ·åˆ°å¾ˆå¤§çš„ä½œç”¨ã€‚ æ ‡å‡†awkå˜é‡ ARGC å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•° 12$ awk 'BEGIN&#123;print "argument=",ARGC&#125;' one two threeargument= 4 ARGV å‘½ä»¤è¡Œå‚æ•°æ•°ç»„ å¦‚ ARGV[1]=... CONVFMT æ•°å­—çš„çº¦å®šæ ¼å¼ï¼Œé»˜è®¤å€¼æ˜¯%.6g ENVIRON çŽ¯å¢ƒå˜é‡ 12$ awk 'BEGIN &#123;print "User is",ENVIRON["USER"]&#125;'User is nanyin FILENAME å½“å‰æ–‡ä»¶çš„åç§° 12$ awk 'END&#123;print "this file name is", FILENAME&#125;' mark.txtthis file name is mark.txt FS åˆ†å‰²ç¬¦ é»˜è®¤æ˜¯ç©ºæ ¼ä¹Ÿå¯ä»¥ä½¿ç”¨-Fè®¾ç½®åˆ†å‰²ç¬¦ NF å½“å‰è¡Œçš„å­—æ®µæ•°ç›® 12$ awk 'END&#123;print NF&#125;' mark.txt4 NR è¡Œå· FNR å½“å‰æ–‡ä»¶çš„è¡Œå· OFS è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ ORS è¾“å‡ºè¡Œåˆ†å‰²ç¬¦ RLENGTH è¡¨ç¤ºmatchå‡½æ•°åŒ¹é…å­—ç¬¦åºŠçš„é•¿åº¦ 12$ awk 'BEGIN &#123;if(match("One Three","ree")) &#123;print RLENGTH&#125;&#125;'3 RSTART è¡¨ç¤ºmatchå‡½æ•°ç¬¬ä¸€æ¬¡åŒ¹é…åˆ°çš„ä½ç½® 12$ awk 'BEGIN &#123;if(match("One Three","ree")) &#123;print RSTART&#125;&#125;' 8 æ“ä½œç¬¦ä¸ŽCè¯­è¨€çš„æ“ä½œç¬¦åŸºæœ¬ç›¸åŒï¼Œå¦‚æ•°å­—çš„ä¸€å…ƒäºŒå…ƒä¸‰å…ƒæ“ä½œç­‰ï¼Œå­—ç¬¦ä¸²çš„é“¾æŽ¥ï¼Œæ•°ç»„å…ƒç´ ç­‰ æ­£åˆ™è¡¨è¾¾å¼AWKå¯¹æ­£åˆ™çš„å¤„ç†éžå¸¸å¼ºå¤§ï¼Œé€šå¸¸ä½ ä¸€ä¸ªå°å°çš„æ­£åˆ™è¡¨è¾¾å¼èƒ½å¤Ÿå¤„ç†å¾ˆå¤æ‚çš„é—®é¢˜ã€‚å…³äºŽæ­£åˆ™ï¼Œæœ‰æ—¶é—´æ•´ç†ä¸€ç¯‡ä¸“é—¨å…³äºŽæ­£åˆ™çš„æ–‡ç« ã€‚ æ•°ç»„AWKæ”¯æŒå…³è”æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä»…å¯ä»¥ä½¿ç”¨æ•°å­—ç´¢å¼•çš„æ•°ç»„ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºç´¢å¼•ã€‚åˆ é™¤æ•°ç»„å…ƒç´ ä½¿ç”¨deleteè¯­å¥ æµç¨‹æŽ§åˆ¶æµç¨‹æŽ§åˆ¶if while for ä¸ŽCç›¸åŒ å‡½æ•°æŸ¥æ‰‹å†Œå§ã€‚ã€‚ä¸€æ¬¡æ€§çœ‹ä¸å®Œã€‚ã€‚ã€‚ã€‚å†…å»ºå‡½æ•°æ‰‹å†Œï¼Œè¿™é‡Œæœ‰åœ¨è¿™ç« æ¯”è¾ƒé‡è¦çš„å­—ç¬¦ä¸²å‡½æ•°ã€‚æŽ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹æœ‰å“ªäº›å‡½æ•°æ¯”è¾ƒé‡è¦ã€‚ AWKå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•° æ•´ç†å‡ºawkå¯¹å­—ç¬¦ä¸²çš„å‡ ä¸ªå…·ä½“å‡½æ•°æ“ä½œã€‚ asort(source,dest,how) asorti(source,dest,how) ä»¥ä¸Šä¸¤ä¸ªå‡½æ•°çš„howå…ˆä¸è§£é‡Šï¼Œå‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºsourceæ•°ç»„å’ŒæŽ’åºæ–¹å¼ï¼Œç¬¬äºŒä¸ªå¯ä»¥ä¸å†™ï¼Œé»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä½çš„è¿›è¡ŒæŽ’ä½ã€‚ 1234awk 'BEGIN&#123;a[0]="xiaohong";a[1]="aiaolan";asort(a);for(i=2;i&gt;=0;i--) &#123;print a[i]&#125;&#125;' xiaohong aiaolan` asorti()å‡½æ•°ä¼šå°†é¡ºåºæ›¿æ¢åˆ°æ•°ç»„çš„valueå¤„å¦‚ï¼š 123awk 'BEGIN&#123;a[0]="xiaohong";a[1]="aiaolan";asorti(a);for(i=2;i&gt;=0;i--) &#123;print a[i]&#125;&#125;' 1 0 gensub(regexp,replacement,how[,target]) ç±»ä¼¼gsubå’Œsub æ›¿æ¢åŒ¹é…åˆ°çš„æ­£åˆ™regexpä¸ºreplacement.å¦‚æžœhowæ˜¯gæˆ–è€…G(globalçš„ç®€å†™),åˆ™è¡¨ç¤ºæ›¿æ¢æ‰€æœ‰ä½¿ç”¨regexpåŒ¹é…åˆ°çš„å­—ç¬¦ä¸²,targetæ˜¯ç›®æ ‡å­—ç¬¦ä¸² å¦‚æžœä½¿ç”¨regexpæœªåŒ¹é…åˆ°ï¼Œåˆ™è¿”å›žåŽŸå§‹targetçš„å€¼ 1234567891011# ç¬¬ä¸€ä¸ªecho a b c a d | gawk '&#123;print gensub(/a/,"AA",2)&#125;' a b c AA d# ç¬¬äºŒä¸ªawk 'BEGIN&#123;a="abc def"b = gensub(/(.+) (.+)/,"\\2 \\1","g",a)print b&#125;'def abc gsub(regexp,replacement[,target]) gsubä¸­çš„â€˜gâ€™å…¶å®žæ˜¯è¡¨ç¤ºçš„æ˜¯global,å¯»æ‰¾ç›®æ ‡çš„åŒ¹é…åˆ°ä»Žå·¦æœ€é•¿çš„ï¼Œä¸é‡å çš„,æ‰¾åˆ°å¹¶ä¸”æ›¿æ¢æŽ‰ã€‚ 1&#123; gsub(/Britain/, "United Kingdom"); print &#125; è¿”å›žçš„å€¼ä¸ºåŒ¹é…åˆ°çš„æ¬¡æ•° index(in,find) å¯»æ‰¾inä¸²å†…ç¬¦åˆfindåŒ¹é…åˆ°çš„å­—ç¬¦çš„indexä½ç½® 123$ awk 'BEGIN&#123;quote&gt; print index("hello","lo")&#125;'4 length([string]) é¡¾åæ€ä¹‰ï¼Œä¸è§£é‡Šäº† 12$ awk 'BEGIN&#123;print length("hello")&#125;'5 NOTE: If no argument is supplied, length() returns the length of $0. match(string,regexp,[,array]) ä½¿ç”¨æ­£åˆ™åŒ¹é…å­—ç¬¦ä¸²ï¼Œè¿”å›žåŒ¹é…åˆ°çš„ä½ç½®ï¼Œè‹¥æœªåŒ¹é…åˆ°è¿”å›ž0 split(string,array[,fieldsep[,seps]]) åˆ†å‰²stringå­—ç¬¦ä¸²ï¼Œä½¿ç”¨arrayå­˜æ”¾åˆ†å‰²åŽäº§ç”Ÿçš„å­—ç¬¦ç»„ï¼Œä½¿ç”¨fieldsepç»„ä¸ºåˆ†å‰²ç¬¦ï¼Œsepså­˜æ”¾æ¯æ¬¡åˆ†å‰²äº§ç”Ÿçš„åˆ†å‰²ç¬¦ã€‚ä¸€ä¸ªåˆ†å‰²å‡ºæ¥çš„å­˜æ”¾åˆ°array[1]ä¸­ï¼Œç¬¬äºŒä¸ªå­˜æ”¾åˆ°array[2]ä¸­ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚å¦‚æžœåˆ†å‰²ç¬¦fieldsepä¸å†™ï¼Œåˆ™é»˜è®¤åˆ†å‰²ç¬¦ä¸ºç©ºæ ¼ã€‚ 12345$ awk 'BEGIN&#123;print split("cul-de-sac",a,"-",seps);for(i=1;i&lt;4;i++)&#123;print a[i]&#125;&#125;' 3culdesac sprintf(format,expression1,..) æ˜¯printfçš„åŠŸèƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¿”å›žå­—ç¬¦ä¸² strtonum (str) ç±»ä¼¼javaçš„parseInt()å‡½æ•°ï¼Œç”±Stringå­—ç¬¦ä¸²è½¬æˆæ•°å­— subï¼ˆregexp,replacement[,target]ï¼‰ æœ€å·¦æœ€é•¿åŒ¹é…åŽŸåˆ™è¿›è¡ŒåŒ¹é…ï¼Œsubä¸ªgsubçš„ä½œç”¨ç›¸åŒï¼Œåˆ†å‰²å­—ç¬¦ä¸²ï¼Œå¹¶è¿›è¡Œæ›¿æ¢ substr(string,start[,end]) åˆ†å‰²å­—ç¬¦ä¸² tolower(string) &amp; toupper(string) å¤§å°å†™è½¬æ¢ å…³äºŽawkçš„å°±æ€»ç»“åˆ°è¿™äº†ã€‚ã€‚ååˆ†åŸºç¡€çš„æ€»ç»“ã€‚ã€‚æŽ¨èæ–‡æ¡£ï¼Œæ¸…æ™°æ˜Žäº†ã€‚ä¸‹ä¸€ç¯‡æ‰“ç®—å…ˆæ•´ç†æ•´ç†æ­£åˆ™è¡¨è¾¾å¼ã€‚çŽ°åœ¨å“ªé‡Œéƒ½ä¼šç”¨åˆ°æ­£åˆ™ï¼Œè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çœ‹çœ‹æ­£åˆ™çš„ã€‚]]></content>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆäº”ï¼‰ bashä¸­å…³äºŽå˜é‡çš„æ›´å¤šçš„çŸ¥è¯†]]></title>
    <url>%2F2018%2F05%2F02%2F2018-05-05-bash_05_%E6%93%8D%E4%BD%9C%E5%8F%98%E9%87%8F%2F</url>
    <content type="text"><![CDATA[å­—ç¬¦ä¸²æ“ä½œbashæ”¯æŒå¾ˆå¤šå…³äºŽå­—ç¬¦ä¸²çš„æ“ä½œï¼Œä¸è¿‡å¯æƒœçš„æ˜¯ï¼Œè¿™äº›æ“ä½œç¼ºä¹ç»Ÿä¸€æ€§ï¼Œæœ‰ä¸€äº›æ˜¯ä½¿ç”¨å‚æ•°ç­‰ï¼Œå¦å¤–ä¸€äº›æ˜¯é€šè¿‡å†…å»ºå‘½ä»¤exprå‘½ä»¤æ¥å®žçŽ°ï¼Œè¿™ä¼šå¯¼è‡´ä¸åŒçš„è¯­æ³•åŠŸèƒ½çš„é‡å ï¼Œä¼šæ¯”è¾ƒæ··ä¹±ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹ä½¿ç”¨å‚æ•°å’Œå‘½ä»¤çš„å®žçŽ°å­—ç¬¦ä¸²çš„æ“ä½œã€‚ å­—ç¬¦ä¸²é•¿åº¦ï¼ˆString Lengthï¼‰ $(#string) è¿™é‡Œæ˜¯å’ŒCè¯­è¨€ä¸­çš„strlen()æ˜¯ç›¸åŒçš„ã€‚ expr length $string åŒæ ·è¡¨ç¤ºstringä¸²çš„é•¿åº¦ã€‚ 1234567#! /bin/bashstring=abcdefgHIGKL#ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•$(#string)echo "stringçš„é•¿åº¦æ˜¯ï¼š$&#123;#string&#125;"#ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ä½¿ç”¨exprå†…å»ºå‘½ä»¤ ä¼˜ç‚¹ç®€å•æ˜“æ‡‚echo "stringçš„é•¿åº¦æ˜¯ï¼š`expr length $string`"` å­—ç¬¦ä¸²ä»Žå¼€å¤´åŒ¹é…å­å­—ä¸²çš„é•¿åº¦ æ–¹æ³•å¦‚ä¸‹ï¼š 123stringZ=abcABC123ABCab echo `expr match "$stringZ" 'abc[A-Z]*.2'`echo `expr $stringZ : 'abc[A-Z]*.2'` åŒ¹é…åˆ°å­ä¸²çš„ä½ç½® (index) 1echo `expr index $stringZ 'abc[A-Z]*.2'` å­å­—ç¬¦ä¸²çš„æˆªå– ${string:position} ä»Žpositonä½ç½®æˆªå–å­—ç¬¦ä¸²stringã€‚ ${string:positong:length} ä»Žpositonä½ç½®æˆªå–å­—ç¬¦ä¸²stringï¼Œå¹¶ä¸”é™å®šæˆªå–é•¿åº¦ä¸ºlengthã€‚ expr substr $string $positon $length æ„æ€åŒä¸Šã€‚ expr match $string â€˜\(substring \)â€™ è¿™é‡Œçš„substringæ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚ 12345#æˆªå–å­—ç¬¦ä¸²echo $&#123;stringZ:5&#125;echo $&#123;stringZ:5:4&#125;echo `expr substr $stringZ 5 4`echo `expr match $stringZ '\(abc[A-Z]*.2\)'` ä»Žå­—ç¬¦ä¸²ä¸­ç§»é™¤å­å­—ç¬¦ä¸² ${string#substring} substringæ˜¯å­å­—ç¬¦ä¸²ã€‚å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯å‘åŽç§»é™¤è¯¥å­å­—ç¬¦ä¸²æœ€çŸ­åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚ ${string##substring} ä¸Žä¸Šé¢çš„æ­£å¥½ç›¸åã€‚è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯å‘åŽç§»é™¤è¯¥å­—ç¬¦ä¸²æœ€é•¿åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚ ${string%substring} è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯ç”±åŽå‘å‰ç§»é™¤è¯¥å­å­—ç¬¦ä¸²æœ€çŸ­åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚ ${string%%substring} è¯¥æ–¹æ³•è¡¨ç¤ºçš„æ˜¯ç”±åŽå‘å‰ç§»é™¤è¯¥å­—ç¬¦ä¸²æœ€é•¿åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚ 12345678910echo "ç§»é™¤å­—ç¬¦ä¸²"echo $&#123;stringZ#a*b&#125; echo $&#123;stringZ##a*b&#125;echo $&#123;stringZ%a*c&#125;echo $&#123;stringZ%%a*c&#125;#ç»“æžœï¼š#ABC123ABCabc#c#abcABC123ABC# å­å­—ç¬¦ä¸²æ›¿æ¢ ${string/substring/replacement} æ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°substringçš„å­—ç¬¦ä¸²ï¼Œæ›¿æ¢ä¸ºreplacementã€‚ ${string//substring/replacement} æ›¿æ¢æ‰€æœ‰åŒ¹é…åˆ°çš„å­—ç¬¦ã€‚ ${string/#substring/replacement} æ›¿æ¢ç”±å‰å‘åŽåŒ¹é…åˆ°çš„å­—ç¬¦ã€‚ ${string/%substring/replacement} æ›¿æ¢ç”±åŽå‘å‰åŒ¹é…åˆ°çš„å­—ç¬¦ã€‚ 12345678910echo "---------å­—ç¬¦ä¸²æ›¿æ¢---------"echo $&#123;stringZ/abc/xyz&#125;echo $&#123;stringZ//abc/xyz&#125;echo $&#123;stringZ/#abc/xyz&#125;echo $&#123;stringZ/%abc/xyz&#125;#ç»“æžœï¼š#xyzABC123ABCabc#xyzABC123ABCxyz#xyzABC123ABCabc#abcABC123ABCxyz ä½¿ç”¨awkæ“ä½œå­—ç¬¦ä¸²çŽ°å­¦å…ˆå–ï¼Œä¸‰ååˆ†é’Ÿå­¦ä¼šAWK,å¿«é€Ÿäº†è§£å’Œåº”ç”¨awkã€‚ åŸºäºŽä»¥ä¸Šï¼Œä½¿ç”¨awkç»ƒä¹ ã€‚ å·¥ä½œæµåˆ†ä¸ºå¤§è‡´ä¸‰éƒ¨åˆ†ï¼Œ read-&gt;excute-&gt;repeat,å®žçŽ°å¯¹æ–‡æœ¬çš„å¤„ç†ã€‚ ç¨‹åºæœºæž„ BEGIN è¯­æ³•ï¼šBEGIN {awk-commands} æ˜¯å¯ä»¥çœç•¥çš„éƒ¨åˆ†å—ï¼Œä¸»è¦ä½œç”¨æ˜¯å£°æ˜Žå˜é‡ï¼Œåˆå§‹åŒ–å˜é‡ï¼Œ BODYå— ï¼š{commonds}ï¼Œæ˜¯å¿…é¡»å¡«å†™çš„éƒ¨åˆ†ï¼Œä¸»è¦ä½œç”¨æ˜¯å¤„ç†æ–‡æœ¬ï¼Œä¼šå¯¹è¾“å…¥çš„æ¯ä¸€è¡Œéƒ½æ‰§è¡Œbodyå—ä¸­çš„å‘½ä»¤ï¼Œå¹¶ä¸”bodyæ˜¯æ²¡æœ‰å…³é”®å­—çš„ã€‚ -END ï¼šEND {commands},åŒBEGINï¼Œæ˜¯å¯ä»¥çœç•¥çš„éƒ¨åˆ† åŸºç¡€è¯­æ³• awkå‘½ä»¤è¡Œï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œawk [-option] filesæ¥å®žçŽ°å¯¹filesæ–‡ä»¶çš„å¤„ç†ã€‚ å¦‚ awk {print} mark.txt è¿™é‡Œå°±ä¸å…·ä½“ä¸¾ä¾‹äº†ï¼Œå¼€å¤´çš„é“¾æŽ¥é‡Œè®²çš„éžå¸¸è¯¦ç»†ï¼Œè¿™é‡Œåªåšç®€å•çš„è®°å½•å’ŒæŸ¥çœ‹ã€‚ ä½¿ç”¨å‘½ä»¤æ–‡ä»¶æ–¹å¼ awk -f command.awk marks.txt ä½¿ç”¨-få‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚ awkåŸºæœ¬é€‰é¡¹ ï¼š è¿™é‡Œä¸å…·ä½“æ€»ç»“ï¼ŒlinuxçŽ¯å¢ƒä¸‹ç»ˆç«¯ man awkå¯ä»¥çœ‹åˆ°éžå¸¸å¤šçš„é€‰é¡¹ã€‚ åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹ åŸºæœ¬æ‰“å°æ–‡ä»¶å†…å®¹ 123456$ awk '&#123;print&#125;' mark.txt 1) Amit Physics 802) Rahul Maths 903) Shyam Biology 874) Kedar English 855) Hari History 89 æ‰“å°å…·ä½“é¡¹å†…å®¹ 123456$ awk '&#123;print $1 "\t" $2 &#125;' mark.txt1) Amit2) Rahul3) Shyam4) Kedar5) Hari æ·»åŠ é™å®šæ¡ä»¶çš„æ‰“å°å†…å®¹ 12345$ awk '/a/ &#123;print $1 "\t" $2 &#125;' mark.txt2) Rahul3) Shyam4) Kedar5) Hari ç»“æžœåªæ˜¾ç¤ºåŒ¹é…åˆ°açš„è¡Œ æ‰“å°åŒ¹é…åˆ°çš„è¡Œæ•° 12$ awk 'BEGIN&#123;count=0&#125; /a/ &#123; count++&#125; END&#123;print count&#125;' mark.txt4 æ‰“å°å­—ç¬¦æ•°é‡è¶…è¿‡16çš„è¡Œ 123$ awk 'length($0) &gt; 18' marks.txt3) Shyam Biology 874) Kedar English 85 NOTE:åœ¨è¿™é‡Œçš„å‚æ•°å’Œbashä¸­çš„å‚æ•°ç±»ä¼¼ã€‚$0å½“å‰è¡Œï¼Œ$1ä¹‹åŽè¡¨ç¤ºå¯¹åº”æ–‡ä»¶çš„è¡Œçš„åˆ—ã€‚ å†…å»ºå˜é‡AWKæä¾›äº†å¾ˆå¤šå†…å»ºå˜é‡æä¾›ä½¿ç”¨ï¼Œèƒ½å¤Ÿèµ·åˆ°å¾ˆå¤§çš„ä½œç”¨ã€‚ æ ‡å‡†awkå˜é‡ ARGC å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•° 12$ awk 'BEGIN&#123;print "argument=",ARGC&#125;' one two threeargument= 4 ARGV å‘½ä»¤è¡Œå‚æ•°æ•°ç»„ å¦‚ ARGV[1]=... CONVFMT æ•°å­—çš„çº¦å®šæ ¼å¼ï¼Œé»˜è®¤å€¼æ˜¯%.6g ENVIRON çŽ¯å¢ƒå˜é‡ 12$ awk 'BEGIN &#123;print "User is",ENVIRON["USER"]&#125;'User is nanyin FILENAME å½“å‰æ–‡ä»¶çš„åç§° 12$ awk 'END&#123;print "this file name is", FILENAME&#125;' mark.txtthis file name is mark.txt FS åˆ†å‰²ç¬¦ é»˜è®¤æ˜¯ç©ºæ ¼ä¹Ÿå¯ä»¥ä½¿ç”¨-Fè®¾ç½®åˆ†å‰²ç¬¦ NF å½“å‰è¡Œçš„å­—æ®µæ•°ç›® 12$ awk 'END&#123;print NF&#125;' mark.txt4 NR è¡Œå· FNR å½“å‰æ–‡ä»¶çš„è¡Œå· OFS è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ ORS è¾“å‡ºè¡Œåˆ†å‰²ç¬¦ RLENGTH è¡¨ç¤ºmatchå‡½æ•°åŒ¹é…å­—ç¬¦åºŠçš„é•¿åº¦ 12$ awk 'BEGIN &#123;if(match("One Three","ree")) &#123;print RLENGTH&#125;&#125;'3 RSTART è¡¨ç¤ºmatchå‡½æ•°ç¬¬ä¸€æ¬¡åŒ¹é…åˆ°çš„ä½ç½® 12$ awk 'BEGIN &#123;if(match("One Three","ree")) &#123;print RSTART&#125;&#125;' 8 æ“ä½œç¬¦ä¸ŽCè¯­è¨€çš„æ“ä½œç¬¦åŸºæœ¬ç›¸åŒï¼Œå¦‚æ•°å­—çš„ä¸€å…ƒäºŒå…ƒä¸‰å…ƒæ“ä½œç­‰ï¼Œå­—ç¬¦ä¸²çš„é“¾æŽ¥ï¼Œæ•°ç»„å…ƒç´ ç­‰ æ­£åˆ™è¡¨è¾¾å¼AWKå¯¹æ­£åˆ™çš„å¤„ç†éžå¸¸å¼ºå¤§ï¼Œé€šå¸¸ä½ ä¸€ä¸ªå°å°çš„æ­£åˆ™è¡¨è¾¾å¼èƒ½å¤Ÿå¤„ç†å¾ˆå¤æ‚çš„é—®é¢˜ã€‚å…³äºŽæ­£åˆ™ï¼Œæœ‰æ—¶é—´æ•´ç†ä¸€ç¯‡ä¸“é—¨å…³äºŽæ­£åˆ™çš„æ–‡ç« ã€‚ æ•°ç»„AWKæ”¯æŒå…³è”æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä»…å¯ä»¥ä½¿ç”¨æ•°å­—ç´¢å¼•çš„æ•°ç»„ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºç´¢å¼•ã€‚åˆ é™¤æ•°ç»„å…ƒç´ ä½¿ç”¨deleteè¯­å¥ æµç¨‹æŽ§åˆ¶æµç¨‹æŽ§åˆ¶if while for ä¸ŽCç›¸åŒ å‡½æ•°æŸ¥æ‰‹å†Œå§ã€‚ã€‚ä¸€æ¬¡æ€§çœ‹ä¸å®Œã€‚ã€‚ã€‚ã€‚å†…å»ºå‡½æ•°æ‰‹å†Œï¼Œè¿™é‡Œæœ‰åœ¨è¿™ç« æ¯”è¾ƒé‡è¦çš„å­—ç¬¦ä¸²å‡½æ•°ã€‚æŽ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹æœ‰å“ªäº›å‡½æ•°æ¯”è¾ƒé‡è¦ã€‚ AWKå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å‡½æ•° æ•´ç†å‡ºawkå¯¹å­—ç¬¦ä¸²çš„å‡ ä¸ªå…·ä½“å‡½æ•°æ“ä½œã€‚ asort(source,dest,how) asorti(source,dest,how) ä»¥ä¸Šä¸¤ä¸ªå‡½æ•°çš„howå…ˆä¸è§£é‡Šï¼Œå‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºsourceæ•°ç»„å’ŒæŽ’åºæ–¹å¼ï¼Œç¬¬äºŒä¸ªå¯ä»¥ä¸å†™ï¼Œé»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä½çš„è¿›è¡ŒæŽ’ä½ã€‚ 1234awk 'BEGIN&#123;a[0]="xiaohong";a[1]="aiaolan";asort(a);for(i=2;i&gt;=0;i--) &#123;print a[i]&#125;&#125;' xiaohong aiaolan` asorti()å‡½æ•°ä¼šå°†é¡ºåºæ›¿æ¢åˆ°æ•°ç»„çš„valueå¤„å¦‚ï¼š 123awk 'BEGIN&#123;a[0]="xiaohong";a[1]="aiaolan";asorti(a);for(i=2;i&gt;=0;i--) &#123;print a[i]&#125;&#125;' 1 0 gensub(regexp,replacement,how[,target]) ç±»ä¼¼gsubå’Œsub æ›¿æ¢åŒ¹é…åˆ°çš„æ­£åˆ™regexpä¸ºreplacement.å¦‚æžœhowæ˜¯gæˆ–è€…G(globalçš„ç®€å†™),åˆ™è¡¨ç¤ºæ›¿æ¢æ‰€æœ‰ä½¿ç”¨regexpåŒ¹é…åˆ°çš„å­—ç¬¦ä¸²,targetæ˜¯ç›®æ ‡å­—ç¬¦ä¸² å¦‚æžœä½¿ç”¨regexpæœªåŒ¹é…åˆ°ï¼Œåˆ™è¿”å›žåŽŸå§‹targetçš„å€¼ 1234567891011# ç¬¬ä¸€ä¸ªecho a b c a d | gawk '&#123;print gensub(/a/,"AA",2)&#125;' a b c AA d# ç¬¬äºŒä¸ªawk 'BEGIN&#123;a="abc def"b = gensub(/(.+) (.+)/,"\\2 \\1","g",a)print b&#125;'def abc gsub(regexp,replacement[,target]) gsubä¸­çš„â€˜gâ€™å…¶å®žæ˜¯è¡¨ç¤ºçš„æ˜¯global,å¯»æ‰¾ç›®æ ‡çš„åŒ¹é…åˆ°ä»Žå·¦æœ€é•¿çš„ï¼Œä¸é‡å çš„,æ‰¾åˆ°å¹¶ä¸”æ›¿æ¢æŽ‰ã€‚ 1&#123; gsub(/Britain/, "United Kingdom"); print &#125; è¿”å›žçš„å€¼ä¸ºåŒ¹é…åˆ°çš„æ¬¡æ•° index(in,find) å¯»æ‰¾inä¸²å†…ç¬¦åˆfindåŒ¹é…åˆ°çš„å­—ç¬¦çš„indexä½ç½® 123$ awk 'BEGIN&#123;quote&gt; print index("hello","lo")&#125;'4 length([string]) é¡¾åæ€ä¹‰ï¼Œä¸è§£é‡Šäº† 12$ awk 'BEGIN&#123;print length("hello")&#125;'5 NOTE: If no argument is supplied, length() returns the length of $0. match(string,regexp,[,array]) ä½¿ç”¨æ­£åˆ™åŒ¹é…å­—ç¬¦ä¸²ï¼Œè¿”å›žåŒ¹é…åˆ°çš„ä½ç½®ï¼Œè‹¥æœªåŒ¹é…åˆ°è¿”å›ž0 split(string,array[,fieldsep[,seps]]) åˆ†å‰²stringå­—ç¬¦ä¸²ï¼Œä½¿ç”¨arrayå­˜æ”¾åˆ†å‰²åŽäº§ç”Ÿçš„å­—ç¬¦ç»„ï¼Œä½¿ç”¨fieldsepç»„ä¸ºåˆ†å‰²ç¬¦ï¼Œsepså­˜æ”¾æ¯æ¬¡åˆ†å‰²äº§ç”Ÿçš„åˆ†å‰²ç¬¦ã€‚ä¸€ä¸ªåˆ†å‰²å‡ºæ¥çš„å­˜æ”¾åˆ°array[1]ä¸­ï¼Œç¬¬äºŒä¸ªå­˜æ”¾åˆ°array[2]ä¸­ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚å¦‚æžœåˆ†å‰²ç¬¦fieldsepä¸å†™ï¼Œåˆ™é»˜è®¤åˆ†å‰²ç¬¦ä¸ºç©ºæ ¼ã€‚ 12345$ awk 'BEGIN&#123;print split("cul-de-sac",a,"-",seps);for(i=1;i&lt;4;i++)&#123;print a[i]&#125;&#125;' 3culdesac sprintf(format,expression1,..) æ˜¯printfçš„åŠŸèƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¿”å›žå­—ç¬¦ä¸² strtonum (str) ç±»ä¼¼javaçš„parseInt()å‡½æ•°ï¼Œç”±Stringå­—ç¬¦ä¸²è½¬æˆæ•°å­— subï¼ˆregexp,replacement[,target]ï¼‰ æœ€å·¦æœ€é•¿åŒ¹é…åŽŸåˆ™è¿›è¡ŒåŒ¹é…ï¼Œsubä¸ªgsubçš„ä½œç”¨ç›¸åŒï¼Œåˆ†å‰²å­—ç¬¦ä¸²ï¼Œå¹¶è¿›è¡Œæ›¿æ¢ substr(string,start[,end]) åˆ†å‰²å­—ç¬¦ä¸² tolower(string) &amp; toupper(string) å¤§å°å†™è½¬æ¢ å…³äºŽawkçš„å°±æ€»ç»“åˆ°è¿™äº†ã€‚ã€‚ååˆ†åŸºç¡€çš„æ€»ç»“ã€‚ã€‚æŽ¨èæ–‡æ¡£ï¼Œæ¸…æ™°æ˜Žäº†ã€‚ä¸‹ä¸€ç¯‡æ‰“ç®—å…ˆæ•´ç†æ•´ç†æ­£åˆ™è¡¨è¾¾å¼ã€‚çŽ°åœ¨å“ªé‡Œéƒ½ä¼šç”¨åˆ°æ­£åˆ™ï¼Œè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çœ‹çœ‹æ­£åˆ™çš„ã€‚]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaè®¾è®¡æ¨¡å¼åˆ†ç±»å’ŒåŽŸåˆ™]]></title>
    <url>%2F2018%2F04%2F17%2F2018-04-17-Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%88%86%E7%B1%BB%E5%92%8C%E5%8E%9F%E5%88%99%2F</url>
    <content type="text"><![CDATA[Javaè®¾è®¡æ¨¡å¼åˆ†ç±»ä¸ŽåŽŸåˆ™æ¯æ¬¡å­¦ä¹ å®Œè®¾è®¡æ¨¡å¼ï¼Œè¿‡ä¸€é˜µå°±å¿˜äº†ï¼Œæ‰€ä»¥å†™å‡ ç¯‡åšå®¢è®°å½•ä¸‹ï¼Œè®©è‡ªå·±çš„è®°å¿†æ›´æ·±åˆ»ä¸€ä¸‹ã€‚ æŽ¨è Javaä¸­23ç§è®¾è®¡æ¨¡å¼â€“è¶…å¿«é€Ÿå…¥é—¨åŠä¸¾ä¾‹ä»£ç  è¿™ç¯‡åšå®¢ã€‚èƒ½å¿«é€Ÿäº†è§£è®¾è®¡æ¨¡å¼ã€‚ æŽ¨ègithubä¸Šçš„é¡¹ç›®java-design-patterns æœ‰ä¾‹å­æºç ï¼Œå¯ä»¥é€šè¿‡å…·ä½“ä¾‹å­äº†è§£è®¾è®¡æ¨¡å¼ã€‚ Javaè®¾è®¡æ¨¡å¼çš„åŸºæœ¬åˆ†ç±»javaçš„è®¾è®¡æ¨¡å¼å¤§ä½“ä¸Šåˆ†ä¸ºä¸‰å¤§ç±»ï¼š åˆ›å»ºåž‹æ¨¡å¼ï¼ˆ5ç§ï¼‰ï¼šå·¥åŽ‚æ–¹æ³•æ¨¡å¼ï¼ŒæŠ½è±¡å·¥åŽ‚æ¨¡å¼ï¼Œå•ä¾‹æ¨¡å¼ï¼Œå»ºé€ è€…æ¨¡å¼ï¼ŒåŽŸåž‹æ¨¡å¼ã€‚ ç»“æž„åž‹æ¨¡å¼ï¼ˆ7ç§ï¼‰ï¼šé€‚é…å™¨æ¨¡å¼ï¼Œè£…é¥°å™¨æ¨¡å¼ï¼Œä»£ç†æ¨¡å¼ï¼Œå¤–è§‚æ¨¡å¼ï¼Œæ¡¥æŽ¥æ¨¡å¼ï¼Œç»„åˆæ¨¡å¼ï¼Œäº«å…ƒæ¨¡å¼ã€‚ è¡Œä¸ºåž‹æ¨¡å¼ï¼ˆ11ç§ï¼‰ï¼šç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ è®¾è®¡æ¨¡å¼éµå¾ªçš„åŽŸåˆ™æœ‰å…­ä¸ª å¼€é—­åŽŸåˆ™ï¼ˆOpen Close Principleï¼‰ å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ é‡Œæ°ä»£æ¢åŽŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰ åªæœ‰å½“è¡ç”Ÿç±»å¯ä»¥æ›¿æ¢æŽ‰åŸºç±»ï¼Œè½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼ŒåŸºç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œè¡ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨åŸºç±»çš„åŸºç¡€ä¸Šå¢žåŠ æ–°çš„è¡Œä¸ºã€‚ ä¾èµ–å€’è½¬åŽŸåˆ™ï¼ˆDependence Inversion Principleï¼‰ è¿™ä¸ªæ˜¯å¼€é—­åŽŸåˆ™çš„åŸºç¡€ï¼Œå¯¹æŽ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºŽæŠ½è±¡è€Œä¸ä¾èµ–äºŽå…·ä½“ã€‚ æŽ¥å£éš”ç¦»åŽŸåˆ™ï¼ˆInterface Segregation Principleï¼‰ ä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æŽ¥å£æ¥é™ä½Žè€¦åˆåº¦ã€‚ è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆæœ€å°‘çŸ¥é“åŽŸåˆ™ï¼‰ï¼ˆDemeter Principleï¼‰ ä¸€ä¸ªå®žä½“åº”å½“å°½é‡å°‘çš„ä¸Žå…¶ä»–å®žä½“ä¹‹é—´å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œä½¿å¾—ç³»ç»ŸåŠŸèƒ½æ¨¡å—ç›¸å¯¹ç‹¬ç«‹ã€‚ åˆæˆå¤ç”¨åŽŸåˆ™ï¼ˆComposite Reuse Principleï¼‰ åŽŸåˆ™æ˜¯å°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚ç»§æ‰¿å®žé™…ä¸Šç ´åäº†ç±»çš„å°è£…æ€§ï¼Œè¶…ç±»çš„æ–¹æ³•å¯èƒ½ä¼šè¢«å­ç±»ä¿®æ”¹ã€‚]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆå››ï¼‰ bashä¸­çš„æ“ä½œåŠç›¸å…³è¯é¢˜]]></title>
    <url>%2F2018%2F04%2F12%2F2018-04-16-bash_operationAndRelatedTopics%2F</url>
    <content type="text"><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆå››ï¼‰ bashä¸­çš„æ“ä½œåŠç›¸å…³è¯é¢˜è®¡ç®—ç¬¦ Operatorsä¸€.èµ‹å€¼ï¼ˆassignmentï¼‰å˜é‡èµ‹å€¼ï¼šåˆå§‹åŒ–å˜é‡æˆ–è€…æ”¹å˜å˜é‡çš„å€¼ åœ¨æ‰€æœ‰çš„èµ‹å€¼æ“ä½œä¸­ï¼Œè®¡ç®—èµ‹å€¼å’Œå­—ç¬¦ä¸²å¤åˆ¶éƒ½æ˜¯å¯ä»¥çš„ï¼Œå¹¶ä¸å­˜åœ¨å·®å¼‚ã€‚ 123var=27category=minerals # No spaces allowed after the &quot;=&quot;. äºŒ.è®¡ç®—æ“ä½œç¬¦+ï¼Œ-ï¼Œ*ï¼Œ/,%ï¼ˆå–æ¨¡è¿ç®—ï¼‰ï¼Œ+=ï¼Œ-=ï¼Œ*=,/=,%=è¿™äº›æ“ä½œç¬¦å’Œå…¶ä»–è¯­è¨€ï¼ˆæ¯”å¦‚javaï¼‰è¯­ä¹‰ç›¸åŒã€‚å”¯ä¸€æœ‰ä¸ªå·®å¼‚çš„æ˜¯ ** æ˜¯ä¹˜æ–¹æ“ä½œ 12345678910111213#ä¸€èˆ¬èµ‹å€¼i=1bash=&quot;/bin/bash&quot;#ä¸€èˆ¬æ“ä½œç¬¦let &quot;z=i+1&quot;echo $zlet &quot;i+=2&quot;echo $ilet &quot;z=i**2&quot;echo $z éœ€è¦æ³¨æ„çš„æ˜¯bashä¸èƒ½ç†è§£æµ®ç‚¹æ•°ï¼Œä»–ä¼šé»˜è®¤æŠŠæµ®ç‚¹æ•°å½“ä½œå­—ç¬¦ä¸²æ¥å¤„ç†ã€‚ éœ€è¦åœ¨è„šæœ¬ä¸­ä½¿ç”¨ bcæ¥è®¡ç®—æµ®ç‚¹æ•° ä¸‰.å…¶ä»–æ“ä½œç¬¦ æŒ‰ä½æ“ä½œï¼š &lt;&lt; : bitwise left shift (multiplies by 2 for each shift position) &gt;&gt;: bitwise right shift (divides by 2 for each shift position) &amp;,|ï¼Œï½žï¼Œ^ : åˆ†åˆ«å¯¹åº” ä½ä¸Žï¼Œä½æˆ–ï¼Œä½å¦,å¼‚æˆ– é€»è¾‘æ“ä½œ ï¼ ï¼šéž &amp;&amp; ï¼š AND || ï¼š OR æ‚é¡¹ ï¼Œ ï¼šé€—å·æ“ä½œç¬¦ï¼Œè¿žæŽ¥å¤šä¸ªè®¡ç®—è¡¨è¾¾å¼ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ ·åªèƒ½è¿”å›žæœ€åŽä¸€ä¸ªç®—å¼çš„å€¼ 1234567let "t1 = ((5 + 3, 7 - 1, 15 - 4))"echo "t1 = $t1" # t1 = 11# Here t1 is set to the result of the last operation. Why?let "t2 = ((a = 9, 15 / 3))" # Set "a" and calculate "t2".echo "t2 = $t2 a = $a" # t2 = 5 a = 9`]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆä¸‰ï¼‰ bashä¸­çš„é€€å‡ºç å’Œæµ‹è¯•ï¼ˆTestï¼‰]]></title>
    <url>%2F2018%2F04%2F12%2F2018-04-12-bash_exitCode%2F</url>
    <content type="text"><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆä¸‰ï¼‰ bashé€€å‡ºç å’Œæµ‹è¯•1. Bashé€€å‡ºç  è„šæœ¬çš„é€€å‡ºå‘½ä»¤ï¼Œç±»ä¼¼Cè¯­è¨€ä¸­çš„ return value ï¼Œå¯ä»¥ä¾›è„šæœ¬çš„çˆ¶è¿›ç¨‹è°ƒç”¨ã€‚ æ¯æ¡å‘½ä»¤è¿”å›žä¸€æ¡çŠ¶æ€çŠ¶æ€ï¼Œå‘½ä»¤æ‰§è¡ŒæˆåŠŸè¿”å›ž0ï¼Œæ‰§è¡Œå¤±è´¥è¿”å›žéž0çŠ¶æ€ç å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé”™è¯¯ç ï¼ˆerror codeï¼‰ã€‚ æœ€åŽçš„å‘½ä»¤è¿”å›žçš„çŠ¶æ€æˆ–è€… exit nnnï¼ˆè¿™é‡Œçš„nnnå¿…é¡»æ˜¯1ï½ž255ä¹‹é—´çš„æ•´æ•°ï¼‰ä¼ é€’ç»™shellã€‚ exit nnn exit exit $? æˆ–è€…ç©ºã€‚éƒ½å¯ä»¥ï¼Œæ˜¯bash Return valueçš„æ–¹å¼ã€‚ å¯ä»¥ä½¿ç”¨ ï¼æ¥åè½¬çŠ¶æ€ã€‚ 2. Bashä¸­çš„testæ¯ä¸ªç¼–ç¨‹è¯­è¨€éƒ½ä¼šæœ‰å¯¹ä¸€ä¸ªæƒ…å†µä¸‹æµ‹è¯•çš„åŠŸèƒ½ï¼ŒBashä¹Ÿä¸ä¾‹å¤–ï¼Œbashæä¾›testå‘½ä»¤ï¼Œå¤šç§çš„æ‹¬å·æ“ä½œï¼Œæœ€ç»ˆè¦çš„If/elseç»“æž„è¯­å¥æ¥å®žçŽ°teståŠŸèƒ½ã€‚ æµ‹è¯•ç»“æž„ä½“(Test Constructs) ä¸€ä¸ªif/elseç»“æž„ä½“ä¼šæµ‹è¯•ä¸€ç³»åˆ—å‘½ä»¤çš„è¿”å›žå€¼æ˜¯å¦æ˜¯0ä¹Ÿå°±æ˜¯å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚å¦‚æžœæˆåŠŸæ‰§è¡Œå¦å¤–ä¸€ç³»åˆ—æ“ä½œã€‚ bashä½¿ç”¨ [ æ¥è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯åœ¨åŽæ¥çš„ç‰ˆæœ¬é‡Œï¼Œbashå¼•è¿›äº† [[ æ¥æ‹“å±•testå‘½ä»¤ï¼ŒbashæŠŠ[[$a -lt $b]]çœ‹ä½œä¸€ä¸ªå…ƒç´ ï¼Œä»–ä¼šè¿”å›žä¸€ä¸ªçŠ¶æ€ç ï¼ˆæˆåŠŸ0ï¼Œä¸æˆåŠŸæ˜¯éž0ï¼‰ å½“ä½¿ç”¨let å’Œ (()) çš„æ—¶å€™ï¼Œå¯¹è®¡ç®—è¡¨è¾¾å¼è¿›è¡Œè¿ç®—çš„æ—¶å€™ä¹Ÿä¼šè¿”å›žexit codeï¼Œç”¨äºŽå¯¹ç®—å¼çš„æµ‹è¯• 1234567891011121314151617181920212223242526272829(( 0 &amp;&amp; 1 )) # Logical ANDecho $? # 1 ***# And so ...let &quot;num = (( 0 &amp;&amp; 1 ))&quot;echo $num # 0# But ...let &quot;num = (( 0 &amp;&amp; 1 ))&quot;echo $? # 1 ***(( 200 || 11 )) # Logical ORecho $? # 0 ***# ...let &quot;num = (( 200 || 11 ))&quot;echo $num # 1let &quot;num = (( 200 || 11 ))&quot;echo $? # 0 ***(( 200 | 11 )) # Bitwise ORecho $? # 0 ***# ...let &quot;num = (( 200 | 11 ))&quot;echo $num # 203let &quot;num = (( 200 | 11 ))&quot;echo $? # 0 ***# The &quot;let&quot; construct returns the same exit status#+ as the double-parentheses arithmetic expansion. ifå¯ä»¥æµ‹è¯•ä»»ä½•æ¡ä»¶ ä¸ä»…ä»…æ˜¯åŒ…åœ¨æ‹¬å·é‡Œé¢çš„æ¡ä»¶ã€‚ Else if and elif elifç›¸å½“ä¸Ž else ifï¼Œè¦è¯·æ±‚åˆ†æ”¯éœ€è¦ç”¨åˆ°elif 12345678910111213if [ condition1 ]thencommand1command2command3elif [ condition2 ]# Same as else ifthencommand4command5elsedefault-commandfi Equivalence of test, /usr/bin/test,[ ], and /usr/bin/[ ä½¿ç”¨è¿™å‡ ä¸ªåšåˆ¤æ–­éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ›´å¤æ‚çš„è¡¨è¾¾å¼è¦ä½¿ç”¨[[]]æ¥ä»£æ›¿[]ã€‚ Using the [[ â€¦ ]] test construct, rather than [ â€¦ ] can prevent many logic errors in scripts. è¿™æ˜¯Advanced Bash-Scripting Guideç»™å‡ºçš„å»ºè®®ã€‚ æ–‡ä»¶æµ‹è¯•æ“ä½œï¼ˆFileï¼‰ -e æ–‡ä»¶æ˜¯å¦å­˜åœ¨ -a æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆä»¥å¼ƒç”¨ï¼‰ -f æ˜¯å¦æ˜¯æ™®é€šæ–‡ä»¶(ä¸æ˜¯ç›®å½•æ–‡ä»¶æˆ–è€…è®¾å¤‡æ–‡ä»¶) -s æ˜¯å¦æ˜¯ç©ºæ–‡ä»¶ -d æ˜¯å¦æ˜¯ç›®å½• -b æ˜¯å¦æ˜¯å—è®¾å¤‡(block device) -c æ˜¯å¦æ˜¯å­—ç¬¦è®¾å¤‡(character device) -h æ˜¯å¦æ˜¯é“¾æŽ¥æ–‡ä»¶(symbolic link) -S file is socket -r -w -x åˆ†åˆ«å¯¹åº”æ–‡ä»¶çš„ è¯»å†™æ‰§è¡Œæƒé™ -O æ˜¯å¦æ˜¯æ–‡ä»¶çš„æ‹¥æœ‰è€… -G group-idæ˜¯å¦å’Œä½ è‡ªå·±çš„ç›¸åŒ -N åœ¨æœ€åŽä¸€æ¬¡è¢«è¯»ä¹‹åŽæ–‡ä»¶å·²ç»æ›´æ”¹ f1 -nt f2 f1æ¯”f2æ–° -ot f1æ¯”f2æ—§ -ef f1å’Œf2 å¼•ç”¨åŒä¸€ä¸ªæ–‡ä»¶ ä¾‹å­ 12345678for directory in $directorys; do if [ -d $directory ] then linkchk $directory else echo "$directory is not a directory" echo "Usage: $0 dir1 dir2 ..." fidone å…¶ä»–æ¯”è¾ƒæ“ä½œï¼ˆIntegerï¼ŒStringï¼‰æ•´åž‹å’Œå­—ç¬¦ä¸²ç±»åž‹ä½¿ç”¨ä¸¤ç»„ä¸åŒçš„æ“ä½œ æ•´å½¢ -eq ç›¸ç­‰æ¯”è¾ƒ if [ &quot;$a&quot; -eq &quot;$b&quot; ] -ne æ¯”è¾ƒä¸ç›¸ç­‰ if [ &quot;$a&quot; -ne &quot;$b&quot; ] -gt å¤§äºŽç­‰äºŽ(is greater than or equal to) if [ &quot;$a&quot; -ge &quot;$b&quot; ] -lt å°äºŽ(is less than) if [ &quot;$a&quot; -lt &quot;$b&quot; ] -le å°äºŽç­‰äºŽ(is less than or equal to) `if [ â€œ$aâ€ -le â€œ$bâ€ ] &lt; &gt; &lt;= &gt;= å¯¹åº”å¤§äºŽï¼Œå°äºŽï¼Œå°äºŽç­‰äºŽï¼Œå¤§äºŽç­‰äºŽè¿™äº›ç›¸åº”çš„æ“ä½œ Stringç±»åž‹ = åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ == å’Œ = ç›¸åŒï¼ŒåŒæ ·æ˜¯åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸åŒ ä½† == åœ¨ [] å’Œ [[]] ä¸­å®šä¹‰ä¸åŒï¼Œä¸‹é¢ä¸¾ä¾‹ï¼š 12345[[ $a == z* ]] # True if $a starts with an &quot;z&quot; (pattern matching).[[ $a == &quot;z*&quot; ]] # True if $a is equal to z* (literal matching).[ $a == z* ] # File globbing and word splitting take place.[ &quot;$a&quot; == &quot;z*&quot; ] # True if $a is equal to z* (literal matching). != ä¸ç­‰äºŽ &lt; and &gt; å¤§äºŽå°äºŽ æŒ‰ç…§ASCII ç æ¯”è¾ƒ -z ç©ºå­—ç¬¦ä¸²,å› æ­¤ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¸º0 -n å­—ç¬¦ä¸²ä¸ä¸ºç©º é€»è¾‘æ¯”è¾ƒ -a è¡¨ç¤ºé€»è¾‘ä¸Ž -o è¡¨ç¤ºé€»è¾‘æˆ– -a -o è¦ä½¿ç”¨åœ¨å•ä¸ªä¸­æ‹¬å·ä¸­if [ &quot;$expr1&quot; -a &quot;$expr2&quot; ] &amp;&amp; and || ä½†æ˜¯è¦åœ¨åŒä¸­æ‹¬å·ä¸­ä½¿ç”¨[[ condition1 &amp;&amp; condition2 ]] åµŒå¥— if elseå¦‚å…¶ä»–ç¼–ç¨‹è¯­è¨€ç±»ä¼¼,if elseç»“æž„èƒ½å¤ŸåµŒå¥—ï¼Œä½†æ˜¯åµŒå¥—ç»“æž„å’Œä½¿ç”¨ &amp;&amp; æ¯”è¾ƒç¬¦ç»“æžœç›¸åŒ 12345678910111213141516a=3if [ &quot;$a&quot; -gt 0 ]then if [ &quot;$a&quot; -lt 5 ] then echo &quot;The value of \&quot;a\&quot; lies somewhere between 0 and 5.&quot; fifi# Same result as:if [ &quot;$a&quot; -gt 0 ] &amp;&amp; [ &quot;$a&quot; -lt 5 ]then echo &quot;The value of \&quot;a\&quot; lies somewhere between 0 and 5.&quot;fi]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆäºŒï¼‰ bashä¸­çš„å˜é‡å’Œå‚æ•°]]></title>
    <url>%2F2018%2F04%2F11%2F2018-4-11-bash_%E5%8F%98%E9%87%8F%2F</url>
    <content type="text"><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆäºŒï¼‰ bashä¸­çš„å˜é‡å’Œå‚æ•°å˜é‡å°±æ˜¯ä¸€ä¸ªæ ‡ç­¾åœ¨è„šæœ¬ä¸­ä»£è¡¨æ•°æ®ï¼Œä¸è¿‡æ˜¯ç»™åˆ†é…åœ¨ç”µè„‘å†…å­˜ä¸­çš„æ•°æ®ä¸€ä¸ªåå­—ï¼Œç»å¸¸ä¼šå‡ºçŽ°åœ¨æ•°å­¦è®¡ç®—å’Œå¤§é‡æ“ä½œ(manipulation of quantities)å’Œå­—ç¬¦ä¸²è§£æž(string parsing)ä¸­ã€‚ å˜é‡ç½®æ¢ (Variable Substitution) $The name of a variable is a placeholder for its value, the data it holds. Referencing (retrieving) its value is called variable substitution. å¤§è‡´æ„æ€å°±æ˜¯å˜é‡å¼•ç”¨å…·ä½“çš„å€¼ã€‚ä½¿ç”¨$æ¥å¼•ç”¨å˜é‡ å¦‚ 1234567bash$ variable1=23bash$ echo variable1//variable1bash$ echo $variable1//23 åœ¨(â€œ..â€)é‡Œå¼•ç”¨ä¸ä¼šå¹²æ¶‰å˜é‡çš„å¼•ç”¨ï¼Œè¿™å«åšå±€éƒ¨å¼•ç”¨(partial quoting),ä¹Ÿå«å¼±å¼•ç”¨.ä½†ä½¿ç”¨(â€˜..â€™)å•å¼•å·ä¼šç›´æŽ¥æŠŠå˜é‡åæ‰“å°å‡ºæ¥ï¼Œä¸ä¼šå¼•ç”¨å˜é‡ï¼Œå«åšå…¨å¼•ç”¨(full quoting),ä¹Ÿå«åšå¼ºå¼•ç”¨ã€‚ æ³¨æ„ï¼šå…¶å®žä½¿ç”¨$variable1å’Œä½¿ç”¨${variable1}æ˜¯ä¸€æ ·çš„ä½†æ˜¯æŸäº›è¯­å¢ƒä¸‹å‰è€…å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚ æœªåˆå§‹åŒ–çš„å˜é‡æœ‰ä¸€ä¸ªé»˜è®¤çš„çš„å€¼ä¸ºâ€nullâ€œè€Œä¸æ˜¯â€˜0â€™ï¼Œå¹¶ä¸”bashä¸­çš„å˜é‡ä¸åˆ†ç±»åž‹ã€‚ å˜é‡åˆ†é…(Variable Assignment) =ç­‰å·-&gt; the assignment operator (no space before and after) å‰åŽä¸èƒ½æœ‰ç©ºæ ¼ 12345#ä¸¾ä¸€ä¸ªæ¯”è¾ƒå…¸åž‹çš„å°ä¾‹å­ï¼Œä¹‹å‰ä¸çŸ¥é“åŒºåˆ«ã€‚ã€‚a=`ls -l` # Assigns result of &apos;ls -l&apos; command to &apos;a&apos;echo $a # Unquoted, however, it removes tabs and newlines.echoecho &quot;$a&quot; # The quoted variable preserves whitespace. ä½¿ç”¨åŒå¼•å·æ‰©èµ·æ¥çš„$aæœ‰ç©ºæ ¼ï¼Œè€Œæ²¡æœ‰åŒå¼•å·çš„æ˜¯åŽ»æŽ‰ç©ºæ ¼çš„ã€‚ 12R=$(cat /etc/redhat-release)arch=$(uname -m) å¯ä»¥çœ‹å‡ºä½¿ç”¨$()çš„ä½œç”¨å’Œä½¿ç”¨``çš„ä½œç”¨ç›¸åŒï¼Œéƒ½å¯ä»¥å¯¹å‘½ä»¤è¿›è¡ŒåŒ…è£¹ã€‚ bashå˜é‡æ²¡æœ‰ç±»åž‹ä¸åƒå…¶ä»–çš„å¾ˆå¤šç¼–ç¨‹è¯­è¨€ï¼Œbashè„šæœ¬ä¸­çš„å˜é‡æ˜¯æ²¡æœ‰ç±»åž‹çš„ã€‚æ— ç±»åž‹çš„å˜é‡æ˜¯æŠŠåŒåˆƒå‰‘ï¼Œä¸€æ–¹é¢æ›´åŠ çµæ´»ï¼Œå¦ä¸€æ–¹é¢ä¼šæ¸—é€ä¸€äº›å°çš„é—®é¢˜ã€‚ æ‰€ä»¥bashæä¾›å£°æ˜Žå˜é‡ï¼Œä¼šåœ¨åŽé¢çš„ç« èŠ‚å¯¹å£°æ˜Žå˜é‡çš„å‚æ•°ç­‰ä¿¡æ¯è¯¦ç»†åˆ—å‡ºæ¥ã€‚ ç‰¹æ®Šçš„å˜é‡ç±»åž‹(Special Variable Types) æœ¬åœ°å˜é‡ï¼šå˜é‡åªèƒ½åœ¨ä»£ç å—å’Œå‡½æ•°ä¸­å¯è§ ç³»ç»Ÿå˜é‡ï¼šå˜é‡å½±å“shellçš„è¡Œä¸ºå’Œç”¨æˆ·çš„æŽ¥å£ï¼ˆæ¯”å¦‚è®¾ç½®JavaçŽ¯å¢ƒå˜é‡ï¼‰ å¦‚æžœè„šæœ¬éœ€è¦è®¾ç½®çŽ¯å¢ƒå˜é‡é‚£ä¹ˆå°±åŽ» export .. ä½ç½®å‚æ•°ï¼š $0æ˜¯è„šæœ¬åç§°ï¼Œ1-9ç­‰å¯¹åº”å…¶ä½ç½®ï¼Œ10ä¹‹åŽè¦ä½¿ç”¨å¤§æ‹¬å·æ‰©èµ·æ¥ã€‚$#å¯¹åº”æœ€åŽä¸€ä¸ªå…ƒç´  ä½¿ç”¨shiftå‘½ä»¤å¯ä»¥å°†ä½ç½®å‚æ•°é‡æ–°æŽ’åˆ—ï¼Œå®žé™…ä¸Šå°±æ˜¯å‘å·¦ç§»åŠ¨ä¸€çº§ã€‚ è¿™æ¬¡ç¯‡å¹…è¾ƒå°ï¼Œä¸»è¦è®²äº†è®²bashä¸­çš„å˜é‡å’Œä½ç½®å‚æ•°çš„å«ä¹‰å’Œä½¿ç”¨ï¼Œå±žäºŽéžå¸¸åŸºç¡€ï¼Œéžå¸¸å®¹æ˜“ç†è§£çš„éƒ¨åˆ†ã€‚]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆä¸€ï¼‰ åˆè¯†å’Œbashä¸­çš„ç‰¹æ®Šå­—ç¬¦]]></title>
    <url>%2F2018%2F04%2F10%2F2018-04-10-bash%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[bashå­¦ä¹ è®°å½•ï¼ˆä¸€ï¼‰åˆè¯†bashå’Œç‰¹æ®Šå­—ç¬¦åˆè¯†Bashé‰´äºŽæœ¬äººçš„è¡¨è¾¾èƒ½åŠ›ï¼Œä¸é€‚åˆæƒ³è¦åŽ»ç³»ç»Ÿå­¦ä¹ bashçš„äººæ¥æŸ¥çœ‹ï¼Œæå‰åˆ†äº«ä¸¤ä¸ªä¸åŒé˜¶æ®µï¼Œä¸åŒäººç¾¤å­¦ä¹ çš„èµ„æ–™ã€‚ æƒ³è¦å­¦ä¹ bashä½†æ˜¯ä¸æƒ³å­¦ä¹ å¤ªæ·±çš„äºº: bash-handbook æƒ³è¦ç³»ç»Ÿå­¦ä¹ bashçš„äººï¼šAdvanced Bash-Scripting Guide å…¶å®žbashå¾ˆéš¾ï¼Œè¦è€ƒè™‘çš„ä¸œè¥¿å¾ˆå¤šï¼Œä½†çŽ°åœ¨å­¦åˆ°çš„åªæ˜¯çš®æ¯›ï¼Œå¸Œæœ›èƒ½å¤Ÿå¤šçœ‹å¤šå®žè·µï¼Œæ‰èƒ½æ›´è¿›ä¸€æ­¥ã€‚ Starting Off With a Sha-Bangsha-bang(#!)åœ¨èµ·å§‹çš„ä½ç½®æ¥å‘Šè¯‰ä½ çš„ç³»ç»Ÿè¿™ä¸ªæ–‡ä»¶æ˜¯å‘½ä»¤çš„é›†åˆï¼Œèƒ½å¤Ÿä½¿ç”¨å“ªä¸ªå‘½ä»¤è§£é‡Šå™¨æ¥æ‰§è¡Œï¼ˆ/bin/bashï¼‰-&gt;path,è¿™ä¸ªå‘½ä»¤è·¯å¾„å¿…é¡»æ­£ç¡® å¦‚æžœç³»ç»Ÿé»˜è®¤è§£é‡Šå™¨æ˜¯/bin/bash æˆ–è€…å…¶ä»– åˆ™ä¸ç”¨ä½¿ç”¨ #! /bin/bash æ¥æ”¾åˆ°å¼€å¤´ Special Charactersä¸‹é¢æ¥ç®€å•æ€»ç»“ä¸€ä¸‹æœ‰ç‰¹æ®Šæ„ä¹‰çš„å­—ç¬¦ â€˜#â€˜ è·Ÿåœ¨#å·åŽé¢çš„ç›¸å½“ä¸Žæ˜¯æ³¨é‡Šï¼Œä¸ä¼šè¢«è§£é‡Šå™¨æ‰§è¡Œ,å¯ä»¥å‡ºçŽ°å•è¡Œï¼Œä¹Ÿå¯ä»¥å‡ºçŽ°åœ¨å‘½ä»¤åŽä½œæ³¨é‡Šç”¨ ; åˆ†å· å…è®¸å°†å¤šæ¡å‘½ä»¤æ”¾åˆ°å•è¡Œç”¨ ;; ä¸¤ä¸ªåˆ†å·ï¼Œåœ¨caseçš„åœºæ™¯ä¸‹ä½¿ç”¨ å¦‚ 1234567case "$variable" inabc) echo "\$variable = abc" ;;xyz) echo "\$variable = xyz" ;;esac . dot ç›¸å½“ä¸Žlinuxçš„å†…å»ºå‘½ä»¤source ä½œä¸ºæ–‡ä»¶åçš„ä¸€éƒ¨åˆ† å¦‚ .vimrcç­‰ ä½œä¸ºç›®å½•å¯¼å‘ å¦‚ ./è¡¨ç¤ºå½“å‰ç›®å½• ../ç›¸å½“ä¸Žçˆ¶ç›®å½• æ­£åˆ™è¡¨è¾¾å¼ä¸­å¯ä»¥è¡¨ç¤ºä¸º1ä¸ªå­—ç¬¦ â€œ åŒå¼•å· éƒ¨åˆ†å¼•ç”¨å­—ç¬¦ä¸²ï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯èƒ½å¤Ÿå¼•ç”¨å˜é‡ â€˜$valueâ€™ï¼Œå¹¶ä¸”ç‰¹æ®Šå­—ç¬¦éœ€è¦è½¬ä¹‰ â€˜ å•å¼•å· å¯ä»¥ä¿å­˜å…¨éƒ¨ç‰¹æ®Šå­—ç¬¦ï¼Œä¸èƒ½å¼•ç”¨å˜é‡ , é€—å· è¡¨ç¤ºè¿žæŽ¥å¤šä¸ªè®¡ç®—è¡¨è¾¾å¼,å¤šä¸ªè¡¨è¾¾å¼éƒ½ä¼šæ‰§è¡Œï¼Œä½†æ˜¯åªæœ‰æœ€åŽä¸€ä¸ªè®¡ç®—å¼ä¼šè¿”å›žå€¼ ã€‚ä¹Ÿåšé“¾æŽ¥å­—ç¬¦ä¸² 12let "t2 = ((a = 9, 15 / 3))"# Set "a = 9" and "t2 = 15 / 3" \ åæ–œæ  escape [backslash] å¯æ˜¯å®žçŽ°å¯¹å•ä¸ªå­—ç¬¦çš„è½¬ä¹‰ / æ–œæ  Filename path separator [forward slash]æœ¬èº«å°±å«åšæ–‡ä»¶åˆ†å‰²ç¬¦å¯ä»¥æ˜Žäº†åšä»€ä¹ˆç”¨çš„äº† ` command substitution å‘½ä»¤æ›¿æ¢ å¦‚ a=`echo â€œhello worldâ€ `;echo $a ç­‰ æˆ–è€… a=`date` ; echo $a : å†’å· ç©ºå‘½ä»¤ç­‰ä»·ä¸Žâ€˜NOPâ€™ do-nothing operation ä¹Ÿæ˜¯æœ‰çŠ¶æ€çš„ç›¸å½“ä¸Žå†…å»ºå‡½æ•° true æ¯”å¦‚ 12345678910111213while :dooperation-1operation-2...operation-ndone# Same as:# while true# do# ...# done ä½œifåˆ¤æ–­çš„åˆ†æ”¯ 12345if conditionthen : # Do nothing and branch aheadelse # Or else ...take-some-actionfi æ”¾åœ¨å¿…é¡»è¦æœ‰ä¸¤å…ƒæ“ä½œçš„åœ°æ–¹ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå¦‚ï¼š: ${username=`whoami`} é…åˆç®¡é“å‘½ä»¤ :&gt; :&gt;&gt;å¦‚æžœæ–‡ä»¶æ²¡æœ‰å­˜åœ¨åˆ™åˆ›å»º åšåˆ†å‰²ç¬¦ å¦‚ echo $PATH ä¼šå‡ºçŽ°å¾ˆå¤šä»¥ï¼šä½œä¸ºåˆ†å‰²ç¬¦çš„å­—ç¬¦ä¸² åœ¨å‡½æ•°é‡Œå¯ä»¥ä½œä¸ºç«™ä½ç¬¦é˜²æ­¢å‡½æ•°æä¸ºç©º !å¹å· ä½œä¸º éžå‡ºçŽ° å¦‚ ï¼null æˆ–è€…é€€å‡ºç  exit codeã€‚åœ¨ä¸åŒçš„è¯­å¢ƒä¸‹å¯ä»¥ä½œä¸ºé—´æŽ¥å˜é‡å¼•ç”¨ã€‚ * æ˜Ÿå· å¯ä»¥ä½œä¸ºå…¨åŒ¹é…æ¥ä½¿ç”¨ å¦‚ echo * ã€‚ è¡¨ç¤ºä¹˜æ³• 1*2 ? é—®å· test operator. Within certain expressions, the ? indicates a test for a condition. è¿˜å¯ä»¥ä½œä¸ºåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚ $ å˜é‡å¼•ç”¨ æ­£åˆ™è¡¨è¾¾å¼ä¸­è¡¨ç¤ºè¡Œå°¾ ${} å˜é‡å¼•ç”¨ $(â€¦) å¤šä¸ªå˜é‡åŒæ—¶å¼•ç”¨ 123file1="file"file2="nofile"echo $'file1,file2' è¾“å‡ºå†…å®¹ï¼šfile1,file2 $* $@ ä½ç½®å‚æ•° $*æ˜¯å°†æ‰€æœ‰å‚æ•°ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿”å›žï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œè€Œ$@æ˜¯å°†æ¯ä¸ªå‚æ•°ä½œä¸ºå•å…ƒè¿”å›žä¸€ä¸ªå‚æ•°åˆ—è¡¨ () å°æ‹¬å· æ“ä½œç»„(a=hello; echo $a) æ•°ç»„åˆå§‹åŒ– {} èŠ±æ‹¬å·æ‰©å±• ç”¨æ¥æ‰©å±•å‚æ•° å¦‚ abou{t,y,u} [] ä¸­æ‹¬å· shellå†…å»ºæµ‹è¯•çš„ä¸€éƒ¨åˆ† è¡¨è¾¾æ•°ç»„çš„éƒ¨åˆ†å¦‚array[1] è¡¨ç¤ºå­—ç¬¦é›†çš„èŒƒå›´ï¼Œåœ¨æ­£è¡¨è¾¾å¼ä¸­ï¼Œæ–¹æ‹¬å·è¡¨ç¤ºè¯¥ä½ç½®å¯ä»¥åŒ¹é…çš„å­—ç¬¦é›†èŒƒå›´ã€‚ [[]] åŒä¸­æ‹¬å·(double brackets)ã€‚ è¿™ä¸ªç»“æž„ä¹Ÿæ˜¯æµ‹è¯•ï¼Œæµ‹è¯•[[]]ä¹‹ä¸­çš„è¡¨è¾¾å¼(Shellçš„å…³é”®å­—)ã€‚è¿™ä¸ªæ¯”å•ä¸­æ‹¬å·æ›´èƒ½é˜²æ­¢è„šæœ¬é‡Œé¢çš„é€»è¾‘é”™è¯¯ $[ â€¦ ] and (()) éƒ½è¡¨ç¤ºIntegerè®¡ç®— integer expansion. 1234a=3b=7echo $[$a+$b]echo (($a+$b)) | ç®¡é“ éžå¸¸åŸºç¡€çš„æ¦‚å¿µ å¦‚ ls|grep .. ã€‚ &amp;ï¼šåŽå°æ‰§è¡Œ &amp;&amp; å’Œ || ï¼šé€»è¾‘æ“ä½œç¬¦ + - * % å„è‡ªæ„ä¹‰å°±ä¸è¯¦ç»†è§£é‡Šäº† èµ„æ–™å¼•ç”¨ Advanced Bash-Scripting Guide æ–‡ç« ç‰¹åˆ«è¯¦å°½ï¼Œæœ‰å…´è¶£éžå¸¸é¼“åŠ±çœ‹åŽŸæ–‡ã€‚è¿™é‡Œæˆ‘åªåšäº†éƒ¨åˆ†æ¯”è¾ƒå¸¸ç”¨çš„æ¯”è¾ƒå®¹æ˜“ç†è§£çš„éƒ¨åˆ†åšäº†ç²¾ç®€ï¼ˆåŽŸè°…æˆ‘è‹±æ–‡ä¸å¥½ :) ç ´äº§ç‰ˆæ€»ç»“ - - ï¼‰ã€‚ ä½œä¸ºbashå­¦ä¹ æ€»ç»“çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œç¯‡å¹…ä¸å¤§ï¼Œå°½é‡åšåˆ°ç®€å•ï¼Œè¯¦å°½æ˜“æ‡‚ã€‚å½“é‡åˆ°é—®é¢˜èƒ½å¤Ÿå›žå¤´çœ‹ä¸€çœ‹ï¼Œå¸Œæœ›èƒ½å¤Ÿèµ·åˆ°å¥½çš„ä½œç”¨ï¼ï¼]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MarkDownåŸºæœ¬è¯­æ³•]]></title>
    <url>%2F2018%2F04%2F04%2F2018-04-08-markdown%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95%2F</url>
    <content type="text"><![CDATA[Markdownè¯­æ³•æ€»ç»“æ¦‚è¿°å…¶å®žmarkdownè¯­æ³•å¾ˆç®€æ´ï¼Œå¹¶ä¸”ç›¸å½“å¤šçš„åšå®¢ï¼Œè¿˜æœ‰é‡è¦çš„githubä¸Šçš„readmeä¹Ÿæ˜¯ç”¨markdownè¿›è¡Œç¼–è¾‘ã€‚æ‰€ä»¥æœ‰å¿…è¦æ•´ç†ä¸€ä¸‹ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œè¿›å…¥æ­£æ–‡ æ­£æ–‡ä¸€ä¸ª Markdown æ®µè½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¿žç»­çš„æ–‡æœ¬è¡Œç»„æˆï¼Œå®ƒçš„å‰åŽè¦æœ‰ä¸€ä¸ªä»¥ä¸Šçš„ç©ºè¡Œï¼ˆç©ºè¡Œçš„å®šä¹‰æ˜¯æ˜¾ç¤ºä¸Šçœ‹èµ·æ¥åƒæ˜¯ç©ºçš„ï¼Œä¾¿ä¼šè¢«è§†ä¸ºç©ºè¡Œã€‚æ¯”æ–¹è¯´ï¼Œè‹¥æŸä¸€è¡ŒåªåŒ…å«ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ï¼Œåˆ™è¯¥è¡Œä¹Ÿä¼šè¢«è§†ä¸ºç©ºè¡Œï¼‰ã€‚æ™®é€šæ®µè½ä¸è¯¥ç”¨ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦æ¥ç¼©è¿›ã€‚ åœ¨ç¼–è¾‘çš„è¿‡ç¨‹å½“ä¸­æ¯ç¼–è¾‘ä¸€å—çš„å†…å®¹ï¼Œå°±è¦ç©ºä¸€è¡Œï¼Œå¦åˆ™ä¼šå‡ºé—®é¢˜ã€‚ã€‚ã€‚ æ ‡é¢˜markdownæ”¯æŒä¸¤ç§æ ‡é¢˜çš„è¯­æ³•ï¼Œç±» Setext å’Œç±» atx å½¢å¼ã€‚ç±» Setext å½¢å¼æ˜¯ç”¨åº•çº¿çš„å½¢å¼ï¼Œåˆ©ç”¨ = ï¼ˆæœ€é«˜é˜¶æ ‡é¢˜ï¼‰å’Œ - ï¼ˆç¬¬äºŒé˜¶æ ‡é¢˜ï¼‰ï¼Œä¾‹å¦‚ï¼š This is an H1 ============= This is an H2 -â€”â€”â€”â€” æ•ˆæžœ This is an H1This is an H2 ä¹Ÿèƒ½ä½¿ç”¨atx ä½¿ç”¨ # æ¥è¿›è¡Œ1-6é˜¶çš„åˆ’åˆ† å¦‚ï¼š # This is an H1 ## This is an H2 æ•ˆæžœ This is an H1This is an H2 åŒºå—å¼•ç”¨ åŒºå—åº”ç”¨ ä½¿ç”¨ &gt; ç¬¦å·è¿›è¡Œæ ‡è¯† ã€‚èƒ½æ¯è¡Œéƒ½ä½¿ç”¨ &gt; è¿›è¡Œæ ‡è¯†ï¼Œä¹Ÿèƒ½åªåœ¨ç¬¬ä¸€è¡Œæ ‡è¯†æ•ˆæžœç›¸åŒ åˆ—è¡¨ æ— åºåˆ—è¡¨ å¯ä»¥ä½¿ç”¨*å·æˆ–è€…+å·æˆ–è€…-å·éƒ½æ˜¯ä¸€æ ·çš„ æœ‰åºåˆ—è¡¨ å¯ä»¥ä½¿ç”¨æ•°å­—åŠ è‹±æ–‡.åŠ ç©ºæ ¼ä½¿ç”¨æœ‰åºåˆ—è¡¨ åˆ†å‰²çº¿ä¸‰ä¸ªä»¥ä¸Šçš„* å°±æ˜¯åˆ†å‰²çº¿ é“¾æŽ¥Markdown æ”¯æŒä¸¤ç§å½¢å¼çš„é“¾æŽ¥è¯­æ³•ï¼š è¡Œå†…å¼å’Œå‚è€ƒå¼ä¸¤ç§å½¢å¼ã€‚ ä¸ç®¡æ˜¯å“ªä¸€ç§ï¼Œé“¾æŽ¥æ–‡å­—éƒ½æ˜¯ç”¨ [æ–¹æ‹¬å·] æ¥æ ‡è®°ã€‚ è¦å»ºç«‹ä¸€ä¸ªè¡Œå†…å¼çš„é“¾æŽ¥ï¼Œåªè¦åœ¨æ–¹å—æ‹¬å·åŽé¢ç´§æŽ¥ç€åœ†æ‹¬å·å¹¶æ’å…¥ç½‘å€é“¾æŽ¥å³å¯ï¼Œå¦‚æžœä½ è¿˜æƒ³è¦åŠ ä¸Šé“¾æŽ¥çš„ title æ–‡å­—ï¼Œåªè¦åœ¨ç½‘å€åŽé¢ï¼Œç”¨åŒå¼•å·æŠŠ title æ–‡å­—åŒ…èµ·æ¥å³å¯ï¼Œä¾‹å¦‚ï¼š This is [an example](http://example.com/ â€œTitleâ€) inline link. [This link](http://example.net/) has no title attribute. æ•ˆæžœ This is an example inline link. This link has no title attribute. ä¸‹é¢æ˜¯ä¸€ä¸ªå‚è€ƒå¼é“¾æŽ¥çš„èŒƒä¾‹ï¼š I get 10 times more traffic from [Google] [1] than from[Yahoo] [2] or [MSN] [3]. [1]: http://google.com/ â€œGoogleâ€ [2]: http://search.yahoo.com/ â€œYahoo Searchâ€ [3]: http://search.msn.com/ â€œMSN Searchâ€ I get 10 times more traffic from Google than fromYahoo or MSN. å¼ºè°ƒä½¿ç”¨ä¸¤ä¸ª*æˆ–è€…_è¡¨ç¤ºå¼ºè°ƒ ä½¿ç”¨ä¸€ä¸ªæˆ–è€…ä¸€ä¸ª_è¡¨ç¤ºæ–œä½“ å¦‚ï¼š helloworld helloworld ä»£ç ä½¿ç”¨`ç¬¦å·æ¥ä½¿ç”¨ä»£ç å—è¡Œå†…ä»£ç ä½¿ç”¨`åŒ…èµ·æ¥ å¦‚ print() å›¾ç‰‡åŒæ ·çš„å›¾ç‰‡ä¹Ÿæœ‰è¡Œå†…å¼å’Œå‚è€ƒå¼å‘é“¾æŽ¥ä¸€æ ·åªä¸è¿‡åœ¨å‰é¢å¤šä¸ª ! å¤§æ¦‚è¯­æ³•å°±æ˜¯è¿™ä¹ˆå¤š markdownç®€å•æ–¹ä¾¿ï¼ŒæŽ¨èä½¿ç”¨ã€‚ã€‚è‡ªå·±å†™è¿™ç§ä¸œè¥¿è‡ªå·±æ„Ÿè§‰å†™çš„éƒ½å¥½èœï¼Œå¯èƒ½æ²¡æœ‰ä»€ä¹ˆå†™åšå®¢çš„ä¹ æƒ¯ï¼Œæ…¢æ…¢å†™å§ï¼Œæ€»æœ‰ä¸€å¤©ä¼šæ•´ä½“æ¸…æ™°çš„ã€‚ç®—äº†ï¼Œè‡ªå·±çœ‹å§ :)]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>markdown</tag>
        <tag>è¯­æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mysqlä¸­å‡ºçŽ°Invalid default value for CREATE_TIME é”™è¯¯]]></title>
    <url>%2F2018%2F01%2F01%2F2019-01-01-Mysql%E4%B8%AD%E5%87%BA%E7%8E%B0Invalid_default_value_for_CREATE_TIME%E7%9A%84%E9%94%99%E8%AF%AF%2F</url>
    <content type="text"><![CDATA[Mysqlä¸­å‡ºçŽ°Invalid default value for â€˜CREATE_TIMEâ€™é”™è¯¯æœ€è¿‘åšäº†æ–°çš„ç³»ç»Ÿï¼Œå¹¶æŠŠmysqlå‡çº§åˆ°äº†5.7ç‰ˆæœ¬ï¼Œåœ¨å€’å…¥sqlæ—¶å€™ï¼Œå‡ºçŽ°å¦‚é¢˜çš„é”™è¯¯â€˜Mysqlä¸­å‡ºçŽ°Invalid default value for â€˜CREATE_TIMEâ€™é”™è¯¯â€™,æ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚ æ˜¯å› ä¸ºåœ¨5.7ç‰ˆæœ¬ä¸­çš„sql_modeæœ‰NO_ZERO_IN_DATE,NO_ZERO_DATEè¿™ä¸¤ä¸ªä¸œè¥¿ï¼ŒåŽ»æŽ‰å°±å¥½äº†ã€‚å¦‚ä½•åŽ»æŽ‰ï¼Ÿ ä¸´æ—¶æ–¹æ³• 123mysql&gt; set session -&gt; sql_mode=&apos;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&apos;;Query OK, 0 rows affected, 1 warning (0.00 sec) æ°¸ä¹…æ€§ä¿®æ”¹ ç›´æŽ¥ä¿®æ”¹é…ç½®æ–‡ä»¶ 1234cd /etc/mysql/mysql.conf.dvim mysqld.cnf# æ‰¾åˆ°ã€mysqldã€‘åœ¨ä¸‹é¢æ’å…¥sql_mode=&apos;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&apos; æˆ‘ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•è§£å†³äº†é—®é¢˜ã€‚]]></content>
      <categories>
        <category>MYSQL</category>
      </categories>
      <tags>
        <tag>MYSQL</tag>
      </tags>
  </entry>
</search>
